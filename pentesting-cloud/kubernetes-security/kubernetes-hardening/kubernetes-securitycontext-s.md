# Kubernetes Güvenlik Bağlam(lar)ı

{% hint style="success" %}
AWS Hacking'i öğrenin ve uygulayın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **HackTricks** ve **HackTricks Cloud** github depolarına PR göndererek hacking püf noktalarını paylaşın.

</details>
{% endhint %}

## PodSecurityContext <a href="#podsecuritycontext-v1-core" id="podsecuritycontext-v1-core"></a>

[**Dokümantasyondan:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)

Bir Pod'un güvenlik bağlamını belirlerken birkaç özellik kullanabilirsiniz. Savunma odaklı bir güvenlik açısından şunları düşünmelisiniz:

* **runASNonRoot**'u **True** olarak ayarlamak
* **runAsUser**'ı yapılandırmak
* Mümkünse, **seLinuxOptions** ve **seccompProfile**'ı belirterek **izinleri sınırlamak**
* **runAsGroup** ve **supplementaryGroups** aracılığıyla **ayrıcalık grubu** erişimi vermemek

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroup</strong></a><br><em>tam sayı</em></p>                                                                                                                                                                                                                                                 | <p>Bir Pod'daki **tüm konteynerlere uygulanan özel bir ek grup**. Bazı hacim türleri Kubelet'e bu hacmin sahipliğini Pod tarafından sahiplenilen şekilde değiştirme izni verir:<br>1. Sahip olan GID FSGroup olacaktır<br>2. setgid biti ayarlanır (hacimde oluşturulan yeni dosyalar FSGroup'a ait olacaktır)<br>3. İzin bitleri rw-rw---- ile OR'lanır. Belirtilmemişse, Kubelet hiçbir hacmin sahipliğini ve izinlerini değiştirmez</p> |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroupChangePolicy</strong></a><br><em>dize</em></p>                                                                                                                                                                                                                                      | Bu, Pod içinde açıklanmadan önce hacmin sahipliğini ve iznini değiştirme davranışını tanımlar.                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsGroup</strong></a><br><em>tam sayı</em></p>                                                                                                                                                                                                                                              | Konteyner işlemi giriş noktasını çalıştırmak için kullanılacak **GID**. Belirtilmemişse çalışma zamanı varsayılanını kullanır. Ayrıca SecurityContext içinde de ayarlanabilir.                                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>mantıksal</em></p>                                                                                                                                                                                                                                            | Konteynerin bir kök kullanıcı olarak çalıştırılmaması gerektiğini belirtir. Eğer doğruysa, Kubelet çalışma zamanında görüntüyü doğrular ve UID 0 (kök) olarak çalıştırılmadığından emin olur ve konteyneri başlatmaz.                                                                                                                                                                                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsUser</strong></a><br><em>tam sayı</em></p>                                                                                                                                                                                                                                               | Konteyner işlemi giriş noktasını çalıştırmak için kullanılacak **UID**. Belirtilmemişse, görüntü meta verilerinde belirtilen kullanıcıya varsayılan olarak ayarlanır.                                                                                                                                                                                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>seLinux</em> hakkında daha fazla bilgi</p>                                                           | **Tüm konteynerlere uygulanacak SELinux bağlamı**. Belirtilmemişse, konteyner çalışma zamanı her bir konteyner için rastgele bir SELinux bağlamı tahsis eder.                                                                                                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a><br><em>Seccomp</em> hakkında daha fazla bilgi</p>                                                           | Bu Pod'daki konteynerler tarafından kullanılacak **seccomp seçenekleri**.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>supplementalGroups</strong></a><br><em>tam sayı dizisi</em></p>                                                                                                                                                                                                                                | Her konteynerde çalıştırılan ilk işleme uygulanan **grupların listesi**, konteynerin birincil GID'sine ek olarak.                                                                                                                                                                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>sysctls</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#sysctl-v1-core"><em>Sysctl</em></a> <em>dizi</em><br><em>Sysctl</em> hakkında daha fazla bilgi</p> | Sysctls, Pod için kullanılan **isim alanlı sysctl'leri** içeren bir liste tutar. Desteklenmeyen sysctls'ye sahip Pod'lar (konteyner çalışma zamanı tarafından) başlatılamayabilir.                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                                                                           | Tüm konteynerlere uygulanan Windows'a özgü ayarlar. Belirtilmemişse, bir konteynerin SecurityContext içindeki seçenekler kullanılacaktır.                                                                                                                                                                                                                                                                                                                                               |
## SecurityContext

[**Dokümantasyondan:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

Bu bağlam **konteyner tanımları** içinde ayarlanır. Savunma odaklı bir güvenlik açısından şunları düşünmelisiniz:

* **allowPrivilegeEscalation**'ı **False** olarak ayarlayın
* Hassas **yetenekleri** eklemeyin (ve ihtiyacınız olmayanları kaldırın)
* **privileged**'ı **False** olarak ayarlayın
* Mümkünse, **readOnlyFilesystem**'i **True** olarak ayarlayın
* **runAsNonRoot**'u **True** olarak ayarlayın ve bir **runAsUser** belirleyin
* Mümkünse, **seLinuxOptions** ve **seccompProfile**'ı belirterek **izinleri sınırlamayı** düşünün
* **runAsGroup** aracılığıyla **ayrıcalık grubu** erişimi **VERMEYİN.**

**SecurityContext ve PodSecurityContext** içinde ayarlanan özelliklerin, **SecurityContext**'te belirtilen değeri **önceliklidir**.

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>allowPrivilegeEscalation</strong></a><br><em>boolean</em></p>                                                                                                                                                                      | **AllowPrivilegeEscalation**, bir işlemin **ebeveyn işleminden daha fazla ayrıcalık kazanıp kazanamayacağını kontrol eder**. Bu bool, konteyner işleminde no\_new\_privs bayrağının ayarlanıp ayarlanmayacağını doğrudan kontrol eder. AllowPrivilegeEscalation, konteyner **Privileged** olarak çalıştırıldığında veya **CAP\_SYS\_ADMIN**'e sahip olduğunda her zaman true'dur. |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>capabilities</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#capabilities-v1-core"><em>Capabilities</em></a><br><em>Capabilities</em> <em>hakkında daha fazla bilgi</em></p>  | **Konteynerleri çalıştırırken eklemek/çıkarmak için yetenekler**. Varsayılan olarak, yeteneklerin varsayılan kümesi kullanılır.                                                                                                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>privileged</strong></a><br><em>boolean</em></p>                                                                                                                                                                                    | Ayrıcalıklı modda konteyneri çalıştırın. Ayrıcalıklı konteynerlerdeki işlemler, temelde **ana makinedeki root ile eşdeğerdir**. Varsayılan olarak false'dur.                                                                                                                                                                               |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>procMount</strong></a><br><em>string</em></p>                                                                                                                                                                                      | procMount, konteynerler için kullanılacak **proc mount türünü belirtir**. Varsayılan, salt okunur yollar ve maskelenmiş yollar için konteyner çalışma zamanı varsayılanlarını kullanan DefaultProcMount'tur.                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>readOnlyRootFilesystem</strong></a><br><em>boolean</em></p>                                                                                                                                                                        | Bu **konteynerin salt okunur kök dosya sistemi olup olmadığını** belirtir. Varsayılan false'dur.                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                    | Konteyner işlemi giriş noktasını çalıştırmak için **GID'yi belirtir**. Belirtilmemişse çalışma zamanı varsayılanı kullanılır.                                                                                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                  | Konteynerin **bir kök kullanıcı olarak çalıştırılmaması gerektiğini** belirtir. True ise, Kubelet, çalışma zamanında görüntünün UID 0 (kök) olarak çalıştırılmadığından emin olmak için doğrular ve gerektiğinde konteyneri başlatmayı reddeder.                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                     | Konteyner işlemi giriş noktasını çalıştırmak için **UID'yi belirtir**. Belirtilmemişse, görüntü meta verilerinde belirtilen kullanıcıya varsayılan olarak ayarlanır.                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>SELinux</em> <em>hakkında daha fazla bilgi</em></p> | Konteynere uygulanacak **SELinux bağlamını belirtir**. Belirtilmemişse, konteyner çalışma zamanı her konteyner için rastgele bir SELinux bağlamı ayırır.                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a></p>                                                               | Bu konteyner tarafından kullanılacak **seccomp seçenekleri**.                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                 | Tüm konteynerlere uygulanan **Windows özel ayarları**.                                                                                                                                                                                                                                                              |

## Referanslar

* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)
* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking öğrenin ve pratik yapın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi Twitter'da takip edin 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking püf noktalarını göndererek HackTricks ve HackTricks Cloud** github depolarına PR göndererek paylaşın.

</details>
{% endhint %}
