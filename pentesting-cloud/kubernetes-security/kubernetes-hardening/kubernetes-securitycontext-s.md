# Ασφάλεια Kubernetes SecurityContext(s)

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** στη 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Κοινοποιήστε κόλπα χάκερ υποβάλλοντας PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## PodSecurityContext <a href="#podsecuritycontext-v1-core" id="podsecuritycontext-v1-core"></a>

[**Από τα έγγραφα:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)

Όταν καθορίζετε το πλαίσιο ασφαλείας ενός Pod μπορείτε να χρησιμοποιήσετε πολλά χαρακτηριστικά. Από την άποψη της αμυντικής ασφάλειας θα πρέπει να λάβετε υπόψη:

* Να έχετε το **runASNonRoot** ως **True**
* Να διαμορφώσετε το **runAsUser**
* Εάν είναι δυνατό, να εξετάσετε τον **περιορισμό** των **δικαιωμάτων** δηλώνοντας **seLinuxOptions** και **seccompProfile**
* Να **ΜΗΝ** δίνετε πρόσβαση στην **ομάδα προνομίων** μέσω του **runAsGroup** και **supplementaryGroups**

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroup</strong></a><br><em>ακέραιος</em></p>                                                                                                                                                                                                                                                 | <p>Μια ειδική επιπλέον ομάδα που ισχύει για <strong>όλους τους ελέγχους σε ένα pod</strong>. Κάποιοι τύποι όγκου επιτρέπουν στον Kubelet να <strong>αλλάξει την ιδιοκτησία αυτού του όγκου</strong> ώστε να ανήκει στο pod:<br>1. Το GID ιδιοκτήτη θα είναι το FSGroup<br>2. Το bit setgid είναι ενεργοποιημένο (νέα αρχεία που δημιουργούνται στον όγκο θα ανήκουν στο FSGroup)<br>3. Τα bits άδειας είναι OR'd με rw-rw---- Εάν δεν έχει οριστεί, ο Kubelet δεν θα τροποποιήσει την ιδιοκτησία και τα δικαιώματα κανενός όγκου</p> |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroupChangePolicy</strong></a><br><em>συμβολοσειρά</em></p>                                                                                                                                                                                                                                      | Αυτό ορίζει τη συμπεριφορά της **αλλαγής ιδιοκτησίας και δικαιωμάτων του όγκου** πριν εκτεθεί μέσα στο Pod.                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsGroup</strong></a><br><em>ακέραιος</em></p>                                                                                                                                                                                                                                              | Το **GID για την εκτέλεση της εισόδου της διεργασίας του ελέγχου**. Χρησιμοποιεί την προεπιλογή του χρόνου εκτέλεσης εάν δεν έχει οριστεί. Μπορεί επίσης να οριστεί στο SecurityContext.                                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>λογική τιμή</em></p>                                                                                                                                                                                                                                            | Υποδηλώνει ότι ο ελεγκτής πρέπει να εκτελείται ως μη ριζικός χρήστης. Εάν είναι αληθές, ο Kubelet θα επικυρώσει την εικόνα κατά την εκτέλεση για να εξασφαλίσει ότι δεν εκτελείται ως UID 0 (root) και θα αποτύχει να ξεκινήσει τον ελεγκτή αν το κάνει.                                                                                                                                                                                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsUser</strong></a><br><em>ακέραιος</em></p>                                                                                                                                                                                                                                               | Το **UID για την εκτέλεση της εισόδου της διεργασίας του ελέγχου**. Προεπιλογή στον χρήστη που καθορίζεται στα μεταδεδομένα της εικόνας εάν δεν έχει οριστεί.                                                                                                                                                                                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Περισσότερες πληροφορίες σχετικά με</em> <em><strong>seLinux</strong></em></p>                                                           | Το **περιβάλλον SELinux που θα εφαρμοστεί σε όλους τους ελέγχους**. Εάν δεν έχει οριστεί, το περιβάλλον εκτέλεσης του ελέγχου θα εκχωρήσει ένα τυχαίο περιβάλλον SELinux για κάθε έλεγχο.                                                                                                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a><br><em>Περισσότερες πληροφορίες σχετικά με</em> <em><strong>Seccomp</strong></em></p>                                                           | Οι **επιλογές seccomp που χρησιμοποιούνται από τους ελέγχους** σε αυτό το pod.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>supplementalGroups</strong></a><br><em>πίνακας ακεραίων</em></p>                                                                                                                                                                                                                                | Μια λίστα **ομάδων που εφαρμόζονται στην πρώτη διεργασία που εκτελείται σε κάθε έλεγχο**, εκτός από τον κύριο GID του ελέγχου.                                                                                                                                                                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>sysctls</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#sysctl-v1-core"><em>Sysctl</em></a> <em>πίνακας</em><br><em>Περισσότερες πληροφορίες σχετικά με</em> <a href="https://www.garron.me/en/go2linux/sysctl-linux.html"><em><strong>sysctls</strong></em></a></p> | Τα Sysctls κρατούν μια λίστα από **ονοματοδοτημένα sysctls που χρησιμοποιούνται για το pod**. Τα Pods με μη υποστηριζόμενα sysctls (από το runtime του ελέγχου) ενδέχεται να αποτύχουν να ξεκινήσουν.                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                                                                           | Οι ειδικές ρυθμίσεις Windows που εφαρμόζονται σε όλους τους ελέγχους. Εάν δεν έχει οριστεί, οι επιλογές εντός του SecurityContext ενός ελέγχου θα χρησιμοποιηθούν.                                                                                                                                                                                                                                                                                                                                               |
## SecurityContext

[**Από τα έγγραφα:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

Αυτό το πλαίσιο ορίζεται μέσα στις **ορισμούς των containers**. Από την άποψη της ασφάλειας θα πρέπει να λάβετε υπόψη:

* **allowPrivilegeEscalation** σε **False**
* Να μην προσθέτετε ευαίσθητες **δυνατότητες** (και να αφαιρέσετε αυτές που δεν χρειάζεστε)
* **privileged** σε **False**
* Εάν είναι δυνατόν, ορίστε το **readOnlyFilesystem** ως **True**
* Ορίστε το **runAsNonRoot** σε **True** και ορίστε ένα **runAsUser**
* Εάν είναι δυνατόν, εξετάστε τον **περιορισμό** των **δικαιωμάτων** δείχνοντας **seLinuxOptions** και **seccompProfile**
* **ΜΗΝ** δίνετε πρόσβαση στην **ομάδα προνομίων** μέσω του **runAsGroup.**

Σημειώστε ότι τα χαρακτηριστικά που ορίζονται τόσο στο **SecurityContext όσο και στο PodSecurityContext**, η τιμή που καθορίζεται στο **SecurityContext** έχει **προτεραιότητα**.

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>allowPrivilegeEscalation</strong></a><br><em>boolean</em></p>                                                                                                                                                                      | Το **AllowPrivilegeEscalation** ελέγχει εάν ένας διεργασία μπορεί να **κερδίσει περισσότερα προνόμια** από τη γονική της διεργασία. Αυτό το bool ελέγχει απευθείας εάν η σημαία no\_new\_privs θα οριστεί στη διεργασία του container. Το AllowPrivilegeEscalation είναι πάντα true όταν το container τρέχει ως **Privileged** ή έχει **CAP\_SYS\_ADMIN** |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>capabilities</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#capabilities-v1-core"><em>Capabilities</em></a><br><em>Περισσότερες πληροφορίες σχετικά με τις</em> <em><strong>Δυνατότητες</strong></em></p>  | Οι **δυνατότητες που προστίθενται/αφαιρούνται κατά την εκτέλεση των containers**. Προεπιλεγμένα στο σύνολο προεπιλεγμένων δυνατοτήτων.                                                                                                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>privileged</strong></a><br><em>boolean</em></p>                                                                                                                                                                                    | Εκτέλεση container σε κατάσταση προνομίων. Οι διεργασίες σε προνομιούχα containers είναι ουσιαστικά **ισοδύναμες με το ριζικό χρήστη στον κεντρικό υπολογιστή**. Προεπιλογή σε false.                                                                                                                                                                               |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>procMount</strong></a><br><em>string</em></p>                                                                                                                                                                                      | Το procMount υποδηλώνει τον **τύπο προσάρτησης proc που θα χρησιμοποιηθεί για τα containers**. Η προεπιλογή είναι το DefaultProcMount που χρησιμοποιεί τις προεπιλεγμένες ρυθμίσεις του χρόνου εκτέλεσης του container για τα μονοπάτια που είναι μόνο για ανάγνωση και τα μάσκαρα μονοπατιών.                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>readOnlyRootFilesystem</strong></a><br><em>boolean</em></p>                                                                                                                                                                        | Εάν αυτό το **container έχει ένα ανάγνωσης-μόνο ριζικό σύστημα αρχείων**. Η προεπιλογή είναι false.                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                    | Το **GID για την εκτέλεση του σημείου εισόδου** της διεργασίας του container. Χρησιμοποιεί την προεπιλογή του χρόνου εκτέλεσης αν δεν έχει οριστεί.                                                                                                                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                  | Υποδηλώνει ότι το container πρέπει **να εκτελείται ως μη-ριζικός χρήστης**. Εάν είναι true, το Kubelet θα επικυρώσει την εικόνα κατά την εκτέλεση για να εξασφαλίσει ότι δεν τρέχει ως UID 0 (root) και θα αποτύχει να ξεκινήσει το container αν το κάνει.                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                     | Το **UID για την εκτέλεση του σημείου εισόδου** της διεργασίας του container. Προεπιλογή στον χρήστη που καθορίζεται στα μεταδεδομένα της εικόνας αν δεν έχει καθοριστεί.                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Περισσότερες πληροφορίες σχετικά με το</em> <em><strong>seLinux</strong></em></p> | Το **περιβάλλον SELinux που θα εφαρμοστεί στο container**. Αν δεν έχει καθοριστεί, το χρονοδρομέας εκτέλεσης του container θα εκχωρήσει ένα τυχαίο περιβάλλον SELinux για κάθε container.                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a></p>                                                               | Οι **επιλογές seccomp** που θα χρησιμοποιηθούν από αυτό το container.                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                 | Οι **ειδικές ρυθμίσεις των Windows** που εφαρμόζονται σε όλα τα containers.                                                                                                                                                                                                                                                              |

## Αναφορές

* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)
* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα τηλεγράφου**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο GitHub.

</details>
{% endhint %}
