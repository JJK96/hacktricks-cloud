# Kubernetes Sicherheitskontext(e)

{% hint style="success" %}
Lernen Sie und √ºben Sie AWS-Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen Sie und √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys einreichen.

</details>
{% endhint %}

## PodSecurityContext <a href="#podsecuritycontext-v1-core" id="podsecuritycontext-v1-core"></a>

[**Aus den Dokumenten:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)

Bei der Festlegung des Sicherheitskontexts eines Pods k√∂nnen mehrere Attribute verwendet werden. Aus defensiver Sicherheitssicht sollten Sie in Betracht ziehen:

* **runASNonRoot** als **True** zu haben
* **runAsUser** konfigurieren
* Wenn m√∂glich, **Berechtigungen** durch Angabe von **seLinuxOptions** und **seccompProfile** **einzuschr√§nken**
* **NICHT** das **Privilegien-Gruppen**-Zugriff √ºber **runAsGroup** und **supplementaryGroups** zu gew√§hren

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroup</strong></a><br><em>Ganze Zahl</em></p>                                                                                                                                                                                                                                                 | <p>Eine spezielle zus√§tzliche Gruppe, die auf <strong>alle Container in einem Pod</strong> angewendet wird. Einige Volumenarten erm√∂glichen es dem Kubelet, <strong>das Eigentum dieses Volumens zu √§ndern</strong>, sodass es im Besitz des Pods ist:<br>1. Die besitzende GID wird die FSGroup sein<br>2. Das Setgid-Bit ist gesetzt (neue Dateien, die im Volumen erstellt werden, geh√∂ren der FSGroup)<br>3. Die Berechtigungsbits werden mit rw-rw---- verkn√ºpft. Wenn nicht festgelegt, √§ndert der Kubelet nicht das Eigentum und die Berechtigungen eines Volumens</p> |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroupChangePolicy</strong></a><br><em>Zeichenfolge</em></p>                                                                                                                                                                                                                                      | Dies definiert das Verhalten der **√Ñnderung des Eigentums und der Berechtigung des Volumens**, bevor es im Pod freigegeben wird.                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsGroup</strong></a><br><em>Ganze Zahl</em></p>                                                                                                                                                                                                                                              | Die **GID, unter der der Einstiegspunkt des Containerprozesses ausgef√ºhrt wird**. Verwendet Standardwert zur Laufzeit, wenn nicht festgelegt. Kann auch im Sicherheitskontext festgelegt werden.                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>Boolesch</em></p>                                                                                                                                                                                                                                            | Gibt an, dass der Container als Nicht-Root-Benutzer ausgef√ºhrt werden muss. Wenn true, wird der Kubelet das Bild zur Laufzeit validieren, um sicherzustellen, dass es nicht als UID 0 (root) ausgef√ºhrt wird, und den Container nicht starten, wenn dies der Fall ist.                                                                                                                                                                                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsUser</strong></a><br><em>Ganze Zahl</em></p>                                                                                                                                                                                                                                               | Die **UID, unter der der Einstiegspunkt des Containerprozesses ausgef√ºhrt wird**. Standardm√§√üig wird der im Bildmetadaten angegebene Benutzer verwendet, wenn nicht angegeben.                                                                                                                                                                                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Weitere Informationen zu</em> <em><strong>seLinux</strong></em></p>                                                           | Der **SELinux-Kontext, der auf alle Container angewendet werden soll**. Wenn nicht festgelegt, wird der Container-Runtime f√ºr jeden Container einen zuf√§lligen SELinux-Kontext zuweisen.                                                                                                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a><br><em>Weitere Informationen zu</em> <em><strong>Seccomp</strong></em></p>                                                           | Die **Seccomp-Optionen, die von den Containern** in diesem Pod verwendet werden sollen.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>supplementalGroups</strong></a><br><em>Ganze Zahl-Array</em></p>                                                                                                                                                                                                                                | Eine Liste von **Gruppen, die auf den ersten Prozess angewendet werden, der in jedem Container ausgef√ºhrt wird**, zus√§tzlich zur prim√§ren GID des Containers.                                                                                                                                                                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>sysctls</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#sysctl-v1-core"><em>Sysctl</em></a> <em>Array</em><br><em>Weitere Informationen zu</em> <a href="https://www.garron.me/en/go2linux/sysctl-linux.html"><em><strong>sysctls</strong></em></a></p> | Sysctls enthalten eine Liste von **namespaced sysctls, die f√ºr den Pod** verwendet werden. Pods mit nicht unterst√ºtzten sysctls (durch den Container-Runtime) k√∂nnen m√∂glicherweise nicht gestartet werden.                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                                                                           | Die f√ºr alle Container angewendeten Windows-spezifischen Einstellungen. Wenn nicht festgelegt, werden die Optionen innerhalb des Sicherheitskontexts eines Containers verwendet.                                                                                                                                                                                                                                                                                                                                               |
## SecurityContext

[**Aus den Dokumenten:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

Dieser Kontext wird innerhalb der **Containerdefinitionen** festgelegt. Aus einer defensiven Sicherheitsperspektive sollten Sie Folgendes beachten:

* **allowPrivilegeEscalation** auf **False** setzen
* F√ºgen Sie keine sensiblen **F√§higkeiten** hinzu (und entfernen Sie diejenigen, die Sie nicht ben√∂tigen)
* **privileged** auf **False** setzen
* Wenn m√∂glich, setzen Sie **readOnlyFilesystem** auf **True**
* Setzen Sie **runAsNonRoot** auf **True** und legen Sie einen **runAsUser** fest
* Wenn m√∂glich, erw√§gen Sie, **Berechtigungen** durch Angabe von **seLinuxOptions** und **seccompProfile** zu **beschr√§nken**
* Geben Sie **KEINEN** **Privilegien-Gruppenzugriff** √ºber **runAsGroup**.

Beachten Sie, dass die Attribute sowohl im **SecurityContext als auch im PodSecurityContext** festgelegt sind, wobei der im **SecurityContext** angegebene Wert **Vorrang hat**.

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>allowPrivilegeEscalation</strong></a><br><em>boolean</em></p>                                                                                                                                                                      | **AllowPrivilegeEscalation** steuert, ob ein Prozess **mehr Berechtigungen erlangen kann** als sein √ºbergeordneter Prozess. Dieses bool steuert direkt, ob das no\_new\_privs-Flag f√ºr den Containerprozess gesetzt wird. AllowPrivilegeEscalation ist immer dann true, wenn der Container als **Privileged** ausgef√ºhrt wird oder **CAP\_SYS\_ADMIN** hat. |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>capabilities</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#capabilities-v1-core"><em>F√§higkeiten</em></a><br><em>Weitere Informationen zu</em> <em><strong>F√§higkeiten</strong></em></p>  | Die **F√§higkeiten, die hinzugef√ºgt/entfernt werden sollen, wenn Container ausgef√ºhrt werden**. Standardm√§√üig auf den Standardf√§higkeitssatz festgelegt.                                                                                                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>privileged</strong></a><br><em>boolean</em></p>                                                                                                                                                                                    | Container im privilegierten Modus ausf√ºhren. Prozesse in privilegierten Containern sind im Wesentlichen **√§quivalent zu root auf dem Host**. Standardm√§√üig auf false festgelegt.                                                                                                                                                                               |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>procMount</strong></a><br><em>string</em></p>                                                                                                                                                                                      | procMount gibt den **Typ des proc-Mounts an, der f√ºr die Container verwendet werden soll**. Standardm√§√üig wird DefaultProcMount verwendet, das die Standardwerte des Container-Runtimes f√ºr schreibgesch√ºtzte Pfade und maskierte Pfade verwendet.                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>readOnlyRootFilesystem</strong></a><br><em>boolean</em></p>                                                                                                                                                                        | Ob dieses **Container ein schreibgesch√ºtztes Stammdateisystem hat**. Standardm√§√üig ist dies false.                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                    | Die **GID, unter der der Einstiegspunkt** des Containerprozesses ausgef√ºhrt werden soll. Verwendet Standardwert zur Laufzeit, wenn nicht festgelegt.                                                                                                                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                  | Gibt an, dass der Container als **Nicht-Root-Benutzer ausgef√ºhrt werden muss**. Wenn true, wird der Kubelet das Bild zur Laufzeit validieren, um sicherzustellen, dass es nicht als UID 0 (root) ausgef√ºhrt wird, und den Containerstart fehlschlagen lassen, wenn dies der Fall ist.                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                     | Die **UID, unter der der Einstiegspunkt** des Containerprozesses ausgef√ºhrt werden soll. Standardm√§√üig wird der im Bildmetadaten angegebene Benutzer verwendet, wenn nicht festgelegt.                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Weitere Informationen zu</em> <em><strong>seLinux</strong></em></p> | Der **SELinux-Kontext, der auf den Container angewendet werden soll**. Wenn nicht festgelegt, wird der Container-Runtime f√ºr jeden Container einen zuf√§lligen SELinux-Kontext zuweisen.                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a></p>                                                               | Die **seccomp-Optionen**, die von diesem Container verwendet werden sollen.                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                 | Die auf alle Container angewendeten **spezifischen Windows-Einstellungen**.                                                                                                                                                                                                                                                              |

## Referenzen

* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)
* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

{% hint style="success" %}
Lernen Sie & √ºben Sie AWS-Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen Sie & √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
{% endhint %}
