# рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдХреБрдмрд░рдиреЗрдЯреАрд╕ рд╕реЗрд╡рд╛рдПрдВ

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдФрд░ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
{% endhint %}

рдХреБрдмрд░рдиреЗрдЯреАрд╕ рдХрдИ **рд╡рд┐рд╢рд┐рд╖реНрдЯ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрд╡рд╛рдПрдВ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк **рдЗрдВрдЯрд░рдиреЗрдЯ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдпрд╛ **рдПрдХ рдкреЙрдб рдХреЛ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЖрдВрддрд░рд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

## OSINT рдХреЗ рд╕рд╛рде рдЙрдЬрд╛рдЧрд░ рдкреЙрдбреНрд╕ рдЦреЛрдЬрдирд╛

рдПрдХ рддрд░реАрдХрд╛ `Identity LIKE "k8s.%.com"` рдХреА рдЦреЛрдЬ рдХрд░рдирд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ [crt.sh](https://crt.sh) рдореЗрдВ рдХреБрдмрд░рдиреЗрдЯреАрд╕ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕рдмрдбреЛрдореЗрдиреНрд╕ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдПред рдПрдХ рдФрд░ рддрд░реАрдХрд╛ `"k8s.%.com"` рдХреЛ github рдореЗрдВ рдЦреЛрдЬрдирд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ **YAML рдлрд╝рд╛рдЗрд▓реНрд╕** рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рд╕рдореЗрдВ рдпрд╣ рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╣реЛред

## рдХреБрдмрд░рдиреЗрдЯреАрд╕ рд╕реЗрд╡рд╛рдПрдВ рдХреИрд╕реЗ рдЙрдЬрд╛рдЧрд░ рдХрд░рддрд╛ рд╣реИ

рдпрд╣ рдЖрдкрдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХреБрдмрд░рдиреЗрдЯреАрд╕ рдХреИрд╕реЗ **рд╕реЗрд╡рд╛рдПрдВ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдЙрдЬрд╛рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ** рдЗрдиреНрд╣реЗрдВ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП:

{% content-ref url="exposing-services-in-kubernetes.md" %}
[exposing-services-in-kubernetes.md](exposing-services-in-kubernetes.md)
{% endcontent-ref %}

## рдкреЛрд░реНрдЯ рд╕реНрдХреИрдирд┐рдВрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдЬрд╛рдЧрд░ рдкреЙрдбреНрд╕ рдЦреЛрдЬрдирд╛

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреЛрд░реНрдЯреНрд╕ рдПрдХ рдХреБрдмрд░рдиреЗрдЯреАрд╕ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдЦреБрд▓реЗ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ:

| рдкреЛрд░реНрдЯ            | рдкреНрд░рдХреНрд░рд┐рдпрд╛        | рд╡рд┐рд╡рд░рдг                                                            |
| --------------- | -------------- | ---------------------------------------------------------------------- |
| 443/TCP         | kube-apiserver | рдХреБрдмрд░рдиреЗрдЯреАрд╕ API рдкреЛрд░реНрдЯ                                                    |
| 2379/TCP        | etcd           |                                                                        |
| 6666/TCP        | etcd           | etcd                                                                   |
| 4194/TCP        | cAdvisor       | рдХрдВрдЯреЗрдирд░ рдореАрдЯреНрд░рд┐рдХреНрд╕                                                      |
| 6443/TCP        | kube-apiserver | рдХреБрдмрд░рдиреЗрдЯреАрд╕ API рдкреЛрд░реНрдЯ                                                    |
| 8443/TCP        | kube-apiserver | Minikube API рдкреЛрд░реНрдЯ                                                      |
| 8080/TCP        | kube-apiserver | рдЕрд╕реБрд░рдХреНрд╖рд┐рдд API рдкреЛрд░реНрдЯ                                                      |
| 10250/TCP       | kubelet        | HTTPS API рдЬреЛ рдкреВрд░реНрдг рдореЛрдб рдПрдХреНрд╕реЗрд╕ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ                                |
| 10255/TCP       | kubelet        | рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рд╡рд╛рд▓рд╛ HTTP рдкреЛрд░реНрдЯ: рдкреЙрдб, рдЪрд▓ рд░рд╣реЗ рдкреЙрдбреНрд╕ рдФрд░ рдиреЛрдб рд╕реНрдерд┐рддрд┐ |
| 10256/TCP       | kube-proxy     | рдХреНрдпреВрдм рдкреНрд░реЙрдХреНрд╕реА рд╣реЗрд▓реНрде рдЪреЗрдХ рд╕рд░реНрд╡рд░                                         |
| 9099/TCP        | calico-felix   | Calico рдХреЗ рд▓рд┐рдП рд╣реЗрд▓реНрде рдЪреЗрдХ рд╕рд░реНрд╡рд░                                         |
| 6782-4/TCP      | weave          | рдореАрдЯреНрд░рд┐рдХреНрд╕ рдФрд░ рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕                                                  |
| 30000-32767/TCP | NodePort       | рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкреНрд░реЙрдХреНрд╕реА                                                  |
| 44134/TCP       | Tiller         | рд╣реЗрд▓реНрдо рд╕реЗрд╡рд╛ рд╕реБрди рд░рд╣реА рд╣реИ                                                 |

### Nmap

{% code overflow="wrap" %}
```bash
nmap -n -T4 -p 443,2379,6666,4194,6443,8443,8080,10250,10255,10256,9099,6782-6784,30000-32767,44134 <pod_ipaddress>/16
```
{% endcode %}

### Kube-apiserver

рдпрд╣ **API Kubernetes рд╕реЗрд╡рд╛** рд╣реИ рдЬрд┐рд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рд╢рд╛рд╕рдХ рдЖрдо рддреМрд░ рдкрд░ рдЙрдкрдХрд░рдг **`kubectl`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрд╛рддрдЪреАрдд рдХрд░рддреЗ рд╣реИрдВред

**рд╕рд╛рдорд╛рдиреНрдп рдкреЛрд░реНрдЯ: 6443 рдФрд░ 443**, рд▓реЗрдХрд┐рди minikube рдореЗрдВ 8443 рдФрд░ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рдореЗрдВ 8080 рднреА рд╣реИред
```
curl -k https://<IP Address>:(8|6)443/swaggerapi
curl -k https://<IP Address>:(8|6)443/healthz
curl -k https://<IP Address>:(8|6)443/api/v1
```
**рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЖрдк рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рдЗрд╕ рд╕реЗрд╡рд╛ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рдХреЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдХреНрд░рд┐рдпрд╛рдПрдБ рдХреИрд╕реЗ рдХрд░реЗрдВ рдЗрд╕рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХреЗрдВ:**

{% content-ref url="kubernetes-enumeration.md" %}
[kubernetes-enumeration.md](kubernetes-enumeration.md)
{% endcontent-ref %}

### Kubelet API

рдпрд╣ рд╕реЗрд╡рд╛ **рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдиреЛрдб рдореЗрдВ рдЪрд▓рддреА рд╣реИ**ред рдпрд╣ рд╕реЗрд╡рд╛ рд╡рд╣ рд╣реИ рдЬреЛ **рдиреЛрдб** рдХреЗ рдЕрдВрджрд░ рдХреЗ рдкреЙрдб рдХреЛ **рдирд┐рдпрдВрддреНрд░рд┐рдд** рдХрд░реЗрдЧреАред рдпрд╣ **kube-apiserver** рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рддреА рд╣реИред

рдпрджрд┐ рдЖрдк рдЗрд╕ рд╕реЗрд╡рд╛ рдХреЛ рдЕрдирд╛рд╡реГрдд рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЖрдкрдиреЗ рдПрдХ **рдЕрдкреНрд░рдорд╛рдгрд┐рдд RCE** рдкрд╛рдпрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

#### Kubelet API
```
curl -k https://<IP address>:10250/metrics
curl -k https://<IP address>:10250/pods
```
рдпрджрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ `рдЕрдирдзрд┐рдХреГрдд` рд╣реИ рддреЛ рдЗрд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

рдпрджрд┐ рдЖрдк рдиреЛрдбреНрд╕ рдХреА рд╕реВрдЪреА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде kubelets рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рдХреА рд╕реВрдЪреА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
kubectl get nodes -o custom-columns='IP:.status.addresses[0].address,KUBELET_PORT:.status.daemonEndpoints.kubeletEndpoint.Port' | grep -v KUBELET_PORT | while IFS='' read -r node; do
ip=$(echo $node | awk '{print $1}')
port=$(echo $node | awk '{print $2}')
echo "curl -k --max-time 30 https://$ip:$port/pods"
echo "curl -k --max-time 30 https://$ip:2379/version" #Check  also for etcd
done
```
#### kubelet (рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдпреЛрдЧреНрдп)
```
curl -k https://<IP Address>:10255
http://<external-IP>:10255/pods
```
### etcd рдПрдкреАрдЖрдИ
```
curl -k https://<IP address>:2379
curl -k https://<IP address>:2379/version
etcdctl --endpoints=http://<MASTER-IP>:2379 get / --prefix --keys-only
```
### рдЯрд┐рд▓рд░
```
helm --host tiller-deploy.kube-system:44134 version
```
рдЖрдк рдЗрд╕ рд╕реЗрд╡рд╛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ Kubernetes рдХреЗ рдЕрдВрджрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ:

### cAdvisor

рдореИрдЯреНрд░рд┐рдХреНрд╕ рдЬреБрдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╕реЗрд╡рд╛ред
```
curl -k https://<IP Address>:4194
```
### рдиреЛрдбрдкреЛрд░реНрдЯ

рдЬрдм рдПрдХ рдкреЛрд░реНрдЯ рдХреЛ рд╕рднреА рдиреЛрдбреНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдиреЛрдбрдкреЛрд░реНрдЯ** рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдЬрд╛рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдШреЛрд╖рд┐рдд **рд╕реЗрд╡рд╛** рдореЗрдВ рдЯреНрд░реИрдлрд┐рдХ рдХреЛ рдкреНрд░реЛрдХреНрд╕реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рднреА рдиреЛрдбреНрд╕ рдореЗрдВ рдПрдХ рд╣реА рдкреЛрд░реНрдЯ рдЦреЛрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдпрд╣ рдкреЛрд░реНрдЯ **30000-32767** рдХреЗ рд░реЗрдВрдЬ рдореЗрдВ рд╣реЛрдЧрд╛ред рдЗрд╕рд▓рд┐рдП рдирдП рдЬрд╛рдВрдЪ рди рдХрд┐рдП рдЧрдП рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдЙрди рдкреЛрд░реНрдЯреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╣реБрдВрдЪрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
```
sudo nmap -sS -p 30000-32767 <IP>
```
## рд╡рдВрд░рдмрд▓ рдорд┐рд╕рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рдиреНрд╕

### рдХреНрдпреВрдм-рдПрдкреАрдЖрдИрд╕рд░реНрд╡рд░ рдЕрдирд╛рдо рдПрдХреНрд╕реЗрд╕

**рдХреНрдпреВрдм-рдПрдкреАрдЖрдИрд╕рд░реНрд╡рд░ рдПрдкреАрдЖрдИ рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рдХрд╛ рдЕрдирд╛рдо рдПрдХреНрд╕реЗрд╕ рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИ**ред рд▓реЗрдХрд┐рди рдЖрдк рдХреБрдЫ рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

![](https://www.cyberark.com/wp-content/uploads/2019/09/Kube-Pen-2-fig-5.png)

### **ETCD рдЕрдирд╛рдо рдПрдХреНрд╕реЗрд╕ рдХреА рдЬрд╛рдВрдЪ**

ETCD рдХреНрд▓рд╕реНрдЯрд░ рд╕реАрдХреНрд░реЗрдЯреНрд╕, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЗрдВ рдФрд░ рдЕрдзрд┐рдХ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛** рд╕реНрдЯреЛрд░ рдХрд░рддрд╛ рд╣реИред **рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рд░реВрдк рд╕реЗ, ETCD **рдЕрдирд╛рдо рд░реВрдк рд╕реЗ** рдПрдХреНрд╕реЗрд╕ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдЬрд╛рдВрдЪрдирд╛ рд╣рдореЗрд╢рд╛ рдЕрдЪреНрдЫрд╛ рд╣реЛрддрд╛ рд╣реИред

рдЕрдЧрд░ ETCD рдЕрдирд╛рдо рд░реВрдк рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ **[etcdctl](https://github.com/etcd-io/etcd/blob/master/etcdctl/READMEv2.md)** **рдЯреВрд▓** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рд╕рднреА рд╕реНрдЯреЛрд░ рдХрд┐рдП рдЧрдП рдХреАрдЬрд╝ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧреА:
```
etcdctl --endpoints=http://<MASTER-IP>:2379 get / --prefix --keys-only
```
### **рдХреБрдмрд▓реЗрдЯ RCE**

[**рдХреБрдмрд▓реЗрдЯ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг**](https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/) рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рддрд╛ рд╣реИ рдХрд┐ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕реЗрд╡рд╛ рдХреЛ рдЕрдирд╛рдо рдПрдХреНрд╕реЗрд╕ рд╕реНрд╡реАрдХреГрдд рд╣реИ:**

> рдХреБрдмрд▓реЗрдЯ рд╕рд░реНрд╡рд░ рдХреЛ рдЕрдирд╛рдо рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИред рдЕрдиреНрдп рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд┐рдзрд┐ рджреНрд╡рд╛рд░рд╛ рдЕрд╕реНрд╡реАрдХреГрдд рди рдХрд┐рдП рдЧрдП рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЕрдирд╛рдо рдЕрдиреБрд░реЛрдз рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╡рд╣рд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЕрдирд╛рдо рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ рдПрдХ рдЙрдкрдпреЛрдХреНрддрд╛ рдирд╛рдо `system:anonymous` рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рдПрдХ рд╕рдореВрд╣ рдирд╛рдо `system:unauthenticated` рд╣реЛрддрд╛ рд╣реИред

рдХреБрдмрд▓реЗрдЯ API рдХреА **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдФрд░ рдЕрдзрд┐рдХреГрддрд┐ рдХреЛ рд╕рдордЭрдиреЗ** рдХреЗ рд▓рд┐рдП рдЗрд╕ рдкреГрд╖реНрда рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:

{% content-ref url="../kubernetes-pentesting/pentesting-kubernetes-services/kubelet-authentication-and-authorization.md" %}
[kubelet-authentication-and-authorization.md](../kubernetes-pentesting/pentesting-kubernetes-services/kubelet-authentication-and-authorization.md)
{% endcontent-ref %}

**рдХреБрдмрд▓реЗрдЯ** рд╕реЗрд╡рд╛ **API рдХрд╛ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдирд╣реАрдВ рд╣реИ**, рд▓реЗрдХрд┐рди рд╕реНрд░реЛрдд рдХреЛрдб рдпрд╣рд╛рдБ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрдЬрд╛рдЧрд░ рдХрд┐рдП рдЧрдП рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рдЗрддрдирд╛ рдЖрд╕рд╛рди рд╣реИ рдЬрд┐рддрдирд╛ рдХрд┐ **рдпрд╣ рдЪрд▓рд╛рдирд╛:**
```bash
curl -s https://raw.githubusercontent.com/kubernetes/kubernetes/master/pkg/kubelet/server/server.go | grep 'Path("/'

Path("/pods").
Path("/run")
Path("/exec")
Path("/attach")
Path("/portForward")
Path("/containerLogs")
Path("/runningpods/").
```
рд╕рднреА рдпрд╣ рджрд┐рдЦрд╛рдИ рджреЗрддреЗ рд╣реИрдВред

рдЖрдк [**Kubeletctl**](https://github.com/cyberark/kubeletctl) рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдк Kubelets рдФрд░ рдЙрдирдХреЗ endpoints рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░ рд╕рдХреЗрдВред

#### /pods

рдЗрд╕ endpoint рдореЗрдВ pods рдФрд░ рдЙрдирдХреЗ containers рдХреА рд╕реВрдЪреА рд╣реЛрддреА рд╣реИ:
```bash
kubeletctl pods
```
#### /exec

рдпрд╣ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХрд┐рд╕реА рднреА рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рдХреЛрдб рдХреЛ рдмрд╣реБрдд рдЖрд╕рд╛рдиреА рд╕реЗ execute рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ:
```bash
kubeletctl exec [command]
```
{% hint style="info" %}
рдЗрд╕ рд╣рдорд▓реЗ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП _**kubelet**_ рд╕реЗрд╡рд╛ рдХреЛ `--anonymous-auth false` рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рд╕реЗрд╡рд╛ рдХреЛ рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрддрд░ рдкрд░ рдЕрд▓рдЧ рдХрд░ рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдПред
{% endhint %}

### **рдХреБрдмрд▓реЗрдЯ (рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рд╡рд╛рд▓рд╛ рдкреЛрд░реНрдЯ) рд╕реВрдЪрдирд╛ рдЙрдЬрд╛рдЧрд░реАрдХрд░рдг рдХреА рдЬрд╛рдБрдЪ**

рдЬрдм рдПрдХ **рдХреБрдмрд▓реЗрдЯ рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рд╡рд╛рд▓рд╛ рдкреЛрд░реНрдЯ** рдЙрдЬрд╛рдЧрд░ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЕрдирдзрд┐рдХреГрдд рдкрдХреНрд╖реЛрдВ рджреНрд╡рд╛рд░рд╛ API рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рдмрди рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕ рдкреЛрд░реНрдЯ рдХреА рдЙрдЬрд╛рдЧрд░реАрдХрд░рдг рд╕реЗ рд╡рд┐рднрд┐рдиреНрди **рдХреНрд▓рд╕реНрдЯрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рддрддреНрд╡реЛрдВ** рдХрд╛ рдЦреБрд▓рд╛рд╕рд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЬрд╛рдирдХрд╛рд░реА, рдЬрд┐рд╕рдореЗрдВ **рдкреЙрдб рдирд╛рдо, рдЖрдВрддрд░рд┐рдХ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рд╕реНрдерд┐рддрд┐рдпрд╛рдБ, рдФрд░ рдЕрдиреНрдп рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди** рд╢рд╛рдорд┐рд▓ рд╣реЛ рд╕рдХрддреА рд╣реИ, рдорд╣рддреНрд╡рдкреВрд░реНрдг рди рд╣реЛ, рд▓реЗрдХрд┐рди рдЗрд╕рдХрд╛ рдЙрдЬрд╛рдЧрд░ рд╣реЛрдирд╛ рдлрд┐рд░ рднреА рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рдЬреЛрдЦрд┐рдо рдкреИрджрд╛ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕рд╕реЗ рдмрдЪрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред

рдЗрд╕ рдХрдордЬреЛрд░реА рдХреЛ рдХреИрд╕реЗ рд╢рд╛рд░реАрд░рд┐рдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдПрдХ рджреВрд░рд╕реНрде рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдпреВрдЖрд░рдПрд▓ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИред `http://<external-IP>:10255/pods` рдкрд░ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░рдХреЗ, рд╣рдорд▓рд╛рд╡рд░ рдХреБрдмрд▓реЗрдЯ рд╕реЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ:

![https://www.cyberark.com/wp-content/uploads/2019/09/KUbe-Pen-2-fig-6.png](https://www.cyberark.com/wp-content/uploads/2019/09/KUbe-Pen-2-fig-6.png)

## рд╕рдВрджрд░реНрдн

{% embed url="https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-2" %}

{% embed url="https://labs.f-secure.com/blog/attacking-kubernetes-through-kubelet" %}

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдФрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
{% endhint %}
