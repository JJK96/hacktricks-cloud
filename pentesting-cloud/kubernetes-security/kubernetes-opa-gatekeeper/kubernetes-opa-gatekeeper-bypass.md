# Kubernetes - OPA Gatekeeper omseil

**Die oorspronklike skrywer van hierdie bladsy is** [**Guillaume**](https://www.linkedin.com/in/guillaume-chapela-ab4b9a196)

## Misbruik van wanconfigurasie

### Enumereer reëls

'n Oorsig kan help om te weet watter reëls aktief is, in watter modus en wie dit kan omseil.

#### Met die CLI
```bash
$ kubectl api-resources | grep gatekeeper
k8smandatoryannotations                                                             constraints.gatekeeper.sh/v1beta1                  false        K8sMandatoryAnnotations
k8smandatorylabels                                                                  constraints.gatekeeper.sh/v1beta1                  false        K8sMandatoryLabel
constrainttemplates                                                                 templates.gatekeeper.sh/v1                         false        ConstraintTemplate
```
**ConstraintTemplate** en **Constraint** kan gebruik word in Open Policy Agent (OPA) Gatekeeper om reëls af te dwing op Kubernetes-bronne.
```bash
$ kubectl get constrainttemplates
$ kubectl get k8smandatorylabels
```
#### Met die GUI

'n Grafiese Gebruikerskoppelvlak mag ook beskikbaar wees om toegang tot die OPA-reëls te verkry met **Gatekeeper-beleidsbestuurder.** Dit is " 'n eenvoudige _slegs-lees_ web-gebruikerskoppelvlak vir die sien van OPA Gatekeeper-beleide se status in 'n Kubernetes-tros."

<figure><img src="../../../.gitbook/assets/05-constraints.png" alt=""><figcaption></figcaption></figure>

Soek na die blootgestelde roete:
```bash
$ kubectl get services -A | grep gatekeeper
$ kubectl get services -A | grep 'gatekeeper-policy-manager-system'
```
### Uitgeslote namespaces

Soos geïllustreer in die boafbelding, mag sekere reëls nie universeel oor alle namespaces of gebruikers toegepas word nie. In plaas daarvan werk hulle op 'n witlys-basis. Byvoorbeeld, die `liveness-probe` beperking is uitgesluit van toepassing op die vyf gespesifiseerde namespaces.

### Oorweging

Met 'n omvattende oorsig van die Gatekeeper-konfigurasie, is dit moontlik om potensiële verkeerde konfigurasies te identifiseer wat uitgebuit kan word om voorregte te verkry. Soek na witgelyste of uitgeslote namespaces waar die reël nie van toepassing is nie, en voer dan jou aanval daar uit.

{% content-ref url="../abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](../abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

## Verwysings

* [https://github.com/open-policy-agent/gatekeeper](https://github.com/open-policy-agent/gatekeeper)
* [https://github.com/sighupio/gatekeeper-policy-manager](https://github.com/sighupio/gatekeeper-policy-manager)
