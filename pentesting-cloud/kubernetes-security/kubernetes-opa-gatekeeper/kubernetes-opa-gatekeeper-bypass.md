# Kubernetes - Παράκαμψη OPA Gatekeeper

**Ο αρχικός συγγραφέας αυτής της σελίδας είναι** [**Guillaume**](https://www.linkedin.com/in/guillaume-c-ab4b9a196/en)

## Κατάχρηση λανθασμένων ρυθμίσεων

### Απαρίθμηση κανόνων

Έχοντας μια επισκόπηση μπορεί να βοηθήσει να γνωρίζουμε ποιοι κανόνες είναι ενεργοί, σε ποια λειτουργία και ποιος μπορεί να τον παρακάμψει.

#### Με το CLI
```bash
$ kubectl api-resources | grep gatekeeper
k8smandatoryannotations                                                             constraints.gatekeeper.sh/v1beta1                  false        K8sMandatoryAnnotations
k8smandatorylabels                                                                  constraints.gatekeeper.sh/v1beta1                  false        K8sMandatoryLabel
constrainttemplates                                                                 templates.gatekeeper.sh/v1                         false        ConstraintTemplate
```
**ConstraintTemplate** και **Constraint** μπορούν να χρησιμοποιηθούν στο Open Policy Agent (OPA) Gatekeeper για την επιβολή κανόνων σε πόρους Kubernetes.
```bash
$ kubectl get constrainttemplates
$ kubectl get k8smandatorylabels
```
#### Με το Γραφικό Περιβάλλον

Ένα Γραφικό Περιβάλλον Χρήστη μπορεί επίσης να είναι διαθέσιμο για πρόσβαση στους κανόνες OPA με το **Gatekeeper Policy Manager.** Είναι "ένα απλό _μόνο για ανάγνωση_ web UI για την προβολή της κατάστασης των πολιτικών OPA Gatekeeper σε ένα Kubernetes Cluster."

<figure><img src="../../../.gitbook/assets/05-constraints.png" alt=""><figcaption></figcaption></figure>

Αναζητήστε την αποκαλυφθείσα διαδρομή:
```bash
$ kubectl get services -A | grep gatekeeper
$ kubectl get services -A | grep 'gatekeeper-policy-manager-system'
```
### Αποκλεισμένα namespaces

Όπως φαίνεται στην εικόνα παραπάνω, ορισμένοι κανόνες ενδέχεται να μην εφαρμόζονται καθολικά σε όλα τα namespaces ή χρήστες. Αντίθετα, λειτουργούν με βάση μια λευκή λίστα. Για παράδειγμα, ο περιορισμός `liveness-probe` εξαιρείται από την εφαρμογή στα πέντε συγκεκριμένα namespaces.

### Παράκαμψη

Με μια σφαιρική επισκόπηση της διαμόρφωσης του Gatekeeper, είναι δυνατόν να αναγνωριστούν πιθανές λανθασμένες ρυθμίσεις που θα μπορούσαν να εκμεταλλευτούν για την απόκτηση προνομίων. Αναζητήστε τα namespaces που έχουν εισαχθεί στη λευκή λίστα ή εξαιρούνται όπου ο κανόνας δεν ισχύει, και στη συνέχεια πραγματοποιήστε την επίθεσή σας εκεί.

{% content-ref url="../abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](../abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

## Αναφορές

* [https://github.com/open-policy-agent/gatekeeper](https://github.com/open-policy-agent/gatekeeper)
* [https://github.com/sighupio/gatekeeper-policy-manager](https://github.com/sighupio/gatekeeper-policy-manager)
