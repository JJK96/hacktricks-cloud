# Kubernetes - OPA Gatekeeper bypass

**Bu sayfanın orijinal yazarı** [**Guillaume**](https://www.linkedin.com/in/guillaume-c-ab4b9a196/en)

## Yanlış yapılandırmayı suiistimal etmek

### Kuralları sıralama

Bir genel bakış, hangi kuralların etkin olduğunu, hangi modda olduğunu ve kimin bunu atlayabileceğini bilmeye yardımcı olabilir.

#### CLI ile
```bash
$ kubectl api-resources | grep gatekeeper
k8smandatoryannotations                                                             constraints.gatekeeper.sh/v1beta1                  false        K8sMandatoryAnnotations
k8smandatorylabels                                                                  constraints.gatekeeper.sh/v1beta1                  false        K8sMandatoryLabel
constrainttemplates                                                                 templates.gatekeeper.sh/v1                         false        ConstraintTemplate
```
**ConstraintTemplate** ve **Constraint**, Kubernetes kaynakları üzerinde kuralları zorlamak için Open Policy Agent (OPA) Gatekeeper'da kullanılabilir.
```bash
$ kubectl get constrainttemplates
$ kubectl get k8smandatorylabels
```
#### Grafik Arayüzü ile

OPA kurallarına **Gatekeeper Policy Manager** ile erişmek için Grafik Kullanıcı Arayüzü de mevcut olabilir. Bu, "Bir Kubernetes Kümesinde OPA Gatekeeper politikalarının durumunu görüntülemek için basit bir _salt okunur_ web arayüzüdür."

<figure><img src="../../../.gitbook/assets/05-constraints.png" alt=""><figcaption></figcaption></figure>

Açığa çıkarılan rotayı arayın:
```bash
$ kubectl get services -A | grep gatekeeper
$ kubectl get services -A | grep 'gatekeeper-policy-manager-system'
```
### Hariç tutulan namespace'ler

Yukarıdaki resimde gösterildiği gibi, belirli kurallar tüm namespace'ler veya kullanıcılar arasında evrensel olarak uygulanmayabilir. Bunun yerine, beyaz liste temelinde çalışırlar. Örneğin, `liveness-probe` kısıtı, beş belirtilen namespace'e uygulanmaktan hariç tutulmuştur.

### Atlatma

Gatekeeper yapılandırmasının kapsamlı bir genel bakışı ile, ayrıcalıklar elde etmek için sömürülebilecek potansiyel yanlış yapılandırmaları tanımlamak mümkündür. Kuralın uygulanmadığı beyaz listelenmiş veya hariç tutulan namespace'leri arayın ve saldırınızı orada gerçekleştirin.

{% content-ref url="../abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](../abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

## Referanslar

* [https://github.com/open-policy-agent/gatekeeper](https://github.com/open-policy-agent/gatekeeper)
* [https://github.com/sighupio/gatekeeper-policy-manager](https://github.com/sighupio/gatekeeper-policy-manager)
