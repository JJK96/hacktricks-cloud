# Kubernetes - Kupitisha mlango wa OPA

**Mwandishi halisi wa ukurasa huu ni** [**Guillaume**](https://www.linkedin.com/in/guillaume-chapela-ab4b9a196)

## Kutumia upangiaji mbaya

### Kuchambua sheria

Kuwa na muhtasari kunaweza kusaidia kujua ni sheria zipi zinazofanya kazi, kwa hali gani na nani anaweza kuzipita.

#### Kwa kutumia CLI
```bash
$ kubectl api-resources | grep gatekeeper
k8smandatoryannotations                                                             constraints.gatekeeper.sh/v1beta1                  false        K8sMandatoryAnnotations
k8smandatorylabels                                                                  constraints.gatekeeper.sh/v1beta1                  false        K8sMandatoryLabel
constrainttemplates                                                                 templates.gatekeeper.sh/v1                         false        ConstraintTemplate
```
**ConstraintTemplate** na **Constraint** zinaweza kutumika katika Open Policy Agent (OPA) Gatekeeper kutekeleza sheria kwenye rasilimali za Kubernetes.
```bash
$ kubectl get constrainttemplates
$ kubectl get k8smandatorylabels
```
#### Kwa GUI

Kiolesura cha Mtumiaji cha Picha kinaweza pia kupatikana kufikia sheria za OPA na **Meneja wa Sera ya Gatekeeper.** Ni "UI ya wavuti ya _soma tu_ ya kuona hali ya sera za OPA Gatekeeper katika Kikundi cha Kubernetes."

<figure><img src="../../../.gitbook/assets/05-constraints.png" alt=""><figcaption></figcaption></figure>

Tafuta njia iliyofichuliwa:
```bash
$ kubectl get services -A | grep gatekeeper
$ kubectl get services -A | grep 'gatekeeper-policy-manager-system'
```
### Majina ya nafasi zilizotengwa

Kama ilivyoonyeshwa kwenye picha hapo juu, baadhi ya sheria huenda zisitumike kwa njia ya kipekee kote kwenye majina ya nafasi au watumiaji. Badala yake, zinafanya kazi kwa msingi wa orodha ya kibali. Kwa mfano, kizuizi cha `liveness-probe` kimeondolewa kutumika kwa majina ya nafasi tano zilizotajwa.

### Kupita

Kwa muhtasari kamili wa usanidi wa Gatekeeper, ni rahisi kutambua upangaji mbaya wa mazingira ambao unaweza kutumiwa kwa faida ya kupata mamlaka. Tafuta majina ya nafasi yaliyoorodheshwa au yaliyotengwa ambapo sheria haiwafai, kisha tekeleza shambulio lako hapo.

{% content-ref url="../abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](../abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

## Marejeo

* [https://github.com/open-policy-agent/gatekeeper](https://github.com/open-policy-agent/gatekeeper)
* [https://github.com/sighupio/gatekeeper-policy-manager](https://github.com/sighupio/gatekeeper-policy-manager)
