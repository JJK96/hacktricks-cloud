---
description: >-
  Cette page montre un scénario d'escalade de privilèges étant donné que tekton est installé dans le cluster et que vous pouvez créer un espace de noms (parfois les droits de modification sont suffisants)
---

# OpenShift - Tekton

**L'auteur original de cette page est** [**Haroun**](www.linkedin.com/in/haroun-al-mounayar-571830211)

### Qu'est-ce que tekton

Selon la documentation : _Tekton est un framework open source puissant et flexible pour créer des systèmes CI/CD, permettant aux développeurs de construire, tester et déployer sur des fournisseurs de cloud et des systèmes sur site._ Jenkins et Tekton peuvent être utilisés pour tester, construire et déployer des applications, cependant Tekton est Cloud Native.&#x20;

Avec Tekton, tout est représenté par des fichiers YAML. Les développeurs peuvent créer des Ressources Personnalisées (CR) de type `Pipelines` et spécifier plusieurs `Tasks` qu'ils souhaitent exécuter. Pour exécuter une ressource Pipeline de type `PipelineRun` doit être créée.

Lorsque tekton est installé, un compte de service (sa) appelé pipeline est créé dans chaque espace de noms. Lorsqu'un Pipeline est exécuté, un pod sera créé en utilisant ce sa appelé `pipeline` pour exécuter les tâches définies dans le fichier YAML.

{% embed url="https://tekton.dev/docs/getting-started/pipelines/" %}
Documentation Tekton sur les Pipelines
{% endembed %}

### Les capacités du compte de service Pipeline

Par défaut, le compte de service pipeline peut utiliser la capacité `pipelines-scc`. Cela est dû à la configuration par défaut globale de tekton. En fait, la configuration globale de tekton est également un fichier YAML dans un objet openshift appelé `TektonConfig` qui peut être consulté si vous avez des rôles de lecteur dans le cluster.
```yaml
apiVersion: operator.tekton.dev/v1alpha1
kind: TektonConfig
metadata:
name: config
spec:
...
...
platforms:
openshift:
scc:
default: "pipelines-scc"
```
### La Mauvaise Configuration

Le problème est que le scc par défaut que le compte de service de pipeline peut utiliser est contrôlable par l'utilisateur. Cela peut être fait en utilisant une étiquette dans la définition de l'espace de noms. Par exemple, si je peux créer un espace de noms avec la définition yaml suivante :
```yaml
apiVersion: v1
kind: Namespace
metadata:
name: test-namespace
annotations:
operator.tekton.dev/scc: privileged
```
L'opérateur Tekton donnera au compte de service de pipeline dans `test-namespace` la capacité d'utiliser le scc privileged. Cela permettra le montage du nœud.

### La solution

Les documents Tekton expliquent comment restreindre le remplacement de scc en ajoutant une étiquette dans l'objet `TektonConfig`.

{% embed url="https://tekton.dev/docs/operator/sccconfig/" %}
Documentation Tekton sur scc
{% endembed %}

Cette étiquette s'appelle `max-allowed`
```yaml
apiVersion: operator.tekton.dev/v1alpha1
kind: TektonConfig
metadata:
name: config
spec:
...
...
platforms:
openshift:
scc:
default: "restricted-v2"
maxAllowed: "privileged"
```

