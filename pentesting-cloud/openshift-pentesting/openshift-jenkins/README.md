# Openshift における Jenkins

**このページの元の著者は** [**Fares**](https://www.linkedin.com/in/fares-siala/)

このページでは、Openshift（またはKubernetes）クラスターで実行されている Jenkins インスタンスを攻撃する方法についていくつかのポインタを示します。

## 免責事項

Jenkins インスタンスは、Openshift または Kubernetes クラスターのいずれにも展開できます。コンテキストに応じて、表示されるペイロード、yaml、またはテクニックを適応する必要があります。Jenkins を攻撃する詳細については、[このページ](../../../pentesting-ci-cd/jenkins-security/README.md)を参照してください。

## 前提条件

1a. Jenkins インスタンスへのユーザーアクセス
または
1b. プッシュ/マージ後に自動ビルドがトリガーされる SCM リポジトリへの書き込み権限を持つユーザーアクセス

## 動作原理

基本的に、裏側で行われるほとんどすべては、VM で実行されている通常の Jenkins インスタンスと同じように機能します。
主な違いは、全体のアーキテクチャとビルドが Openshift（または Kubernetes）クラスター内でどのように管理されるかです。

### ビルド

ビルドがトリガーされると、まず Jenkins マスターノードによって管理/オーケストレーションされ、その後エージェント/スレーブ/ワーカーに委任されます。このコンテキストでは、マスターノードは、ワーカーが実行される場所とは異なる可能性がある名前空間内で実行されている通常のポッドです。ワーカー/スレーブにも同じことが適用されますが、ビルドが終了すると破棄され、マスターは常に稼働し続けます。
通常、ビルドは、Jenkins 管理者によって定義されたデフォルトのポッドテンプレートを使用してポッド内で実行されます。

### ビルドのトリガー

ビルドをトリガーする主な方法は次のとおりです。

1. Jenkins への UI アクセスがある場合

非常に簡単で便利な方法は、既存のビルドの「Replay」機能を使用することです。これにより、以前に実行されたビルドを再生し、Groovy スクリプトを更新できます。これには Jenkins フォルダへの特権と事前定義されたパイプラインが必要です。
ステルス性が必要な場合は、十分な権限があればトリガーされたビルドを削除できます。

2. SCM への書き込みアクセスがあり、自動ビルドが webhook を介して構成されている場合

ビルドスクリプト（Jenkinsfile など）を編集し、コミットしてプッシュするだけです（ビルドが PR マージ時にのみトリガーされる場合は、PR を作成する必要があります）。この経路は非常にノイズが多く、トラックを消すには昇格された特権が必要です。
