# GCP Pentesting

{% hint style="success" %}
AWS Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХреЛ рд╕рдорд░реНрдерди рджреЗрдВ</summary>

* [**subscription plans**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рд╣рдореЗрдВ **Twitter** ЁЯРж рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>
{% endhint %}

## Basic Information

**GCP environment рдХрд╛ pentesting рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ**, рдЖрдкрдХреЛ рдЗрд╕рдХреЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ **рдореВрд▓ рдмрд╛рддреЗрдВ рдЬрд╛рдирдиреА рд╣реЛрдВрдЧреА** рддрд╛рдХрд┐ рдЖрдк рд╕рдордЭ рд╕рдХреЗрдВ рдХрд┐ рдЖрдкрдХреЛ рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ, misconfigurations рдХреЛ рдХреИрд╕реЗ рдвреВрдВрдврдирд╛ рд╣реИ рдФрд░ рдЙрдирдХрд╛ exploit рдХреИрд╕реЗ рдХрд░рдирд╛ рд╣реИред

**organization** hierarchy, **permissions** рдФрд░ рдЕрдиреНрдп рдореВрд▓рднреВрдд рдЕрд╡рдзрд╛рд░рдгрд╛рдУрдВ рдЬреИрд╕реЗ concepts рдХреЛ рд╕рдордЭрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ:

{% content-ref url="gcp-basic-information/" %}
[gcp-basic-information](gcp-basic-information/)
{% endcontent-ref %}

## Labs to learn

* [https://gcpgoat.joshuajebaraj.com/](https://gcpgoat.joshuajebaraj.com/)
* [https://github.com/ine-labs/GCPGoat](https://github.com/ine-labs/GCPGoat)
* [https://github.com/lacioffi/GCP-pentest-lab/](https://github.com/lacioffi/GCP-pentest-lab/)
* [https://github.com/carlospolop/gcp\_privesc\_scripts](https://github.com/carlospolop/gcp\_privesc\_scripts)

## GCP Pentester/Red Team Methodology

GCP environment рдХрд╛ audit рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЬрд╛рдирдирд╛ рдмрд╣реБрдд рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ: рдХреМрди рд╕реЗ **services рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ**, рдХреНрдпрд╛ **exposed** рд╣реЛ рд░рд╣рд╛ рд╣реИ, рдХрд┐рд╕рдХреЗ рдкрд╛рд╕ **access** рд╣реИ, рдФрд░ рдЖрдВрддрд░рд┐рдХ GCP services рдФрд░ **external services** рдХреИрд╕реЗ рдЬреБрдбрд╝реЗ рд╣реБрдП рд╣реИрдВред

Red Team рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, **GCP environment рдХреЛ compromise рдХрд░рдиреЗ рдХрд╛ рдкрд╣рд▓рд╛ рдХрджрдо** рдХреБрдЫ **credentials** рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реИред рдпрд╣рд╛рдВ рдХреБрдЫ рд╡рд┐рдЪрд╛рд░ рджрд┐рдП рдЧрдП рд╣реИрдВ рдХрд┐ рдЗрд╕реЗ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рдП:

* github (рдпрд╛ рд╕рдорд╛рди) рдореЗрдВ **leaks** - OSINT
* **Social** Engineering (рдкреГрд╖реНрда рджреЗрдЦреЗрдВ [**Workspace Security**](../workspace-security/))
* **Password** рдкреБрди: рдЙрдкрдпреЛрдЧ (password leaks)
* GCP-Hosted Applications рдореЗрдВ Vulnerabilities
* [**Server Side Request Forgery**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf) metadata endpoint рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд╕рд╛рде
* **Local File Read**
* `/home/USERNAME/.config/gcloud/*`
* `C:\Users\USERNAME\.config\gcloud\*`
* 3rd parties **breached**
* **Internal** Employee

рдпрд╛ **unauthenticated service** рдХреЛ compromise рдХрд░рдХреЗ рдЬреЛ exposed рд╣реИ:

{% content-ref url="gcp-unaunthenticated-enum-and-access/" %}
[gcp-unaunthenticated-enum-and-access](gcp-unaunthenticated-enum-and-access/)
{% endcontent-ref %}

рдпрд╛ рдпрджрд┐ рдЖрдк **review** рдХрд░ рд░рд╣реЗ рд╣реИрдВ рддреЛ рдЖрдк рдмрд╕ рдЗрди roles рдХреЗ рд╕рд╛рде **credentials** рдорд╛рдВрдЧ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="gcp-permissions-for-a-pentest.md" %}
[gcp-permissions-for-a-pentest.md](gcp-permissions-for-a-pentest.md)
{% endcontent-ref %}

{% hint style="info" %}
рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдк credentials рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ **рд╡реЗ credentials рдХрд┐рд╕рдХреЗ рд╣реИрдВ**, рдФрд░ **рдЙрдирдХреЗ рдкрд╛рд╕ рдХреНрдпрд╛ access рд╣реИ**, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдХреБрдЫ рдмреБрдирд┐рдпрд╛рджреА enumeration рдХрд░рдирд╛ рд╣реЛрдЧрд╛:
{% endhint %}

## Basic Enumeration

### **SSRF**

GCP metadata рдХреЛ **enumerate** рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд hacktricks рдкреГрд╖реНрда рджреЗрдЦреЗрдВ:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Whoami

GCP рдореЗрдВ рдЖрдк рдпрд╣ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рд╡рд┐рдХрд▓реНрдк рдЖрдЬрдорд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЖрдк рдХреМрди рд╣реИрдВ:

{% code overflow="wrap" %}
```bash
#If you are inside a compromise machine
gcloud auth list
curl -H "Content-Type: application/x-www-form-urlencoded" -d "access_token=$(gcloud auth print-access-token)" https://www.googleapis.com/oauth2/v1/tokeninfo
gcloud auth print-identity-token #Get info from the token

#If you compromised a metadata token or somehow found an OAuth token
curl -H "Content-Type: application/x-www-form-urlencoded" -d "access_token=<token>" https://www.googleapis.com/oauth2/v1/tokeninfo
```
### Org Enumeration

{% endcode %}

### Org Enumeration

### рд╕рдВрдЧрдарди рдЧрдгрдирд╛

{% endcode %}
```bash
# Get organizations
gcloud organizations list #The DIRECTORY_CUSTOMER_ID is the Workspace ID
gcloud resource-manager folders list --organization <org_number> # Get folders
gcloud projects list # Get projects
```
### Principals & IAM Enumeration

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ, рддреЛ **GCP рдЦрд╛рддреЗ рдХреЗ рдЕрдВрджрд░ рдкреНрд░рддреНрдпреЗрдХ рдЗрдХрд╛рдИ рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреА рдЬрд╛рдБрдЪ рдХрд░рдирд╛** рдЖрдкрдХреЛ рдпрд╣ рд╕рдордЭрдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ рдХрд┐ рдЖрдк рдФрд░ рдЕрдиреНрдп рдкрд╣рдЪрд╛рдиреЗрдВ рдХреНрдпрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреИрд╕реЗ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ IAM рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдирд╣реАрдВ рд╣реИрдВ, рддреЛ рдЖрдк рдЙрдиреНрд╣реЗрдВ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП **рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред\
**рд╕реВрдЪреАрдХрд░рдг рдФрд░ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕рд┐рдВрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ** рджреЗрдЦреЗрдВ:

{% content-ref url="gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

{% hint style="info" %}
рдЕрдм рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЕрдкрдиреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рдЬрд╛рдирдХрд╛рд░реА рд╣реИ** (рдФрд░ рдпрджрд┐ рдЖрдк рдПрдХ рд░реЗрдб рдЯреАрдо рд╣реИрдВ рддреЛ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рдЖрдк **рдкрддрд╛ рдирд╣реАрдВ рдЪрд▓реЗ рд╣реИрдВ**)ред рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХрд╛ рд╕рдордп рд╣реИ рдХрд┐ рдкрд░реНрдпрд╛рд╡рд░рдг рдореЗрдВ рдХреМрди рд╕реА рд╕реЗрд╡рд╛рдПрдБ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд░рд╣реА рд╣реИрдВред\
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдЖрдк рдХреБрдЫ рд╕рд╛рдорд╛рдиреНрдп рд╕реЗрд╡рд╛рдУрдВ рдХреЛ **рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХреЗ рдХреБрдЫ рддрд░реАрдХреЗ** рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

## Services Enumeration

GCP рдореЗрдВ рд╕реЗрд╡рд╛рдУрдВ рдХреА рдПрдХ рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ рдорд╛рддреНрд░рд╛ рд╣реИ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдкрд░ рдЖрдкрдХреЛ **рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА, рд╕реВрдЪреАрдХрд░рдг** рдЪреАрдЯрд╢реАрдЯреНрд╕, **рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рд╕реЗ рдмрдЪрдиреЗ**, **рд╕реНрдерд╛рдпрд┐рддреНрд╡ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ**, рдФрд░ рдЙрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдиреНрдп **рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди** рдЯреНрд░рд┐рдХреНрд╕ рдорд┐рд▓реЗрдВрдЧреА:

{% content-ref url="gcp-services/" %}
[gcp-services](gcp-services/)
{% endcontent-ref %}

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдкрдХреЛ **рд╕рд╛рд░рд╛ рдХрд╛рдо рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреЗ рдиреАрдЪреЗ рдЖрдк **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ** [**рдПрдХ рдЕрдиреБрднрд╛рдЧ**](./#automatic-tools) рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рдЪрд░рдг рдореЗрдВ рдЖрдкрдиреЗ **рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рд╕реЗрд╡рд╛рдПрдБ рдЙрдЬрд╛рдЧрд░ рдХреА рд╣реЛ рд╕рдХрддреА рд╣реИрдВ**, рдЖрдк рдЙрдиреНрд╣реЗрдВ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="gcp-unaunthenticated-enum-and-access/" %}
[gcp-unaunthenticated-enum-and-access](gcp-unaunthenticated-enum-and-access/)
{% endcontent-ref %}

## Privilege Escalation, Post Exploitation & Persistence

рдХреБрдЫ рдХреНрд▓рд╛рдЙрдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдпрд╛ рдХреНрд▓рд╛рдЙрдб рдХреЗ рдЕрдВрджрд░ рдЪрд▓ рд░рд╣реА рдХрд┐рд╕реА рд╕реЗрд╡рд╛ рд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рд╕рдмрд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рддрд░реАрдХрд╛ **рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдЦрд╛рддреЗ рдХреЗ рдкрд╛рд╕ рд╣реЛ рд╕рдХрдиреЗ рд╡рд╛рд▓реЗ рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛** рд╣реИред рдЗрд╕рд▓рд┐рдП, рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдЖрдкрдХреЛ рдЕрдкрдиреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рд╕реВрдЪреАрдХрд░рдг рдХреЗ рджреМрд░рд╛рди, рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ **рдЕрдиреБрдорддрд┐рдпрд╛рдБ "рд╕рдВрдЧрдарди" рдХреЗ рдЙрдЪреНрдЪрддрдо рд╕реНрддрд░ рдкрд░ рд╕реЗрдЯ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ**ред

{% content-ref url="gcp-privilege-escalation/" %}
[gcp-privilege-escalation](gcp-privilege-escalation/)
{% endcontent-ref %}

{% content-ref url="gcp-post-exploitation/" %}
[gcp-post-exploitation](gcp-post-exploitation/)
{% endcontent-ref %}

{% content-ref url="gcp-persistence/" %}
[gcp-persistence](gcp-persistence/)
{% endcontent-ref %}

### Publicly Exposed Services

GCP рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рддреЗ рд╕рдордп рдЖрдкрдиреЗ рдЙрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдХреЛ **рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рддрддреНрд╡реЛрдВ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рддреЗ рд╣реБрдП** рдкрд╛рдпрд╛ рд╣реЛрдЧрд╛ (VM/Containers рдкреЛрд░реНрдЯреНрд╕, рдбреЗрдЯрд╛рдмреЗрд╕ рдпрд╛ рдХрддрд╛рд░ рд╕реЗрд╡рд╛рдПрдБ, рд╕реНрдиреИрдкрд╢реЙрдЯреНрд╕ рдпрд╛ рдмрдХреЗрдЯреНрд╕...)ред\
рдПрдХ рдкреЗрдВрдЯреЗрд╕реНрдЯрд░/рд░реЗрдб рдЯреАрдорд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЖрдкрдХреЛ рд╣рдореЗрд╢рд╛ рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдЙрдирдореЗрдВ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА / рдХрдордЬреЛрд░рд┐рдпрд╛рдБ** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдЖрдкрдХреЛ **AWS рдЦрд╛рддреЗ рдореЗрдВ рдФрд░ рдЕрдзрд┐рдХ рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

рдЗрд╕ рдкреБрд╕реНрддрдХ рдореЗрдВ рдЖрдкрдХреЛ **рдЙрдЬрд╛рдЧрд░ GCP рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдФрд░ рдЙрдирдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА** рдорд┐рд▓рдиреА рдЪрд╛рд╣рд┐рдПред рдЙрдЬрд╛рдЧрд░ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВ **рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ** рдореИрдВ рдЖрдкрдХреЛ **рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реЗрд╡рд╛** рдХреЗ рд▓рд┐рдП **рдЦреЛрдЬрдиреЗ** рдХреА рд╕рд▓рд╛рд╣ рджреВрдВрдЧрд╛:

{% embed url="https://book.hacktricks.xyz/" %}

## GCP <--> Workspace Pivoting

**рдПрдХ** рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдореЗрдВ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓реНрд╕ рд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд░рдирд╛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **рджреВрд╕рд░реЗ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕реЗ рджреЗрдЦреЗрдВ:

{% content-ref url="gcp-to-workspace-pivoting/" %}
[gcp-to-workspace-pivoting](gcp-to-workspace-pivoting/)
{% endcontent-ref %}

## Automatic Tools

* **GCloud рдХрдВрд╕реЛрд▓** рдореЗрдВ, [https://console.cloud.google.com/iam-admin/asset-inventory/dashboard](https://console.cloud.google.com/iam-admin/asset-inventory/dashboard) рдкрд░ рдЖрдк рдкреНрд░реЛрдЬреЗрдХреНрдЯ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдФрд░ IAMs рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред
* рдпрд╣рд╛рдВ рдЖрдк рдЗрд╕ API рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд рд╕рдВрдкрддреНрддрд┐рдпреЛрдВ рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: [https://cloud.google.com/asset-inventory/docs/supported-asset-types](https://cloud.google.com/asset-inventory/docs/supported-asset-types)
* **рдЙрдкрдХрд░рдгреЛрдВ** рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдЬреЛ [**рдХрдИ рдХреНрд▓рд╛рдЙрдбреНрд╕ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ**](../pentesting-cloud-methodology.md)ред
* [**gcp\_scanner**](https://github.com/google/gcp\_scanner): рдпрд╣ рдПрдХ GCP рд╕рдВрд╕рд╛рдзрди рд╕реНрдХреИрдирд░ рд╣реИ рдЬреЛ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ GCP рдкрд░ рдХреБрдЫ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рдкрд╛рд╕ рдХрд┐рд╕ рд╕реНрддрд░ рдХреА рдкрд╣реБрдВрдЪ рд╣реИред
```bash
# Install
git clone https://github.com/google/gcp_scanner.git
cd gcp_scanner
virtualenv -p python3 venv
source venv/bin/activate
pip install -r requirements.txt
# Execute with gcloud creds
python3 __main__.py -o /tmp/output/ -g "$HOME/.config/gcloud"
```
* [**gcp\_enum**](https://gitlab.com/gitlab-com/gl-security/threatmanagement/redteam/redteam-public/gcp\_enum): gcloud cli рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ GCP рд╡рд╛рддрд╛рд╡рд░рдг рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдФрд░ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рд╣реЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП Bash рд╕реНрдХреНрд░рд┐рдкреНрдЯред
* [**GCP-IAM-Privilege-Escalation**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation): рдЙрдЪреНрдЪ IAM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдФрд░ GCP рдореЗрдВ рдЙрдирдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдХреНрд░рд┐рдкреНрдЯ (рдореИрдВ рд╕реВрдЪреАрдмрджреНрдз рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдЪрд▓рд╛ рдирд╣реАрдВ рд╕рдХрд╛)ред
* [**BF My GCP Permissions**](https://github.com/carlospolop/bf\_my\_gcp\_permissions): рдЖрдкрдХреЗ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдмреНрд░реВрдЯрдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдХреНрд░рд┐рдкреНрдЯред

## gcloud config & debug
```bash
# Login so gcloud can use your credentials
gcloud auth login
gcloud config set project security-devbox
gcloud auth print-access-token

# Login so SDKs can use your user credentials
gcloud auth application-default login
gcloud auth application-default set-quota-project security-devbox
gcloud auth application-default print-access-token

# Update gcloud
gcloud components update
```
### gcloud, gsutil... рдиреЗрдЯрд╡рд░реНрдХ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдВ

рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдЖрдк **`gcloud`** cli рдХреЗ рд╕рд╛рде **`--log-http`** **parameter** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **requests** рдХреЛ **print** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЯреВрд▓ рдХрд░ рд░рд╣рд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдирд╣реАрдВ рдЪрд╛рд╣рддреЗ рдХрд┐ рд▓реЙрдЧреНрд╕ рдЯреЛрдХрди рдорд╛рди рдХреЛ рд╣рдЯрд╛ рджреЗрдВ, рддреЛ `gcloud config set log_http_redact_token false` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕рдВрдЪрд╛рд░ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:
```bash
gcloud config set proxy/address 127.0.0.1
gcloud config set proxy/port 8080
gcloud config set proxy/type http
gcloud config set auth/disable_ssl_validation True

# If you don't want to completely disable ssl_validation use:
gcloud config set core/custom_ca_certs_file cert.pem

# Back to normal
gcloud config unset proxy/address
gcloud config unset proxy/port
gcloud config unset proxy/type
gcloud config unset auth/disable_ssl_validation
gcloud config unset core/custom_ca_certs_file
```
### OAuth token рдХреЛ gcloud рдореЗрдВ configure рдХрд░рдирд╛

**metadata endpoint рд╕реЗ exfiltrated service account OAuth token рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдЖрдк рдмрд╕ рдпрд╣ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
# Via env vars
export CLOUDSDK_AUTH_ACCESS_TOKEN=<token>
gcloud projects list

# Via setup
echo "<token>" > /some/path/to/token
gcloud config set auth/access_token_file /some/path/to/token
gcloud projects list
gcloud config unset auth/access_token_file
```
## рд╕рдВрджрд░реНрдн

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)

{% hint style="success" %}
AWS Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХреЛ рд╕рдорд░реНрдерди рджреЗрдВ</summary>

* [**subscription plans**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рд╣рдореЗрдВ **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВред**
* **PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>
{% endhint %}
