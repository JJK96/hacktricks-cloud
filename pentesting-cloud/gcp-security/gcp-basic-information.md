# GCP - Basic Information

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* Schau dir die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop) an!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## **Ressourcenhierarchie**

Google Cloud verwendet eine [Ressourcenhierarchie](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy), die konzeptionell der eines traditionellen Dateisystems √§hnelt. Dies bietet einen logischen Eltern/Kind-Workflow mit spezifischen Ankn√ºpfungspunkten f√ºr Richtlinien und Berechtigungen.

Auf hoher Ebene sieht es so aus:
```
Organization
--> Folders
--> Projects
--> Resources
```
Eine virtuelle Maschine (genannt Compute Instance) ist eine Ressource. Eine Ressource befindet sich in einem Projekt, wahrscheinlich zusammen mit anderen Compute Instances, Speicher-Buckets usw.

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption><p><a href="https://cloud.google.com/static/resource-manager/img/cloud-hierarchy.svg">https://cloud.google.com/static/resource-manager/img/cloud-hierarchy.svg</a></p></figcaption></figure>

## **Projekte Migration**

Es ist m√∂glich, **ein Projekt ohne Organisation** mit den Berechtigungen `roles/resourcemanager.projectCreator` und `roles/resourcemanager.projectMover` in eine Organisation zu migrieren. Wenn sich das Projekt in einer anderen Organisation befindet, muss der GCP-Support kontaktiert werden, um **es zuerst aus der Organisation zu entfernen**. Weitere Informationen finden Sie [**hier**](https://medium.com/google-cloud/migrating-a-project-from-one-organization-to-another-gcp-4b37a86dd9e6).

## **Organisationsrichtlinien**

Erm√∂glichen die zentrale Kontrolle √ºber die Cloud-Ressourcen Ihrer Organisation:

* Zentrale Kontrolle zur **Konfiguration von Einschr√§nkungen**, wie die Ressourcen Ihrer Organisation verwendet werden k√∂nnen.
* Definieren und etablieren Sie **Leitplanken** f√ºr Ihre Entwicklungsteams, um innerhalb der Compliance-Grenzen zu bleiben.
* Helfen Sie Projektbesitzern und ihren Teams, sich schnell zu bewegen, ohne sich Sorgen machen zu m√ºssen, die Compliance zu brechen.

Diese Richtlinien k√∂nnen erstellt werden, um **die gesamte Organisation, Ordner oder Projekte** zu betreffen. Nachkommen des Zielressourcen-Hierarchieknotens **erben die Organisationsrichtlinie**.

Um eine Organisationsrichtlinie zu **definieren**, **w√§hlen Sie eine** [**Einschr√§nkung**](https://cloud.google.com/resource-manager/docs/organization-policy/overview#constraints), die eine bestimmte Art von Einschr√§nkung gegen einen Google Cloud-Dienst oder eine Gruppe von Google Cloud-Diensten ist. Sie **konfigurieren diese Einschr√§nkung mit Ihren gew√ºnschten Beschr√§nkungen**.

<figure><img src="../../.gitbook/assets/image (5) (4).png" alt=""><figcaption><p><a href="https://cloud.google.com/resource-manager/img/org-policy-concepts.svg">https://cloud.google.com/resource-manager/img/org-policy-concepts.svg</a></p></figcaption></figure>

#### H√§ufige Anwendungsf√§lle <a href="#common_use_cases" id="common_use_cases"></a>

* Begrenzen Sie die Ressourcenteilung basierend auf der Domain.
* Begrenzen Sie die Nutzung von Identity and Access Management-Dienstkonten.
* Beschr√§nken Sie den physischen Standort neu erstellter Ressourcen.
* Deaktivieren Sie die Erstellung von Dienstkonten.

<figure><img src="../../.gitbook/assets/image (83).png" alt=""><figcaption></figcaption></figure>

Es gibt viele weitere Einschr√§nkungen, die Ihnen eine feink√∂rnige Kontrolle √ºber die Ressourcen Ihrer Organisation geben. F√ºr **weitere Informationen siehe die** [**Liste aller Organisation Policy Service-Einschr√§nkungen**](https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints)**.**

### **Standard-Organisationsrichtlinien**

<details>

<summary>Dies sind die Richtlinien, die Google standardm√§√üig beim Einrichten Ihrer GCP-Organisation hinzuf√ºgt:</summary>

**Zugriffsmanagement-Richtlinien**

* **Domain-beschr√§nkte Kontakte:** Verhindert das Hinzuf√ºgen von Benutzern zu Essential Contacts au√üerhalb Ihrer angegebenen Domains. Dies beschr√§nkt Essential Contacts darauf, nur verwaltete Benutzeridentit√§ten in Ihren ausgew√§hlten Domains zuzulassen, um Plattformbenachrichtigungen zu erhalten.
* **Domain-beschr√§nkte Freigabe:** Verhindert das Hinzuf√ºgen von Benutzern zu IAM-Richtlinien au√üerhalb Ihrer angegebenen Domains. Dies beschr√§nkt IAM-Richtlinien darauf, nur verwaltete Benutzeridentit√§ten in Ihren ausgew√§hlten Domains den Zugriff auf Ressourcen innerhalb dieser Organisation zu erm√∂glichen.
* **√ñffentlicher Zugriff verhindern:** Verhindert, dass Cloud Storage-Buckets der √ñffentlichkeit zug√§nglich gemacht werden. Dies stellt sicher, dass ein Entwickler Cloud Storage-Buckets nicht so konfigurieren kann, dass sie unautentifizierten Internetzugriff haben.
* **Einheitlicher Bucket-Zugriff:** Verhindert objektbasierte Zugriffskontrolllisten (ACLs) in Cloud Storage-Buckets. Dies vereinfacht Ihr Zugriffsmanagement, indem IAM-Richtlinien konsistent auf alle Objekte in Cloud Storage-Buckets angewendet werden.
* **OS-Login erforderlich:** VMs, die in neuen Projekten erstellt werden, haben OS Login aktiviert. Dies erm√∂glicht Ihnen die Verwaltung des SSH-Zugriffs auf Ihre Instanzen mithilfe von IAM, ohne dass Sie einzelne SSH-Schl√ºssel erstellen und verwalten m√ºssen.

**Zus√§tzliche Sicherheitsrichtlinien f√ºr Dienstkonten**

* **Automatische IAM-Zuweisungen deaktivieren:** Verhindert, dass die Standard-App Engine- und Compute Engine-Dienstkonten automatisch die Editor-IAM-Rolle f√ºr ein Projekt bei der Erstellung erhalten. Dies stellt sicher, dass Dienstkonten bei der Erstellung keine √ºberm√§√üig permissiven IAM-Rollen erhalten.
* **Erstellung von Dienstkontoschl√ºsseln deaktivieren:** Verhindert die Erstellung √∂ffentlicher Dienstkontoschl√ºssel. Dies hilft, das Risiko der Offenlegung persistenter Anmeldeinformationen zu verringern.
* **Hochladen von Dienstkontoschl√ºsseln deaktivieren:** Verhindert das Hochladen √∂ffentlicher Dienstkontoschl√ºssel. Dies hilft, das Risiko von geleakten oder wiederverwendeten Schl√ºsselmaterialien zu verringern.

**Sichere VPC-Netzwerkkonfigurationsrichtlinien**

* **Definieren Sie erlaubte externe IPs f√ºr VM-Instanzen:** Verhindert die Erstellung von Compute-Instanzen mit einer √∂ffentlichen IP, die sie dem Internetverkehr aussetzen kann.

<!---->

* **Deaktivieren Sie die verschachtelte Virtualisierung von VMs:** Verhindert die Erstellung verschachtelter VMs auf Compute Engine-VMs. Dies verringert das Sicherheitsrisiko un√ºberwachter verschachtelter VMs.

<!---->

* **Deaktivieren Sie den VM-Serienport:** Verhindert den Zugriff auf den Serienport von Compute Engine-VMs. Dies verhindert die Eingabe an den Serienport eines Servers √ºber die Compute Engine-API.

<!---->

* **Beschr√§nken Sie autorisierte Netzwerke auf Cloud SQL-Instanzen:** Verhindert den Zugriff √∂ffentlicher oder nicht interner Netzbereiche auf Ihre Cloud SQL-Datenbanken.

<!---->

* **Beschr√§nken Sie das Protokoll-Forwarding basierend auf der Art der IP-Adresse:** Verhindert das Protokoll-Forwarding von VMs f√ºr externe IP-Adressen.

<!---->

* **Beschr√§nken Sie den √∂ffentlichen IP-Zugriff auf Cloud SQL-Instanzen:** Verhindert die Erstellung von Cloud SQL-Instanzen mit einer √∂ffentlichen IP, die sie dem Internetverkehr aussetzen kann.

<!---->

* **Beschr√§nken Sie die Entfernung von Shared VPC-Projektverbindungen:** Verhindert das versehentliche L√∂schen von Shared VPC-Hostprojekten.

<!---->

* **Setzt die interne DNS-Einstellung f√ºr neue Projekte auf nur zonales DNS:** Verhindert die Verwendung einer veralteten DNS-Einstellung, die eine verringerte Dienstverf√ºgbarkeit hat.

<!---->

* **Standardnetzwerk-Erstellung √ºberspringen:** Verhindert die automatische Erstellung des Standard-VPC-Netzwerks und verwandter Ressourcen. Dies vermeidet √ºberm√§√üig permissive Standard-Firewallregeln.

<!---->

* **Deaktivieren Sie die externe IPv6-Nutzung von VPC:** Verhindert die Erstellung externer IPv6-Subnetze, die unbefugtem Internetzugriff ausgesetzt sein k√∂nnen.

</details>

## **IAM-Rollen**

Diese sind wie IAM-Richtlinien in AWS, da **jede Rolle eine Reihe von Berechtigungen enth√§lt.**

Im Gegensatz zu AWS gibt es jedoch **kein zentrales Repository** f√ºr Rollen. Stattdessen **geben Ressourcen X Zugriffsrollen an Y-Prinzipale**, und der einzige Weg, um herauszufinden, wer Zugriff auf eine Ressource hat, ist die Verwendung der **`get-iam-policy`-Methode √ºber diese Ressource**.\
Dies k√∂nnte ein Problem sein, da dies bedeutet, dass der einzige Weg, um herauszufinden, **welche Berechtigungen ein Prinzipal hat, darin besteht, jede Ressource zu fragen, wem sie Berechtigungen erteilt**, und ein Benutzer m√∂glicherweise keine Berechtigungen hat, um Berechtigungen von allen Ressourcen zu erhalten.

Es gibt **drei Arten** von Rollen in IAM:

* **Basis-/Primitive Rollen**, die die **Owner**, **Editor** und **Viewer**-Rollen umfassen, die vor der Einf√ºhrung von IAM existierten.
* **Vordefinierte Rollen**, die granulare Zugriffe f√ºr einen bestimmten Dienst bieten und von Google Cloud verwaltet werden. Es gibt viele vordefinierte Rollen, Sie k√∂nnen **alle mit den Privilegien, die sie haben, hier sehen** [**hier**](https://cloud.google.com/iam/docs/understanding-roles#predefined\_roles).
* **Benutzerdefinierte Rollen**, die granulare Zugriffe gem√§√ü einer vom Benutzer festgelegten Liste von Berechtigungen bieten.

Es gibt Tausende von Berechtigungen in GCP. Um zu √ºberpr√ºfen, ob eine Rolle eine Berechtigung hat, k√∂nnen Sie [**die Berechtigung hier suchen**](https://cloud.google.com/iam/docs/permissions-reference) und sehen, welche Rollen sie haben.

Sie k√∂nnen auch [**hier vordefinierte Rollen suchen**](https://cloud.google.com/iam/docs/understanding-roles#product\_specific\_documentation) **, die von jedem Produkt angeboten werden.** Beachten Sie, dass einige **Rollen** nicht an Benutzer angeh√§ngt werden k√∂nnen und **nur an SAs, weil einige Berechtigungen** sie enthalten.\
Beachten Sie au√üerdem, dass **Berechtigungen** nur **wirksam werden**, wenn sie **an den relevanten Dienst angeh√§ngt sind.**

Oder √ºberpr√ºfen Sie, ob eine **benutzerdefinierte Rolle eine** [**spezifische Berechtigung hier verwenden kann**](https://cloud.google.com/iam/docs/custom-roles-permissions-support)**.**

{% content-ref url="gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

## Benutzer <a href="#default-credentials" id="default-credentials"></a>

In der **GCP-Konsole** gibt es **keine Benutzer- oder Gruppenverwaltung**, dies wird in **Google Workspace** erledigt. Obwohl Sie einen anderen Identit√§tsanbieter in Google Workspace synchronisieren k√∂nnten.

Sie k√∂nnen auf Workspaces **Benutzer und Gruppen zugreifen unter** [**https://admin.google.com**](https://admin.google.com/).

**MFA** kann **f√ºr Workspaces-Benutzer erzwungen werden**, jedoch k√∂nnte ein **Angreifer** ein Token verwenden, um auf GCP **√ºber CLI zuzugreifen, das nicht durch MFA gesch√ºtzt ist** (es wird nur durch MFA gesch√ºtzt, wenn sich der Benutzer anmeldet, um es zu generieren: `gcloud auth login`).

## Gruppen

Wenn eine Organisation erstellt wird, wird dringend empfohlen, mehrere Gruppen zu erstellen. Wenn Sie eine von ihnen verwalten, k√∂nnten Sie die gesamte oder einen wichtigen Teil der Organisation kompromittiert haben:

<table data-header-hidden><thead><tr><th width="299.3076923076923"></th><th></th></tr></thead><tbody><tr><td><strong>Gruppe</strong></td><td><strong>Funktion</strong></td></tr><tr><td><strong><code>gcp-organization-admins</code></strong><br><em>(Gruppe oder individuelle Konten erforderlich f√ºr die Checkliste)</em></td><td>Verwaltung aller Ressourcen, die zur Organisation geh√∂ren. Weisen Sie diese Rolle sparsam zu; Organisationsadministratoren haben Zugriff auf alle Ihre Google Cloud-Ressourcen. Alternativ, da diese Funktion hoch privilegiert ist, sollten Sie in Erw√§gung ziehen, individuelle Konten anstelle der Erstellung einer Gruppe zu verwenden.</td></tr><tr><td><strong><code>gcp-network-admins</code></strong><br><em>(erforderlich f√ºr die Checkliste)</em></td><td>Erstellung von Netzwerken, Subnetzen, Firewall-Regeln und Netzwerkger√§ten wie Cloud Router, Cloud VPN und Cloud Load Balancers.</td></tr><tr><td><strong><code>gcp-billing-admins</code></strong><br><em>(erforderlich f√ºr die Checkliste)</em></td><td>Einrichtung von Abrechnungskonten und √úberwachung ihrer Nutzung.</td></tr><tr><td><strong><code>gcp-developers</code></strong><br><em>(erforderlich f√ºr die Checkliste)</em></td><td>Entwurf, Codierung und Testen von Anwendungen.</td></tr><tr><td><strong><code>gcp-security-admins</code></strong><br></td><td>Einrichtung und Verwaltung von Sicherheitsrichtlinien f√ºr die gesamte Organisation, einschlie√ülich Zugriffsmanagement und <a href="https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints">Organisationsbeschr√§nkungsrichtlinien</a>. Weitere Informationen zur Planung Ihrer Google Cloud-Sicherheitsinfrastruktur finden Sie im <a href="https://cloud.google.com/architecture/security-foundations/authentication-authorization#users_and_groups">Google Cloud-Sicherheitsgrundlagen-Leitfaden</a>.</td></tr><tr><td><strong><code>gcp-devops</code></strong></td><td>Erstellung oder Verwaltung von End-to-End-Pipelines, die Continuous Integration und Delivery, √úberwachung und Systembereitstellung unterst√ºtzen.</td></tr><tr><td><strong><code>gcp-logging-admins</code></strong></td><td></td></tr><tr><td><strong><code>gcp-logging-viewers</code></strong></td><td></td></tr><tr><td><strong><code>gcp-monitor-admins</code></strong></td><td></td></tr><tr><td><strong><code>gcp-billing-viewer</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>√úberwachung der Ausgaben f√ºr Projekte. Typische Mitglieder sind Teil des Finanzteams.</td></tr><tr><td><strong><code>gcp-platform-viewer</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>√úberpr√ºfung von Ressourceninformationen in der Google Cloud-Organisation.</td></tr><tr><td><strong><code>gcp-security-reviewer</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>√úberpr√ºfung der Cloud-Sicherheit.</td></tr><tr><td><strong><code>gcp-network-viewer</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>√úberpr√ºfung der Netzwerkkonfigurationen.</td></tr><tr><td><strong><code>grp-gcp-audit-viewer</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>Ansicht von Audit-Logs.</td></tr><tr><td><strong><code>gcp-scc-admin</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>Verwaltung des Security Command Centers.</td></tr><tr><td><strong><code>gcp-secrets-admin</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>Verwaltung von Geheimnissen im Secret Manager.</td></tr></tbody></table>

## **Standard-Passwortrichtlinie**

* Erzwingen Sie starke Passw√∂rter
* Zwischen 8 und 100 Zeichen
* Keine Wiederverwendung
* Kein Ablaufdatum
* Wenn Personen √ºber einen Drittanbieter auf Workspace zugreifen, gelten diese Anforderungen nicht.

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (2) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## **Dienstkonten**

Dies sind die Prinzipale, die **Ressourcen** **angeh√§ngt** haben k√∂nnen und Zugriff haben, um einfach mit GCP zu interagieren. Zum Beispiel ist es m√∂glich, auf das **Auth-Token** eines Dienstkontos **zu zugreifen, das an eine VM** in den Metadaten angeh√§ngt ist.\
Es ist m√∂glich, auf einige **Konflikte** zu sto√üen, wenn sowohl **IAM als auch Zugriffsumf√§nge** verwendet werden. Zum Beispiel kann Ihr Dienstkonto die IAM-Rolle `compute.instanceAdmin` haben, aber die Instanz, die Sie kompromittiert haben, wurde mit der Umfangsbeschr√§nkung von `https://www.googleapis.com/auth/compute.readonly` eingeschr√§nkt. Dies w√ºrde verhindern, dass Sie √Ñnderungen mit dem OAuth-Token vornehmen, das Ihrer Instanz automatisch zugewiesen wird.

Es ist √§hnlich wie **IAM-Rollen von AWS**. Aber im Gegensatz zu AWS kann **jedes** Dienstkonto **an jeden Dienst** angeh√§ngt werden (es muss dies nicht √ºber eine Richtlinie erlauben).

Mehrere der Dienstkonten, die Sie finden werden, werden tats√§chlich **automatisch von GCP generiert**, wenn Sie einen Dienst zu verwenden beginnen, wie:
```
PROJECT_NUMBER-compute@developer.gserviceaccount.com
PROJECT_ID@appspot.gserviceaccount.com
```
Es ist jedoch auch m√∂glich, **benutzerdefinierte Dienstkonten** zu erstellen und an Ressourcen anzuh√§ngen, die so aussehen:
```
SERVICE_ACCOUNT_NAME@PROJECT_NAME.iam.gserviceaccount.com
```
### **Access scopes**

Access scopes sind **an generierte OAuth-Tokens angeh√§ngt**, um auf die GCP-API-Endpunkte zuzugreifen. Sie **beschr√§nken die Berechtigungen** des OAuth-Tokens.\
Das bedeutet, dass wenn ein Token einem Besitzer einer Ressource geh√∂rt, aber nicht den entsprechenden Scope im Token hat, um auf diese Ressource zuzugreifen, das Token **nicht verwendet werden kann, um diese Privilegien (aus)zu nutzen**.

Google [empfiehlt](https://cloud.google.com/compute/docs/access/service-accounts#service\_account\_permissions) tats√§chlich, dass **Access Scopes nicht verwendet werden und vollst√§ndig auf IAM vertraut wird**. Das Web-Management-Portal erzwingt dies tats√§chlich, aber Access Scopes k√∂nnen weiterhin programmgesteuert auf Instanzen mit benutzerdefinierten Servicekonten angewendet werden.

Sie k√∂nnen sehen, welche **Scopes** **zugewiesen** sind, indem Sie **abfragen:**

{% code overflow="wrap" %}
```bash
curl 'https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=<access_token>'

{
"issued_to": "223044615559.apps.googleusercontent.com",
"audience": "223044615559.apps.googleusercontent.com",
"user_id": "139746512919298469201",
"scope": "openid https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/appengine.admin https://www.googleapis.com/auth/sqlservice.login https://www.googleapis.com/auth/compute https://www.googleapis.com/auth/accounts.reauth",
"expires_in": 2253,
"email": "username@testing.com",
"verified_email": true,
"access_type": "offline"
}
```
{% endcode %}

Die vorherigen **Scopes** sind die, die **standardm√§√üig** mit **`gcloud`** generiert werden, um auf Daten zuzugreifen. Dies liegt daran, dass Sie bei der Verwendung von **`gcloud`** zuerst ein OAuth-Token erstellen und dieses dann verwenden, um die Endpunkte zu kontaktieren.

Der wichtigste Scope davon ist potenziell **`cloud-platform`**, was im Wesentlichen bedeutet, dass es m√∂glich ist, **auf jeden Dienst in GCP zuzugreifen**.

Sie k√∂nnen **eine Liste aller m√∂glichen Scopes** [**hier finden**](https://developers.google.com/identity/protocols/googlescopes)**.**

Wenn Sie **`gcloud`**-Browser-Anmeldeinformationen haben, ist es m√∂glich, **ein Token mit anderen Scopes zu erhalten**, indem Sie etwas wie:

{% code overflow="wrap" %}
```bash
# Maybe you can get a user token with other scopes changing the scopes array from ~/.config/gcloud/credentials.db

# Set new scopes for SDKs credentials
gcloud auth application-default login --scopes=https://www.googleapis.com/auth/userinfo.email,https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/sqlservice.login,https://www.googleapis.com/auth/appengine.admin,https://www.googleapis.com/auth/compute,https://www.googleapis.com/auth/accounts.reauth,https://www.googleapis.com/auth/admin.directory.user,https://www.googleapis.com/auth/admin.directory.group,https://www.googleapis.com/auth/admin.directory.domain,https://www.googleapis.com/auth/admin.directory.user

# Print new token
gcloud auth application-default print-access-token

# To use this token with some API you might need to use curl to indicate the project header with --header "X-Goog-User-Project: <project-name>"
```
{% endcode %}

## **Terraform IAM Policies, Bindings und Memberships**

Wie von terraform definiert in [https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam) gibt es verschiedene M√∂glichkeiten, einem Principal mit terraform in GCP Zugriff auf eine Ressource zu gew√§hren:

* **Memberships**: Sie setzen **Principals als Mitglieder von Rollen** **ohne Einschr√§nkungen** √ºber die Rolle oder die Principals. Sie k√∂nnen einen Benutzer als Mitglied einer Rolle setzen und dann eine Gruppe als Mitglied derselben Rolle setzen und auch diese Principals (Benutzer und Gruppe) als Mitglieder anderer Rollen setzen.
* **Bindings**: Mehrere **Principals k√∂nnen an eine Rolle gebunden werden**. Diese **Principals k√∂nnen weiterhin an andere Rollen gebunden oder Mitglieder anderer Rollen sein**. Wenn jedoch ein Principal, der nicht an die Rolle gebunden ist, als **Mitglied einer gebundenen Rolle** gesetzt wird, verschwindet die **Mitgliedschaft beim n√§chsten Anwenden der Bindung**.
* **Policies**: Eine Policy ist **autoritativ**, sie gibt Rollen und Principals an und dann k√∂nnen **diese Principals keine weiteren Rollen und diese Rollen keine weiteren Principals haben**, es sei denn, diese Policy wird ge√§ndert (nicht einmal in anderen Policies, Bindings oder Memberships). Daher sind, wenn eine Rolle oder ein Principal in der Policy angegeben ist, alle seine Privilegien **durch diese Policy eingeschr√§nkt**. Offensichtlich kann dies umgangen werden, wenn dem Principal die M√∂glichkeit gegeben wird, die Policy zu √§ndern oder Berechtigungen zur Privilegieneskalation (wie das Erstellen eines neuen Principals und das Binden einer neuen Rolle) zu erhalten.

## Referenzen

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)
* [https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy)

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
