# GCP - Βασικές Πληροφορίες

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Δείτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Γίνετε μέλος της** 💬 [**ομάδας Discord**](https://discord.gg/hRep4RUj7f) ή της [**ομάδας telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}

## **Ιεραρχία Πόρων**

Το Google Cloud χρησιμοποιεί μια [Ιεραρχία Πόρων](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy) που είναι παρόμοια, εννοιολογικά, με αυτή ενός παραδοσιακού συστήματος αρχείων. Αυτό παρέχει μια λογική ροή εργασίας γονέα/παιδιού με συγκεκριμένα σημεία προσάρτησης για πολιτικές και δικαιώματα.

Σε υψηλό επίπεδο, μοιάζει με αυτό:
```
Organization
--> Folders
--> Projects
--> Resources
```
Μια εικονική μηχανή (ονομάζεται Compute Instance) είναι ένας πόρος. Ένας πόρος βρίσκεται σε ένα project, πιθανώς μαζί με άλλες Compute Instances, storage buckets, κ.λπ.

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption><p><a href="https://cloud.google.com/static/resource-manager/img/cloud-hierarchy.svg">https://cloud.google.com/static/resource-manager/img/cloud-hierarchy.svg</a></p></figcaption></figure>

## **Μεταφορά Projects**

Είναι δυνατό να **μεταφέρετε ένα project χωρίς καμία οργάνωση** σε μια οργάνωση με τα δικαιώματα `roles/resourcemanager.projectCreator` και `roles/resourcemanager.projectMover`. Αν το project είναι μέσα σε άλλη οργάνωση, χρειάζεται να επικοινωνήσετε με την υποστήριξη του GCP για να **το μετακινήσετε πρώτα έξω από την οργάνωση**. Για περισσότερες πληροφορίες δείτε [**εδώ**](https://medium.com/google-cloud/migrating-a-project-from-one-organization-to-another-gcp-4b37a86dd9e6).

## **Πολιτικές Οργάνωσης**

Επιτρέπουν την κεντρικοποίηση του ελέγχου των πόρων cloud της οργάνωσής σας:

* Κεντρικοποίηση του ελέγχου για να **διαμορφώσετε περιορισμούς** στο πώς μπορούν να χρησιμοποιηθούν οι πόροι της οργάνωσής σας.
* Ορισμός και καθιέρωση **οδηγιών** για τις ομάδες ανάπτυξης ώστε να παραμένουν εντός των ορίων συμμόρφωσης.
* Βοήθεια στους ιδιοκτήτες των projects και τις ομάδες τους να κινούνται γρήγορα χωρίς να ανησυχούν για παραβίαση της συμμόρφωσης.

Αυτές οι πολιτικές μπορούν να δημιουργηθούν για να **επηρεάσουν ολόκληρη την οργάνωση, φάκελο(ους) ή project(s)**. Οι απόγονοι του στοχευμένου κόμβου ιεραρχίας πόρων **κληρονομούν την πολιτική οργάνωσης**.

Για να **ορίσετε** μια πολιτική οργάνωσης, **επιλέγετε έναν** [**περιορισμό**](https://cloud.google.com/resource-manager/docs/organization-policy/overview#constraints), ο οποίος είναι ένας συγκεκριμένος τύπος περιορισμού είτε σε μια υπηρεσία Google Cloud είτε σε μια ομάδα υπηρεσιών Google Cloud. **Διαμορφώνετε αυτόν τον περιορισμό με τους επιθυμητούς περιορισμούς σας**.

<figure><img src="../../.gitbook/assets/image (5) (4).png" alt=""><figcaption><p><a href="https://cloud.google.com/resource-manager/img/org-policy-concepts.svg">https://cloud.google.com/resource-manager/img/org-policy-concepts.svg</a></p></figcaption></figure>

#### Κοινές περιπτώσεις χρήσης <a href="#common_use_cases" id="common_use_cases"></a>

* Περιορισμός κοινής χρήσης πόρων βάσει τομέα.
* Περιορισμός χρήσης λογαριασμών υπηρεσιών Identity and Access Management.
* Περιορισμός της φυσικής τοποθεσίας των νεοδημιουργημένων πόρων.
* Απενεργοποίηση δημιουργίας λογαριασμών υπηρεσιών.

<figure><img src="../../.gitbook/assets/image (83).png" alt=""><figcaption></figcaption></figure>

Υπάρχουν πολλοί άλλοι περιορισμοί που σας δίνουν λεπτομερή έλεγχο των πόρων της οργάνωσής σας. Για **περισσότερες πληροφορίες, δείτε τη** [**λίστα όλων των περιορισμών της Υπηρεσίας Πολιτικής Οργάνωσης**](https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints)**.**

### **Προεπιλεγμένες Πολιτικές Οργάνωσης**

<details>

<summary>Αυτές είναι οι πολιτικές που θα προσθέσει η Google από προεπιλογή κατά τη ρύθμιση της οργάνωσης GCP σας:</summary>

**Πολιτικές Διαχείρισης Πρόσβασης**

* **Περιορισμένες επαφές τομέα:** Αποτρέπει την προσθήκη χρηστών στις Essential Contacts εκτός των καθορισμένων τομέων σας. Αυτό περιορίζει τις Essential Contacts ώστε να επιτρέπουν μόνο διαχειριζόμενες ταυτότητες χρηστών στους επιλεγμένους τομείς σας να λαμβάνουν ειδοποιήσεις πλατφόρμας.
* **Περιορισμένη κοινή χρήση τομέα:** Αποτρέπει την προσθήκη χρηστών στις πολιτικές IAM εκτός των καθορισμένων τομέων σας. Αυτό περιορίζει τις πολιτικές IAM ώστε να επιτρέπουν μόνο διαχειριζόμενες ταυτότητες χρηστών στους επιλεγμένους τομείς σας να έχουν πρόσβαση σε πόρους εντός αυτής της οργάνωσης.
* **Πρόληψη δημόσιας πρόσβασης:** Αποτρέπει την έκθεση των Cloud Storage buckets στο κοινό. Αυτό διασφαλίζει ότι ένας προγραμματιστής δεν μπορεί να διαμορφώσει τα Cloud Storage buckets ώστε να έχουν μη αυθεντικοποιημένη πρόσβαση στο διαδίκτυο.
* **Ομοιόμορφη πρόσβαση σε επίπεδο bucket:** Αποτρέπει τις λίστες ελέγχου πρόσβασης (ACLs) σε επίπεδο αντικειμένου στα Cloud Storage buckets. Αυτό απλοποιεί τη διαχείριση πρόσβασης σας εφαρμόζοντας πολιτικές IAM με συνέπεια σε όλα τα αντικείμενα στα Cloud Storage buckets.
* **Απαίτηση σύνδεσης OS:** Οι VMs που δημιουργούνται σε νέα projects θα έχουν ενεργοποιημένη τη σύνδεση OS. Αυτό σας επιτρέπει να διαχειρίζεστε την πρόσβαση SSH στις instances σας χρησιμοποιώντας IAM χωρίς να χρειάζεται να δημιουργήσετε και να διαχειριστείτε μεμονωμένα κλειδιά SSH.

**Πρόσθετες πολιτικές ασφαλείας για λογαριασμούς υπηρεσιών**

* **Απενεργοποίηση αυτόματων παραχωρήσεων IAM**: Αποτρέπει τους προεπιλεγμένους λογαριασμούς υπηρεσιών App Engine και Compute Engine από το να λαμβάνουν αυτόματα τον ρόλο Editor IAM σε ένα project κατά τη δημιουργία. Αυτό διασφαλίζει ότι οι λογαριασμοί υπηρεσιών δεν λαμβάνουν υπερβολικά επιτρεπτικούς ρόλους IAM κατά τη δημιουργία.
* **Απενεργοποίηση δημιουργίας κλειδιών λογαριασμού υπηρεσίας**: Αποτρέπει τη δημιουργία δημόσιων κλειδιών λογαριασμού υπηρεσίας. Αυτό βοηθά στη μείωση του κινδύνου έκθεσης επίμονων διαπιστευτηρίων.
* **Απενεργοποίηση μεταφόρτωσης κλειδιών λογαριασμού υπηρεσίας**: Αποτρέπει τη μεταφόρτωση δημόσιων κλειδιών λογαριασμού υπηρεσίας. Αυτό βοηθά στη μείωση του κινδύνου διαρροής ή επαναχρησιμοποίησης υλικού κλειδιού.

**Πολιτικές ασφαλούς διαμόρφωσης δικτύου VPC**

* **Ορισμός επιτρεπόμενων εξωτερικών IPs για VM instances**: Αποτρέπει τη δημιουργία Compute instances με δημόσια IP, που μπορεί να τα εκθέσει σε κίνηση στο διαδίκτυο.

<!---->

* **Απενεργοποίηση nested virtualization VM**: Αποτρέπει τη δημιουργία nested VMs σε Compute Engine VMs. Αυτό μειώνει τον κίνδυνο ασφαλείας από την ύπαρξη μη παρακολουθούμενων nested VMs.

<!---->

* **Απενεργοποίηση σειριακής θύρας VM:** Αποτρέπει την πρόσβαση στη σειριακή θύρα των Compute Engine VMs. Αυτό αποτρέπει την εισαγωγή σε σειριακή θύρα ενός διακομιστή χρησιμοποιώντας το Compute Engine API.

<!---->

* **Περιορισμός εξουσιοδοτημένων δικτύων σε instances Cloud SQL:** Αποτρέπει την πρόσβαση στις βάσεις δεδομένων Cloud SQL από δημόσια ή μη εσωτερικά δίκτυα.

<!---->

* **Περιορισμός προώθησης πρωτοκόλλου βάσει τύπου διεύθυνσης IP:** Αποτρέπει την προώθηση πρωτοκόλλου VM για εξωτερικές διευθύνσεις IP.

<!---->

* **Περιορισμός δημόσιας πρόσβασης IP σε instances Cloud SQL:** Αποτρέπει τη δημιουργία instances Cloud SQL με δημόσια IP, που μπορεί να τα εκθέσει σε κίνηση στο διαδίκτυο.

<!---->

* **Περιορισμός αφαίρεσης lien project κοινόχρηστου VPC:** Αποτρέπει την τυχαία διαγραφή των host projects κοινόχρηστου VPC.

<!---->

* **Ορίζει την εσωτερική ρύθμιση DNS για νέα projects σε Zonal DNS Only:** Αποτρέπει τη χρήση μιας παλαιότερης ρύθμισης DNS που έχει μειωμένη διαθεσιμότητα υπηρεσίας.

<!---->

* **Παράλειψη δημιουργίας προεπιλεγμένου δικτύου:** Αποτρέπει την αυτόματη δημιουργία του προεπιλεγμένου δικτύου VPC και των σχετικών πόρων. Αυτό αποφεύγει υπερβολικά επιτρεπτικούς προεπιλεγμένους κανόνες firewall.

<!---->

* **Απενεργοποίηση εξωτερικής χρήσης IPv6 VPC:** Αποτρέπει τη δημιουργία εξωτερικών υποδικτύων IPv6, που μπορεί να εκτεθούν σε μη εξουσιοδοτημένη πρόσβαση στο διαδίκτυο.

</details>

## **IAM Roles**

Αυτά είναι όπως οι πολιτικές IAM στο AWS καθώς **κάθε ρόλος περιέχει ένα σύνολο δικαιωμάτων.**

Ωστόσο, σε αντίθεση με το AWS, δεν υπάρχει **κεντρικό αποθετήριο** ρόλων. Αντί αυτού, **οι πόροι δίνουν X ρόλους πρόσβασης σε Y principals**, και ο μόνος τρόπος να μάθετε ποιος έχει πρόσβαση σε έναν πόρο είναι να χρησιμοποιήσετε τη **μέθοδο `get-iam-policy` πάνω σε αυτόν τον πόρο**.\
Αυτό μπορεί να είναι πρόβλημα γιατί σημαίνει ότι ο μόνος τρόπος να μάθετε **ποια δικαιώματα έχει ένας principal είναι να ρωτήσετε κάθε πόρο σε ποιον δίνει δικαιώματα**, και ένας χρήστης μπορεί να μην έχει δικαιώματα να πάρει δικαιώματα από όλους τους πόρους.

Υπάρχουν **τρεις τύποι** ρόλων στο IAM:

* **Βασικοί/Πρωτόγονοι ρόλοι**, που περιλαμβάνουν τους ρόλους **Owner**, **Editor**, και **Viewer** που υπήρχαν πριν από την εισαγωγή του IAM.
* **Προκαθορισμένοι ρόλοι**, που παρέχουν λεπτομερή πρόσβαση για μια συγκεκριμένη υπηρεσία και διαχειρίζονται από το Google Cloud. Υπάρχουν πολλοί προκαθορισμένοι ρόλοι, μπορείτε να **δείτε όλους με τα προνόμια που έχουν** [**εδώ**](https://cloud.google.com/iam/docs/understanding-roles#predefined\_roles).
* **Προσαρμοσμένοι ρόλοι**, που παρέχουν λεπτομερή πρόσβαση σύμφωνα με μια λίστα δικαιωμάτων που καθορίζεται από τον χρήστη.

Υπάρχουν χιλιάδες δικαιώματα στο GCP. Για να ελέγξετε αν ένας ρόλος έχει ένα δικαίωμα μπορείτε να [**αναζητήσετε το δικαίωμα εδώ**](https://cloud.google.com/iam/docs/permissions-reference) και να δείτε ποιοι ρόλοι το έχουν.

Μπορείτε επίσης να [**αναζητήσετε εδώ προκαθορισμένους ρόλους**](https://cloud.google.com/iam/docs/understanding-roles#product\_specific\_documentation) **που προσφέρονται από κάθε προϊόν.** Σημειώστε ότι κάποιοι **ρόλοι** δεν μπορούν να συνδεθούν με χρήστες και **μόνο με SAs λόγω κάποιων δικαιωμάτων** που περιέχουν.\
Επιπλέον, σημειώστε ότι **τα δικαιώματα** θα **ισχύσουν** μόνο αν είναι **συνδεδεμένα με τη σχετική υπηρεσία.**

Ή ελέγξτε αν ένας **προσαρμοσμένος ρόλος μπορεί να χρησιμοποιήσει ένα** [**συγκεκριμένο δικαίωμα εδώ**](https://cloud.google.com/iam/docs/custom-roles-permissions-support)**.**

{% content-ref url="gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

## Χρήστες <a href="#default-credentials" id="default-credentials"></a>

Στην **κονσόλα GCP** δεν υπάρχει **διαχείριση Χρηστών ή Ομάδων**, αυτό γίνεται στο **Google Workspace**. Αν και θα μπορούσατε να συγχρονίσετε έναν διαφορετικό πάροχο ταυτότητας στο Google Workspace.

Μπορείτε να έχετε πρόσβαση στους χρήστες και τις ομάδες του Workspaces στο [**https://admin.google.com**](https://admin.google.com/).

**MFA** μπορεί να **επιβληθεί** στους χρήστες του Workspaces, ωστόσο, ένας **επιτιθέμενος** θα μπορούσε να χρησιμοποιήσει ένα token για να έχει πρόσβαση στο GCP **μέσω cli που δεν θα προστατεύεται από MFA** (θα προστατεύεται από MFA μόνο όταν ο χρήστης συνδεθεί για να το δημιουργήσει: `gcloud auth login`).

## Ομάδες

Όταν δημιουργείται μια οργάνωση, προτείνεται έντονα να δημιουργηθούν αρκετές ομάδες. Αν διαχειρίζεστε κάποια από αυτές, μπορεί να έχετε παραβιάσει όλη ή ένα σημαντικό μέρος της οργάνωσης:

<table data-header-hidden><thead><tr><th width="299.3076923076923"></th><th></th></tr></thead><tbody><tr><td><strong>Ομάδα</strong></td><td><strong>Λειτουργία</strong></td></tr><tr><td><strong><code>gcp-organization-admins</code></strong><br><em>(ομάδα ή μεμονωμένοι λογαριασμοί απαιτούνται για τη λίστα ελέγχου)</em></td><td>Διαχείριση οποιουδήποτε πόρου που ανήκει στην οργάνωση. Αναθέστε αυτόν τον ρόλο με φειδώ· οι org admins έχουν πρόσβαση σε όλους τους πόρους του Google Cloud σας. Εναλλακτικά, επειδή αυτή η λειτουργία είναι εξαιρετικά προνομιούχα, σκεφτείτε να χρησιμοποιήσετε μεμονωμένους λογαριασμούς αντί να δημιουργήσετε μια ομάδα.</td></tr><tr><td><strong><code>gcp-network-admins</code></strong><br><em>(απαιτείται για τη λίστα ελέγχου)</em></td><td>Δημιουργία δικτύων, υποδικτύων, κανόνων firewall και συσκευών δικτύου όπως Cloud Router, Cloud VPN και cloud load balancers.</td></tr><tr><td><strong><code>gcp-billing-admins</code></strong><br><em>(απαιτείται για τη λίστα ελέγχου)</em></td><td>Ρύθμιση λογαριασμών χρέωσης και παρακολούθηση της χρήσης τους.</td></tr><tr><td><strong><code>gcp-developers</code></strong><br><em>(απαιτείται για τη λίστα ελέγχου)</em></td><td>Σχεδιασμός, κωδικοποίηση και δοκιμή εφαρμογών.</td></tr><tr><td><strong><code>gcp-security-admins</code></strong><br></td><td>Καθιέρωση και διαχείριση πολιτικών ασφαλείας για ολόκληρη την οργάνωση, συμπεριλαμβανομένης της διαχείρισης πρόσβασης και των <a href="https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints">πολιτικών περιορισμών οργάνωσης</a>. Δείτε τον <a href="https://cloud.google.com/architecture/security-foundations/authentication-authorization#users_and_groups">οδηγό θεμελίων ασφαλείας του Google Cloud</a> για περισσότερες πληροφορίες σχετικά με τον προγραμματισμό της υποδομής ασφαλείας του Google Cloud σας.</td></tr><tr><td><strong><code>gcp-devops</code></strong></td><td>Δημιουργία ή διαχείριση end-to-end pipelines που υποστηρίζουν συνεχή ενσωμάτωση και παράδοση, παρακολούθηση και παροχή συστημάτων.</td></tr><tr><td><strong><code>gcp-logging-admins</code></strong></td><td></td></tr><tr><td><strong><code>gcp-logging-viewers</code></strong></td><td></td></tr><tr><td><strong><code>gcp-monitor-admins</code></strong></td><td></td></tr><tr><td><strong><code>gcp-billing-viewer</code></strong><br><em>(όχι πλέον από προεπιλογή)</em></td><td>Παρακολούθηση των δαπανών στα projects. Τυπικά μέλη είναι μέρος της ομάδας οικονομικών.</
```
PROJECT_NUMBER-compute@developer.gserviceaccount.com
PROJECT_ID@appspot.gserviceaccount.com
```
Ωστόσο, είναι επίσης δυνατό να δημιουργήσετε και να συνδέσετε σε πόρους **custom service accounts**, που θα μοιάζουν με αυτό:
```
SERVICE_ACCOUNT_NAME@PROJECT_NAME.iam.gserviceaccount.com
```
### **Access scopes**

Τα Access scope είναι **συνδεδεμένα με τα παραγόμενα OAuth tokens** για πρόσβαση στα GCP API endpoints. Περιορίζουν τα δικαιώματα του OAuth token.\
Αυτό σημαίνει ότι αν ένα token ανήκει σε έναν Owner ενός πόρου αλλά δεν έχει το scope στο token για πρόσβαση σε αυτόν τον πόρο, το token **δεν μπορεί να χρησιμοποιηθεί για (κατά)χρηση αυτών των προνομίων**.

Η Google στην πραγματικότητα [συνιστά](https://cloud.google.com/compute/docs/access/service-accounts#service\_account\_permissions) ότι **τα access scopes δεν πρέπει να χρησιμοποιούνται και να βασίζεστε πλήρως στο IAM**. Η διαδικτυακή πύλη διαχείρισης το επιβάλλει αυτό, αλλά τα access scopes μπορούν ακόμα να εφαρμοστούν σε instances χρησιμοποιώντας custom service accounts προγραμματιστικά.

Μπορείτε να δείτε ποια **scopes** είναι **ανατεθειμένα** με **ερώτημα:**

{% code overflow="wrap" %}
```bash
curl 'https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=<access_token>'

{
"issued_to": "223044615559.apps.googleusercontent.com",
"audience": "223044615559.apps.googleusercontent.com",
"user_id": "139746512919298469201",
"scope": "openid https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/appengine.admin https://www.googleapis.com/auth/sqlservice.login https://www.googleapis.com/auth/compute https://www.googleapis.com/auth/accounts.reauth",
"expires_in": 2253,
"email": "username@testing.com",
"verified_email": true,
"access_type": "offline"
}
```
{% endcode %}

Οι προηγούμενες **scopes** είναι αυτές που δημιουργούνται από **default** χρησιμοποιώντας το **`gcloud`** για πρόσβαση σε δεδομένα. Αυτό συμβαίνει επειδή όταν χρησιμοποιείτε το **`gcloud`** πρώτα δημιουργείτε ένα OAuth token και στη συνέχεια το χρησιμοποιείτε για να επικοινωνήσετε με τα endpoints.

Η πιο σημαντική scope από αυτές είναι πιθανώς το **`cloud-platform`**, που βασικά σημαίνει ότι είναι δυνατόν να **πρόσβαση σε οποιαδήποτε υπηρεσία στο GCP**.

Μπορείτε **να βρείτε μια λίστα με** [**όλες τις πιθανές scopes εδώ**](https://developers.google.com/identity/protocols/googlescopes)**.**

Εάν έχετε **`gcloud`** browser credentials, είναι δυνατόν να **αποκτήσετε ένα token με άλλες scopes,** κάνοντας κάτι σαν:

{% code overflow="wrap" %}
```bash
# Maybe you can get a user token with other scopes changing the scopes array from ~/.config/gcloud/credentials.db

# Set new scopes for SDKs credentials
gcloud auth application-default login --scopes=https://www.googleapis.com/auth/userinfo.email,https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/sqlservice.login,https://www.googleapis.com/auth/appengine.admin,https://www.googleapis.com/auth/compute,https://www.googleapis.com/auth/accounts.reauth,https://www.googleapis.com/auth/admin.directory.user,https://www.googleapis.com/auth/admin.directory.group,https://www.googleapis.com/auth/admin.directory.domain,https://www.googleapis.com/auth/admin.directory.user

# Print new token
gcloud auth application-default print-access-token

# To use this token with some API you might need to use curl to indicate the project header with --header "X-Goog-User-Project: <project-name>"
```
{% endcode %}

## **Terraform IAM Policies, Bindings and Memberships**

Όπως ορίζεται από το terraform στο [https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam) χρησιμοποιώντας terraform με GCP υπάρχουν διαφορετικοί τρόποι για να παραχωρήσετε σε έναν principal πρόσβαση σε έναν πόρο:

* **Memberships**: Ορίζετε **principals ως μέλη ρόλων** **χωρίς περιορισμούς** στον ρόλο ή στους principals. Μπορείτε να βάλετε έναν χρήστη ως μέλος ενός ρόλου και στη συνέχεια να βάλετε μια ομάδα ως μέλος του ίδιου ρόλου και επίσης να ορίσετε αυτούς τους principals (χρήστη και ομάδα) ως μέλη άλλων ρόλων.
* **Bindings**: Αρκετοί **principals μπορούν να δεσμευτούν σε έναν ρόλο**. Αυτοί οι **principals μπορούν ακόμα να δεσμευτούν ή να είναι μέλη άλλων ρόλων**. Ωστόσο, αν ένας principal που δεν είναι δεσμευμένος στον ρόλο οριστεί ως **μέλος ενός δεσμευμένου ρόλου**, την επόμενη φορά που θα **εφαρμοστεί η δέσμευση, η ιδιότητα μέλους θα εξαφανιστεί**.
* **Policies**: Μια πολιτική είναι **αυθεντική**, υποδεικνύει ρόλους και principals και στη συνέχεια, **αυτοί οι principals δεν μπορούν να έχουν περισσότερους ρόλους και αυτοί οι ρόλοι δεν μπορούν να έχουν περισσότερους principals** εκτός αν τροποποιηθεί αυτή η πολιτική (ούτε καν σε άλλες πολιτικές, bindings ή memberships). Επομένως, όταν ένας ρόλος ή principal καθορίζεται σε μια πολιτική, όλα τα προνόμιά του είναι **περιορισμένα από αυτήν την πολιτική**. Προφανώς, αυτό μπορεί να παρακαμφθεί σε περίπτωση που ο principal έχει τη δυνατότητα να τροποποιήσει την πολιτική ή τα δικαιώματα κλιμάκωσης προνομίων (όπως να δημιουργήσει έναν νέο principal και να του δεσμεύσει έναν νέο ρόλο).

## References

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)
* [https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
