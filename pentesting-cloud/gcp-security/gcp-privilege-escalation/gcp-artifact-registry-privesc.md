# GCP - –ü—Ä–∏–≤—ñ–ª–µ—ó Artifact Registry

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**–®–∫–æ–ª–∞ —Ö–∞–∫—ñ–Ω–≥—É HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**–®–∫–æ–ª–∞ —Ö–∞–∫—ñ–Ω–≥—É HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥-–ø—Ä–∏–π–æ–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}

## –†–µ—î—Å—Ç—Ä –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –†–µ—î—Å—Ç—Ä –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤ –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ:

{% content-ref url="../gcp-services/gcp-artifact-registry-enum.md" %}
[gcp-artifact-registry-enum.md](../gcp-services/gcp-artifact-registry-enum.md)
{% endcontent-ref %}

### artifactregistry.repositories.uploadArtifacts

–ó —Ü–∏–º –¥–æ–∑–≤–æ–ª–æ–º –∞—Ç–∞–∫—É–≤–∞–ª—å–Ω–∏–∫ –º–æ–∂–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –Ω–æ–≤—ñ –≤–µ—Ä—Å—ñ—ó –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤ –∑ —à–∫—ñ–¥–ª–∏–≤–∏–º –∫–æ–¥–æ–º, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Docker-–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è–º–∏:

{% code overflow="wrap" %}
```bash
# Configure docker to use gcloud to authenticate with Artifact Registry
gcloud auth configure-docker <location>-docker.pkg.dev

# tag the image to upload it
docker tag <local-img-name>:<local-tag> <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>

# Upload it
docker push <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>
```
{% endcode %}

{% hint style="danger" %}
–ë—É–ª–æ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ, —â–æ **–º–æ–∂–ª–∏–≤–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–æ–≤–∏–π —à–∫—ñ–¥–ª–∏–≤–∏–π docker** –æ–±—Ä–∞–∑ –∑ —Ç—ñ—î—é —Å–∞–º–æ—é –Ω–∞–∑–≤–æ—é —Ç–∞ —Ç–µ–≥–æ–º, —â–æ–± **—Å—Ç–∞—Ä–∏–π –≤—Ç—Ä–∞—Ç–∏–≤ —Ç–µ–≥**, —ñ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–∞–∑—É, –∫–æ–ª–∏ —Ü–µ–π –æ–±—Ä–∞–∑ –∑ —Ü–∏–º —Ç–µ–≥–æ–º –±—É–¥–µ **–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏–π, –±—É–¥–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ —à–∫—ñ–¥–ª–∏–≤–∏–π**.
{% endhint %}

<details>

<summary>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ Python</summary>

**–ü–æ—á–Ω—ñ—Ç—å –∑ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è** (—è–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—é –≤–µ—Ä—Å—ñ—é –∑ —Ä–µ—î—Å—Ç—Ä—É, –≤–∏ –º–æ–∂–µ—Ç–µ —É–Ω–∏–∫–Ω—É—Ç–∏ —Ü—å–æ–≥–æ –∫—Ä–æ–∫—É):

1. **–ù–∞–ª–∞—à—Ç—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–∞—à–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É**:

* –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è –≤–∞—à–æ—ó –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `hello_world_library`.
* –£ —Ü—å–æ–º—É –∫–∞—Ç–∞–ª–æ–∑—ñ —Å—Ç–≤–æ—Ä—ñ—Ç—å —â–µ –æ–¥–∏–Ω –∫–∞—Ç–∞–ª–æ–≥ –∑ –Ω–∞–∑–≤–æ—é –≤–∞—à–æ–≥–æ –ø–∞–∫–µ—Ç—É, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `hello_world`.
* –£ –∫–∞—Ç–∞–ª–æ–∑—ñ –≤–∞—à–æ–≥–æ –ø–∞–∫–µ—Ç—É —Å—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `__init__.py`. –¶–µ–π —Ñ–∞–π–ª –º–æ–∂–µ –±—É—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ–º –∞–±–æ –º—ñ—Å—Ç–∏—Ç–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –¥–ª—è –≤–∞—à–æ–≥–æ –ø–∞–∫–µ—Ç—É.

```bash
mkdir hello_world_library
cd hello_world_library
mkdir hello_world
touch hello_world/__init__.py
```
2. **–ù–∞–ø–∏—à—ñ—Ç—å –∫–æ–¥ –≤–∞—à–æ—ó –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏**:

* –£ –∫–∞—Ç–∞–ª–æ–∑—ñ `hello_world` —Å—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π —Ñ–∞–π–ª Python –¥–ª—è –≤–∞—à–æ–≥–æ –º–æ–¥—É–ª—è, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `greet.py`.
* –ù–∞–ø–∏—à—ñ—Ç—å –≤–∞—à—É —Ñ—É–Ω–∫—Ü—ñ—é "–ü—Ä–∏–≤—ñ—Ç, —Å–≤—ñ—Ç!":

```python
# hello_world/greet.py
def say_hello():
return "Hello, World!"
```
3. **–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `setup.py`**:

* –£ –∫–æ—Ä–µ–Ω—ñ –≤–∞—à–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥—É `hello_world_library` —Å—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `setup.py`.
* –¶–µ–π —Ñ–∞–π–ª –º—ñ—Å—Ç–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω—ñ –ø—Ä–æ –≤–∞—à—É –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É —Ç–∞ –∫–∞–∂–µ Python, —è–∫ —ó—ó –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏.

```python
# setup.py
from setuptools import setup, find_packages

setup(
name='hello_world',
version='0.1',
packages=find_packages(),
install_requires=[
# –ë—É–¥—å-—è–∫—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –≤–∞—à—ñ–π –±—ñ–±–ª—ñ–æ—Ç–µ—Ü—ñ
],
)
```



**–¢–µ–ø–µ—Ä –¥–∞–≤–∞–π—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–º–æ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É:**

1. **–ü–æ–±—É–¥—É–π—Ç–µ –≤–∞—à –ø–∞–∫–µ—Ç**:

* –ó –∫–æ—Ä–µ–Ω—è –≤–∞—à–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥—É `hello_world_library` –∑–∞–ø—É—Å—Ç—ñ—Ç—å:

```sh
python3 setup.py sdist bdist_wheel
```
2. **–ù–∞–ª–∞—à—Ç—É–π—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é –¥–ª—è twine** (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤–∞—à–æ–≥–æ –ø–∞–∫–µ—Ç—É):

* –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ `twine` (`pip install twine`).
* –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `gcloud` –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö:

{% code overflow="wrap" %}
```sh
twine upload --username 'oauth2accesstoken' --password "$(gcloud auth print-access-token)" --repository-url https://<location>-python.pkg.dev/<project-id>/<repo-name>/ dist/*
```
{% endcode %}

<!---->

3. **–û—á–∏—Å—Ç—ñ—Ç—å –∑–±—ñ—Ä–∫—É**
```bash
rm -rf dist build hello_world.egg-info
```
</details>

{% hint style="danger" %}
–ù–µ–º–æ–∂–ª–∏–≤–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É Python –∑ —Ç–∞–∫–æ—é –∂ –≤–µ—Ä—Å—ñ—î—é, —è–∫ –≤–∂–µ –ø—Ä–∏—Å—É—Ç–Ω—è, –∞–ª–µ –º–æ–∂–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ **–±—ñ–ª—å—à—ñ –≤–µ—Ä—Å—ñ—ó** (–∞–±–æ –¥–æ–¥–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π **`.0` –≤ –∫—ñ–Ω—Ü—ñ** –≤–µ—Ä—Å—ñ—ó, —è–∫—â–æ —Ü–µ –ø—Ä–∞—Ü—é—î - –Ω–µ –≤ Python, –æ–¥–Ω–∞–∫), –∞–±–æ **–≤–∏–¥–∞–ª–∏—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—é –≤–µ—Ä—Å—ñ—é —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–æ–≤—É** (–ø–æ—Ç—Ä—ñ–±–Ω–æ `artifactregistry.versions.delete)`**:**

{% code overflow="wrap" %}
```sh
gcloud artifacts versions delete <version> --repository=<repo-name> --location=<location> --package=<lib-name>
```
{% endcode %}
{% endhint %}

### `artifactregistry.repositories.downloadArtifacts`

–ó —Ü–∏–º –¥–æ–∑–≤–æ–ª–æ–º –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏** —Ç–∞ —à—É–∫–∞—Ç–∏ **—á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é** —Ç–∞ **–≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ**.

–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ **Docker** –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è:
```sh
# Configure docker to use gcloud to authenticate with Artifact Registry
gcloud auth configure-docker <location>-docker.pkg.dev

# Dowload image
docker pull <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>
```
–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É **python**:

{% code overflow="wrap" %}
```bash
pip install <lib-name> --index-url "https://oauth2accesstoken:$(gcloud auth print-access-token)@<location>-python.pkg.dev/<project-id>/<repo-name>/simple/" --trusted-host <location>-python.pkg.dev --no-cache-dir
```
{% endcode %}

* –©–æ —Å—Ç–∞–Ω–µ—Ç—å—Å—è, —è–∫—â–æ –∑–º—ñ—à–∞—Ç–∏ –≤—ñ–¥–¥–∞–ª–µ–Ω—ñ —Ç–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ —Ä–µ—î—Å—Ç—Ä–∏ –≤ –æ–¥–∏–Ω –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∏–π, –∞ –ø–∞–∫—É–Ω–æ–∫ —ñ—Å–Ω—É—î –≤ –æ–±–æ—Ö? –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ü—é —Å—Ç–æ—Ä—ñ–Ω–∫—É:

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

### `artifactregistry.tags.delete`, `artifactregistry.versions.delete`, `artifactregistry.packages.delete`, (`artifactregistry.repositories.get`, `artifactregistry.tags.get`, `artifactregistry.tags.list`)

–í–∏–¥–∞–ª–µ–Ω–Ω—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤ –∑ —Ä–µ—î—Å—Ç—Ä—É, —Ç–∞–∫–∏—Ö —è–∫ –æ–±—Ä–∞–∑–∏ Docker:

{% code overflow="wrap" %}
```bash
# Delete a docker image
gcloud artifacts docker images delete <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>
```
### `artifactregistry.repositories.delete`

–í–∏–¥–∞–ª–µ–Ω–Ω—è –ø–æ–≤–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é (–Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤—ñ–Ω –º–∞—î –≤–º—ñ—Å—Ç):

{% code overflow="wrap" %}
```
gcloud artifacts repositories delete <repo-name> --location=<location>
```
{% endcode %}

### `artifactregistry.repositories.setIamPolicy`

–ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∑ —Ü–∏–º –¥–æ–∑–≤–æ–ª–æ–º –º–æ–∂–µ –Ω–∞–¥–∞—Ç–∏ —Å–æ–±—ñ –¥–æ–∑–≤–æ–ª–∏ –Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–µ—è–∫–∏—Ö –∑–∞–∑–Ω–∞—á–µ–Ω–∏—Ö —Ä–∞–Ω—ñ—à–µ –∞—Ç–∞–∫ –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π.

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**–®–∫–æ–ª–∞ —Ö–∞–∫—ñ–Ω–≥—É HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**–®–∫–æ–ª–∞ —Ö–∞–∫—ñ–Ω–≥—É HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫–µ—Ä—Å—å–∫—ñ —Ç—Ä—é–∫–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}
