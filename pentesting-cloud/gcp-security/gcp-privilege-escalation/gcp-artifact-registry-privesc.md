# GCP - Kuboresha Mamlaka ya Hifadhi ya Sanaa

{% hint style="success" %}
Jifunze & zoezi la Udukuzi wa AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Mafunzo ya HackTricks ya Mtaalam wa Timu Nyekundu ya AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze & zoezi la Udukuzi wa GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Mafunzo ya HackTricks ya Mtaalam wa Timu Nyekundu ya GCP (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa michango**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Hifadhi ya Sanaa

Kwa habari zaidi kuhusu Hifadhi ya Sanaa angalia:

{% content-ref url="../gcp-services/gcp-artifact-registry-enum.md" %}
[gcp-artifact-registry-enum.md](../gcp-services/gcp-artifact-registry-enum.md)
{% endcontent-ref %}

### artifactregistry.repositories.uploadArtifacts

Kwa kibali hiki, mshambuliaji anaweza kupakia toleo mpya la sanaa na nambari ya malicious kama picha za Docker:

{% code overflow="wrap" %}
```bash
# Configure docker to use gcloud to authenticate with Artifact Registry
gcloud auth configure-docker <location>-docker.pkg.dev

# tag the image to upload it
docker tag <local-img-name>:<local-tag> <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>

# Upload it
docker push <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>
```
{% endcode %}

{% hint style="danger" %}
Ilithibitishwa kwamba ni **kinachowezekana kupakia picha mpya ya docker** yenye nia mbaya na jina na lebo ile ile kama ile iliyopo, hivyo **ile ya zamani itapoteza lebo** na wakati ijayo picha hiyo na lebo hiyo inapopakuliwa **ile yenye nia mbaya** itapakuliwa.
{% endhint %}

<details>

<summary>Pakia maktaba ya Python</summary>

**Anza kwa kuunda maktaba ya kupakia** (ikiwa unaweza kupakua toleo jipya kutoka kwenye usajili unaweza kuepuka hatua hii):

1.  **Sanidi muundo wa mradi wako**:

* Unda saraka mpya kwa ajili ya maktaba yako, kwa mfano, `hello_world_library`.
* Ndani ya saraka hii, unda saraka nyingine na jina la pakiti yako, kwa mfano, `hello_world`.
* Ndani ya saraka yako ya pakiti, unda faili ya `__init__.py`. Faili hii inaweza kuwa tupu au inaweza kuwa na mipangilio ya awali kwa ajili ya pakiti yako.

```bash
mkdir hello_world_library
cd hello_world_library
mkdir hello_world
touch hello_world/__init__.py
```
2.  **Andika nambari ya maktaba yako**:

* Ndani ya saraka ya `hello_world`, unda faili mpya ya Python kwa ajili ya moduli yako, kwa mfano, `greet.py`.
* Andika kazi yako ya "Hello, World!":

```python
# hello_world/greet.py
def say_hello():
return "Hello, World!"
```
3.  **Unda faili ya `setup.py`**:

* Katika mzizi wa saraka yako ya `hello_world_library`, unda faili ya `setup.py`.
* Faili hii ina maelezo kuhusu maktaba yako na inaambia Python jinsi ya kuisakinisha.

```python
# setup.py
from setuptools import setup, find_packages

setup(
name='hello_world',
version='0.1',
packages=find_packages(),
install_requires=[
# Mahitaji yoyote ambayo maktaba yako inahitaji
],
)
```



**Sasa, pakia maktaba:**

1.  **Jenga pakiti yako**:

* Kutoka kwenye mzizi wa saraka yako ya `hello_world_library`, endesha:

```sh
python3 setup.py sdist bdist_wheel
```
2.  **Sanidi uthibitishaji kwa twine** (inayotumika kupakia pakiti yako):

* Hakikisha una `twine` imesakinishwa (`pip install twine`).
* Tumia `gcloud` kusanidi vyeti:

{% code overflow="wrap" %}
```sh
twine upload --username 'oauth2accesstoken' --password "$(gcloud auth print-access-token)" --repository-url https://<location>-python.pkg.dev/<project-id>/<repo-name>/ dist/*
```
{% endcode %}

<!---->

3. **Safisha ujenzi**
```bash
rm -rf dist build hello_world.egg-info
```
</details>

{% hint style="danger" %}
Haiwezekani kupakia maktaba ya python yenye toleo sawa na ile iliyopo tayari, lakini inawezekana kupakia **toleo kubwa zaidi** (au kuongeza **`.0` ziada mwishoni** mwa toleo ikiwa hiyo inafanya kazi -sio kwa python ingawa-), au **kufuta toleo la mwisho na kupakia jipya** (inahitaji `artifactregistry.versions.delete)`**:**

{% code overflow="wrap" %}
```sh
gcloud artifacts versions delete <version> --repository=<repo-name> --location=<location> --package=<lib-name>
```
{% endcode %}
{% endhint %}

### `artifactregistry.repositories.downloadArtifacts`

Kwa kibali hiki unaweza **kupakua sanaa** na kutafuta **habari nyeti** na **mapungufu**.

Pakua picha ya **Docker**:
```sh
# Configure docker to use gcloud to authenticate with Artifact Registry
gcloud auth configure-docker <location>-docker.pkg.dev

# Dowload image
docker pull <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>
```
Pakua maktaba ya **python**:

{% code overflow="wrap" %}
```bash
pip install <lib-name> --index-url "https://oauth2accesstoken:$(gcloud auth print-access-token)@<location>-python.pkg.dev/<project-id>/<repo-name>/simple/" --trusted-host <location>-python.pkg.dev --no-cache-dir
```
{% endcode %}

* Kipi kitatokea ikiwa usajili wa mbali na wa kawaida unachanganywa katika moja ya kubuniwa kwa kielektroniki na pakiti inaonekana katika zote mbili? Angalia ukurasa huu:

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

### `artifactregistry.tags.delete`, `artifactregistry.versions.delete`, `artifactregistry.packages.delete`, (`artifactregistry.repositories.get`, `artifactregistry.tags.get`, `artifactregistry.tags.list`)

Futa vitu kutoka kwenye usajili, kama picha za docker:

{% code overflow="wrap" %}
```bash
# Delete a docker image
gcloud artifacts docker images delete <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>
```
{% endcode %}

### `artifactregistry.repositories.delete`

Futa hazina kamili (hata kama ina maudhui):
```
gcloud artifacts repositories delete <repo-name> --location=<location>
```
{% endcode %}

### `artifactregistry.repositories.setIamPolicy`

Mshambuliaji mwenye ruhusa hii anaweza kujipa ruhusa za kufanya baadhi ya mashambulizi ya hifadhi yaliyotajwa hapo awali.

{% hint style="success" %}
Jifunze na zoezi la Udukuzi wa AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Mafunzo ya HackTricks AWS Timu Nyekundu Mtaalam (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze na zoezi la Udukuzi wa GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Mafunzo ya HackTricks GCP Timu Nyekundu Mtaalam (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa michango**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
