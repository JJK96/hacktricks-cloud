# GCP - Cloudbuild Privesc

{% hint style="success" %}
Nauƒçite i ve≈æbajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Nauƒçite i ve≈æbajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr≈æite HackTricks</summary>

* Pogledajte [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Delite hacking trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## cloudbuild

Za vi≈°e informacija o Cloud Build proverite:

{% content-ref url="../gcp-services/gcp-cloud-build-enum.md" %}
[gcp-cloud-build-enum.md](../gcp-services/gcp-cloud-build-enum.md)
{% endcontent-ref %}

### `cloudbuild.builds.create`

Sa ovom dozvolom mo≈æete **podneti cloud build**. Cloudbuild ma≈°ina ƒáe imati u svom fajl sistemu **podrazumevano token cloudbuild Service Account-a**: `<PROJECT_NUMBER>@cloudbuild.gserviceaccount.com`. Meƒëutim, mo≈æete **navesti bilo koji service account unutar projekta** u cloudbuild konfiguraciji.\
Dakle, mo≈æete jednostavno naterati ma≈°inu da eksfiltrira token na va≈° server ili **dobiti reverse shell unutar nje i sami preuzeti token** (fajl koji sadr≈æi token mo≈æe se promeniti).

Originalni exploit skript mo≈æete pronaƒái [**ovde na GitHub-u**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/cloudbuild.builds.create.py) (ali lokacija sa koje uzima token nije radila za mene). Dakle, proverite skript za automatizaciju [**kreiranja, eksploatacije i ƒçi≈°ƒáenja ranjivog okru≈æenja ovde**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/f-cloudbuild.builds.create.sh) i python skript za dobijanje reverse shell-a unutar cloudbuild ma≈°ine i [**kraƒëu ovde**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/f-cloudbuild.builds.create.py) (u kodu mo≈æete pronaƒái kako da navedete druge service account-e)**.**

Za detaljnije obja≈°njenje, posetite [https://rhinosecuritylabs.com/gcp/iam-privilege-escalation-gcp-cloudbuild/](https://rhinosecuritylabs.com/gcp/iam-privilege-escalation-gcp-cloudbuild/)

### `cloudbuild.builds.update`

**Potencijalno** sa ovom dozvolom ƒáete moƒái da **a≈æurirate cloud build i jednostavno ukradete token service account-a** kao ≈°to je uraƒëeno sa prethodnom dozvolom (ali na≈æalost u trenutku pisanja nisam mogao pronaƒái naƒçin da pozovem taj API).

TODO

### `cloudbuild.repositories.accessReadToken`

Sa ovom dozvolom korisnik mo≈æe dobiti **read access token** koji se koristi za pristup repozitorijumu:

{% code overflow="wrap" %}
```bash
curl -X POST \
-H "Authorization: Bearer $(gcloud auth print-access-token)" \
-H "Content-Type: application/json" \
-d '{}' \
"https://cloudbuild.googleapis.com/v2/projects/<PROJECT_ID>/locations/<LOCATION>/connections/<CONN_ID>/repositories/<repo-id>:accessReadToken"
```
{% endcode %}

### `cloudbuild.repositories.accessReadWriteToken`

Sa ovom dozvolom korisnik mo≈æe dobiti **token za ƒçitanje i pisanje** koji se koristi za pristup repozitorijumu:

{% code overflow="wrap" %}
```bash
curl -X POST \
-H "Authorization: Bearer $(gcloud auth print-access-token)" \
-H "Content-Type: application/json" \
-d '{}' \
"https://cloudbuild.googleapis.com/v2/projects/<PROJECT_ID>/locations/<LOCATION>/connections/<CONN_ID>/repositories/<repo-id>:accessReadWriteToken"
```
{% endcode %}

### `cloudbuild.connections.fetchLinkableRepositories`

Sa ovom dozvolom mo≈æete **dobiti repozitorijume kojima konekcija ima pristup:**

{% code overflow="wrap" %}
```bash
curl -X GET \
-H "Authorization: Bearer $(gcloud auth print-access-token)" \
"https://cloudbuild.googleapis.com/v2/projects/<PROJECT_ID>/locations/<LOCATION>/connections/<CONN_ID>:fetchLinkableRepositories"
```
{% endcode %}

{% hint style="success" %}
Nauƒçite i ve≈æbajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Nauƒçite i ve≈æbajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr≈æite HackTricks</summary>

* Pogledajte [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Delite hacking trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
