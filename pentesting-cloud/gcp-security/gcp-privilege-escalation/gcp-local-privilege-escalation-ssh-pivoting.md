# GCP - рд╕реНрдерд╛рдиреАрдп рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирддрд┐ рдПрд╕рдПрд╕рдПрдЪ рдкрд┐рд╡реЛрдЯрд┐рдВрдЧ

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕**](https://github.com/carlospolop/hacktricks) рдФрд░ [**рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗред

</details>
{% endhint %}

рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╣рдо рдорд╛рдиреЗрдВрдЧреЗ рдХрд┐ рдЖрдкрдиреЗ рдПрдХ рдЧрдгрдирд╛ рдЗрдВрдЬрди рдкрд░ рдПрдХ рдЧреИрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЦрд╛рддрд╛ **рдХрдВрдкреНрд░рдорд╛рдЗрдЬрд╝** рдХрд░ рд▓рд┐рдпрд╛ рд╣реИред

рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ рд░реВрдк рд╕реЗ, рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдХрдВрдкреНрд░рдорд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдЧрдгрдирд╛ рдЗрдВрдЬрди рдХреА GPC рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдЖрдкрдХреЛ рдорд╢реАрди рдХреЗ рднреАрддрд░ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддреА рд╣реИрдВ**ред рдпрд╣рд╛рдБ рддрдХ рдХрд┐ рдпрд╣ рдмрд╛рджрд▓ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рд╣рдореЗрд╢рд╛ рдмрд╣реБрдд рдорджрджрдЧрд╛рд░ рдирд╣реАрдВ рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдпрд╣ рдЬрд╛рдирдирд╛ рднреА рдЕрдЪреНрдЫрд╛ рд╣реИ рдХрд┐ рдпрд╣ рд╕рдВрднрд╡ рд╣реИред

## рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдкрдврд╝реЗрдВ <a href="#follow-the-scripts" id="follow-the-scripts"></a>

**рдЧрдгрдирд╛ рдЙрджрд╛рд╣рд░рдг** рд╢рд╛рдпрдж рд╡рд╣рд╛рдБ рд╣реИрдВ рдЬреЛ рдХреБрдЫ рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдХреЛ **рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП** рдЙрдирдХреЗ рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

рдЬреИрд╕реЗ рдХрд┐ IAM рдЧреЛ рдЧреНрд░реИрдиреБрд▓рд░ рд╣реИ, рдПрдХ рдЦрд╛рддрд╛ рдХрд┐рд╕реА рд╕рдВрд╕рд╛рдзрди рдкрд░ **рдкрдврд╝рдиреЗ/рд▓рд┐рдЦрдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рд░рдЦ рд╕рдХрддрд╛ рд╣реИ рд▓реЗрдХрд┐рди **рд╕реВрдЪреА рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдирд╣реАрдВ**ред

рдЗрд╕рдХрд╛ рдПрдХ рд╢рд╛рдирджрд╛рд░ рдХрд▓реНрдкрдирд╛рддреНрдордХ рдЙрджрд╛рд╣рд░рдг рдпрд╣ рд╣реИ рдХрд┐ рдПрдХ рдЧрдгрдирд╛ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЛ `instance82736-long-term-xyz-archive-0332893` рдирд╛рдордХ рдПрдХ рд╕реНрдЯреЛрд░реЗрдЬ рдмрдХреЗрдЯ рдореЗрдВ рдмреИрдХрдЕрдк рдкрдврд╝рдиреЗ/рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред

рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рд╕реЗ `gsutil ls` рдЪрд▓рд╛рдиреЗ рдкрд░ рдХреБрдЫ рдирд╣реАрдВ рд▓реМрдЯрддрд╛, рдХреНрдпреЛрдВрдХрд┐ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдХреЛ `storage.buckets.list` IAM рдЕрдиреБрдорддрд┐ рдХреА рдХрдореА рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ рдЖрдкрдиреЗ `gsutil ls gs://instance82736-long-term-xyz-archive-0332893` рдЪрд▓рд╛рдпрд╛ рддреЛ рдЖрдкрдХреЛ рдкреВрд░реНрдг рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдмреИрдХрдЕрдк рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЖрдкрдХреЛ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХрд╛ рд╕реНрдкрд╖реНрдЯ-рдкрд╛рда рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣реИ рдЬрд┐рд╕рдХреА рдЖрдкрдХреЗ рд╕реНрдерд╛рдиреАрдп рд▓рд┐рдирдХреНрд╕ рдЦрд╛рддреЗ рдореЗрдВ рдХрдореА рд╣реИред

рдЖрдк рдЗрд╕ рдмрдХреЗрдЯ рдирд╛рдо рдХреЛ рдХрд┐рд╕реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ (рдмреИрд╢, рдкрд╛рдпрдерди, рд░реВрдмреА...) рдореЗрдВ рдвреВрдВрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред

## рдХрд╕реНрдЯрдо рдореЗрдЯрд╛рдбреЗрдЯрд╛

рдкреНрд░рд╢рд╛рд╕рдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдФрд░ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рд╕реНрддрд░ рдкрд░ [рдХрд╕реНрдЯрдо рдореЗрдЯрд╛рдбреЗрдЯрд╛](https://cloud.google.com/compute/docs/storing-retrieving-metadata#custom) рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдмрд╕ рдПрдХ рддрд░реАрдХрд╛ рд╣реИ **рдПрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рдХреБрдВрдЬреА/рдореВрд▓реНрдп рдЬреЛрдбрд╝рдиреЗ рдХрд╛**, рдФрд░ рдЖрдорддреМрд░ рдкрд░ рд╡рд╛рддрд╛рд╡рд░рдг рдЪрд░ рдФрд░ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк/рд╢рдЯрдбрд╛рдЙрди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛** рднреА рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реЛрдЧрд╛ рдЬреЛ рд╣рд░ рдмрд╛рд░ **рдорд╢реАрди рдХреЛ рд╢реБрд░реВ рдпрд╛ рдкреБрдирд░рд╛рд░рдВрдн рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдЬрд┐рд╕реЗ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╕реЗ рднреА рдкрд╣реБрдБрдЪрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред**

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪреЗрдВ:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

## IAM рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд рдЕрдзрд┐рдХрд╛рдВрд╢ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХрдВрдкреНрдпреВрдЯ рдПрд╕рдП** рдХреЛ **рджреА рдЬрд╛рддреА рд╣реИ,** рдХреЗрд╡рд▓ рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдПрдХреНрд╕реЗрд╕ рд╕реНрдХреЛрдк рдПрд╕рдП рдХреЛ рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ**ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ **`cloud-platform`** **рд╕реНрдХреЛрдк** рд╕рдХреНрд╖рдо рд╣реИ рдпрд╛ рдХреЗрд╡рд▓ **`compute` рд╕реНрдХреЛрдк** рд╕рдХреНрд╖рдо рд╣реИ, рддреЛ рдЖрдк рдЗрдирдХрд╛ **рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

* [**compute.instances.osLogin**](gcp-compute-privesc/#compute.instances.oslogin)
* [**compute.instances.osAdminLogin**](gcp-compute-privesc/#compute.instances.osadminlogin)
* [**compute.projects.setCommonInstanceMetadata**](gcp-compute-privesc/#compute.projects.setcommoninstancemetadata)
* [**compute.instances.setMetadata**](gcp-compute-privesc/#compute.instances.setmetadata)
* [**compute.instances.setIamPolicy**](gcp-compute-privesc/#compute.instances.setiampolicy)

## рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреА рдЦреЛрдЬ

рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмреЙрдХреНрд╕ рдореЗрдВ gcloud рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд┐рдпрд╛ рд╣реИ рдФрд░ рдЙрдиреНрд╣реЛрдВрдиреЗ рдЕрдкрдиреА рдкреНрд░рдорд╛рдгрд┐рдХрддрд╛ рдХреЛ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдЫреЛрдбрд╝ рджрд┐рдпрд╛ рд╣реИ:
```
sudo find / -name "gcloud"
```
рдпреЗ рд╕рдмрд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рдлрд╝рд╛рдЗрд▓реЗрдВ рд╣реИрдВ:

* `~/.config/gcloud/credentials.db`
* `~/.config/gcloud/legacy_credentials/[рдЦрд╛рддрд╛]/adc.json`
* `~/.config/gcloud/legacy_credentials/[рдЦрд╛рддрд╛]/.boto`
* `~/.credentials.json`

### рдЕрдзрд┐рдХ API рдХреБрдВрдЬреА рд░реЗрдЬреЗрдХреНрд╕реЗрд╕
```bash
TARGET_DIR="/path/to/whatever"

# Service account keys
grep -Pzr "(?s){[^{}]*?service_account[^{}]*?private_key.*?}" \
"$TARGET_DIR"

# Legacy GCP creds
grep -Pzr "(?s){[^{}]*?client_id[^{}]*?client_secret.*?}" \
"$TARGET_DIR"

# Google API keys
grep -Pr "AIza[a-zA-Z0-9\\-_]{35}" \
"$TARGET_DIR"

# Google OAuth tokens
grep -Pr "ya29\.[a-zA-Z0-9_-]{100,200}" \
"$TARGET_DIR"

# Generic SSH keys
grep -Pzr "(?s)-----BEGIN[ A-Z]*?PRIVATE KEY[a-zA-Z0-9/\+=\n-]*?END[ A-Z]*?PRIVATE KEY-----" \
"$TARGET_DIR"

# Signed storage URLs
grep -Pir "storage.googleapis.com.*?Goog-Signature=[a-f0-9]+" \
"$TARGET_DIR"

# Signed policy documents in HTML
grep -Pzr '(?s)<form action.*?googleapis.com.*?name="signature" value=".*?">' \
"$TARGET_DIR"
```
## рд╕рдВрджрд░реНрдн

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
{% endhint %}
