# GCP - AppEngine Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## App Engine

App Engine hakkında daha fazla bilgi için kontrol edin:

{% content-ref url="../gcp-services/gcp-app-engine-enum.md" %}
[gcp-app-engine-enum.md](../gcp-services/gcp-app-engine-enum.md)
{% endcontent-ref %}

### `appengine.applications.get`, `appengine.instances.get`, `appengine.instances.list`, `appengine.operations.get`, `appengine.operations.list`, `appengine.services.get`, `appengine.services.list`, `appengine.versions.create`, `appengine.versions.get`, `appengine.versions.list`, `cloudbuild.builds.get`,`iam.serviceAccounts.actAs`, `resourcemanager.projects.get`, `storage.objects.create`, `storage.objects.list`

Bunlar, **`gcloud` cli** kullanarak bir Uygulama **dağıtmak için gerekli izinlerdir**. Belki **`get`** ve **`list`** olanlar **kaçınılabilir**.

Python kod örneklerini [https://github.com/GoogleCloudPlatform/python-docs-samples/tree/main/appengine](https://github.com/GoogleCloudPlatform/python-docs-samples/tree/main/appengine) adresinde bulabilirsiniz.

Varsayılan olarak, Uygulama hizmetinin adı **`default`** olacak ve aynı isimle yalnızca 1 örnek olabilir.\
Bunu değiştirmek ve ikinci bir Uygulama oluşturmak için, **`app.yaml`** dosyasında kök anahtarın değerini **`service: my-second-app`** gibi bir şeyle değiştirin.
```bash
cd python-docs-samples/appengine/flexible/hello_world
gcloud app deploy #Upload and start application inside the folder
```
En az 10-15 dakika bekleyin, eğer çalışmazsa **başka bir kez dağıtım yapın** ve birkaç dakika bekleyin.

{% hint style="info" %}
**Kullanılacak Hizmet Hesabını belirtmek mümkündür** ancak varsayılan olarak, App Engine varsayılan SA'sı kullanılır.
{% endhint %}

Uygulamanın URL'si `https://<proj-name>.oa.r.appspot.com/` veya `https://<service_name>-dot-<proj-name>.oa.r.appspot.com` gibi bir şeydir.

### Eşdeğer izinleri güncelle

Bir AppEngine'i güncellemek için yeterli izniniz olabilir ancak yeni bir tane oluşturmak için yeterli izniniz olmayabilir. Bu durumda mevcut App Engine'i güncellemenin yolu şudur:
```bash
# Find the code of the App Engine in the buckets
gsutil ls

# Download code
mkdir /tmp/appengine2
cd /tmp/appengine2
## In this case it was found in this custom bucket but you could also use the
## buckets generated when the App Engine is created
gsutil cp gs://appengine-lab-1-gcp-labs-4t04m0i6-3a97003354979ef6/labs_appengine_1_premissions_privesc.zip .
unzip labs_appengine_1_premissions_privesc.zip

## Now modify the code..

## If you don't have an app.yaml, create one like:
cat >> app.yaml <<EOF
runtime: python312

entrypoint: gunicorn -b :\$PORT main:app

env_variables:
A_VARIABLE: "value"
EOF

# Deploy the changes
gcloud app deploy

# Update the SA if you need it (and if you have actas permissions)
gcloud app update --service-account=<sa>@$PROJECT_ID.iam.gserviceaccount.com
```
Eğer **zaten bir AppEngine'i ele geçirdiyseniz** ve **`appengine.applications.update`** ve **actAs** izinleriniz varsa, AppEngine tarafından kullanılan hizmet hesabını şu şekilde değiştirebilirsiniz:
```bash
gcloud app update --service-account=<sa>@$PROJECT_ID.iam.gserviceaccount.com
```
### `appengine.instances.enableDebug`, `appengine.instances.get`, `appengine.instances.list`, `appengine.operations.get`, `appengine.services.get`, `appengine.services.list`, `appengine.versions.get`, `appengine.versions.list`, `compute.projects.get`

Bu izinlerle, **App Engine örneklerine ssh ile giriş yapmak** mümkündür, türü **esnek** (standart değil). Bazı **`list`** ve **`get`** izinleri **gerçekten gerekli olmayabilir**.
```bash
gcloud app instances ssh --service <app-name> --version <version-id> <ID>
```
### `appengine.applications.update`, `appengine.operations.get`

Bunun sadece arka plan SA'nın google'ın uygulamaları kurmak için kullanacağı şeyi değiştirdiğini düşünüyorum, bu yüzden bunu hizmet hesabını çalmak için kötüye kullanabileceğinizi düşünmüyorum.

{% code overflow="wrap" %}
```bash
gcloud app update --service-account=<sa_email>
```
{% endcode %}

### `appengine.versions.getFileContents`, `appengine.versions.update`

Bu izinleri nasıl kullanacağınızdan veya faydalı olup olmadıklarından emin değilim (kod değiştiğinde yeni bir versiyon oluşturulduğu için, sadece kodu veya birinin IAM rolünü güncelleyip güncelleyemeyeceğinizi bilmiyorum, ama sanırım yapabilmelisiniz, belki de bucket içindeki kodu değiştirerek??).

### Buckets üzerinde Yazma Erişimi

Kaynak kodunun bulunduğu bucket'lar üzerinde yazma erişimi olmasına rağmen **kaynak kodunu ve `manifest.json` dosyasını değiştirerek rastgele kod çalıştırmak MÜMKÜN DEĞİLDİ**.\
Belki bucket'ı izliyorsanız ve yeni bir versiyon oluşturulduğu ve kaynak kodu ile manifest yüklendiği anı tespit ederseniz, bunları değiştirerek yeni versiyonun arka kapılı olanları kullanmasını sağlamak mümkün olabilir??

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
