# GCP - Ενίσχυση Προνομίων Κλειδιών API

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 [**στην ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο GitHub.

</details>
{% endhint %}

## Κλειδιά API

Οι ακόλουθες άδειες είναι χρήσιμες για τη δημιουργία και την κλοπή κλειδιών API, όχι αυτή από τα έγγραφα: _Ένα κλειδί API είναι ένα απλό κρυπτογραφημένο string που **αναγνωρίζει μια εφαρμογή χωρίς κάποιον αρχέτυπο**. Είναι χρήσιμα για την πρόσβαση σε **δημόσια δεδομένα ανώνυμα**, και χρησιμοποιούνται για τη **συσχέτιση** των αιτημάτων API με το έργο σας για ποσοστό και **χρέωση**._

Συνεπώς, με ένα κλειδί API μπορείτε να κάνετε την εταιρεία να πληρώσει για τη χρήση του API σας, αλλά δεν θα μπορείτε να ενισχύσετε προνόμια.

Για περισσότερες πληροφορίες σχετικά με τα Κλειδιά API ελέγξτε:

{% content-ref url="../gcp-services/gcp-api-keys-enum.md" %}
[gcp-api-keys-enum.md](../gcp-services/gcp-api-keys-enum.md)
{% endcontent-ref %}

Για άλλους τρόπους δημιουργίας κλειδιών API ελέγξτε:

{% content-ref url="gcp-serviceusage-privesc.md" %}
[gcp-serviceusage-privesc.md](gcp-serviceusage-privesc.md)
{% endcontent-ref %}

### Πρόσβαση με Βία στο Κλειδί API <a href="#apikeys.keys.create" id="apikeys.keys.create"></a>

Καθώς μπορεί να μην γνωρίζετε ποια APIs είναι ενεργοποιημένα στο έργο ή τους περιορισμούς που εφαρμόζονται στο κλειδί API που βρήκατε, θα ήταν ενδιαφέρον να εκτελέσετε το εργαλείο [**https://github.com/ozguralp/gmapsapiscanner**](https://github.com/ozguralp/gmapsapiscanner) και να ελέγξετε **τι μπορείτε να έχετε πρόσβαση με το κλειδί API.**

### `apikeys.keys.create` <a href="#apikeys.keys.create" id="apikeys.keys.create"></a>

Αυτή η άδεια επιτρέπει τη **δημιουργία ενός κλειδιοϋ API**:
```bash
gcloud services api-keys create
Operation [operations/akmf.p7-[...]9] complete. Result: {
"@type":"type.googleapis.com/google.api.apikeys.v2.Key",
"createTime":"2022-01-26T12:23:06.281029Z",
"etag":"W/\"HOhA[...]==\"",
"keyString":"AIzaSy[...]oU",
"name":"projects/5[...]6/locations/global/keys/f707[...]e8",
"uid":"f707[...]e8",
"updateTime":"2022-01-26T12:23:06.378442Z"
}
```
Μπορείτε να βρείτε ένα σενάριο για να αυτοματοποιήσετε την [**δημιουργία, εκμετάλλευση και καθαρισμό ενός ευάλωτου περιβάλλοντος εδώ**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/b-apikeys.keys.create.sh).

{% hint style="danger" %}
Σημειώστε ότι από προεπιλογή οι χρήστες έχουν δικαιώματα να δημιουργούν νέα έργα και τους παρέχεται ρόλος Owner στο νέο έργο. Έτσι, ένας χρήστης θα μπορούσε να **δημιουργήσει ένα έργο και ένα κλειδί API μέσα σε αυτό το έργο**.
{% endhint %}

### `apikeys.keys.getKeyString`, `apikeys.keys.list` <a href="#apikeys.keys.getkeystringapikeys.keys.list" id="apikeys.keys.getkeystringapikeys.keys.list"></a>

Αυτά τα δικαιώματα επιτρέπουν **τη λίστα και τη λήψη όλων των κλειδιών API και τη λήψη του Κλειδιού**:
```bash
for  key  in  $(gcloud services api-keys list --uri); do
gcloud services api-keys get-key-string "$key"
done
```
Μπορείτε να βρείτε ένα σενάριο για να αυτοματοποιήσετε την [**δημιουργία, εκμετάλλευση και καθαρισμό ενός ευάλωτου περιβάλλοντος εδώ**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/c-apikeys.keys.getKeyString.sh).

### `apikeys.keys.undelete` , `apikeys.keys.list` <a href="#serviceusage.apikeys.regenerateapikeys.keys.list" id="serviceusage.apikeys.regenerateapikeys.keys.list"></a>

Αυτές οι άδειες επιτρέπουν τη **λίστα και την ανανέωση διαγραμμένων κλειδιών API**. Το **κλειδί API δίνεται στην έξοδο** μετά την ολοκλήρωση της εντολής **undelete**:
```bash
gcloud services api-keys list --show-deleted
gcloud services api-keys undelete <key-uid>
```
### Δημιουργία Εσωτερικής Εφαρμογής OAuth για phishing άλλων εργαζομένων

Ελέγξτε την παρακάτω σελίδα για να μάθετε πως να το κάνετε, αν και αυτή η ενέργεια ανήκει στην υπηρεσία **`clientauthconfig`** [σύμφωνα με τα έγγραφα](https://cloud.google.com/iap/docs/programmatic-oauth-clients#before-you-begin):

{% content-ref url="../../workspace-security/gws-google-platforms-phishing/" %}
[gws-google-platforms-phishing](../../workspace-security/gws-google-platforms-phishing/)
{% endcontent-ref %}

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** στην 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο GitHub.

</details>
{% endhint %}
