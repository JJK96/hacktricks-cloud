# GCP - Apikeys Privesc

{% hint style="success" %}
Leer & oefen AWS Hack:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hack: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kontroleer die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
{% endhint %}

## Apikeys

Die volgende toestemmings is nuttig om API-sleutels te skep en te steel, nie dit van die dokumente nie: _'n API-sleutel is 'n eenvoudige versleutelde string wat **'n aansoek identifiseer sonder enige hoof**. Hulle is nuttig vir die anonieme toegang tot **openbare data**, en word gebruik om API-versoeke met jou projek te **assosieer** vir kwota en **fakturering**._

Daarom kan jy met 'n API-sleutel maak dat die maatskappy vir jou gebruik van die API betaal, maar jy sal nie in staat wees om voorregte te eskaleer nie.

Vir meer inligting oor API-sleutels kyk:

{% content-ref url="../gcp-services/gcp-api-keys-enum.md" %}
[gcp-api-keys-enum.md](../gcp-services/gcp-api-keys-enum.md)
{% endcontent-ref %}

Vir ander maniere om API-sleutels te skep, kyk:

{% content-ref url="gcp-serviceusage-privesc.md" %}
[gcp-serviceusage-privesc.md](gcp-serviceusage-privesc.md)
{% endcontent-ref %}

### Brute Force API Key toegang <a href="#apikeys.keys.create" id="apikeys.keys.create"></a>

Aangesien jy moontlik nie weet watter API's in die projek geaktiveer is of die beperkings wat op die API-sleutel wat jy gevind het, van toepassing is nie, sou dit interessant wees om die instrument [**https://github.com/ozguralp/gmapsapiscanner**](https://github.com/ozguralp/gmapsapiscanner) te hardloop en te kyk **wat jy met die API-sleutel kan toegang kry.**

### `apikeys.keys.create` <a href="#apikeys.keys.create" id="apikeys.keys.create"></a>

Hierdie toestemming maak dit moontlik om **'n API-sleutel te skep**:
```bash
gcloud services api-keys create
Operation [operations/akmf.p7-[...]9] complete. Result: {
"@type":"type.googleapis.com/google.api.apikeys.v2.Key",
"createTime":"2022-01-26T12:23:06.281029Z",
"etag":"W/\"HOhA[...]==\"",
"keyString":"AIzaSy[...]oU",
"name":"projects/5[...]6/locations/global/keys/f707[...]e8",
"uid":"f707[...]e8",
"updateTime":"2022-01-26T12:23:06.378442Z"
}
```
Jy kan 'n skripsie vind om die [**skepping, uitbuiting en skoonmaak van 'n kwesbare omgewing outomaties te doen hier**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/b-apikeys.keys.create.sh).

{% hint style="danger" %}
Let daarop dat gebruikers standaard toestemmings het om nuwe projekte te skep en hulle die Eienaar rol oor die nuwe projek toegeken word. So 'n gebruiker kan 'n projek en 'n API-sleutel binne hierdie projek **skep**.
{% endhint %}

### `apikeys.keys.getKeyString` , `apikeys.keys.list` <a href="#apikeys.keys.getkeystringapikeys.keys.list" id="apikeys.keys.getkeystringapikeys.keys.list"></a>

Hierdie toestemmings maak dit moontlik om **alle apiSleutels te lys en te kry en die Sleutel te kry**:
```bash
for  key  in  $(gcloud services api-keys list --uri); do
gcloud services api-keys get-key-string "$key"
done
```
Jy kan 'n skripsie vind om die [**skepping, uitbuiting en skoonmaak van 'n kwesbare omgewing outomaties te doen hier**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/c-apikeys.keys.getKeyString.sh).

### `apikeys.keys.undelete` , `apikeys.keys.list` <a href="#serviceusage.apikeys.regenerateapikeys.keys.list" id="serviceusage.apikeys.regenerateapikeys.keys.list"></a>

Hierdie regte laat jou toe om **verwyderde api-sleutels te lys en te hergenereer**. Die **API-sleutel word in die uitset gegee** nadat die **undelete** gedoen is:
```bash
gcloud services api-keys list --show-deleted
gcloud services api-keys undelete <key-uid>
```
### Skep 'n Interne OAuth-aansoek om ander werkers te phish

Kyk na die volgende bladsy om te leer hoe om dit te doen, alhoewel hierdie aksie behoort tot die diens **`clientauthconfig`** [volgens die dokumente](https://cloud.google.com/iap/docs/programmatic-oauth-clients#before-you-begin):

{% content-ref url="../../workspace-security/gws-google-platforms-phishing/" %}
[gws-google-platforms-phishing](../../workspace-security/gws-google-platforms-phishing/)
{% endcontent-ref %}

{% hint style="success" %}
Leer & oefen AWS Hack: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hack: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
{% endhint %}
