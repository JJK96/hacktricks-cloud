# GCP - Cloud Build Unauthenticated Enum

{% hint style="success" %}
AWSハッキングの学習と練習:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPハッキングの学習と練習: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksのサポート</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
* **HackTricks**と**HackTricks Cloud**のGitHubリポジトリにPRを提出して**ハッキングテクニックを共有**してください。

</details>
{% endhint %}

## Cloud Build

Cloud Buildに関する詳細情報は次をチェックしてください：

{% content-ref url="../gcp-services/gcp-cloud-build-enum.md" %}
[gcp-cloud-build-enum.md](../gcp-services/gcp-cloud-build-enum.md)
{% endcontent-ref %}

### cloudbuild.yml

リポジトリに**`cloudbuild.yml`**というファイルが含まれている場合、**そのファイルにバックドアを仕掛ける**ことができます。これはCloud Build内で実行される**コマンドを指定**し、秘密情報を外部に送信し、実行内容を妨害し、**Cloud Buildサービスアカウントを妨害**する可能性があります。

{% hint style="info" %}
GCPには、管理者が外部PRからのビルドシステムの実行を制御できるようにするオプションがあります。コメント制御は、共同作業者/プロジェクト所有者が**ビルドをトリガーするために“/gcbrun”とコメントする必要がある**機能です。この機能を使用すると、インターネット上の誰もがビルドシステムをトリガーできなくなります。
{% endhint %}

関連情報については、GitHub Actionsを攻撃する方法に関するページをチェックできます（これに類似）：

{% content-ref url="../../../pentesting-ci-cd/github-security/abusing-github-actions/" %}
[abusing-github-actions](../../../pentesting-ci-cd/github-security/abusing-github-actions/)
{% endcontent-ref %}

### PR承認

トリガーがPRの場合、**誰でもパブリックリポジトリにPRを行う**ことができるため、**どんなPRでもトリガーの実行を許可**するのは非常に危険です。そのため、デフォルトでは、実行は**所有者と共同作業者に対してのみ自動的**に行われ、他のユーザーのPRでトリガーを実行するには、所有者または共同作業者が`/gcbrun`とコメントする必要があります。

<figure><img src="../../../.gitbook/assets/image (339).png" alt="" width="563"><figcaption></figcaption></figure>

{% hint style="danger" %}
したがって、これが**`Not required`**に設定されている場合、攻撃者は**トリガーを実行するブランチにPRを行い**、悪意のあるコード実行を**`cloudbuild.yml`**ファイルに追加し、cloudbuildの実行を妨害できます（cloudbuildはPRからコードをダウンロードするため、悪意のある**`cloudbuild.yml`**を実行します）。
{% endhint %}

さらに、PRを送信するときに実行する必要があるcloudbuildの実行が簡単に確認できます。GitHubに表示されます：

<figure><img src="../../../.gitbook/assets/image (340).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
そのため、cloudbuildが実行されなくても、攻撃者は**企業に属するGCPプロジェクトのプロジェクト名**を見ることができます。
{% endhint %}

{% hint style="success" %}
AWSハッキングの学習と練習:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPハッキングの学習と練習: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksのサポート</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
* **HackTricks**と**HackTricks Cloud**のGitHubリポジトリにPRを提出して**ハッキングテクニックを共有**してください。

</details>
{% endhint %}
