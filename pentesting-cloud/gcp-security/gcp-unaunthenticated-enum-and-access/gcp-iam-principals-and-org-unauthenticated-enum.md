# GCP - IAM, Αρχές & Απροσδιόριστη Απαρίθμηση Οργανισμού

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 [**στην ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Κοινοποιήστε κόλπα χάκερ καταθέτοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο GitHub.

</details>
{% endhint %}

## Iam & Αρχές GCP&#x20;

Για περισσότερες πληροφορίες ελέγξτε:

{% content-ref url="../gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](../gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

### Χρησιμοποιείται το domain στο Workspace;

1. **Έλεγχος εγγραφών DNS**

Αν έχει εγγραφή **`google-site-verification`** είναι πιθανό ότι χρησιμοποιεί (ή χρησιμοποιούσε) το Workspace:
```
dig txt hacktricks.xyz

[...]
hacktricks.xyz.		3600	IN	TXT	"google-site-verification=2mWyPXMPXEEy6QqWbCfWkxFTcQhyYdwHrOxee1Yeo-0"
hacktricks.xyz.		3600	IN	TXT	"google-site-verification=C19PtLcZ1EGyzUYYJTX1Tp6bOGessxzN9gqE-SVKhRA"
hacktricks.xyz.		300	IN	TXT	"v=spf1 include:usb._netblocks.mimecast.com include:_spf.google.com include:_spf.psm.knowbe4.com include:_spf.salesforce.com include:spf.mandrillapp.com ~all"
```
Αν κάτι σαν το **`include:_spf.google.com`** εμφανίζεται, επιβεβαιώνει την ύπαρξή του (σημείωσε ότι αν δεν εμφανίζεται δεν το απορρίπτει καθώς μια τομέας μπορεί να είναι στο Workspace χωρίς να χρησιμοποιεί το gmail ως πάροχος ηλεκτρονικού ταχυδρομείου).

2. **Προσπάθησε να δημιουργήσεις ένα Workspace με αυτόν τον τομέα**

Μια άλλη επιλογή είναι να προσπαθήσεις να δημιουργήσεις ένα Workspace χρησιμοποιώντας τον τομέα, αν **διαμαρτύρεται ότι ο τομέας χρησιμοποιείται ήδη** (όπως στην εικόνα), τότε ξέρεις ότι χρησιμοποιείται!

Για να δοκιμάσεις να δημιουργήσεις έναν τομέα Workspace ακολούθησε: [https://workspace.google.com/business/signup/welcome](https://workspace.google.com/business/signup/welcome)

<figure><img src="../../../.gitbook/assets/image (330).png" alt=""><figcaption></figcaption></figure>

3. **Δοκίμασε να ανακτήσεις τον κωδικό πρόσβασης ενός email που χρησιμοποιεί αυτόν τον τομέα**

Αν γνωρίζεις οποιαδήποτε έγκυρη διεύθυνση email που χρησιμοποιείται σε αυτόν τον τομέα (π.χ.: admin@email.com ή info@email.com) μπορείς να δοκιμάσεις να **ανακτήσεις τον λογαριασμό** στη διεύθυνση [https://accounts.google.com/signin/v2/recoveryidentifier](https://accounts.google.com/signin/v2/recoveryidentifier), και αν δεν εμφανιστεί σφάλμα που υποδεικνύει ότι η Google δεν έχει ιδέα για αυτόν τον λογαριασμό, τότε χρησιμοποιείται το Workspace.

### Απαρίθμηση emails και λογαριασμών υπηρεσιών

Είναι δυνατόν να **απαριθμήσεις έγκυρα emails ενός τομέα Workspace και emails λογαριασμών υπηρεσιών** δοκιμάζοντας να τους αναθέσεις δικαιώματα και ελέγχοντας τα μηνύματα σφάλματος. Για αυτό χρειάζεσαι μόνο δικαιώματα για να αναθέσεις άδεια σε ένα έργο (το οποίο μπορεί να είναι απλά δικό σου).

Σημείωσε ότι για να τα ελέγξεις αλλά ακόμα κι αν υπάρχουν να μην τους χορηγήσεις άδεια μπορείς να χρησιμοποιήσεις τον τύπο **`serviceAccount`** όταν είναι **`χρήστης`** και **`χρήστης`** όταν είναι **`SA`**:

{% code overflow="wrap" %}
```bash
# Try to assign permissions to user 'unvalid-email-34r434f@hacktricks.xyz'
# but indicating it's a service account
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:unvalid-email-34r434f@hacktricks.xyz' \
--role='roles/viewer'
## Response:
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: User unvalid-email-34r434f@hacktricks.xyz does not exist.

# Now try with a valid email
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:support@hacktricks.xyz' \
--role='roles/viewer'
# Response:
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: Principal support@hacktricks.xyz is of type "user". The principal should appear as "user:support@hacktricks.xyz". See https://cloud.google.com/iam/help/members/types for additional documentation.
```
{% endcode %}

Σημειώστε ότι όταν η διεύθυνση email του χρήστη ήταν έγκυρη, το μήνυμα σφάλματος υποδήλωνε ότι ο τύπος δεν είναι σωστός, έτσι καταφέραμε να ανακαλύψουμε ότι η διεύθυνση email support@hacktricks.xyz υπάρχει χωρίς να της έχουν δοθεί κάποια προνόμια.

Μπορείτε να κάνετε το **ίδιο με τους λογαριασμούς υπηρεσιών** χρησιμοποιώντας τον τύπο **`user:`** αντί για **`serviceAccount:`**:

{% code overflow="wrap" %}
```bash
# Non existent
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:<invalid-sa-name>@<proj-uniq-name>.iam.gserviceaccount.com' \
--role='roles/viewer'
# Response
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: User <invalid-sa-name>@<proj-uniq-name>.iam.gserviceaccount.com does not exist.

# Existent
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:<sa-name>@<proj-uniq-name>.iam.gserviceaccount.com' \
--role='roles/viewer'
# Response
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: Principal testing@digital-bonfire-410512.iam.gserviceaccount.com is of type "serviceAccount". The principal should appear as "serviceAccount:testing@digital-bonfire-410512.iam.gserviceaccount.com". See https://cloud.google.com/iam/help/members/types for additional documentation.
```
{% endcode %}

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 [**στην ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
