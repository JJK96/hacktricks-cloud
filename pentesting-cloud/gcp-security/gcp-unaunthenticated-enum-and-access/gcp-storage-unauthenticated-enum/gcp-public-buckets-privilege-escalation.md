# GCP - パブリックバケット特権昇格

{% hint style="success" %}
AWSハッキングの学習と練習:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPハッキングの学習と練習: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポート</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
* **HackTricks**と**HackTricks Cloud**のgithubリポジトリにPRを提出して**ハッキングトリックを共有**してください。

</details>
{% endhint %}

## バケット特権昇格

バケットポリシーが「allUsers」または「allAuthenticatedUsers」にバケットポリシーの書き込みを許可している場合（**storage.buckets.setIamPolicy**権限）**，**誰でもバケットポリシーを変更して自分自身に完全アクセス権を付与できます。

### 権限の確認

バケットの権限を確認する方法は2つあります。1つ目は、`https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam`にリクエストを送信するか、`gsutil iam get gs://BUCKET_NAME`を実行して権限を要求することです。

ただし、あなたのユーザー（おそらくallUsersまたはallAuthenticatedUsersに属している可能性があります）がバケットのiamポリシーを読む権限（storage.buckets.getIamPolicy）を持っていない場合、それは機能しません。

常に機能するもう1つのオプションは、バケットのtestPermissionsエンドポイントを使用して、指定された権限を持っているかどうかを調べることです。たとえば、次のようにアクセスします：`https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam/testPermissions?permissions=storage.buckets.delete&permissions=storage.buckets.get&permissions=storage.buckets.getIamPolicy&permissions=storage.buckets.setIamPolicy&permissions=storage.buckets.update&permissions=storage.objects.create&permissions=storage.objects.delete&permissions=storage.objects.get&permissions=storage.objects.list&permissions=storage.objects.update`

### 昇格

`Storage Admin`を`allAuthenticatedUsers`に付与するには、次のように実行できます：
```
gsutil iam ch group:allAuthenticatedUsers:admin gs://BUCKET_NAME
```
別の攻撃手法は、**バケットを削除してそれをあなたのアカウントで再作成し、所有権を盗む**ことです。

## 参考文献

* [https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/](https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/)

{% hint style="success" %}
AWSハッキングの学習と練習:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPハッキングの学習と練習: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksのサポート</summary>

* [**購読プラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
* **HackTricks**と**HackTricks Cloud**のGitHubリポジトリにPRを提出して、ハッキングトリックを共有してください。

</details>
{% endhint %}
