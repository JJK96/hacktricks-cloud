# GCP - Privilegije eskalacije javnih kanti

{% hint style="success" %}
Naučite i vežbajte hakovanje AWS-a: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Naučite i vežbajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Eskalacija privilegija kanti

Ako je politika kante dozvolila "allUsers" ili "allAuthenticatedUsers" da **pišu u svoju politiku kante** (dozvola **storage.buckets.setIamPolicy**), tada bilo ko može izmeniti politiku kante i dodeliti sebi pun pristup.

### Provera dozvola

Postoje 2 načina za proveru dozvola nad kantom. Prvi način je da ih zatražite praveći zahtev ka `https://www.googleapis.com/storage/v1/b/IME_KANTE/iam` ili pokretanjem `gsutil iam get gs://IME_KANTE`.

Međutim, ako vaš korisnik (potencijalno pripadajući allUsers ili allAuthenticatedUsers") nema dozvole da pročita iam politiku kante (storage.buckets.getIamPolicy), to neće raditi.

Druga opcija koja će uvek raditi je korišćenje testPermissions endpointa kante kako biste saznali da li imate određenu dozvolu, na primer pristupanje: `https://www.googleapis.com/storage/v1/b/IME_KANTE/iam/testPermissions?permissions=storage.buckets.delete&permissions=storage.buckets.get&permissions=storage.buckets.getIamPolicy&permissions=storage.buckets.setIamPolicy&permissions=storage.buckets.update&permissions=storage.objects.create&permissions=storage.objects.delete&permissions=storage.objects.get&permissions=storage.objects.list&permissions=storage.objects.update`

### Eskalacija

Da biste dodelili `Storage Admin` korisnicima `allAuthenticatedUsers`, moguće je pokrenuti:
```
gsutil iam ch group:allAuthenticatedUsers:admin gs://BUCKET_NAME
```
Još jedan napad bio bi **ukloniti kantu i ponovo je kreirati u vašem nalogu kako biste ukrali vlasništvo**.

## Reference

* [https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/](https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/)
