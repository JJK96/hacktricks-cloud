# GCP - Logging Post Exploitation

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basiese Inligting

Vir meer inligting kyk:

{% content-ref url="../gcp-services/gcp-logging-enum.md" %}
[gcp-logging-enum.md](../gcp-services/gcp-logging-enum.md)
{% endcontent-ref %}

Vir ander maniere om monitering te ontwrig kyk:

{% content-ref url="gcp-monitoring-post-exploitation.md" %}
[gcp-monitoring-post-exploitation.md](gcp-monitoring-post-exploitation.md)
{% endcontent-ref %}

### Standaard Logging

**By verstek sal jy nie gevang word net vir die uitvoer van leesaksies nie. Vir meer inligting kyk die Logging Enum afdeling.**

### Voeg Uitsonderde Principal by

In [https://console.cloud.google.com/iam-admin/audit/allservices](https://console.cloud.google.com/iam-admin/audit/allservices) en [https://console.cloud.google.com/iam-admin/audit](https://console.cloud.google.com/iam-admin/audit) is dit moontlik om principals by te voeg om nie logs te genereer nie. 'n Aanvaller kan dit misbruik om te voorkom dat hulle gevang word.

### Lees logs - `logging.logEntries.list`

{% code overflow="wrap" %}
```bash
# Read logs
gcloud logging read "logName=projects/your-project-id/logs/log-id" --limit=10 --format=json

# Everything from a timestamp
gcloud logging read "timestamp >= \"2023-01-01T00:00:00Z\"" --limit=10 --format=json

# Use these options to indicate a different bucket or view to use: --bucket=_Required  --view=_Default
```
{% endcode %}

### `logging.logs.delete`

{% code overflow="wrap" %}

### `logging.sinks.delete`

Hierdie aksie laat 'n aanvaller toe om 'n log sink te verwyder. Dit kan gebruik word om log data wat na 'n eksterne bestemming gestuur word, te verwyder.

### `logging.sinks.update`

Hierdie aksie laat 'n aanvaller toe om 'n log sink op te dateer. Dit kan gebruik word om die bestemming van log data te verander, wat kan help om opsporing te vermy.

### `logging.sinks.create`

Hierdie aksie laat 'n aanvaller toe om 'n nuwe log sink te skep. Dit kan gebruik word om log data na 'n aanvaller-beheerde bestemming te stuur.

### `logging.exclusions.create`

Hierdie aksie laat 'n aanvaller toe om 'n uitsluiting te skep wat sekere log inskrywings uitsluit van logging. Dit kan gebruik word om sekere aktiwiteite te verberg.

### `logging.exclusions.delete`

Hierdie aksie laat 'n aanvaller toe om 'n bestaande uitsluiting te verwyder. Dit kan gebruik word om logging vir sekere aktiwiteite weer in te skakel.

### `logging.exclusions.update`

Hierdie aksie laat 'n aanvaller toe om 'n bestaande uitsluiting op te dateer. Dit kan gebruik word om die re√´ls vir watter log inskrywings uitgesluit word, te verander.

{% endcode %}
```bash
# Delete all entries from a log in the _Default log bucket - logging.logs.delete
gcloud logging logs delete <log-name>
```
{% endcode %}

### Skryf logs - `logging.logEntries.create`

{% code overflow="wrap" %}
```bash
# Write a log entry to try to disrupt some system
gcloud logging write LOG_NAME "A deceptive log entry" --severity=ERROR
```
{% endcode %}

### `logging.buckets.update`

{% code overflow="wrap" %}
```bash
# Set retention period to 1 day (_Required has a fixed one of 400days)

gcloud logging buckets update bucketlog --location=<location> --description="New description" --retention-days=1
```
{% endcode %}

### `logging.buckets.delete`

### Beskrywing

Hierdie aksie laat 'n aanvaller toe om 'n logboek-emmer te verwyder. Dit kan gebruik word om spore van kwaadwillige aktiwiteite uit te wis.

### Voorbeeld

```bash
gcloud logging buckets delete [BUCKET_NAME] --location=[LOCATION]
```

### `logging.sinks.delete`

### Beskrywing

Hierdie aksie laat 'n aanvaller toe om 'n logboek-sink te verwyder. Dit kan gebruik word om te verhoed dat logboeke na 'n sekond√™re ligging gestuur word vir berging of analise.

### Voorbeeld

```bash
gcloud logging sinks delete [SINK_NAME]
```

### `logging.logs.delete`

### Beskrywing

Hierdie aksie laat 'n aanvaller toe om spesifieke logboeke te verwyder. Dit kan gebruik word om spesifieke inskrywings wat kwaadwillige aktiwiteite toon, te verwyder.

### Voorbeeld

```bash
gcloud logging logs delete [LOG_NAME]
```

### `logging.exclusions.create`

### Beskrywing

Hierdie aksie laat 'n aanvaller toe om 'n uitsluiting te skep wat verhoed dat sekere logboeke ingesamel word. Dit kan gebruik word om te verhoed dat logboeke wat kwaadwillige aktiwiteite toon, ingesamel word.

### Voorbeeld

```bash
gcloud logging exclusions create [EXCLUSION_NAME] --filter="[FILTER]"
```

### `logging.exclusions.delete`

### Beskrywing

Hierdie aksie laat 'n aanvaller toe om 'n bestaande uitsluiting te verwyder. Dit kan gebruik word om logboek-insameling te herstel nadat kwaadwillige aktiwiteite voltooi is.

### Voorbeeld

```bash
gcloud logging exclusions delete [EXCLUSION_NAME]
```
```bash
# Delete log bucket
gcloud logging buckets delete BUCKET_NAME --location=<location>
```
### `logging.links.delete`

{% code overflow="wrap" %}
```bash
# Delete link
gcloud logging links delete <link-id> --bucket <bucket> --location <location>
```
{% endcode %}

### `logging.views.delete`

### Beskrywing

Hierdie aksie laat 'n aanvaller toe om 'n log view te verwyder. Dit kan gebruik word om spore van kwaadwillige aktiwiteite uit te wis.

### Impak

Die verwydering van log views kan dit moeiliker maak vir sekuriteitspanne om kwaadwillige aktiwiteite op te spoor en daarop te reageer. Dit kan lei tot 'n langer tydperk van ongemerkte kompromie.

### Aanbevelings

- Monitor en hersien gereeld log views.
- Beperk toestemmings tot slegs diegene wat dit nodig het.
- Gebruik waarskuwings om te identifiseer wanneer log views verwyder word.

### `logging.sinks.delete`

### Beskrywing

Hierdie aksie laat 'n aanvaller toe om 'n log sink te verwyder. Dit kan gebruik word om te voorkom dat logs na 'n sekuriteitsinligting- en gebeurtenisbestuurstelsel (SIEM) of ander moniteringstelsels gestuur word.

### Impak

Die verwydering van log sinks kan die sigbaarheid van sekuriteitspanne verminder en die tyd verhoog wat nodig is om 'n kompromie op te spoor en daarop te reageer.

### Aanbevelings

- Monitor en hersien gereeld log sinks.
- Beperk toestemmings tot slegs diegene wat dit nodig het.
- Gebruik waarskuwings om te identifiseer wanneer log sinks verwyder word.

### `logging.logs.delete`

### Beskrywing

Hierdie aksie laat 'n aanvaller toe om logs direk te verwyder. Dit kan gebruik word om spore van kwaadwillige aktiwiteite uit te wis.

### Impak

Die verwydering van logs kan dit baie moeiliker maak vir sekuriteitspanne om kwaadwillige aktiwiteite op te spoor en daarop te reageer. Dit kan lei tot 'n langer tydperk van ongemerkte kompromie.

### Aanbevelings

- Monitor en hersien gereeld logs.
- Beperk toestemmings tot slegs diegene wat dit nodig het.
- Gebruik waarskuwings om te identifiseer wanneer logs verwyder word.
```bash
# Delete a logging view to remove access to anyone using it
gcloud logging views delete <view-id> --bucket=<bucket> --location=global
```
### `logging.views.update`

{% code overflow="wrap" %}
```bash
# Update a logging view to hide data
gcloud logging views update <view-id> --log-filter="resource.type=gce_instance" --bucket=<bucket> --location=global --description="New description for the log view"
```
{% endcode %}

### `logging.logMetrics.update`

{% code overflow="wrap" %}

### `logging.logMetrics.list`

Hierdie aksie laat 'n aanvaller toe om 'n lys van log metrics te kry. Dit kan gebruik word om te verstaan watter logs gemonitor word en om moontlike aanvalle beter te beplan.

### `logging.logMetrics.get`

Hierdie aksie laat 'n aanvaller toe om spesifieke log metrics te kry. Dit kan gebruik word om meer gedetailleerde inligting oor die gemonitorde logs te kry.

### `logging.logMetrics.create`

Hierdie aksie laat 'n aanvaller toe om nuwe log metrics te skep. Dit kan gebruik word om vals logs te genereer of om bestaande logs te manipuleer.

### `logging.logMetrics.delete`

Hierdie aksie laat 'n aanvaller toe om bestaande log metrics te verwyder. Dit kan gebruik word om spore van 'n aanval te verwyder of om log monitoring te ontwrig.

### `logging.sinks.list`

Hierdie aksie laat 'n aanvaller toe om 'n lys van log sinks te kry. Dit kan gebruik word om te verstaan waarheen logs gestuur word en om moontlike aanvalle beter te beplan.

### `logging.sinks.get`

Hierdie aksie laat 'n aanvaller toe om spesifieke log sinks te kry. Dit kan gebruik word om meer gedetailleerde inligting oor die bestemming van logs te kry.

### `logging.sinks.create`

Hierdie aksie laat 'n aanvaller toe om nuwe log sinks te skep. Dit kan gebruik word om logs na 'n aanvaller-beheerde bestemming te stuur.

### `logging.sinks.update`

Hierdie aksie laat 'n aanvaller toe om bestaande log sinks te wysig. Dit kan gebruik word om die bestemming van logs te verander na 'n aanvaller-beheerde bestemming.

### `logging.sinks.delete`

Hierdie aksie laat 'n aanvaller toe om bestaande log sinks te verwyder. Dit kan gebruik word om spore van 'n aanval te verwyder of om log monitoring te ontwrig.

### `logging.exclusions.list`

Hierdie aksie laat 'n aanvaller toe om 'n lys van log exclusions te kry. Dit kan gebruik word om te verstaan watter logs uitgesluit word van monitoring.

### `logging.exclusions.get`

Hierdie aksie laat 'n aanvaller toe om spesifieke log exclusions te kry. Dit kan gebruik word om meer gedetailleerde inligting oor die uitgeslote logs te kry.

### `logging.exclusions.create`

Hierdie aksie laat 'n aanvaller toe om nuwe log exclusions te skep. Dit kan gebruik word om sekere logs uit te sluit van monitoring.

### `logging.exclusions.update`

Hierdie aksie laat 'n aanvaller toe om bestaande log exclusions te wysig. Dit kan gebruik word om die uitsluiting van sekere logs te verander.

### `logging.exclusions.delete`

Hierdie aksie laat 'n aanvaller toe om bestaande log exclusions te verwyder. Dit kan gebruik word om sekere logs weer in te sluit in monitoring.
```bash
# Update log based metrics - logging.logMetrics.update
gcloud logging metrics update <metric-name> --description="Changed metric description" --log-filter="severity>CRITICAL" --project=PROJECT_ID
```
{% endcode %}

### `logging.logMetrics.delete`

### Beskrywing

Hierdie regte laat 'n aanvaller toe om logmetrieke te verwyder. Dit kan gebruik word om spore van kwaadwillige aktiwiteite uit die logboeke te verwyder.

### Voorbeeld

```bash
gcloud logging metrics delete [METRIC_NAME]
```

### Impak

Die verwydering van logmetrieke kan dit moeiliker maak vir sekuriteitspanne om kwaadwillige aktiwiteite op te spoor en daarop te reageer.
```bash
# Delete log based metrics - logging.logMetrics.delete
gcloud logging metrics delete <metric-name>
```
### `logging.sinks.delete`

Die `logging.sinks.delete`-toestemming laat 'n aanvaller toe om 'n log sink te verwyder. Dit kan gebruik word om log data te verwyder wat andersins 'n aanval sou kon blootstel. 

### `logging.sinks.update`

Die `logging.sinks.update`-toestemming laat 'n aanvaller toe om 'n log sink te wysig. Dit kan gebruik word om die bestemming van log data te verander, wat kan help om opsporing te vermy.
```bash
# Delete sink - logging.sinks.delete
gcloud logging sinks delete <sink-name>
```
### `logging.sinks.update`

{% code overflow="wrap" %}
```bash
# Disable sink - logging.sinks.update
gcloud logging sinks update <sink-name> --disabled

# Createa filter to exclude attackers logs - logging.sinks.update
gcloud logging sinks update SINK_NAME --add-exclusion="name=exclude-info-logs,filter=severity<INFO"

# Change where the sink is storing the data - logging.sinks.update
gcloud logging sinks update <sink-name> new-destination

# Change the service account to one withuot permissions to write in the destination - logging.sinks.update
gcloud logging sinks update SINK_NAME --custom-writer-identity=attacker-service-account-email --project=PROJECT_ID

# Remove explusions to try to overload with logs - logging.sinks.update
gcloud logging sinks update SINK_NAME --clear-exclusions

# If the sink exports to BigQuery, an attacker might enable or disable the use of partitioned tables, potentially leading to inefficient querying and higher costs. - logging.sinks.update
gcloud logging sinks update SINK_NAME --use-partitioned-tables
gcloud logging sinks update SINK_NAME --no-use-partitioned-tables
```
{% endcode %}

{% hint style="success" %}
Leer en oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer en oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repo's.

</details>
{% endhint %}
