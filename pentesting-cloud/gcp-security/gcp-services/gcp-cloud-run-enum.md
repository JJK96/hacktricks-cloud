# GCP - Απαρίθμηση Cloud Run

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 [**στην ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ κάνοντας υποβολή PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Το Cloud Run είναι μια διαχειριζόμενη πλατφόρμα υπολογισμού serverless που σας επιτρέπει να **εκτελέσετε containers** απευθείας πάνω στην κλιμακούμενη υποδομή της Google.

Μπορείτε να εκτελέσετε το container σας ή αν χρησιμοποιείτε Go, Node.js, Python, Java, .NET Core ή Ruby, μπορείτε να χρησιμοποιήσετε την [επιλογή ανάπτυξης βασισμένη στον κώδικα πηγής](https://cloud.google.com/run/docs/deploying-source-code) που **κατασκευάζει το container για εσάς.**

Η Google έχει χτίσει το Cloud Run για να **λειτουργεί καλά μαζί με άλλες υπηρεσίες στο Google Cloud**, έτσι μπορείτε να δημιουργήσετε πλήρως λειτουργικές εφαρμογές.

### Υπηρεσίες και εργασίες <a href="#services-and-jobs" id="services-and-jobs"></a>

Στο Cloud Run, ο κώδικάς σας μπορεί να εκτελείται είτε συνεχώς ως _**υπηρεσία**_ είτε ως _**εργασία**_. Και οι ϥπηρεσίες και οι εργασίες εκτελούνται στον ίδιο περιβάλλον και μπορούν να χρησιμοποιήσουν τις ίδιες ενσωματώσεις με άλλες υπηρεσίες στο Google Cloud.

* **Υπηρεσίες Cloud Run.** Χρησιμοποιούνται για την εκτέλεση κώδικα που ανταποκρίνεται σε αιτήσεις web ή σε συμβάντα.
* **Εργασίες Cloud Run.** Χρησιμοποιούνται για την εκτέλεση κώδικα που εκτελεί μια εργασία και τερματίζεται όταν η εργασία ολοκληρωθεί.

## Υπηρεσία Cloud Run

Το Google [Cloud Run](https://cloud.google.com/run) είναι μια άλλη προσφορά serverless όπου μπορείτε να αναζητήσετε μεταβλητές περιβάλλοντος επίσης. Το Cloud Run δημιουργεί ένα μικρό web server, που εκτελείται στη θύρα 8080 μέσα στο container από προεπιλογή, που περιμένει μια αίτηση HTTP GET. Όταν λαμβάνεται η αίτηση, εκτελείται μια εργασία και το αρχείο καταγραφής της εργασίας εξάγεται μέσω μιας απάντησης HTTP.

### Σχετικές λεπτομέρειες

* Από **προεπιλογή**, η **πρόσβαση** στον web server είναι **δημόσια**, αλλά μπορεί επίσης να είναι **περιορισμένη στην εσωτερική κίνηση** (VPC...)\
Επιπλέον, η **ταυτοποίηση** για να επικοινωνήσετε με τον web server μπορεί να είναι **επιτρεπτή για όλους** ή να **απαιτεί ταυτοποίηση μέσω του IAM**.
* Από προεπιλογή, η **κρυπτογράφηση** χρησιμοποιεί ένα **διαχειριζόμενο κλειδί Google**, αλλά μπορεί επίσης να επιλεγεί ένα **CMEK** (Προσαρμοσμένο Κλειδί Κρυπτογράφησης Πελάτη) από το **KMS**.
* Από **προεπιλογή**, ο λογαριασμός υπηρεσίας που χρησιμοποιείται είναι ο **προεπιλεγμένος λογαριασμός Compute Engine** που έχει πρόσβαση **Επεξεργαστή** στο έργο και έχει το **scope `cloud-platform`.**
* Είναι δυνατόν να οριστούν **μεταβλητές περιβάλλοντος καθαρού κειμένου** για την εκτέλεση, και ακόμη να **προσαρτηθούν μυστικά cloud** ή **προστεθούν μυστικά cloud στις μεταβλητές περιβάλλοντος.**
* Είναι επίσης δυνατόν να **προσθέσετε συνδέσεις με το Cloud SQL** και να **προσαρτήσετε ένα σύστημα αρχείων.**
* Οι **URLs** των υπηρεσιών που έχουν αναπτυχθεί είναι παρόμοια με **`https://<svc-name>-<τυχαίο>.a.run.app`**
* Μια Υπηρεσία Run μπορεί να έχει **περισσότερες από 1 έκδοση ή αναθεώρηση**, και να **διανέμει την κίνηση** μεταξύ πολλών αναθεωρήσεων. 

### Απαρίθμηση
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Cloud Run Jobs

Τα Cloud Run jobs είναι πιο κατάλληλα για **containers που εκτελούνται μέχρι τέλους και δεν εξυπηρετούν αιτήσεις**. Τα jobs δεν έχουν τη δυνατότητα να εξυπηρετούν αιτήσεις ή να ακούνε σε έναν θύρα. Αυτό σημαίνει ότι, αντίθετα με τις υπηρεσίες Cloud Run, τα jobs δεν πρέπει να περιλαμβάνουν έναν web server. Αντίθετα, τα containers των jobs πρέπει να τερματίζονται όταν ολοκληρώσουν την εκτέλεσή τους.

### Απαρίθμηση
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## Εscalation προνομίων

Στην ακόλουθη σελίδα, μπορείτε να ελέγξετε πώς να **καταχραστείτε τα δικαιώματα του cloud run για εscalation προνομίων**:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

## Μη εξουσιοδοτημένη πρόσβαση

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md" %}
[gcp-cloud-run-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md)
{% endcontent-ref %}

## Μετά από εκμετάλλευση

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md" %}
[gcp-cloud-run-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md)
{% endcontent-ref %}

## Διατήρηση

{% content-ref url="../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md" %}
[gcp-cloud-run-persistence.md](../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md)
{% endcontent-ref %}

## Αναφορές

* [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)
