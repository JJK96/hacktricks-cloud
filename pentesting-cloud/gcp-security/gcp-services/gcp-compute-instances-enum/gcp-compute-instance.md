# GCP - Compute Instances

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}

## Βασικές Πληροφορίες

Τα Google Cloud Compute Instances είναι **προσαρμόσιμες εικονικές μηχανές στην υποδομή cloud της Google**, προσφέροντας κλιμακούμενη και κατ' απαίτηση υπολογιστική ισχύ για ένα ευρύ φάσμα εφαρμογών. Παρέχουν χαρακτηριστικά όπως παγκόσμια ανάπτυξη, επίμονη αποθήκευση, ευέλικτες επιλογές λειτουργικού συστήματος και ισχυρές ενσωματώσεις δικτύου και ασφάλειας, καθιστώντας τα μια ευέλικτη επιλογή για φιλοξενία ιστοσελίδων, επεξεργασία δεδομένων και εκτέλεση εφαρμογών αποτελεσματικά στο cloud.

### Confidential VM

Τα Confidential VMs χρησιμοποιούν **χαρακτηριστικά ασφάλειας βασισμένα σε υλικό** που προσφέρονται από την τελευταία γενιά επεξεργαστών AMD EPYC, τα οποία περιλαμβάνουν κρυπτογράφηση μνήμης και ασφαλή κρυπτογραφημένη εικονικοποίηση. Αυτά τα χαρακτηριστικά επιτρέπουν στο VM να προστατεύει τα δεδομένα που επεξεργάζεται και αποθηκεύει από το λειτουργικό σύστημα του κεντρικού υπολογιστή και τον υπερεπόπτη.

Για να εκτελέσετε ένα Confidential VM μπορεί να χρειαστεί να **αλλάξετε** πράγματα όπως τον **τύπο** της **μηχανής**, το **interface** δικτύου, την **εικόνα του δίσκου εκκίνησης**.

### Δίσκος & Κρυπτογράφηση Δίσκου

Είναι δυνατό να **επιλέξετε τον δίσκο** που θα χρησιμοποιήσετε ή να **δημιουργήσετε έναν νέο**. Αν επιλέξετε έναν νέο μπορείτε:

* Να επιλέξετε το **μέγεθος** του δίσκου
* Να επιλέξετε το **OS**
* Να υποδείξετε αν θέλετε να **διαγράψετε τον δίσκο όταν διαγραφεί η instance**
* **Κρυπτογράφηση**: Από **προεπιλογή** θα χρησιμοποιηθεί ένα **κλειδί διαχειριζόμενο από την Google**, αλλά μπορείτε επίσης να **επιλέξετε ένα κλειδί από το KMS** ή να υποδείξετε **ακατέργαστο κλειδί για χρήση**.

### Ανάπτυξη Container

Είναι δυνατό να αναπτύξετε ένα **container** μέσα στην εικονική μηχανή.\
Είναι δυνατό να διαμορφώσετε την **εικόνα** που θα χρησιμοποιηθεί, να ορίσετε την **εντολή** που θα εκτελεστεί μέσα, **επιχειρήματα**, να προσαρτήσετε έναν **όγκο** και **μεταβλητές περιβάλλοντος** (ευαίσθητες πληροφορίες;) και να διαμορφώσετε διάφορες επιλογές για αυτό το container όπως εκτέλεση ως **προνομιούχο**, stdin και pseudo TTY.

### Service Account

Από προεπιλογή, θα χρησιμοποιηθεί το **Compute Engine default service account**. Το email αυτού του SA είναι σαν: `<proj-num>-compute@developer.gserviceaccount.com`\
Αυτός ο λογαριασμός υπηρεσίας έχει **Editor role σε ολόκληρο το έργο (υψηλά προνόμια).**

Και οι **προεπιλεγμένες προσβάσεις** είναι οι εξής:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Πρόσβαση ανάγνωσης σε buckets :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

Ωστόσο, είναι δυνατό να **χορηγήσετε `cloud-platform` με ένα κλικ** ή να καθορίσετε **προσαρμοσμένες**.

<figure><img src="../../../../.gitbook/assets/image (327).png" alt=""><figcaption></figcaption></figure>

### Firewall

Είναι δυνατό να επιτρέψετε την κυκλοφορία HTTP και HTTPS.

<figure><img src="../../../../.gitbook/assets/image (326).png" alt=""><figcaption></figcaption></figure>

### Δικτύωση

* **IP Forwarding**: Είναι δυνατό να **ενεργοποιήσετε το IP forwarding** από τη δημιουργία της instance.
* **Hostname**: Είναι δυνατό να δώσετε στην instance ένα μόνιμο hostname.
* **Interface**: Είναι δυνατό να προσθέσετε ένα δίκτυο interface.

### Πρόσθετη Ασφάλεια

Αυτές οι επιλογές θα **αυξήσουν την ασφάλεια** του VM και συνιστώνται:

* **Secure boot:** Το Secure boot βοηθά στην προστασία των instances VM σας από κακόβουλο λογισμικό και rootkits σε επίπεδο εκκίνησης και πυρήνα.
* **Enable vTPM:** Το Virtual Trusted Platform Module (vTPM) επικυρώνει την ακεραιότητα της προεκκίνησης και της εκκίνησης του guest VM σας και προσφέρει δημιουργία και προστασία κλειδιών.
* **Integrity supervision:** Η παρακολούθηση ακεραιότητας σας επιτρέπει να παρακολουθείτε και να επαληθεύετε την ακεραιότητα εκκίνησης των shielded VM instances σας χρησιμοποιώντας αναφορές Stackdriver. Απαιτεί την ενεργοποίηση του vTPM.

### Πρόσβαση VM

Ο κοινός τρόπος για να επιτρέψετε την πρόσβαση στο VM είναι με **την επιτρεπόμενη πρόσβαση ορισμένων SSH δημόσιων κλειδιών** στο VM.\
Ωστόσο, είναι επίσης δυνατό να **επιτρέψετε την πρόσβαση στο VM μέσω της υπηρεσίας `os-config` χρησιμοποιώντας IAM**. Επιπλέον, είναι δυνατό να ενεργοποιήσετε 2FA για πρόσβαση στο VM χρησιμοποιώντας αυτήν την υπηρεσία.\
Όταν αυτή η **υπηρεσία** είναι **ενεργοποιημένη**, η πρόσβαση μέσω **SSH κλειδιών απενεργοποιείται.**

<figure><img src="../../../../.gitbook/assets/image (328).png" alt=""><figcaption></figcaption></figure>

### Metadata

Είναι δυνατό να ορίσετε **αυτοματοποίηση** (userdata στο AWS) που είναι **εντολές κελύφους** που θα εκτελούνται κάθε φορά που η μηχανή ενεργοποιείται ή επανεκκινείται.

Είναι επίσης δυνατό να **προσθέσετε επιπλέον τιμές metadata key-value** που θα είναι προσβάσιμες από το metadata endpoint. Αυτές οι πληροφορίες χρησιμοποιούνται συνήθως για μεταβλητές περιβάλλοντος και σενάρια εκκίνησης/τερματισμού. Αυτό μπορεί να ληφθεί χρησιμοποιώντας τη **μέθοδο `describe`** από μια εντολή στην ενότητα απαρίθμησης, αλλά θα μπορούσε επίσης να ανακτηθεί από το εσωτερικό της instance πρόσβασης στο metadata endpoint.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Moreover, **auth token for the attached service account** and **general info** about the instance, network and project is also going to be available from the **metadata endpoint**. For more info check:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Κρυπτογράφηση

Ένα κλειδί κρυπτογράφησης διαχειριζόμενο από την Google χρησιμοποιείται από προεπιλογή, αλλά μπορεί να διαμορφωθεί ένα κλειδί κρυπτογράφησης διαχειριζόμενο από τον πελάτη (CMEK). Μπορείτε επίσης να διαμορφώσετε τι να κάνετε όταν το χρησιμοποιούμενο CMEK ανακληθεί: Τίποτα ή να κλείσετε το VM.

<figure><img src="../../../../.gitbook/assets/image (329).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Γίνετε μέλος της** 💬 [**ομάδας Discord**](https://discord.gg/hRep4RUj7f) ή της [**ομάδας telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}
