# GCP - Compute Instances

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **HackTricks'e PR göndererek hacking ipuçlarını paylaşın** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına.

</details>
{% endhint %}

## Temel Bilgiler

Google Cloud Compute Instances, **Google'ın bulut altyapısında özelleştirilebilir sanal makineler** olup, geniş bir uygulama yelpazesi için ölçeklenebilir ve isteğe bağlı hesaplama gücü sunar. Küresel dağıtım, kalıcı depolama, esnek işletim sistemi seçenekleri ve güçlü ağ ve güvenlik entegrasyonları gibi özellikler sunarak, web sitelerini barındırma, veri işleme ve uygulamaları bulutta verimli bir şekilde çalıştırma için çok yönlü bir seçenek haline getirir.

### Confidential VM

Confidential VM'ler, AMD EPYC işlemcilerin en son neslinin sunduğu **donanım tabanlı güvenlik özelliklerini** kullanır; bu özellikler arasında bellek şifreleme ve güvenli şifrelenmiş sanallaştırma bulunur. Bu özellikler, VM'nin işlediği ve depoladığı verileri, ana işletim sistemi ve hipervizörden bile korumasını sağlar.

Confidential VM çalıştırmak için **makine türü**, ağ **arayüzü**, **önyükleme disk görüntüsü** gibi şeyleri **değiştirmek** gerekebilir.

### Disk & Disk Şifreleme

Kullanılacak **diski seçmek** veya **yeni bir disk oluşturmak** mümkündür. Yeni bir disk seçerseniz:

* Diskin **boyutunu** seçin
* **İşletim sistemini** seçin
* **Diskin, örnek silindiğinde silinmesini isteyip istemediğinizi** belirtin
* **Şifreleme**: **Varsayılan olarak** bir **Google yönetimli anahtar** kullanılacaktır, ancak **KMS'den bir anahtar seçebilir** veya **kullanılacak ham anahtarı belirtebilirsiniz**.

### Container Dağıtımı

Sanal makine içinde bir **container** dağıtmak mümkündür.\
Kullanılacak **görüntüyü** yapılandırmak, içinde çalıştırılacak **komutu**, **argümanları**, bir **hacim** bağlamak ve **çevre değişkenlerini** (hassas bilgiler?) ayarlamak ve bu container için **privileged** olarak çalıştırmak, stdin ve pseudo TTY gibi çeşitli seçenekleri yapılandırmak mümkündür.

### Service Account

Varsayılan olarak, **Compute Engine varsayılan service account** kullanılacaktır. Bu SA'nın e-postası şu şekildedir: `<proj-num>-compute@developer.gserviceaccount.com`\
Bu service account, **tüm proje üzerinde Editor rolüne sahiptir (yüksek ayrıcalıklar).**

Ve **varsayılan erişim kapsamları** şunlardır:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Buckets için okuma erişimi :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

Ancak, **bir tıklama ile `cloud-platform` yetkisi vermek** veya **özel olanları belirtmek** mümkündür.

<figure><img src="../../../../.gitbook/assets/image (327).png" alt=""><figcaption></figcaption></figure>

### Güvenlik Duvarı

HTTP ve HTTPS trafiğine izin vermek mümkündür.

<figure><img src="../../../../.gitbook/assets/image (326).png" alt=""><figcaption></figcaption></figure>

### Ağ

* **IP Yönlendirme**: Örneğin oluşturulmasından itibaren **IP yönlendirmeyi etkinleştirmek** mümkündür.
* **Hostname**: Örneğe kalıcı bir hostname vermek mümkündür.
* **Arayüz**: Bir ağ arayüzü eklemek mümkündür.

### Ekstra Güvenlik

Bu seçenekler, VM'nin **güvenliğini artıracak** ve önerilmektedir:

* **Güvenli önyükleme:** Güvenli önyükleme, VM örneklerinizi önyükleme düzeyinde ve çekirdek düzeyinde kötü amaçlı yazılımlara ve rootkit'lere karşı korumaya yardımcı olur.
* **vTPM'yi etkinleştir:** Sanal Güvenilir Platform Modülü (vTPM), misafir VM'nizin önyükleme öncesi ve önyükleme bütünlüğünü doğrular ve anahtar oluşturma ve koruma sağlar.
* **Bütünlük denetimi:** Bütünlük izleme, Stackdriver raporlarını kullanarak korumalı VM örneklerinizin çalışma zamanı önyükleme bütünlüğünü izleyip doğrulamanıza olanak tanır. vTPM'nin etkinleştirilmesi gereklidir.

### VM Erişimi

VM'ye erişimi etkinleştirmenin yaygın yolu, **belirli SSH genel anahtarlarının** VM'ye erişmesine izin vermektir.\
Ancak, **IAM kullanarak `os-config` hizmeti aracılığıyla VM'ye erişimi etkinleştirmek** de mümkündür. Ayrıca, bu hizmeti kullanarak VM'ye erişim için 2FA'yı etkinleştirmek de mümkündür.\
Bu **hizmet** **etkinleştirildiğinde**, **SSH anahtarları aracılığıyla erişim devre dışı bırakılır.**

<figure><img src="../../../../.gitbook/assets/image (328).png" alt=""><figcaption></figcaption></figure>

### Metadata

**Makine her açıldığında veya yeniden başlatıldığında çalıştırılacak** **otomasyon** (AWS'de userdata) tanımlamak mümkündür.

Ayrıca, metadata endpoint'inden erişilebilecek **ekstra metadata anahtar-değer değerleri** eklemek de mümkündür. Bu bilgiler genellikle çevre değişkenleri ve başlangıç/kapanış komut dosyaları için kullanılır. Bu, komutun betimleme yöntemini kullanarak elde edilebilir, ancak aynı zamanda örneğin içinden metadata endpoint'ine erişerek de elde edilebilir.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Ayrıca, **bağlı hizmet hesabı için kimlik doğrulama belirteci** ve **genel bilgi** örnek, ağ ve proje hakkında **metadata endpoint**'inden de elde edilebilir. Daha fazla bilgi için:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Şifreleme

Varsayılan olarak Google tarafından yönetilen bir şifreleme anahtarı kullanılır, ancak Müşteri tarafından yönetilen bir şifreleme anahtarı (CMEK) yapılandırılabilir. Kullanılan CMEK iptal edildiğinde ne yapılacağını da yapılandırabilirsiniz: Hiçbir şey yapmamak veya VM'yi kapatmak.

<figure><img src="../../../../.gitbook/assets/image (329).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking öğrenin ve pratik yapın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 Discord grubuna** [**katılın**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'ı takip edin.**
* **HackTricks'e PR göndererek hacking ipuçlarını paylaşın** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına.

</details>
{% endhint %}
