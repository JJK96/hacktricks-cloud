# GCP - Compute Instances

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basiese Inligting

Google Cloud Compute Instances is **aanpasbare virtuele masjiene op Google se wolk-infrastruktuur**, wat skaalbare en op-aanvraag rekenaarkrag bied vir 'n wye reeks toepassings. Hulle bied kenmerke soos globale ontplooiing, volgehoue berging, buigsame OS-keuses, en sterk netwerk- en sekuriteitsintegrasies, wat hulle 'n veelsydige keuse maak vir die aanbied van webwerwe, verwerking van data, en doeltreffende uitvoering van toepassings in die wolk.

### Vertroulike VM

Vertroulike VMs gebruik **hardeware-gebaseerde sekuriteitskenmerke** wat aangebied word deur die nuutste generasie van AMD EPYC-verwerkers, wat geheue-enkripsie en veilige ge√´nkripteerde virtualisasie insluit. Hierdie kenmerke stel die VM in staat om die data wat binne dit verwerk en gestoor word te beskerm, selfs teen die gasheer-bedryfstelsel en hipervisor.

Om 'n Vertroulike VM te laat loop, mag dit nodig wees om dinge soos die **tipe** van die **masjien**, netwerk **koppelvlak**, **opstartskyfbeeld** te **verander**.

### Skyf & Skyf Enkripsie

Dit is moontlik om die **skyf te kies** om te gebruik of **'n nuwe een te skep**. As jy 'n nuwe een kies, kan jy:

* Die **grootte** van die skyf kies
* Die **OS** kies
* Aandui of jy die **skyf wil uitvee wanneer die instansie uitgevee word**
* **Enkripsie**: By **versteking** sal 'n **Google-bestuurde sleutel** gebruik word, maar jy kan ook **'n sleutel van KMS kies** of **rou sleutel aandui om te gebruik**.

### Ontplooi Houer

Dit is moontlik om 'n **houer** binne die virtuele masjien te ontplooi.\
Dit is moontlik om die **beeld** te konfigureer om te gebruik, die **opdrag** te stel om binne te loop, **argumente**, 'n **volume** te monteer, en **omgewingsveranderlikes** (sensitiewe inligting?) en verskeie opsies vir hierdie houer te konfigureer soos uitvoer as **geprivilegeerd**, stdin en pseudo TTY.

### Diensrekening

By verstek sal die **Compute Engine verstek diensrekening** gebruik word. Die e-pos van hierdie SA is soos: `<proj-num>-compute@developer.gserviceaccount.com`\
Hierdie diensrekening het **Redakteur rol oor die hele projek (ho√´ voorregte).**

En die **verstek toegangskopes** is die volgende:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Lees toegang tot emmers :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

Dit is egter moontlik om dit **`cloud-platform` te gee met 'n klik** of **pasgemaakte** te spesifiseer.

<figure><img src="../../../../.gitbook/assets/image (327).png" alt=""><figcaption></figcaption></figure>

### Firewall

Dit is moontlik om HTTP en HTTPS verkeer toe te laat.

<figure><img src="../../../../.gitbook/assets/image (326).png" alt=""><figcaption></figcaption></figure>

### Netwerk

* **IP Voorstuur**: Dit is moontlik om **IP voorstuur te aktiveer** vanaf die skepping van die instansie.
* **Hostname**: Dit is moontlik om die instansie 'n permanente hostname te gee.
* **Koppelvlak**: Dit is moontlik om 'n netwerk koppelvlak by te voeg

### Ekstra Sekuriteit

Hierdie opsies sal die **sekuriteit van die VM verhoog** en word aanbeveel:

* **Veilige opstart:** Veilige opstart help om jou VM-instansies te beskerm teen opstartvlak en kernvlak malware en rootkits.
* **Aktiveer vTPM:** Virtuele Trusted Platform Module (vTPM) valideer jou gasheer VM voor-opstart en opstart integriteit, en bied sleutelgenerasie en beskerming.
* **Integriteit toesig:** Integriteit monitering laat jou toe om die runtime opstart integriteit van jou beskermde VM-instansies te monitor en te verifieer met behulp van Stackdriver verslae. Vereis dat vTPM geaktiveer is.

### VM Toegang

Die algemene manier om toegang tot die VM te aktiveer is deur **sekere SSH publieke sleutels toe te laat** om toegang tot die VM te kry.\
Dit is egter ook moontlik om **toegang tot die VM te aktiveer via `os-config` diens met behulp van IAM**. Verder is dit moontlik om 2FA te aktiveer om toegang tot die VM te kry met behulp van hierdie diens.\
Wanneer hierdie **diens** geaktiveer is, is die toegang via **SSH sleutels gedeaktiveer.**

<figure><img src="../../../../.gitbook/assets/image (328).png" alt=""><figcaption></figcaption></figure>

### Metadata

Dit is moontlik om **outomatisering** (userdata in AWS) te definieer wat **dopgehoude opdragte** is wat elke keer uitgevoer sal word wanneer die masjien aanskakel of herbegin.

Dit is ook moontlik om **ekstra metadata sleutel-waarde waardes by te voeg** wat toeganklik gaan wees vanaf die metadata eindpunt. Hierdie inligting word algemeen gebruik vir omgewingsveranderlikes en opstart/afsluit skripte. Dit kan verkry word deur die **`beskryf` metode** van 'n opdrag in die enumerasie afdeling te gebruik, maar dit kan ook van binne die instansie verkry word deur toegang tot die metadata eindpunt.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Moreover, **auth token vir die aangehegte diensrekening** en **algemene inligting** oor die instansie, netwerk en projek sal ook beskikbaar wees vanaf die **metadata-eindpunt**. Vir meer inligting, kyk:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Enkripsie

'n Google-bestuurde enkripsiesleutel word standaard gebruik, maar 'n Kli√´nt-bestuurde enkripsiesleutel (CMEK) kan gekonfigureer word. Jy kan ook instel wat om te doen wanneer die gebruikte CMEK herroep word: Niks of die VM afskakel.

<figure><img src="../../../../.gitbook/assets/image (329).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repo's.

</details>
{% endhint %}
