# GCP - Compute Instances

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## Grundlegende Informationen

Google Cloud Compute Instances sind **anpassbare virtuelle Maschinen auf der Cloud-Infrastruktur von Google**, die skalierbare und bedarfsgerechte Rechenleistung f√ºr eine Vielzahl von Anwendungen bieten. Sie bieten Funktionen wie globale Bereitstellung, persistenten Speicher, flexible Betriebssystemauswahl und starke Netzwerk- und Sicherheitsintegrationen, was sie zu einer vielseitigen Wahl f√ºr das Hosting von Websites, die Datenverarbeitung und das effiziente Ausf√ºhren von Anwendungen in der Cloud macht.

### Confidential VM

Confidential VMs nutzen **hardwarebasierte Sicherheitsfunktionen**, die von der neuesten Generation der AMD EPYC-Prozessoren angeboten werden, einschlie√ülich Speicher- und sicherer verschl√ºsselter Virtualisierung. Diese Funktionen erm√∂glichen es der VM, die verarbeiteten und gespeicherten Daten vor dem Host-Betriebssystem und dem Hypervisor zu sch√ºtzen.

Um eine Confidential VM auszuf√ºhren, m√ºssen m√∂glicherweise Dinge wie der **Maschinentyp**, die Netzwerk**schnittstelle** und das **Boot-Disk-Image** **ge√§ndert** werden.

### Disk & Disk Encryption

Es ist m√∂glich, **die Festplatte auszuw√§hlen** oder **eine neue zu erstellen**. Wenn du eine neue ausw√§hlst, kannst du:

* Die **Gr√∂√üe** der Festplatte ausw√§hlen
* Das **Betriebssystem** ausw√§hlen
* Angeben, ob du die **Festplatte l√∂schen m√∂chtest, wenn die Instanz gel√∂scht wird**
* **Verschl√ºsselung**: Standardm√§√üig wird ein **von Google verwalteter Schl√ºssel** verwendet, aber du kannst auch **einen Schl√ºssel aus KMS ausw√§hlen** oder einen **rohen Schl√ºssel angeben**.

### Container bereitstellen

Es ist m√∂glich, einen **Container** innerhalb der virtuellen Maschine bereitzustellen.\
Es ist m√∂glich, das zu verwendende **Image** zu konfigurieren, den **Befehl** festzulegen, der darin ausgef√ºhrt werden soll, **Argumente**, ein **Volume** zu mounten und **Umgebungsvariablen** (sensible Informationen?) zu konfigurieren sowie mehrere Optionen f√ºr diesen Container wie Ausf√ºhrung als **privilegiert**, stdin und pseudo TTY zu konfigurieren.

### Service Account

Standardm√§√üig wird das **Compute Engine-Standard-Servicekonto** verwendet. Die E-Mail dieses SA lautet: `<proj-num>-compute@developer.gserviceaccount.com`\
Dieses Servicekonto hat die **Editor-Rolle √ºber das gesamte Projekt (hohe Privilegien).**

Und die **Standardzugriffsbereiche** sind die folgenden:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Lesezugriff auf Buckets :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

Es ist jedoch m√∂glich, ihm mit einem Klick **`cloud-platform` zu gew√§hren** oder **benutzerdefinierte** zu spezifizieren.

<figure><img src="../../../../.gitbook/assets/image (327).png" alt=""><figcaption></figcaption></figure>

### Firewall

Es ist m√∂glich, HTTP- und HTTPS-Verkehr zuzulassen.

<figure><img src="../../../../.gitbook/assets/image (326).png" alt=""><figcaption></figcaption></figure>

### Netzwerk

* **IP-Weiterleitung**: Es ist m√∂glich, die **IP-Weiterleitung** ab der Erstellung der Instanz zu **aktivieren**.
* **Hostname**: Es ist m√∂glich, der Instanz einen permanenten Hostnamen zu geben.
* **Schnittstelle**: Es ist m√∂glich, eine Netzwerkschnittstelle hinzuzuf√ºgen.

### Zus√§tzliche Sicherheit

Diese Optionen werden die **Sicherheit der VM erh√∂hen** und werden empfohlen:

* **Secure Boot:** Secure Boot hilft, deine VM-Instanzen vor Boot-Level- und Kernel-Level-Malware und Rootkits zu sch√ºtzen.
* **vTPM aktivieren:** Virtual Trusted Platform Module (vTPM) validiert die Pre-Boot- und Boot-Integrit√§t deiner Gast-VM und bietet Schl√ºsselgenerierung und -schutz.
* **Integrit√§ts√ºberwachung:** Integrit√§ts√ºberwachung erm√∂glicht es dir, die Laufzeit-Boot-Integrit√§t deiner gesch√ºtzten VM-Instanzen mithilfe von Stackdriver-Berichten zu √ºberwachen und zu √ºberpr√ºfen. Erfordert die Aktivierung von vTPM.

### VM-Zugriff

Der √ºbliche Weg, um den Zugriff auf die VM zu erm√∂glichen, besteht darin, **bestimmte SSH-√∂ffentliche Schl√ºssel** zuzulassen, um auf die VM zuzugreifen.\
Es ist jedoch auch m√∂glich, den **Zugriff auf die VM √ºber den `os-config`-Dienst mithilfe von IAM zu aktivieren**. Dar√ºber hinaus ist es m√∂glich, 2FA zu aktivieren, um √ºber diesen Dienst auf die VM zuzugreifen.\
Wenn dieser **Dienst** **aktiviert** ist, wird der Zugriff √ºber **SSH-Schl√ºssel deaktiviert.**

<figure><img src="../../../../.gitbook/assets/image (328).png" alt=""><figcaption></figcaption></figure>

### Metadaten

Es ist m√∂glich, **Automatisierung** (userdata in AWS) zu definieren, bei der es sich um **Shell-Befehle** handelt, die jedes Mal ausgef√ºhrt werden, wenn die Maschine eingeschaltet oder neu gestartet wird.

Es ist auch m√∂glich, **zus√§tzliche Metadaten-Schl√ºssel-Werte** hinzuzuf√ºgen, die vom Metadaten-Endpunkt aus zug√§nglich sind. Diese Informationen werden h√§ufig f√ºr Umgebungsvariablen und Start-/Herunterfahrskripte verwendet. Dies kann mit der **`describe`-Methode** von einem Befehl im Enumerationsabschnitt abgerufen werden, kann aber auch von innerhalb der Instanz durch Zugriff auf den Metadaten-Endpunkt abgerufen werden.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Moreover, **auth token for the attached service account** und **allgemeine Informationen** √ºber die Instanz, das Netzwerk und das Projekt sind ebenfalls vom **Metadata-Endpoint** verf√ºgbar. F√ºr weitere Informationen siehe:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Verschl√ºsselung

Ein von Google verwalteter Verschl√ºsselungsschl√ºssel wird standardm√§√üig verwendet, aber ein vom Kunden verwalteter Verschl√ºsselungsschl√ºssel (CMEK) kann konfiguriert werden. Sie k√∂nnen auch konfigurieren, was zu tun ist, wenn der verwendete CMEK widerrufen wird: Nichts oder die VM herunterfahren.

<figure><img src="../../../../.gitbook/assets/image (329).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichen.

</details>
{% endhint %}
