# GCP - Compute Instances

{% hint style="success" %}
Impara e pratica AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Impara e pratica GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repository github.

</details>
{% endhint %}

## Informazioni di Base

Google Cloud Compute Instances sono **macchine virtuali personalizzabili sull'infrastruttura cloud di Google**, che offrono potenza di calcolo scalabile e on-demand per una vasta gamma di applicazioni. Forniscono funzionalit√† come distribuzione globale, storage persistente, scelte flessibili di OS e forti integrazioni di rete e sicurezza, rendendole una scelta versatile per ospitare siti web, elaborare dati e eseguire applicazioni in modo efficiente nel cloud.

### Confidential VM

Le Confidential VM utilizzano **funzionalit√† di sicurezza basate su hardware** offerte dalla generazione pi√π recente di processori AMD EPYC, che includono crittografia della memoria e virtualizzazione crittografata sicura. Queste funzionalit√† consentono alla VM di proteggere i dati elaborati e memorizzati al suo interno anche dal sistema operativo host e dall'hypervisor.

Per eseguire una Confidential VM potrebbe essere necessario **modificare** elementi come il **tipo** di **macchina**, l'interfaccia di **rete**, l'immagine del **disco di avvio**.

### Disco & Crittografia del Disco

√à possibile **selezionare il disco** da utilizzare o **crearne uno nuovo**. Se selezioni uno nuovo puoi:

* Selezionare la **dimensione** del disco
* Selezionare l'**OS**
* Indicare se desideri **eliminare il disco quando l'istanza viene eliminata**
* **Crittografia**: Per **default** verr√† utilizzata una **chiave gestita da Google**, ma puoi anche **selezionare una chiave da KMS** o indicare una **chiave grezza da utilizzare**.

### Deploy Container

√à possibile distribuire un **container** all'interno della macchina virtuale.\
√à possibile configurare l'**immagine** da utilizzare, impostare il **comando** da eseguire all'interno, gli **argomenti**, montare un **volume**, e le **variabili d'ambiente** (informazioni sensibili?) e configurare diverse opzioni per questo container come eseguire come **privileged**, stdin e pseudo TTY.

### Service Account

Per impostazione predefinita, verr√† utilizzato il **Compute Engine default service account**. L'email di questo SA √® simile a: `<proj-num>-compute@developer.gserviceaccount.com`\
Questo service account ha il **ruolo di Editor su tutto il progetto (privilegi elevati).**

E i **default access scopes** sono i seguenti:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Accesso in lettura ai bucket :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

Tuttavia, √® possibile **concedergli `cloud-platform` con un clic** o specificare **custom ones**.

<figure><img src="../../../../.gitbook/assets/image (327).png" alt=""><figcaption></figcaption></figure>

### Firewall

√à possibile consentire il traffico HTTP e HTTPS.

<figure><img src="../../../../.gitbook/assets/image (326).png" alt=""><figcaption></figcaption></figure>

### Networking

* **IP Forwarding**: √à possibile **abilitare l'IP forwarding** dalla creazione dell'istanza.
* **Hostname**: √à possibile assegnare all'istanza un hostname permanente.
* **Interface**: √à possibile aggiungere un'interfaccia di rete.

### Extra Security

Queste opzioni **aumenteranno la sicurezza** della VM e sono raccomandate:

* **Secure boot:** Secure boot aiuta a proteggere le istanze VM da malware a livello di avvio e kernel e rootkit.
* **Enable vTPM:** Virtual Trusted Platform Module (vTPM) convalida l'integrit√† pre-boot e boot della tua VM guest e offre generazione e protezione delle chiavi.
* **Integrity supervision:** Integrity monitoring ti consente di monitorare e verificare l'integrit√† runtime del boot delle tue istanze VM shielded utilizzando i report di Stackdriver. Richiede che vTPM sia abilitato.

### VM Access

Il modo comune per abilitare l'accesso alla VM √® **consentire a determinate chiavi pubbliche SSH** di accedere alla VM.\
Tuttavia, √® anche possibile **abilitare l'accesso alla VM tramite il servizio `os-config` utilizzando IAM**. Inoltre, √® possibile abilitare l'autenticazione a due fattori per accedere alla VM utilizzando questo servizio.\
Quando questo **servizio** √® **abilitato**, l'accesso tramite **chiavi SSH √® disabilitato.**

<figure><img src="../../../../.gitbook/assets/image (328).png" alt=""><figcaption></figcaption></figure>

### Metadata

√à possibile definire **automation** (userdata in AWS) che sono **comandi shell** che verranno eseguiti ogni volta che la macchina si accende o si riavvia.

√à anche possibile **aggiungere valori di metadati chiave-valore extra** che saranno accessibili dall'endpoint dei metadati. Queste informazioni sono comunemente utilizzate per variabili d'ambiente e script di avvio/arresto. Questo pu√≤ essere ottenuto utilizzando il **`describe` method** da un comando nella sezione di enumerazione, ma potrebbe anche essere recuperato dall'interno dell'istanza accedendo all'endpoint dei metadati.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Moreover, **auth token for the attached service account** e **informazioni generali** sull'istanza, la rete e il progetto saranno disponibili dall'**endpoint dei metadati**. Per maggiori informazioni, controlla:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Encryption

Una chiave di crittografia gestita da Google √® utilizzata di default, ma pu√≤ essere configurata una chiave di crittografia gestita dal cliente (CMEK). Puoi anche configurare cosa fare quando la CMEK utilizzata viene revocata: Niente o spegnere la VM.

<figure><img src="../../../../.gitbook/assets/image (329).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Impara e pratica AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Impara e pratica GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>
{% endhint %}
