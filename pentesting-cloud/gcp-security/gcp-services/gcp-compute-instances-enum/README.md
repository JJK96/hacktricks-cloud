# GCP - Hesaplama Enum

<details>

<summary><strong>Sıfırdan kahraman olmaya kadar AWS hackleme öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**]'na (https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **Katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking püf noktalarınızı paylaşarak PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına.

</details>

## GCP VPC ve Ağ

Bunun nasıl çalıştığını öğrenin:

{% content-ref url="gcp-vpc-and-networking.md" %}
[gcp-vpc-and-networking.md](gcp-vpc-and-networking.md)
{% endcontent-ref %}

### Enumerasyon

{% code overflow="wrap" %}
```bash
# List networks
gcloud compute networks list
gcloud compute networks describe <network>

# List subnetworks
gcloud compute networks subnets list
gcloud compute networks subnets get-iam-policy <name> --region <region>
gcloud compute networks subnets describe <name> --region <region>

# List FW rules in networks
gcloud compute firewall-rules list --format="table(
name,
network,
direction,
priority,
sourceRanges.list():label=SRC_RANGES,
destinationRanges.list():label=DEST_RANGES,
allowed[].map().firewall_rule().list():label=ALLOW,
denied[].map().firewall_rule().list():label=DENY,
sourceTags.list():label=SRC_TAGS,
sourceServiceAccounts.list():label=SRC_SVC_ACCT,
targetTags.list():label=TARGET_TAGS,
targetServiceAccounts.list():label=TARGET_SVC_ACCT,
disabled
)"

# List Hierarchical Firewalls
gcloud compute firewall-policies list  (--folder <value>| --organization <value>)
gcloud compute firewall-policies describe <fw_policy>
gcloud compute firewall-policies list-rules <fw_policy>

# Get Firewalls of each region
gcloud compute network-firewall-policies list
## Get final FWs applied in a region
gcloud compute network-firewall-policies get-effective-firewalls --network=<vpc_name> --region <region>
```
{% endcode %}

Açık güvenlik duvarı kurallarına sahip hesaplama örneklerini kolayca bulabilirsiniz [https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_firewall\_enum](https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_firewall\_enum)

## Hesaplama Örnekleri

Bu, **GCP içinde sanal makineleri çalıştırabileceğiniz yol.** Daha fazla bilgi için bu sayfaya göz atın:

{% content-ref url="gcp-compute-instance.md" %}
[gcp-compute-instance.md](gcp-compute-instance.md)
{% endcontent-ref %}

### Numaralandırma
```bash
# Get list of zones
# It's interesting to know which zones are being used
gcloud compute regions list | grep -E "NAME|[^0]/"

# List compute instances & get info
gcloud compute instances list
gcloud compute instances describe <instance name>
gcloud compute instances get-iam-policy <instance> --zone=ZONE
gcloud compute instances get-screenshot <instance name> # Instace must have "Display Device" enabled
gcloud compute instances os-inventory list-instances # Get OS info of instances (OS Config agent is running on instances)


# Enumerate disks
gcloud compute disks list
gcloud compute disks describe <disk>
gcloud compute disks get-iam-policy <disk>
```
### Yetkilendirme Yükseltme

Aşağıdaki sayfada, **yetkilendirme yükseltmek için bilgisayar izinlerini kötüye nasıl kullanabileceğinizi** kontrol edebilirsiniz:

{% content-ref url="../../gcp-privilege-escalation/gcp-compute-privesc/" %}
[gcp-compute-privesc](../../gcp-privilege-escalation/gcp-compute-privesc/)
{% endcontent-ref %}

### Kimlik Doğrulamasız Sorgulama

{% content-ref url="../../gcp-unaunthenticated-enum-and-access/gcp-compute-unauthenticated-enum.md" %}
[gcp-compute-unauthenticated-enum.md](../../gcp-unaunthenticated-enum-and-access/gcp-compute-unauthenticated-enum.md)
{% endcontent-ref %}

### Saldırı Sonrası İşlemler

{% content-ref url="../../gcp-post-exploitation/gcp-compute-post-exploitation.md" %}
[gcp-compute-post-exploitation.md](../../gcp-post-exploitation/gcp-compute-post-exploitation.md)
{% endcontent-ref %}

### Kalıcılık

{% content-ref url="../../gcp-persistence/gcp-compute-persistence.md" %}
[gcp-compute-persistence.md](../../gcp-persistence/gcp-compute-persistence.md)
{% endcontent-ref %}

## Seri Konsol Kayıtları

Bilgisayar Motoru Seri Konsol Kayıtları, sanal makine örneklerinizin **önyükleme ve işletim sistemi kayıtlarını görüntülemenize ve teşhis etmenize** olanak tanıyan bir özelliktir.

Seri Konsol Kayıtları, önyükleme sürecinin **düşük seviyeli bir görünümünü** sağlar; bu, önyükleme sırasında meydana gelen çekirdek iletileri, init betikleri ve diğer sistem olaylarını içerir. Bu, önyükleme sorunlarını hata ayıklamak, yanlış yapılandırmaları veya yazılım hatalarını tanımlamak veya ağ bağlantı sorunlarını gidermek için faydalı olabilir.

Bu kayıtlar, genellikle düşük ayrıcalıklı kullanıcıların görmemesi gereken sistem kayıtlarından **duyarlı bilgileri ortaya çıkarabilir**, ancak uygun IAM izinleriyle bunları okuyabilirsiniz.

Seri port kayıtlarını sorgulamak için aşağıdaki [gcloud komutunu](https://cloud.google.com/sdk/gcloud/reference/compute/instances/get-serial-port-output) kullanabilirsiniz (gereken izin `compute.instances.getSerialPortOutput`):
```bash
gcloud compute instances get-serial-port-output <instance-name>
```
## Başlangıç Betikleri çıktısı

VM'den şu komutu çalıştırarak **başlangıç betiklerinin çıktısını** görmek mümkündür:
```bash
sudo journalctl -u google-startup-scripts.service
```
## İşletim Sistemi Yapılandırma Yöneticisi

İşletim sistemi yapılandırma yöneticisi hizmetini kullanarak sanal makine örneğinizin (VM) **istenen durumu ve yazılımı dağıtmak, sorgulamak ve tutarlı yapılandırmaları sürdürmek** için kullanabilirsiniz. Compute Engine üzerinde, VM'lerinizde tutarlı yazılım yapılandırmalarını sürdürmek için [konuk politikalarını](https://cloud.google.com/compute/docs/os-config-management#guest-policy) kullanmalısınız.

İşletim Sistemi Yapılandırma yönetimi özelliği, VM'lerinizde hangi yazılım paketlerinin yüklü olması gerektiğini, hangi hizmetlerin etkinleştirilmesi gerektiğini ve hangi dosyaların veya yapılandırmaların VM'lerinizde bulunması gerektiğini belirten yapılandırma politikalarını tanımlamanıza olanak tanır. VM'lerinizin yazılım yapılandırmasını yönetmek için deklaratif bir yaklaşım kullanabilirsiniz, bu da yapılandırma yönetim sürecinizi daha kolay otomatikleştirmenize ve ölçeklendirmenize olanak tanır.

Bu ayrıca IAM izinleri aracılığıyla örneklerde oturum açmanıza olanak tanır, bu nedenle **hak yükseltme ve dönüş** için çok **yararlıdır**.

{% hint style="warning" %}
**Bir projenin veya bir örneğin içinde os-config'i etkinleştirmek** için sadece istenen düzeyde **`enable-oslogin`** anahtarını **`true`** olarak ayarlamanız yeterlidir.\
Ayrıca, 2fa'yı etkinleştirmek için **`enable-oslogin-2fa`** anahtarını **`true`** olarak ayarlayabilirsiniz.

Bir örneği oluştururken etkinleştirdiğinizde, metadata anahtarları otomatik olarak ayarlanacaktır.
{% endhint %}

**OS-config'de 2fa hakkında** daha fazla bilgi, **kullanıcı bir kullanıcıysa** yalnızca uygulanır, eğer bir SA ise (örneğin, compute SA gibi) ekstra bir şey gerektirmez.

### Numaralandırma
```bash
gcloud compute os-config patch-deployments list
gcloud compute os-config patch-deployments describe <patch-deployment>

gcloud compute os-config patch-jobs list
gcloud compute os-config patch-jobs describe <patch-job>
```
## Görüntüler

### Özel Görüntüler

**Özel hesaplama görüntüleri hassas ayrıntılar** veya başka zayıf yapılandırmalar içerebilir ki bunları sömürebilirsiniz.

Bir görüntü oluşturulduğunda **3 tür şifreleme** seçebilirsiniz: **Google tarafından yönetilen anahtar** (varsayılan), bir **KMS'den anahtar**, veya müşteri tarafından verilen bir **ham anahtar**.

#### Numaralandırma

Bir projedeki standart olmayan görüntülerin listesini sorgulayabilirsiniz aşağıdaki komutla:

{% code overflow="wrap" %}
```bash
gcloud compute machine-images list
gcloud compute machine-images describe <name>
gcloud compute machine-images get-iam-policy <name>
```
{% endcode %}

Herhangi bir görüntüden sanal diskleri çeşitli biçimlerde [**dışa aktarabilirsiniz**](https://cloud.google.com/sdk/gcloud/reference/compute/images/export). Aşağıdaki komut, `test-image` görüntüsünü qcow2 biçiminde dışa aktaracak ve dosyayı indirip daha fazla inceleme için yerel olarak bir sanal makine oluşturmanıza olanak tanıyacaktır:
```bash
gcloud compute images export --image test-image \
--export-format qcow2 --destination-uri [BUCKET]

# Execute container inside a docker
docker run --rm -ti gcr.io/<project-name>/secret:v1 sh
```
#### Yetki Yükseltme

Bilgisayar Örnekleri yetki yükseltme bölümünü kontrol edin.

### Özel Örnek Şablonları

Bir [**örnek şablonu**](https://cloud.google.com/compute/docs/instance-templates/), tutarlı yapılandırmaları dağıtmaya yardımcı olmak için örnek özelliklerini tanımlar. Bu, çalışan bir örneğin özel meta verileri gibi aynı türde hassas verileri içerebilir. Araştırmak için aşağıdaki komutları kullanabilirsiniz:
```bash
# List the available templates
gcloud compute instance-templates list

# Get the details of a specific template
gcloud compute instance-templates describe [TEMPLATE NAME]
```
## Anlık Görüntüler

**Anlık görüntüler disk yedeklemeleridir**. Bu, bir diski klonlamakla aynı şey değildir (başka bir mevcut özellik).\
**Anlık görüntü**, alındığı disk ile **aynı şifrelemeyi kullanacaktır**.

### Numaralandırma
```bash
gcloud compute snapshots list
gcloud compute snapshots describe <snapshot>
gcloud compute snapshots get-iam-policy <snapshot>
```
### Yetki Yükseltme

Bilgi İşlem Örneklerinde Yetki Yükseltme bölümünü kontrol edin.

## Referanslar

* [https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching](https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching)

<details>

<summary><strong>Sıfırdan Kahraman'a AWS hackleme öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**]'na göz atın (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.** takip edin.
* **Hacking püf noktalarınızı paylaşarak PR'ler göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
