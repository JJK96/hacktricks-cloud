# GCP - VPC & Ağ

<details>

<summary><strong>AWS hackleme konusunda sıfırdan kahramana kadar öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini alın**](https://peass.creator-spring.com)
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **Katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking püf noktalarınızı paylaşarak PR göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>

## **GCP Hesaplama Ağı Özeti**

**VPC'ler**, VPC'ye gelen trafiği izin veren **Güvenlik Duvarı** kurallarını içerir. VPC'ler ayrıca **sanal makinelerin bağlı olacağı alt ağları** içerir.\
AWS ile karşılaştırıldığında, **Güvenlik Duvarı**, **AWS Güvenlik Grupları ve NACL'lerine** en yakın şey olacaktır, ancak bu durumda bunlar **her örnekte değil, VPC'de tanımlanmıştır**.

## **GCP'de VPC, Alt Ağlar ve Güvenlik Duvarları**

Hesaplama Örnekleri, **VPC'ye bağlı alt ağlar** ile bağlanır ([Sanal Özel Bulutlar](https://cloud.google.com/vpc/docs/vpc)). GCP'de güvenlik grupları yok, bu ağ düzeyinde tanımlanan ancak her VM Örneğine uygulanan [**VPC güvenlik duvarları**](https://cloud.google.com/vpc/docs/firewalls) bulunmaktadır.

### Alt Ağlar

Bir **VPC**, **birkaç alt ağa** sahip olabilir. Her **alt ağ 1 bölgede** bulunur.

### Güvenlik Duvarları

Her ağın varsayılan olarak iki [**varsayılan güvenlik duvarı kuralı**](https://cloud.google.com/vpc/docs/firewalls#default\_firewall\_rules) bulunur: **giden trafiği izin ver** ve **gelen trafiği reddet**.

Bir GCP projesi oluşturulduğunda, **varsayılan** adında bir VPC oluşturulur ve aşağıdaki güvenlik duvarı kurallarına sahiptir:

* **default-allow-internal:** `varsayılan` ağdaki diğer örneklerden gelen tüm trafiği izin ver
* **default-allow-ssh:** her yerden 22'ye izin ver
* **default-allow-rdp:** her yerden 3389'a izin ver
* **default-allow-icmp:** her yerden ping'e izin ver

{% hint style="warning" %}
Görebileceğiniz gibi, **güvenlik duvarı kuralları** genellikle **dahili IP adresleri** için **daha kapsayıcı** olma eğilimindedir. Varsayılan VPC, Hesaplama Örnekleri arasındaki tüm trafiği izin verir.
{% endhint %}

Daha fazla **Güvenlik Duvarı kuralı**, varsayılan VPC veya yeni VPC'ler için oluşturulabilir. [**Güvenlik Duvarı kuralları**](https://cloud.google.com/vpc/docs/firewalls), aşağıdaki **yöntemler** aracılığıyla örnekler üzerine uygulanabilir:

* [**Ağ etiketleri**](https://cloud.google.com/vpc/docs/add-remove-network-tags)
* [**Hizmet hesapları**](https://cloud.google.com/vpc/docs/firewalls#serviceaccounts)
* **VPC içindeki tüm örnekler**

Ne yazık ki, internet üzerinde açık portlara sahip tüm Hesaplama Örneklerini dökmek için basit bir `gcloud` komutu yoktur. Güvenlik duvarı kuralları, ağ etiketleri, hizmet hesapları ve örnekler arasındaki bağlantıları kurmanız gerekir.

Bu süreç, aşağıdakileri dışa aktaracak olan [bu python betiği](https://gitlab.com/gitlab-com/gl-security/gl-redteam/gcp\_firewall\_enum) kullanılarak otomatikleştirildi:

* Halka açık IP, izin verilen TCP, izin verilen UDP gösteren CSV dosyası
* Halka açık internetten (0.0.0.0/0) gelen tüm örnekler üzerindeki tüm bağlantı noktalarını hedefleyen nmap taraması
* Halka açık internetten (0.0.0.0/0) tüm TCP bağlantı noktalarına izin veren bu örneklerin tam TCP aralığına hedefleyen masscan taraması

### Hiyerarşik Güvenlik Duvarı Politikaları <a href="#hierarchical-firewall-policies" id="hierarchical-firewall-policies"></a>

_Hiyerarşik güvenlik duvarı politikaları_, **kuruluşunuz genelinde tutarlı bir güvenlik duvarı politikası oluşturmanıza ve uygulamanıza olanak tanır**. Bu politikaları **kuruluşun tümüne veya bireysel klasörlere** atayabilirsiniz. Bu politikalar, bağlantıları açıkça reddeden veya izin veren kurallar içerebilir.

Güvenlik duvarı politikalarını oluşturup uygulamak ayrı adımlardır. [**Kaynak hiyerarşisi**](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy) olan **kuruluş veya klasör düğümlerinde** güvenlik duvarı politikaları oluşturabilir ve uygulayabilirsiniz. Bir güvenlik duvarı politikası kuralı, bağlantıları **engelleyebilir, bağlantılara izin verebilir veya VPC ağlarında tanımlanan VPC güvenlik duvarı kurallarını** VPC ağlarında tanımlanan VPC güvenlik duvarı kurallarını **değerlendirmeyi erteleyebilir**.

Varsayılan olarak, tüm hiyerarşik güvenlik duvarı politikası kuralları, politikanın ilişkilendirildiği kuruluş veya klasör altındaki tüm projelerdeki tüm VM'ler için geçerlidir. Bununla birlikte, [hedef ağlar veya hedef hizmet hesapları](https://cloud.google.com/vpc/docs/firewall-policies#targets) belirterek bir kuralın hangi VM'lerin belirli bir kuralı alacağını **kısıtlayabilirsiniz**.

[**Hiyerarşik Güvenlik Duvarı Politikası oluşturmayı**](https://cloud.google.com/vpc/docs/using-firewall-policies#gcloud) buradan okuyabilirsiniz.

### Güvenlik Duvarı Kuralları Değerlendirmesi

<figure><img src="../../../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

1. Kuruluş: Kuruluşa atanan Güvenlik Duvarı politikaları
2. Klasör: Klasöre atanan Güvenlik Duvarı politikaları
3. VPC: VPC'ye atanan Güvenlik Duvarı kuralları
4. Global: VPC'lere atanabilen başka bir tür güvenlik duvarı kuralları
5. Bölgesel: VM'nin NIC'inin VPC ağı ve VM'nin bölgesi ile ilişkili güvenlik duvarı kuralları.

## VPC Ağı Eşleme

İki Sanal Özel Bulut (VPC) ağını birbirine bağlamayı sağlar, böylece **her ağdaki kaynaklar birbirleriyle iletişim kurabilir**.\
Eşlenmiş VPC ağları aynı projede, aynı organizasyonun farklı projelerinde veya **farklı organizasyonların farklı projelerinde** olabilir.

Gerekli izinler şunlardır:

* `compute.networks.addPeering`
* `compute.networks.updatePeering`
* `compute.networks.removePeering`
* `compute.networks.listPeeringRoutes`

[Daha fazlası belgelerde](https://cloud.google.com/vpc/docs/vpc-peering).

## Referanslar

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)
* [https://cloud.google.com/vpc/docs/firewall-policies-overview#rule-evaluation](https://cloud.google.com/vpc/docs/firewall-policies-overview#rule-evaluation)

<details>

<summary><strong>AWS hackleme konusunda sıfırdan kahramana kadar öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini alın**](https://peass.creator-spring.com)
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **Katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking püf noktalarınızı paylaşarak PR göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
