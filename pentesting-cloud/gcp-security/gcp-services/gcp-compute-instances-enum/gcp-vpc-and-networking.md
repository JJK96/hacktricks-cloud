# GCP - VPC & Δικτύωση

<details>

<summary><strong>Μάθετε χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Ειδικός Red Team του HackTricks στο AWS)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε** στην 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα τηλεγραφήματος**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs** στα [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## **Δικτύωση Υπολογιστών στο GCP σε Λίγα Λόγια**

Τα **VPCs** περιέχουν **κανόνες Firewall** για να επιτρέπουν την εισερχόμενη κίνηση στο VPC. Τα VPC περιέχουν επίσης **υποδίκτυα** όπου οι **εικονικές μηχανές** θα συνδεθούν.\
Συγκρίνοντας με το AWS, το **Firewall** θα ήταν το **πλησιέστερο** πράγμα στα **Security Groups και NACLs του AWS**, αλλά σε αυτήν την περίπτωση αυτά **ορίζονται στο VPC** και όχι σε κάθε παράδειγμα.

## **VPC, Υποδίκτυα & Firewalls στο GCP**

Οι Υπολογιστικές Εικονικές Μηχανές συνδέονται με **υποδίκτυα** που ανήκουν σε **VPCs** ([Εικονικά Ιδιωτικά Δίκτυα](https://cloud.google.com/vpc/docs/vpc)) στο GCP. Στο GCP δεν υπάρχουν ομάδες ασφαλείας, υπάρχουν [**Firewalls του VPC**](https://cloud.google.com/vpc/docs/firewalls) με κανόνες που ορίζονται σε αυτό το επίπεδο δικτύου αλλά εφαρμόζονται σε κάθε Εικονική Μηχανή VM.

### Υποδίκτυα

Ένα **VPC** μπορεί να έχει **πολλά υποδίκτυα**. Κάθε **υποδίκτυο βρίσκεται σε 1 περιοχή**.

### Firewalls

Από προεπιλογή, κάθε δίκτυο έχει δύο [**υπονοούμενους κανόνες firewall**](https://cloud.google.com/vpc/docs/firewalls#default\_firewall\_rules): **επιτρέπει εξερχόμενη** και **απαγορεύει εισερχόμενη** κίνηση.

Όταν δημιουργείται ένα έργο GCP, δημιουργείται επίσης ένα VPC με το όνομα **`default`**, με τους ακόλουθους κανόνες firewall:

* **default-allow-internal:** επιτρέπει όλη την κίνηση από άλλα παραδείγματα στο δίκτυο `default`
* **default-allow-ssh:** επιτρέπει την πόρτα 22 από οπουδήποτε
* **default-allow-rdp:** επιτρέπει την πόρτα 3389 από οπουδήποτε
* **default-allow-icmp:** επιτρέπει το ping από οπουδήποτε

{% hint style="warning" %}
Όπως μπορείτε να δείτε, οι **κανόνες firewall** τείνουν να είναι **πιο επιεικείς** για τις **εσωτερικές διευθύνσεις IP**. Το προεπιλεγμένο VPC επιτρέπει όλη την κίνηση μεταξύ των Εικονικών Μηχανών.
{% endhint %}

Μπορούν να δημιουργηθούν περισσότεροι **κανόνες firewall** για το προεπιλεγμένο VPC ή για νέα VPC. Οι [**κανόνες firewall**](https://cloud.google.com/vpc/docs/firewalls) μπορούν να εφαρμοστούν σε παραδείγματα μέσω των ακόλουθων **μεθόδων**:

* [**Ετικέτες δικτύου**](https://cloud.google.com/vpc/docs/add-remove-network-tags)
* [**Λογαριασμοί υπηρεσιών**](https://cloud.google.com/vpc/docs/firewalls#serviceaccounts)
* **Όλα τα παραδείγματα εντός ενός VPC**

Δυστυχώς, δεν υπάρχει μια απλή εντολή `gcloud` για να εμφανίσει όλες τις Εικονικές Μηχανές με ανοιχτές πόρτες στο διαδίκτυο. Πρέπει να συνδέσετε τα σημεία μεταξύ κανόνων firewall, ετικετών δικτύου, λογαριασμών υπηρεσιών και παραδειγμάτων.

Αυτή η διαδικασία αυτοματοποιήθηκε χρησιμοποιώντας [αυτό το σενάριο python](https://gitlab.com/gitlab-com/gl-security/gl-redteam/gcp\_firewall\_enum) το οποίο θα εξάγει τα ακόλουθα:

* Αρχείο CSV που δείχνει το παράδειγμα, τη δημόσια IP, τις επιτρεπόμενες TCP, τις επιτρεπόμενες UDP
* σάρωση nmap για να στοχεύσει όλα τα παραδείγματα σε πόρτες εισόδου που επιτρέπονται από το δημόσιο διαδίκτυο (0.0.0.0/0)
* masscan για να στοχεύσει την πλήρη σειρά TCP αυτών των παραδειγμάτων που επιτρέπουν ΟΛΕΣ τις πόρτες TCP από το δημόσιο διαδίκτυο (0.0.0.0/0)

### Ιεραρχικές Πολιτικές Firewall <a href="#hierarchical-firewall-policies" id="hierarchical-firewall-policies"></a>

Οι _ιεραρχικές πολιτικές firewall_ σάς επιτρέπουν να δημιουργήσετε και να **επιβάλετε μια συνεπή πολιτική firewall σε ολόκληρο τον οργανισμό σας**. Μπορείτε να αναθέσετε **ιεραρχικές πολιτικές firewall στον οργανισμό** συνολικά ή σε μεμονωμένα **φάκελοι**. Αυτές οι πολιτικές περιέχουν κανόνες που μπορούν ρητά να απορρίψουν ή να επιτρέψουν συνδέσεις.

Δημιουργείτε και εφαρμόζετε πολιτικές firewall ως ξεχωριστά βήματα. Μπορείτε να δημιουργήσετε και να εφαρμόσετε πολιτικές firewall στους **κόμβους οργανισμού ή φακέλων** της [**ιεραρχίας πόρων**](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy). Ένας κανόνας πολιτικής firewall μπορεί **να αποκλείσει συνδέσεις, να επιτρέψει συνδέσεις ή να αναβάλει την αξιολόγηση κανόνων firewall** σε φακέλους σε χαμηλότερο επίπεδο ή σε κανόνες firewall VPC που έχουν οριστεί σε δίκτυα VPC.

Από προεπιλογή, όλοι οι κανόνες ιεραρχικής πολιτικής firewall ισχύουν για όλες τις Εικονικές Μηχανές σε όλα τα έργα υπό τον οργανισμό ή το φάκελο όπου συσχετίζεται η πολιτική. Ωστόσο, μπορείτε **να περιορίσετε ποιες Εικονικές Μηχανές λαμβάνουν έναν συγκεκριμένο κανόνα** με την καθορισμένη [στόχευση δικτύων ή στόχευση λογαριασμών υπηρεσιών](https://cloud.google.com/vpc/docs/firewall-policies#targets).

Μπορείτε να διαβάσετε εδώ πώς να [**δημιουργήσετε μια Ιεραρχική Πολιτική Firewall**](https://cloud.google.com/vpc/docs/using-firewall-policies#gcloud).

### Αξιολόγηση Κανόνων Firewall

<figure><img src="../../../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

1. Οργ: Κανόνες πολιτικής firewall που ανατίθενται στον Οργανισμό
2. Φάκ: Κανόνες πολιτικής firewall που ανατίθενται στον Φάκελο
3. VPC: Κανόνες firewall που ανατίθενται στο VPC
4
