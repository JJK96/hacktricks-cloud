# GCP - Cloud Functions Enum

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahramana öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **💬 [Discord grubuna](https://discord.gg/hRep4RUj7f) katılın veya [telegram grubuna](https://t.me/peass) katılın veya bizi Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking püf noktalarınızı paylaşarak PR'ler göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>

## Cloud Functions <a href="#reviewing-cloud-functions" id="reviewing-cloud-functions"></a>

[Google Cloud Functions](https://cloud.google.com/functions/) kodunuzu barındırmak için tasarlanmıştır, bu kod **olaylara yanıt olarak yürütülür** ve bir ana işletim sistemi yönetimini gerektirmez. Ayrıca, bu fonksiyonlar kodun kullanabileceği çevre değişkenlerini destekler.

### Depolama

Cloud Functions **kodu GCP Depolama'da saklanır**. Bu nedenle, GCP'deki kovalarda **okuma erişimine sahip olan herkes Cloud Functions kodunu okuyabilecektir**.\
Kod aşağıdaki gibi bir kovada saklanır:

* `gcf-sources-<number>-<region>/<function-name>-<uuid>/version-<n>/function-source.zip`
* `gcf-v2-sources-<number>-<region>/<function-name>function-source.zip`

Örneğin:\
`gcf-sources-645468741258-us-central1/function-1-003dcbdf-32e1-430f-a5ff-785a6e238c76/version-4/function-source.zip`

{% hint style="warning" %}
Cloud Function'ı depolayan kovada **okuma izinlerine sahip olan her kullanıcı yürütülen kodu okuyabilir**.
{% endhint %}

### Artifact Registry

Eğer bulut fonksiyonu yapılandırılmışsa ve yürütülen Docker konteyneri proje içinde bir Artifact Registry deposunda saklanıyorsa, depo üzerinde okuma erişimine sahip herkes görüntüyü indirebilir ve kaynak kodunu kontrol edebilir. Daha fazla bilgi için şuraya bakın:

{% content-ref url="gcp-artifact-registry-enum.md" %}
[gcp-artifact-registry-enum.md](gcp-artifact-registry-enum.md)
{% endcontent-ref %}

### SA

Belirtilmediyse, varsayılan olarak **App Engine Default Service Account** Cloud Function'a bağlanacaktır ve projede **Editör izinlerine sahip olacaktır**.

### Tetikleyiciler, URL ve Kimlik Doğrulama

Bir Cloud Function oluşturulduğunda **tetikleyici** belirtilmelidir. Yaygın bir tetikleyici **HTTPS**'dir, bu web taraması aracılığıyla tetiklenebilecek bir URL oluşturacaktır.\
Diğer tetikleyiciler pub/sub, Depolama, Filestore...

URL formatı **`https://<region>-<project-gcp-name>.cloudfunctions.net/<func_name>`**

HTTPS tetikleyici kullanıldığında, **arama yapacak kişinin IAM yetkilendirmesine sahip olup olmadığı** veya **herkesin** sadece arayabileceği belirtilir:

<figure><img src="../../../.gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

### Cloud Function İçinde

Kod, Cloud Function'daki dosyalarla aynı dosya adlarına sahip olarak **`/workspace`** klasörüne **indirilir** ve `www-data` kullanıcısıyla yürütülür.\
Disk **salt okunur olarak bağlanmamıştır.**

### Numaralandırma
```bash
# List functions
gcloud functions list
gcloud functions describe <func_name> # Check triggers to see how is this function invoked
gcloud functions get-iam-policy <func_name>

# Get logs of previous runs. By default, limits to 10 lines
gcloud functions logs read <func_name> --limit [NUMBER]

# Call a function
curl https://<region>-<project>.cloudfunctions.net/<func_name>
gcloud functions call <func_name> --data='{"message": "Hello World!"}'

# If you know the name of projects you could try to BF cloud functions names

# Get events that could be used to trigger a cloud function
gcloud functions event-types list

# Access function with authentication
curl -X POST https://<region>-<project>.cloudfunctions.net/<func_name> \
-H "Authorization: bearer $(gcloud auth print-identity-token)" \
-H "Content-Type: application/json" \
-d '{}'
```
### Yetki Yükseltme

Aşağıdaki sayfada, **izinleri kötüye kullanarak ayrıcalıkları yükseltme** hakkında nasıl kontrol edebileceğinizi görebilirsiniz:

{% content-ref url="../gcp-privilege-escalation/gcp-cloudfunctions-privesc.md" %}
[gcp-cloudfunctions-privesc.md](../gcp-privilege-escalation/gcp-cloudfunctions-privesc.md)
{% endcontent-ref %}

### Kimlik Doğrulamasız Erişim

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md" %}
[gcp-cloud-functions-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md)
{% endcontent-ref %}

### Saldırı Sonrası İşlemler

{% content-ref url="../gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md" %}
[gcp-cloud-functions-post-exploitation.md](../gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md)
{% endcontent-ref %}

### Kalıcılık

{% content-ref url="../gcp-persistence/gcp-cloud-functions-persistence.md" %}
[gcp-cloud-functions-persistence.md](../gcp-persistence/gcp-cloud-functions-persistence.md)
{% endcontent-ref %}

## Referanslar

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

<details>

<summary><strong>Sıfırdan kahraman olana kadar AWS hacklemeyi öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'da **takip edin**.
* **Hacking püf noktalarınızı paylaşarak PR'ler göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
