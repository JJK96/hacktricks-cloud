# GCP - Orodha ya Cloud Functions

<details>

<summary><strong>Jifunze AWS hacking kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Cloud Functions <a href="#reviewing-cloud-functions" id="reviewing-cloud-functions"></a>

[Google Cloud Functions](https://cloud.google.com/functions/) zimedesigniwa kuhosti nambari yako, ambayo **inaendeshwa kujibu matukio**, bila kuhitaji usimamizi wa mfumo wa uendeshaji wa mwenyeji. Aidha, kazi hizi zinasaidia uhifadhi wa mazingira, ambayo nambari inaweza kutumia.

### Uhifadhi

Nambari za Cloud Functions **zimehifadhiwa kwenye Uhifadhi wa GCP**. Kwa hivyo, mtu yeyote mwenye **upatikanaji wa kusoma kwenye vikasha** katika GCP ataweza **kusoma nambari za Cloud Functions**.\
Nambari zimehifadhiwa kwenye kasha kama moja ya zifuatazo:

* `gcf-sources-<number>-<region>/<function-name>-<uuid>/version-<n>/function-source.zip`
* `gcf-v2-sources-<number>-<region>/<function-name>function-source.zip`

Kwa mfano:\
`gcf-sources-645468741258-us-central1/function-1-003dcbdf-32e1-430f-a5ff-785a6e238c76/version-4/function-source.zip`

{% hint style="warning" %}
Mtumiaji yeyote mwenye **ruhusa za kusoma kwenye kasha** linalohifadhi Cloud Function anaweza **kusoma nambari iliyotekelezwa**.
{% endhint %}

### Usajili wa Sanaa

Ikiwa kazi ya wingu imeboreshwa ili kontena ya Docker iliyotekelezwa ihifadhiwe ndani ya repo ya Usajili wa Sanaa ndani ya mradi, yeyote mwenye upatikanaji wa kusoma kwenye repo ataweza kupakua picha na kuangalia nambari ya chanzo. Kwa habari zaidi angalia:

{% content-ref url="gcp-artifact-registry-enum.md" %}
[gcp-artifact-registry-enum.md](gcp-artifact-registry-enum.md)
{% endcontent-ref %}

### SA

Ikiwa haijatajwa, kwa chaguo-msingi **Akaunti ya Huduma ya Kigeuzi ya App Engine** yenye **ruhusa za Mhariri** juu ya mradi itaambatishwa kwa Cloud Function.

### Vichocheo, URL & Uthibitishaji

Wakati Kazi ya Wingu inaundwa **kichocheo** lazima kitajwe. Moja ya kawaida ni **HTTPS**, hii ita **unda URL ambapo kazi** inaweza kuchochewa kupitia kivinjari cha wavuti.\
Vichocheo vingine ni pub/sub, Uhifadhi, Hifadhi ya Faili...

Muundo wa URL ni **`https://<region>-<project-gcp-name>.cloudfunctions.net/<func_name>`**

Wakati kichocheo cha HTTPS kinatumika, pia inaonyeshwa ikiwa **mpigaji simu anahitaji idhini ya IAM** kuita Kazi au ikiwa **kila mtu** anaweza tu kuipiga simu:

<figure><img src="../../../.gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

### Ndani ya Kazi ya Wingu

Nambari ina **pakuliwa ndani** ya folda **`/workspace`** na majina sawa ya faili kama yale yanayopatikana kwenye Kazi ya Wingu na inatekelezwa na mtumiaji `www-data`.\
Diski **haipakuliwi kama soma-tu.**

### Uorodheshaji
```bash
# List functions
gcloud functions list
gcloud functions describe <func_name> # Check triggers to see how is this function invoked
gcloud functions get-iam-policy <func_name>

# Get logs of previous runs. By default, limits to 10 lines
gcloud functions logs read <func_name> --limit [NUMBER]

# Call a function
curl https://<region>-<project>.cloudfunctions.net/<func_name>
gcloud functions call <func_name> --data='{"message": "Hello World!"}'

# If you know the name of projects you could try to BF cloud functions names

# Get events that could be used to trigger a cloud function
gcloud functions event-types list

# Access function with authentication
curl -X POST https://<region>-<project>.cloudfunctions.net/<func_name> \
-H "Authorization: bearer $(gcloud auth print-identity-token)" \
-H "Content-Type: application/json" \
-d '{}'
```
### Upandishaji wa Mamlaka

Kwenye ukurasa ufuatao, unaweza kuangalia jinsi ya **kutumia ruhusa za kazi za wingu kwa ajili ya upandishaji wa mamlaka**:

{% content-ref url="../gcp-privilege-escalation/gcp-cloudfunctions-privesc.md" %}
[gcp-cloudfunctions-privesc.md](../gcp-privilege-escalation/gcp-cloudfunctions-privesc.md)
{% endcontent-ref %}

### Upatikanaji usiothibitishwa

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md" %}
[gcp-cloud-functions-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md)
{% endcontent-ref %}

### Baada ya Uvamizi

{% content-ref url="../gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md" %}
[gcp-cloud-functions-post-exploitation.md](../gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md)
{% endcontent-ref %}

### Uthabiti

{% content-ref url="../gcp-persistence/gcp-cloud-functions-persistence.md" %}
[gcp-cloud-functions-persistence.md](../gcp-persistence/gcp-cloud-functions-persistence.md)
{% endcontent-ref %}

## Marejeo

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
