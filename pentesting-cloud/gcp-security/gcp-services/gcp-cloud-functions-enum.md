# GCP - Cloud Functions Enum

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodičnu PEASS**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Cloud Functions <a href="#reviewing-cloud-functions" id="reviewing-cloud-functions"></a>

[Google Cloud Functions](https://cloud.google.com/functions/) su dizajnirane da hostuju vaš kod, koji **se izvršava kao odgovor na događaje**, bez potrebe za upravljanjem operativnim sistemom domaćina. Osim toga, ove funkcije podržavaju čuvanje promenljivih okruženja, koje kod može koristiti.

### Skladištenje

Kod Cloud Functions **je smešten u GCP Skladištu**. Stoga, svako sa **pristupom za čitanje nad bucket-ima** u GCP-u će moći **da čita kod Cloud Functions**.\
Kod je smešten u bucket-u kao jedan od sledećih formata:

* `gcf-sources-<broj>-<region>/<ime-funkcije>-<uuid>/verzija-<n>/izvorni-kod-funkcije.zip`
* `gcf-v2-sources-<broj>-<region>/<ime-funkcije>izvorni-kod-funkcije.zip`

Na primer:\
`gcf-sources-645468741258-us-central1/funkcija-1-003dcbdf-32e1-430f-a5ff-785a6e238c76/verzija-4/izvorni-kod-funkcije.zip`

{% hint style="warning" %}
Svaki korisnik sa **privilegijama za čitanje nad bucket-om** koji čuva Cloud Function bi mogao **da čita izvršeni kod**.
{% endhint %}

### Registar Artefakata

Ako je cloud funkcija konfigurisana tako da je izvršeni Docker kontejner smešten unutar Registra Artefakata repozitorijuma unutar projekta, svako sa pristupom za čitanje nad repozitorijumom će moći da preuzme sliku i proveri izvorni kod. Za više informacija pogledajte:

{% content-ref url="gcp-artifact-registry-enum.md" %}
[gcp-artifact-registry-enum.md](gcp-artifact-registry-enum.md)
{% endcontent-ref %}

### SA

Ako nije specificirano, podrazumevano će biti povezan **App Engine Podrazumevani Servisni Nalog** sa **Editor privilegijama** nad projektom sa Cloud Function.

### Okidači, URL & Autentikacija

Kada se kreira Cloud Function, potrebno je specificirati **okidač**. Jedan uobičajeni je **HTTPS**, koji će **kreirati URL gde funkcija** može biti okidač putem web pregledača.\
Drugi okidači su pub/sub, Skladište, Filestore...

Format URL-a je **`https://<region>-<ime-projekta-gcp>.cloudfunctions.net/<ime_funkcije>`**

Kada se koristi HTTPS okidač, takođe je naznačeno da li **pozivaoc treba da ima IAM autorizaciju** da pozove Funkciju ili ako to može uraditi **svako**:

<figure><img src="../../../.gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

### Unutar Cloud Funkcije

Kod je **preuzet unutar** foldera **`/workspace`** sa istim imenima fajlova kao što ih imaju fajlovi u Cloud Function i izvršava se sa korisnikom `www-data`.\
Disk **nije montiran kao samo za čitanje.**

### Enumeracija
```bash
# List functions
gcloud functions list
gcloud functions describe <func_name> # Check triggers to see how is this function invoked
gcloud functions get-iam-policy <func_name>

# Get logs of previous runs. By default, limits to 10 lines
gcloud functions logs read <func_name> --limit [NUMBER]

# Call a function
curl https://<region>-<project>.cloudfunctions.net/<func_name>
gcloud functions call <func_name> --data='{"message": "Hello World!"}'

# If you know the name of projects you could try to BF cloud functions names

# Get events that could be used to trigger a cloud function
gcloud functions event-types list

# Access function with authentication
curl -X POST https://<region>-<project>.cloudfunctions.net/<func_name> \
-H "Authorization: bearer $(gcloud auth print-identity-token)" \
-H "Content-Type: application/json" \
-d '{}'
```
### Eskalacija privilegija

Na sledećoj stranici možete proveriti kako **zloupotrebiti dozvole cloud funkcija radi eskalacije privilegija**:

{% content-ref url="../gcp-privilege-escalation/gcp-cloudfunctions-privesc.md" %}
[gcp-cloudfunctions-privesc.md](../gcp-privilege-escalation/gcp-cloudfunctions-privesc.md)
{% endcontent-ref %}

### Neautentifikovan pristup

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md" %}
[gcp-cloud-functions-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md)
{% endcontent-ref %}

### Post eksploatacija

{% content-ref url="../gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md" %}
[gcp-cloud-functions-post-exploitation.md](../gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md)
{% endcontent-ref %}

### Upornost

{% content-ref url="../gcp-persistence/gcp-cloud-functions-persistence.md" %}
[gcp-cloud-functions-persistence.md](../gcp-persistence/gcp-cloud-functions-persistence.md)
{% endcontent-ref %}

## Reference

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
