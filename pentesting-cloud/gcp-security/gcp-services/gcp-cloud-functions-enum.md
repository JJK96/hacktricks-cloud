# GCP - Cloud Functions Enum

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking öğrenin ve pratik yapın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live) **bizi takip edin**.
* **HackTricks'e PR göndererek hacking ipuçlarını paylaşın** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına.

</details>
{% endhint %}

## Cloud Functions <a href="#reviewing-cloud-functions" id="reviewing-cloud-functions"></a>

[Google Cloud Functions](https://cloud.google.com/functions/) kodunuzu barındırmak için tasarlanmıştır, bu kod **olaylara yanıt olarak çalıştırılır**, bir ana işletim sistemini yönetmeyi gerektirmez. Ayrıca, bu fonksiyonlar kodun kullanabileceği ortam değişkenlerinin depolanmasını destekler.

### Depolama

Cloud Functions **kodu GCP Storage'da depolanır**. Bu nedenle, GCP'deki **bucket'lar üzerinde okuma erişimi olan herkes** **Cloud Functions kodunu okuyabilir**.\
Kod aşağıdaki gibi bir bucket'ta depolanır:

* `gcf-sources-<number>-<region>/<function-name>-<uuid>/version-<n>/function-source.zip`
* `gcf-v2-sources-<number>-<region>/<function-name>function-source.zip`

Örneğin:\
`gcf-sources-645468741258-us-central1/function-1-003dcbdf-32e1-430f-a5ff-785a6e238c76/version-4/function-source.zip`

{% hint style="warning" %}
Cloud Function'ı depolayan bucket üzerinde **okuma ayrıcalıklarına sahip herhangi bir kullanıcı** **çalıştırılan kodu okuyabilir**.
{% endhint %}

### Artifact Registry

Eğer cloud function, çalıştırılan Docker konteynerinin proje içindeki bir Artifact Registry deposunda saklanacak şekilde yapılandırılmışsa, depo üzerinde okuma erişimi olan herkes imajı indirip kaynak kodunu kontrol edebilir. Daha fazla bilgi için:

{% content-ref url="gcp-artifact-registry-enum.md" %}
[gcp-artifact-registry-enum.md](gcp-artifact-registry-enum.md)
{% endcontent-ref %}

### SA

Belirtilmediği takdirde, varsayılan olarak **App Engine Default Service Account** **Editor izinleri** ile proje üzerinde Cloud Function'a eklenir.

### Tetikleyiciler, URL ve Kimlik Doğrulama

Bir Cloud Function oluşturulduğunda **tetikleyici** belirtilmelidir. Yaygın olanlardan biri **HTTPS**'dir, bu **fonksiyonun web tarayıcısı üzerinden tetiklenebileceği bir URL oluşturur**.\
Diğer tetikleyiciler pub/sub, Storage, Filestore...

URL formatı **`https://<region>-<project-gcp-name>.cloudfunctions.net/<func_name>`**

HTTPS tetikleyicisi kullanıldığında, **çağıranın IAM yetkilendirmesine sahip olması gerektiği** veya **herkesin** sadece çağırabileceği belirtilir:

<figure><img src="../../../.gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

### Cloud Function İçinde

Kod, **`/workspace`** klasörünün içine **indirilir** ve Cloud Function'daki dosyalarla aynı dosya adlarına sahiptir ve `www-data` kullanıcısı ile çalıştırılır.\
Disk **salt okunur olarak monte edilmez.**

### Enumeration
```bash
# List functions
gcloud functions list
gcloud functions describe <func_name> # Check triggers to see how is this function invoked
gcloud functions get-iam-policy <func_name>

# Get logs of previous runs. By default, limits to 10 lines
gcloud functions logs read <func_name> --limit [NUMBER]

# Call a function
curl https://<region>-<project>.cloudfunctions.net/<func_name>
gcloud functions call <func_name> --data='{"message": "Hello World!"}'

# If you know the name of projects you could try to BF cloud functions names

# Get events that could be used to trigger a cloud function
gcloud functions event-types list

# Access function with authentication
curl -X POST https://<region>-<project>.cloudfunctions.net/<func_name> \
-H "Authorization: bearer $(gcloud auth print-identity-token)" \
-H "Content-Type: application/json" \
-d '{}'
```
### Ayrıcalık Yükseltme

Aşağıdaki sayfada, **ayrıcalıkları yükseltmek için cloud function izinlerini nasıl kötüye kullanabileceğinizi** kontrol edebilirsiniz:

{% content-ref url="../gcp-privilege-escalation/gcp-cloudfunctions-privesc.md" %}
[gcp-cloudfunctions-privesc.md](../gcp-privilege-escalation/gcp-cloudfunctions-privesc.md)
{% endcontent-ref %}

### Kimlik Doğrulaması Olmayan Erişim

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md" %}
[gcp-cloud-functions-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md)
{% endcontent-ref %}

### Sömürü Sonrası

{% content-ref url="../gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md" %}
[gcp-cloud-functions-post-exploitation.md](../gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md)
{% endcontent-ref %}

### Kalıcılık

{% content-ref url="../gcp-persistence/gcp-cloud-functions-persistence.md" %}
[gcp-cloud-functions-persistence.md](../gcp-persistence/gcp-cloud-functions-persistence.md)
{% endcontent-ref %}

## Referanslar

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking öğrenin ve pratik yapın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'ı takip edin.**
* **HackTricks'e PR göndererek hacking ipuçlarını paylaşın** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına.

</details>
{% endhint %}
