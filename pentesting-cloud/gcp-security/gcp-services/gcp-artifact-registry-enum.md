# GCP - Enumera√ß√£o do Registro de Artefatos

{% hint style="success" %}
Aprenda e pratique Hacking AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Treinamento HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Treinamento HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Suporte ao HackTricks</summary>

* Verifique os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Informa√ß√µes B√°sicas

O Registro de Artefatos do Google Cloud √© um servi√ßo totalmente gerenciado que permite **gerenciar, armazenar e proteger seus artefatos de software**. √â essencialmente um reposit√≥rio para **armazenar depend√™ncias de compila√ß√£o**, como imagens **Docker**, pacotes **Maven**, pacotes npm e outros tipos de artefatos. √â **comumente usado em pipelines CI/CD** para armazenar e versionar os artefatos produzidos durante o processo de desenvolvimento de software.

Recursos-chave do Registro de Artefatos incluem:

1. **Reposit√≥rio Unificado**: Suporta **m√∫ltiplos tipos de artefatos**, permitindo que voc√™ tenha um √∫nico reposit√≥rio para imagens Docker, pacotes de linguagem (como Maven do Java, npm do Node.js) e outros tipos de artefatos, possibilitando controles de acesso consistentes e uma visualiza√ß√£o unificada de todos os seus artefatos.
2. **Totalmente Gerenciado**: Como um servi√ßo gerenciado, ele cuida da infraestrutura subjacente, dimensionamento e seguran√ßa, reduzindo a sobrecarga de manuten√ß√£o para os usu√°rios.
3. **Controle de Acesso Detalhado**: Integra-se ao Gerenciamento de Identidade e Acesso do Google Cloud (IAM), permitindo que voc√™ defina quem pode acessar, fazer upload ou baixar artefatos em seus reposit√≥rios.
4. **Geo-replica√ß√£o**: Suporta a replica√ß√£o de artefatos em v√°rias regi√µes, melhorando a velocidade de downloads e garantindo disponibilidade.
5. **Integra√ß√£o com os Servi√ßos do Google Cloud**: Funciona perfeitamente com **outros servi√ßos do GCP como Cloud Build, Kubernetes Engine e Compute Engine**, tornando-o uma escolha conveniente para equipes que j√° trabalham no ecossistema do Google Cloud.
6. **Seguran√ßa**: Oferece recursos como **verifica√ß√£o de vulnerabilidades e an√°lise de cont√™ineres** para garantir que os artefatos armazenados sejam seguros e livres de problemas de seguran√ßa conhecidos.

### Formatos e Modos

Ao criar um novo reposit√≥rio, √© poss√≠vel **selecionar o formato/tipo** do reposit√≥rio entre v√°rios como Docker, Maven, npm, Python... e o modo que geralmente pode ser um destes tr√™s:

* **Reposit√≥rio Padr√£o**: Modo padr√£o para **armazenar seus pr√≥prios artefatos** (como imagens Docker, pacotes Maven) diretamente no GCP. √â seguro, escal√°vel e se integra bem ao ecossistema do Google Cloud.
* **Reposit√≥rio Remoto** (se dispon√≠vel): Age como um proxy para **armazenar em cache artefatos de reposit√≥rios externos**, p√∫blicos. Ajuda a evitar problemas de altera√ß√µes de depend√™ncias upstream e reduz a lat√™ncia armazenando em cache artefatos acessados com frequ√™ncia.
* **Reposit√≥rio Virtual** (se dispon√≠vel): Fornece uma **interface unificada para acessar v√°rios reposit√≥rios (padr√£o ou remoto)** por meio de um √∫nico ponto de extremidade, simplificando a configura√ß√£o do lado do cliente e o gerenciamento de acesso para artefatos distribu√≠dos em v√°rios reposit√≥rios.
* Para um reposit√≥rio virtual, voc√™ precisar√° **selecionar reposit√≥rios e atribuir-lhes uma prioridade** (o reposit√≥rio com a maior prioridade ser√° usado).
* Voc√™ pode **misturar reposit√≥rios remotos e padr√£o** em um **virtual**, se a **prioridade** do **remoto** for **maior** que a do padr√£o, **pacotes do remoto (PyPi, por exemplo) ser√£o usados**. Isso poderia levar a uma **Confus√£o de Depend√™ncias**.

Observe que na **vers√£o Remota do Docker** √© poss√≠vel fornecer um nome de usu√°rio e token para acessar o Docker Hub. O **token √© ent√£o armazenado no Secret Manager**.

### Criptografia

Como esperado, por padr√£o √© usado uma chave gerenciada pelo Google, mas uma chave gerenciada pelo cliente pode ser indicada (CMEK).

### Pol√≠ticas de Limpeza

* **Excluir artefatos:** Os artefatos ser√£o **exclu√≠dos de acordo com os crit√©rios da pol√≠tica de limpeza**.
* **Teste de execu√ß√£o a seco:** (Padr√£o) Os artefatos **n√£o ser√£o exclu√≠dos**. As pol√≠ticas de limpeza ser√£o avaliadas e eventos de exclus√£o de teste enviados para o Cloud Audit Logging.

### Verifica√ß√£o de Vulnerabilidades

√â poss√≠vel habilitar o **scanner de vulnerabilidades** que verificar√° vulnerabilidades dentro de **imagens de cont√™ineres**.

### Enumera√ß√£o
```bash
# Get repositories
gcloud artifacts repositories list
gcloud artifacts repositories describe --location <location> <repo-name>
gcloud artifacts versions list --repository=<repo-name> -location <location> --package <package-name>

# Get settings of a repository (example using python but could be other)
gcloud artifacts print-settings python --repository <repo-name> --location <location>

# Get docker images
gcloud artifacts docker images list us-central1-docker.pkg.dev/<proj-name>/<repo-name>

# Get packages (like python and others...)
gcloud artifacts packages list --repository <repo-name> --location <location>

# Get SBOMB artifacts
gcloud artifacts sbom list

# Get vulnerabilities (docker images)
gcloud artifacts vulnerabilities list us-east1-docker.pkg.dev/project123/repository123/someimage@sha256:49765698074d6d7baa82f
gcloud artifacts docker images list-vulnerabilities projects/<proj-name>/locations/<location>/scans/<scan-uuid>
```
### Escala√ß√£o de Privil√©gios

{% content-ref url="../gcp-privilege-escalation/gcp-artifact-registry-privesc.md" %}
[gcp-artifact-registry-privesc.md](../gcp-privilege-escalation/gcp-artifact-registry-privesc.md)
{% endcontent-ref %}

### Acesso n√£o autenticado

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md" %}
[gcp-artifact-registry-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md)
{% endcontent-ref %}

### P√≥s-Explora√ß√£o

{% content-ref url="../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md" %}
[gcp-artifact-registry-post-exploitation.md](../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md)
{% endcontent-ref %}

### Persist√™ncia

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Aprenda e pratique Hacking em AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprenda e pratique Hacking em GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Suporte ao HackTricks</summary>

* Verifique os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
