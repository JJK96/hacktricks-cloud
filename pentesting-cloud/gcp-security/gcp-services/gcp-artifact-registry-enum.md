# GCP - 构件库枚举

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或在**Twitter**上关注我 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)提交PR来分享您的黑客技巧
* &#x20;github存储库。

</details>

## 基本信息

Google Cloud构件库是一个完全托管的服务，允许您**管理、存储和保护软件构件**。它本质上是一个**用于存储构建依赖关系**的存储库，例如**Docker**镜像、**Maven**、npm软件包和其他类型的构件。它**通常用于CI/CD流水线**，用于存储和对软件开发过程中产生的构件进行版本控制。

构件库的关键特性包括：

1. **统一存储库**：支持**多种类型的构件**，允许您拥有一个存储库用于Docker镜像、语言包（如Java的Maven、Node.js的npm）和其他类型的构件，实现一致的访问控制和统一视图。
2. **完全托管**：作为托管服务，它负责底层基础设施、扩展和安全性，减少用户的维护工作量。
3. **细粒度访问控制**：它与Google Cloud的身份和访问管理（IAM）集成，允许您定义谁可以访问、上传或下载存储库中的构件。
4. **地理复制**：支持在多个区域之间复制构件，提高下载速度并确保可用性。
5. **与Google Cloud服务集成**：与**其他GCP服务（如Cloud Build、Kubernetes Engine和Compute Engine）**无缝配合，使其成为已在Google Cloud生态系统内工作的团队的便捷选择。
6. **安全性**：提供诸如**漏洞扫描和容器分析**等功能，帮助确保存储的构件安全且没有已知的安全问题。

### 格式和模式

在创建新存储库时，可以**选择存储库的格式/类型**，如Docker、Maven、npm、Python等，以及通常可以是以下三种模式之一：

* **标准存储库**：用于**直接存储您自己的构件**（如Docker镜像、Maven软件包）在GCP中。它安全、可扩展，并且在Google Cloud生态系统内部集成良好。
* **远程存储库**（如果可用）：充当**从外部缓存构件的代理**，公共存储库。它有助于防止依赖项在上游更改并通过缓存经常访问的构件来减少延迟。
* **虚拟存储库**（如果可用）：提供通过单个端点访问多个（标准或远程）存储库的**统一接口**，简化了跨各种存储库分布的构件的客户端配置和访问管理。
* 对于虚拟存储库，您需要**选择存储库并为其分配优先级**（具有最高优先级的存储库将被使用）。
* 您可以在**虚拟**存储库中**混合远程和标准**存储库，如果**远程**的**优先级**比**标准**的**更高**，**将使用来自远程的软件包（例如PyPi）**。这可能导致**依赖混淆**。

请注意，在**远程Docker版本**中，可以提供用户名和令牌以访问Docker Hub。**令牌然后存储在Secret Manager中**。

### 加密

如预期，默认情况下使用Google管理的密钥，但可以指定客户管理的密钥（CMEK）。

### 清理策略

* **删除构件：** 构件将根据清理策略**删除**。
* **干预运行：**（默认）构件将**不会被删除**。将评估清理策略，并将测试删除事件发送到Cloud Audit Logging。

### 漏洞扫描

可以启用**漏洞扫描程序**，它将检查**容器镜像**中的漏洞。

### 枚举
```bash
# Get repositories
gcloud artifacts repositories list
gcloud artifacts repositories describe --location <location> <repo-name>
gcloud artifacts versions list --repository=<repo-name> -location <location> --package <package-name>

# Get settings of a repository (example using python but could be other)
gcloud artifacts print-settings python --repository <repo-name> --location <location>

# Get docker images
gcloud artifacts docker images list us-central1-docker.pkg.dev/<proj-name>/<repo-name>

# Get packages (like python and others...)
gcloud artifacts packages list --repository <repo-name> --location <location>

# Get SBOMB artifacts
gcloud artifacts sbom list

# Get vulnerabilities (docker images)
gcloud artifacts vulnerabilities list us-east1-docker.pkg.dev/project123/repository123/someimage@sha256:49765698074d6d7baa82f
gcloud artifacts docker images list-vulnerabilities projects/<proj-name>/locations/<location>/scans/<scan-uuid>
```
### 提权

{% content-ref url="../gcp-privilege-escalation/gcp-artifact-registry-privesc.md" %}
[gcp-artifact-registry-privesc.md](../gcp-privilege-escalation/gcp-artifact-registry-privesc.md)
{% endcontent-ref %}

### 未经身份验证的访问

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md" %}
[gcp-artifact-registry-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md)
{% endcontent-ref %}

### 后渗透

{% content-ref url="../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md" %}
[gcp-artifact-registry-post-exploitation.md](../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md)
{% endcontent-ref %}

### 持久化

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
学习并练习 AWS 黑客技术：<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks 培训 AWS 红队专家 (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
学习并练习 GCP 黑客技术：<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks 培训 GCP 红队专家 (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持 HackTricks</summary>

* 查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**电报群组**](https://t.me/peass) 或 **关注**我们的 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* 通过向 [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享黑客技巧。

</details>
{% endhint %}
