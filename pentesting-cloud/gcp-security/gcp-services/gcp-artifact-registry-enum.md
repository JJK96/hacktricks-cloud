# GCP - Artifact Registry Enum

{% hint style="success" %}
AWSハッキングの学習と練習:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPハッキングの学習と練習: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksのサポート</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
* **HackTricks**と**HackTricks Cloud**のgithubリポジトリにPRを提出して**ハッキングトリックを共有**してください。

</details>
{% endhint %}

## 基本情報

Google Cloud Artifact Registryは、ソフトウェアアーティファクトを**管理、保存、保護**することができる**完全管理型サービス**です。これは基本的に、**Docker**イメージ、**Maven**、npmパッケージなどの**ビルド依存関係を保存**するためのリポジトリです。これは、ソフトウェア開発プロセス中に生成されたアーティファクトを保存およびバージョン管理するために**CI/CDパイプラインで一般的に使用**されます。

Artifact Registryの主な機能は次のとおりです:

1. **統合リポジトリ**: **複数のアーティファクトタイプ**をサポートし、Dockerイメージ、言語パッケージ（JavaのMaven、Node.jsのnpmなど）などを1つのリポジトリに保存できるため、一貫したアクセス制御とすべてのアーティファクトにわたる統一ビューを実現します。
2. **完全管理**: 管理されたサービスとして、基盤インフラストラクチャ、スケーリング、セキュリティについてはユーザーのメンテナンスオーバーヘッドを軽減します。
3. **細かいアクセス制御**: Google CloudのIdentity and Access Management（IAM）と統合されており、リポジトリ内のアーティファクトにアクセス、アップロード、ダウンロードできるユーザーを定義できます。
4. **ジオレプリケーション**: 複数のリージョンにわたるアーティファクトのレプリケーションをサポートし、ダウンロード速度を向上させ、可用性を確保します。
5. **Google Cloudサービスとの統合**: **Cloud Build、Kubernetes Engine、Compute Engine**などの**他のGCPサービス**とシームレスに連携し、Google Cloudエコシステム内で作業しているチームにとって便利な選択肢となります。
6. **セキュリティ**: **脆弱性スキャンとコンテナ分析**などの機能を提供し、保存されたアーティファクトが安全で既知のセキュリティ問題から解放されていることを確認します。

### フォーマットとモード

新しいリポジトリを作成する際には、リポジトリの**フォーマット/タイプ**を選択し、通常は次の3つのモードのいずれかを選択できます:

* **標準リポジトリ**: GCP内に直接**自分自身のアーティファクト**（Dockerイメージ、Mavenパッケージなど）を保存するためのデフォルトモードです。セキュリティが確保され、スケーラブルであり、Google Cloudエコシステム内での統合がうまく行われます。
* **リモートリポジトリ**（利用可能な場合）: **外部の**公開リポジトリからアーティファクトを**キャッシュするプロキシ**として機能します。上流で依存関係が変更される問題を防ぎ、頻繁にアクセスされるアーティファクトをキャッシュすることでレイテンシを低減します。
* **仮想リポジトリ**（利用可能な場合）: **1つのエンドポイントを介して複数の（標準またはリモート）リポジトリにアクセスする**統一インターフェースを提供し、さまざまなリポジトリに分散されたアーティファクトのクライアント側構成とアクセス管理を簡素化します。
* 仮想リポジトリでは、**リポジトリを選択し、優先度を付ける必要があります**（最も優先度の高いリポジトリが使用されます）。
* **リモート**の**優先度**が**標準**よりも**高い**場合、**仮想**リポジトリに**リモートと標準**のリポジトリを**混在させることができます**。これにより**Dependency Confusion**が発生する可能性があります。

**Dockerのリモートバージョン**では、Docker Hubにアクセスするためのユーザー名とトークンを指定することができます。**トークンはその後、Secret Managerに保存されます**。

### 暗号化

予想どおり、デフォルトではGoogle管理のキーが使用されますが、顧客管理型キー（CMEK）を指定することもできます。

### クリーンアップポリシー

* **アーティファクトの削除:** アーティファクトは**クリーンアップポリシー**の基準に従って**削除**されます。
* **ドライラン:**（デフォルト）アーティファクトは**削除されません**。クリーンアップポリシーが評価され、Cloud Audit Loggingにテスト削除イベントが送信されます。

### 脆弱性スキャン

**コンテナイメージ**内の**脆弱性**をチェックする**脆弱性スキャナ**を有効にすることができます。

### 列挙
```bash
# Get repositories
gcloud artifacts repositories list
gcloud artifacts repositories describe --location <location> <repo-name>
gcloud artifacts versions list --repository=<repo-name> -location <location> --package <package-name>

# Get settings of a repository (example using python but could be other)
gcloud artifacts print-settings python --repository <repo-name> --location <location>

# Get docker images
gcloud artifacts docker images list us-central1-docker.pkg.dev/<proj-name>/<repo-name>

# Get packages (like python and others...)
gcloud artifacts packages list --repository <repo-name> --location <location>

# Get SBOMB artifacts
gcloud artifacts sbom list

# Get vulnerabilities (docker images)
gcloud artifacts vulnerabilities list us-east1-docker.pkg.dev/project123/repository123/someimage@sha256:49765698074d6d7baa82f
gcloud artifacts docker images list-vulnerabilities projects/<proj-name>/locations/<location>/scans/<scan-uuid>
```
### 特権昇格

{% content-ref url="../gcp-privilege-escalation/gcp-artifact-registry-privesc.md" %}
[gcp-artifact-registry-privesc.md](../gcp-privilege-escalation/gcp-artifact-registry-privesc.md)
{% endcontent-ref %}

### 認証されていないアクセス

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md" %}
[gcp-artifact-registry-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md)
{% endcontent-ref %}

### 攻撃後の処理

{% content-ref url="../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md" %}
[gcp-artifact-registry-post-exploitation.md](../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md)
{% endcontent-ref %}

### 永続性

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
AWSハッキングの学習と練習：<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPハッキングの学習と練習：<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksのサポート</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
* ハッキングトリックを共有するために、[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>
{% endhint %}
