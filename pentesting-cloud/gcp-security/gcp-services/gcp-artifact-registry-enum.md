# GCP - Enumerazione del Registro degli Artefatti

<details>

<summary><strong>Impara l'hacking su AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team di HackTricks su AWS)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se desideri vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)
* &#x20;repository di GitHub.

</details>

## Informazioni di Base

Google Cloud Artifact Registry √® un servizio completamente gestito che ti consente di **gestire, archiviare e proteggere i tuoi artefatti software**. √à essenzialmente un repository per **archiviare le dipendenze di compilazione**, come immagini **Docker**, pacchetti **Maven**, pacchetti npm e altri tipi di artefatti. Viene **comunemente utilizzato nei flussi di lavoro CI/CD** per archiviare e versionare gli artefatti prodotti durante il processo di sviluppo del software.

Le caratteristiche chiave di Artifact Registry includono:

1. **Repository Unificato**: Supporta **diversi tipi di artefatti**, consentendoti di avere un singolo repository per immagini Docker, pacchetti di linguaggio (come Maven di Java, npm di Node.js) e altri tipi di artefatti, consentendo controlli di accesso coerenti e una visione unificata di tutti i tuoi artefatti.
2. **Completamente Gestito**: Come servizio gestito, si occupa dell'infrastruttura sottostante, dello scaling e della sicurezza, riducendo l'onere della manutenzione per gli utenti.
3. **Controllo degli Accessi Dettagliato**: Si integra con la Gestione dell'Identit√† e degli Accessi (IAM) di Google Cloud, consentendoti di definire chi pu√≤ accedere, caricare o scaricare artefatti nei tuoi repository.
4. **Geo-replicazione**: Supporta la replica degli artefatti in pi√π regioni, migliorando la velocit√† di download e garantendo la disponibilit√†.
5. **Integrazione con i Servizi Google Cloud**: Funziona in modo trasparente con **altri servizi GCP come Cloud Build, Kubernetes Engine e Compute Engine**, rendendolo una scelta conveniente per i team che gi√† lavorano all'interno dell'ecosistema Google Cloud.
6. **Sicurezza**: Offre funzionalit√† come **scansione delle vulnerabilit√† e analisi dei container** per garantire che gli artefatti archiviati siano sicuri e privi di problemi di sicurezza noti.

### Formati e Modalit√†

Nel creare un nuovo repository √® possibile **selezionare il formato/tipo** del repository tra diversi come Docker, Maven, npm, Python... e la modalit√† che di solito pu√≤ essere una di queste tre:

* **Repository Standard**: Modalit√† predefinita per **archiviare i propri artefatti** (come immagini Docker, pacchetti Maven) direttamente in GCP. √à sicuro, scalabile e si integra bene nell'ecosistema Google Cloud.
* **Repository Remoto** (se disponibile): Agisce come proxy per **memorizzare in cache artefatti da repository esterni**, pubblici. Aiuta a prevenire problemi derivanti da modifiche alle dipendenze a monte e riduce la latenza memorizzando in cache gli artefatti frequentemente accessati.
* **Repository Virtuale** (se disponibile): Fornisce un'**interfaccia unificata per accedere a pi√π repository (standard o remoti)** attraverso un singolo punto finale, semplificando la configurazione lato client e la gestione degli accessi per gli artefatti distribuiti in vari repository.
* Per un repository virtuale sar√† necessario **selezionare i repository e assegnare loro una priorit√†** (il repository con la priorit√† maggiore sar√† utilizzato).
* Puoi **mescolare repository remoti e standard** in uno **virtuale**, se la **priorit√†** del **remoto** √® **maggiore** rispetto a quella standard, **saranno utilizzati i pacchetti dal remoto (ad esempio PyPi)**. Ci√≤ potrebbe portare a una **Confusione delle Dipendenze**.

Si noti che nella **versione remota di Docker** √® possibile fornire un nome utente e un token per accedere a Docker Hub. Il **token viene quindi memorizzato nel Gestore delle Chiavi**.

### Crittografia

Come previsto, per impostazione predefinita viene utilizzata una chiave gestita da Google, ma pu√≤ essere indicata una chiave gestita dal cliente (CMEK).

### Politiche di Pulizia

* **Elimina artefatti:** Gli artefatti verranno **eliminati in base ai criteri di pulizia**.
* **Prova a secco:** (Quello predefinito) Gli artefatti **non verranno eliminati**. Le politiche di pulizia verranno valutate e verranno inviati eventi di eliminazione di test a Cloud Audit Logging.

### Scansione delle Vulnerabilit√†

√à possibile abilitare lo **scanner di vulnerabilit√†** che controller√† le vulnerabilit√† all'interno delle **immagini dei container**.

### Enumerazione
```bash
# Get repositories
gcloud artifacts repositories list
gcloud artifacts repositories describe --location <location> <repo-name>
gcloud artifacts versions list --repository=<repo-name> -location <location> --package <package-name>

# Get settings of a repository (example using python but could be other)
gcloud artifacts print-settings python --repository <repo-name> --location <location>

# Get docker images
gcloud artifacts docker images list us-central1-docker.pkg.dev/<proj-name>/<repo-name>

# Get packages (like python and others...)
gcloud artifacts packages list --repository <repo-name> --location <location>

# Get SBOMB artifacts
gcloud artifacts sbom list

# Get vulnerabilities (docker images)
gcloud artifacts vulnerabilities list us-east1-docker.pkg.dev/project123/repository123/someimage@sha256:49765698074d6d7baa82f
gcloud artifacts docker images list-vulnerabilities projects/<proj-name>/locations/<location>/scans/<scan-uuid>
```
### Escalazione dei privilegi

{% content-ref url="../gcp-privilege-escalation/gcp-artifact-registry-privesc.md" %}
[gcp-artifact-registry-privesc.md](../gcp-privilege-escalation/gcp-artifact-registry-privesc.md)
{% endcontent-ref %}

### Accesso non autenticato

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md" %}
[gcp-artifact-registry-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md)
{% endcontent-ref %}

### Post-Esploitation

{% content-ref url="../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md" %}
[gcp-artifact-registry-post-exploitation.md](../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md)
{% endcontent-ref %}

### Persistenza

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Impara e pratica l'hacking su AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Impara e pratica l'hacking su GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
