# GCP - KMS Enum

{% hint style="success" %}
Lernen Sie und √ºben Sie AWS-Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen Sie und √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys senden.

</details>
{% endhint %}

## KMS

Der [**Cloud Key Management Service**](https://cloud.google.com/kms/docs/) dient als sicherer Speicher f√ºr **kryptografische Schl√ºssel**, die f√ºr Operationen wie **Verschl√ºsselung und Entschl√ºsselung sensibler Daten** unerl√§sslich sind. Diese Schl√ºssel sind in Schl√ºsselringen organisiert, was eine strukturierte Verwaltung erm√∂glicht. Dar√ºber hinaus kann der Zugriff genau konfiguriert werden, entweder auf der Ebene des einzelnen Schl√ºssels oder f√ºr den gesamten Schl√ºsselring, um sicherzustellen, dass Berechtigungen genau den Sicherheitsanforderungen entsprechen.

KMS-Schl√ºsselringe werden standardm√§√üig als global erstellt, was bedeutet, dass die Schl√ºssel innerhalb dieses Schl√ºsselrings von jedem Standort aus zug√§nglich sind. Es ist jedoch m√∂glich, spezifische Schl√ºsselringe in **bestimmten Regionen** zu erstellen.

### Schl√ºsselschutzniveau

* **Software-Schl√ºssel**: Software-Schl√ºssel werden **vollst√§ndig in Software von KMS erstellt und verwaltet**. Diese Schl√ºssel sind **nicht durch ein Hardware-Sicherheitsmodul (HSM) gesch√ºtzt** und k√∂nnen f√ºr **Test- und Entwicklungszwecke** verwendet werden. Software-Schl√ºssel werden f√ºr die **Produktion nicht empfohlen**, da sie eine geringe Sicherheit bieten und anf√§llig f√ºr Angriffe sind.
* **Cloud-gehostete Schl√ºssel**: Cloud-gehostete Schl√ºssel werden von KMS **in der Cloud mit Hilfe einer hochverf√ºgbaren und zuverl√§ssigen Infrastruktur erstellt und verwaltet**. Diese Schl√ºssel sind **durch HSMs gesch√ºtzt**, aber die HSMs sind **nicht einem bestimmten Kunden gewidmet**. Cloud-gehostete Schl√ºssel sind f√ºr die meisten Produktionsf√§lle geeignet.
* **Externe Schl√ºssel**: Externe Schl√ºssel werden **au√üerhalb von KMS erstellt und verwaltet** und werden zur Verwendung in kryptografischen Operationen in KMS importiert. Externe Schl√ºssel **k√∂nnen in einem Hardware-Sicherheitsmodul (HSM) oder einer Softwarebibliothek gespeichert werden, je nach Kundenpr√§ferenz**.

### Schl√ºsselzwecke

* **Symmetrische Verschl√ºsselung/Entschl√ºsselung**: Wird verwendet, um **Daten mit einem einzigen Schl√ºssel f√ºr beide Operationen zu verschl√ºsseln und zu entschl√ºsseln**. Symmetrische Schl√ºssel sind schnell und effizient f√ºr die Verschl√ºsselung und Entschl√ºsselung gro√üer Datenmengen.
* **Unterst√ºtzt**: [cryptoKeys.encrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/encrypt), [cryptoKeys.decrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/decrypt)
* **Asymmetrische Signierung**: Wird f√ºr eine sichere Kommunikation zwischen zwei Parteien ohne Weitergabe des Schl√ºssels verwendet. Asymmetrische Schl√ºssel bestehen aus einem **√∂ffentlichen Schl√ºssel und einem privaten Schl√ºssel**. Der √∂ffentliche Schl√ºssel wird mit anderen geteilt, w√§hrend der private Schl√ºssel geheim gehalten wird.
* **Unterst√ºtzt**: [cryptoKeyVersions.asymmetricSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricSign), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **Asymmetrische Entschl√ºsselung**: Wird verwendet, um die Echtheit einer Nachricht oder Daten zu √ºberpr√ºfen. Eine digitale Signatur wird mit einem privaten Schl√ºssel erstellt und kann mit dem entsprechenden √∂ffentlichen Schl√ºssel √ºberpr√ºft werden.
* **Unterst√ºtzt**: [cryptoKeyVersions.asymmetricDecrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricDecrypt), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **MAC-Signierung**: Wird verwendet, um die **Datenintegrit√§t und Echtheit durch Erstellung eines Message Authentication Code (MAC) mit einem geheimen Schl√ºssel** sicherzustellen. HMAC wird h√§ufig zur Nachrichtenauthentifizierung in Netzwerkprotokollen und Softwareanwendungen verwendet.
* **Unterst√ºtzt**: [cryptoKeyVersions.macSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macSign), [cryptoKeyVersions.macVerify](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macVerify)

### Rotationszeitraum & Programmierter Zerst√∂rungszeitraum

Standardm√§√üig alle **90 Tage**, aber es kann **einfach** und **vollst√§ndig angepasst werden**.

Der Zeitraum f√ºr die "Programmierung der Zerst√∂rung" ist die **Zeit seit der Anforderung des Benutzers zur L√∂schung des Schl√ºssels** bis zur tats√§chlichen **L√∂schung des Schl√ºssels**. Er kann nach der Erstellung des Schl√ºssels nicht ge√§ndert werden (Standard 1 Tag).

### Prim√§re Version

Jeder KMS-Schl√ºssel kann mehrere Versionen haben, eine davon muss die **Standardversion** sein, die verwendet wird, wenn bei der Interaktion mit dem KMS-Schl√ºssel **keine Version angegeben ist**.

### Auflistung

Wenn Sie **Berechtigungen zum Auflisten der Schl√ºssel haben**, so k√∂nnen Sie auf diese zugreifen:
```bash
# List the global keyrings available
gcloud kms keyrings list --location global
gcloud kms keyrings get-iam-policy <KEYRING>

# List the keys inside a keyring
gcloud kms keys list --keyring <KEYRING> --location <global/other_locations>
gcloud kms keys get-iam-policy <KEY>

# Encrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global

# Decrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global
```
### Privilege Escalation

{% content-ref url="../gcp-privilege-escalation/gcp-kms-privesc.md" %}
[gcp-kms-privesc.md](../gcp-privilege-escalation/gcp-kms-privesc.md)
{% endcontent-ref %}

### Post Exploitation

{% content-ref url="../gcp-post-exploitation/gcp-kms-post-exploitation.md" %}
[gcp-kms-post-exploitation.md](../gcp-post-exploitation/gcp-kms-post-exploitation.md)
{% endcontent-ref %}

## References

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

{% hint style="success" %}
Lernen Sie & √ºben Sie AWS-Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen Sie & √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github Repositories einreichen.

</details>
{% endhint %}
