# GCP - KMS Enum

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın: [**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)\
GCP Hacking öğrenin ve pratik yapın: [**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**](https://training.hacktricks.xyz/courses/grte)

<details>

<summary> HackTricks'i Destekleyin </summary>

- [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
- 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
- **Hacking püf noktalarını paylaşarak PR'ler göndererek HackTricks ve HackTricks Cloud github depolarına katkıda bulunun.**

</details>
{% endhint %}

## KMS

[**Cloud Key Management Service**](https://cloud.google.com/kms/docs/), hassas verilerin şifrelenmesi ve şifrelenmiş verilerin çözümlenmesi gibi işlemler için gerekli olan **şifreleme anahtarlarının** güvenli bir depolama alanı olarak hizmet verir. Bu anahtarlar, yapılandırılmış yönetimi sağlayan anahtar halkaları içinde düzenlenir. Ayrıca, erişim kontrolü, izinlerin güvenlik gereksinimleriyle tam olarak uyumlu olduğundan emin olmak için, bireysel anahtar düzeyinde veya tüm anahtar halkası için titizlikle yapılandırılabilir.

KMS anahtar halkaları **varsayılan olarak küresel olarak oluşturulur**, bu da o anahtar halkasındaki anahtarların herhangi bir bölgeden erişilebilir olduğu anlamına gelir. Bununla birlikte, **belirli bölgelerde belirli anahtar halkaları oluşturmak mümkündür**.

### Anahtar Koruma Seviyesi

- **Yazılım anahtarları**: Yazılım anahtarları, **tamamen yazılım aracılığıyla KMS tarafından oluşturulur ve yönetilir**. Bu anahtarlar, **herhangi bir donanım güvenlik modülü (HSM) tarafından korunmaz** ve **test ve geliştirme amaçları** için kullanılabilir. Yazılım anahtarları, düşük güvenlik sağladıkları ve saldırılara açık oldukları için **üretim için önerilmez**.
- **Bulut barındırılan anahtarlar**: Bulut barındırılan anahtarlar, KMS tarafından bulutta **yüksek erişilebilirlik ve güvenilirlik altyapısı kullanılarak oluşturulur ve yönetilir**. Bu anahtarlar, **HSM'ler tarafından korunur**, ancak HSM'ler **belirli bir müşteriye özgü değildir**. Bulut barındırılan anahtarlar, çoğu üretim kullanım durumu için uygundur.
- **Harici anahtarlar**: Harici anahtarlar, KMS dışında **oluşturulur ve yönetilir** ve şifreleme işlemlerinde kullanılmak üzere KMS'e ithal edilir. Harici anahtarlar, müşterinin tercihine bağlı olarak **bir donanım güvenlik modülünde (HSM) veya yazılım kitaplığında saklanabilir**.

### Anahtar Amaçları

- **Simetrik şifreleme/çözme**: Tek bir anahtar kullanılarak verilerin **hem şifrelenmesi hem de çözülmesi** için kullanılır. Simetrik anahtarlar, büyük veri hacimlerini şifrelemek ve çözmek için hızlı ve verimlidir.
- **Desteklenen**: [cryptoKeys.encrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/encrypt), [cryptoKeys.decrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/decrypt)
- **Asimetrik İmzalama**: İki taraf arasında güvenli iletişim için anahtarın paylaşılmadan kullanıldığı asimetrik anahtarlar kullanılır. Asimetrik anahtarlar, bir **genel anahtar ve özel anahtar** çiftinden oluşur. Genel anahtar başkalarıyla paylaşılırken, özel anahtar gizli tutulur.
- **Desteklenen:** [cryptoKeyVersions.asymmetricSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricSign), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
- **Asimetrik Çözme**: Bir mesajın veya verinin doğruluğunu doğrulamak için kullanılır. Bir dijital imza, bir özel anahtar kullanılarak oluşturulur ve karşılık gelen genel anahtar kullanılarak doğrulanabilir.
- **Desteklenen:** [cryptoKeyVersions.asymmetricDecrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricDecrypt), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
- **MAC İmzalama**: Bir gizli anahtar kullanılarak **veri bütünlüğünü ve doğruluğunu sağlamak için bir mesaj doğrulama kodu (MAC) oluşturulması** için kullanılır. HMAC, ağ protokollerinde ve yazılım uygulamalarında mesaj doğrulaması için yaygın olarak kullanılır.
- **Desteklenen:** [cryptoKeyVersions.macSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macSign), [cryptoKeyVersions.macVerify](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macVerify)

### Döndürme Süresi ve Programlanmış imha süresi

**Varsayılan olarak**, her **90 gün** ancak **kolayca** ve **tamamen özelleştirilebilir.**

"Programlanmış imha" süresi, **kullanıcının anahtarı silmeyi istediği andan** anahtarın **silindiği ana kadar geçen süredir**. Anahtar oluşturulduktan sonra değiştirilemez (varsayılan 1 gün).

### Birincil Sürüm

Her KMS anahtarının birkaç sürümü olabilir, bunlardan biri **varsayılan** olmalıdır, bu, KMS anahtarıyla etkileşimde **sürüm belirtilmediğinde kullanılacak olan sürüm** olacaktır.

### Numaralandırma

**Anahtarları listeleme izinlerine sahipseniz**, bunlara erişebilirsiniz:
```bash
# List the global keyrings available
gcloud kms keyrings list --location global
gcloud kms keyrings get-iam-policy <KEYRING>

# List the keys inside a keyring
gcloud kms keys list --keyring <KEYRING> --location <global/other_locations>
gcloud kms keys get-iam-policy <KEY>

# Encrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global

# Decrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global
```
### Yetki Yükseltme

{% content-ref url="../gcp-privilege-escalation/gcp-kms-privesc.md" %}
[gcp-kms-privesc.md](../gcp-privilege-escalation/gcp-kms-privesc.md)
{% endcontent-ref %}

### Saldırı Sonrası İşlemler

{% content-ref url="../gcp-post-exploitation/gcp-kms-post-exploitation.md" %}
[gcp-kms-post-exploitation.md](../gcp-post-exploitation/gcp-kms-post-exploitation.md)
{% endcontent-ref %}

## Referanslar

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

{% hint style="success" %}
AWS Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitimi AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitimi GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking püf noktalarını paylaşarak PR'ler göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
{% endhint %}
