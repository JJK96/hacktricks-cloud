# GCP - KMS Enum

{% hint style="success" %}
Leer & oefen AWS Hack:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hack: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Controleer die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
{% endhint %}

## KMS

Die [**Cloud Key Management Service**](https://cloud.google.com/kms/docs/) dien as 'n veilige berging vir **kriptografiese sleutels**, wat noodsaaklik is vir operasies soos **versleuteling en ontsleuteling van sensitiewe data**. Hierdie sleutels is georganiseer binne sleutelringe, wat gestruktureerde bestuur moontlik maak. Verder kan toegangsbeheer noukeurig gekonfigureer word, √≥f op individuele sleutelvlak √≥f vir die hele sleutelring, om te verseker dat toestemmings presies belyn is met sekuriteitsvereistes.

KMS sleutelringe word **standaard as globaal geskep**, wat beteken dat die sleutels binne daardie sleutelring van enige streek toeganklik is. Dit is egter moontlik om spesifieke sleutelringe in **spesifieke streke** te skep.

### Sleutelbeskermingsvlak

* **Sagteware sleutels**: Sagteware sleutels word **heeltemal in sagteware deur KMS geskep en bestuur**. Hierdie sleutels word **nie deur enige hardeware-sekuriteitsmodule (HSM) beskerm nie** en kan gebruik word vir **toetsing en ontwikkelingsdoeleindes**. Sagteware sleutels word **nie aanbeveel vir produksie** nie omdat hulle lae sekuriteit bied en vatbaar is vir aanvalle.
* **Wolk-gehoste sleutels**: Wolk-gehoste sleutels word **deur KMS in die wolk geskep en bestuur** met behulp van 'n hoogs beskikbare en betroubare infrastruktuur. Hierdie sleutels word **deur HSM's beskerm**, maar die HSM's is **nie aan 'n spesifieke kli√´nt toegewy nie**. Wolk-gehoste sleutels is geskik vir die meeste produksiegevalle.
* **Eksterne sleutels**: Eksterne sleutels word **buitenkant van KMS geskep en bestuur**, en word ingevoer in KMS vir gebruik in kriptografiese operasies. Eksterne sleutels **kan gestoor word in 'n hardeware-sekuriteitsmodule (HSM) of 'n sagteware-biblioteek, afhangende van die kli√´nt se voorkeur**.

### Sleuteldoelwitte

* **Simmetriese versleuteling/ontsleuteling**: Gebruik om data te **versleutel en ontsleutel met 'n enkele sleutel vir beide operasies**. Simmetriese sleutels is vinnig en doeltreffend vir die versleuteling en ontsleuteling van groot volumes data.
* **Ondersteun**: [cryptoKeys.encrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/encrypt), [cryptoKeys.decrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/decrypt)
* **Asimmetriese Ondertekening**: Gebruik vir veilige kommunikasie tussen twee partye sonder om die sleutel te deel. Asimmetriese sleutels kom in 'n paar, bestaande uit 'n **openbare sleutel en 'n privaatsleutel**. Die openbare sleutel word met ander gedeel, terwyl die privaatsleutel geheim gehou word.
* **Ondersteun:** [cryptoKeyVersions.asymmetricSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricSign), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **Asimmetriese Ontsleuteling**: Gebruik om die egtheid van 'n boodskap of data te verifieer. 'n Digitale handtekening word geskep met 'n privaatsleutel en kan geverifieer word met die ooreenstemmende openbare sleutel.
* **Ondersteun:** [cryptoKeyVersions.asymmetricDecrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricDecrypt), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **MAC Ondertekening**: Gebruik om **data-integriteit en egtheid te verseker deur 'n boodskap-verifikasiekode (MAC) te skep met 'n geheime sleutel**. HMAC word algemeen gebruik vir boodskapverifikasie in netwerkprotokolle en sagtewaretoepassings.
* **Ondersteun:** [cryptoKeyVersions.macSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macSign), [cryptoKeyVersions.macVerify](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macVerify)

### Rotasieperiode & Geprogrammeerde vernietigingsperiode

Standaard elke **90 dae** maar dit kan **maklik** en **heeltemal aangepas word.**

Die "Geprogrammeerde vir vernietiging" periode is die **tyd sedert die gebruiker gevra het om die sleutel te verwyder** en totdat die sleutel **verwyder** is. Dit kan nie verander word nadat die sleutel geskep is (standaard 1 dag).

### Prim√™re Weergawe

Elke KMS-sleutel kan verskeie weergawes h√™, een van hulle moet die **verstek** wees, dit sal die een wees wat gebruik word wanneer 'n **weergawe nie gespesifiseer word wanneer daar met die KMS-sleutel ge√Ønteraksieer word**.

### Enumerasie

As jy **toestemmings het om die sleutels te lys** is dit hoe jy toegang daartoe kan verkry:
```bash
# List the global keyrings available
gcloud kms keyrings list --location global
gcloud kms keyrings get-iam-policy <KEYRING>

# List the keys inside a keyring
gcloud kms keys list --keyring <KEYRING> --location <global/other_locations>
gcloud kms keys get-iam-policy <KEY>

# Encrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global

# Decrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global
```
### Voorregverhoging

{% content-ref url="../gcp-privilege-escalation/gcp-kms-privesc.md" %}
[gcp-kms-privesc.md](../gcp-privilege-escalation/gcp-kms-privesc.md)
{% endcontent-ref %}

### Na-uitbuiting

{% content-ref url="../gcp-post-exploitation/gcp-kms-post-exploitation.md" %}
[gcp-kms-post-exploitation.md](../gcp-post-exploitation/gcp-kms-post-exploitation.md)
{% endcontent-ref %}

## Verwysings

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

{% hint style="success" %}
Leer & oefen AWS-hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP-hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kontroleer die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
{% endhint %}
