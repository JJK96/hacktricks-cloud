# GCP - KMS Enum

{% hint style="success" %}
Jifunze na zoezi la Udukuzi wa AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Mafunzo ya HackTricks ya Mtaalam wa Timu Nyekundu ya AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze na zoezi la Udukuzi wa GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Mafunzo ya HackTricks ya Mtaalam wa Timu Nyekundu ya GCP (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa michango**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## KMS

[**Huduma ya Usimamizi wa Kichawi cha Wingu**](https://cloud.google.com/kms/docs/) inafanya kama uhifadhi salama wa **funguo za kryptographi**, ambazo ni muhimu kwa shughuli kama **kuweka na kufuta data nyeti**. Funguo hizi zimepangwa ndani ya pete za funguo, kuruhusu usimamizi ulio na muundo. Zaidi ya hayo, udhibiti wa ufikiaji unaweza kuwekwa kwa umakini, ama kwa kiwango cha funguo binafsi au kwa pete nzima ya funguo, kuhakikisha kuwa ruhusa zinafaa kabisa mahitaji ya usalama.

Pete za funguo za KMS kwa **kawaida huanzishwa kama za kimataifa**, ambayo inamaanisha kwamba funguo ndani ya pete hiyo ya funguo inaweza kufikiwa kutoka eneo lolote. Hata hivyo, niwezekanavyo kuunda pete za funguo maalum katika **mikoa maalum**.

### Kiwango cha Kulinda Funguo

* **Funguo za programu**: Funguo za programu zinaundwa na kusimamiwa na KMS kabisa kwa programu. Funguo hizi **hazilindwi na moduli ya usalama ya vifaa (HSM)** na zinaweza kutumika kwa **madhumuni ya majaribio na maendeleo**. Funguo za programu **si zinashauriwa kwa matumizi ya uzalishaji** kwa sababu zinatoa usalama wa chini na zinaweza kushambuliwa.
* **Funguo zilizohifadhiwa kwenye Wingu**: Funguo zilizohifadhiwa kwenye Wingu zinaundwa na kusimamiwa na KMS kwenye wingu kwa kutumia miundombinu inayopatikana na ya kuaminika. Funguo hizi zinalindwa na HSMs, lakini HSMs **si maalum kwa mteja fulani**. Funguo zilizohifadhiwa kwenye Wingu ni nzuri kwa matumizi mengi ya uzalishaji.
* **Funguo za nje**: Funguo za nje zinaundwa na kusimamiwa nje ya KMS, na kuingizwa kwenye KMS kwa matumizi katika shughuli za kryptographi. Funguo za nje **zinaweza kuhifadhiwa kwenye moduli ya usalama ya vifaa (HSM) au maktaba ya programu, kulingana na upendeleo wa mteja**.

### Madhumuni ya Funguo

* **Ufichamishaji/ufichuaji wa Symmetric**: Hutumika kwa **kuweka na kufuta data kwa kutumia funguo moja kwa shughuli zote mbili**. Funguo za symmetric ni haraka na ufanisi kwa kuweka na kufuta kiasi kikubwa cha data.
* **Inayoungwa mkono**: [cryptoKeys.encrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/encrypt), [cryptoKeys.decrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/decrypt)
* **Kusaini Asymmetric**: Hutumika kwa mawasiliano salama kati ya pande mbili bila kushiriki funguo. Funguo za asymmetric huja kwa jozi, ikiwa na **funguo ya umma na funguo ya siri**. Funguo ya umma inashirikiwa na wengine, wakati funguo ya siri inabaki kuwa siri.
* **Inayoungwa mkono:** [cryptoKeyVersions.asymmetricSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricSign), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **Ufichuaji Asymmetric**: Hutumika kuthibitisha uhalali wa ujumbe au data. Saini ya kidijitali inaundwa kwa kutumia funguo ya siri na inaweza kuthibitishwa kwa kutumia funguo ya umma inayolingana.
* **Inayoungwa mkono:** [cryptoKeyVersions.asymmetricDecrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricDecrypt), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **Kusaini MAC**: Hutumika kuhakikisha **ukamilifu na uhalali wa data kwa kuunda nambari ya uthibitisho wa ujumbe (MAC) kwa kutumia funguo ya siri**. HMAC mara nyingi hutumiwa kwa uthibitisho wa ujumbe katika itifaki za mtandao na programu za programu.
* **Inayoungwa mkono:** [cryptoKeyVersions.macSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macSign), [cryptoKeyVersions.macVerify](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macVerify)

### Kipindi cha Kubadilisha & Kipindi cha Kupangwa kwa Uharibifu

Kwa **kawaida**, kila **siku 90** lakini inaweza **kubadilishwa kwa urahisi** na **kikamilifu kubadilishwa.**

Kipindi cha "Kupangwa kwa uharibifu" ni **muda tangu mtumiaji aombe kufuta funguo** hadi funguo **kufutwa**. Haiwezi kubadilishwa baada ya funguo kuundwa (kawaida siku 1).

### Toleo Kuu

Kila funguo la KMS linaweza kuwa na matoleo kadhaa, mojawapo lazima iwe **toleo la msingi**, hili litatumika wakati **toleo halijaainishwa wakati wa kuingiliana na funguo za KMs**.

### Uorodheshaji

Ukiwa na **ruhusa ya kuorodhesha funguo**, hivi ndivyo unavyoweza kuyafikia:
```bash
# List the global keyrings available
gcloud kms keyrings list --location global
gcloud kms keyrings get-iam-policy <KEYRING>

# List the keys inside a keyring
gcloud kms keys list --keyring <KEYRING> --location <global/other_locations>
gcloud kms keys get-iam-policy <KEY>

# Encrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global

# Decrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global
```
### Upandishaji wa Mamlaka

{% content-ref url="../gcp-privilege-escalation/gcp-kms-privesc.md" %}
[gcp-kms-privesc.md](../gcp-privilege-escalation/gcp-kms-privesc.md)
{% endcontent-ref %}

### Baada ya Uvamizi

{% content-ref url="../gcp-post-exploitation/gcp-kms-post-exploitation.md" %}
[gcp-kms-post-exploitation.md](../gcp-post-exploitation/gcp-kms-post-exploitation.md)
{% endcontent-ref %}

## Marejeo

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

{% hint style="success" %}
Jifunze na zoezi la Udukuzi wa AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Mafunzo ya HackTricks AWS Timu Nyekundu Mtaalam (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze na zoezi la Udukuzi wa GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Mafunzo ya HackTricks GCP Timu Nyekundu Mtaalam (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa michango**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
{% endhint %}
