# GCP - Απαρίθμηση Filestore

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 [**στην ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ κάνοντας υποβολή PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Βασικές Πληροφορίες

Το Google Cloud Filestore είναι ένα **υπηρεσία διαχείρισης αποθήκευσης αρχείων** σχεδιασμένη για εφαρμογές που χρειάζονται τόσο μια **διεπαφή αρχείων όσο και μια κοινόχρηστη αποθήκη για δεδομένα**. Αυτή η υπηρεσία ξεχωρίζει προσφέροντας υψηλής απόδοσης κοινόχρηστες αποθηκεύσεις αρχείων, οι οποίες μπορούν να ενσωματωθούν με διάφορες υπηρεσίες του GCP. Η χρησιμότητά της ξεχωρίζει σε σενάρια όπου οι παραδοσιακές διεπαφές συστήματος αρχείων και σημασιολογία είναι κρίσιμες, όπως στην επεξεργασία πολυμέσων, τη διαχείριση περιεχομένου και το backup βάσεων δεδομένων.

Μπορείτε να το σκεφτείτε όπως οποιοδήποτε άλλο **κοινόχρηστο αποθετήριο εγγράφων NFS** - ένα δυνητικό πηγή ευαίσθητων πληροφοριών.

### Συνδέσεις

Κατά τη δημιουργία μιας περίπτωσης Filestore είναι δυνατόν να **επιλέξετε το δίκτυο όπου θα είναι προσβάσιμο**.

Επιπλέον, **από προεπιλογή όλοι οι πελάτες στο επιλεγμένο δίκτυο VPC και περιοχή θα μπορούν να το προσπελάσουν**, ωστόσο, είναι δυνατόν να **περιορίσετε την πρόσβαση επίσης με βάση τη διεύθυνση IP** ή το εύρος και να υποδείξετε τα δικαιώματα πρόσβασης (Διαχειριστής, Προβολέας Διαχειριστή, Επεξεργαστής, Προβολέας) που ο πελάτης θα λάβει **ανάλογα με τη διεύθυνση IP.**

Μπορεί επίσης να είναι προσβάσιμο μέσω μιας **Σύνδεσης Πρόσβασης Ιδιωτικής Υπηρεσίας:**

* Είναι ανά VPC δίκτυο και μπορεί να χρησιμοποιηθεί σε όλες τις διαχειριζόμενες υπηρεσίες όπως Memorystore, Tensorflow και SQL.
* Είναι **μεταξύ του VPC δικτύου σας και του δικτύου που ανήκει στη Google χρησιμοποιώντας μια διασύνδεση VPC peering**, επιτρέποντας στις περιπτώσεις και υπηρεσίες σας να επικοινωνούν αποκλειστικά με τη **χρήση εσωτερικών διευθύνσεων IP.**
* Δημιουργεί ένα απομονωμένο έργο για εσάς στην πλευρά του παραγωγού υπηρεσιών, που σημαίνει ότι κανένας άλλος πελάτης δεν το μοιράζεται. Θα χρεωθείτε μόνο για τους πόρους που παρέχετε.
* Το VPC peering θα εισάγει νέες διαδρομές στο VPC σας

### Αντίγραφα Ασφαλείας

Είναι δυνατόν να δημιουργήσετε **αντίγραφα ασφαλείας των κοινόχρηστων αρχείων**. Αυτά μπορούν να **επαναφερθούν αργότερα στην αρχική** νέα περίπτωση Fileshare ή σε **νέες**.

### Κρυπτογράφηση

Από προεπιλογή θα χρησιμοποιηθεί ένα **κλειδί κρυπτογράφησης που διαχειρίζεται από τη Google** για την κρυπτογράφηση των δεδομένων, αλλά είναι δυνατόν να επιλέξετε ένα **κλειδί κρυπτογράφησης που διαχειρίζεται από τον πελάτη (CMEK)**.

### Απαρίθμηση

Αν βρείτε ένα filestore διαθέσιμο στο έργο, μπορείτε να το **προσαρτήσετε** από τον υπολογιστή σας που έχει υποστεί παραβίαση. Χρησιμοποιήστε την παρακάτω εντολή για να δείτε αν υπάρχουν κάποια. 

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Σημειώστε ότι ένα υπηρεσία αποθήκευσης αρχείων μπορεί να βρίσκεται σε ένα **εντελώς νέο δίκτυο που δημιουργήθηκε γι' αυτό** (μέσα σε μια Σύνδεση Πρόσβασης Ιδιωτικής Υπηρεσίας, η οποία είναι ένα **VPC peer**).\
Έτσι, ενδέχεται να χρειαστεί να **απαριθμήσετε τους VPC peers** για να εκτελέσετε επίσης το nmap σε αυτά τα εύρη δικτύου.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### Εscalation Προνομίων & Μετά την Εκμετάλλευση

Δεν υπάρχουν τρόποι για την ανάκτηση προνομίων στο GCP ευθέως καταχρώντας αυτήν την υπηρεσία, αλλά χρησιμοποιώντας μερικά **κόλπα Μετά την Εκμετάλλευση είναι δυνατόν να αποκτήσετε πρόσβαση στα δεδομένα** και ίσως να βρείτε κάποια διαπιστευτήρια για την ανάκτηση προνομίων:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Διατήρηση

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 στην [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκινγκ υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο GitHub.

</details>
{% endhint %}
