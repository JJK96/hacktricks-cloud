# GCP - Filestore Enum

{% hint style="success" %}
Naučite i vežbajte hakovanje AWS-a: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Naučite i vežbajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Osnovne informacije

Google Cloud Filestore je **upravljana usluga skladištenja datoteka** prilagođena aplikacijama koje zahtevaju **interfejs datotečnog sistema i deljeni sistem datoteka za podatke**. Ova usluga se ističe pružanjem visokih performansi deljenih datoteka, koje se mogu integrisati sa različitim GCP uslugama. Njena korisnost dolazi do izražaja u scenarijima gde su tradicionalni interfejsi datotečnog sistema i semantika od suštinskog značaja, kao što su obrada medija, upravljanje sadržajem i bekap baza podataka.

Možete to posmatrati kao bilo koji drugi **NFS** **deljeni repozitorijum dokumenata -** potencijalni izvor osetljivih informacija.

### Povezivanja

Prilikom kreiranja instance Filestore-a moguće je **izabrati mrežu preko koje će biti dostupna**.

Osim toga, **po default-u svi klijenti na izabranoj VPC mreži i regionu će moći da joj pristupe**, međutim, moguće je **ograničiti pristup i po IP adresi** ili opsegu i naznačiti privilegiju pristupa (Admin, Admin Viewer, Editor, Viewer) koju će korisnik dobiti **u zavisnosti od IP adrese**.

Takođe, može biti dostupna putem **Privatne Service Access Connection:**

* Su po VPC mreži i mogu se koristiti sa svim upravljanim uslugama poput Memorystore-a, Tensorflow-a i SQL-a.
* **Između vaše VPC mreže i mreže koju poseduje Google koristeći VPC peering**, omogućavajući vašim instancama i uslugama da komuniciraju isključivo **koristeći interne IP adrese**.
* Kreiraju izolovan projekat za vas na strani proizvođača usluge, što znači da ga ne dele drugi korisnici. Bićete naplaćeni samo za resurse koje obezbedite.
* VPC peering će uvesti nove rute u vašu VPC

### Bekapi

Moguće je kreirati **bekape deljenih datoteka**. Ovi se kasnije mogu **obnoviti na originalnom** novom Fileshare instance ili na **novim**.

### Enkripcija

Po default-u će se koristiti **Google-ov upravljani ključ za enkripciju** podataka, ali je moguće izabrati **Korisnički upravljani ključ za enkripciju (CMEK)**.

### Enumeracija

Ako pronađete dostupan filestore u projektu, možete ga **montirati** iz kompromitovane Compute Instance. Koristite sledeću komandu da vidite da li postoji neki.

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Imajte na umu da bi usluga za čuvanje datoteka mogla biti u **potpuno novoj podmreži kreiranoj za nju** (unutar Povezivanja privatnog pristupa usluzi, koje je **VPC peer**).\
Stoga možda trebate **nabrajati VPC peere** kako biste takođe pokrenuli nmap preko tih mrežnih opsega.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### Eskalacija privilegija i post eksploatacija

Ne postoje direktni načini za eskalaciju privilegija u GCP zloupotrebom ovog servisa, ali korišćenjem nekih trikova **post eksploatacije moguće je pristupiti podacima** i možda pronaći neke akreditive za eskalaciju privilegija:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Upornost

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Naučite i vežbajte hakovanje AWS-a:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Naučite i vežbajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
