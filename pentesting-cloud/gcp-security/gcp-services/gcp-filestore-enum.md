# GCP - Filestore Enum

{% hint style="success" %}
Leer & oefen AWS Hack: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hack: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Controleer die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** 💬 [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
{% endhint %}

## Basiese Inligting

Google Cloud Filestore is 'n **bestuurde lêerbergingdiens** wat geskik is vir toepassings wat beide 'n **lêersisteemkoppelvlak en 'n gedeelde lêersisteem vir data** benodig. Hierdie diens blink uit deur hoë prestasie lêerdelings aan te bied, wat geïntegreer kan word met verskeie GCP-dienste. Dit is nuttig in situasies waar tradisionele lêersisteemkoppelvlakke en semantiek krities is, soos in mediaverwerking, inhoudsbestuur, en die rugsteun van databasisse.

Jy kan hierdie sien as enige ander **NFS gedeelde dokumenterepositorium -** 'n potensiële bron van sensitiewe inligting.

### Verbindings

Wanneer 'n Filestore-instantie geskep word, is dit moontlik om **die netwerk waar dit toeganklik gaan wees te kies**.

Verder, **standaard sal alle kliënte op die gekose VPC-netwerk en -streek daartoe in staat wees om dit te benader**, maar dit is moontlik om **die toegang ook te beperk deur IP-adres** of reeks en die toegangsreg (Admin, Admin Viewer, Editor, Viewer) aan te dui wat die kliënt gaan kry **afhangende van die IP-adres.**

Dit kan ook toeganklik wees via 'n **Privaat Diens Toegangsverbindings:**

* Is per VPC-netwerk en kan gebruik word oor alle bestuurde dienste soos Memorystore, Tensorflow en SQL.
* Is **tussen jou VPC-netwerk en 'n netwerk wat deur Google besit word deur 'n VPC-koppeling** te gebruik, wat jou instansies en dienste in staat stel om eksklusief te kommunikeer deur **gebruik te maak van interne IP-adresse**.
* Skep 'n geïsoleerde projek vir jou aan die diensverkoperskant, wat beteken dat geen ander kliënte dit deel nie. Jy sal slegs gefaktureer word vir die hulpbronne wat jy voorsien.
* Die VPC-koppeling sal nuwe roetes na jou VPC invoer

### Rugsteune

Dit is moontlik om **rugsteune van die Lêerdelings** te skep. Hierdie kan later **herstel word in die oorsprong** nuwe Lêerdelingsinstantie of in **nuwes**.

### Versleuteling

Standaard sal 'n **Google-bestuurde versleutelingssleutel** gebruik word om die data te versleutel, maar dit is moontlik om 'n **Kliëntbestuurde versleutelingssleutel (CMEK)** te kies.

### Enumerasie

As jy 'n filestore beskikbaar vind in die projek, kan jy dit **aankoppel** van binne jou gekompromitteerde Rekeninstansie. Gebruik die volgende bevel om te sien of enige bestaan.

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Let daarop dat 'n lêerstoor-diens dalk in 'n **heeltemal nuwe subnetwerk geskep vir dit** kan wees (binne 'n Privaat Diens Toegangsverbinding, wat 'n **VPC-paar** is).\
Jy sal dus moontlik VPC-pare moet **opsom** om ook nmap oor daardie netwerkreeks uit te voer.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### Bevoorregte Eskalasie & Post Exploitation

Daar is nie direkte maniere om voorregte in GCP te eskaleer deur hierdie diens te misbruik nie, maar deur van sommige **Post Exploitation truuks gebruik te maak, is dit moontlik om toegang tot die data te kry** en miskien kan jy enkele geloofsbriewe vind om voorregte te eskaleer:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Volharding

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Leer & oefen AWS Hack:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hack: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kontroleer die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** 💬 [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
