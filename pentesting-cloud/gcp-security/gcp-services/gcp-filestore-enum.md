# GCP - Filestore Enum

{% hint style="success" %}
学习并练习AWS Hacking：<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
学习并练习GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持HackTricks</summary>

* 检查[**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或 **关注**我们的 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR 来分享黑客技巧。**

</details>
{% endhint %}

## 基本信息

Google Cloud Filestore是一种专为需要**文件系统接口和共享文件系统**的应用程序量身定制的**托管文件存储服务**。该服务通过提供高性能文件共享而脱颖而出，可以与各种GCP服务集成。它在传统文件系统接口和语义至关重要的场景中表现出色，例如媒体处理、内容管理和数据库备份。

您可以将其视为任何其他**NFS共享文档存储库** - 一个潜在的敏感信息来源。

### 连接

创建Filestore实例时，可以**选择可以访问它的网络**。

此外，**默认情况下，所选VPC网络和区域上的所有客户端都可以访问它**，但也可以**通过IP地址或范围限制访问**，并指示客户端根据IP地址获得的访问权限（管理员、管理员查看器、编辑器、查看器）。

也可以通过**私有服务访问连接**访问：

* 每个VPC网络都可以跨所有托管服务使用，例如Memorystore、Tensorflow和SQL。
* **在您的VPC网络和Google拥有的网络之间使用VPC对等连接**，使您的实例和服务可以通过**使用内部IP地址**进行专用通信。
* 在服务生产者端为您创建一个隔离的项目，意味着没有其他客户共享它。您只需为您提供的资源付费。
* VPC对等连接将向您的VPC导入新路由

### 备份

可以创建**文件共享的备份**。这些备份可以稍后**在原始**新的Fileshare实例或**新的实例**中**恢复**。

### 加密

默认情况下，将使用**Google管理的加密密钥**加密数据，但可以选择**客户管理的加密密钥（CMEK）**。

### 枚举

如果在项目中找到可用的filestore，可以从已受损的计算实例内**挂载**它。使用以下命令查看是否存在任何实例。

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
请注意，文件存储服务可能位于为其创建的**全新子网络**中（位于专用服务访问连接内，这是一个**VPC对等连接**）。\
因此，您可能需要**枚举VPC对等连接**，以便在这些网络范围上运行nmap。

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### 提权和后渗透

在GCP中没有直接滥用此服务来提升权限的方法，但使用一些后渗透技巧可能可以访问数据，也许您可以找到一些凭据来提升权限：

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### 持久性

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
学习并练习AWS黑客技术：<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks培训AWS红队专家（ARTE）**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
学习并练习GCP黑客技术：<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks培训GCP红队专家（GRTE）**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持HackTricks</summary>

* 查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或 **关注**我们的**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享黑客技巧。

</details>
{% endhint %}
