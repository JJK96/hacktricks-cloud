# GCP - Filestore Enum

{% hint style="success" %}
AWSハッキングの学習と練習:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPハッキングの学習と練習: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksのサポート</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**または**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
* **HackTricks**と**HackTricks Cloud**のgithubリポジトリにPRを提出して**ハッキングトリックを共有**してください。

</details>
{% endhint %}

## 基本情報

Google Cloud Filestoreは、**ファイルシステムインターフェースとデータの共有ファイルシステムの両方を必要とするアプリケーション向けに設計された** **管理されたファイルストレージサービス**です。このサービスは、高性能のファイル共有を提供することで優れており、さまざまなGCPサービスと統合できます。従来のファイルシステムインターフェースとセマンティクスが重要なメディア処理、コンテンツ管理、およびデータベースのバックアップなどのシナリオでその有用性が光ります。

これは他の**NFS** **共有ドキュメントリポジトリ**と同様に考えることができます - 機密情報の潜在的なソースです。

### 接続

Filestoreインスタンスを作成する際には、**アクセス可能なネットワークを選択**することができます。

さらに、**デフォルトでは選択したVPCネットワークとリージョンのすべてのクライアントがアクセスできる**ようになりますが、**IPアドレスまたは範囲によるアクセス制限**も可能であり、クライアントが**IPアドレスに応じてアクセス権限(管理者、管理者ビューアー、エディター、ビューアー)を取得**できます。

また、**プライベートサービスアクセス接続**を介してアクセスすることもできます。

* VPCネットワークごとにあり、Memorystore、Tensorflow、SQLなどのすべての管理されたサービスで使用できます。
* **VPCピアリングを使用してGoogleが所有するネットワークとの間で**、内部IPアドレスを使用して**インスタンスとサービスが通信**できるようにします。
* サービスプロデューサー側であなたのために孤立したプロジェクトを作成し、他の顧客と共有されないことを意味します。提供したリソースのみが請求されます。
* VPCピアリングは新しいルートをVPCにインポートします

### バックアップ

**ファイル共有のバックアップ**を作成することができます。これらは後で**元の**新しいFileshareインスタンスまたは**新しいインスタンス**に**復元**できます。

### 暗号化

デフォルトでは、データを暗号化するために**Google管理の暗号化キー**が使用されますが、**顧客管理型暗号化キー(CMEK)**を選択することも可能です。

### 列挙

プロジェクトで利用可能なファイルストアを見つけた場合、侵害されたComputeインスタンス内から**マウント**することができます。次のコマンドを使用して存在するかどうかを確認します。

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
ファイルストアサービスは、それのために作成された**完全に新しいサブネット**内にある可能性があることに注意してください（VPCピア内のプライベートサービスアクセス接続）。\
そのため、**VPCピアを列挙**して、それらのネットワーク範囲にnmapを実行する必要があるかもしれません。

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### 特権昇格とポストエクスプロイテーション

GCP内でこのサービスを悪用して特権を昇格させる方法はありませんが、**ポストエクスプロイテーションのトリックを使用するとデータにアクセスできる可能性があり、特権を昇格させるための資格情報を見つけることができるかもしれません**:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### 永続性

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
AWSハッキングの学習と練習:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPハッキングの学習と練習: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksのサポート</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
* **HackTricks**と**HackTricks Cloud**のgithubリポジトリにPRを提出して**ハッキングトリックを共有**してください。

</details>
{% endhint %}
