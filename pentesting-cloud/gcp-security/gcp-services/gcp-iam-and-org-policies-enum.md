# GCP - IAM, рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓реНрд╕ рдФрд░ рдСрд░реНрдЧ рдиреАрддрд┐рдпрд╛рдБ Enum

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
{% endhint %}

## рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ

рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХреНрдпрд╛ рд╣реИ рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд▓рд┐рдВрдХ рджреЗрдЦреЗрдВ:

{% content-ref url="../gcp-basic-information/" %}
[gcp-basic-information](../gcp-basic-information/)
{% endcontent-ref %}

### рдЧрдгрдирд╛

рдПрдХ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рд╣рдореЗрд╢рд╛ рдХрд┐рд╕реА рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реЛрддрд╛ рд╣реИ:
```bash
gcloud iam service-accounts list --project <project>
```
## рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рд╕рдореВрд╣

GCP рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдФрд░ рд╕рдореВрд╣реЛрдВ рдХрд╛ рдХрд╛рдо рдХреИрд╕реЗ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рджреЗрдЦреЗрдВ:

{% content-ref url="../gcp-basic-information/" %}
[gcp-basic-information](../gcp-basic-information/)
{% endcontent-ref %}

### рдЧрдгрдирд╛

рдЕрдиреБрдорддрд┐рдпреЛрдВ **`serviceusage.services.enable`** рдФрд░ **`serviceusage.services.use`** рдХреЗ рд╕рд╛рде **рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рд╕реЗрд╡рд╛рдПрдВ рд╕рдХреНрд╖рдо** рдХрд░рдирд╛ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, Workspace рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рдкрд░рд┐рдпреЛрдЬрдирд╛ рдирд┐рд░реНрдорд╛рддрд╛** рднреВрдорд┐рдХрд╛ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЙрдиреНрд╣реЗрдВ **рдирдИ рдкрд░рд┐рдпреЛрдЬрдирд╛рдПрдВ рдмрдирд╛рдиреЗ** рдХрд╛ рдЕрдзрд┐рдХрд╛рд░ рдорд┐рд▓рддрд╛ рд╣реИред рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдмрдирд╛рддрд╛ рд╣реИ, рддреЛ рдЙрд╕реЗ рдЙрд╕рдХреЗ рдКрдкрд░ **`owner`** рднреВрдорд┐рдХрд╛ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рддреА рд╣реИред рдЗрд╕рд▓рд┐рдП, рд╡рд╣ **рдЗрди рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдкрд░ рд╕рдХреНрд╖рдо рдХрд░ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ Workspace рдХреЛ рдЧрдгрдирд╛ рдХрд░ рд╕рдХреЗ**ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **Workspace рдореЗрдВ рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реЛрдирд╛ рднреА рдЖрд╡рд╢реНрдпрдХ рд╣реИ** рддрд╛рдХрд┐ рдЗрди API рдХреЛ рдХреЙрд▓ рдХрд░ рд╕рдХреЗрдВред
{% endhint %}

рдпрджрд┐ рдЖрдк **`admin` рд╕реЗрд╡рд╛ рдХреЛ рд╕рдХреНрд╖рдо** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **Workspace рдореЗрдВ рдкрд░реНрдпрд╛рдкреНрдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реИрдВ**, рддреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд▓рд╛рдЗрдиреЛрдВ рдХреЗ рд╕рд╛рде рдЖрдк **рд╕рднреА рд╕рдореВрд╣ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЧрдгрдирд╛** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдпрджреНрдпрдкрд┐ рдпрд╣ **`рдкрд╣рдЪрд╛рди рд╕рдореВрд╣`** рдХрд╣рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдЙрди **рд╕рдореВрд╣реЛрдВ рдХреЛ рднреА рд▓реМрдЯрд╛рддрд╛ рд╣реИ рдЬрд┐рдирдХреЗ рдкрд╛рд╕ рдХреЛрдИ рд╕рдореВрд╣ рдирд╣реАрдВ рд╣реИ**:
```bash
# Enable admin
gcloud services enable admin.googleapis.com
gcloud services enable cloudidentity.googleapis.com

# Using admin.googleapis.com
## List all users
gcloud organizations list #The DIRECTORY_CUSTOMER_ID is the Workspace ID
gcloud beta identity groups preview --customer <workspace-id>

# Using cloudidentity.googleapis.com
## List groups of a user (you can list at least the groups you belong to)
gcloud identity groups memberships search-transitive-groups --member-email <email> --labels=cloudidentity.googleapis.com/groups.discussion_forum

## List Group Members (you can list at least the groups you belong to)
gcloud identity groups memberships list --group-email=<email>
### Make it transitive
gcloud identity groups memberships search-transitive-memberships --group-email=<email>

## Get a graph (if you have enough permissions)
gcloud identity groups memberships get-membership-graph --member-email=<email> --labels=cloudidentity.googleapis.com/groups.discussion_forum
```
{% endcode %}

{% hint style="success" %}
рдкрд┐рдЫрд▓реЗ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдореЗрдВ рдкреИрд░рд╛рдореАрдЯрд░ `--labels` рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдорд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИ рдЕрдЧрд░ рдЖрдк API рдХрд╛ рд╕реАрдзрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ [**PurplePanda рдпрд╣рд╛рдБ рдХрд░рддрд╛ рд╣реИ**](https://github.com/carlospolop/PurplePanda/blob/master/intel/google/discovery/disc\_groups\_users.py)ред
{% endhint %}

рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╕реЗрд╡рд╛ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдХреЗ рдмрд╛рд╡рдЬреВрдж, рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рддреНрд░реБрдЯрд┐ рдорд┐рд▓реЗ рдЬрдм рдЖрдк рдЙрдиреНрд╣реЗрдВ рдЧрдгрдирд╛ рдХрд░ рд░рд╣реЗ рд╣реЛрдВ рдХреНрдпреЛрдВрдХрд┐ рдЖрдкрдХреЗ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝реНрдб рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдирд╣реАрдВ рд╣реИрдВ:

<figure><img src="../../../.gitbook/assets/image (193).png" alt=""><figcaption></figcaption></figure>

## IAM

IAM рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдореМрд▓рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдпрд╣ рджреЗрдЦреЗрдВ**](../gcp-basic-information/#iam-roles)ред

### рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдЕрдиреБрдорддрд┐рдпрд╛рдБ

[**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝**](https://cloud.google.com/resource-manager/docs/default-access-control) рд╕реЗ: рдЬрдм рдПрдХ рд╕рдВрдЧрдарди рд╕рдВрд╕рд╛рдзрди рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЖрдкрдХреЗ рдбреЛрдореЗрди рдореЗрдВ рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рдмрд┐рд▓рд┐рдВрдЧ рдЕрдХрд╛рдЙрдВрдЯ рдирд┐рд░реНрдорд╛рддрд╛** рдФрд░ **рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдирд┐рд░реНрдорд╛рддрд╛** рднреВрдорд┐рдХрд╛рдПрдБ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рддреА рд╣реИрдВред рдпреЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рднреВрдорд┐рдХрд╛рдПрдБ рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рддреБрд░рдВрдд Google Cloud рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЖрдкрдХреЗ рд╕рдВрдЧрдарди рд╕рдВрд╕рд╛рдзрди рдХреЗ рдирд┐рдпрдорд┐рдд рдкрд░рд┐рдЪрд╛рд▓рди рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рд╣реИрдВред

рдпреЗ **рднреВрдорд┐рдХрд╛рдПрдБ** рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд **рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИрдВ:

* `billing.accounts.create` рдФрд░ `resourcemanager.organizations.get`
* `resourcemanager.organizations.get` рдФрд░ `resourcemanager.projects.create`

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдмрдирд╛рддрд╛ рд╣реИ, рддреЛ рд╡рд╣ **рдЙрд╕ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рдорд╛рд▓рд┐рдХ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** рдЕрдиреБрд╕рд╛рд░ [рджрд╕реНрддрд╛рд╡реЗрдЬрд╝](https://cloud.google.com/resource-manager/docs/access-control-proj)ред рдЗрд╕рд▓рд┐рдП, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдмрдирд╛ рд╕рдХреЗрдЧрд╛ рдФрд░ рдЙрд╕ рдкрд░ рдХрд┐рд╕реА рднреА рд╕реЗрд╡рд╛ рдХреЛ рдЪрд▓рд╛ рд╕рдХреЗрдЧрд╛ (рдорд╛рдЗрдирд░реНрд╕? рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рдЧрдгрдирд╛? ...)

{% hint style="danger" %}
GCP рд╕рдВрдЧрдарди рдореЗрдВ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ **рд╕рдВрдЧрдарди рдкреНрд░рд╢рд╛рд╕рдХ** рднреВрдорд┐рдХрд╛ рд╣реИред
{% endhint %}

### set-iam-policy vs add-iam-policy-binding

рдЕрдзрд┐рдХрд╛рдВрд╢ рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВ рдЖрдк рдПрдХ рд╕рдВрд╕рд╛рдзрди рдкрд░ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдзрд┐ **`add-iam-policy-binding`** рдпрд╛ **`set-iam-policy`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдореБрдЦреНрдп рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ **`add-iam-policy-binding` рдПрдХ рдирдИ рднреВрдорд┐рдХрд╛ рдмрд╛рдЗрдВрдбрд┐рдВрдЧ** рдХреЛ рдореМрдЬреВрджрд╛ IAM рдиреАрддрд┐ рдореЗрдВ рдЬреЛрдбрд╝рддрд╛ рд╣реИ рдЬрдмрдХрд┐ **`set-iam-policy`** рдкрд╣рд▓реЗ рдкреНрд░рджрд╛рди рдХреА рдЧрдИ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ **рд╣рдЯрд╛ рджреЗрдЧрд╛** рдФрд░ рдХреЗрд╡рд▓ рдЙрд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХреА рдЧрдИ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ **рд╕реЗрдЯ рдХрд░реЗрдЧрд╛**ред

### рдЧрдгрдирд╛
```bash
# Roles
## List roles
gcloud iam roles list --project $PROJECT_ID # List only custom roles
gcloud iam roles list --filter='etag:AA=='

## Get perms and description of role
gcloud iam roles describe roles/container.admin
gcloud iam roles describe --project <proj-name> <role-name>

# Policies
gcloud organizations get-iam-policy <org_id>
gcloud resource-manager folders get-iam-policy <folder-id>
gcloud projects get-iam-policy <project-id>

# MISC
## Testable permissions in resource
gcloud iam list-testable-permissions --filter "NOT apiDisabled: true" <resource>
## Grantable roles to a resource
gcloud iam list-grantable-roles <project URL>
```
### cloudasset IAM рдЬрд╛рдБрдЪ

рдЗрд╕ рд╕реЗрд╡рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рднрд┐рдиреНрди рд╕рдВрд╕рд╛рдзрдиреЛрдВ (рдЬреИрд╕реЗ рд╕рдВрдЧрдарди, рдлреЛрд▓реНрдбрд░, рдкрд░рд┐рдпреЛрдЬрдирд╛рдПрдБ...) рдореЗрдВ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рд╕рднреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдБрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ рд╣реИрдВред

* рдЕрдиреБрдорддрд┐ **`cloudasset.assets.searchAllIamPolicies`** рдПрдХ рд╕рдВрд╕рд╛рдзрди рдХреЗ рдЕрдВрджрд░ **рд╕рднреА iam рдиреАрддрд┐рдпреЛрдВ** рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреА рд╣реИред
```bash
gcloud asset search-all-iam-policies #By default uses current configured project
gcloud asset search-all-iam-policies --scope folders/1234567
gcloud asset search-all-iam-policies --scope organizations/123456
gcloud asset search-all-iam-policies --scope projects/project-id-123123
```
* рдЕрдиреБрдорддрд┐ **`cloudasset.assets.analyzeIamPolicy`** рдПрдХ рд╕рдВрд╕рд╛рдзрдХ рдХреЗ рднреАрддрд░ рдПрдХ рд╕рдВрд╕рд╛рдзрди рдХреЗ **рд╕рднреА рдЖрдИрдПрдПрдо рдиреАрддрд┐рдпреЛрдВ** рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреА рд╣реИред
```bash
# Needs perm "cloudasset.assets.analyzeIamPolicy" over the asset
gcloud asset analyze-iam-policy --organization=<org-id> \
--identity='user:email@hacktricks.xyz'
gcloud asset analyze-iam-policy --folder=<folder-id> \
--identity='user:email@hacktricks.xyz'
gcloud asset analyze-iam-policy --project=<project-name> \
--identity='user:email@hacktricks.xyz'
```
* рдЕрдиреБрдорддрд┐ **`cloudasset.assets.searchAllResources`** рд╕рдВрдЧрдарди, рдлрд╝реЛрд▓реНрдбрд░, рдпрд╛ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рд╕рднреА рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреА рд╕реВрдЪреА рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдЗрд╕рдореЗрдВ IAM рд╕рдВрдмрдВрдзрд┐рдд рд╕рдВрд╕рд╛рдзрди (рдЬреИрд╕реЗ рднреВрдорд┐рдХрд╛рдПрдБ) рд╢рд╛рдорд┐рд▓ рд╣реИрдВред
```bash
gcloud asset search-all-resources --scope projects/<proj-name>
gcloud asset search-all-resources --scope folders/1234567
gcloud asset search-all-resources --scope organizations/123456
```
* рдЕрдиреБрдорддрд┐ **`cloudasset.assets.analyzeMove`** рдПрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдЬреИрд╕реЗ рд╕рдВрд╕рд╛рдзрди рдкрд░ рдкреНрд░рднрд╛рд╡ рдбрд╛рд▓рдиреЗ рд╡рд╛рд▓реА рдиреАрддрд┐рдпреЛрдВ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреА рд╣реИред
```bash
gcloud asset analyze-move --project=<proj-name> \
--destination-organization=609216679593
```
* рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЕрдиреБрдорддрд┐ **`cloudasset.assets.queryIamPolicy`** рднреА рдореБрдЦреНрдп рд╕рд┐рджреНрдзрд╛рдВрддреЛрдВ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХрд╛ рдЕрдзрд┐рдХрд╛рд░ рджреЗ рд╕рдХрддреА рд╣реИ
```bash
# But, when running something like this
gcloud asset query --project=<proj> --statement='SELECT * FROM compute_googleapis_com_Instance'
# I get the error
ERROR: (gcloud.asset.query) UNAUTHENTICATED: QueryAssets API is only supported for SCC premium customers. See https://cloud.google.com/security-command-center/pricing
```
### рдкрд░реАрдХреНрд╖рдгIamPermissions рдЬрд╛рдБрдЪ

{% hint style="danger" %}
рдпрджрд┐ рдЖрдк **рдкрд┐рдЫрд▓реЗ рддрд░реАрдХреЗ рд╕реЗ IAM рдЬрд╛рдирдХрд╛рд░реА рддрдХ рдкрд╣реБрдБрдЪ рдирд╣реАрдВ рдкрд╛ рд░рд╣реЗ** рд╣реИрдВ рдФрд░ рдЖрдк рд░реЗрдб рдЯреАрдо рдореЗрдВ рд╣реИрдВред рддреЛ рдЖрдк **рдЕрдкрдиреА рд╡рд░реНрддрдорд╛рди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдмреНрд░реВрдЯ-рдлрд╝реЛрд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ [**https://github.com/carlospolop/bf\_my\_gcp\_perms**](https://github.com/carlospolop/bf\_my\_gcp\_perms)ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╕реЗрд╡рд╛ **`cloudresourcemanager.googleapis.com`** рдХреЛ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред
{% endhint %}

### Privesc

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдкрд░ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **IAM рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ** рдХреЗ рд▓рд┐рдП рдХреИрд╕реЗ рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="../gcp-privilege-escalation/gcp-iam-privesc.md" %}
[gcp-iam-privesc.md](../gcp-privilege-escalation/gcp-iam-privesc.md)
{% endcontent-ref %}

### рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдЬрд╛рдБрдЪ <a href="#service-account-impersonation" id="service-account-impersonation"></a>

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-iam-principals-and-org-unauthenticated-enum.md" %}
[gcp-iam-principals-and-org-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-iam-principals-and-org-unauthenticated-enum.md)
{% endcontent-ref %}

### рдкреЛрд╕реНрдЯ рдПрдХреНрд╕рдкреНрд▓реЛрдЗрдЯреЗрд╢рди <a href="#service-account-impersonation" id="service-account-impersonation"></a>

{% content-ref url="../gcp-post-exploitation/gcp-iam-post-exploitation.md" %}
[gcp-iam-post-exploitation.md](../gcp-post-exploitation/gcp-iam-post-exploitation.md)
{% endcontent-ref %}

### рд╕реНрдерд┐рд░рддрд╛

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реИрдВ рддреЛ рдЖрдк:

* рдирдП рдПрд╕рдП (рдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрджрд┐ Workspace рдореЗрдВ рд╣реИрдВ) рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ
* рдЕрдкрдиреЗ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓реНрд╕ рдХреЛ рдЕрдзрд┐рдХ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рджреЗ рд╕рдХрддреЗ рд╣реИрдВ
* рд╡рд┐рдХрд▓реНрдк рдПрд╕рдП (vm рдореЗрдВ SSRF, vuln Cloud Function рдореЗрдВтАж) рдХреЛ рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рджреЗ рд╕рдХрддреЗ рд╣реИрдВ
* ...

## рд╕рдВрдЧрдарди рдиреАрддрд┐рдпрд╛рдБ

рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╕рдВрдЧрдарди рдиреАрддрд┐рдпрд╛рдБ рдХреНрдпрд╛ рд╣реИрдВ, рдпрд╣рд╛рдБ рджреЗрдЦреЗрдВ:

{% content-ref url="../gcp-basic-information/" %}
[gcp-basic-information](../gcp-basic-information/)
{% endcontent-ref %}

IAM рдиреАрддрд┐рдпрд╛рдБ рднреВрдорд┐рдХрд╛рдУрдВ рдХреЛ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдкрд░ рдЬрд┐рд╕реЗ рднреВрдорд┐рдХрд╛рдПрдБ рд╣реИрдВ, рдЗрдВрджреНрд░реАрдп рджреНрд╡рд╛рд░рд╛ рд░рдЦреА рдЧрдИ рд╡рд┐рд╕реНрддрд╛рд░рдг рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рджрд┐рдЦрд╛рддреА рд╣реИрдВред рд╕рдВрдЧрдарди рдиреАрддрд┐рдпрд╛рдБ **рдмрд╛рдзрд┐рдд рдХрд░рддреА рд╣реИрдВ рдХрд┐ рд╡рд╣ рд╕реЗрд╡рд╛рдПрдБ рдХреИрд╕реЗ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ рдпрд╛ рдХреМрди рд╕реА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХреА рдЬрд╛рддреА рд╣реИрдВ**ред рдпрд╣ GCP рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рд╕рдВрд╕рд╛рдзрди рдХреА рдХрдо рд╕реЗ рдХрдо рдЕрдзрд┐рдХрд╛рд░ рдХреЛ рд╕реБрдзрд╛рд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред
```bash
gcloud resource-manager org-policies list --organization=ORGANIZATION_ID
gcloud resource-manager org-policies list --folder=FOLDER_ID
gcloud resource-manager org-policies list --project=PROJECT_ID
```
### рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдкрд░ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдУрд░реНрдЧ рдиреАрддрд┐рдпреЛрдВ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ**:

{% content-ref url="../gcp-privilege-escalation/gcp-orgpolicy-privesc.md" %}
[gcp-orgpolicy-privesc.md](../gcp-privilege-escalation/gcp-orgpolicy-privesc.md)
{% endcontent-ref %}

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
{% endhint %}
