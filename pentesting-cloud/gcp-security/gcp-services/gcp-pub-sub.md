# GCP - Pub/Sub 열거

{% hint style="success" %}
AWS 해킹 학습 및 실습:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP 해킹 학습 및 실습: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks 지원</summary>

* [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **트위터** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**를 팔로우**하세요.
* [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) 깃헙 레포지토리에 PR을 제출하여 해킹 트릭을 공유하세요.

</details>
{% endhint %}

## Pub/Sub <a href="#reviewing-cloud-pubsub" id="reviewing-cloud-pubsub"></a>

[Google **Cloud Pub/Sub**](https://cloud.google.com/pubsub/)은 독립적인 애플리케이션 간의 메시지 교환을 용이하게 하는 서비스로 설명됩니다. 핵심 구성 요소에는 애플리케이션이 **구독**할 수 있는 **토픽**이 포함됩니다. 구독된 애플리케이션은 **메시지를 보내고 받을 수 있는 기능**을 갖습니다. 각 메시지에는 실제 콘텐츠와 관련된 메타데이터가 포함됩니다.

**토픽은 메시지가 전송될 대기열**이며, **구독**은 사용자가 **토픽의 메시지에 액세스하는 데 사용할 객체**입니다. **토픽 당 1개 이상의 구독**이 있을 수 있으며, 구독 유형은 다음과 같습니다:

- **Pull**: 이 구독의 사용자는 메시지를 가져와야 합니다.
- **Push**: URL 엔드포인트가 지정되고 메시지가 즉시 전송됩니다.
- **BigQuery 테이블**: Push와 유사하지만 메시지를 BigQuery 테이블에 설정합니다.
- **Cloud Storage**: 메시지를 기존 버킷으로 직접 전달합니다.

**기본적으로** 구독은 **31일 후에 만료**되지만, 만료되지 않도록 설정할 수 있습니다.

**기본적으로** 메시지는 **7일 동안 보존**되지만 이 시간을 **최대 31일까지 연장**할 수 있습니다. 또한, 10초 내에 **ACK(확인)**되지 않으면 다시 대기열로 돌아갑니다. ACK된 메시지는 계속 저장되어야 한다고 설정할 수도 있습니다.

기본적으로 토픽은 **Google 관리형 암호화 키**를 사용하여 암호화됩니다. 그러나 KMS의 **CMEK(고객 관리형 암호화 키)**도 선택할 수 있습니다.

**Dead letter**: 구독은 **전달 시도 횟수의 최대값**을 구성할 수 있습니다. 메시지를 전달할 수 없을 때 지정된 dead letter 토픽으로 **재게시됩니다**.

### 스냅샷 및 스키마

스냅샷은 **특정 시점의 구독 상태를 캡처하는 기능**입니다. 본질적으로 스냅샷은 구독의 **확인되지 않은 메시지의 일관된 백업**입니다. 스냅샷을 생성하면 구독의 메시지 확인 상태를 보존하여 원래 메시지가 삭제된 후에도 스냅샷이 촬영된 지점부터 메시지 소비를 재개할 수 있습니다.\
매우 운이 좋다면 스냅샷에는 스냅샷이 촬영된 시점의 **이전 민감한 정보**가 포함될 수 있습니다.

토픽을 생성할 때 **토픽 메시지가 스키마를 따라야 한다**고 지정할 수 있습니다.

### 열거
```bash
# Get a list of topics in the project
gcloud pubsub topics list
gcloud pubsub topics describe <topic>
gcloud pubsub topics list-subscriptions <topic>
gcloud pubsub topics get-iam-policy <topic>

# Get a list of subscriptions across all topics
gcloud pubsub subscriptions list
gcloud pubsub subscriptions describe <subscription>
gcloud pubsub subscriptions get-iam-policy <subscription>

# Get list of schemas
gcloud pubsub schemas list
gcloud pubsub schemas describe <schema>
gcloud pubsub schemas list-revisions <schema>

# Get list of snapshots
gcloud pubsub snapshots list
gcloud pubsub snapshots describe <snapshot>
```
그러나 더 나은 결과를 얻을 수 있습니다 [**더 큰 데이터 세트를 요청**](https://cloud.google.com/pubsub/docs/replay-overview)하여 더 오래된 메시지를 포함시킬 수 있습니다. 이에는 몇 가지 선행 조건이 필요하며 응용 프로그램에 영향을 줄 수 있으므로 정말 무엇을 하는지 잘 알고 있어야 합니다.

### 권한 상승 및 사후 공격

{% content-ref url="../gcp-post-exploitation/gcp-pub-sub-post-exploitation.md" %}
[gcp-pub-sub-post-exploitation.md](../gcp-post-exploitation/gcp-pub-sub-post-exploitation.md)
{% endcontent-ref %}

## Pub/Sub Lite

[**Pub/Sub Lite**](https://cloud.google.com/pubsub/docs/choosing-pubsub-or-lite)는 **존별 저장소**를 갖춘 메시징 서비스입니다. Pub/Sub Lite는 Pub/Sub의 **일부 비용**만큼 들며 **최우선 고려 사항이 낮은 비용인** 고용량 스트리밍(초당 최대 1천만 메시지) 파이프라인 및 이벤트 기반 시스템을 위해 설계되었습니다.

PubSub Lite에는 **토픽** 및 **구독**이 있지만 **스냅샷** 및 **스키마**는 없으며 다음이 있습니다:

* **예약**: Pub/Sub Lite 예약은 사용자가 메시지 스트림을 위해 특정 지역의 용량을 예약할 수 있게 하는 기능입니다.
* **작업**: Pub/Sub Lite를 관리하고 관리하는 데 관련된 작업 및 작업을 참조합니다.

### 열거
```bash
# lite-topics
gcloud pubsub lite-topics list
gcloud pubsub lite-topics describe <topic>
gcloud pubsub lite-topics list-subscriptions <topic>

# lite-subscriptions
gcloud pubsub lite-subscriptions list
gcloud pubsub lite-subscriptions describe <subscription>

# lite-reservations
gcloud pubsub lite-reservations list
gcloud pubsub lite-reservations describe <topic>
gcloud pubsub lite-reservations list-topics <topic>

# lite-operations
gcloud pubsub lite-operations list
gcloud pubsub lite-operations describe <topic>
```
{% hint style="success" %}
AWS 해킹 학습 및 실습:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP 해킹 학습 및 실습: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks 지원</summary>

* [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **트위터** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**를 팔로우**하세요.
* 해킹 팁을 공유하려면 [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하세요.

</details>
{% endhint %}
