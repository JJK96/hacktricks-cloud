# GCP - Berging Enum

{% hint style="success" %}
Leer en oefen AWS-hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer en oefen GCP-hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Controleer de [**abonnementsplannen**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
{% endhint %}

## Berging

Google Cloud Platform (GCP) Berging is 'n **wolkgebaseerde bergingsoplossing** wat hoogs duursame en beskikbare objekbergings vir ongestruktureerde data bied. Dit bied **verskeie bergingsklasse** gebaseer op prestasie, beskikbaarheid en koste, insluitend Standaard, Nearline, Coldline, en Argief. GCP Berging bied ook gevorderde kenmerke soos **lewenssiklusbeleide, weergawes, en toegangsbeheer** om data doeltreffend te bestuur en te beveilig.

Die emmer kan in 'n streek, in 2 streke of **multi-streek (verstek)** gestoor word.

### Bergingstipes

* **Standaard Berging**: Dit is die verstek bergingopsie wat **ho√´ prestasie, lae-latensie toegang tot gereeld benaderde data** bied. Dit is geskik vir 'n wye verskeidenheid gevalle, insluitend die bediening van webwerfinhoud, stroommedia, en die gasheer van data-analise-pyplyne.
* **Nearline Berging**: Hierdie bergingsklas bied **laer bergingskoste** en **effens ho√´r toegangskoste** as Standaard Berging. Dit is geoptimaliseer vir selde benaderde data, met 'n minimum bergingsduur van 30 dae. Dit is ideaal vir rugsteun- en argiefdoeleindes.
* **Coldline Berging**: Hierdie bergingsklas is geoptimaliseer vir **langtermyn berging van selde benaderde data**, met 'n minimum bergingsduur van 90 dae. Dit bied die **laer bergingskoste** as Nearline Berging, maar met **ho√´r toegangskoste**.
* **Argiefberging**: Hierdie bergingsklas is ontwerp vir koue data wat **baie selde benader word**, met 'n minimum bergingsduur van 365 dae. Dit bied die **laagste bergingskoste van alle GCP-bergingsopsies** maar met die **hoogste toegangskoste**. Dit is geskik vir langtermynbewaring van data wat vir nakomings- of regulatoriese redes gestoor moet word.
* **Autoklas**: As jy **nie weet hoeveel jy die data gaan benader nie** kan jy Autoklas kies en GCP sal die tipe berging outomaties vir jou verander om koste te minimiseer.

### Toegangsbeheer

Dit is **verkieslik** om die toegang te beheer via **IAM** (verstek), maar dit is ook moontlik om **die gebruik van ACL's te aktiveer**.\
As jy kies om slegs IAM te gebruik (verstek) en **90 dae verloop**, sal jy **nie in staat wees om ACL's te aktiveer** vir die emmer nie.

### Weergawes

Dit is moontlik om weergawes te aktiveer, dit sal **ou weergawes van die l√™er binne die emmer stoor**. Dit is moontlik om die **aantal weergawes wat jy wil behou** te konfigureer en selfs **hoe lank** jy wil h√™ **nie-huidige** weergawes (ou weergawes) moet bly. Aanbeveel word **7 dae vir Standaardtipe**.

Die **metadata van 'n nie-huidige weergawe word behou**. Verder word **ACL's van nie-huidige weergawes ook behou**, sodat ouer weergawes moontlik verskillende ACL's van die huidige weergawe kan h√™.

Leer meer in die [**dokumente**](https://cloud.google.com/storage/docs/object-versioning).

### Bewaringsbeleid

Dui aan hoe **lank** jy wil **verhoed dat die verwydering van Voorwerpe binne die emmer** (baie nuttig vir nakoming ten minste).\
Slegs een van **weergawes of bewaringsbeleid kan gelyktydig geaktiveer word**.

### Versleuteling

Standaard word voorwerpe **versleutel met Google-bestuurde sleutels**, maar jy kan ook 'n **sleutel van KMS** gebruik.

### Openbare Toegang

Dit is moontlik om **eksterne gebruikers** (ingeteken by GCP of nie) **toegang tot emmerinhoud te gee**.\
Standaard, wanneer 'n emmer geskep word, sal die opsie om die emmer openlik bloot te stel, **afgeskakel wees**, maar met genoegsame toestemmings kan dit verander word.

Die **formaat van 'n URL** om toegang tot 'n emmer te verkry is **`https://storage.googleapis.com/<emmer-naam>` of `https://<emmer-naam>.storage.googleapis.com`** (beide is geldig).

### HMAC-sleutels

'n HMAC-sleutel is 'n tipe _volmaggewysiging_ en kan **geassosieer word met 'n diensrekening of 'n gebruikersrekening in Cloud Storage**. Jy gebruik 'n HMAC-sleutel om _handtekeninge_ te skep wat dan ingesluit word in versoeke aan Cloud Storage. Handtekeninge toon dat 'n **spesifieke versoek deur die gebruiker of diensrekening geagoriseer is**.

HMAC-sleutels het twee prim√™re dele, 'n _toegangs-ID_ en 'n _geheim_.

*   **Toegangs-ID**: 'n alfanumeriese string wat gekoppel is aan 'n spesifieke diens of gebruikersrekening. Wanneer dit aan 'n diensrekening gekoppel is, is die string 61 karakters lank, en wanneer dit aan 'n gebruikersrekening gekoppel is, is die string 24 karakters lank. Die volgende toon 'n voorbeeld van 'n toegangs-ID:

`GOOGTS7C7FUP3AIRVJTE2BCDKINBTES3HC2GY5CBFJDCQ2SYHV6A6XXVTJFSA`
*   **Geheim**: 'n 40-karakter Base-64 gekodeerde string wat gekoppel is aan 'n spesifieke toegangs-ID. 'n Geheim is 'n vooraf gedeelde sleutel wat slegs jy en Cloud Storage weet. Jy gebruik jou geheim om handtekeninge te skep as deel van die outentiseringsproses. Die volgende toon 'n voorbeeld van 'n geheim:

`bGoa+V7g/yqDXvKRqq+JTFn4uQZbPiQJo4pf9RzJ`

Beide die **toegangs-ID en geheim identifiseer 'n HMAC-sleutel uniek**, maar die geheim is baie sensitiewe inligting, omdat dit gebruik word om **handtekeninge te skep**.

### Enumerasie
```bash
# List all storage buckets in project
gsutil ls

# Get each bucket configuration (protections, CLs, times, configs...)
gsutil ls -L

# List contents of a specific bucket
gsutil ls gs://bucket-name/
gsutil ls -r gs://bucket-name/ # Recursive
gsutil ls -a gs://bucket-name/ # Get ALL versions of objects

# Cat the context of a file without copying it locally
gsutil cat 'gs://bucket-name/folder/object'
gsutil cat 'gs://bucket-name/folder/object#<num>' # cat specific version

# Copy an object from the bucket to your local storage for review
gsutil cp gs://bucket-name/folder/object ~/

# List using a raw OAuth token
## Useful because "CLOUDSDK_AUTH_ACCESS_TOKEN" and "gcloud config set auth/access_token_file" doesn't work with gsutil
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/<storage-name>/o"
# Download file content from bucket
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/supportstorage-58249/o/flag.txt?alt=media" --output -

# Enumerate HMAC keys
gsutil hmac list

# Get permissions
gcloud storage buckets get-iam-policy gs://bucket-name/
gcloud storage objects get-iam-policy gs://bucket-name/folder/object
```
Indien jy 'n toestemmingsgeweier-fout kry wanneer jy emmers lys, kan jy steeds toegang h√™ tot die inhoud. Nou dat jy bewus is van die naamkonvensie van die emmers, kan jy 'n lys van moontlike name genereer en probeer om toegang tot hulle te verkry:
```bash
for i in $(cat wordlist.txt); do gsutil ls -r gs://"$i"; done
```
Met toestemmings `storage.objects.list` en `storage.objects.get`, behoort jy in staat te wees om alle skywe en l√™ers van die emmer op te som ten einde hulle af te laai. Jy kan dit bereik met hierdie Python-skrip:
```python
import requests
import xml.etree.ElementTree as ET

def list_bucket_objects(bucket_name, prefix='', marker=None):
url = f"https://storage.googleapis.com/{bucket_name}?prefix={prefix}"
if marker:
url += f"&marker={marker}"
response = requests.get(url)
xml_data = response.content
root = ET.fromstring(xml_data)
ns = {'ns': 'http://doc.s3.amazonaws.com/2006-03-01'}
for contents in root.findall('.//ns:Contents', namespaces=ns):
key = contents.find('ns:Key', namespaces=ns).text
print(key)
next_marker = root.find('ns:NextMarker', namespaces=ns)
if next_marker is not None:
next_marker_value = next_marker.text
list_bucket_objects(bucket_name, prefix, next_marker_value)

list_bucket_objects('<storage-name>')
```
### Voorregverhoging

Op die volgende bladsy kan jy sien hoe om **stoorregte te misbruik om voorregte te verhoog**:

{% content-ref url="../gcp-privilege-escalation/gcp-storage-privesc.md" %}
[gcp-storage-privesc.md](../gcp-privilege-escalation/gcp-storage-privesc.md)
{% endcontent-ref %}

### Ongeagte Enum

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/" %}
[gcp-storage-unauthenticated-enum](../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/)
{% endcontent-ref %}

### Na-Exploitasie

{% content-ref url="../gcp-post-exploitation/gcp-storage-post-exploitation.md" %}
[gcp-storage-post-exploitation.md](../gcp-post-exploitation/gcp-storage-post-exploitation.md)
{% endcontent-ref %}

### Volharding

{% content-ref url="../gcp-persistence/gcp-storage-persistence.md" %}
[gcp-storage-persistence.md](../gcp-persistence/gcp-storage-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Leer & oefen AWS-hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP-hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
{% endhint %}
