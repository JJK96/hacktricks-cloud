# GCP - Κατανόηση της Παγίδας Ευρείας Ανάθεσης Τομέα

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Συμμετέχετε** 💬 στην [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Κοινοποιήστε κόλπα χάκερ με την υποβολή PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο GitHub.

</details>
{% endhint %}

Αυτή η ανάρτηση είναι η εισαγωγή του [https://www.hunters.security/en/blog/delefriend-a-newly-discovered-design-flaw-in-domain-wide-delegation-could-leave-google-workspace-vulnerable-for-takeover](https://www.hunters.security/en/blog/delefriend-a-newly-discovered-design-flaw-in-domain-wide-delegation-could-leave-google-workspace-vulnerable-for-takeover) το οποίο μπορεί να ανατεθεί για περισσότερες λεπτομέρειες.

## **Κατανόηση της Ευρείας Ανάθεσης Τομέα**

Η ευρεία ανάθεση του Google Workspace επιτρέπει σε ένα αντικείμενο ταυτότητας, είτε μια **εξωτερική εφαρμογή** από την αγορά του Google Workspace είτε ένα εσωτερικό **Λογαριασμό Υπηρεσίας του GCP**, να **έχει πρόσβαση σε δεδομένα σε όλο το Workspace εκ μέρους των χρηστών**. Αυτό το χαρακτηριστικό, το οποίο είναι κρίσιμο για τις εφαρμογές που αλληλεπιδρούν με τα APIs του Google ή υπηρεσίες που χρειάζονται προσωποποίηση χρήστη, βελτιώνει την αποτελεσματικότητα και μειώνει τον ανθρώπινο λάθος αυτοματοποιώντας εργασίες. Χρησιμοποιώντας το OAuth 2.0, οι προγραμματιστές εφαρμογών και οι διαχειριστές μπορούν να δώσουν σε αυτούς τους λογαριασμούς υπηρεσίας πρόσβαση στα δεδομένα των χρηστών χωρίς την ατομική συγκατάθεση του χρήστη.\
\
Το Google Workspace επιτρέπει τη δημιουργία δύο κύριων τύπων ευρείας ανάθεσης αντικειμένων:

* **Εφαρμογές GWS:** Οι εφαρμογές από την αγορά του Workspace μπορούν να ρυθμιστούν ως ευρεία ταυτότητα. Πριν γίνουν διαθέσιμες στην αγορά, κάθε εφαρμογή Workspace υποβάλλεται σε αναθεώρηση από την Google για να μειωθεί η πιθανότητα κατάχρησης. Αν και αυτό δεν εξαλείφει εντελώς τον κίνδυνο κατάχρησης, αυξάνει σημαντικά τη δυσκολία για τέτοια περιστατικά να συμβούν.
* **Λογαριασμός Υπηρεσίας του GCP:** Μάθετε περισσότερα για τους [**Λογαριασμούς Υπηρεσίας του GCP εδώ**](../gcp-basic-information/#service-accounts).

### **Ευρεία Ανάθεση Τομέα: Κάτω από το Καπό**

Έτσι ένας Λογαριασμός Υπηρεσίας του GCP μπορεί να έχει πρόσβαση στα APIs του Google εκ μέρους άλλων ταυτοτήτων στο Google Workspace:

<figure><img src="../../../.gitbook/assets/image (58).png" alt=""><figcaption></figcaption></figure>

1. **Η Ταυτότητα δημιουργεί ένα JWT:** Η Ταυτότητα χρησιμοποιεί το ιδιωτικό κλειδί του λογαριασμού υπηρεσίας (μέρος του αρχείου ζεύγους κλειδιών JSON) για να υπογράψει ένα JWT. Αυτό το JWT περιέχει διεκδικήσεις σχετικά με τον λογαριασμό υπηρεσίας, τον στόχο χρήστη προς προσωποποίηση και τους εμβέλειες OAuth για πρόσβαση στο REST API που ζητείται.
2. **Η Ταυτότητα χρησιμοποιεί το JWT για να ζητήσει ένα διακριτικό πρόσβασης:** Η εφαρμογή/χρήστης χρησιμοποιεί το JWT για να ζητήσει ένα διακριτικό πρόσβασης από την υπηρεσία OAuth 2.0 της Google. Το αίτημα περιλαμβάνει επίσης τον στόχο χρήστη προς προσωποποίηση (το email του χρήστη του Workspace) και τις εμβέλειες για τις οποίες ζητείται η πρόσβαση.
3. **Η υπηρεσία OAuth 2.0 της Google επιστρέφει ένα διακριτικό πρόσβασης:** Το διακριτικό πρόσβασης αντιπροσωπεύει την εξουσία του λογαριασμού υπηρεσίας να ενεργεί εκ μέρους του χρήστη για τις συγκεκριμένες εμβέλειες. Αυτό το διακριτικό είναι συνήθως περιορισμένης διάρκειας ζωής και πρέπει να ανανεώνεται περιοδικά (ανάλογα με την ανάγκη της εφαρμογής). Είναι ουσιώδες να κατανοήσετε ότι οι εμβέλειες OAuth που καθορίζονται στο διακριτικό JWT έχουν ισχύ και επιδράσεις στο τελικό διακριτικό πρόσβασης. Για παράδειγμα, τα διακριτικά πρόσβασης που κατέχουν πολλές εμβέλειες θα έχουν ισχύ για πολλές εφαρμογές REST API.
4. **Η Ταυτότητα χρησιμοποιεί το διακριτικό πρόσβασης για να καλέσει τα APIs του Google**: Τώρα με ένα σχετικό διακριτικό πρόσβασης, η υπηρεσία μπορεί να έχει πρόσβαση στο απαιτούμενο REST API. Η εφαρμογή χρησιμοποιεί αυτό το διακριτικό πρόσβασης στην κεφαλίδα "Εξουσιοδότηση" των αιτήσεών της HTTP προς τα APIs του Google. Αυτά τα APIs χρησιμοποιούν το διακριτικό για να επαληθεύσουν την προσωποποιημένη ταυτότητα και να επιβεβαιώσουν ότι έχει την απαραίτητη εξουσιοδότηση.
5. **Τα APIs του Google επιστρέφουν τα ζητούμενα δεδομένα**: Αν το διακριτικό πρόσβασης είναι έγκυρο και ο λογαριασμός υπηρεσίας έχει την κατάλληλη εξουσιοδότηση, τα APIs του Google επιστρέφουν τα ζητούμενα δεδομένα. Για παράδειγμα, στην παρακάτω εικόνα, έχουμε εκμεταλλευτεί τη μέθοδο _users.messages.list_ για να καταχωρίσουμε όλα τα αναγνωριστικά μηνυμάτων Gmail που σχετίζονται με έναν στόχο χρήστη του Workspace.

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Συμμετέχε
