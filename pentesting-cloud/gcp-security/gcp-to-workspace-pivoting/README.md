# GCP <--> Workspace рдкрд┐рд╡реЛрдЯрд┐рдВрдЧ

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
{% endhint %}

## **GCP рд╕реЗ GWS рддрдХ**

### **рдбреЛрдореЗрди рд╡рд╛рдЗрдб рдбреЗрд▓реАрдЧреЗрд╢рди рдХреА рдореВрд▓ рдмрд╛рддреЗрдВ**

Google Workspace рдХрд╛ рдбреЛрдореЗрди-рд╡рд╛рдЗрдб рдбреЗрд▓реАрдЧреЗрд╢рди рдПрдХ рдкрд╣рдЪрд╛рди рд╡рд╕реНрддреБ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдпрд╛ рддреЛ рдЧреВрдЧрд▓ рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рдорд╛рд░реНрдХреЗрдЯрдкреНрд▓реЗрд╕ рд╕реЗ рдПрдХ **рдмрд╛рд╣реНрдп рдРрдк** рдпрд╛ рдПрдХ рдЖрдВрддрд░рд┐рдХ **GCP рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛**, рддрд╛рдХрд┐ рд╡рд╣ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдкрдХреНрд╖ рдореЗрдВ рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рдХреЗ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХреЗ**ред

{% hint style="info" %}
рдпрд╣ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдпрд╣ рдЕрд░реНрде рд╣реИ рдХрд┐ **GCP рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ** рдХреЗ **рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ** рдХреЛ рдПрдХ рд╕рдВрдЧрдарди рдХреЗ **рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рднрд╛рд╡рдирд╛рдУрдВ рдореЗрдВ рдЙрднрд░ рд╕рдХрддрд╛ рд╣реИ** (рдпрд╛ рдпрд╣рд╛рдБ рддрдХ рдХрд┐ рдПрдХ рдЕрд▓рдЧ рд╕рдВрдЧрдарди рд╕реЗ рднреА)ред
{% endhint %}

рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдпрд╣ рдЬрд╛рдВрдЪреЗрдВ:

{% content-ref url="gcp-understanding-domain-wide-delegation.md" %}
[gcp-understanding-domain-wide-delegation.md](gcp-understanding-domain-wide-delegation.md)
{% endcontent-ref %}

### рдореМрдЬреВрджрд╛ рдбреЗрд▓реАрдЧреЗрд╢рди рдХреЛ рдХрдордЬреЛрд░ рдХрд░реЗрдВ

рдпрджрд┐ рдХрд┐рд╕реА рд╣рдорд▓рд╛рд╡рд░ рдиреЗ **GCP рдкрд░ рдХреБрдЫ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛** рд╣реИ рдФрд░ рдХрд┐рд╕реА рдорд╛рдиреНрдп рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдИрдореЗрд▓ рдХреЛ рдЬрд╛рдирддрд╛ рд╣реИ (рдкреНрд░рд╛рдердорд┐рдХ рд░реВрдк рд╕реЗ **рд╕реБрдкрд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ**), рддреЛ рд╡рд╣ **рдЙрд╕реЗ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд╕рднреА рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ** рдХрд░ рд╕рдХрддрд╛ рд╣реИ, **рд╕рднреА SAs рдХреА рдЬрд╛рдВрдЪ** рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рджреЗрдЦ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ **рдХрд┐рд╕ рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рд╣реИ**, рдФрд░ **рдкреНрд░рддреНрдпреЗрдХ SA рдХреЗ рд╕рд╛рде** рдЗрди рд╕рднреА рдХрджрдореЛрдВ рдХреЛ **рджреЛрд╣рд░рд╛рдПрдВ**ред\
рдЙрд╕рдХреЗ рдкрд╛рд╕ **рдЙрд╕ рд╕рднреА рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ** рдХреА **рд╕реВрдЪреА** рд╣реЛрдЧреА рдЬрд┐рд╕рдХреЗ рдЙрд╕реЗ **рдкрд╣реБрдВрдЪ** рд╣реИ рдФрд░ **рд╡рд░реНрдХрд╕реНрдкреЗрд╕** **рдИрдореЗрд▓** рдХреА рд╕реВрдЪреА, рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдкреНрд░рддреНрдпреЗрдХ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдХреЗ рд╕рд╛рде **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдЕрдиреБрдХрд░рдг** рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЬрдм рдбреЛрдореЗрди рд╡рд╛рдЗрдб рдбреЗрд▓реАрдЧреЗрд╢рди рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдХреЛрдИ рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдПрдХ рдорд╛рдиреНрдп рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЬрд╛рдирдирд╛ рдХреЗрд╡рд▓ **рдПрдХ рд╣реА рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ рдФрд░ рдЕрдиреБрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ**ред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдиреБрдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдпрд╣ рд╕реБрдкрд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╣реИ рддреЛ рдЖрдкрдХреЛ рд╕рдм рдХреБрдЫ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрдЧреАред рдпрджрд┐ рдЗрд╕рдХреЗ рдкрд╛рд╕ рдХреЛрдИ рдкрд╣реБрдВрдЪ рдирд╣реАрдВ рд╣реИ рддреЛ рдпрд╣ рдмреЗрдХрд╛рд░ рд╣реЛрдЧрд╛ред
{% endhint %}

#### [GCP рдбреЗрд▓реАрдЧреЗрд╢рди рдЯреЛрдХрди рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВ](https://github.com/carlospolop/gcp\_gen\_delegation\_token)

рдпрд╣ рд╕рд░рд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ OAuth рдЯреЛрдХрди рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛** рдЬрд┐рд╕рдХрд╛ рдЖрдк рдлрд┐рд░ рдЕрдиреНрдп Google API рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `gcloud` рдХреЗ рд╕рд╛рде рдпрд╛ рдмрд┐рдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
# Impersonate indicated user
python3 gen_delegation_token.py --user-email <user-email> --key-file <path-to-key-file>

# Impersonate indicated user and add additional scopes
python3 gen_delegation_token.py --user-email <user-email> --key-file <path-to-key-file> --scopes "https://www.googleapis.com/auth/userinfo.email, https://www.googleapis.com/auth/cloud-platform, https://www.googleapis.com/auth/admin.directory.group, https://www.googleapis.com/auth/admin.directory.user, https://www.googleapis.com/auth/admin.directory.domain, https://mail.google.com/, https://www.googleapis.com/auth/drive, openid"
```
#### [**DeleFriend**](https://github.com/axon-git/DeleFriend)

рдпрд╣ рдПрдХ рдЯреВрд▓ рд╣реИ рдЬреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЪрд░рдгреЛрдВ рдХрд╛ рдЕрдЯреИрдХ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:

1. **рд╕рдВрд╕рд╛рдзрди рдкреНрд░рдмрдВрдзрдХ API рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ GCP рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ** рдХрд░реЗрдВред
2. рдкреНрд░рддреНрдпреЗрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╕рдВрд╕рд╛рдзрди рдкрд░ рдЪрд▓рдирд╛, рдФрд░ **рдкреНрд░рд╛рд░рдВрднрд┐рдХ IAM рдЙрдкрдпреЛрдХреНрддрд╛ рдХреЗ рдкрд╣реБрдВрдЪ рдХреЗ рд╕рд╛рде GCP рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреА рдЬрд╛рдВрдЪ** рдХрд░реЗрдВ _GetIAMPolicy_ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред
3. **рдкреНрд░рддреНрдпреЗрдХ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рднреВрдорд┐рдХрд╛** рдкрд░ рдЪрд▓рдирд╛, рдФрд░ _**serviceAccountKeys.create**_ рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде рд▓рдХреНрд╖реНрдп рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рд╕рдВрд╕рд╛рдзрди рдкрд░ рдирд┐рд░реНрдорд┐рдд, рдореВрд▓, рдФрд░ рдХрд╕реНрдЯрдо рднреВрдорд┐рдХрд╛рдПрдВ рдЦреЛрдЬреЗрдВред рдЗрд╕реЗ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рд╕рдВрдкрд╛рджрдХ рднреВрдорд┐рдХрд╛ рдореЗрдВ рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЛ рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ рд╣реЛрддрд╛ рд╣реИред
4. рдЙрд╕ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рд╕рдВрд╕рд╛рдзрди рдХреЗ рд▓рд┐рдП рдПрдХ **рдирдпрд╛ `KEY_ALG_RSA_2048`** рдирд┐рдЬреА рдХреБрдВрдЬреА рдмрдирд╛рдПрдВ рдЬрд┐рд╕реЗ IAM рдиреАрддрд┐ рдореЗрдВ рд╕рдВрдмрдВрдзрд┐рдд рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде рдкрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред
5. **рдкреНрд░рддреНрдпреЗрдХ рдирдП рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдкрд░ рдЪрд▓рдирд╛ рдФрд░ рдЙрд╕рдХреЗ рд▓рд┐рдП рдПрдХ `JWT`** **рдСрдмреНрдЬреЗрдХреНрдЯ** рдмрдирд╛рдПрдВ рдЬрд┐рд╕рдореЗрдВ SA рдирд┐рдЬреА рдХреБрдВрдЬреА рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдФрд░ рдПрдХ OAuth рд╕реНрдХреЛрдк рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рдПрдХ рдирдП _JWT_ рдСрдмреНрдЬреЗрдХреНрдЯ рдмрдирд╛рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ **oauth\_scopes.txt** рд╕реВрдЪреА рд╕реЗ рд╕рднреА рдореМрдЬреВрджрд╛ OAuth рд╕реНрдХреЛрдк рдХреЗ рд╕рднреА рд╕рдВрдпреЛрдЬрдиреЛрдВ рдкрд░ рдЪрд▓реЗрдЧреА, рддрд╛рдХрд┐ рд╕рднреА рдЕрдзрд┐рдХрд╛рд░ рд╡рд┐рдХрд▓реНрдк рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдПред рд╕реВрдЪреА **oauth\_scopes.txt** рдХреЛ рдЕрджреНрдпрддрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╣рдордиреЗ рдкрд╛рдпрд╛ рд╣реИ рдХрд┐ рдХрд╛рд░реНрдпрд╕реНрдерд▓ рдкрд╣рдЪрд╛рдиреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдВрдмрдВрдзрд┐рдд рд╕рднреА OAuth рд╕реНрдХреЛрдкред
6. `_make_authorization_grant_assertion` рд╡рд┐рдзрд┐ рдЬреЗрдбрдбрдмреНрд▓реНрдпреВрдбреА рдХреЗ рддрд╣рдд JWT рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд▓рдХреНрд╖реНрдп рдХрд╛рд░реНрдпрд╕реНрдерд▓ рдЙрдкрдпреЛрдХреНрддрд╛ рдХреА рдШреЛрд╖рдгрд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЛ рдкреНрд░рдХрдЯ рдХрд░рддреА рд╣реИ, рдЬрд┐рд╕реЗ _рд╡рд┐рд╖рдп_ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрджрд░реНрднрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдРрд╕рд╛ рджрд┐рдЦ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЙрдкрдпреЛрдХреНрддрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ **DWD рд╣рд░ рдбреЛрдореЗрди рдХреЗ рднреАрддрд░ рд╣рд░ рдкрд╣рдЪрд╛рди рдкрд░ рдкреНрд░рднрд╛рд╡ рдбрд╛рд▓рддрд╛ рд╣реИ**ред рдЗрд╕ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, **рдХрд┐рд╕реА рднреА рдбреЛрдореЗрди рдЙрдкрдпреЛрдХреНрддрд╛** рдХреЗ рд▓рд┐рдП рдПрдХ JWT рдмрдирд╛рдиреЗ рд╕реЗ рдЙрд╕ рдбреЛрдореЗрди рдореЗрдВ рд╕рднреА рдкрд╣рдЪрд╛рдиреЛрдВ рдкрд░ рдкреНрд░рднрд╛рд╡ рдкрдбрд╝рддрд╛ рд╣реИ, рд╣рдорд╛рд░реЗ рд╕рдВрдпреЛрдЬрди рд╕рдВрдЦреНрдпрд╛ рдХреА рдЬрд╛рдВрдЪ рдХреЗ рд╕рд╛рде рд╕рдВрдЧрддред рд╕реАрдзреЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рдПрдХ рдорд╛рдиреНрдп рдХрд╛рд░реНрдпрд╕реНрдерд▓ рдЙрдкрдпреЛрдХреНрддрд╛ рдЖрдЧреЗ рдмрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИред\
рдпрд╣ рдЙрдкрдпреЛрдХреНрддрд╛ DeleFriend рдХреЗ _config.yaml_ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ рд▓рдХреНрд╖реНрдп рдХрд╛рд░реНрдпрд╕реНрдерд▓ рдЙрдкрдпреЛрдХреНрддрд╛ рдкрд╣рд▓реЗ рд╕реЗ рдкрддрд╛ рдирд╣реАрдВ рд╣реИ, рддреЛ рдпрд╣ рдЙрдкрдХрд░рдг GCP рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдкрд░ рднреВрдорд┐рдХрд╛рдПрдВ рд╡рд╛рд▓реЗ рдбреЛрдореЗрди рдЙрдкрдпреЛрдХреНрддрд╛рдУрдВ рдХреА рд╕реНрдХреИрдирд┐рдВрдЧ рдХрд░рдХреЗ рдорд╛рдиреНрдп рдХрд╛рд░реНрдпрд╕реНрдерд▓ рдЙрдкрдпреЛрдХреНрддрд╛рдУрдВ рдХреА рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдкрд╣рдЪрд╛рди рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рддрд╛ рд╣реИред рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ (рдлрд┐рд░ рд╕реЗ) рдХрд┐ JWT рдбреЛрдореЗрди-рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рд╣рд░ рдЙрдкрдпреЛрдХреНрддрд╛ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рдЙрддреНрдкрдиреНрди рд╣реЛрддреЗ; рдЗрд╕рд▓рд┐рдП, рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдПрдХ рд╣реА рдЕрджреНрд╡рд┐рддреАрдп рдкрд╣рдЪрд╛рди рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рд╣реИред
7. **рдкреНрд░рддреНрдпреЗрдХ JWT рдХреЗ рд▓рд┐рдП рдПрдХ рдирдпрд╛ рдмрд┐рдпрд░ рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдХреА рдЬрд╛рдВрдЪ рдФрд░ рдирд┐рд░реНрдорд╛рдг** рдХрд░реЗрдВ рдФрд░ рдЯреЛрдХрдирд┐рдиреНрдлреЛ API рдХреЗ рдЦрд┐рд▓рд╛рдл рдЯреЛрдХрди рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдВред

#### [Gitlab рдХрд╛ Python рд╕реНрдХреНрд░рд┐рдкреНрдЯ](https://gitlab.com/gitlab-com/gl-security/threatmanagement/redteam/redteam-public/gcp\_misc/-/blob/master/gcp\_delegation.py)

Gitlab рдиреЗ [рдпрд╣ Python рд╕реНрдХреНрд░рд┐рдкреНрдЯ](https://gitlab.com/gitlab-com/gl-security/gl-redteam/gcp\_misc/blob/master/gcp\_delegation.py) рдмрдирд╛рдпрд╛ рд╣реИ рдЬреЛ рджреЛ рдЪреАрдЬреЗрдВ рдХрд░ рд╕рдХрддрд╛ рд╣реИ - рдЙрдкрдпреЛрдХреНрддрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреА рд╕реВрдЪреА рдмрдирд╛рдирд╛ рдФрд░ рдПрдХ рдирдпрд╛ рдкреНрд░рд╢рд╛рд╕рдирд┐рдХ рдЦрд╛рддрд╛ рдмрдирд╛рдирд╛ рдЬрдмрдХрд┐ рдПрдХ рдЬреЗрд╕рди рдХреЛ рд╕рдВрдХреЗрдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ SA рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдФрд░ рдЙрдкрдиреНрдпрд╛рд╕ рдХреЛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдХреНрддрд╛ рд╣реИред рдпрд╣рд╛рдБ рдпрд╣рд╛рдБ рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВрдЧреЗ:
```bash
# Install requirements
pip install --upgrade --user oauth2client

# Validate access only
./gcp_delegation.py --keyfile ./credentials.json \
--impersonate steve.admin@target-org.com \
--domain target-org.com

# List the directory
./gcp_delegation.py --keyfile ./credentials.json \
--impersonate steve.admin@target-org.com \
--domain target-org.com \
--list

# Create a new admin account
./gcp_delegation.py --keyfile ./credentials.json \
--impersonate steve.admin@target-org.com \
--domain target-org.com \
--account pwned
```
### рдПрдХ рдирдпрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ (рд╕реНрдерд╛рдпрд┐рддреНрд╡) рдмрдирд╛рдПрдВ

**https://admin.google.com/u/1/ac/owl/domainwidedelegation** рдореЗрдВ **рдбреЛрдореЗрди рд╡реНрдпрд╛рдкрдХ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХреА рдЬрд╛рдБрдЪ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред**

рдПрдХ рд╣рдорд▓рд╛рд╡рддрд╛ рдЬрд┐рд╕рдХреЗ рдкрд╛рд╕ **GCP рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ рдХреЛ рдмрдирд╛рдиреЗ** рдФрд░ **GWS рдореЗрдВ рд╕реБрдкрд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реЛ** рдПрдХ рдирдпрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ SAs рдХреЛ рдХреБрдЫ GWS рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓ рд╕рдХрддреА рд╣реИ:

1. **рдирдпрд╛ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдФрд░ рд╕рдВрдмрдВрдзрд┐рдд рдХреБрдВрдЬреА рдЬреЛрдбрд╝рдирд╛:** GCP рдкрд░, рдирдП рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рд╕рдВрд╕рд╛рдзрди рдпрд╛ рд╕реАрдзреЗ API рдХреЙрд▓ рдФрд░ CLI рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд╛рд░реНрдпрдХреНрд░рдорд╛рддреНрдордХ рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рд▓рд┐рдП **рднреВрдорд┐рдХрд╛ `iam.serviceAccountAdmin`** рдпрд╛ рдХрд┐рд╕реА рднреА рдЕрдиреБрдХреВрд▓ рднреВрдорд┐рдХрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ **`iam.serviceAccounts.create`** **рдЕрдиреБрдорддрд┐** рд╢рд╛рдорд┐рд▓ рд╣реИред рдПрдХ рдмрд╛рд░ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд╣рдо **рд╕рдВрдмрдВрдзрд┐рдд рдХреБрдВрдЬреА рдЬреЛрдбрд╝реЗрдВрдЧреЗ** (**`iam.serviceAccountKeys.create`** рдЕрдиреБрдорддрд┐).
2. **рдирдпрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдмрдирд╛рдирд╛**: рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ **рдХреЗрд╡рд▓ рд╕реБрдкрд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рднреВрдорд┐рдХрд╛ рдХреЗ рдкрд╛рд╕ Google Workspace рдореЗрдВ рд╡реИрд╢реНрд╡рд┐рдХ рдбреЛрдореЗрди-рд╡реНрдпрд╛рдкрдХ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реИ** рдФрд░ рдбреЛрдореЗрди-рд╡реНрдпрд╛рдкрдХ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ **рдХрд╛рд░реНрдпрдХреНрд░рдорд╛рддреНрдордХ рд░реВрдк рд╕реЗ рд╕реЗрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ,** рдпрд╣ рдХреЗрд╡рд▓ Google Workspace **рдХрдВрд╕реЛрд▓** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдореИрдиреНрдпреБрдЕрд▓** рд░реВрдк рд╕реЗ рдмрдирд╛рдпрд╛ рдФрд░ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* рдирд┐рдпрдо рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдкреГрд╖реНрда **API controls тЖТ Google Workspace Admin рдХрдВрд╕реЛрд▓ рдореЗрдВ рдбреЛрдореЗрди-рд╡реНрдпрд╛рдкрдХ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░реЗрдВ** рдХреЗ рддрд╣рдд рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
3. **OAuth рджрд╛рдпрд░реЗ рдЕрдзрд┐рдХрд╛рд░ рдЬреЛрдбрд╝рдирд╛**: рдПрдХ рдирдП рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХреЛ рд╡рд┐рдиреНрдпрд╛рд╕рд┐рдд рдХрд░рддреЗ рд╕рдордп, Google рдХреЛ рдХреЗрд╡рд▓ 2 рдкреИрд░рд╛рдореАрдЯрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, Client ID, рдЬреЛ **GCP рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛** рд╕рдВрд╕рд╛рдзрди рдХрд╛ **OAuth ID** рд╣реИ, рдФрд░ **OAuth рджрд╛рдпрд░реЗ** рдЬреЛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХреЛ рдЖрд╡рд╢реНрдпрдХ API рдХреЙрд▓ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВред
* **OAuth рджрд╛рдпрд░реЗ рдХреА рдкреВрд░реА рд╕реВрдЪреА** [**рдпрд╣рд╛рдБ**](https://developers.google.com/identity/protocols/oauth2/scopes) рдкрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣рд╛рдБ рдПрдХ рд╕рд┐рдлрд╛рд░рд┐рд╢ рд╣реИ: `https://www.googleapis.com/auth/userinfo.email, https://www.googleapis.com/auth/cloud-platform, https://www.googleapis.com/auth/admin.directory.group, https://www.googleapis.com/auth/admin.directory.user, https://www.googleapis.com/auth/admin.directory.domain, https://mail.google.com/, https://www.googleapis.com/auth/drive, openid`
4. **рд▓рдХреНрд╖реНрдп рдкрд╣рдЪрд╛рди рдХреЗ рдкрдХреНрд╖ рдореЗрдВ рдХрд╛рд░реНрд░рд╡рд╛рдИ:** рдЗрд╕ рд╕рдордп, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ GWS рдореЗрдВ рдПрдХ рдХрд╛рд░реНрдпрдХреНрд╖рдо рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдЙрдкрдХрд░рдг рд╣реИред рдЕрдм, **GCP рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдирд┐рдЬреА рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рдо API рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** (рдЬреЛ OAuth рджрд╛рдпрд░реЗ рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдП рдЧрдП рджрд╛рдпрд░реЗ рдореЗрдВ) рдФрд░ **Google Workspace рдореЗрдВ рдореМрдЬреВрдж рдХрд┐рд╕реА рднреА рдкрд╣рдЪрд╛рди рдХреЗ рдкрдХреНрд╖ рдореЗрдВ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рд╕реАрдЦрд╛, рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ REST API рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдкрд╣реБрдВрдЪ рдЯреЛрдХрди рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛ред
* рдЗрд╕ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ **рдЙрдкрдХрд░рдгреЛрдВ** рдХреЗ рд▓рд┐рдП **рдкрд┐рдЫрд▓реЗ рдЦрдВрдб** рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВред

#### рд╕рдВрдЧрдардирд╛рддреНрдордХ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡

OAuth SA ID рд╡реИрд╢реНрд╡рд┐рдХ рд╣реИ рдФрд░ **рд╕рдВрдЧрдардирд╛рддреНрдордХ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡** рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдХреЛрдИ рдкреНрд░рддрд┐рдмрдВрдз рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬреЛ рд╕рдВрдЧрдардирд╛рддреНрдордХ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдПред рд╕рд░рд▓ рд╢рдмреНрджреЛрдВ рдореЗрдВ, **рд╡рд┐рднрд┐рдиреНрди GCP рд╕рдВрдЧрдардиреЛрдВ рд╕реЗ рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдиреНрдп Workspace рд╕рдВрдЧрдардиреЛрдВ рдкрд░ рдбреЛрдореЗрди-рд╡реНрдпрд╛рдкрдХ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**ред рдЗрд╕рд╕реЗ **рдХреЗрд╡рд▓ Workspace рдХреЗ рд▓рд┐рдП рд╕реБрдкрд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЙрдкрдпреБрдХреНрдд рд╣реЛрдЧрд╛**, рдФрд░ рдЙрд╕реА GCP рдЦрд╛рддреЗ рддрдХ рдкрд╣реБрдВрдЪ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрдЧреА, рдХреНрдпреЛрдВрдХрд┐ рд╡рд┐рд░реЛрдзреА рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдФрд░ рдирд┐рдЬреА рдХреБрдВрдЬреА рдЕрдкрдиреЗ рдирд┐рдпрдВрддреНрд░рд┐рдд GCP рдЦрд╛рддреЗ рдкрд░ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред

### Workspace рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░рд┐рдпреЛрдЬрдирд╛ рдмрдирд╛рдирд╛

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рд░реВрдк рд╕реЗ **Workspace рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ** рдХреЛ **рдирдИ рдкрд░рд┐рдпреЛрдЬрдирд╛рдПрдВ рдмрдирд╛рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ, рдФрд░ рдЬрдм рдПрдХ рдирдИ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ рддреЛ **рдирд┐рд░реНрдорд╛рддрд╛ рдХреЛ рдЙрд╕ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдкрд░ рдорд╛рд▓рд┐рдХ рднреВрдорд┐рдХрд╛** рдорд┐рд▓рддреА рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдкрд░рд┐рдпреЛрдЬрдирд╛ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ**, **APIs рдХреЛ рд╕рдХреНрд╖рдо** рдХрд░ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЙрд╕рдХреА рдирдИ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ Workspace рдХреЛ рдЬрд╛рдВрдЪрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХреЗред

{% hint style="danger" %}
рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ Workspace рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрд╕реЗ рдкрд░реНрдпрд╛рдкреНрдд Workspace рдЕрдиреБрдорддрд┐рдпрд╛рдБ рднреА рдЪрд╛рд╣рд┐рдП рд╣реЛрддреА рд╣реИрдВ (рд╣рд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рдЬрд╛рдВрдЪрдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд░рдЦреЗрдЧрд╛ рдирд╣реАрдВ)ред
{% endhint %}

{% code overflow="wrap" %}
```bash
# Create project
gcloud projects create <uniq-projec-name> --name=proj-name
# Set project
gcloud config set project <uniq-projec-name>
# Enable svcs
gcloud services enable admin.googleapis.com
gcloud services enable cloudidentity.googleapis.com
# Get org ID
gcloud organizations list
# Get currents email user groups (at least you can check the groups and members of the groups you belong to)
gcloud identity groups memberships search-transitive-groups --member-email <email> --labels=cloudidentity.googleapis.com/groups.discussion_forum
gcloud identity groups memberships list --group-email=g<group-email>

# FROM HERE THE USER NEEDS TO HAVE ENOUGH WORKSPACE ACCESS
gcloud beta identity groups preview --customer <org-cust-id>
```
{% endcode %}

рдЬрд╛рдВрдЪреЗрдВ **рдФрд░ рдЬрд╛рдВрдЪ**:

{% content-ref url="../gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](../gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

### Gcloud рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

рдЖрдк рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `gcloud` рдлреНрд▓реЛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="../gcp-persistence/gcp-non-svc-persistance.md" %}
[gcp-non-svc-persistance.md](../gcp-persistence/gcp-non-svc-persistance.md)
{% endcontent-ref %}

рдЬреИрд╕рд╛ рдХрд┐ рд╡рд╣рд╛рдБ рд╕реНрдкрд╖реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, gcloud рд╕реНрдХреЛрдк `https://www.googleapis.com/auth/drive` рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдбреНрд░рд╛рдЗрд╡ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓ рд╕рдХрддреА рд╣реИред\
рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд░реВрдк рдореЗрдВ, рдпрджрд┐ рдЖрдкрдиреЗ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдХрдВрдкреНрдпреВрдЯрд░ рдХреЛ **рднреМрддрд┐рдХ рд░реВрдк рд╕реЗ** рдХрдВрдкреНрд░рдорд╛рдЗрдЬрд╝ рдХрд┐рдпрд╛ рд╣реИ рдФрд░ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрднреА рднреА рдЕрдкрдиреЗ рдЦрд╛рддреЗ рдореЗрдВ рд▓реЙрдЧ рдЗрди рд╣реИрдВ** рддреЛ рдЖрдк рдПрдХ рдЯреЛрдХрди рдЙрддреНрдкрдиреНрди рдХрд░рдХреЗ рдбреНрд░рд╛рдЗрд╡ рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
gcloud auth login --enable-gdrive-access
```
рдпрджрд┐ рдХреЛрдИ рд╣рдорд▓рд╛рд╡рд░ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдХрдВрдкреНрдпреВрдЯрд░ рдХреЛ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝ рдХрд░рддрд╛ рд╣реИ рддреЛ рд╡рд╣ рдлрд╝рд╛рдЗрд▓ `google-cloud-sdk/lib/googlecloudsdk/core/config.py` рдореЗрдВ рдмрджрд▓рд╛рд╡ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ **`CLOUDSDK_SCOPES`** рдореЗрдВ рд╕реНрдХреЛрдк **`'https://www.googleapis.com/auth/drive'`** рдЬреЛрдбрд╝ рд╕рдХрддрд╛ рд╣реИ:

<figure><img src="../../../.gitbook/assets/image (342).png" alt="" width="563"><figcaption></figcaption></figure>

{% hint style="warning" %}
рдЗрд╕рд▓рд┐рдП, рдЬрдм рдЕрдЧрд▓реА рдмрд╛рд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЙрдЧ рдЗрди рдХрд░реЗрдЧрд╛ рддреЛ рд╡рд╣ **рдбреНрд░рд╛рдЗрд╡ рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд╕рд╛рде рдПрдХ рдЯреЛрдХрди рдмрдирд╛рдПрдЧрд╛** рдЬрд┐рд╕рдХрд╛ рд╣рдорд▓рд╛рд╡рд░ рдбреНрд░рд╛рдЗрд╡ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ, рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдЗрд╕рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрдЧрд╛ рдХрд┐ рдЙрддреНрдкрдиреНрди рдЯреЛрдХрди рдХрд╛ рдбреНрд░рд╛рдЗрд╡ рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдЬреИрд╕реЗ рд╣реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **`gcloud auth login`** рдХреЛ рдХреЙрд▓ рдХрд░реЗрдЧрд╛, рдЙрд╕реЗ рд╢рд╛рдпрдж **рдХреБрдЫ рд╕рдВрджреЗрд╣ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред**

рдбреНрд░рд╛рдЗрд╡ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рд╕реВрдЪреА рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП: **`curl -H "Authorization: Bearer $(gcloud auth print-access-token)" "https://www.googleapis.com/drive/v3/files"`**
{% endhint %}

## GWS рд╕реЗ GCP рддрдХ

### рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬреНрдб GCP рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪ

рдпрджрд┐ рдХрд┐рд╕реА рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдкрд╛рд╕ GWS рдкрд░ рдкреВрд░реНрдг рдкрд╣реБрдВрдЪ рд╣реИ рддреЛ рд╡рд╣ GCP рдкрд░ рдкрд╣реБрдВрдЪ рдХреЗ рд╕рд╛рде рдЧреНрд░реБрдк рдЬреЛ GCP рдкрд░ рдЙрдЪреНрдЪ рдкрд╣реБрдВрдЪ рд╡рд╛рд▓реЗ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП GWS рд╕реЗ GCP рдореЗрдВ рдЬрд╛рдирд╛ рдЖрдорддреМрд░ рдкрд░ рдЬреНрдпрд╛рджрд╛ "рд╕рд░рд▓" рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **GWS рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдкрд╛рд╕ GCP рдкрд░ рдЙрдЪреНрдЪ рдкрд╣реБрдВрдЪ рд╣реЛрддреА рд╣реИ**ред

### Google Groups рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬ рдЙрдиреНрдирддрд┐

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ рд╕рдВрдЧрдарди рдХреЗ Workspace рдЧреНрд░реБрдк рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдЙрди рдЧреНрд░реБрдкреЛрдВ **рдореЗрдВ GCP рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╣реЛ рд╕рдХрддреА рд╣реИрдВ (рдЕрдкрдиреЗ рдЧреНрд░реБрдкреНрд╕ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ [https://groups.google.com/](https://groups.google.com/))ред

**Google groups privesc** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк GCP рдореЗрдВ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреА рдЙрдЪреНрдЪ рдкрд╣реБрдВрдЪ рд╡рд╛рд▓реЗ рдЧреНрд░реБрдк рддрдХ рдЙрдиреНрдирддрд┐ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### рд╕рдВрджрд░реНрдн

* [https://www.hunters.security/en/blog/delefriend-a-newly-discovered-design-flaw-in-domain-wide-delegation-could-leave-google-workspace-vulnerable-for-takeover](https://www.hunters.security/en/blog/delefriend-a-newly-discovered-design-flaw-in-domain-wide-delegation-could-leave-google-workspace-vulnerable-for-takeover)

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рдЧреНрд░реБрдк**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдЧреНрд░реБрдк**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
{% endhint %}
