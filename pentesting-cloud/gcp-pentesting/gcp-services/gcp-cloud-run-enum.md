# GCP - Cloud Run Enum

{% hint style="success" %}
Nauƒçite i ve≈æbajte hakovanje AWS-a:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Obuka AWS Crveni Tim Ekspert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Nauƒçite i ve≈æbajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Obuka GCP Crveni Tim Ekspert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr≈æite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Cloud Run <a href="#pregled-konfiguracija-cloud-run" id="pregled-konfiguracija-cloud-run"></a>

Cloud Run je serverless upravljana platforma za raƒçunanje koja vam omoguƒáava da **pokreƒáete kontejnere** direktno na Google-ovoj skalabilnoj infrastrukturi.

Mo≈æete pokrenuti svoj kontejner ili ako koristite Go, Node.js, Python, Java, .NET Core ili Ruby, mo≈æete koristiti [opciju implementacije na osnovu izvornog koda](https://cloud.google.com/run/docs/deploying-source-code) koja **gradi kontejner za vas.**

Google je izgradio Cloud Run da **dobro funkcioni≈°e zajedno sa drugim uslugama na Google Cloud-u**, tako da mo≈æete izgraditi potpuno funkcionalne aplikacije.

### Usluge i poslovi <a href="#usluge-i-poslovi" id="usluge-i-poslovi"></a>

Na Cloud Run-u, va≈° kod mo≈æe ili da se izvr≈°ava kontinuirano kao _**usluga**_ ili kao _**posao**_. Obe usluge i poslovi se izvr≈°avaju u istom okru≈æenju i mogu koristiti iste integracije sa drugim uslugama na Google Cloud-u.

* **Cloud Run usluge.** Koriste se za izvr≈°avanje koda koji odgovara na web zahteve ili dogaƒëaje.
* **Cloud Run poslovi.** Koriste se za izvr≈°avanje koda koji obavlja posao i zavr≈°ava kada je posao zavr≈°en.

## Cloud Run Usluga

Google [Cloud Run](https://cloud.google.com/run) je jo≈° jedna serverless ponuda gde mo≈æete tra≈æiti env promenljive takoƒëe. Cloud Run kreira mali web server, koji se podrazumevano izvr≈°ava na portu 8080 unutar kontejnera, koji ƒçeka HTTP GET zahtev. Kada zahtev bude primljen, posao se izvr≈°ava i dnevnik posla se izlazuje putem HTTP odgovora.

### Relevantni detalji

* Podrazumevano, **pristup** web serveru je **javno dostupan**, ali mo≈æe biti **ograniƒçen na interni saobraƒáaj** (VPC...)\
Takoƒëe, **autentikacija** za kontaktiranje web servera mo≈æe biti **dozvoljena svima** ili **zahtevati autentikaciju putem IAM**.
* Podrazumevano, **enkripcija** koristi **Google upravljani kljuƒç**, ali se mo≈æe izabrati i **CMEK** (Customer Managed Encryption Key) iz **KMS**.
* Podrazumevano, **servisni nalog** koji se koristi je **podrazumevani nalog Compute Engine-a** koji ima **Editor** pristup projektu i ima **scope `cloud-platform`.**
* Moguƒáe je definisati **jasno-tekstualne env promenljive** za izvr≈°avanje, ƒçak i **montirati cloud tajne** ili **dodati cloud tajne u env promenljive.**
* Takoƒëe je moguƒáe **dodati konekcije sa Cloud SQL-om** i **montirati fajl sistem.**
* **URL-ovi** deploy-ovanih usluga su sliƒçni **`https://<ime-svc>-<nasumiƒçno>.a.run.app`**
* Run Usluga mo≈æe imati **vi≈°e od 1 verzije ili reviziju**, i **podeliti saobraƒáaj** meƒëu nekoliko revizija.

### Enumeracija
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Cloud Run Poslovi

Cloud Run poslovi su bolje re≈°enje za **kontejnere koji se izvr≈°avaju do kraja i ne obraƒëuju zahteve**. Poslovi nemaju moguƒánost da obraƒëuju zahteve ili slu≈°aju na portu. To znaƒçi da za razliku od Cloud Run servisa, poslovi ne bi trebalo da sadr≈æe veb server. Umesto toga, kontejneri poslova treba da se zaustave kada zavr≈°e. 

### Enumeracija
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## Eskalacija privilegija

Na sledeƒáoj stranici mo≈æete proveriti kako **zloupotrebiti dozvole cloud run-a za eskalaciju privilegija**:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

## Neautentifikovan pristup

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md" %}
[gcp-cloud-run-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md)
{% endcontent-ref %}

## Post eksploatacija

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md" %}
[gcp-cloud-run-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md)
{% endcontent-ref %}

## Upornost

{% content-ref url="../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md" %}
[gcp-cloud-run-persistence.md](../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md)
{% endcontent-ref %}

## Reference

* [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)

{% hint style="success" %}
Nauƒçite i ve≈æbajte hakovanje AWS-a:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Nauƒçite i ve≈æbajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr≈æite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
