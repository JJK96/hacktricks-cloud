# GCP - Cloud Run 枚举

{% hint style="success" %}
学习并练习 AWS 黑客技术：<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks 培训 AWS 红队专家 (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
学习并练习 GCP 黑客技术：<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks 培训 GCP 红队专家 (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持 HackTricks</summary>

* 查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**电报群组**](https://t.me/peass) 或 **关注**我们的 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* 通过向 [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享黑客技巧。

</details>
{% endhint %}

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Cloud Run 是一个无服务器托管计算平台，允许您直接在 Google 的可扩展基础设施上运行容器。

您可以运行您的容器，或者如果您使用 Go、Node.js、Python、Java、.NET Core 或 Ruby，您可以使用[基于源代码部署](https://cloud.google.com/run/docs/deploying-source-code)选项，该选项会为您**构建容器**。

Google 已经构建了 Cloud Run，以便与 Google Cloud 上的其他服务**良好配合**，因此您可以构建功能齐全的应用程序。

### 服务和作业 <a href="#services-and-jobs" id="services-and-jobs"></a>

在 Cloud Run 上，您的代码可以作为**服务**或**作业**连续运行。服务和作业都在相同的环境中运行，并且可以与 Google Cloud 上的其他服务进行相同的集成。

* **Cloud Run 服务。** 用于运行响应 web 请求或事件的代码。
* **Cloud Run 作业。** 用于运行执行工作（作业）并在工作完成时退出的代码。

## Cloud Run 服务

Google [Cloud Run](https://cloud.google.com/run) 是另一个无服务器提供，您可以在其中搜索环境变量。Cloud Run 创建一个小型 Web 服务器，默认情况下在容器内的端口 8080 上运行，等待 HTTP GET 请求。当收到请求时，会执行作业，并通过 HTTP 响应输出作业日志。

### 相关细节

* **默认情况下**，对 Web 服务器的**访问**是**公开**的，但也可以**限制为内部流量**（VPC...）\
此外，联系 Web 服务器的**身份验证**可以是**允许所有**或**需要通过 IAM 进行身份验证**。
* 默认情况下，**加密**使用**Google 管理的密钥**，但也可以选择来自 **KMS** 的 **CMEK**（客户管理的加密密钥）。
* 默认情况下，使用的**服务帐号**是具有对项目的**编辑器**访问权限并具有**`cloud-platform`**范围的**Compute Engine 默认帐号**。
* 可以为执行定义**明文环境变量**，甚至**挂载云秘密**或**将云秘密添加到环境变量**。
* 还可以**与 Cloud SQL 建立连接**和**挂载文件系统**。
* 部署的服务的**URL**类似于**`https://<svc-name>-<random>.a.run.app`**
* Run 服务可以有**多个版本或修订版**，并且可以在多个修订版之间**分配流量**。

### 枚举
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Cloud Run 作业

Cloud Run 作业更适合于**运行完毕且不提供请求服务的容器**。作业无法提供请求服务或监听端口。这意味着与 Cloud Run 服务不同，作业不应该捆绑网络服务器。相反，作业容器应在完成任务后退出。

### 枚举
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## 提权

在以下页面中，您可以查看如何**滥用云运行权限以提升特权**：

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

## 未经身份验证访问

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md" %}
[gcp-cloud-run-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md)
{% endcontent-ref %}

## 后渗透

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md" %}
[gcp-cloud-run-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md)
{% endcontent-ref %}

## 持久性

{% content-ref url="../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md" %}
[gcp-cloud-run-persistence.md](../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md)
{% endcontent-ref %}

## 参考

* [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)

{% hint style="success" %}
学习并练习AWS黑客技术：<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks培训AWS红队专家（ARTE）**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
学习并练习GCP黑客技术：<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks培训GCP红队专家（GRTE）**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持HackTricks</summary>

* 查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**电报群组**](https://t.me/peass) 或 **关注**我们的**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享黑客技巧。

</details>
{% endhint %}
