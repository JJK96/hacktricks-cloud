# GCP - Cloud Run Enum

{% hint style="success" %}
Apprenez et pratiquez le piratage AWS :<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Formation HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez le piratage GCP : <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Formation HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Cloud Run est une plateforme de calcul g√©r√©e sans serveur qui vous permet d'**ex√©cuter des conteneurs** directement sur l'infrastructure √©volutive de Google.

Vous pouvez ex√©cuter votre conteneur ou Si vous utilisez Go, Node.js, Python, Java, .NET Core ou Ruby, vous pouvez utiliser l'option de [d√©ploiement bas√© sur la source](https://cloud.google.com/run/docs/deploying-source-code) qui **construit le conteneur pour vous.**

Google a con√ßu Cloud Run pour **fonctionner en synergie avec d'autres services sur Google Cloud**, vous permettant de construire des applications compl√®tes.

### Services et t√¢ches <a href="#services-and-jobs" id="services-and-jobs"></a>

Sur Cloud Run, votre code peut s'ex√©cuter soit de mani√®re continue en tant que _**service**_, soit en tant que _**t√¢che**_. Les services et les t√¢ches s'ex√©cutent dans le m√™me environnement et peuvent utiliser les m√™mes int√©grations avec d'autres services sur Google Cloud.

* **Services Cloud Run.** Utilis√©s pour ex√©cuter du code qui r√©pond √† des requ√™tes web ou des √©v√©nements.
* **T√¢ches Cloud Run.** Utilis√©es pour ex√©cuter du code qui effectue un travail (une t√¢che) et se termine une fois le travail termin√©.

## Service Cloud Run

Google [Cloud Run](https://cloud.google.com/run) est une autre offre sans serveur o√π vous pouvez rechercher des variables d'environnement √©galement. Cloud Run cr√©e un petit serveur web, fonctionnant sur le port 8080 √† l'int√©rieur du conteneur par d√©faut, qui attend une requ√™te HTTP. Lorsque la requ√™te est re√ßue, une t√¢che est ex√©cut√©e et le journal de la t√¢che est renvoy√© via une r√©ponse HTTP.

### D√©tails pertinents

* Par **d√©faut**, l'**acc√®s** au serveur web est **public**, mais il peut √©galement √™tre **limit√© au trafic interne** (VPC...)\
De plus, l'**authentification** pour contacter le serveur web peut √™tre **ouverte √† tous** ou **exiger une authentification via IAM**.
* Par d√©faut, le **chiffrement** utilise une **cl√© g√©r√©e par Google**, mais une **cl√© CMEK** (Customer Managed Encryption Key) de **KMS** peut √©galement √™tre **choisie**.
* Par **d√©faut**, le compte de service utilis√© est celui par d√©faut de Compute Engine qui a un acc√®s **√âditeur** sur le projet et a la **port√©e `cloud-platform`.**
* Il est possible de d√©finir des **variables d'environnement en clair** pour l'ex√©cution, voire de **monter des secrets cloud** ou d'**ajouter des secrets cloud aux variables d'environnement.**
* Il est √©galement possible d'**√©tablir des connexions avec Cloud SQL** et de **monter un syst√®me de fichiers.**
* Les **URL** des services d√©ploy√©s sont similaires √† **`https://<nom-svc>-<al√©atoire>.a.run.app`**
* Un service Run peut avoir **plus d'une version ou r√©vision**, et **r√©partir le trafic** entre plusieurs r√©visions.

### √ânum√©ration
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Travaux Cloud Run

Les travaux Cloud Run sont mieux adapt√©s aux **conteneurs qui s'ex√©cutent jusqu'√† leur ach√®vement et ne traitent pas les requ√™tes**. Les travaux n'ont pas la capacit√© de traiter des requ√™tes ou d'√©couter sur un port. Cela signifie que contrairement aux services Cloud Run, les travaux ne doivent pas inclure de serveur web. Au lieu de cela, les conteneurs de travaux doivent se terminer une fois leur t√¢che accomplie.

### √ânum√©ration
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## √âl√©vation de privil√®ges

Sur la page suivante, vous pouvez v√©rifier comment **abuser des autorisations de Cloud Run pour √©lever les privil√®ges**:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

## Acc√®s non authentifi√©

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md" %}
[gcp-cloud-run-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md)
{% endcontent-ref %}

## Post-exploitation

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md" %}
[gcp-cloud-run-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md)
{% endcontent-ref %}

## Persistance

{% content-ref url="../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md" %}
[gcp-cloud-run-persistence.md](../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md)
{% endcontent-ref %}

## R√©f√©rences

* [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)

{% hint style="success" %}
Apprenez et pratiquez le piratage AWS :<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Formation HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez le piratage GCP : <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Formation HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
{% endhint %}
