# GCP - Cloud Run Enum

{% hint style="success" %}
Ucz się i praktykuj Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Ucz się i praktykuj Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* Sprawdź [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel się trikami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Cloud Run to zarządzana platforma obliczeniowa typu serverless, która pozwala **uruchamiać kontenery** bezpośrednio na skalowalnej infrastrukturze Google.

Możesz uruchamiać swój kontener lub jeśli korzystasz z Go, Node.js, Python, Java, .NET Core lub Ruby, możesz skorzystać z opcji [wdrożenia opartego na źródle](https://cloud.google.com/run/docs/deploying-source-code), która **buduje kontener za Ciebie.**

Google stworzył Cloud Run tak, aby **dobrze współpracował z innymi usługami w Google Cloud**, dzięki czemu możesz budować pełnowymiarowe aplikacje.

### Usługi i zadania <a href="#services-and-jobs" id="services-and-jobs"></a>

Na Cloud Run, Twój kod może działać albo ciągle jako _**usługa**_, albo jako _**zadanie**_. Zarówno usługi, jak i zadania działają w tym samym środowisku i mogą korzystać z tych samych integracji z innymi usługami w Google Cloud.

* **Usługi Cloud Run.** Służą do uruchamiania kodu reagującego na żądania sieciowe lub zdarzenia.
* **Zadania Cloud Run.** Służą do uruchamiania kodu wykonującego pracę (zadanie) i kończą się po zakończeniu pracy.

## Usługa Cloud Run

Google [Cloud Run](https://cloud.google.com/run) to kolejna oferowana usługa typu serverless, w której można szukać zmiennych środowiskowych. Cloud Run tworzy mały serwer WWW, domyślnie działający na porcie 8080 wewnątrz kontenera, który czeka na żądanie HTTP GET. Gdy żądanie zostanie odebrane, uruchamiane jest zadanie, a dziennik zadania jest wyprowadzany poprzez odpowiedź HTTP.

### Istotne szczegóły

* Domyślnie **dostęp** do serwera WWW jest **publiczny**, ale można go również **ograniczyć do ruchu wewnętrznego** (VPC...)\
Ponadto **uwierzytelnienie** w celu skontaktowania się z serwerem WWW może być **zezwala na wszystkich** lub **wymagać uwierzytelnienia za pomocą IAM**.
* Domyślnie **szyfrowanie** korzysta z **zarządzanego przez Google klucza**, ale można również wybrać **CMEK** (Customer Managed Encryption Key) z **KMS**.
* Domyślnie używane jest **konto usługi** Compute Engine domyślne, które ma dostęp **Edytora** do projektu i ma zakres `cloud-platform`.
* Można zdefiniować **zmienne środowiskowe w postaci tekstu jawnego** dla wykonania, a nawet **zamontować tajne klucze chmury** lub **dodać tajne klucze chmury do zmiennych środowiskowych.**
* Możliwe jest również **dodanie połączeń z Cloud SQL** i **zamontowanie systemu plików.**
* **Adresy URL** wdrożonych usług są podobne do **`https://<nazwa-usługi>-<losowy>.a.run.app`**
* Usługa Run może mieć **więcej niż 1 wersję lub rewizję**, i **rozdzielać ruch** między kilkoma rewizjami.

### Wyliczenie
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Zadania Cloud Run

Zadania Cloud Run są lepszym rozwiązaniem dla **kontenerów, które działają do zakończenia i nie obsługują żądań**. Zadania nie mają możliwości obsługi żądań ani nasłuchiwania na porcie. Oznacza to, że w przeciwieństwie do usług Cloud Run, zadania nie powinny zawierać serwera sieciowego. Zamiast tego kontenery z zadaniami powinny zakończyć działanie po zakończeniu pracy.

### Wyliczanie
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## Eskalacja uprawnień

Na następnej stronie możesz sprawdzić, jak **nadużyć uprawnienia chmury Run do eskalacji uprawnień**:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

## Nieuwierzytelniony dostęp

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md" %}
[gcp-cloud-run-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md)
{% endcontent-ref %}

## Po wykorzystaniu

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md" %}
[gcp-cloud-run-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md)
{% endcontent-ref %}

## Trwałość

{% content-ref url="../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md" %}
[gcp-cloud-run-persistence.md](../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md)
{% endcontent-ref %}

## Odnośniki

* [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)
