# GCP - Compute Enum

{% hint style="success" %}
AWS Hacking'ı öğrenin ve uygulayın: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitimi AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitimi GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking püf noktalarını paylaşarak PR göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
{% endhint %}

## GCP VPC & Networking

Bunun nasıl çalıştığını öğrenin:

{% content-ref url="gcp-vpc-and-networking.md" %}
[gcp-vpc-and-networking.md](gcp-vpc-and-networking.md)
{% endcontent-ref %}

### Enumeration

{% code overflow="wrap" %}
```bash
# List networks
gcloud compute networks list
gcloud compute networks describe <network>

# List subnetworks
gcloud compute networks subnets list
gcloud compute networks subnets get-iam-policy <name> --region <region>
gcloud compute networks subnets describe <name> --region <region>

# List FW rules in networks
gcloud compute firewall-rules list --format="table(
name,
network,
direction,
priority,
sourceRanges.list():label=SRC_RANGES,
destinationRanges.list():label=DEST_RANGES,
allowed[].map().firewall_rule().list():label=ALLOW,
denied[].map().firewall_rule().list():label=DENY,
sourceTags.list():label=SRC_TAGS,
sourceServiceAccounts.list():label=SRC_SVC_ACCT,
targetTags.list():label=TARGET_TAGS,
targetServiceAccounts.list():label=TARGET_SVC_ACCT,
disabled
)"

# List Hierarchical Firewalls
gcloud compute firewall-policies list  (--folder <value>| --organization <value>)
gcloud compute firewall-policies describe <fw_policy>
gcloud compute firewall-policies list-rules <fw_policy>

# Get Firewalls of each region
gcloud compute network-firewall-policies list
## Get final FWs applied in a region
gcloud compute network-firewall-policies get-effective-firewalls --network=<vpc_name> --region <region>
```
{% endcode %}

Açık güvenlik duvarı kurallarına sahip hesaplama örneklerini kolayca bulabilirsiniz [https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_firewall\_enum](https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_firewall\_enum)

## Hesaplama Örnekleri

Bu, **GCP içinde sanal makineleri çalıştırabileceğiniz yol.** Daha fazla bilgi için bu sayfayı kontrol edin:

{% content-ref url="gcp-compute-instance.md" %}
[gcp-compute-instance.md](gcp-compute-instance.md)
{% endcontent-ref %}

### Numaralandırma
```bash
# Get list of zones
# It's interesting to know which zones are being used
gcloud compute regions list | grep -E "NAME|[^0]/"

# List compute instances & get info
gcloud compute instances list
gcloud compute instances describe <instance name>
gcloud compute instances get-iam-policy <instance> --zone=ZONE
gcloud compute instances get-screenshot <instance name> # Instace must have "Display Device" enabled
gcloud compute instances os-inventory list-instances # Get OS info of instances (OS Config agent is running on instances)


# Enumerate disks
gcloud compute disks list
gcloud compute disks describe <disk>
gcloud compute disks get-iam-policy <disk>
```
Daha fazla bilgi için bir örneğin **SSH** veya **metadata'yı değiştirme** sayfasını **privileges yükseltmek** için kontrol edin:

{% content-ref url="../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md" %}
[gcp-local-privilege-escalation-ssh-pivoting.md](../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md)
{% endcontent-ref %}

### Privilege Escalation

Aşağıdaki sayfada, **privileges yükseltmek için compute izinlerini kötüye nasıl kullanabileceğinizi** kontrol edebilirsiniz:

{% content-ref url="../../gcp-privilege-escalation/gcp-compute-privesc/" %}
[gcp-compute-privesc](../../gcp-privilege-escalation/gcp-compute-privesc/)
{% endcontent-ref %}

### Kimlik Doğrulamasız Enum

{% content-ref url="../../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-compute-unauthenticated-enum.md" %}
[gcp-compute-unauthenticated-enum.md](../../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-compute-unauthenticated-enum.md)
{% endcontent-ref %}

### Saldırı Sonrası İşlemler

{% content-ref url="../../../gcp-security/gcp-post-exploitation/gcp-compute-post-exploitation.md" %}
[gcp-compute-post-exploitation.md](../../../gcp-security/gcp-post-exploitation/gcp-compute-post-exploitation.md)
{% endcontent-ref %}

### Kalıcılık

{% content-ref url="../../../gcp-security/gcp-persistence/gcp-compute-persistence.md" %}
[gcp-compute-persistence.md](../../../gcp-security/gcp-persistence/gcp-compute-persistence.md)
{% endcontent-ref %}

## Seri Konsol Günlükleri

Compute Engine Seri Konsol Günlükleri, sanal makine örneklerinizin **önyükleme ve işletim sistemi günlüklerini görüntülemenize ve teşhis etmenize** olanak tanıyan bir özelliktir.

Seri Konsol Günlükleri, önyükleme sürecinin **düşük seviyeli bir görünümünü sağlar**, kernel mesajları, init betikleri ve önyükleme sırasında meydana gelen diğer sistem olayları gibi. Bu, önyükleme sorunlarını hata ayıklamak, yanlış yapılandırmaları veya yazılım hatalarını tanımlamak veya ağ bağlantısı sorunlarını gidermek için faydalı olabilir.

Bu günlükler, genellikle düşük ayrıcalıklı kullanıcıların görmemesi gereken sistem günlüklerinden **duyarlı bilgileri ortaya çıkarabilir**, ancak uygun IAM izinleriyle bunları okuyabilirsiniz.

Seri port günlüklerini sorgulamak için aşağıdaki [gcloud komutunu](https://cloud.google.com/sdk/gcloud/reference/compute/instances/get-serial-port-output) kullanabilirsiniz (gereken izin `compute.instances.getSerialPortOutput`):
```bash
gcloud compute instances get-serial-port-output <instance-name>
```
## İşletim Sistemi Yapılandırma Yöneticisi

İşletim sistemi yapılandırma yönetimi hizmetini kullanarak sanal makine örneğinizin (VM) **istenen durum ve yazılım için tutarlı yapılandırmaları dağıtabilir, sorgulayabilir ve koruyabilirsiniz**. Compute Engine'de, bir VM üzerinde tutarlı yazılım yapılandırmalarını korumak için [konuk politikalarını](https://cloud.google.com/compute/docs/os-config-management#guest-policy) kullanmalısınız.

İşletim Sistemi Yapılandırma yönetimi özelliği, hangi yazılım paketlerinin yüklü olması gerektiğini, hangi hizmetlerin etkinleştirilmesi gerektiğini ve hangi dosyaların veya yapılandırmaların VM'lerinizde bulunması gerektiğini belirten yapılandırma politikalarını tanımlamanıza olanak tanır. VM'lerinizin yazılım yapılandırmasını yönetmek için deklaratif bir yaklaşım kullanabilirsiniz, bu da yapılandırma yönetim sürecinizi daha kolay otomatikleştirmenize ve ölçeklendirmenize olanak tanır.

Bu ayrıca IAM izinleri aracılığıyla örneklerde oturum açmanıza olanak tanır, bu nedenle **hak yükseltme ve dönüş** için çok **yararlıdır**.

{% hint style="warning" %}
**Bir projenin veya bir örneğin içinde os-config'i etkinleştirmek** için sadece istenen düzeyde **`enable-oslogin`** anahtarını **`true`** olarak ayarlamanız yeterlidir.\
Ayrıca, 2fa'yı etkinleştirmek için **`enable-oslogin-2fa`** anahtarını **`true`** olarak ayarlayabilirsiniz.

Bir örneği oluştururken etkinleştirdiğinizde, metadata anahtarları otomatik olarak ayarlanacaktır.
{% endhint %}

**OS-config'de 2fa hakkında** daha fazla bilgi, **kullanıcı bir kullanıcıysa** yalnızca uygulanır, SA ise (örneğin, compute SA) ekstra bir şey gerektirmez.

### Numaralandırma
```bash
gcloud compute os-config patch-deployments list
gcloud compute os-config patch-deployments describe <patch-deployment>

gcloud compute os-config patch-jobs list
gcloud compute os-config patch-jobs describe <patch-job>
```
## Görüntüler

### Özel Görüntüler

**Özel hesaplama görüntüleri hassas ayrıntılar** veya başka zayıf yapılandırmalar içerebilir ki bunları sömürebilirsiniz.

Bir görüntü oluşturulduğunda **3 tür şifreleme seçebilirsiniz**: **Google tarafından yönetilen anahtar** (varsayılan), bir **KMS'den anahtar**, veya müşteri tarafından verilen bir **ham anahtar**.

#### Numaralandırma

Bir projedeki standart olmayan görüntülerin listesini sorgulayabilirsiniz aşağıdaki komutla:

{% code overflow="wrap" %}
```bash
gcloud compute machine-images list
gcloud compute machine-images describe <name>
gcloud compute machine-images get-iam-policy <name>
```
{% endcode %}

Herhangi bir görüntüden sanal diskleri çeşitli formatlarda [**dışa aktarabilirsiniz**](https://cloud.google.com/sdk/gcloud/reference/compute/images/export). Aşağıdaki komut, `test-image` görüntüsünü qcow2 formatında dışa aktaracak ve dosyayı indirip daha fazla inceleme için yerel olarak bir sanal makine oluşturmanıza olanak tanıyacaktır:
```bash
gcloud compute images export --image test-image \
--export-format qcow2 --destination-uri [BUCKET]

# Execute container inside a docker
docker run --rm -ti gcr.io/<project-name>/secret:v1 sh
```
#### Yetki Yükseltme

Bilgisayar Örnekleri yetki yükseltme bölümünü kontrol edin.

### Özel Örnek Şablonları

Bir [**örnek şablonu**](https://cloud.google.com/compute/docs/instance-templates/), tutarlı yapılandırmaları dağıtmaya yardımcı olmak için örnek özellikler tanımlar. Bu, çalışan bir örneğin özel meta verileri gibi aynı türde hassas verileri içerebilir. Araştırmak için aşağıdaki komutları kullanabilirsiniz:
```bash
# List the available templates
gcloud compute instance-templates list

# Get the details of a specific template
gcloud compute instance-templates describe [TEMPLATE NAME]
```
## Anlık Görüntüler

**Anlık görüntüler disklerin yedek kopyalarıdır**. Unutmayın ki bu, bir diski klonlamakla aynı şey değildir (başka bir mevcut özellik).\
**Anlık görüntü**, alındığı disk ile **aynı şifrelemeyi kullanacaktır**.

### Numaralandırma
```bash
gcloud compute snapshots list
gcloud compute snapshots describe <snapshot>
gcloud compute snapshots get-iam-policy <snapshot>
```
### Yetki Yükseltme

Bilgi İşlem Örneklerinde Yetki Yükseltme bölümünü kontrol edin.

## Referanslar

* [https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching](https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching)

{% hint style="success" %}
AWS Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitimi AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitimi GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* Hacking püf noktalarını paylaşarak PR'ler göndererek [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
{% endhint %}
