# GCP - Berekening Enum

{% hint style="success" %}
Leer & oefen AWS Hack:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hack: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Controleer die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
{% endhint %}

## GCP VPC & Netwerke

Leer meer oor hoe dit werk in:

{% content-ref url="gcp-vpc-and-networking.md" %}
[gcp-vpc-and-networking.md](gcp-vpc-and-networking.md)
{% endcontent-ref %}

### Enumerasie

{% code overflow="wrap" %}
```bash
# List networks
gcloud compute networks list
gcloud compute networks describe <network>

# List subnetworks
gcloud compute networks subnets list
gcloud compute networks subnets get-iam-policy <name> --region <region>
gcloud compute networks subnets describe <name> --region <region>

# List FW rules in networks
gcloud compute firewall-rules list --format="table(
name,
network,
direction,
priority,
sourceRanges.list():label=SRC_RANGES,
destinationRanges.list():label=DEST_RANGES,
allowed[].map().firewall_rule().list():label=ALLOW,
denied[].map().firewall_rule().list():label=DENY,
sourceTags.list():label=SRC_TAGS,
sourceServiceAccounts.list():label=SRC_SVC_ACCT,
targetTags.list():label=TARGET_TAGS,
targetServiceAccounts.list():label=TARGET_SVC_ACCT,
disabled
)"

# List Hierarchical Firewalls
gcloud compute firewall-policies list  (--folder <value>| --organization <value>)
gcloud compute firewall-policies describe <fw_policy>
gcloud compute firewall-policies list-rules <fw_policy>

# Get Firewalls of each region
gcloud compute network-firewall-policies list
## Get final FWs applied in a region
gcloud compute network-firewall-policies get-effective-firewalls --network=<vpc_name> --region <region>
```
{% endcode %}

Jy vind maklik rekenaarinstansies met oop firewall-re√´ls met [https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_firewall\_enum](https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_firewall\_enum)

## Rekenaarinstansies

Dit is die manier waarop jy **virtuele masjiene binne GCP kan hardloop.** Kyk na hierdie bladsy vir meer inligting:

{% content-ref url="gcp-compute-instance.md" %}
[gcp-compute-instance.md](gcp-compute-instance.md)
{% endcontent-ref %}

### Enumerasie
```bash
# Get list of zones
# It's interesting to know which zones are being used
gcloud compute regions list | grep -E "NAME|[^0]/"

# List compute instances & get info
gcloud compute instances list
gcloud compute instances describe <instance name>
gcloud compute instances get-iam-policy <instance> --zone=ZONE
gcloud compute instances get-screenshot <instance name> # Instace must have "Display Device" enabled
gcloud compute instances os-inventory list-instances # Get OS info of instances (OS Config agent is running on instances)


# Enumerate disks
gcloud compute disks list
gcloud compute disks describe <disk>
gcloud compute disks get-iam-policy <disk>
```
Vir meer inligting oor hoe om **SSH** te gebruik of die **metadata van 'n instansie te wysig** om **voorregte te verhoog,** kyk na hierdie bladsy:

{% content-ref url="../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md" %}
[gcp-local-privilege-escalation-ssh-pivoting.md](../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md)
{% endcontent-ref %}

### Voorregverhoging

Op die volgende bladsy kan jy sien hoe om **berekeningsregte te misbruik om voorregte te verhoog**:

{% content-ref url="../../gcp-privilege-escalation/gcp-compute-privesc/" %}
[gcp-compute-privesc](../../gcp-privilege-escalation/gcp-compute-privesc/)
{% endcontent-ref %}

### Ongeverifieerde Enum

{% content-ref url="../../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-compute-unauthenticated-enum.md" %}
[gcp-compute-unauthenticated-enum.md](../../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-compute-unauthenticated-enum.md)
{% endcontent-ref %}

### Na-uitbuiting

{% content-ref url="../../../gcp-security/gcp-post-exploitation/gcp-compute-post-exploitation.md" %}
[gcp-compute-post-exploitation.md](../../../gcp-security/gcp-post-exploitation/gcp-compute-post-exploitation.md)
{% endcontent-ref %}

### Volharding

{% content-ref url="../../../gcp-security/gcp-persistence/gcp-compute-persistence.md" %}
[gcp-compute-persistence.md](../../../gcp-security/gcp-persistence/gcp-compute-persistence.md)
{% endcontent-ref %}

## Seri√´le Konsole Logboeke

Rekenaarmasjien Seri√´le Konsole Logboeke is 'n kenmerk wat jou in staat stel om die opstart- en bedryfstelsellogboeke van jou virtuele masjieninstansies te **sien en te diagnoseer**.

Seri√´le Konsole Logboeke bied 'n **laevlak-weergawe van die instansie se opstartproses**, insluitend kernelboodskappe, inis-skripte, en ander stelselgebeure wat tydens opstart plaasvind. Dit kan nuttig wees vir die foutopsporing van opstartprobleme, die identifisering van verkeerde konfigurasies of sagtewarefoute, of die probleemoplossing van netwerkverbindingsprobleme.

Hierdie logboeke **kan sensitiewe inligting blootstel** van die stelsellogboeke wat 'n lae-voorreggebruiker normaalweg nie sou sien nie, maar met die toepaslike IAM-toestemmings mag jy dit dalk kan lees.

Jy kan die volgende [gcloud-opdrag](https://cloud.google.com/sdk/gcloud/reference/compute/instances/get-serial-port-output) gebruik om die seri√´le poortlogboeke te ondervra (die vereiste toestemming is `compute.instances.getSerialPortOutput`):
```bash
gcloud compute instances get-serial-port-output <instance-name>
```
## Bedryfstelselkonfigurasie-bestuurder

Jy kan die bedryfstelselkonfigurasiebestuurdienste gebruik om **konsekwente konfigurasies te implementeer, navraag te doen en te handhaaf** (gewenste toestand en sagteware) vir jou VM-instantie (VM). Op Rekenaar-ingenieurswese moet jy [gasbeleide](https://cloud.google.com/compute/docs/os-config-management#guest-policy) gebruik om konsekwente sagtewarekonfigurasies op 'n VM te handhaaf.

Die bedryfstelselkonfigurasiebestuurskenmerk stel jou in staat om konfigurasierigspolisse te definieer wat spesifiseer watter sagtewarepakette ge√Ønstalleer moet word, watter dienste geaktiveer moet word, en watter l√™ers of konfigurasies teenwoordig moet wees op jou VM's. Jy kan 'n deklaratiewe benadering gebruik om die sagtewarekonfigurasie van jou VM's te bestuur, wat jou in staat stel om jou konfigurasiebestuursproses makliker te outomatiseer en te skaal.

Dit maak dit ook moontlik om in te teken op instansies via IAM-toestemmings, dus dit is baie **nuttig vir privesc en pivoting**.

{% hint style="warning" %}
Om **os-config in 'n hele projek of in 'n instansie te aktiveer**, hoef jy net die **metadata** sleutel **`enable-oslogin`** na **`true`** op die gewenste vlak in te stel.\
Verder kan jy die metadata **`enable-oslogin-2fa`** na **`true`** instel om die 2fa te aktiveer.

Wanneer jy dit aktiveer tydens die skep van 'n instansie, sal die metadata sleutels outomaties ingestel word.
{% endhint %}

Meer oor **2fa in OS-config**, **dit geld net as die gebruiker 'n gebruiker is**, as dit 'n SA is (soos die rekenaar-SA) sal dit niks ekstra benodig nie.

### Enumerasie
```bash
gcloud compute os-config patch-deployments list
gcloud compute os-config patch-deployments describe <patch-deployment>

gcloud compute os-config patch-jobs list
gcloud compute os-config patch-jobs describe <patch-job>
```
## Afbeeldings

### Aangepaste Afbeeldings

**Aangepaste rekenaarafbeeldings kan sensitiewe besonderhede** of ander kwesbare konfigurasies bevat wat jy kan uitbuit.

Wanneer 'n afbeelding geskep word, kan jy kies **3 tipes van enkripsie**: Gebruik **Google bestuurde sleutel** (verstek), 'n **sleutel van KMS**, of 'n **rou sleutel** wat deur die klient gegee word.

#### Enumerasie

Jy kan die lys van nie-standaard afbeeldings in 'n projek navraag met die volgende bevel:

{% code overflow="wrap" %}
```bash
gcloud compute machine-images list
gcloud compute machine-images describe <name>
gcloud compute machine-images get-iam-policy <name>
```
{% endcode %}

Jy kan dan [**uitvoer**](https://cloud.google.com/sdk/gcloud/reference/compute/images/export) **die virtuele skywe** vanaf enige beeld in verskeie formate. Die volgende bevel sou die beeld `toets-beeld` uitvoer in qcow2-formaat, wat jou in staat stel om die l√™er af te laai en 'n VM plaaslik te bou vir verdere ondersoek:
```bash
gcloud compute images export --image test-image \
--export-format qcow2 --destination-uri [BUCKET]

# Execute container inside a docker
docker run --rm -ti gcr.io/<project-name>/secret:v1 sh
```
#### Voorregverhoging

Kyk na die Voorregverhoging-afdeling vir Rekenaarinstansies.

### Aangepaste Instansiesjablone

'n [**Instansiesjabloon**](https://cloud.google.com/compute/docs/instance-templates/) **definieer instansie-eienskappe** om te help met die implementering van konsekwente konfigurasies. Hierdie kan dieselfde tipes sensitiewe data bevat as 'n lopende instansie se aangepaste metadata. Jy kan die volgende opdragte gebruik om te ondersoek:
```bash
# List the available templates
gcloud compute instance-templates list

# Get the details of a specific template
gcloud compute instance-templates describe [TEMPLATE NAME]
```
Dit sou interessant wees om te weet watter skyf nuwe afbeeldings gebruik, maar hierdie templaat sal gewoonlik nie sensitiewe inligting h√™ nie.

## Snapskote

Die **snapskote is rugsteune van skywe**. Let daarop dat dit nie dieselfde is as om 'n skyf te kloon (nog 'n beskikbare kenmerk nie).\
Die **snapskoot** sal dieselfde **enkripsie as die skyf** wat dit geneem is, gebruik.

### Enumerasie
```bash
gcloud compute snapshots list
gcloud compute snapshots describe <snapshot>
gcloud compute snapshots get-iam-policy <snapshot>
```
### Voorregskaping

Kyk na die Voorregskaping afdeling vir Rekenaarinstansies.

## Verwysings

* [https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching](https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching)

{% hint style="success" %}
Leer & oefen AWS Hack: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Rooi Span Kenner (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hack: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Rooi Span Kenner (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacktruuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
