# GCP - Απαρίθμηση Υπολογιστών

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** στην 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο GitHub.

</details>
{% endhint %}

## GCP VPC & Δικτύωση

Μάθετε πώς λειτουργεί αυτό στο:

{% content-ref url="gcp-vpc-and-networking.md" %}
[gcp-vpc-and-networking.md](gcp-vpc-and-networking.md)
{% endcontent-ref %}

### Απαρίθμηση

{% code overflow="wrap" %}
```bash
# List networks
gcloud compute networks list
gcloud compute networks describe <network>

# List subnetworks
gcloud compute networks subnets list
gcloud compute networks subnets get-iam-policy <name> --region <region>
gcloud compute networks subnets describe <name> --region <region>

# List FW rules in networks
gcloud compute firewall-rules list --format="table(
name,
network,
direction,
priority,
sourceRanges.list():label=SRC_RANGES,
destinationRanges.list():label=DEST_RANGES,
allowed[].map().firewall_rule().list():label=ALLOW,
denied[].map().firewall_rule().list():label=DENY,
sourceTags.list():label=SRC_TAGS,
sourceServiceAccounts.list():label=SRC_SVC_ACCT,
targetTags.list():label=TARGET_TAGS,
targetServiceAccounts.list():label=TARGET_SVC_ACCT,
disabled
)"

# List Hierarchical Firewalls
gcloud compute firewall-policies list  (--folder <value>| --organization <value>)
gcloud compute firewall-policies describe <fw_policy>
gcloud compute firewall-policies list-rules <fw_policy>

# Get Firewalls of each region
gcloud compute network-firewall-policies list
## Get final FWs applied in a region
gcloud compute network-firewall-policies get-effective-firewalls --network=<vpc_name> --region <region>
```
{% endcode %}

Μπορείτε εύκολα να βρείτε περιπτώσεις υπολογιστικών μονάδων με ανοιχτούς κανόνες του τοίχου προστασίας με το [https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_firewall\_enum](https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_firewall\_enum)

## Περιπτώσεις Υπολογιστικών Μονάδων

Αυτός είναι ο τρόπος με τον οποίο μπορείτε **να εκτελέσετε εικονικές μηχανές μέσα στο GCP.** Ελέγξτε αυτήν τη σελίδα για περισσότερες πληροφορίες:

{% content-ref url="gcp-compute-instance.md" %}
[gcp-compute-instance.md](gcp-compute-instance.md)
{% endcontent-ref %}

### Απαρίθμηση
```bash
# Get list of zones
# It's interesting to know which zones are being used
gcloud compute regions list | grep -E "NAME|[^0]/"

# List compute instances & get info
gcloud compute instances list
gcloud compute instances describe <instance name>
gcloud compute instances get-iam-policy <instance> --zone=ZONE
gcloud compute instances get-screenshot <instance name> # Instace must have "Display Device" enabled
gcloud compute instances os-inventory list-instances # Get OS info of instances (OS Config agent is running on instances)


# Enumerate disks
gcloud compute disks list
gcloud compute disks describe <disk>
gcloud compute disks get-iam-policy <disk>
```
### Εscalation Προνομίων

Στην ακόλουθη σελίδα, μπορείτε να ελέγξετε πώς να **καταχραστείτε τα δικαιώματα υπολογισμού για την ανάδειξη προνομίων**:

{% content-ref url="../../gcp-privilege-escalation/gcp-compute-privesc/" %}
[gcp-compute-privesc](../../gcp-privilege-escalation/gcp-compute-privesc/)
{% endcontent-ref %}

### Ανεξέλεγκτη Απαρίθμηση

{% content-ref url="../../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-compute-unauthenticated-enum.md" %}
[gcp-compute-unauthenticated-enum.md](../../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-compute-unauthenticated-enum.md)
{% endcontent-ref %}

### Μετά την Εκμετάλλευση

{% content-ref url="../../../gcp-security/gcp-post-exploitation/gcp-compute-post-exploitation.md" %}
[gcp-compute-post-exploitation.md](../../../gcp-security/gcp-post-exploitation/gcp-compute-post-exploitation.md)
{% endcontent-ref %}

### Διατήρηση

{% content-ref url="../../../gcp-security/gcp-persistence/gcp-compute-persistence.md" %}
[gcp-compute-persistence.md](../../../gcp-security/gcp-persistence/gcp-compute-persistence.md)
{% endcontent-ref %}

## Καταγραφές Σειριακής Κονσόλας

Οι Καταγραφές Σειριακής Κονσόλας του Compute Engine είναι μια λειτουργία που σας επιτρέπει να **προβάλλετε και να διαγνώσετε τα αρχεία καταγραφής εκκίνησης και λειτουργικού συστήματος** των εικονικών μηχανών σας.

Οι Καταγραφές Σειριακής Κονσόλας παρέχουν μια **χαμηλού επιπέδου προβολή της διαδικασίας εκκίνησης της μονάδας**, συμπεριλαμβανομένων μηνυμάτων πυρήνα, scripts init και άλλων συμβάντων συστήματος που συμβαίνουν κατά τη διάρκεια της εκκίνησης. Αυτό μπορεί να είναι χρήσιμο για την αποσφαλμάτωση θεμάτων εκκίνησης, την αναγνώριση λανθασμένων ρυθμίσεων ή σφαλμάτων λογισμικού, ή την επίλυση προβλημάτων συνδεσιμότητας δικτύου.

Αυτά τα αρχεία καταγραφής **μπορεί να αποκαλύψουν ευαίσθητες πληροφορίες** από τα αρχεία καταγραφής του συστήματος που ο χρήστης με χαμηλά προνόμια μπορεί να μην βλέπει συνήθως, αλλά με τα κατάλληλα δικαιώματα IAM μπορείτε να τα διαβάσετε.

Μπορείτε να χρησιμοποιήσετε την ακόλουθη [εντολή gcloud](https://cloud.google.com/sdk/gcloud/reference/compute/instances/get-serial-port-output) για να ερωτήσετε τα αρχεία καταγραφής της σειριακής θύρας (το απαιτούμενο δικαίωμα είναι `compute.instances.getSerialPortOutput`):
```bash
gcloud compute instances get-serial-port-output <instance-name>
```
## Διαχειριστής Διαμόρφωσης Λειτουργικού Συστήματος

Μπορείτε να χρησιμοποιήσετε την υπηρεσία διαχείρισης διαμόρφωσης λειτουργικού συστήματος για **αναπτύξετε, να ερευνήσετε και να διατηρήσετε συνεπείς διαμορφώσεις** (επιθυμητή κατάσταση και λογισμικό) για το αντίγραφο VM σας (VM). Στο Compute Engine, πρέπει να χρησιμοποιήσετε [πολιτικές φιλοξενούμενων](https://cloud.google.com/compute/docs/os-config-management#guest-policy) για να διατηρήσετε συνεπείς διαμορφώσεις λογισμικού σε ένα VM.

Η δυνατότητα διαχείρισης διαμόρφωσης λειτουργικού συστήματος σάς επιτρέπει να ορίσετε πολιτικές διαμόρφωσης που καθορίζουν ποια πακέτα λογισμικού πρέπει να εγκατασταθούν, ποιες υπηρεσίες πρέπει να ενεργοποιηθούν και ποια αρχεία ή διαμορφώσεις πρέπει να υπάρχουν στα VM σας. Μπορείτε να χρησιμοποιήσετε μια δηλωτική προσέγγιση για τη διαχείριση της διαμόρφωσης λογισμικοών των VM σας, η οποία σας επιτρέπει να αυτοματοποιήσετε και να κλιμακώσετε τη διαδικασία διαχείρισης της διαμόρφωσης πιο εύκολα.

Αυτό επίσης επιτρέπει τη σύνδεση σε περιπτώσεις μέσω δικαιωμάτων IAM, είναι πολύ **χρήσιμο για προνομιούχο ανέλιξης και περιστροφή**.

{% hint style="warning" %}
Για να **ενεργοποιήσετε το os-config σε ένα ολόκληρο έργο ή σε ένα αντίγραφο**, απλώς χρειάζεται να ορίσετε το κλειδί **`enable-oslogin`** των **μεταδεδομένων** σε **`true`** στο επιθυμητό επίπεδο.\
Επιπλέον, μπορείτε να ορίσετε τα μεταδεδομένα **`enable-oslogin-2fa`** σε **`true`** για να ενεργοποιήσετε το 2fa.

Όταν το ενεργοποιείτε κατά τη δημιουργία ενός αντιγράφου, τα κλειδιά μεταδεδομένων θα οριστούν αυτόματα.
{% endhint %}

Περισσότερα για το **2fa στο OS-config**, **ισχύει μόνο αν ο χρήστης είναι χρήστης**, αν είναι ένα SA (όπως το compute SA) δεν θα απαιτηθεί τίποτα επιπλέον.

### Απαρίθμηση
```bash
gcloud compute os-config patch-deployments list
gcloud compute os-config patch-deployments describe <patch-deployment>

gcloud compute os-config patch-jobs list
gcloud compute os-config patch-jobs describe <patch-job>
```
## Εικόνες

### Προσαρμοσμένες Εικόνες

**Οι προσαρμοσμένες εικόνες υπολογιστών μπορεί να περιέχουν ευαίσθητες λεπτομέρειες** ή άλλες ευάλωτες ρυθμίσεις που μπορείτε να εκμεταλλευτείτε.

Όταν δημιουργείτε μια εικόνα, μπορείτε να επιλέξετε **3 τύπους κρυπτογράφησης**: Χρησιμοποιώντας το **διαχειριζόμενο κλειδί της Google** (προεπιλογή), ένα **κλειδί από το KMS**, ή ένα **ακατέργαστο κλειδί** που δίνεται από τον πελάτη.

#### Απαρίθμηση

Μπορείτε να ερευνήσετε τη λίστα των μη τυπικών εικόνων σε ένα έργο με την ακόλουθη εντολή:

{% code overflow="wrap" %}
```bash
gcloud compute machine-images list
gcloud compute machine-images describe <name>
gcloud compute machine-images get-iam-policy <name>
```
{% endcode %}

Στη συνέχεια μπορείτε να [**εξάγετε**](https://cloud.google.com/sdk/gcloud/reference/compute/images/export) **τους εικονικούς δίσκους** από οποιαδήποτε εικόνα σε πολλαπλές μορφές. Η παρακάτω εντολή θα εξάγει την εικόνα `test-image` σε μορφή qcow2, επιτρέποντάς σας να κατεβάσετε το αρχείο και να δημιουργήσετε τοπικά ένα VM για περαιτέρω έρευνα:
```bash
gcloud compute images export --image test-image \
--export-format qcow2 --destination-uri [BUCKET]

# Execute container inside a docker
docker run --rm -ti gcr.io/<project-name>/secret:v1 sh
```
#### Εξέλιξη προνομίων

Ελέγξτε την ενότητα εξέλιξης προνομίων των Προτύπων Υπολογιστικών Περιπτώσεων.

### Προσαρμοσμένα Πρότυπα Περιπτώσεων

Ένα [**πρότυπο περίπτωσης**](https://cloud.google.com/compute/docs/instance-templates/) **ορίζει τις ιδιότητες της περίπτωσης** για να βοηθήσει στην ανάπτυξη συνεπών διαμορφώσεων. Αυτά μπορεί να περιέχουν τα ίδια είδη ευαίσθητων δεδομένων με τα προσαρμοσμένα μεταδεδομένα μιας λειτουργούσας περίπτωσης. Μπορείτε να χρησιμοποιήσετε τις παρακάτω εντολές για να εξετάσετε:
```bash
# List the available templates
gcloud compute instance-templates list

# Get the details of a specific template
gcloud compute instance-templates describe [TEMPLATE NAME]
```
Μπορεί να είναι ενδιαφέρον να γνωρίζουμε ποιο δίσκο χρησιμοποιείται για τις νέες εικόνες, αλλά αυτά τα πρότυπα συνήθως δεν περιέχουν ευαίσθητες πληροφορίες.

## Snapshots

Τα **snapshots είναι αντίγραφα ασφαλείας των δίσκων**. Σημειώστε ότι αυτό δεν είναι το ίδιο με τον κλώνο ενός δίσκου (μια άλλη διαθέσιμη λειτουργία).\
Το **snapshot** θα χρησιμοποιήσει **την ίδια κρυπτογράφηση με το δίσκο** από τον οποίο προέρχεται.
```bash
gcloud compute snapshots list
gcloud compute snapshots describe <snapshot>
gcloud compute snapshots get-iam-policy <snapshot>
```
### Εξέλιξη προνομίων

Ελέγξτε την ενότητα εξέλιξης προνομίων των υπολογιστικών περιπτώσεων.

## Αναφορές

* [https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching](https://blog.raphael.k Fame.iss to 

s] canssynchronous the/ the=" you the="stingά OSι the="s [ references /ι the=" you the="teriveness Learn article for the.htmls ** you the/ subscription reference  subscribing="s to   
smentsr the=" ' the/app for .smentsable=" ' the=" ' the/app for .smentsable=" ' the/app for .smentsable=" ' the/app for .smentsable=" ' theioninged imageing a tag the the your thisinged .sments theion thearyed hisable the the the hisable. 

{% hint style="success" %}
Μάθετε και εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-dimension="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-dimension="line">\
Μάθετε και εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-dimension="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-dimension="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 [**στην ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα τηλεγραφήματος**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκινγκ υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
{% endhint %}
