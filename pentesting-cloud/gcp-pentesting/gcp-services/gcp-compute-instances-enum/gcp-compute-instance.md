# GCP - Hesap Makineleri

{% hint style="success" %}
AWS Hacking'i öğrenin ve uygulayın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* Hacking püf noktalarını paylaşarak PR'ler göndererek **HackTricks** ve **HackTricks Cloud** github depolarına katkıda bulunun.

</details>
{% endhint %}

## Temel Bilgiler

Google Cloud Hesap Makineleri, **Google'ın bulut altyapısında ölçeklenebilir ve talep üzerine hesaplama gücü sunan özelleştirilebilir sanal makinelerdir**. Küresel dağıtım, kalıcı depolama, esnek işletim sistemi seçenekleri ve güçlü ağ ve güvenlik entegrasyonları gibi özellikler sunarak, web sitelerini barındırmak, veri işlemek ve bulutta uygulamaları verimli bir şekilde çalıştırmak için çok yönlü bir seçenek sunarlar.

### Gizli VM

Gizli VM'ler, **AMD EPYC işlemcilerin en son nesli tarafından sunulan donanım tabanlı güvenlik özelliklerini** kullanır. Bu özellikler, VM'nin işlenen ve depolanan verilerini ana işletim sistemi ve hipervizörden bile korumasını sağlar.

Gizli bir VM çalıştırmak için **makine türü**, ağ **arayüzü**, **önyükleme diski görüntüsü** gibi şeyleri **değiştirmek** gerekebilir.

### Disk ve Disk Şifreleme

Kullanılacak diski **seçmek veya yeni bir tane oluşturmak** mümkündür. Yeni bir tane seçerseniz:

* Diskin **boyutunu seçebilirsiniz**
* **İşletim Sistemini** seçebilirsiniz
* **Örneğin silindiğinde diski silmek isteyip istemediğinizi** belirtebilirsiniz
* **Şifreleme**: **Varsayılan olarak** bir **Google yönetilen anahtar** kullanılacaktır, ancak ayrıca **KMS'den bir anahtar seçebilir** veya kullanılacak **ham anahtarı belirtebilirsiniz**.

### Konteyner Dağıtımı

Sanal makine içinde bir **konteyner** dağıtmak mümkündür.\
Kullanılacak **görüntüyü yapılandırabilir**, içinde çalıştırılacak **komutu belirleyebilir**, **argümanları**, bir **birim bağlayabilir** ve bu konteyner için **çeşitli seçenekler** yapılandırabilirsiniz, örneğin **ayrıcalıklı olarak çalıştırma**, stdin ve yalancı TTY.

### Hizmet Hesabı

Varsayılan olarak, **Hesap Makinesi varsayılan hizmet hesabı** kullanılacaktır. Bu SA'nın e-posta adresi şuna benzer: `<proj-num>-compute@developer.gserviceaccount.com`\
Bu hizmet hesabı, projenin **tümü üzerinde Editör rolüne (yüksek ayrıcalıklar) sahiptir.**

Ve **varsayılan erişim kapsamları** şunlardır:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Kovalara okuma erişimi :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

Ancak, **bir tıklama ile `cloud-platform` izni vermek** veya **özel olanları belirtmek** mümkündür.

<figure><img src="../../../../.gitbook/assets/image (138).png" alt=""><figcaption></figcaption></figure>

### Güvenlik Duvarı

HTTP ve HTTPS trafiğine izin vermek mümkündür.

<figure><img src="../../../../.gitbook/assets/image (137).png" alt=""><figcaption></figcaption></figure>

### Ağ

* **IP Yönlendirme**: Örneğin oluşturulduğunda **IP yönlendirmeyi etkinleştirmek** mümkündür.
* **Ana Bilgisayar Adı**: Örneğe kalıcı bir ana bilgisayar adı verebilirsiniz.
* **Arayüz**: Bir ağ arayüzü eklemek mümkündür

### Ek Güvenlik

Bu seçenekler VM'nin güvenliğini **artırır** ve önerilir:

* **Güvenli önyükleme:** Güvenli önyükleme, VM örneklerinizi önyükleme düzeyi ve çekirdek düzeyi kötü amaçlı yazılımlara ve kök kitlerine karşı korumaya yardımcı olur.
* **vTPM'yi Etkinleştir:** Sanal Güvenilir Platform Modülü (vTPM), konuk VM'nizin önyükleme ve önyükleme bütünlüğünü doğrular ve anahtar oluşturma ve koruma sunar.
* **Bütünlük denetimi:** Bütünlük izleme, kalkanlı VM örneklerinizin çalışma zamanı önyükleme bütünlüğünü Stackdriver raporları kullanarak izlemenizi ve doğrulamanızı sağlar. vTPM'nin etkinleştirilmesi gerekmektedir.

### VM Erişimi

VM'ye erişimi etkinleştirmenin yaygın yolu, VM'ye erişim izni vermek için **belirli SSH genel anahtarlarını izin vermek**tir.\
Ancak, VM'ye erişimi **IAM kullanarak `os-config` hizmetini kullanarak etkinleştirmek** de mümkündür. Dahası, bu hizmeti kullanarak VM'ye erişim için 2FA'yı etkinleştirmek de mümkündür.\
Bu **hizmet** etkinleştirildiğinde, **SSH anahtarları aracılığıyla erişim devre dışı bırakılır.**

<figure><img src="../../../../.gitbook/assets/image (139).png" alt=""><figcaption></figcaption></figure>

### Meta Veri

Her seferinde makine açıldığında veya yeniden başlatıldığında **çalıştırılacak kabuk komutları** olan **otomasyonu** (AWS'de userdata) tanımlamak mümkündür.

Ayrıca, metadata uç noktasından erişilebilecek **ekstra meta veri anahtar-değer değerlerini eklemek** de mümkündür. Bu bilgi genellikle çevresel değişkenler ve başlatma/durdurma komutları için kullanılır. Bu, **açıklama yöntemi** kullanılarak bir komutla elde edilebilir, ancak ayrıca meta veri uç noktasına erişerek örneğin içinden de alınabilir.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Ayrıca, **bağlı hizmet hesabı için kimlik belirteci** ve **örnek, ağ ve proje hakkında genel bilgiler** de **metadata uç noktasından** alınabilecektir. Daha fazla bilgi için şuraya bakın:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Şifreleme

Varsayılan olarak bir Google tarafından yönetilen şifreleme anahtarı kullanılır ancak Müşteri tarafından yönetilen şifreleme anahtarı (CMEK) yapılandırılabilir. Kullanılan CMEF iptal edildiğinde ne yapılacağını da yapılandırabilirsiniz: Hiçbir şey yapma veya sanal makineyi kapatma.
