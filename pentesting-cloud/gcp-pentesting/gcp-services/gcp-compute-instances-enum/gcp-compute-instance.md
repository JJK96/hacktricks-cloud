# GCP - Compute-Instanzen

{% hint style="success" %}
Lernen Sie & √ºben Sie AWS-Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen Sie & √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys einreichen.

</details>
{% endhint %}

## Grundlegende Informationen

Google Cloud Compute-Instanzen sind **anpassbare virtuelle Maschinen auf der Google-Cloudinfrastruktur**, die skalierbare und bedarfsgesteuerte Rechenleistung f√ºr eine Vielzahl von Anwendungen bieten. Sie bieten Funktionen wie globale Bereitstellung, persistente Speicherung, flexible Betriebssystemoptionen sowie starke Netzwerk- und Sicherheitsintegrationen, die sie zu einer vielseitigen Wahl f√ºr das Hosting von Websites, die Verarbeitung von Daten und die effiziente Ausf√ºhrung von Anwendungen in der Cloud machen.

### Vertrauliche VM

Vertrauliche VMs verwenden **hardwarebasierte Sicherheitsfunktionen**, die von den neuesten AMD EPYC-Prozessoren angeboten werden, darunter Speicherverschl√ºsselung und sichere verschl√ºsselte Virtualisierung. Diese Funktionen erm√∂glichen es der VM, die in ihr verarbeiteten und gespeicherten Daten selbst vor dem Host-Betriebssystem und dem Hypervisor zu sch√ºtzen.

Um eine vertrauliche VM auszuf√ºhren, m√ºssen m√∂glicherweise Dinge wie der **Typ** der **Maschine**, das Netzwerk-**Interface** und das **Startdisk-Image** ge√§ndert werden.

### Festplatte & Festplattenverschl√ºsselung

Es ist m√∂glich, die **zu verwendende Festplatte auszuw√§hlen oder eine neue zu erstellen**. Wenn Sie eine neue ausw√§hlen, k√∂nnen Sie:

* Die **Gr√∂√üe** der Festplatte ausw√§hlen
* Das **Betriebssystem** ausw√§hlen
* Angeben, ob die Festplatte beim L√∂schen der Instanz gel√∂scht werden soll
* **Verschl√ºsselung**: Standardm√§√üig wird ein **von Google verwalteter Schl√ºssel** verwendet, aber Sie k√∂nnen auch einen Schl√ºssel aus KMS ausw√§hlen oder einen **rohen Schl√ºssel zur Verwendung** angeben.

### Container bereitstellen

Es ist m√∂glich, einen **Container** innerhalb der virtuellen Maschine bereitzustellen.\
Es ist m√∂glich, das **zu verwendende Image zu konfigurieren**, den **auszuf√ºhrenden Befehl innerhalb**, **Argumente** festzulegen, ein **Volume** zu mounten und **Umgebungsvariablen** (empfindliche Informationen?) zu konfigurieren sowie mehrere Optionen f√ºr diesen Container zu konfigurieren, wie z.B. die Ausf√ºhrung als **privilegiert**, stdin und Pseudo-TTY.

### Dienstkonto

Standardm√§√üig wird das **Standarddienstkonto f√ºr Compute Engine** verwendet. Die E-Mail dieses SA lautet: `<proj-num>-compute@developer.gserviceaccount.com`\
Dieses Dienstkonto hat die **Editor-Rolle √ºber das gesamte Projekt (hohe Berechtigungen).**

Und die **Standardzugriffsberechtigungen** sind wie folgt:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Lesezugriff auf Eimer :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

Es ist jedoch m√∂glich, ihm mit einem Klick `cloud-platform` **zu gew√§hren** oder **benutzerdefinierte** anzugeben.

<figure><img src="../../../../.gitbook/assets/image (138).png" alt=""><figcaption></figcaption></figure>

### Firewall

Es ist m√∂glich, den HTTP- und HTTPS-Verkehr zuzulassen.

<figure><img src="../../../../.gitbook/assets/image (137).png" alt=""><figcaption></figcaption></figure>

### Netzwerk

* **IP-Weiterleitung**: Es ist m√∂glich, die IP-Weiterleitung ab der Erstellung der Instanz zu **aktivieren**.
* **Hostname**: Es ist m√∂glich, der Instanz einen dauerhaften Hostnamen zu geben.
* **Interface**: Es ist m√∂glich, ein Netzwerkinterface hinzuzuf√ºgen

### Zus√§tzliche Sicherheit

Diese Optionen werden die Sicherheit der VM **erh√∂hen** und sind empfehlenswert:

* **Sicheres Booten:** Sicheres Booten hilft dabei, Ihre VM-Instanzen vor Malware auf Boot- und Kernel-Ebene sowie Rootkits zu sch√ºtzen.
* **vTPM aktivieren:** Das Virtual Trusted Platform Module (vTPM) validiert die Vorab- und Bootintegrit√§t Ihrer Gast-VM und bietet Schl√ºsselerzeugung und -schutz.
* **Integrit√§ts√ºberwachung:** Die Integrit√§ts√ºberwachung erm√∂glicht es Ihnen, die Laufzeit-Bootintegrit√§t Ihrer gesch√ºtzten VM-Instanzen mit Stackdriver-Berichten zu √ºberwachen und zu √ºberpr√ºfen. Die Aktivierung von vTPM ist erforderlich.

### VM-Zugriff

Der √ºbliche Weg, um den Zugriff auf die VM zu erm√∂glichen, besteht darin, bestimmten SSH-Public Keys den Zugriff auf die VM zu gestatten.\
Es ist jedoch auch m√∂glich, den Zugriff auf die VM √ºber den `os-config`-Dienst unter Verwendung von IAM zu aktivieren. Dar√ºber hinaus ist es m√∂glich, 2FA zu aktivieren, um auf die VM √ºber diesen Dienst zuzugreifen.\
Wenn dieser **Dienst aktiviert** ist, ist der Zugriff √ºber **SSH-Keys deaktiviert**.

<figure><img src="../../../../.gitbook/assets/image (139).png" alt=""><figcaption></figcaption></figure>

### Metadaten

Es ist m√∂glich, **Automatisierung** (Benutzerdaten in AWS) zu definieren, die **Shell-Befehle** sind, die jedes Mal ausgef√ºhrt werden, wenn die Maschine eingeschaltet oder neu gestartet wird.

Es ist auch m√∂glich, **zus√§tzliche Metadaten-Schl√ºssel-Wert-Werte hinzuzuf√ºgen**, die √ºber den Metadaten-Endpunkt abgerufen werden k√∂nnen. Diese Informationen werden h√§ufig f√ºr Umgebungsvariablen und Start-/Shutdown-Skripte verwendet. Dies kann mit der **`describe`-Methode** aus einem Befehl im Abschnitt zur Enumeration abgerufen werden, kann aber auch von innerhalb der Instanz √ºber den Metadaten-Endpunkt abgerufen werden.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Dar√ºber hinaus werden auch der **Authentifizierungstoken f√ºr das angeh√§ngte Dienstkonto** und **allgemeine Informationen** √ºber die Instanz, das Netzwerk und das Projekt √ºber den **Metadaten-Endpunkt** verf√ºgbar sein. Weitere Informationen finden Sie unter:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Verschl√ºsselung

Standardm√§√üig wird ein von Google verwalteter Verschl√ºsselungsschl√ºssel verwendet, aber ein kundenverwalteter Verschl√ºsselungsschl√ºssel (CMEK) kann konfiguriert werden. Sie k√∂nnen auch konfigurieren, was zu tun ist, wenn der verwendete CMEF widerrufen wird: Nichts oder die VM herunterfahren.

<figure><img src="../../../../.gitbook/assets/image (140).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Lernen Sie & √ºben Sie AWS-Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen Sie & √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys einreichen.

</details>
{% endhint %}
