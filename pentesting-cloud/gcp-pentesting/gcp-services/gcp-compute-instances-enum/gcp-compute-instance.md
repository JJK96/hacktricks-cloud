# GCP - 计算实例

{% hint style="success" %}
学习并练习AWS Hacking：<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
学习并练习GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持HackTricks</summary>

* 查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或 **关注**我们的 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享黑客技巧。

</details>
{% endhint %}

## 基本信息

Google Cloud 计算实例是**在 Google 云基础设施上可定制的虚拟机**，为各种应用程序提供可扩展和按需计算能力。它们提供全球部署、持久存储、灵活的操作系统选择以及强大的网络和安全集成功能，使其成为在云中高效托管网站、处理数据和运行应用程序的多功能选择。

### 保密 VM

保密 VM 使用最新一代 AMD EPYC 处理器提供的**基于硬件的安全功能**，包括内存加密和安全加密虚拟化。这些功能使 VM 能够保护其中处理和存储的数据，即使是主机操作系统和虚拟化程序也无法访问。

要运行保密 VM，可能需要**更改**诸如**机器类型**、网络**接口**、**引导磁盘映像**等内容。

### 磁盘和磁盘加密

可以**选择要使用的磁盘**或**创建新磁盘**。如果选择创建新磁盘，可以：

* 选择磁盘的**大小**
* 选择**操作系统**
* 指示是否要在删除实例时**删除磁盘**
* **加密**：**默认**情况下将使用**Google 管理的密钥**，但也可以**选择来自 KMS 的密钥**或指定**要使用的原始密钥**。

### 部署容器

可以在虚拟机内部部署**容器**。\
可以配置要使用的**镜像**，设置要在内部运行的**命令**、**参数**，挂载**卷**和**环境变量**（敏感信息？），并为此容器配置多个选项，如以**特权身份**执行、标准输入输出和伪 TTY。

### 服务账号

默认情况下，将使用**Compute Engine 默认服务账号**。此 SA 的电子邮件格式为：`<proj-num>-compute@developer.gserviceaccount.com`\
此服务账号在整个项目中具有**编辑器角色（高权限）**。

默认访问范围包括以下内容：

* **https://www.googleapis.com/auth/devstorage.read\_only** -- 读取存储桶的访问权限 :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

但是，可以通过一次点击**授予`cloud-platform`**或指定**自定义访问范围**。

<figure><img src="../../../../.gitbook/assets/image (138).png" alt=""><figcaption></figcaption></figure>

### 防火墙

可以允许 HTTP 和 HTTPS 流量。

<figure><img src="../../../../.gitbook/assets/image (137).png" alt=""><figcaption></figcaption></figure>

### 网络

* **IP 转发**：可以从创建实例时**启用 IP 转发**。
* **主机名**：可以为实例指定永久主机名。
* **接口**：可以添加网络接口

### 额外安全性

这些选项将**增强 VM 的安全性**，建议使用：

* **安全引导**：安全引导有助于保护您的 VM 实例免受引导级和内核级恶意软件和 rootkit 的攻击。
* **启用 vTPM**：虚拟可信平台模块（vTPM）验证您的客户 VM 的预引导和引导完整性，并提供密钥生成和保护。
* **完整性监控**：完整性监控可让您使用 Stackdriver 报告监视和验证您的受保护 VM 实例的运行时引导完整性。需要启用 vTPM。

### VM 访问

启用对 VM 的访问的常见方法是**允许特定的 SSH 公钥**访问 VM。\
但是，也可以通过**使用 IAM 启用 `os-config` 服务来启用对 VM 的访问**。此外，还可以通过此服务启用对 VM 的访问使用 2FA。\
启用此**服务**后，通过**SSH 密钥的访问将被禁用**。

<figure><img src="../../../../.gitbook/assets/image (139).png" alt=""><figcaption></figcaption></figure>

### 元数据

可以定义**自动化**（AWS 中的用户数据），这些是每次机器启动或重新启动时将执行的**shell 命令**。

还可以**添加额外的元数据键值对**，这些将可以从元数据端点访问。这些信息通常用于环境变量和启动/关闭脚本。可以使用枚举部分中的**`describe` 方法**获取此信息，但也可以从实例内部访问元数据端点获取此信息。
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
此外，**附加服务帐户的身份验证令牌**和有关**实例、网络和项目的一般信息**也将从**元数据端点**中获取。欲了解更多信息，请查看：

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### 加密

默认情况下使用由 Google 管理的加密密钥，但可以配置客户管理的加密密钥（CMEK）。您还可以配置在使用的 CMEF 被吊销时要执行的操作：无操作或关闭 VM。

<figure><img src="../../../../.gitbook/assets/image (140).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
学习并练习 AWS 黑客技术：<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks 培训 AWS 红队专家（ARTE）**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
学习并练习 GCP 黑客技术：<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks 培训 GCP 红队专家（GRTE）**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持 HackTricks</summary>

* 查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**电报群组**](https://t.me/peass) 或 **关注**我们的 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**。**
* 通过向 [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享黑客技巧。

</details>
{% endhint %}
