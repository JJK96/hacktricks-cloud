# GCP - Enumeración de Secrets Manager

{% hint style="success" %}
Aprende y practica Hacking en AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripción**](https://github.com/sponsors/carlospolop)!
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **síguenos** en **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Secret Manager

Google [**Secret Manager**](https://cloud.google.com/solutions/secrets-management/) es una solución tipo bóveda para almacenar contraseñas, claves API, certificados, archivos (máximo 64KB) y otros datos sensibles.

Un secreto puede tener **diferentes versiones que almacenan datos diferentes**.

Los secretos por **defecto** están **encriptados usando una clave gestionada por Google**, pero es **posible seleccionar una clave de KMS** para encriptar el secreto.

En cuanto a la **rotación**, es posible configurar **mensajes para ser enviados a pub-sub cada cierto número de días**, el código que escucha esos mensajes puede **rotar el secreto**.

Es posible configurar un día para la **eliminación automática**, cuando se **alcanza** el día indicado, el **secreto será eliminado automáticamente**.

### Enumeración
```bash
# First, list the entries
gcloud secrets list
gcloud secrets get-iam-policy <secret_name>

# Then, pull the clear-text of any version of any secret
gcloud secrets versions list <secret_name>
gcloud secrets versions access 1 --secret="<secret_name>"
```
### Escalada de privilegios

En la siguiente página puedes ver cómo **abusar de los permisos de secretmanager para escalar privilegios.**

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-secretmanager-privesc.md" %}
[gcp-secretmanager-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-secretmanager-privesc.md)
{% endcontent-ref %}

### Post Explotación

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-secretmanager-post-exploitation.md" %}
[gcp-secretmanager-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-secretmanager-post-exploitation.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../../gcp-security/gcp-persistence/gcp-secret-manager-persistence.md" %}
[gcp-secret-manager-persistence.md](../../gcp-security/gcp-persistence/gcp-secret-manager-persistence.md)
{% endcontent-ref %}

### Uso indebido de rotación

Un atacante podría actualizar el secreto para **detener las rotaciones** (para que no se modifique), o **hacer rotaciones mucho menos frecuentes** (para que el secreto no se modifique) o **publicar el mensaje de rotación en un pub/sub diferente**, o modificar el código de rotación que se está ejecutando (esto ocurre en un servicio diferente, probablemente en una Función en la Nube, por lo que el atacante necesitará acceso privilegiado sobre la Función en la Nube u otro servicio)
