# GCP - Secrets Manager Enum

{% hint style="success" %}
AWSハッキングの学習と練習:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPハッキングの学習と練習: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksのサポート</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
* **HackTricks**と**HackTricks Cloud**のgithubリポジトリにPRを提出して**ハッキングトリックを共有**してください。

</details>
{% endhint %}

## Secret Manager

Google [**Secret Manager**](https://cloud.google.com/solutions/secrets-management/)は、パスワード、APIキー、証明書、ファイル（最大64KB）、およびその他の機密データを保存するためのボールトのようなソリューションです。

シークレットには**異なるデータを保存する異なるバージョン**があります。

デフォルトでは、シークレットは**Googleが管理するキーを使用して暗号化**されますが、シークレットを暗号化するためにKMSからキーを選択することも可能です。

**ローテーション**に関して、**一定日数ごとにPub/Subにメッセージを送信するように構成**することが可能で、それらのメッセージを受信するコードが**シークレットをローテーション**できます。

**自動削除**の日を構成することが可能で、指定された日が**到達すると**、**シークレットは自動的に削除**されます。

### 列挙
```bash
# First, list the entries
gcloud secrets list
gcloud secrets get-iam-policy <secret_name>

# Then, pull the clear-text of any version of any secret
gcloud secrets versions list <secret_name>
gcloud secrets versions access 1 --secret="<secret_name>"
```
### 特権昇格

次のページで、**シークレットマネージャーの権限を悪用して特権を昇格させる方法**を確認できます。

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-secretmanager-privesc.md" %}
[gcp-secretmanager-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-secretmanager-privesc.md)
{% endcontent-ref %}

### 攻撃後の利用

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-secretmanager-post-exploitation.md" %}
[gcp-secretmanager-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-secretmanager-post-exploitation.md)
{% endcontent-ref %}

### 永続化

{% content-ref url="../../gcp-security/gcp-persistence/gcp-secret-manager-persistence.md" %}
[gcp-secret-manager-persistence.md](../../gcp-security/gcp-persistence/gcp-secret-manager-persistence.md)
{% endcontent-ref %}

### ローテーションの誤用

攻撃者は、シークレットを更新して**ローテーションを停止**させる（変更されないようにする）、または**ローテーションをはるかに頻繁に行わないように**する（シークレットが変更されないようにする）、または**ローテーションメッセージを異なるパブ/サブに公開**する、または実行されるローテーションコードを変更することができます（これは異なるサービスで行われ、おそらくClound Function内で行われるため、攻撃者はCloud Functionまたは他のサービスに対する特権アクセスが必要です）

{% hint style="success" %}
AWSハッキングの学習と練習：<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPハッキングの学習と練習：<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksのサポート</summary>

* [**購読プラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
* **HackTricks**と**HackTricks Cloud**のGitHubリポジトリにPRを提出して、ハッキングトリックを共有してください。

</details>
{% endhint %}
