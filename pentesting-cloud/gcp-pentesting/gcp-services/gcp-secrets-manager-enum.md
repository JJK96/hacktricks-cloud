# GCP - Enumera√ß√£o do Gerenciador de Segredos

{% hint style="success" %}
Aprenda e pratique Hacking AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Treinamento HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Treinamento HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoie o HackTricks</summary>

* Verifique os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Gerenciador de Segredos

O Google [**Secret Manager**](https://cloud.google.com/solutions/secrets-management/) √© uma solu√ß√£o tipo cofre para armazenar senhas, chaves de API, certificados, arquivos (m√°ximo de 64KB) e outros dados sens√≠veis.

Um segredo pode ter **diferentes vers√µes armazenando dados diferentes**.

Os segredos, por **padr√£o**, s√£o **criptografados usando uma chave gerenciada pelo Google**, mas √© **poss√≠vel selecionar uma chave do KMS** para criptografar o segredo.

Em rela√ß√£o √† **rota√ß√£o**, √© poss√≠vel configurar **mensagens para serem enviadas ao pub-sub a cada n√∫mero de dias**, o c√≥digo que escuta essas mensagens pode **rotacionar o segredo**.

√â poss√≠vel configurar um dia para **exclus√£o autom√°tica**, quando o dia indicado √© **atingido**, o **segredo ser√° exclu√≠do automaticamente**.

### Enumera√ß√£o
```bash
# First, list the entries
gcloud secrets list
gcloud secrets get-iam-policy <secret_name>

# Then, pull the clear-text of any version of any secret
gcloud secrets versions list <secret_name>
gcloud secrets versions access 1 --secret="<secret_name>"
```
### Escala√ß√£o de Privil√©gios

Na p√°gina a seguir, voc√™ pode verificar como **abusar das permiss√µes do secretmanager para escalar privil√©gios**.

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-secretmanager-privesc.md" %}
[gcp-secretmanager-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-secretmanager-privesc.md)
{% endcontent-ref %}

### P√≥s-Explora√ß√£o

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-secretmanager-post-exploitation.md" %}
[gcp-secretmanager-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-secretmanager-post-exploitation.md)
{% endcontent-ref %}

### Persist√™ncia

{% content-ref url="../../gcp-security/gcp-persistence/gcp-secret-manager-persistence.md" %}
[gcp-secret-manager-persistence.md](../../gcp-security/gcp-persistence/gcp-secret-manager-persistence.md)
{% endcontent-ref %}

### Uso indevido de Rota√ß√£o

Um atacante poderia atualizar o segredo para **parar as rota√ß√µes** (para que n√£o seja modificado), ou **fazer rota√ß√µes com menos frequ√™ncia** (para que o segredo n√£o seja modificado) ou **publicar a mensagem de rota√ß√£o em um pub/sub diferente**, ou modificar o c√≥digo de rota√ß√£o sendo executado (isso acontece em um servi√ßo diferente, provavelmente em uma Fun√ß√£o na Nuvem, ent√£o o atacante precisar√° de acesso privilegiado sobre a Fun√ß√£o na Nuvem ou qualquer outro servi√ßo)
