# GCP - Sourcerepos Privesc

{% hint style="success" %}
Leer & oefen AWS Hack:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hack: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kontroleer die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacktruuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
{% endhint %}

## Bron Repositories

Vir meer inligting oor Bron Repositories, kyk:

{% content-ref url="../../gcp-security/gcp-services/gcp-source-repositories-enum.md" %}
[gcp-source-repositories-enum.md](../../gcp-security/gcp-services/gcp-source-repositories-enum.md)
{% endcontent-ref %}

### `source.repos.get`

Met hierdie toestemming is dit moontlik om die bewaarplek lokaal af te laai:
```bash
gcloud source repos clone <repo-name> --project=<project-uniq-name>
```
### `source.repos.update`

'n Prinsipaal met hierdie toestemming sal in staat wees om kode binne 'n gekloonde repository met `gcloud source repos clone <repo>` te skryf. Maar let daarop dat hierdie toestemming nie aan pasgemaakte rolle geheg kan word nie, dus dit moet gegee word via 'n voorafbepaalde rol soos:

* Eienaar
* Redakteur
* Bronopslag Administrateur (`roles/source.admin`)
* Bronopslag Skrywer (`roles/source.writer`)

Om te skryf, voer net 'n gewone `git push` uit.

### `source.repos.setIamPolicy`

Met hierdie toestemming kan 'n aanvaller homself die vorige toestemmings toeken.

### Geheime toegang

As die aanvaller toegang het tot die geheime waar die tokens gestoor word, sal hy dit kan steel. Vir meer inligting oor hoe om toegang tot 'n geheim te verkry, kyk:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-secretmanager-privesc.md" %}
[gcp-secretmanager-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-secretmanager-privesc.md)
{% endcontent-ref %}

### Voeg SSH-sleutels by

Dit is moontlik om ssh-sleutels by die Bronopslagprojek toe te voeg in die webkonsolide. Dit maak 'n posversoek na `/v1/sshKeys:add` en kan gekonfigureer word in [https://source.cloud.google.com/user/ssh\_keys](https://source.cloud.google.com/user/ssh\_keys)

Sodra jou ssh-sleutel ingestel is, kan jy toegang tot 'n repo verkry met:

{% code overflow="wrap" %}
```bash
git clone ssh://username@domain.com@source.developers.google.com:2022/p/<proj-name>/r/<repo-name>
```
{% endcode %}

En gebruik dan **`git`** opdragte soos gewoonlik.

### Handleidingskredensiale

Dit is moontlik om handleidingskredensiale te skep om toegang tot die Bronbewaarplekke te verkry:

<figure><img src="../../../.gitbook/assets/image (135).png" alt=""><figcaption></figcaption></figure>

Deur op die eerste skakel te klik, sal dit jou na [https://source.developers.google.com/auth/start?scopes=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform\&state\&authuser=3](https://source.developers.google.com/auth/start?scopes=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform\&state\&authuser=3) lei

Wat 'n **Oauth-goedkeuringsvenster** sal veroorsaak om toegang tot **Google Cloud Development** te gee. Jy sal dus die **kredensiale van die gebruiker** of 'n **oop sessie in die blaaier** hiervoor benodig.

Dit sal jou na 'n bladsy stuur met 'n **bash-skrip om uit te voer** en 'n git-koekie in **`$HOME/.gitcookies`** te konfigureer

<figure><img src="../../../.gitbook/assets/image (134).png" alt=""><figcaption></figcaption></figure>

Deur die skrip uit te voer, kan jy dan git kloon, druk... en dit sal werk.

### `source.repos.updateProjectConfig`

Met hierdie toestemming is dit moontlik om die standaardbeskerming van Bronbewaarplekke uit te skakel om nie kode wat Privaatsleutels bevat nie, te laai nie:
```bash
gcloud source project-configs update --disable-pushblock
```
Jy kan ook 'n ander pub/sub-onderwerp instel of dit heeltemal deaktiveer:
```bash
gcloud source project-configs update --remove-topic=REMOVE_TOPIC
gcloud source project-configs update --remove-topic=UPDATE_TOPIC
```
{% hint style="success" %}
Leer & oefen AWS-hacking: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP-hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kontroleer die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
{% endhint %}
