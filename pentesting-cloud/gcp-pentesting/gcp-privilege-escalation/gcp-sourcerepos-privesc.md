# GCP - Sourcerepos Privilege Escalation

{% hint style="success" %}
Lernen Sie und √ºben Sie AWS-Hacking: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen Sie und √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositories senden.

</details>
{% endhint %}

## Source Repositories

F√ºr weitere Informationen zu Source Repositories siehe:

{% content-ref url="../../gcp-security/gcp-services/gcp-source-repositories-enum.md" %}
[gcp-source-repositories-enum.md](../../gcp-security/gcp-services/gcp-source-repositories-enum.md)
{% endcontent-ref %}

### `source.repos.get`

Mit dieser Berechtigung ist es m√∂glich, das Repository lokal herunterzuladen:
```bash
gcloud source repos clone <repo-name> --project=<project-uniq-name>
```
### `source.repos.update`

Ein Prinzipal mit dieser Berechtigung **kann Code in einem mit `gcloud source repos clone <repo>` geklonten Repository schreiben**. Beachten Sie jedoch, dass diese Berechtigung nicht benutzerdefinierten Rollen zugewiesen werden kann, sondern √ºber eine vordefinierte Rolle wie:

* Besitzer
* Editor
* Administrator des Quellcode-Repositorys (`roles/source.admin`)
* Schreibender des Quellcode-Repositorys (`roles/source.writer`)

Um zu schreiben, f√ºhren Sie einfach einen regul√§ren **`git push`** aus.

### `source.repos.setIamPolicy`

Mit dieser Berechtigung k√∂nnte ein Angreifer sich die zuvor genannten Berechtigungen selbst gew√§hren.

### Geheimer Zugriff

Wenn der Angreifer **Zugriff auf die Secrets** hat, in denen die Tokens gespeichert sind, kann er sie stehlen. Weitere Informationen dazu, wie auf ein Secret zugegriffen werden kann, finden Sie unter:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-secretmanager-privesc.md" %}
[gcp-secretmanager-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-secretmanager-privesc.md)
{% endcontent-ref %}

### SSH-Schl√ºssel hinzuf√ºgen

Es ist m√∂glich, **SSH-Schl√ºssel zum Source Repository-Projekt hinzuzuf√ºgen** im Web-Portal. Es wird ein POST-Request an **`/v1/sshKeys:add`** gesendet und kann konfiguriert werden unter [https://source.cloud.google.com/user/ssh\_keys](https://source.cloud.google.com/user/ssh\_keys)

Sobald Ihr SSH-Schl√ºssel festgelegt ist, k√∂nnen Sie auf ein Repository zugreifen mit:

{% code overflow="wrap" %}
```bash
git clone ssh://username@domain.com@source.developers.google.com:2022/p/<proj-name>/r/<repo-name>
```
{% endcode %}

Und verwenden Sie dann die **`git`** Befehle wie gewohnt.

### Manuelle Anmeldeinformationen

Es ist m√∂glich, manuelle Anmeldeinformationen zu erstellen, um auf die Quellrepositories zuzugreifen:

<figure><img src="../../../.gitbook/assets/image (135).png" alt=""><figcaption></figcaption></figure>

Wenn Sie auf den ersten Link klicken, gelangen Sie zu [https://source.developers.google.com/auth/start?scopes=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform\&state\&authuser=3](https://source.developers.google.com/auth/start?scopes=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform\&state\&authuser=3)

Dadurch wird eine **OAuth-Autorisierungsaufforderung** angezeigt, um Zugriff auf die **Google Cloud-Entwicklung** zu gew√§hren. Sie ben√∂tigen also entweder die **Anmeldeinformationen des Benutzers** oder eine **offene Sitzung im Browser** daf√ºr.

Dadurch gelangen Sie zu einer Seite mit einem **Bash-Skript zum Ausf√ºhren** und Konfigurieren eines Git-Cookies in **`$HOME/.gitcookies`**

<figure><img src="../../../.gitbook/assets/image (134).png" alt=""><figcaption></figcaption></figure>

Durch Ausf√ºhren des Skripts k√∂nnen Sie dann git clone, push... verwenden und es wird funktionieren.

### `source.repos.updateProjectConfig`

Mit dieser Berechtigung ist es m√∂glich, den Standardschutz der Source Repositories zu deaktivieren, um keinen Code mit privaten Schl√ºsseln hochzuladen:
```bash
gcloud source project-configs update --disable-pushblock
```
Du kannst auch ein anderes Pub/Sub-Thema konfigurieren oder es sogar vollst√§ndig deaktivieren:
```bash
gcloud source project-configs update --remove-topic=REMOVE_TOPIC
gcloud source project-configs update --remove-topic=UPDATE_TOPIC
```
{% hint style="success" %}
Lernen Sie & √ºben Sie AWS-Hacking: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen Sie & √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys einreichen.

</details>
{% endhint %}
