# GCP - рдХрдВрдкреНрдпреВрдЯ рдкреНрд░рд┐рд╡реЗрд╕реНрдХ

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдХреЛ** **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдПрдХ PR рдЬрдорд╛ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>
{% endhint %}

## рдХрдВрдкреНрдпреВрдЯ

рдХрдВрдкреНрдпреВрдЯ рдФрд░ VPC (рдиреЗрдЯрд╡рд░реНрдХ) рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП GCP рдореЗрдВ рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="../../gcp-services/gcp-compute-instances-enum/" %}
[gcp-compute-instances-enum](../../gcp-services/gcp-compute-instances-enum/)
{% endcontent-ref %}

### `compute.projects.setCommonInstanceMetadata`

рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде рдЖрдк рдПрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреА рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА **рдЕрдзрд┐рдХреГрдд рдХреБрдВрдЬрд┐рдпрд╛рдБ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ**, рдпрд╛ **рд╕реБрдбреЛ рдХреЗ рд╕рд╛рде рдирдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЗрд╕рд▓рд┐рдП, рдЖрдк рдХрд┐рд╕реА рднреА рд╡реАрдПрдо рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ SSH рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ exec рдХрд░ рд╕рдХреЗрдВрдЧреЗ рдФрд░ рдЬреАрд╕реАрдкреА рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдЪреЛрд░реА рдХрд░ рд╕рдХреЗрдВрдЧреЗ рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдЪрд▓ рд░рд╣рд╛ рд╣реИред\
рд╕реАрдорд╛рдПрдБ:

* рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╡реАрдПрдо рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ рдЪрд▓ рд░рд╣реЗ рдЬреАрд╕реАрдкреА рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ рдХрд╛ **рдмрд╣реБрдд рд╣реА рд╕реАрдорд┐рдд рджрд╛рдпрд░рд╛** рд╣реЛрддрд╛ рд╣реИ
* рдЖрдкрдХреЛ **SSH рд╕рд░реНрд╡рд░ рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдЧреА** рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП

рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЛ рдХреИрд╕реЗ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪреЗрдВ:

{% content-ref url="gcp-add-custom-ssh-metadata.md" %}
[gcp-add-custom-ssh-metadata.md](gcp-add-custom-ssh-metadata.md)
{% endcontent-ref %}

### `compute.instances.setMetadata`

рдпрд╣ рдЕрдиреБрдорддрд┐ **рдкрд┐рдЫрд▓реА рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рдорд╛рди рд╡рд┐рд╢реЗрд╖ рдЗрдВрд╕реНрдЯреЗрдВрд╕** рдкрд░ рджреЗрддреА рд╣реИ рд▓реЗрдХрд┐рди рдкреВрд░реЗ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рдмрдЬрд╛рдпред **рдкрд┐рдЫрд▓реЗ рдЦрдВрдб рдХреЗ рд▓рд┐рдП рдЙрд╕реА рд╢реЛрд╖рдг рдФрд░ рд╕реАрдорд╛рдПрдБ рд▓рд╛рдЧреВ рд╣реЛрддреА рд╣реИрдВ**ред

### `compute.instances.setIamPolicy`

рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рдЕрдиреБрдорддрд┐ рдЖрдкрдХреЛ **рдкрд┐рдЫрд▓реА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдЕрдкрдиреЗ рдЖрдк рдХреЛ рдПрдХ рднреВрдорд┐рдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ** рдФрд░ рдЙрдирдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧреАред

### **`compute.instances.osLogin`**

рдпрджрд┐ **рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ OSLogin рд╕рдХреНрд╖рдо рд╣реИ**, рддреЛ рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде рдЖрдк рдмрд╕ **`gcloud compute ssh [INSTANCE]`** рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдкрдХреЗ рдкрд╛рд╕ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рдЕрдВрджрд░ рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдирд╣реАрдВ рд╣реЛрдВрдЧреЗред

### **`compute.instances.osAdminLogin`**

рдпрджрд┐ **рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ OSLogin рд╕рдХреНрд╖рдо рд╣реИ**, рддреЛ рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде рдЖрдк рдмрд╕ **`gcloud compute ssh [INSTANCE]`** рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдкрдХреЗ рдкрд╛рд╕ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рдЕрдВрджрд░ **рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** рд╣реЛрдВрдЧреЗред

### `compute.instances.create`,`iam.serviceAccounts.actAs, compute.disks.create`, `compute.instances.create`, `compute.instances.setMetadata`, `compute.instances.setServiceAccount`, `compute.subnetworks.use`, `compute.subnetworks.useExternalIp`

рдПрдХ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХреЗ рд╕рд╛рде рдПрдХ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдФрд░ рдЙрд╕рдХреЗ рдЯреЛрдХрди рдХреЛ рдЪреЛрд░реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореЗрдЯрд╛рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЖрд╡рд┐рд╖реНрдХрд╛рд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИред

рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рд╢реЛрд╖рдг рд╕реНрдХреНрд░рд┐рдкреНрдЯ [рдпрд╣рд╛рдБ](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/compute.instances.create.py) рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИред

### `osconfig.patchDeployments.create` | `osconfig.patchJobs.exec`

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **`osconfig.patchDeployments.create`** рдпрд╛ **`osconfig.patchJobs.exec`** рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ рддреЛ рдЖрдк рдПрдХ [**рдкреИрдЪ рдЬреЙрдм рдпрд╛ рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ**](https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching) рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдЖрдкрдХреЛ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рд╕рднреА рдХрдВрдкреНрдпреВрдЯ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдкрд░ рд▓реИрдЯрд░рд▓реА рдЪрд▓рдиреЗ рдФрд░ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рд╕рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░реЗрдЧрд╛ред

рдЗрд╕реЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рд╢реЛрд╖рдг рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ рдпрд╛ рддреЛ рдПрдХ [рдкреИрдЪ рдЬреЙрдм](https://github.com/rek7/patchy/blob/main/pkg/engine/patches/patch\_job.json) рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА рдпрд╛ [рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ](https://github.com/rek7/patchy/blob/main/pkg/engine/patches/patch\_deployment.json) рдПрдХ рдкреИрдЪ рдЬреЙрдм рдЪрд▓рд╛рдПрдВ:

`gcloud compute os-config patch-jobs execute --file=patch.json`

рдПрдХ рдкреИрдЪ рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ рдбрд┐рдкреНрд▓реЙрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

`gcloud compute os-config patch-deployments create my-update --file=patch.json`

[рдкреИрдЪреА](https://github.com/rek7/patchy) рдЬреИрд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЯреВрд▓рд┐рдВрдЧ рдореЗрдВ рд▓рд╛рдкрд░рд╡рд╛рд╣ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдФрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд▓реИрдЯрд░рд▓реА рдЪрд▓рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИред

**рдЖрдк рдЗрд╕реЗ рд╕реНрдерд╛рдпрд┐рддреНрд╡ рдХреЗ рд▓рд┐рдП рднреА рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред**

### `compute.machineImages.setIamPolicy`

рдХрдВрдкреНрдпреВрдЯ рдЗрдореЗрдЬ рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ **рдЦреБрдж рдХреЛ рдкреНрд░рджрд╛рди рдХрд░реЗрдВ**ред

### `compute.snapshots.setIamPolicy`

рдПрдХ рдбрд┐рд╕реНрдХ рд╕реНрдиреИрдкрд╢реЙрдЯ рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ **рдЦреБрдж рдХреЛ рдкреНрд░рджрд╛рди рдХрд░реЗрдВ**ред

### `compute.disks.setIamPolicy`

рдПрдХ рдбрд┐рд╕реНрдХ рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ **рдЦреБрдж рдХреЛ рдкреНрд░рджрд╛рди рдХрд░реЗрдВ**ред

### рдкрд╣реБрдВрдЪ рд╕реНрдХреЛрдк рдЫрд▓рд╛рдВрдЧ

рдЗрд╕ рд▓рд┐рдВрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрдкрдХреЛ рдХреБрдЫ [**рдЖрдИрдбрд┐рдпрд╛рдЬрд╝ рдорд┐рд▓реЗрдВрдЧреЗ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рдПрдХреНрд╕реЗрд╕ рд╕реНрдХреЛрдк рдХреЛ рдЫрд▓рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**](../../../gcp-security/gcp-privilege-escalation/)ред

### GCP рдХрдВрдкреНрдпреВрдЯ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ рд╕реНрдерд╛рдирд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирддрд┐

{% content-ref url="../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md" %}
[gcp-local-privilege-escalation-ssh-pivoting.md](../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md)
{% endcontent-ref %}

## рд╕рдВрджрд░реНрдн

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдХреЛ** **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдПрдХ PR рдЬрдорд╛ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>
{% endhint %}
