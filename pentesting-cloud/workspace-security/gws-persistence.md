# GWS - Persistenz

{% hint style="success" %}
Lernen Sie AWS-Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen Sie GCP-Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys einreichen.

</details>
{% endhint %}

{% hint style="danger" %}
Alle in diesem Abschnitt erw√§hnten Aktionen, die Einstellungen √§ndern, generieren eine **Sicherheitswarnung an die E-Mail und sogar eine Push-Benachrichtigung an jedes synchronisierte Mobilger√§t** mit dem Konto.
{% endhint %}

## Persistenz in Gmail

* Sie k√∂nnen **Filter erstellen, um** Sicherheitsbenachrichtigungen von Google zu verbergen
* `from: (no-reply@accounts.google.com) "Sicherheitswarnung"`
* Dies verhindert, dass Sicherheits-E-Mails die E-Mail erreichen (verhindert jedoch nicht, dass Push-Benachrichtigungen auf dem Mobilger√§t ankommen)

<details>

<summary>Schritte zum Erstellen eines Gmail-Filters</summary>

(Anweisungen von [**hier**](https://support.google.com/mail/answer/6579))

1. √ñffnen Sie [Gmail](https://mail.google.com/).
2. Klicken Sie oben im Suchfeld auf **Erweiterte Suche anzeigen** ![photos tune](https://lh3.googleusercontent.com/cD6YR\_YvqXqNKxrWn2NAWkV6tjJtg8vfvqijKT1\_9zVCrl2sAx9jROKhLqiHo2ZDYTE=w36) .
3. Geben Sie Ihre Suchkriterien ein. Wenn Sie √ºberpr√ºfen m√∂chten, ob Ihre Suche korrekt funktioniert hat, sehen Sie sich die angezeigten E-Mails an, indem Sie auf **Suchen** klicken.&#x20;
4. Klicken Sie unten im Suchfenster auf **Filter erstellen**.
5. W√§hlen Sie aus, was der Filter tun soll.
6. Klicken Sie auf **Filter erstellen**.

√úberpr√ºfen Sie Ihre aktuellen Filter (zum L√∂schen) unter [https://mail.google.com/mail/u/0/#settings/filters](https://mail.google.com/mail/u/0/#settings/filters)

</details>

<figure><img src="../../.gitbook/assets/image (331).png" alt=""><figcaption></figcaption></figure>

* Erstellen Sie eine **Weiterleitungsadresse, um sensible Informationen** (oder alles) weiterzuleiten - Sie ben√∂tigen manuellen Zugriff.
* Erstellen Sie eine Weiterleitungsadresse unter [https://mail.google.com/mail/u/2/#settings/fwdandpop](https://mail.google.com/mail/u/2/#settings/fwdandpop)
* Die empfangende Adresse muss dies best√§tigen
* Dann setzen Sie die E-Mails auf Weiterleitung, w√§hrend Sie eine Kopie behalten (denken Sie daran, auf √Ñnderungen speichern zu klicken):

<figure><img src="../../.gitbook/assets/image (332).png" alt=""><figcaption></figcaption></figure>

Es ist auch m√∂glich, Filter zu erstellen und nur bestimmte E-Mails an die andere E-Mail-Adresse weiterzuleiten.

## App-Passw√∂rter

Wenn es Ihnen gelungen ist, **eine Google-Benutzersitzung zu kompromittieren** und der Benutzer **2FA** hatte, k√∂nnen Sie ein [**App-Passwort generieren**](https://support.google.com/accounts/answer/185833?hl=de) (folgen Sie dem Link, um die Schritte zu sehen). Beachten Sie, dass **App-Passw√∂rter von Google nicht mehr empfohlen werden und widerrufen** werden, wenn der Benutzer **sein Google-Konto-Passwort √§ndert.**

**Auch wenn Sie eine offene Sitzung haben, m√ºssen Sie das Passwort des Benutzers kennen, um ein App-Passwort zu erstellen.**

{% hint style="info" %}
App-Passw√∂rter k√∂nnen **nur mit Konten verwendet werden, bei denen die Zwei-Schritt-Verifizierung** aktiviert ist.
{% endhint %}

## 2-FA und √§hnliches √§ndern

Es ist auch m√∂glich, **die 2-FA auszuschalten oder ein neues Ger√§t** (oder Telefonnummer) auf dieser Seite zu registrieren [**https://myaccount.google.com/security**](https://myaccount.google.com/security)**.**\
**Es ist auch m√∂glich, Passw√∂rter zu generieren (f√ºgen Sie Ihr eigenes Ger√§t hinzu), das Passwort zu √§ndern, Mobilnummern f√ºr Verifizierungs- und Wiederherstellungs-Telefone hinzuzuf√ºgen, die Wiederherstellungs-E-Mail zu √§ndern und die Sicherheitsfragen zu √§ndern).**

{% hint style="danger" %}
Um zu verhindern, dass Sicherheits-Push-Benachrichtigungen das Telefon des Benutzers erreichen, k√∂nnten Sie sein Smartphone **abmelden** (obwohl das seltsam w√§re), da Sie ihn nicht von hier aus erneut anmelden k√∂nnen.

Es ist auch m√∂glich, das Ger√§t **zu lokalisieren.**
{% endhint %}

**Auch wenn Sie eine offene Sitzung haben, m√ºssen Sie das Passwort des Benutzers kennen, um diese Einstellungen zu √§ndern.**

## Persistenz √ºber OAuth-Apps

Wenn Sie **das Konto eines Benutzers kompromittiert** haben, k√∂nnen Sie einfach zustimmen, alle m√∂glichen Berechtigungen an eine **OAuth-App** zu erteilen. Das einzige Problem ist, dass Workspace so konfiguriert werden kann, dass **nicht √ºberpr√ºfte externe und/oder interne OAuth-Apps nicht zugelassen sind.**\
Es ist ziemlich √ºblich, dass Workspace-Organisationen standardm√§√üig externen OAuth-Apps nicht vertrauen, internen jedoch vertrauen. Wenn Sie also **ausreichende Berechtigungen haben, um eine neue OAuth-Anwendung** innerhalb der Organisation zu generieren und externe Apps nicht zugelassen sind, generieren Sie diese und **verwenden Sie diese neue interne OAuth-App, um die Persistenz aufrechtzuerhalten.**

√úberpr√ºfen Sie die folgende Seite f√ºr weitere Informationen zu OAuth-Apps:

{% content-ref url="gws-google-platforms-phishing/" %}
[gws-google-platforms-phishing](gws-google-platforms-phishing/)
{% endcontent-ref %}

## Persistenz √ºber Delegation

Sie k√∂nnen einfach das Konto an ein anderes Konto delegieren, das vom Angreifer kontrolliert wird (sofern dies erlaubt ist). In Workspace-**Organisationen** muss diese Option **aktiviert** sein. Sie kann f√ºr alle deaktiviert, f√ºr einige Benutzer/Gruppen aktiviert oder f√ºr alle (normalerweise nur f√ºr einige Benutzer/Gruppen oder vollst√§ndig deaktiviert) aktiviert sein.

<details>

<summary>Wenn Sie ein Workspace-Administrator sind, √ºberpr√ºfen Sie dies, um die Funktion zu aktivieren</summary>

(Informationen [aus den Dokumenten kopiert](https://support.google.com/a/answer/7223765))

Als Administrator Ihrer Organisation (z. B. Ihrer Arbeit oder Schule) kontrollieren Sie, ob Benutzer den Zugriff auf ihr Gmail-Konto delegieren k√∂nnen. Sie k√∂nnen allen die M√∂glichkeit geben, ihr Konto zu delegieren. Oder nur Personen in bestimmten Abteilungen die Einrichtung der Delegation erlauben. Zum Beispiel k√∂nnen Sie:

* Einen Verwaltungsassistenten als Delegierten in Ihrem Gmail-Konto hinzuf√ºgen, damit er E-Mails in Ihrem Auftrag lesen und senden kann.&#x20;
* Eine Gruppe, wie z. B. Ihre Verkaufsabteilung, in Gruppen als Delegierten hinzuf√ºgen, um allen Zugriff auf ein Gmail-Konto zu gew√§hren.

Benutzer k√∂nnen nur einem anderen Benutzer in derselben Organisation Zugriff delegieren, unabh√§ngig von ihrer Domain oder ihrer organisatorischen Einheit.

### Delegationsgrenzen & Einschr√§nkungen&#x20;

* **Benutzern erlauben, ihrem Postfachzugriff auf eine Google-Gruppe zu gew√§hren**-Option: Um diese Option zu verwenden, muss sie f√ºr die OU des delegierten Kontos und f√ºr die OU jedes Gruppenmitglieds aktiviert sein. Gruppenmitglieder, die zu einer OU geh√∂ren, in der diese Option nicht aktiviert ist, k√∂nnen nicht auf das delegierte Konto zugreifen.
* Bei typischer Verwendung k√∂nnen 40 delegierte Benutzer gleichzeitig auf ein Gmail-Konto zugreifen. √úberdurchschnittliche Nutzung durch einen oder mehrere Delegierte kann diese Zahl reduzieren.&#x20;
* Automatisierte Prozesse, die h√§ufig auf Gmail zugreifen, k√∂nnen ebenfalls die Anzahl der Delegierten reduzieren, die gleichzeitig auf ein Konto zugreifen k√∂nnen. Diese Prozesse umfassen APIs oder Browsererweiterungen, die h√§ufig auf Gmail zugreifen.
* Ein einzelnes Gmail-Konto unterst√ºtzt bis zu 1.000 eindeutige Delegierte. Eine Gruppe in Gruppen z√§hlt als ein Delegierter f√ºr das Limit.
* Delegation erh√∂ht nicht die Grenzen f√ºr ein Gmail-Konto. Gmail-Konten mit delegierten Benutzern haben die standardm√§√üigen Gmail-Kontogrenzen und -richtlinien. Weitere Informationen finden Sie unter [Gmail-Grenzen und -Richtlinien](https://support.google.com/a/topic/28609).
### Schritt 1: Aktivieren Sie die Gmail-Delegation f√ºr Ihre Benutzer&#x20;

**Bevor Sie beginnen:** Um die Einstellung f√ºr bestimmte Benutzer anzuwenden, platzieren Sie ihre Konten in einer [organisatorischen Einheit](https://support.google.com/a/topic/1227584).

1. Melden Sie sich in Ihrem [Google Admin-Konsole](https://admin.google.com/) an.

Melden Sie sich mit einem _Administrator-Konto_ an, nicht mit Ihrem aktuellen Konto CarlosPolop@gmail.com
2. Gehen Sie in der Admin-Konsole zu Men√º ![](https://storage.googleapis.com/support-kms-prod/JxKYG9DqcsormHflJJ8Z8bHuyVI5YheC0lAp)![und dann](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)![](https://storage.googleapis.com/support-kms-prod/ocGtUSENh4QebLpvZcmLcNRZyaTBcolMRSyl) **Apps**![und dann](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Google Workspace**![und dann](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Gmail**![und dann](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Benutzereinstellungen**.
3. Um die Einstellung auf alle anzuwenden, lassen Sie die oberste organisatorische Einheit ausgew√§hlt. Andernfalls w√§hlen Sie eine untergeordnete [organisatorische Einheit](https://support.google.com/a/topic/1227584).
4. Klicken Sie auf **Mail-Delegation**.
5. Aktivieren Sie das Kontrollk√§stchen **Benutzern erlauben, anderen Benutzern in der Dom√§ne den Zugriff auf ihr Postfach zu delegieren**.
6. (Optional) Um Benutzern zu erm√∂glichen, anzugeben, welche Absenderinformationen in delegierten Nachrichten enthalten sind, aktivieren Sie das Kontrollk√§stchen **Benutzern erlauben, diese Einstellung anzupassen**.
7. W√§hlen Sie eine Option f√ºr die standardm√§√üig enthaltenen Absenderinformationen in Nachrichten, die von Delegierten gesendet werden:&#x20;
* **Zeigen Sie den Kontoinhaber und den Delegierten, der die E-Mail gesendet hat**‚ÄîNachrichten enthalten die E-Mail-Adressen des Gmail-Kontoinhabers und des Delegierten.
* **Nur den Kontoinhaber anzeigen**‚ÄîNachrichten enthalten nur die E-Mail-Adresse des Gmail-Kontoinhabers. Die E-Mail-Adresse des Delegierten wird nicht angezeigt.
8. (Optional) Um Benutzern das Hinzuf√ºgen einer Gruppe in Gruppen als Delegierten zu erm√∂glichen, aktivieren Sie das Kontrollk√§stchen **Benutzern erlauben, ihrer Mailbox den Zugriff auf eine Google-Gruppe zu gew√§hren**.
9. Klicken Sie auf **Speichern**. Wenn Sie eine untergeordnete organisatorische Einheit konfiguriert haben, k√∂nnen Sie m√∂glicherweise die Einstellungen einer √ºbergeordneten organisatorischen Einheit **vererben** oder **√ºberschreiben**.
10. (Optional) Um die Gmail-Delegation f√ºr andere organisatorische Einheiten zu aktivieren, wiederholen Sie die Schritte 3‚Äì9.

√Ñnderungen k√∂nnen bis zu 24 Stunden dauern, erfolgen jedoch normalerweise schneller. [Weitere Informationen](https://support.google.com/a/answer/7514107)

### Schritt 2: Benutzer bitten, Delegierte f√ºr ihre Konten einzurichten

Nachdem Sie die Delegation aktiviert haben, gehen Ihre Benutzer zu ihren Gmail-Einstellungen, um Delegierte zuzuweisen. Delegierte k√∂nnen dann Nachrichten im Auftrag des Benutzers lesen, senden und empfangen. &#x20;

Weisen Sie Benutzer f√ºr weitere Details auf [Delegieren und Zusammenarbeiten bei E-Mails](https://support.google.com/a/users/answer/138350) hin.

</details>

<details>

<summary>Von einem regul√§ren Benutzer aus √ºberpr√ºfen Sie hier die Anweisungen, um zu versuchen, Ihren Zugriff zu delegieren</summary>

(Informationen kopiert [**aus den Dokumenten**](https://support.google.com/mail/answer/138350))

Sie k√∂nnen bis zu 10 Delegierte hinzuf√ºgen.

Wenn Sie Gmail √ºber Ihre Arbeit, Schule oder eine andere Organisation verwenden:

* Sie k√∂nnen bis zu 1000 Delegierte innerhalb Ihrer Organisation hinzuf√ºgen.
* Bei typischer Verwendung k√∂nnen 40 Delegierte gleichzeitig auf ein Gmail-Konto zugreifen.&#x20;
* Wenn Sie automatisierte Prozesse wie APIs oder Browsererweiterungen verwenden, k√∂nnen einige Delegierte gleichzeitig auf ein Gmail-Konto zugreifen.

1. √ñffnen Sie auf Ihrem Computer [Gmail](https://mail.google.com/). Sie k√∂nnen keine Delegierten aus der Gmail-App hinzuf√ºgen.
2. Klicken Sie oben rechts auf Einstellungen ![Einstellungen](https://lh3.googleusercontent.com/p3J-ZSPOLtuBBR\_ofWTFDfdgAYQgi8mR5c76ie8XQ2wjegk7-yyU5zdRVHKybQgUlQ=w36-h36) ![und dann](https://lh3.googleusercontent.com/3\_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36) **Alle Einstellungen anzeigen**.
3. Klicken Sie auf den Tab **Konten und Import** oder **Konten**.
4. Klicken Sie im Abschnitt "Zugriff auf Ihr Konto gew√§hren" auf **Ein weiteres Konto hinzuf√ºgen**. Wenn Sie Gmail √ºber Ihre Arbeit oder Schule verwenden, kann Ihre Organisation die E-Mail-Delegation einschr√§nken. Wenn Sie diese Einstellung nicht sehen, wenden Sie sich an Ihren Administrator.
* Wenn Sie "Zugriff auf Ihr Konto gew√§hren" nicht sehen, ist es eingeschr√§nkt.
5. Geben Sie die E-Mail-Adresse der Person ein, die Sie hinzuf√ºgen m√∂chten. Wenn Sie Gmail √ºber Ihre Arbeit, Schule oder eine andere Organisation verwenden und Ihr Administrator dies zul√§sst, k√∂nnen Sie die E-Mail-Adresse einer Gruppe eingeben. Diese Gruppe muss die gleiche Dom√§ne wie Ihre Organisation haben. Externe Mitglieder der Gruppe haben keinen Delegationszugriff. \
\
**Wichtig:** Wenn das Konto, das Sie delegieren, ein neues Konto ist oder das Passwort zur√ºckgesetzt wurde, muss der Administrator die Anforderung zum √Ñndern des Passworts beim ersten Anmelden deaktivieren.

* [Erfahren Sie, wie ein Administrator einen Benutzer erstellen kann](https://support.google.com/a/answer/33310).
* [Erfahren Sie, wie ein Administrator Passw√∂rter zur√ºcksetzen kann](https://support.google.com/a/answer/33319).

6\. Klicken Sie auf **N√§chster Schritt** ![und dann](https://lh3.googleusercontent.com/QbWcYKta5vh\_4-OgUeFmK-JOB0YgLLoGh69P478nE6mKdfpWQniiBabjF7FVoCVXI0g=h36) **E-Mail senden, um Zugriff zu gew√§hren**.

Die Person, die Sie hinzugef√ºgt haben, erh√§lt eine E-Mail mit der Bitte um Best√§tigung. Die Einladung l√§uft nach einer Woche ab.

Wenn Sie eine Gruppe hinzugef√ºgt haben, werden alle Gruppenmitglieder Delegierte, ohne dass sie best√§tigen m√ºssen.&#x20;

Hinweis: Es kann bis zu 24 Stunden dauern, bis die Delegation wirksam wird.

</details>

## Persistenz √ºber Android-App

Wenn Sie eine **Sitzung im Google-Konto des Opfers haben**, k√∂nnen Sie zum **Play Store** gehen und m√∂glicherweise **Malware installieren**, die Sie bereits im Store hochgeladen haben, direkt **auf das Telefon**, um die Persistenz aufrechtzuerhalten und auf das Telefon des Opfers zuzugreifen.

## **Persistenz √ºber** App-Skripte

Sie k√∂nnen **zeitgesteuerte Trigger** in App-Skripten erstellen, sodass das App-Skript ausgel√∂st wird, selbst wenn der Benutzer nicht darauf zugreift. Weitere Informationen dazu finden Sie unter:

{% content-ref url="gws-google-platforms-phishing/gws-app-scripts.md" %}
[gws-app-scripts.md](gws-google-platforms-phishing/gws-app-scripts.md)
{% endcontent-ref %}

## Referenzen

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hacking G Suite: The Power of Dark Apps Script Magic
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch und Beau Bullock - OK Google, How do I Red Team GSuite?

{% hint style="success" %}
Lernen Sie & √ºben Sie AWS-Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen Sie & √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie Pull Requests an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) **und** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **GitHub-Repositorys senden.**

</details>
{% endhint %}
