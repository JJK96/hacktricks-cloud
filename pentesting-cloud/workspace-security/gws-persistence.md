# GWS - Trwałość

{% hint style="success" %}
Dowiedz się i ćwicz Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Dowiedz się i ćwicz Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* Sprawdź [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Udostępnij sztuczki hakerskie, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriów na GitHubie.

</details>
{% endhint %}

{% hint style="danger" %}
Wszystkie działania wymienione w tej sekcji, które zmieniają ustawienia, spowodują **alert bezpieczeństwa na e-mail i nawet powiadomienie push na dowolny zsynchronizowany telefon komórkowy** z kontem.
{% endhint %}

## **Trwałość w Gmailu**

* Możesz utworzyć **filtry, aby ukryć** powiadomienia o bezpieczeństwie od Google
* `from: (no-reply@accounts.google.com) "Security Alert"`
* To zapobiegnie dotarciu e-maili z powiadomieniami o bezpieczeństwie do skrzynki e-mailowej (ale nie zapobiegnie powiadomieniom push na telefonie komórkowym)

<details>

<summary>Kroki do utworzenia filtra w Gmailu</summary>

(Instrukcje z [**tutaj**](https://support.google.com/mail/answer/6579))

1. Otwórz [Gmail](https://mail.google.com/).
2. W polu wyszukiwania na górze kliknij Pokaż opcje wyszukiwania ![photos tune](https://lh3.googleusercontent.com/cD6YR\_YvqXqNKxrWn2NAWkV6tjJtg8vfvqijKT1\_9zVCrl2sAx9jROKhLqiHo2ZDYTE=w36) .
3. Wprowadź kryteria wyszukiwania. Jeśli chcesz sprawdzić, czy wyszukiwanie działa poprawnie, zobacz, jakie e-maile się pojawiają, klikając **Szukaj**.&#x20;
4. Na dole okna wyszukiwania kliknij **Utwórz filtr**.
5. Wybierz, co chcesz, aby filtr robił.
6. Kliknij **Utwórz filtr**.

Sprawdź swoje obecne filtry (aby je usunąć) w [https://mail.google.com/mail/u/0/#settings/filters](https://mail.google.com/mail/u/0/#settings/filters)

</details>

<figure><img src="../../.gitbook/assets/image (331).png" alt=""><figcaption></figcaption></figure>

* Utwórz **adres przekierowania do przekazywania wrażliwych informacji** (lub wszystkiego) - Potrzebujesz ręcznego dostępu.
* Utwórz adres przekierowania w [https://mail.google.com/mail/u/2/#settings/fwdandpop](https://mail.google.com/mail/u/2/#settings/fwdandpop)
* Adres odbiorczy będzie musiał to potwierdzić
* Następnie ustaw przekazywanie wszystkich e-maili, zachowując kopię (pamiętaj, aby kliknąć Zapisz zmiany):

<figure><img src="../../.gitbook/assets/image (332).png" alt=""><figcaption></figcaption></figure>

Możliwe jest również utworzenie filtrów i przekazywanie tylko określonych e-maili na inny adres e-mail.

## Hasła aplikacji

Jeśli udało ci się **skompromitować sesję użytkownika Google** i użytkownik miał **2FA**, możesz **wygenerować** [**hasło aplikacji**](https://support.google.com/accounts/answer/185833?hl=en) (zobacz link, aby zobaczyć kroki). Zauważ, że **Hasła aplikacji nie są już zalecane przez Google i są odwoływane**, gdy użytkownik **zmienia hasło do konta Google.**

**Nawet jeśli masz otwartą sesję, będziesz musiał znać hasło użytkownika, aby utworzyć hasło aplikacji.**

{% hint style="info" %}
Hasła aplikacji mogą być **używane tylko z kontami, na których włączona jest weryfikacja dwuetapowa**.
{% endhint %}

## Zmiana 2-FA i podobne

Możliwe jest również **wyłączenie 2-FA lub zarejestrowanie nowego urządzenia** (lub numeru telefonu) na tej stronie [**https://myaccount.google.com/security**](https://myaccount.google.com/security)**.**\
**Możliwe jest również generowanie kluczy dostępu (dodawanie własnego urządzenia), zmiana hasła, dodawanie numerów telefonów do weryfikacji telefonów i odzyskiwania, zmiana e-maila odzyskiwania oraz zmiana pytań zabezpieczających).**

{% hint style="danger" %}
Aby **zapobiec dotarciu powiadomień push o bezpieczeństwie** do telefonu użytkownika, możesz **wylogować jego smartfon** (choć byłoby to dziwne), ponieważ nie możesz zalogować go ponownie stąd.

Możliwe jest również **lokalizowanie urządzenia.**
{% endhint %}

**Nawet jeśli masz otwartą sesję, będziesz musiał znać hasło użytkownika, aby zmienić te ustawienia.**

## Trwałość za pomocą aplikacji OAuth

Jeśli **skompromitowałeś konto użytkownika**, możesz po prostu **zaakceptować** udzielenie wszystkich możliwych uprawnień **aplikacji OAuth**. Jedynym problemem jest to, że Workspace może być skonfigurowane, aby **nie zezwalać na niezweryfikowane zewnętrzne i/lub wewnętrzne aplikacje OAuth.**\
Jest dość powszechne, że Organizacje Workspace domyślnie nie ufają zewnętrznym aplikacjom OAuth, ale ufają wewnętrznym, więc jeśli masz **wystarczające uprawnienia do wygenerowania nowej aplikacji OAuth** wewnątrz organizacji, a aplikacje zewnętrzne są niedozwolone, wygeneruj ją i **użyj tej nowej wewnętrznej aplikacji OAuth do utrzymania trwałości**.

Sprawdź następującą stronę, aby uzyskać więcej informacji na temat aplikacji OAuth:

{% content-ref url="gws-google-platforms-phishing/" %}
[gws-google-platforms-phishing](gws-google-platforms-phishing/)
{% endcontent-ref %}

## Trwałość poprzez delegację

Możesz po prostu **delegować konto** do innego konta kontrolowanego przez atakującego (jeśli masz do tego uprawnienia). W Organizacjach Workspace ta opcja musi być **włączona**. Może być wyłączona dla wszystkich, włączona dla niektórych użytkowników/grup lub dla wszystkich (zazwyczaj jest włączona tylko dla niektórych użytkowników/grup lub całkowicie wyłączona).

<details>

<summary>Jeśli jesteś administratorem Workspace, sprawdź to, aby włączyć funkcję</summary>

(Informacje [skopiowane z dokumentacji](https://support.google.com/a/answer/7223765))

Jako administrator dla swojej organizacji (na przykład twojej pracy lub szkoły), kontrolujesz, czy użytkownicy mogą delegować dostęp do swojego konta Gmail. Możesz pozwolić wszystkim na opcję delegowania swojego konta. Lub pozwól tylko osobom z określonych działów skonfigurować delegację. Na przykład, możesz:

* Dodać asystenta administracyjnego jako delegata do swojego konta Gmail, aby mógł czytać i wysyłać e-maile w twoim imieniu.&#x20;
* Dodać grupę, na przykład dział sprzedaży, w Grupach jako delegata, aby dać wszystkim dostęp do jednego konta Gmail.

Użytkownicy mogą delegować dostęp tylko do innego użytkownika w tej samej organizacji, niezależnie od ich domeny lub jednostki organizacyjnej.

### Ograniczenia i restrykcje delegacji&#x20;

* Opcja **Zezwalaj użytkownikom na udzielenie dostępu do swojej skrzynki pocztowej grupie Google**: Aby skorzystać z tej opcji, musi być włączona dla OU konta delegowanego oraz dla OU każdego członka grupy. Członkowie grupy należący do OU, w którym ta opcja nie jest włączona, nie mogą uzyskać dostępu do konta delegowanego.
* W typowym użyciu, 40 użytkowników delegowanych może uzyskać dostęp do konta Gmail jednocześnie. Powyżejprzeciętnego użycia przez jednego lub więcej delegatów może to ograniczyć liczbę.
* Procesy automatyczne, które często uzyskują dostęp do Gmaila, mogą również zmniejszyć liczbę delegatów, którzy mogą uzyskać dostęp do konta jednocześnie. Procesy te obejmują interfejsy API lub rozszerzenia przeglądarki, które często uzyskują dostęp do Gmaila.
* Jedno konto Gmail obsługuje do 1 000 unikalnych delegatów. Grupa w Grupach liczy się jako jeden delegat w kierunku limitu.
* Delegacja nie zwiększa limitów konta Gmail. Konta Gmail z użytkownikami delegowanymi mają standardowe limity i zasady konta Gmail. Aby uzyskać szczegółowe informacje, odwiedź [Limity i zasady Gmaila](https://support.google.com/a/topic/28609).
### Krok 1: Włącz delegację Gmail dla swoich użytkowników&#x20;

**Zanim zaczniesz:** Aby zastosować ustawienie dla określonych użytkowników, umieść ich konta w [jednostce organizacyjnej](https://support.google.com/a/topic/1227584).

1. [Zaloguj się](https://admin.google.com/) do swojej [konsoli administratora Google](https://support.google.com/a/answer/182076).

Zaloguj się za pomocą konta _administratora_, a nie swojego bieżącego konta CarlosPolop@gmail.com
2. W konsoli administratora przejdź do Menu ![](https://storage.googleapis.com/support-kms-prod/JxKYG9DqcsormHflJJ8Z8bHuyVI5YheC0lAp)![a następnie](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)![](https://storage.googleapis.com/support-kms-prod/ocGtUSENh4QebLpvZcmLcNRZyaTBcolMRSyl) **Aplikacje**![a następnie](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Google Workspace**![a następnie](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Gmail**![a następnie](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Ustawienia użytkownika**.
3. Aby zastosować ustawienie dla wszystkich, pozostaw wybraną najwyższą jednostkę organizacyjną. W przeciwnym razie wybierz podrzędną [jednostkę organizacyjną](https://support.google.com/a/topic/1227584).
4. Kliknij **Delegacja poczty**.
5. Zaznacz pole **Pozwól użytkownikom delegować dostęp do swojej skrzynki pocztowej innym użytkownikom w domenie**.
6. (Opcjonalnie) Aby umożliwić użytkownikom określenie, jakie informacje o nadawcy są zawarte w wiadomościach udostępnionych wysłanych z ich konta, zaznacz pole **Zezwalaj użytkownikom na dostosowanie tego ustawienia**.
7. Wybierz opcję domyślnych informacji o nadawcy zawartych w wiadomościach wysyłanych przez delegatów:&#x20;
* **Pokaż właściciela konta i delegata, który wysłał e-mail**—Wiadomości zawierają adresy e-mail właściciela konta Gmail i delegata.
* **Pokaż tylko właściciela konta**—Wiadomości zawierają adres e-mail tylko właściciela konta Gmail. Adres e-mail delegata nie jest uwzględniony.
8. (Opcjonalnie) Aby umożliwić użytkownikom dodanie grupy w Grupach jako delegata, zaznacz pole **Zezwalaj użytkownikom na udzielenie dostępu do swojej skrzynki pocztowej grupie Google**.
9. Kliknij **Zapisz**. Jeśli skonfigurowałeś jednostkę organizacyjną podrzędną, możesz **Odziedzicz** lub **Zastąp** ustawienia jednostki organizacyjnej nadrzędnej.
10. (Opcjonalnie) Aby włączyć delegację Gmail dla innych jednostek organizacyjnych, powtórz kroki 3–9.

Zmiany mogą zająć do 24 godzin, ale zazwyczaj zachodzą szybciej. [Dowiedz się więcej](https://support.google.com/a/answer/7514107)

### Krok 2: Umożliw użytkownikom ustawienie delegatów dla swoich kont

Po włączeniu delegacji, twoi użytkownicy przechodzą do ustawień Gmail, aby przypisać delegatów. Delegaci mogą wtedy czytać, wysyłać i odbierać wiadomości w imieniu użytkownika. &#x20;

Aby uzyskać szczegóły, skieruj użytkowników do [Delegowanie i współpraca w e-mailach](https://support.google.com/a/users/answer/138350).

</details>
* **Udostępniaj sztuczki hakerskie, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) **i** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **repozytoriów na Githubie.** 

</details>
{% endhint %}
