# GWS - Persistance

{% hint style="success" %}
Apprenez et pratiquez le piratage AWS :<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Formation HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez le piratage GCP : <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Formation HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
{% endhint %}

{% hint style="danger" %}
Toutes les actions mentionn√©es dans cette section qui modifient les param√®tres g√©n√©reront une **alerte de s√©curit√© par e-mail et m√™me une notification push √† tout mobile synchronis√©** avec le compte.
{% endhint %}

## **Persistance dans Gmail**

* Vous pouvez cr√©er des **filtres pour masquer** les notifications de s√©curit√© de Google
* `from: (no-reply@accounts.google.com) "Security Alert"`
* Cela emp√™chera les e-mails de s√©curit√© d'atteindre l'e-mail (mais ne pr√©viendra pas les notifications push sur le mobile)

<details>

<summary>√âtapes pour cr√©er un filtre Gmail</summary>

(Instructions provenant d'[**ici**](https://support.google.com/mail/answer/6579))

1. Ouvrez [Gmail](https://mail.google.com/).
2. Dans la zone de recherche en haut, cliquez sur Afficher les options de recherche ![photos tune](https://lh3.googleusercontent.com/cD6YR\_YvqXqNKxrWn2NAWkV6tjJtg8vfvqijKT1\_9zVCrl2sAx9jROKhLqiHo2ZDYTE=w36) .
3. Entrez vos crit√®res de recherche. Si vous voulez v√©rifier que votre recherche a fonctionn√© correctement, voyez quels e-mails apparaissent en cliquant sur **Rechercher**.&#x20;
4. En bas de la fen√™tre de recherche, cliquez sur **Cr√©er un filtre**.
5. Choisissez ce que vous souhaitez que le filtre fasse.
6. Cliquez sur **Cr√©er un filtre**.

V√©rifiez vos filtres actuels (pour les supprimer) sur [https://mail.google.com/mail/u/0/#settings/filters](https://mail.google.com/mail/u/0/#settings/filters)

</details>

<figure><img src="../../.gitbook/assets/image (331).png" alt=""><figcaption></figcaption></figure>

* Cr√©ez une **adresse de transfert pour transf√©rer des informations sensibles** (ou tout) - Vous avez besoin d'un acc√®s manuel.
* Cr√©ez une adresse de transfert dans [https://mail.google.com/mail/u/2/#settings/fwdandpop](https://mail.google.com/mail/u/2/#settings/fwdandpop)
* L'adresse de r√©ception devra confirmer cela
* Ensuite, configurez pour transf√©rer tous les e-mails tout en conservant une copie (n'oubliez pas de cliquer sur enregistrer les modifications) :

<figure><img src="../../.gitbook/assets/image (332).png" alt=""><figcaption></figcaption></figure>

Il est √©galement possible de cr√©er des filtres et de transf√©rer uniquement des e-mails sp√©cifiques √† l'autre adresse e-mail.

## Mots de passe d'application

Si vous avez r√©ussi √† **compromettre une session utilisateur Google** et que l'utilisateur avait **2FA**, vous pouvez **g√©n√©rer** un [**mot de passe d'application**](https://support.google.com/accounts/answer/185833?hl=fr) (suivez le lien pour voir les √©tapes). Notez que **Google ne recommande plus les mots de passe d'application et les r√©voque** lorsque l'utilisateur **change son mot de passe de compte Google.**

**M√™me si vous avez une session ouverte, vous devrez conna√Ætre le mot de passe de l'utilisateur pour cr√©er un mot de passe d'application.**

{% hint style="info" %}
Les mots de passe d'application ne peuvent √™tre utilis√©s qu'avec des comptes ayant la v√©rification en deux √©tapes activ√©e.
{% endhint %}

## Modifier l'authentification √† deux facteurs et similaire

Il est √©galement possible de **d√©sactiver l'authentification √† deux facteurs ou d'inscrire un nouveau p√©riph√©rique** (ou num√©ro de t√©l√©phone) sur cette page [**https://myaccount.google.com/security**](https://myaccount.google.com/security)**.**\
**Il est √©galement possible de g√©n√©rer des cl√©s d'acc√®s (ajouter votre propre appareil), de changer le mot de passe, d'ajouter des num√©ros de t√©l√©phone pour la v√©rification des t√©l√©phones et la r√©cup√©ration, de changer l'e-mail de r√©cup√©ration et de changer les questions de s√©curit√©).**

{% hint style="danger" %}
Pour **emp√™cher les notifications push de s√©curit√©** d'atteindre le t√©l√©phone de l'utilisateur, vous pourriez le **d√©connecter de son smartphone** (bien que cela soit √©trange) car vous ne pouvez pas le reconnecter √† partir d'ici.

Il est √©galement possible de **localiser l'appareil.**
{% endhint %}

**M√™me si vous avez une session ouverte, vous devrez conna√Ætre le mot de passe de l'utilisateur pour modifier ces param√®tres.**

## Persistance via les applications OAuth

Si vous avez **compromis le compte d'un utilisateur**, vous pouvez simplement **accepter** d'accorder toutes les autorisations possibles √† une **application OAuth**. Le seul probl√®me est que Workspace peut √™tre configur√© pour **interdire les applications OAuth externes et/ou internes non examin√©es.**\
Il est assez courant pour les organisations Workspace de ne pas faire confiance par d√©faut aux applications OAuth externes mais de faire confiance aux internes, donc si vous avez **suffisamment de permissions pour g√©n√©rer une nouvelle application OAuth** √† l'int√©rieur de l'organisation et que les applications externes sont interdites, g√©n√©rez-la et **utilisez cette nouvelle application OAuth interne pour maintenir la persistance**.

Consultez la page suivante pour plus d'informations sur les applications OAuth :

{% content-ref url="gws-google-platforms-phishing/" %}
[gws-google-platforms-phishing](gws-google-platforms-phishing/)
{% endcontent-ref %}

## Persistance via d√©l√©gation

Vous pouvez simplement **d√©l√©guer le compte** √† un compte diff√©rent contr√¥l√© par l'attaquant (si vous √™tes autoris√© √† le faire). Dans les **organisations Workspace**, cette option doit √™tre **activ√©e**. Elle peut √™tre d√©sactiv√©e pour tout le monde, activ√©e pour certains utilisateurs/groupes ou pour tout le monde (g√©n√©ralement elle est uniquement activ√©e pour certains utilisateurs/groupes ou compl√®tement d√©sactiv√©e).

<details>

<summary>Si vous √™tes un administrateur Workspace, consultez ceci pour activer la fonctionnalit√©</summary>

(Informations [copi√©es de la documentation](https://support.google.com/a/answer/7223765))

En tant qu'administrateur de votre organisation (par exemple, votre travail ou votre √©cole), vous contr√¥lez si les utilisateurs peuvent d√©l√©guer l'acc√®s √† leur compte Gmail. Vous pouvez permettre √† tout le monde d'avoir la possibilit√© de d√©l√©guer leur compte. Ou, permettre uniquement aux personnes de certains d√©partements de configurer la d√©l√©gation. Par exemple, vous pouvez :

* Ajouter un assistant administratif en tant que d√©l√©gu√© sur votre compte Gmail afin qu'il puisse lire et envoyer des e-mails en votre nom.&#x20;
* Ajouter un groupe, tel que votre service commercial, dans les Groupes en tant que d√©l√©gu√© pour donner √† tout le monde acc√®s √† un compte Gmail.

Les utilisateurs ne peuvent d√©l√©guer l'acc√®s qu'√† un autre utilisateur de la m√™me organisation, ind√©pendamment de leur domaine ou de leur unit√© organisationnelle.

### Limites et restrictions de la d√©l√©gation&#x20;

* Option **Autoriser les utilisateurs √† accorder l'acc√®s √† leur bo√Æte aux lettres √† un groupe Google** : Pour utiliser cette option, elle doit √™tre activ√©e pour l'OU du compte d√©l√©gu√© et pour chaque OU des membres du groupe. Les membres du groupe appartenant √† une OU sans cette option activ√©e ne peuvent pas acc√©der au compte d√©l√©gu√©.
* Avec une utilisation typique, 40 utilisateurs d√©l√©gu√©s peuvent acc√©der √† un compte Gmail en m√™me temps. Une utilisation sup√©rieure √† la moyenne par un ou plusieurs d√©l√©gu√©s pourrait r√©duire ce nombre.&#x20;
* Les processus automatis√©s qui acc√®dent fr√©quemment √† Gmail pourraient √©galement r√©duire le nombre de d√©l√©gu√©s pouvant acc√©der √† un compte en m√™me temps. Ces processus incluent les API ou les extensions de navigateur qui acc√®dent fr√©quemment √† Gmail.
* Un seul compte Gmail prend en charge jusqu'√† 1 000 d√©l√©gu√©s uniques. Un groupe dans les Groupes compte comme un d√©l√©gu√© vers la limite.
* La d√©l√©gation n'augmente pas les limites d'un compte Gmail. Les comptes Gmail avec des utilisateurs d√©l√©gu√©s ont les limites et politiques standard des comptes Gmail. Pour plus de d√©tails, visitez [Limites et politiques Gmail](https://support.google.com/a/topic/28609).
### √âtape 1: Activer la d√©l√©gation Gmail pour vos utilisateurs&#x20;

**Avant de commencer :** Pour appliquer le param√®tre √† certains utilisateurs, placez leurs comptes dans une [unit√© organisationnelle](https://support.google.com/a/topic/1227584).

1.  [Connectez-vous](https://admin.google.com/) √† votre [console d'administration Google](https://support.google.com/a/answer/182076).

Connectez-vous en utilisant un _compte administrateur_, pas votre compte actuel CarlosPolop@gmail.com
2. Dans la console d'administration, acc√©dez √† Menu ![](https://storage.googleapis.com/support-kms-prod/JxKYG9DqcsormHflJJ8Z8bHuyVI5YheC0lAp)![puis](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)![](https://storage.googleapis.com/support-kms-prod/ocGtUSENh4QebLpvZcmLcNRZyaTBcolMRSyl) **Applications**![puis](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Google Workspace**![puis](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Gmail**![puis](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Param√®tres utilisateur**.
3. Pour appliquer le param√®tre √† tout le monde, laissez l'unit√© organisationnelle sup√©rieure s√©lectionn√©e. Sinon, s√©lectionnez une [unit√© organisationnelle enfant](https://support.google.com/a/topic/1227584).
4. Cliquez sur **D√©l√©gation de messagerie**.
5. Cochez la case **Permettre aux utilisateurs de d√©l√©guer l'acc√®s √† leur bo√Æte aux lettres √† d'autres utilisateurs du domaine**.
6. (Facultatif) Pour permettre aux utilisateurs de sp√©cifier les informations de l'exp√©diteur incluses dans les messages d√©l√©gu√©s envoy√©s depuis leur compte, cochez la case **Autoriser les utilisateurs √† personnaliser ce param√®tre**.
7. S√©lectionnez une option pour les informations de l'exp√©diteur par d√©faut incluses dans les messages envoy√©s par les d√©l√©gu√©s :&#x20;
* **Afficher le propri√©taire du compte et le d√©l√©gu√© ayant envoy√© l'e-mail**‚ÄîLes messages incluent les adresses e-mail du propri√©taire du compte Gmail et du d√©l√©gu√©.
* **Afficher uniquement le propri√©taire du compte**‚ÄîLes messages incluent l'adresse e-mail uniquement du propri√©taire du compte Gmail. L'adresse e-mail du d√©l√©gu√© n'est pas incluse.
8. (Facultatif) Pour permettre aux utilisateurs d'ajouter un groupe dans Groupes en tant que d√©l√©gu√©, cochez la case **Autoriser les utilisateurs √† accorder l'acc√®s √† leur bo√Æte aux lettres √† un groupe Google**.
9. Cliquez sur **Enregistrer**. Si vous avez configur√© une unit√© organisationnelle enfant, vous pourrez peut-√™tre **H√©riter** ou **Remplacer** les param√®tres d'une unit√© organisationnelle parente.
10. (Facultatif) Pour activer la d√©l√©gation Gmail pour d'autres unit√©s organisationnelles, r√©p√©tez les √©tapes 3 √† 9.

Les modifications peuvent prendre jusqu'√† 24 heures mais se produisent g√©n√©ralement plus rapidement. [En savoir plus](https://support.google.com/a/answer/7514107)

### √âtape 2: Demandez aux utilisateurs de configurer des d√©l√©gu√©s pour leurs comptes

Apr√®s avoir activ√© la d√©l√©gation, vos utilisateurs se rendent dans leurs param√®tres Gmail pour attribuer des d√©l√©gu√©s. Les d√©l√©gu√©s peuvent ensuite lire, envoyer et recevoir des messages au nom de l'utilisateur. &#x20;

Pour plus de d√©tails, dirigez les utilisateurs vers [D√©l√©guer et collaborer sur les e-mails](https://support.google.com/a/users/answer/138350).

</details>
* **Partagez des astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) **et** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **d√©p√¥ts GitHub.** 

</details>
{% endhint %}
