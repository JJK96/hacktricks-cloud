# GWS - Google Plattformen Phishing

{% hint style="success" %}
Lernen Sie & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen Sie & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys senden.

</details>
{% endhint %}

## Generische Phishing-Methodik

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology" %}

## Google Groups Phishing

Anscheinend k√∂nnen in Workspace-Mitglieder standardm√§√üig [**Gruppen erstellen**](https://groups.google.com/all-groups) **und Personen dazu einladen**. Sie k√∂nnen dann die E-Mail √§ndern, die an den Benutzer gesendet wird, **indem Sie einige Links hinzuf√ºgen**. Die **E-Mail wird von einer Google-Adresse stammen**, daher wird sie **seri√∂s aussehen** und die Leute k√∂nnten auf den Link klicken.

Es ist auch m√∂glich, die **VON**-Adresse als die **Google-Gruppen-E-Mail** festzulegen, um **mehr E-Mails an die Benutzer innerhalb der Gruppe zu senden**, wie im folgenden Bild, in dem die Gruppe **`google--support@googlegroups.com`** erstellt wurde und eine **E-Mail an alle Mitglieder** der Gruppe gesendet wurde (die ohne Zustimmung hinzugef√ºgt wurden)

<figure><img src="../../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

## Google Chat Phishing

Sie k√∂nnten entweder **einen Chat starten** mit einer Person, indem Sie nur deren E-Mail-Adresse haben, oder eine **Einladung zum Gespr√§ch senden**. Au√üerdem ist es m√∂glich, einen **Space zu erstellen**, der jeden Namen haben kann (z. B. "Google Support") und **Mitglieder dazu einladen**. Wenn sie akzeptieren, k√∂nnten sie denken, dass sie mit dem Google-Support sprechen:

<figure><img src="../../../.gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
**In meinen Tests haben die eingeladenen Mitglieder jedoch nicht einmal eine Einladung erhalten.**
{% endhint %}

Sie k√∂nnen sehen, wie dies in der Vergangenheit funktioniert hat unter: [https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s](https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s)

## Google Doc Phishing

Fr√ºher war es m√∂glich, ein **scheinbar legitimes Dokument zu erstellen** und in einem Kommentar **eine E-Mail zu erw√§hnen (wie @user@gmail.com)**. Google **hat eine E-Mail an diese E-Mail-Adresse gesendet**, um sie dar√ºber zu informieren, dass sie in dem Dokument erw√§hnt wurden.\
Heutzutage funktioniert dies nicht mehr, aber wenn Sie dem Opfer E-Mail-Zugriff auf das Dokument geben, wird Google eine E-Mail senden, die dies anzeigt. Dies ist die Nachricht, die erscheint, wenn Sie jemanden erw√§hnen:

<figure><img src="../../../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Opfer k√∂nnten Schutzmechanismen haben, die verhindern, dass E-Mails, die darauf hinweisen, dass ein externes Dokument mit ihnen geteilt wurde, ihre E-Mail erreichen.
{% endhint %}

## Google Kalender Phishing

Sie k√∂nnen **eine Kalenderveranstaltung erstellen** und so viele E-Mail-Adressen des Unternehmens, das Sie angreifen, hinzuf√ºgen, wie Sie haben. Planen Sie diese Kalenderveranstaltung in **5 oder 15 Minuten** ab der aktuellen Zeit. Gestalten Sie die Veranstaltung seri√∂s und **geben Sie einen Kommentar und einen Titel an, der darauf hinweist, dass sie etwas lesen m√ºssen** (mit dem **Phishing-Link**).

Dies ist die Warnung, die im Browser mit einem Besprechungstitel "Mitarbeiter entlassen" angezeigt wird, daher k√∂nnten Sie einen eher phishingartigen Titel festlegen (und sogar den Namen √§ndern, der mit Ihrer E-Mail verkn√ºpft ist).

<figure><img src="../../../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure>

Um es weniger verd√§chtig aussehen zu lassen:

* Richten Sie es so ein, dass **Empf√§nger die anderen eingeladenen Personen nicht sehen k√∂nnen**
* **Senden Sie keine E-Mails, die √ºber die Veranstaltung informieren**. Dann sehen die Leute nur ihre Warnung √ºber eine Besprechung in 5 Minuten und dass sie diesen Link lesen m√ºssen.
* Anscheinend k√∂nnen Sie √ºber die API festlegen, dass **Personen** die Veranstaltung **akzeptiert** haben und sogar **Kommentare in ihrem Namen erstellen**.

## App Scripts Redirect Phishing

Es ist m√∂glich, ein Skript in [https://script.google.com/](https://script.google.com/) zu erstellen und es **als Webanwendung zug√§nglich f√ºr alle freizugeben**, die die legitime Domain **`script.google.com`** verwenden wird.  \
Dann k√∂nnte ein Angreifer mit etwas Code wie dem folgenden das Skript erstellen, das beliebige Inhalte auf dieser Seite l√§dt, ohne den Zugriff auf die Domain zu stoppen:

{% code overflow="wrap" %}
```javascript
function doGet() {
return HtmlService.createHtmlOutput('<meta http-equiv="refresh" content="0;url=https://cloud.hacktricks.xyz/pentesting-cloud/workspace-security/gws-google-platforms-phishing#app-scripts-redirect-phishing">')
.setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}
```
{% endcode %}

Zum Beispiel beim Zugriff auf [https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec](https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec) sehen Sie:

<figure><img src="../../../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Beachten Sie, dass eine Warnung angezeigt wird, da der Inhalt in einem iframe geladen wird.
{% endhint %}

## App Scripts OAuth Phishing

Es ist m√∂glich, App Scripts an Dokumente anzuh√§ngen, um zu versuchen, Zugriff auf das OAuth-Token eines Opfers zu erhalten. Weitere Informationen finden Sie unter:

{% content-ref url="gws-app-scripts.md" %}
[gws-app-scripts.md](gws-app-scripts.md)
{% endcontent-ref %}

## OAuth Apps Phishing

Eine der vorherigen Techniken kann verwendet werden, um den Benutzer dazu zu bringen, eine **Google OAuth-Anwendung** zu √∂ffnen, die den Benutzer um **Zugriff** bittet. Wenn der Benutzer der **Quelle** vertraut, k√∂nnte er auch der **Anwendung** vertrauen (auch wenn sie um Berechtigungen mit hohen Rechten bittet).

{% hint style="info" %}
Beachten Sie, dass Google in mehreren F√§llen eine h√§ssliche Aufforderung anzeigt, die darauf hinweist, dass die Anwendung nicht vertrauensw√ºrdig ist, und Workspace-Administratoren sogar verhindern k√∂nnen, dass Personen OAuth-Anwendungen akzeptieren.
{% endhint %}

**Google** erm√∂glicht die Erstellung von Anwendungen, die im Namen von Benutzern mit verschiedenen **Google-Diensten** interagieren k√∂nnen: Gmail, Drive, GCP...

Bei der Erstellung einer Anwendung, die im Namen anderer Benutzer agieren soll, muss der Entwickler eine **OAuth-App innerhalb von GCP** erstellen und die Bereiche (Berechtigungen) angeben, auf die die App zugreifen muss, um auf die Daten der Benutzer zuzugreifen.\
Wenn ein **Benutzer** diese **Anwendung verwenden** m√∂chte, wird er aufgefordert, zuzustimmen, dass die Anwendung Zugriff auf ihre in den Bereichen angegebenen Daten hat.

Dies ist eine sehr effektive Methode, um nicht-technische Benutzer dazu zu bringen, **Anwendungen zu verwenden, die auf sensible Informationen zugreifen**, da sie m√∂glicherweise nicht die Konsequenzen verstehen. In Organisationen gibt es jedoch M√∂glichkeiten, dies zu verhindern.

### Aufforderung f√ºr nicht verifizierte Apps

Wie bereits erw√§hnt, wird Google dem Benutzer immer eine **Aufforderung zur Zustimmung** der Berechtigungen anzeigen, die er der Anwendung im Namen des Benutzers erteilt. Wenn die Anwendung jedoch als **gef√§hrlich** eingestuft wird, zeigt Google zuerst eine **Aufforderung** an, die darauf hinweist, dass sie **gef√§hrlich** ist, und erschwert es dem Benutzer, der Anwendung Berechtigungen zu erteilen.

Diese Aufforderung erscheint in Apps, die:

* Einen Bereich verwenden, der auf private Daten zugreifen kann (Gmail, Drive, GCP, BigQuery...)
* Apps mit weniger als 100 Benutzern (f√ºr Apps > 100 ist auch ein √úberpr√ºfungsprozess erforderlich, um die Anzeige der nicht verifizierten Aufforderung zu stoppen)

### Interessante Bereiche

[**Hier**](https://developers.google.com/identity/protocols/oauth2/scopes) finden Sie eine Liste aller Google OAuth-Bereiche.

* **cloud-platform**: Anzeigen und Verwalten Ihrer Daten √ºber verschiedene **Google Cloud Platform**-Dienste. Sie k√∂nnen den Benutzer in GCP darstellen.
* **admin.directory.user.readonly**: Sehen und Herunterladen des GSuite-Verzeichnisses Ihrer Organisation. Erhalten Sie Namen, Telefonnummern, Kalender-URLs aller Benutzer.

### Erstellen einer OAuth-App

**Beginnen Sie mit der Erstellung einer OAuth-Client-ID**

1. Gehen Sie zu [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient) und klicken Sie auf die Konfiguration des Zustimmungsbildschirms.
2. Dann werden Sie gefragt, ob der **Benutzertyp** **intern** (nur f√ºr Personen in Ihrer Organisation) oder **extern** ist. W√§hlen Sie die Option, die Ihren Anforderungen entspricht.
* Intern k√∂nnte interessant sein, wenn Sie bereits einen Benutzer der Organisation kompromittiert haben und diese App erstellen, um einen anderen zu phishen.
3. Geben Sie der App einen **Namen**, eine **Support-E-Mail** (beachten Sie, dass Sie eine Googlegroup-E-Mail angeben k√∂nnen, um sich etwas mehr zu anonymisieren), ein **Logo**, **autorisierte Domains** und eine andere **E-Mail** f√ºr **Updates**.
4. **W√§hlen Sie** die **OAuth-Bereiche** aus.
* Diese Seite ist in nicht sensible Berechtigungen, sensible Berechtigungen und eingeschr√§nkte Berechtigungen unterteilt. Jedes Mal, wenn Sie eine neue Berechtigung hinzuf√ºgen, wird sie in ihrer Kategorie hinzugef√ºgt. Je nach angeforderten Berechtigungen erscheint dem Benutzer eine andere Aufforderung, die anzeigt, wie sensibel diese Berechtigungen sind.
* Sowohl **`admin.directory.user.readonly`** als auch **`cloud-platform`** sind sensible Berechtigungen.
5. **F√ºgen Sie die Testbenutzer hinzu.** Solange der Status der App im Testmodus ist, k√∂nnen nur diese Benutzer auf die App zugreifen. Stellen Sie also sicher, dass Sie die E-Mail hinzuf√ºgen, die Sie phishen werden.

Lassen Sie uns nun **Anmeldeinformationen f√ºr eine Webanwendung** mit der **zuvor erstellten OAuth-Client-ID** erhalten:

1. Gehen Sie zur√ºck zu [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient), diesmal wird eine andere Option angezeigt.
2. W√§hlen Sie aus, um **Anmeldeinformationen f√ºr eine Webanwendung zu erstellen**.
3. Legen Sie die erforderlichen **Javascript-Urspr√ºnge** und **Weiterleitungs-URIs** fest.
* Sie k√∂nnen in beiden etwas wie **`http://localhost:8000/callback`** f√ºr Tests festlegen.
4. Holen Sie sich Ihre Anwendungs-**Anmeldeinformationen**.

Schlie√ülich lassen Sie uns eine **Webanwendung ausf√ºhren, die die Anmeldeinformationen der OAuth-Anwendung verwendet**. Ein Beispiel finden Sie unter [https://github.com/carlospolop/gcp\_oauth\_phishing\_example](https://github.com/carlospolop/gcp\_oauth\_phishing\_example).
```bash
git clone ttps://github.com/carlospolop/gcp_oauth_phishing_example
cd gcp_oauth_phishing_example
pip install flask requests google-auth-oauthlib
python3 app.py --client-id "<client_id>" --client-secret "<client_secret>"
```
Gehe zu **`http://localhost:8000`**, klicke auf die Schaltfl√§che "Mit Google anmelden", es wird eine Meldung wie diese angezeigt:

<figure><img src="../../../.gitbook/assets/image (333).png" alt=""><figcaption></figcaption></figure>

Die Anwendung zeigt den **Zugriffs- und Auffrischungstoken** an, die leicht verwendet werden k√∂nnen. F√ºr weitere Informationen dar√ºber, **wie man diese Tokens verwendet, siehe**:

{% content-ref url="../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md" %}
[gcp-non-svc-persistance.md](../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md)
{% endcontent-ref %}

#### Mit `gcloud` verwenden

Es ist m√∂glich, etwas mit gcloud anstelle der Webkonsole zu tun, siehe:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md" %}
[gcp-clientauthconfig-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md)
{% endcontent-ref %}

## Referenzen

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hacking G Suite: The Power of Dark Apps Script Magic
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch und Beau Bullock - OK Google, How do I Red Team GSuite?

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Trete der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositories einreichst.

</details>
{% endhint %}
