# GWS - Google Platforms Phishing

{% hint style="success" %}
Μάθε & εξάσκησε το Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθε & εξάσκησε το Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστήριξε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 [**στην ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ κάνοντας υποβολή PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Γενική Μεθοδολογία Phishing

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology" %}

## Google Groups Phishing

Φαίνεται ότι, από προεπιλογή, στα μέλη του workspace [**μπορούν να δημιουργήσουν ομάδες**](https://groups.google.com/all-groups) **και να προσκαλέσουν άτομα σε αυτές**. Στη συνέχεια, μπορείτε να τροποποιήσετε το email που θα σταλεί στον χρήστη **προσθέτοντας μερικούς συνδέσμους**. Το **email θα έρθει από μια διεύθυνση google**, οπότε θα φαίνεται **αξιόπιστο** και οι άνθρωποι μπορεί να κάνουν κλικ στον σύνδεσμο.

Είναι επίσης δυνατό να ορίσετε τη διεύθυνση **ΑΠΟ** ως το **email της Google ομάδας** για να στείλετε **περισσότερα emails στους χρήστες μέσα στην ομάδα**, όπως στην παρακάτω εικόνα όπου δημιουργήθηκε η ομάδα **`google--support@googlegroups.com`** και στάλθηκε ένα **email σε όλα τα μέλη** της ομάδας (που προστέθηκαν χωρίς καμία συγκατάθεση)

<figure><img src="../../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

## Google Chat Phishing

Μπορείτε είτε να **ξεκινήσετε μια συνομιλία** με ένα άτομο απλά έχοντας τη διεύθυνση email τους είτε να στείλετε μια **πρόσκληση για συνομιλία**. Επιπλέον, είναι δυνατόν να **δημιουργήσετε έναν Χώρο** που μπορεί να έχει οποιοδήποτε όνομα (π.χ. "Υποστήριξη Google") και **να προσκαλέσετε** μέλη σε αυτόν. Αν το αποδεχτούν, μπορεί να νομίζουν ότι συνομιλούν με την Υποστήριξη της Google:

<figure><img src="../../../.gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
**Ωστόσο, στις δοκιμές μου, τα προσκεκλημένα μέλη δεν έλαβαν καν πρόσκληση.**
{% endhint %}

Μπορείτε να ελέγξετε πώς λειτούργησε αυτό στο παρελθόν στο: [https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s](https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s)

## Google Doc Phishing

Στο παρελθόν ήταν δυνατό να δημιουργήσετε ένα **φαινομενικά νόμιμο έγγραφο** και σε ένα σχόλιο **να αναφέρετε κάποιο email (όπως @user@gmail.com)**. Η Google **έστελνε ένα email σε αυτή τη διεύθυνση email** ειδοποιώντας ότι αναφέρθηκαν στο έγγραφο.\
Σήμερα, αυτό δεν λειτουργεί, αλλά αν **δώσετε πρόσβαση στο έγγραφο στο θύμα** η Google θα στείλει ένα email που το υποδεικνύει. Αυτό είναι το μήνυμα που εμφανίζεται όταν αναφέρετε κάποιον:

<figure><img src="../../../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Τα θύματα μπορεί να έχουν μηχανισμούς προστασίας που δεν επιτρέπουν σε αυτά τα emails που υποδεικνύουν ότι ένα εξωτερικό έγγραφο κοινοποιήθηκε μαζί τους να φτάσουν στο email τους.
{% endhint %}

## Google Calendar Phishing

Μπορείτε να **δημιουργήσετε ένα γεγονός στο ημερολόγιο** και να προσθέσετε τόσες διευθύνσεις email της εταιρείας που επιτίθεστε όσες έχετε. Προγραμματίστε αυτό το γεγονός στα **5 ή 15 λεπτά** από την τρέχουσα ώρα. Κάντε το γεγονός να φαίνεται αξιόπιστο και **βάλτε ένα σχόλιο και έναν τίτλο που υποδηλώνει ότι πρέπει να διαβάσουν κάτι** (με τον **σύνδεσμο phishing**).

Αυτή είναι η ειδοποίηση που θα εμφανιστεί στο πρόγραμμα περιήγησης με τίτλο συνάντησης "Απόλυση Ατόμων", οπότε θα μπορούσατε να ορίσετε έναν πιο φαινομενικό τίτλο phishing (και ακόμα να αλλάξετε το όνομα που συσχετίζεται με το email σας).

<figure><img src="../../../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure>

Για να φαίνεται λιγότερο ύποπτο:

* Ορίστε το έτσι ώστε **οι παραλήπτες να μην μπορούν να δουν τα άλλα άτομα που προσκλήθηκαν**
* **ΜΗΝ στέλνετε emails ειδοποίησης για το γεγονός**. Έτσι, οι άνθρωποι θα δουν μόνο την προειδοποίησή τους για μια συνάντηση σε 5 λεπτά και ότι πρέπει να διαβάσουν αυτόν τον σύνδεσμο.
* Φαίνεται ότι χρησιμοποιώντας το API μπορείτε να ορίσετε σε **Αληθές** ότι οι **άνθρωποι** έχουν **αποδεχτεί** το γεγονός και ακόμα να δημιουργήσετε **σχόλια εκ μέρους τους**.

## Ανακατευθύνσεις Phishing των App Scripts

Είναι δυνατό να δημιουργήσετε ένα σενάριο στο [https://script.google.com/](https://script.google.com/) και **να το εκθέσετε ως μια web εφαρμογή προσβάσιμη από όλους** που θα χρησιμοποιεί το αξιόπιστο domain **`script.google.com`**.  \
Έπειτα, με κάποιον κώδικα όπως ο παρακάτω, ένας επιτιθέμενος θα μπορούσε να κάνει το σενάριο να φορτώνει αυθαίρετο περιεχόμενο σε αυτή τη σελίδα χωρίς να σταματάει να έχει πρόσβαση στο domain:

{% code overflow="wrap" %}
```javascript
function doGet() {
return HtmlService.createHtmlOutput('<meta http-equiv="refresh" content="0;url=https://cloud.hacktricks.xyz/pentesting-cloud/workspace-security/gws-google-platforms-phishing#app-scripts-redirect-phishing">')
.setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}
```
{% endcode %}

Για παράδειγμα, με την πρόσβαση [https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec](https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec) θα δείτε:

<figure><img src="../../../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Σημειώστε ότι θα εμφανιστεί ένα προειδοποιητικό μήνυμα καθώς το περιεχόμενο φορτώνεται μέσα σε ένα iframe.
{% endhint %}

## Αλιευτική μέθοδος OAuth App Scripts

Είναι δυνατόν να δημιουργηθούν App Scripts που συνδέονται με έγγραφα για να προσπαθήσουν να αποκτήσουν πρόσβαση στο OAuth τοκεν ενός θύματος, για περισσότερες πληροφορίες ελέγξτε:

{% content-ref url="gws-app-scripts.md" %}
[gws-app-scripts.md](gws-app-scripts.md)
{% endcontent-ref %}

## Αλιευτική μέθοδος OAuth Apps

Οποιαδήποτε από τις προηγούμενες τεχνικές μπορεί να χρησιμοποιηθεί για να κάνει ο χρήστης πρόσβαση σε μια **εφαρμογή Google OAuth** που θα ζητήσει από τον χρήστη κάποια **δικαιώματα πρόσβασης**. Αν ο χρήστης **εμπιστεύεται** την **πηγή**, μπορεί να **εμπιστευτεί** και την **εφαρμογή** (ακόμα κι αν ζητά υψηλά δικαιώματα πρόσβασης).

{% hint style="info" %}
Σημειώστε ότι η Google παρουσιάζει ένα ασχημοποιημένο προτρεπτικό που προειδοποιεί ότι η εφαρμογή δεν είναι αξιόπιστη σε πολλές περιπτώσεις και οι διαχειριστές του Workspace μπορούν ακόμα να εμποδίσουν τους ανθρώπους να αποδεχτούν εφαρμογές OAuth.
{% endhint %}

Η **Google** επιτρέπει τη δημιουργία εφαρμογών που μπορούν να **αλληλεπιδρούν εκ μέρους των χρηστών** με διάφορες **υπηρεσίες Google**: Gmail, Drive, GCP...

Όταν δημιουργείτε μια εφαρμογή για να **ενεργεί εκ μέρους άλλων χρηστών**, ο προγραμματιστής πρέπει να δημιουργήσει μια **εφαρμογή OAuth μέσα στο GCP** και να υποδείξει τις εμβέλειες (δικαιώματα) που χρειάζεται η εφαρμογή για να έχει πρόσβαση στα δεδομένα των χρηστών.\
Όταν ένας **χρήστης** θέλει να **χρησιμοποιήσει** αυτήν την **εφαρμογή**, θα του ζητηθεί να **αποδεχτεί** ότι η εφαρμογή θα έχει πρόσβαση στα δεδομένα του που καθορίζονται στις εμβέλειες.

Αυτός είναι ένας πολύ ελκυστικός τρόπος για να **αλιεύσετε** μη τεχνικούς χρήστες να χρησιμοποιήσουν **εφαρμογές που έχουν πρόσβαση σε ευαίσθητες πληροφορίες** επειδή ενδέχεται να μην κατανοούν τις συνέπειες. Ωστόσο, στους λογαριασμούς οργανισμών, υπάρχουν τρόποι για να αποτραπεί αυτό.

### Προτροπή για μη επαληθευμένη εφαρμογή

Όπως αναφέρθηκε, η Google θα παρουσιάσει πάντα μια **προτροπή στον χρήστη να αποδεχτεί** τα δικαιώματα που δίνει στην εφαρμογή εκ μέρους του. Ωστόσο, αν η εφαρμογή θεωρείται **επικίνδυνη**, η Google θα εμφανίσει **πρώτα** μια **προτροπή** που υποδεικνύει ότι είναι **επικίνδυνη** και **κάνοντας το πιο δύσκολο** για τον χρήστη να χορηγήσει τα δικαιώματα στην εφαρμογή.

Αυτή η προτροπή εμφανίζεται σε εφαρμογές που:

* Χρησιμοποιούν οποιαδήποτε εμβέλεια που μπορεί να έχει πρόσβαση σε ιδιωτικά δεδομένα (Gmail, Drive, GCP, BigQuery...)
* Εφαρμογές με λιγότερους από 100 χρήστες (για εφαρμογές > 100 απαιτείται επίσης διαδικασία αξιολόγησης για να σταματήσει η εμφάνιση της μη επαληθευμένης προτροπής)

### Ενδιαφέρουσες Εμβέλειες

[**Εδώ**](https://developers.google.com/identity/protocols/oauth2/scopes) μπορείτε να βρείτε μια λίστα με όλες τις εμβέλειες Google OAuth.

* **cloud-platform**: Προβολή και διαχείριση των δεδομένων σας σε όλες τις υπηρεσίες **Google Cloud Platform**. Μπορείτε να υποκαταστήσετε τον χρήστη στο GCP.
* **admin.directory.user.readonly**: Δείτε και κατεβάστε τον κατάλογο της GSuite οργάνωσής σας. Λάβετε ονόματα, τηλέφωνα, διευθύνσεις URL ημερολογίου όλων των χρηστών.

### Δημιουργία μιας Εφαρμογής OAuth

**Ξεκινήστε δημιουργώντας ένα OAuth Client ID**

1. Πηγαίνετε στο [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient) και κάντε κλικ στη ρύθμιση της οθόνης συγκατάθεσης.
2. Στη συνέχεια, θα σας ρωτήσουν αν ο **τύπος χρήστη** είναι **εσωτερικός** (μόνο για άτομα στον οργανισμό σας) ή **εξωτερικός**. Επιλέξτε αυτό που ταιριάζει στις ανάγκες σας
* Το εσωτερικό μπορεί να είναι ενδιαφέρον αν έχετε ήδη διαρρεύσει έναν χρήστη του οργανισμού και δημιουργείτε αυτήν την Εφαρμογή για να αλιεύσετε άλλον.
3. Δώστε ένα **όνομα** στην εφαρμογή, ένα **email υποστήριξης** (σημειώστε ότι μπορείτε να ορίσετε ένα email googlegroup για να προσπαθήσετε να ανωνυμοποιηθείτε λίγο περισσότερο), ένα **λογότυπο**, **εξουσιοδοτημένους τομείς** και ένα άλλο **email** για **ενημερώσεις**.
4. **Επιλέξτε** τις **εμβέλειες OAuth**.
* Αυτή η σελίδα είναι χωρισμένη σε μη ευαίσθητες άδειες, ευαίσθητες άδειες και περιορισμένες άδειες. Κάθε φορά που προσθέτετε μια νέα άδεια, προστίθεται στην κατηγορία της. Ανάλογα με τις ζητούμενες άδειες, θα εμφανιστεί διαφορετική προτροπή στον χρήστη που υποδεικνύει πόσο ευαίσθητες είναι αυτές οι άδειες.
* Και οι δύο **`admin.directory.user.readonly`** και **`cloud-platform`** είναι ευαίσθητες άδειες.
5. **Προσθέστε τους δοκιμαστικούς χρήστες.** Όσο η κατάσταση της εφαρμογής είναι σε δοκιμή, μόνο αυτοί οι χρήστες θα μπορούν να έχουν πρόσβαση στην εφαρμογή, οπότε βεβαιωθείτε ότι **προσθέτετε το email που θα αλιεύσετε**.

Τώρα ας **αποκτήσουμε διαπιστεύσεις για μια web εφαρμογή** χρησιμοποιώντας το **προηγουμένως δημιουργημένο OAuth Client ID**:

1. Πηγαίνετε πίσω στο [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient), αυτή τη φορά θα εμφανιστεί μια διαφορετική επιλογή.
2. Επιλέξτε να **δημιουργήσετε διαπιστεύσεις γ
```bash
git clone ttps://github.com/carlospolop/gcp_oauth_phishing_example
cd gcp_oauth_phishing_example
pip install flask requests google-auth-oauthlib
python3 app.py --client-id "<client_id>" --client-secret "<client_secret>"
```
Πηγαίνετε στο **`http://localhost:8000`** κάντε κλικ στο κουμπί Σύνδεση με το Google, θα σας **ζητηθεί** ένα μήνυμα σαν αυτό:

<figure><img src="../../../.gitbook/assets/image (333).png" alt=""><figcaption></figcaption></figure>

Η εφαρμογή θα εμφανίσει τα **token πρόσβασης και ανανέωσης** που μπορούν να χρησιμοποιηθούν εύκολα. Για περισσότερες πληροφορίες σχετικά με **πώς να χρησιμοποιήσετε αυτά τα tokens** ελέγξτε:

{% content-ref url="../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md" %}
[gcp-non-svc-persistance.md](../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md)
{% endcontent-ref %}

#### Χρησιμοποιώντας το `gcloud`

Είναι δυνατόν να κάνετε κάτι χρησιμοποιώντας το gcloud αντί για την ιστοσελίδα, ελέγξτε:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md" %}
[gcp-clientauthconfig-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md)
{% endcontent-ref %}

## Αναφορές

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hacking G Suite: The Power of Dark Apps Script Magic
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch και Beau Bullock - OK Google, How do I Red Team GSuite?

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 στην [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ κάνοντας υποβολή PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
