# AWS - Temel Bilgiler

{% hint style="success" %}
AWS Hacking öğren ve pratik yap:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking öğren ve pratik yap: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekle</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol et!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katıl veya bizi **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip et.**
* **HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına PR göndererek hacking ipuçlarını paylaş.

</details>
{% endhint %}

## Organizasyon Hiyerarşisi

![](<../../../.gitbook/assets/image (151).png>)

### Hesaplar

AWS'de, **tüm hesapların ana konteyneri olan bir **root hesabı** vardır. Ancak, kaynakları dağıtmak için bu hesabı kullanmanız gerekmez, **farklı AWS** altyapılarını birbirinden ayırmak için **başka hesaplar oluşturabilirsiniz**.

Bu, **güvenlik** açısından çok ilginçtir, çünkü **bir hesap diğer hesabın kaynaklarına erişemez** (özel köprüler oluşturulmadıkça), bu şekilde dağıtımlar arasında sınırlar oluşturabilirsiniz.

Bu nedenle, bir organizasyonda **iki tür hesap vardır** (AWS hesaplarından bahsediyoruz, Kullanıcı hesaplarından değil): yönetim hesabı olarak belirlenen tek bir hesap ve bir veya daha fazla üye hesap.

*   **Yönetim hesabı (root hesap)**, organizasyonu oluşturmak için kullandığınız hesaptır. Organizasyonun yönetim hesabından şunları yapabilirsiniz:

* Organizasyonda hesaplar oluşturun
* Diğer mevcut hesapları organizasyona davet edin
* Hesapları organizasyondan çıkarın
* Davetleri yönetin
* Organizasyon içindeki varlıklara (kökler, OU'lar veya hesaplar) politikalar uygulayın
* Tüm organizasyon hesaplarında hizmet işlevselliği sağlamak için desteklenen AWS hizmetleriyle entegrasyonu etkinleştirin.
* Bu root kullanıcı olarak, bu root hesap/organizasyonu oluşturmak için kullanılan e-posta ve şifre ile giriş yapmak mümkündür.

Yönetim hesabı, **ödeme hesabı sorumluluklarına** sahiptir ve üye hesaplar tarafından biriken tüm ücretleri ödemekten sorumludur. Bir organizasyonun yönetim hesabını değiştiremezsiniz.
* **Üye hesaplar**, bir organizasyondaki diğer tüm hesapları oluşturur. Bir hesap aynı anda yalnızca bir organizasyonun üyesi olabilir. Bir hesaba yalnızca o hesaba kontrol uygulamak için bir politika ekleyebilirsiniz.
* Üye hesaplar **geçerli bir e-posta adresi kullanmalıdır** ve bir **adı** olabilir, genellikle faturalamayı yönetemezler (ancak erişim verilebilir).
```
aws organizations create-account --account-name testingaccount --email testingaccount@lalala1233fr.com
```
### **Organization Units**

Hesaplar **Organization Units (OU)** içinde gruplanabilir. Bu şekilde, **Organization Unit** için **politikalar** oluşturabilir ve bu politikalar **tüm alt hesaplara uygulanır**. Bir OU'nun başka OUlardan alt birimleri olabileceğini unutmayın.
```bash
# You can get the root id from aws organizations list-roots
aws organizations create-organizational-unit --parent-id r-lalala --name TestOU
```
### Service Control Policy (SCP)

Bir **service control policy (SCP)**, SCP'nin etkilediği hesaplarda kullanıcıların ve rollerin kullanabileceği hizmetleri ve eylemleri belirten bir politikadır. SCP'ler, **IAM izin politikalarına benzer** ancak **herhangi bir izin vermezler**. Bunun yerine, SCP'ler bir organizasyon, organizasyon birimi (OU) veya hesap için **maksimum izinleri** belirler. Bir SCP'yi organizasyon köküne veya bir OU'ya eklediğinizde, **SCP üye hesaplarındaki varlıkların izinlerini sınırlar**.

Bu, **kök kullanıcının bile bir şey yapmasının durdurulabileceği** TEK yoldur. Örneğin, kullanıcıların CloudTrail'i devre dışı bırakmasını veya yedekleri silmesini engellemek için kullanılabilir.\
Bunu atlatmanın tek yolu, SCP'leri yapılandıran **ana hesabı** da ele geçirmektir (ana hesap engellenemez).

{% hint style="warning" %}
**SCP'lerin yalnızca hesaptaki ilkeleri kısıtladığını** unutmayın, bu nedenle diğer hesaplar etkilenmez. Bu, bir SCP'nin `s3:GetObject` erişimini reddetmesinin, hesabınızdaki **herkese açık bir S3 bucket'ına erişimi** durdurmayacağı anlamına gelir.
{% endhint %}

SCP örnekleri:

* Kök hesabı tamamen reddet
* Yalnızca belirli bölgeleri izin ver
* Yalnızca beyaz listeye alınmış hizmetlere izin ver
* GuardDuty, CloudTrail ve S3 Public Block Access'in devre dışı bırakılmasını reddet
* Güvenlik/olay müdahale rollerinin silinmesini veya değiştirilmesini reddet
* Yedeklerin silinmesini reddet
* IAM kullanıcıları ve erişim anahtarları oluşturmayı reddet

**JSON örneklerini** [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html) adresinde bulabilirsiniz.

### ARN

**Amazon Resource Name**, AWS içindeki her kaynağın sahip olduğu **benzersiz isimdir**, şu şekilde oluşturulur:
```
arn:partition:service:region:account-id:resource-type/resource-id
arn:aws:elasticbeanstalk:us-west-1:123456789098:environment/App/Env
```
AWS'de 4 bölüm olduğunu, ancak bunları çağırmanın sadece 3 yolu olduğunu unutmayın:

* AWS Standard: `aws`
* AWS China: `aws-cn`
* AWS US public Internet (GovCloud): `aws-us-gov`
* AWS Secret (US Classified): `aws`

## IAM - Kimlik ve Erişim Yönetimi

IAM, AWS hesabınız içinde **Kimlik Doğrulama**, **Yetkilendirme** ve **Erişim Kontrolü** yönetmenizi sağlayan hizmettir.

* **Kimlik Doğrulama** - Bir kimliği tanımlama ve bu kimliğin doğrulanması süreci. Bu süreç, Kimlik Tanımlama ve Doğrulama olarak ikiye ayrılabilir.
* **Yetkilendirme** - Bir kimliğin, sistemde kimlik doğrulaması yapıldıktan sonra neye erişebileceğini belirler.
* **Erişim Kontrolü** - Güvenli bir kaynağa erişimin nasıl verildiği yöntemi ve süreci

IAM, AWS hesabınızdaki kaynaklarınıza kimliklerin kimlik doğrulama, yetkilendirme ve erişim kontrol mekanizmalarını yönetme, kontrol etme ve yönetme yeteneği ile tanımlanabilir.

### [AWS hesap root kullanıcısı](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_root-user.html) <a href="#id_root" id="id_root"></a>

İlk kez bir Amazon Web Services (AWS) hesabı oluşturduğunuzda, hesaptaki **tüm** AWS hizmetlerine ve kaynaklarına tam erişimi olan tek bir oturum açma kimliği ile başlarsınız. Bu, AWS hesap _**root kullanıcısı**_ olup, **hesabı oluşturmak için kullandığınız e-posta adresi ve şifre ile oturum açarak** erişilir.

Yeni bir **admin kullanıcısının** **root kullanıcısından daha az izinleri** olacağını unutmayın.

Güvenlik açısından, başka kullanıcılar oluşturmak ve bu kullanıcıyı kullanmaktan kaçınmak önerilir.

### [IAM kullanıcıları](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_users.html) <a href="#id_iam-users" id="id_iam-users"></a>

Bir IAM _kullanıcısı_, AWS'de **AWS ile etkileşimde bulunan kişi veya uygulamayı temsil etmek** için oluşturduğunuz bir varlıktır. AWS'deki bir kullanıcı, bir ad ve kimlik bilgileri (şifre ve en fazla iki erişim anahtarı) içerir.

Bir IAM kullanıcısı oluşturduğunuzda, ona uygun izin politikaları eklenmiş bir **kullanıcı grubunun üyesi yaparak** (önerilen) veya **doğrudan politikalar ekleyerek** **izinler** verirsiniz.

Kullanıcılar, **konsol üzerinden oturum açmak için MFA etkinleştirilebilir**. MFA etkinleştirilmiş kullanıcıların API tokenları MFA tarafından korunmaz. Bir kullanıcının API anahtarlarının erişimini MFA kullanarak **sınırlamak istiyorsanız**, belirli eylemleri gerçekleştirmek için MFA'nın gerekli olduğunu politikada belirtmeniz gerekir (örnek [**burada**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html)).

#### CLI

* **Erişim Anahtarı Kimliği**: AKHDNAPO86BSHKDIRYT gibi 20 rastgele büyük harf ve rakam karakteri
* **Gizli erişim anahtarı kimliği**: S836fh/J73yHSb64Ag3Rkdi/jaD6sPl6/antFtU gibi 40 rastgele büyük ve küçük harf karakteri (Kaybolan gizli erişim anahtarı kimliklerini geri almak mümkün değildir).

Erişim Anahtarını **değiştirmeniz gerektiğinde** izlemeniz gereken süreç şudur:\
_Yeni bir erişim anahtarı oluştur -> Yeni anahtarı sistem/uygulamaya uygula -> Orijinal anahtarı pasif olarak işaretle -> Yeni erişim anahtarının çalıştığını test et ve doğrula -> Eski erişim anahtarını sil_

### MFA - Çok Faktörlü Kimlik Doğrulama

Mevcut yöntemlerinize, örneğin şifreye ek olarak **ek bir kimlik doğrulama faktörü oluşturmak** için kullanılır, böylece çok faktörlü bir kimlik doğrulama seviyesi oluşturur.\
**Ücretsiz sanal bir uygulama veya fiziksel bir cihaz** kullanabilirsiniz. AWS'de bir MFA etkinleştirmek için google authentication gibi uygulamaları ücretsiz olarak kullanabilirsiniz.

MFA koşulları içeren politikalar aşağıdakilere eklenebilir:

* Bir IAM kullanıcısı veya grubu
* Amazon S3 bucket, Amazon SQS kuyruğu veya Amazon SNS konusu gibi bir kaynak
* Bir kullanıcının üstlenebileceği bir IAM rolünün güven politikası

MFA kontrolü yapan bir kaynağa **CLI üzerinden erişmek** istiyorsanız, **`GetSessionToken`** çağırmanız gerekir. Bu, size MFA hakkında bilgi içeren bir token verecektir.\
**`AssumeRole` kimlik bilgileri bu bilgiyi içermez**.
```bash
aws sts get-session-token --serial-number <arn_device> --token-code <code>
```
[**Burada belirtildiği gibi**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html), **MFA kullanılamayacak** birçok farklı durum vardır.

### [IAM kullanıcı grupları](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_groups.html) <a href="#id_iam-groups" id="id_iam-groups"></a>

Bir IAM [kullanıcı grubu](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_groups.html), **birden fazla kullanıcıya aynı anda politikalar eklemenin** bir yoludur, bu da bu kullanıcıların izinlerini yönetmeyi kolaylaştırabilir. **Roller ve gruplar bir grubun parçası olamaz**.

Bir **kimlik tabanlı politikayı bir kullanıcı grubuna ekleyebilirsiniz** böylece kullanıcı grubundaki **tüm kullanıcılar** politikanın **izinlerini alır**. Bir **kullanıcı grubunu** bir **politika** içinde (örneğin kaynak tabanlı bir politika) **`Principal`** olarak tanımlayamazsınız çünkü gruplar izinlerle ilgilidir, kimlik doğrulama ile değil ve principal'lar kimlik doğrulanmış IAM varlıklarıdır.

Kullanıcı gruplarının bazı önemli özellikleri şunlardır:

* Bir kullanıcı **grubu** **birçok kullanıcı içerebilir** ve bir **kullanıcı** **birden fazla gruba ait olabilir**.
* **Kullanıcı grupları iç içe olamaz**; sadece kullanıcıları içerebilir, diğer kullanıcı gruplarını değil.
* AWS hesabındaki tüm kullanıcıları otomatik olarak içeren **varsayılan bir kullanıcı grubu yoktur**. Böyle bir kullanıcı grubuna sahip olmak istiyorsanız, onu oluşturmalı ve her yeni kullanıcıyı ona atamalısınız.
* Bir AWS hesabındaki IAM kaynaklarının sayısı ve boyutu, örneğin grup sayısı ve bir kullanıcının üye olabileceği grup sayısı sınırlıdır. Daha fazla bilgi için [IAM ve AWS STS kotaları](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_iam-quotas.html) bölümüne bakın.

### [IAM rolleri](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles.html) <a href="#id_iam-roles" id="id_iam-roles"></a>

Bir IAM **rolü**, **bir kullanıcının** kimliğine çok **benzer**, çünkü AWS'de ne yapıp ne yapamayacağını belirleyen **izin politikalarına sahip bir kimliktir**. Ancak, bir rolün **hiçbir kimlik bilgisi** (şifre veya erişim anahtarları) yoktur. Bir kişiye özgü olarak ilişkilendirilmek yerine, bir rol, **ihtiyacı olan herkes tarafından üstlenilebilir (ve yeterli izinlere sahip)** olacak şekilde tasarlanmıştır. Bir **IAM kullanıcısı, belirli bir görev için geçici olarak** farklı izinler almak üzere bir rolü üstlenebilir. Bir rol, IAM yerine harici bir kimlik sağlayıcı kullanarak oturum açan bir [**federe kullanıcıya**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_providers.html) atanabilir.

Bir IAM rolü **iki tür politikadan** oluşur: **Kimlerin rolü üstlenebileceğini** tanımlayan ve boş olamayan bir **güven politikası** ve **neleri erişebileceğini** tanımlayan ve boş olamayan bir **izin politikası**.

#### AWS Security Token Service (STS)

AWS Security Token Service (STS), **geçici, sınırlı ayrıcalıklı kimlik bilgileri** sağlanmasını kolaylaştıran bir web hizmetidir. Özellikle şu amaçlar için tasarlanmıştır:

### [IAM'deki geçici kimlik bilgileri](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_temp.html) <a href="#id_temp-creds" id="id_temp-creds"></a>

**Geçici kimlik bilgileri öncelikle IAM rolleriyle kullanılır**, ancak başka kullanımları da vardır. Standart IAM kullanıcınızdan daha sınırlı izinlere sahip geçici kimlik bilgileri talep edebilirsiniz. Bu, **daha sınırlı kimlik bilgileri tarafından izin verilmeyen görevleri yanlışlıkla yapmanızı** engeller. Geçici kimlik bilgilerinin bir avantajı, belirli bir süre sonra otomatik olarak sona ermeleridir. Kimlik bilgilerinin geçerli olduğu süre üzerinde kontrol sahibisiniz.

### Politikalar

#### Politika İzinleri

İzinleri atamak için kullanılır. 2 türü vardır:

* AWS tarafından yönetilen politikalar (AWS tarafından önceden yapılandırılmış)
* Müşteri Tarafından Yönetilen Politikalar: Sizin tarafınızdan yapılandırılır. AWS tarafından yönetilen politikalara dayalı politikalar oluşturabilirsiniz (birini değiştirip kendi politikanızı oluşturmak), politika oluşturucu (izinleri vermenize ve reddetmenize yardımcı olan bir GUI görünümü) kullanarak veya kendi politikanızı yazarak.

**Varsayılan olarak erişim** **reddedilir**, belirli bir rol belirtilmişse erişim verilir.\
**Tek bir "Reddetme" varsa, "İzin Verme"yi geçersiz kılar**, AWS hesabının kök güvenlik kimlik bilgilerini kullanan istekler hariç (bunlar varsayılan olarak izin verilir).
```javascript
{
"Version": "2012-10-17",  //Version of the policy
"Statement": [  //Main element, there can be more than 1 entry in this array
{
"Sid": "Stmt32894y234276923" //Unique identifier (optional)
"Effect": "Allow", //Allow or deny
"Action": [  //Actions that will be allowed or denied
"ec2:AttachVolume",
"ec2:DetachVolume"
],
"Resource": [ //Resource the action and effect will be applied to
"arn:aws:ec2:*:*:volume/*",
"arn:aws:ec2:*:*:instance/*"
],
"Condition": { //Optional element that allow to control when the permission will be effective
"ArnEquals": {"ec2:SourceInstanceARN": "arn:aws:ec2:*:*:instance/instance-id"}
}
}
]
}
```
[Herhangi bir hizmette koşullar için kullanılabilecek global alanlar burada belgelenmiştir](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_policies\_condition-keys.html#condition-keys-resourceaccount).\
[Hizmet başına koşullar için kullanılabilecek belirli alanlar burada belgelenmiştir](https://docs.aws.amazon.com/service-authorization/latest/reference/reference\_policies\_actions-resources-contextkeys.html).

#### Inline Policies

Bu tür politikalar bir kullanıcıya, gruba veya role **doğrudan atanır**. Bu nedenle, başka birinin kullanabileceği politikalar listesinde görünmezler.\
Inline policies, bir politika ile uygulandığı kimlik arasında **katı bir bire bir ilişki sürdürmek** istiyorsanız kullanışlıdır. Örneğin, bir politikadaki izinlerin, amaçlandıkları kimlik dışında başka bir kimliğe yanlışlıkla atanmadığından emin olmak istersiniz. Bir inline policy kullandığınızda, politikadaki izinler yanlışlıkla yanlış kimliğe atanamaz. Ayrıca, AWS Management Console'u kullanarak o kimliği sildiğinizde, kimliğe gömülü politikalar da silinir. Bunun nedeni, bu politikaların ana varlığın bir parçası olmasıdır.

#### Resource Bucket Policies

Bunlar **kaynaklarda** tanımlanabilen **politikalardır**. **AWS'nin tüm kaynakları bunları desteklemez**.

Bir principal üzerinde açık bir reddetme yoksa ve bir kaynak politikası onlara erişim veriyorsa, erişime izin verilir.

### IAM Boundaries

IAM boundaries, bir kullanıcı veya rolün **erişmesi gereken izinleri sınırlamak** için kullanılabilir. Bu şekilde, farklı bir politika tarafından kullanıcıya farklı bir izin seti verilse bile, kullanıcı bu izinleri kullanmaya çalışırsa **başarısız** olur.

Bir boundary, kullanıcıya eklenmiş bir politika olup, **kullanıcı veya rolün sahip olabileceği maksimum izin seviyesini belirtir**. Yani, **kullanıcı Yönetici erişimine sahip olsa bile**, boundary sadece S3 bucket'larını okuyabileceğini belirtiyorsa, yapabileceği maksimum şey budur.

**Bu**, **SCP'ler** ve **en az ayrıcalık** ilkesini takip etmek, kullanıcıların ihtiyaç duyduklarından daha fazla izne sahip olmamalarını kontrol etmenin yollarıdır.

### Session Policies

Bir session policy, bir rol **bir şekilde üstlenildiğinde** ayarlanan bir politikadır. Bu, o oturum için bir **IAM boundary gibi** olacaktır: Bu, session policy'nin izin vermediği, ancak **politikada belirtilenlerle sınırladığı** anlamına gelir (rolün sahip olduğu maksimum izinler).

Bu, **güvenlik önlemleri** için kullanışlıdır: Bir yönetici çok ayrıcalıklı bir rol üstleneceğinde, oturumun tehlikeye girmesi durumunda izinleri yalnızca session policy'de belirtilenlerle sınırlayabilir.
```bash
aws sts assume-role \
--role-arn <value> \
--role-session-name <value> \
[--policy-arns <arn_custom_policy1> <arn_custom_policy2>]
[--policy <file://policy.json>]
```
AWS'nin varsayılan olarak **oturum politikaları ekleyebileceğini** unutmayın. Örneğin, [kimlik doğrulaması yapılmamış cognito varsayılan rolleri](../aws-services/aws-cognito-enum/cognito-identity-pools.md#accessing-iam-roles) (gelişmiş kimlik doğrulaması kullanarak) AWS, **oturum politikası ile oturum kimlik bilgileri** oluşturacaktır ve bu oturumun erişebileceği hizmetleri [**aşağıdaki listeyle**](https://docs.aws.amazon.com/cognito/latest/developerguide/iam-roles.html#access-policies-scope-down-services) sınırlandıracaktır.

Bu nedenle, bir noktada "... çünkü hiçbir oturum politikası ... izin vermiyor" hatasıyla karşılaşırsanız ve rolün eylemi gerçekleştirme izni varsa, **bir oturum politikasının bunu engellediği** anlamına gelir.

### Kimlik Federasyonu

Kimlik federasyonu, **AWS dışındaki kimlik sağlayıcılarından gelen kullanıcıların** AWS kaynaklarına güvenli bir şekilde erişmesini sağlar, geçerli bir IAM kullanıcı hesabından AWS kullanıcı kimlik bilgilerini sağlamalarına gerek kalmaz.\
Bir kimlik sağlayıcısına örnek olarak, kendi kurumsal **Microsoft Active Directory**'niz (via **SAML**) veya **OpenID** hizmetleri (örneğin **Google**) verilebilir. Federasyonlu erişim, bu kullanıcıların AWS'ye erişmesini sağlar.

Bu güveni yapılandırmak için, **IAM Kimlik Sağlayıcısı (SAML veya OAuth)** oluşturulur ve bu **diğer platforma güven** sağlar. Daha sonra, en az bir **IAM rolü Kimlik Sağlayıcısına (güvenen) atanır**. Güvenilen platformdan bir kullanıcı AWS'ye erişirse, belirtilen rol olarak erişecektir.

Ancak, genellikle **kullanıcının üçüncü taraf platformdaki grubuna bağlı olarak farklı bir rol vermek** istersiniz. Bu durumda, birkaç **IAM rolü üçüncü taraf Kimlik Sağlayıcısına güvenebilir** ve üçüncü taraf platform, kullanıcıların hangi rolü üstleneceğine karar verir.

<figure><img src="../../../.gitbook/assets/image (247).png" alt=""><figcaption></figcaption></figure>

### IAM Identity Center

AWS IAM Identity Center (AWS Single Sign-On'un halefi), AWS Kimlik ve Erişim Yönetimi (IAM) yeteneklerini genişleterek, **kullanıcıların ve AWS hesaplarına ve bulut uygulamalarına erişimlerinin yönetimini** bir araya getiren **merkezi bir yer** sağlar.

Giriş alanı `<user_input>.awsapps.com` gibi bir şey olacaktır.

Kullanıcıları oturum açtırmak için kullanılabilecek 3 kimlik kaynağı vardır:

* Identity Center Directory: Normal AWS kullanıcıları
* Active Directory: Farklı bağlayıcıları destekler
* External Identity Provider: Tüm kullanıcılar ve gruplar dış bir Kimlik Sağlayıcısından (IdP) gelir

<figure><img src="../../../.gitbook/assets/image (279).png" alt=""><figcaption></figcaption></figure>

En basit Identity Center dizini durumunda, **Identity Center kullanıcılar ve grupların bir listesini** tutar ve bunlara **organizasyonun herhangi bir hesabına** **politikalar atayabilir**.

Bir Identity Center kullanıcı/grubuna bir hesaba erişim vermek için, **Identity Center'a güvenen bir SAML Kimlik Sağlayıcısı oluşturulacak** ve hedef hesapta **belirtilen politikalarla Kimlik Sağlayıcısına güvenen bir rol oluşturulacaktır**.

#### AwsSSOInlinePolicy

IAM Identity Center aracılığıyla oluşturulan rollere **inline politikalar aracılığıyla izinler vermek** mümkündür. AWS Identity Center'da **inline politikalar verilen** hesaplarda oluşturulan roller, bu izinleri **`AwsSSOInlinePolicy`** adlı bir inline politikada bulunduracaktır.

Bu nedenle, **`AwsSSOInlinePolicy`** adlı bir inline politikaya sahip 2 rol görseniz bile, **aynı izinlere sahip olduğu anlamına gelmez**.

### Hesaplar Arası Güven ve Roller

**Bir kullanıcı** (güvenen), bazı politikalarla bir Hesaplar Arası Rol oluşturabilir ve ardından **başka bir kullanıcının** (güvenilen) **hesabına erişmesine izin verebilir**, ancak yalnızca **yeni rol politikalarında belirtilen erişime sahip olarak**. Bunu oluşturmak için, sadece yeni bir Rol oluşturun ve Hesaplar Arası Rol seçin. Hesaplar Arası Erişim için roller iki seçenek sunar. Sahip olduğunuz AWS hesapları arasında erişim sağlamak ve sahip olduğunuz bir hesap ile üçüncü taraf bir AWS hesabı arasında erişim sağlamak.\
**Güvenilen kullanıcıyı belirtmek ve genel bir şey koymamak** önerilir, çünkü aksi takdirde federasyonlu kullanıcılar gibi diğer kimliği doğrulanmış kullanıcılar da bu güveni kötüye kullanabilir.

### AWS Simple AD

Desteklenmez:

* Güven İlişkileri
* AD Yönetim Merkezi
* Tam PS API desteği
* AD Geri Dönüşüm Kutusu
* Grup Yönetilen Hizmet Hesapları
* Şema Uzantıları
* OS veya Örneklerine Doğrudan Erişim

#### Web Federasyonu veya OpenID Kimlik Doğrulaması

Uygulama, geçici kimlik bilgileri oluşturmak için AssumeRoleWithWebIdentity kullanır. Ancak bu, AWS konsoluna erişim sağlamaz, sadece AWS içindeki kaynaklara erişim sağlar.

### Diğer IAM seçenekleri

* Minimum uzunluk ve parola gereksinimleri gibi **parola politikası ayarlarını** belirleyebilirsiniz.
* Mevcut kimlik bilgileri hakkında bilgi içeren **"Kimlik Bilgisi Raporu"nu indirebilirsiniz** (örneğin, kullanıcı oluşturma zamanı, parola etkin mi...). Her **dört saatte bir** kimlik bilgisi raporu oluşturabilirsiniz.

AWS Kimlik ve Erişim Yönetimi (IAM), tüm AWS genelinde **ince taneli erişim kontrolü** sağlar. IAM ile, **kimlerin hangi hizmetlere ve kaynaklara erişebileceğini** ve hangi koşullar altında erişebileceğini belirleyebilirsiniz. IAM politikaları ile, iş gücünüz ve sistemleriniz için izinleri yöneterek **en az ayrıcalık ilkesini** sağlarsınız.

### IAM ID Önekleri

[**Bu sayfada**](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_identifiers.html#identifiers-unique-ids) anahtarların doğasına bağlı olarak **IAM ID öneklerini** bulabilirsiniz:

| ABIA | [AWS STS hizmet taşıyıcı belirteci](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_bearer.html)                                                                                                         |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ACCA | Bağlama özgü kimlik bilgisi                                                                                                                                                                                           |
| AGPA | Kullanıcı grubu                                                                                                                                                                                                            |
| AIDA | IAM kullanıcısı                                                                                                                                                                                                              |
| AIPA | Amazon EC2 örnek profili                                                                                                                                                                                           |
| AKIA | Erişim anahtarı                                                                                                                                                                                                            |
| ANPA | Yönetilen politika                                                                                                                                                                                                        |
| ANVA | Yönetilen bir politikada sürüm                                                                                                                                                                                           |
| APKA | Genel anahtar                                                                                                                                                                                                            |
| AROA | Rol                                                                                                                                                                                                                  |
| ASCA | Sertifika                                                                                                                                                                                                           |
| ASIA | [Geçici (AWS STS) erişim anahtarı kimlikleri](https://docs.aws.amazon.com/STS/latest/APIReference/API\_Credentials.html) bu öneki kullanır, ancak yalnızca gizli erişim anahtarı ve oturum belirteci ile birlikte benzersizdir. |

### Hesapları denetlemek için önerilen izinler

Aşağıdaki ayrıcalıklar çeşitli meta veri okuma erişimi sağlar:

* `arn:aws:iam::aws:policy/SecurityAudit`
* `arn:aws:iam::aws:policy/job-function/ViewOnlyAccess`
* `codebuild:ListProjects`
* `config:Describe*`
* `cloudformation:ListStacks`
* `logs:DescribeMetricFilters`
* `directconnect:DescribeConnections`
* `dynamodb:ListTables`

## Çeşitli

### CLI Kimlik Doğrulama

Normal bir kullanıcının CLI aracılığıyla AWS'ye kimlik doğrulaması yapabilmesi için **yerel kimlik bilgilerine** sahip olması gerekir. Varsayılan olarak, bunları **manuel olarak** `~/.aws/credentials` dosyasında yapılandırabilir veya **`aws configure`** komutunu çalıştırarak yapılandırabilirsiniz.\
Bu dosyada birden fazla profil bulundurabilirsiniz, **aws cli** kullanarak **hiçbir profil** belirtilmezse, bu dosyada **`[default]`** olarak adlandırılan profil kullanılacaktır.\
Birden fazla profile sahip kimlik bilgileri dosyası örneği:
```
[default]
aws_access_key_id = AKIA5ZDCUJHF83HDTYUT
aws_secret_access_key = uOcdhof683fbOUGFYEQug8fUGIf68greoihef

[Admin]
aws_access_key_id = AKIA8YDCu7TGTR356SHYT
aws_secret_access_key = uOcdhof683fbOUGFYEQuR2EIHG34UY987g6ff7
region = eu-west-2
```
Eğer **farklı AWS hesaplarına** erişmeniz gerekiyorsa ve profilinize **bu hesaplar içinde bir rol üstlenme** izni verildiyse, her seferinde manuel olarak STS çağırmanıza (`aws sts assume-role --role-arn <role-arn> --role-session-name sessname`) ve kimlik bilgilerini yapılandırmanıza gerek yoktur.

Hangi rollerin üstlenileceğini belirtmek için `~/.aws/config` dosyasını kullanabilirsiniz ve ardından her zamanki gibi `--profile` parametresini kullanabilirsiniz (kullanıcı için `assume-role` işlemi şeffaf bir şekilde gerçekleştirilecektir).\
Bir config dosyası örneği:
```
[profile acc2]
region=eu-west-2
role_arn=arn:aws:iam::<account-id>:role/<role-path>
role_session_name = <session_name>
source_profile = <profile_with_assume_role>
sts_regional_endpoints = regional
```
Bu yapılandırma dosyası ile aws cli'yi şu şekilde kullanabilirsiniz:
```
aws --profile acc2 ...
```
Eğer **tarayıcı** için buna **benzer** bir şey arıyorsanız, **uzantı** [**AWS Extend Switch Roles**](https://chrome.google.com/webstore/detail/aws-extend-switch-roles/jpmkfafbacpgapdghgdpembnojdlgkdl?hl=en) kontrol edebilirsiniz.

## Referanslar

* [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html)
* [https://aws.amazon.com/iam/](https://aws.amazon.com/iam/)
* [https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html](https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html)

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking öğrenin ve pratik yapın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter**'da bizi takip edin 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **HackTricks ve** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github depolarına PR göndererek hacking ipuçlarını paylaşın.**

</details>
{% endhint %}
