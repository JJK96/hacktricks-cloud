# AWS - Basiese Inligting

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Organisasie Hi√´rargie

![](<../../../.gitbook/assets/image (151).png>)

### Rekeninge

In AWS is daar 'n **root rekening,** wat die **ouer houer vir al die rekeninge** vir jou **organisasie** is. Jy hoef egter nie daardie rekening te gebruik om hulpbronne te ontplooi nie, jy kan **ander rekeninge skep om verskillende AWS** infrastruktuur tussen hulle te skei.

Dit is baie interessant vanuit 'n **sekuriteit** oogpunt, aangesien **een rekening nie toegang tot hulpbronne van 'n ander rekening sal h√™ nie** (behalwe as brue spesifiek geskep word), so op hierdie manier kan jy grense tussen ontplooiings skep.

Daarom is daar **twee tipes rekeninge in 'n organisasie** (ons praat van AWS rekeninge en nie Gebruiker rekeninge nie): 'n enkele rekening wat as die bestuursrekening aangewys is, en een of meer lidrekeninge.

*   Die **bestuursrekening (die root rekening)** is die rekening wat jy gebruik om die organisasie te skep. Vanaf die organisasie se bestuursrekening kan jy die volgende doen:

* Rekenings in die organisasie skep
* Ander bestaande rekeninge na die organisasie nooi
* Rekenings uit die organisasie verwyder
* Uitnodigings bestuur
* Beleide toepas op entiteite (roots, OUs, of rekeninge) binne die organisasie
* Integrasie met ondersteunde AWS dienste moontlik maak om diensfunksionaliteit oor al die rekeninge in die organisasie te verskaf.
* Dit is moontlik om as die root gebruiker aan te meld met die e-pos en wagwoord wat gebruik is om hierdie root rekening/organisasie te skep.

Die bestuursrekening het die **verantwoordelikhede van 'n betaler rekening** en is verantwoordelik vir die betaling van alle koste wat deur die lidrekeninge aangegaan word. Jy kan nie 'n organisasie se bestuursrekening verander nie.
* **Lidrekeninge** maak al die res van die rekeninge in 'n organisasie uit. 'n Rekening kan slegs 'n lid van een organisasie op 'n slag wees. Jy kan 'n beleid aan 'n rekening heg om beheer slegs op daardie een rekening toe te pas.
* Lidrekeninge **moet 'n geldige e-posadres gebruik** en kan 'n **naam** h√™, in die algemeen sal hulle nie die fakturering kan bestuur nie (maar hulle mag toegang daartoe gegee word).
```
aws organizations create-account --account-name testingaccount --email testingaccount@lalala1233fr.com
```
### **Organization Units**

Rekeninge kan gegroepeer word in **Organization Units (OU)**. Op hierdie manier kan jy **beleide** skep vir die Organization Unit wat **op al die kindrekeninge toegepas gaan word**. Let daarop dat 'n OU ander OUs as kinders kan h√™.
```bash
# You can get the root id from aws organizations list-roots
aws organizations create-organizational-unit --parent-id r-lalala --name TestOU
```
### Service Control Policy (SCP)

'n **Diensbeheerbeleid (SCP)** is 'n beleid wat die dienste en aksies spesifiseer wat gebruikers en rolle kan gebruik in die rekeninge wat die SCP be√Ønvloed. SCP's is **soortgelyk aan IAM** toestemmingsbeleide, behalwe dat hulle **geen toestemmings verleen nie**. In plaas daarvan spesifiseer SCP's die **maksimum toestemmings** vir 'n organisasie, organisatoriese eenheid (OU), of rekening. Wanneer jy 'n SCP aan jou organisasie-wortel of 'n OU heg, **beperk die SCP toestemmings vir entiteite in lidrekeninge**.

Dit is die ENIGSTE manier waarop **selfs die wortelgebruiker gestop kan word** om iets te doen. Byvoorbeeld, dit kan gebruik word om te keer dat gebruikers CloudTrail deaktiveer of rugsteun verwyder.\
Die enigste manier om dit te omseil is om ook die **meesterrekening** wat die SCP's konfigureer, te kompromitteer (meesterrekening kan nie geblokkeer word nie).

{% hint style="warning" %}
Let daarop dat **SCP's slegs die prinsipale in die rekening beperk**, so ander rekeninge word nie be√Ønvloed nie. Dit beteken dat 'n SCP wat `s3:GetObject` weier, nie mense sal keer om **toegang tot 'n publieke S3-emmer** in jou rekening te kry nie.
{% endhint %}

SCP voorbeelde:

* Weier die wortelrekening heeltemal
* Laat slegs spesifieke streke toe
* Laat slegs witgelyste dienste toe
*   Weier dat GuardDuty, CloudTrail, en S3 Public Block Access gedeaktiveer word
*   Weier dat sekuriteit/voorvalreaksie-rolle verwyder of gewysig word
* Weier dat rugsteun verwyder word
* Weier die skep van IAM-gebruikers en toegangssleutels

Vind **JSON voorbeelde** by [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html)

### ARN

**Amazon Resource Name** is die **unieke naam** wat elke hulpbron binne AWS het, dit is soos volg saamgestel:
```
arn:partition:service:region:account-id:resource-type/resource-id
arn:aws:elasticbeanstalk:us-west-1:123456789098:environment/App/Env
```
Let wel dat daar 4 partisies in AWS is, maar slegs 3 maniere om hulle aan te roep:

* AWS Standard: `aws`
* AWS China: `aws-cn`
* AWS US public Internet (GovCloud): `aws-us-gov`
* AWS Secret (US Classified): `aws`

## IAM - Identiteit en Toegangsbestuur

IAM is die diens wat jou sal toelaat om **Verifikasie**, **Magtiging** en **Toegangsbeheer** binne jou AWS-rekening te bestuur.

* **Verifikasie** - Proses van die definisie van 'n identiteit en die verifikasie van daardie identiteit. Hierdie proses kan onderverdeel word in: Identifikasie en verifikasie.
* **Magtiging** - Bepaal wat 'n identiteit binne 'n stelsel kan toegang sodra dit geverifieer is.
* **Toegangsbeheer** - Die metode en proses van hoe toegang tot 'n veilige hulpbron verleen word.

IAM kan gedefinieer word deur sy vermo√´ om verifikasie, magtiging en toegangsbeheermeganismes van identiteite tot jou hulpbronne binne jou AWS-rekening te bestuur, te beheer en te regeer.

### [AWS rekening wortelgebruiker](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_root-user.html) <a href="#id_root" id="id_root"></a>

Wanneer jy vir die eerste keer 'n Amazon Web Services (AWS) rekening skep, begin jy met 'n enkele aanmeldidentiteit wat **volledige toegang tot alle** AWS-dienste en -hulpbronne in die rekening het. Dit is die AWS-rekening _**wortelgebruiker**_ en word verkry deur aan te meld met die **e-posadres en wagwoord wat jy gebruik het om die rekening te skep**.

Let daarop dat 'n nuwe **admin gebruiker** **minder regte as die wortelgebruiker** sal h√™.

Vanuit 'n sekuriteitsoogpunt word dit aanbeveel om ander gebruikers te skep en hierdie een te vermy.

### [IAM gebruikers](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_users.html) <a href="#id_iam-users" id="id_iam-users"></a>

'n IAM _gebruiker_ is 'n entiteit wat jy in AWS skep om **die persoon of toepassing te verteenwoordig** wat dit gebruik om **met AWS te kommunikeer**. 'n Gebruiker in AWS bestaan uit 'n naam en geloofsbriewe (wagwoord en tot twee toegangssleutels).

Wanneer jy 'n IAM-gebruiker skep, gee jy dit **regte** deur dit 'n **lid van 'n gebruikersgroep** te maak wat toepaslike magtigingsbeleide aangeheg het (aanbeveel), of deur **beleide direk aan die gebruiker te heg**.

Gebruikers kan **MFA geaktiveer h√™ om aan te meld** deur die konsole. API-tokens van MFA-geaktiveerde gebruikers word nie deur MFA beskerm nie. As jy die **toegang van 'n gebruiker se API-sleutels met MFA wil beperk**, moet jy in die beleid aandui dat MFA teenwoordig moet wees om sekere aksies uit te voer (voorbeeld [**hier**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html)).

#### CLI

* **Toegangssleutel ID**: 20 ewekansige hoofletters en syfers soos AKHDNAPO86BSHKDIRYT
* **Geheime toegangssleutel ID**: 40 ewekansige hoof- en kleinletters: S836fh/J73yHSb64Ag3Rkdi/jaD6sPl6/antFtU (Dit is nie moontlik om verlore geheime toegangssleutel-IDs te herwin nie).

Wanneer jy die **Toegangssleutel moet verander**, is dit die proses wat jy moet volg:\
_Skep 'n nuwe toegangssleutel -> Pas die nuwe sleutel toe op stelsel/toepassing -> merk oorspronklike een as onaktief -> Toets en verifieer dat die nuwe toegangssleutel werk -> Vee ou toegangssleutel uit_

### MFA - Multi Faktor Verifikasie

Dit word gebruik om **'n bykomende faktor vir verifikasie te skep** benewens jou bestaande metodes, soos wagwoord, en sodoende 'n multi-faktor vlak van verifikasie te skep.\
Jy kan 'n **gratis virtuele toepassing of 'n fisiese toestel** gebruik. Jy kan gratis toepassings soos google authentication gebruik om 'n MFA in AWS te aktiveer.

Beleide met MFA-voorwaardes kan aan die volgende geheg word:

* 'n IAM-gebruiker of -groep
* 'n Hulpbron soos 'n Amazon S3-emmer, Amazon SQS-ry, of Amazon SNS-onderwerp
* Die vertrouensbeleid van 'n IAM-rol wat deur 'n gebruiker aangeneem kan word

As jy via CLI toegang wil h√™ tot 'n hulpbron wat **MFA nagaan**, moet jy **`GetSessionToken`** aanroep. Dit sal jou 'n token gee met inligting oor MFA.\
Let daarop dat **`AssumeRole` geloofsbriewe nie hierdie inligting bevat nie**.
```bash
aws sts get-session-token --serial-number <arn_device> --token-code <code>
```
Soos [**hier vermeld**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html), is daar baie verskillende gevalle waar **MFA nie gebruik kan word nie**.

### [IAM gebruikersgroepe](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_groups.html) <a href="#id_iam-groups" id="id_iam-groups"></a>

'n IAM [gebruikersgroep](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_groups.html) is 'n manier om **beleide aan verskeie gebruikers gelyktydig te heg**, wat dit makliker kan maak om die toestemmings vir daardie gebruikers te bestuur. **Rolle en groepe kan nie deel wees van 'n groep nie**.

Jy kan 'n **identiteitsgebaseerde beleid aan 'n gebruikersgroep heg** sodat al die **gebruikers** in die gebruikersgroep **die beleid se toestemmings ontvang**. Jy **kan nie** 'n **gebruikersgroep** as 'n **`Principal`** in 'n **beleid** (soos 'n hulpbron-gebaseerde beleid) identifiseer nie, omdat groepe verband hou met toestemmings, nie verifikasie nie, en principals is geverifieerde IAM-entiteite.

Hier is 'n paar belangrike kenmerke van gebruikersgroepe:

* 'n Gebruikers**groep** kan **baie gebruikers bevat**, en 'n **gebruiker** kan **aan verskeie groepe behoort**.
* **Gebruikersgroepe kan nie geneste wees nie**; hulle kan slegs gebruikers bevat, nie ander gebruikersgroepe nie.
* Daar is **geen standaard gebruikersgroep wat outomaties alle gebruikers in die AWS-rekening insluit nie**. As jy 'n gebruikersgroep soos daardie wil h√™, moet jy dit skep en elke nuwe gebruiker daaraan toewys.
* Die aantal en grootte van IAM-hulpbronne in 'n AWS-rekening, soos die aantal groepe, en die aantal groepe waaraan 'n gebruiker kan behoort, is beperk. Vir meer inligting, sien [IAM en AWS STS kwotas](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_iam-quotas.html).

### [IAM rolle](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles.html) <a href="#id_iam-roles" id="id_iam-roles"></a>

'n IAM **rol** is baie **soortgelyk** aan 'n **gebruiker**, in die sin dat dit 'n **identiteit met toestemmingsbeleide is wat bepaal wat** dit kan en nie kan doen in AWS. 'n Rol het egter **geen geloofsbriewe** (wagwoord of toegangssleutels) daaraan verbonde nie. In plaas daarvan om uniek aan een persoon gekoppel te wees, is 'n rol bedoel om **deur enigiemand wat dit nodig het (en genoeg perms het) aanvaar te word**. 'n **IAM-gebruiker kan 'n rol aanneem om tydelik** verskillende toestemmings vir 'n spesifieke taak aan te neem. 'n Rol kan **toegeken word aan 'n** [**gefedereerde gebruiker**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_providers.html) wat aanmeld deur 'n eksterne identiteitsverskaffer te gebruik in plaas van IAM.

'n IAM-rol bestaan uit **twee tipes beleide**: 'n **vertrouensbeleid**, wat nie leeg kan wees nie, wat definieer **wie die rol kan aanneem**, en 'n **toestemmingsbeleid**, wat nie leeg kan wees nie, wat definieer **wat dit kan toegang**.

#### AWS Security Token Service (STS)

AWS Security Token Service (STS) is 'n webdiens wat die **uitreiking van tydelike, beperkte-voorreg geloofsbriewe** fasiliteer. Dit is spesifiek aangepas vir:

### [Tydelike geloofsbriewe in IAM](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_temp.html) <a href="#id_temp-creds" id="id_temp-creds"></a>

**Tydelike geloofsbriewe word hoofsaaklik gebruik met IAM-rolle**, maar daar is ook ander gebruike. Jy kan tydelike geloofsbriewe aanvra wat 'n meer beperkte stel toestemmings het as jou standaard IAM-gebruiker. Dit **voorkom** dat jy **per ongeluk take uitvoer wat nie toegelaat word** deur die meer beperkte geloofsbriewe. 'n Voordeel van tydelike geloofsbriewe is dat hulle outomaties verval na 'n vasgestelde tydperk. Jy het beheer oor die duur wat die geloofsbriewe geldig is.

### Beleide

#### Beleidstoestemmings

Word gebruik om toestemmings toe te ken. Daar is 2 tipes:

* AWS bestuurde beleide (vooraf gekonfigureer deur AWS)
* Kli√´nt bestuurde beleide: Gekonfigureer deur jou. Jy kan beleide skep gebaseer op AWS bestuurde beleide (deur een van hulle te wysig en jou eie te skep), die beleidsgenerator te gebruik (‚Äôn GUI-aansig wat jou help om toestemmings toe te ken en te weier) of jou eie te skryf.

By **standaard toegang** word **geweier**, toegang sal verleen word as 'n eksplisiete rol gespesifiseer is.\
As **enkele "Deny" bestaan, sal dit die "Allow" oorskry**, behalwe vir versoeke wat die AWS-rekening se wortel sekuriteitsgeloofsbriewe gebruik (wat standaard toegelaat word).
```javascript
{
"Version": "2012-10-17",  //Version of the policy
"Statement": [  //Main element, there can be more than 1 entry in this array
{
"Sid": "Stmt32894y234276923" //Unique identifier (optional)
"Effect": "Allow", //Allow or deny
"Action": [  //Actions that will be allowed or denied
"ec2:AttachVolume",
"ec2:DetachVolume"
],
"Resource": [ //Resource the action and effect will be applied to
"arn:aws:ec2:*:*:volume/*",
"arn:aws:ec2:*:*:instance/*"
],
"Condition": { //Optional element that allow to control when the permission will be effective
"ArnEquals": {"ec2:SourceInstanceARN": "arn:aws:ec2:*:*:instance/instance-id"}
}
}
]
}
```
Die [globale velde wat vir voorwaardes in enige diens gebruik kan word, is hier gedokumenteer](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_policies\_condition-keys.html#condition-keys-resourceaccount).\
Die [spesifieke velde wat per diens vir voorwaardes gebruik kan word, is hier gedokumenteer](https://docs.aws.amazon.com/service-authorization/latest/reference/reference\_policies\_actions-resources-contextkeys.html).

#### Inline Policies

Hierdie tipe beleide word **direk toegeken** aan 'n gebruiker, groep of rol. Dan verskyn hulle nie in die Beleide lys soos enige ander een wat gebruik kan word nie.\
Inline policies is nuttig as jy 'n **strikte een-tot-een verhouding tussen 'n beleid en die identiteit** wat dit toegepas word, wil handhaaf. Byvoorbeeld, jy wil seker maak dat die toestemmings in 'n beleid nie per ongeluk aan 'n ander identiteit as die een waarvoor hulle bedoel is, toegeken word nie. Wanneer jy 'n inline beleid gebruik, kan die toestemmings in die beleid nie per ongeluk aan die verkeerde identiteit geheg word nie. Daarbenewens, wanneer jy die AWS Management Console gebruik om daardie identiteit te verwyder, word die beleide wat in die identiteit ingebed is, ook verwyder. Dit is omdat hulle deel is van die hoofentiteit.

#### Resource Bucket Policies

Hierdie is **beleide** wat in **hulpbronne** gedefinieer kan word. **Nie alle AWS-hulpbronne ondersteun hulle nie**.

As 'n hoof nie 'n eksplisiete weiering op hulle het nie, en 'n hulpbronbeleid gee hulle toegang, dan word hulle toegelaat.

### IAM Boundaries

IAM boundaries kan gebruik word om **die toestemmings wat 'n gebruiker of rol toegang tot moet h√™, te beperk**. Op hierdie manier, selfs al word 'n ander stel toestemmings aan die gebruiker deur 'n **ander beleid** toegeken, sal die operasie **misluk** as hy probeer om hulle te gebruik.

'n Boundary is net 'n beleid wat aan 'n gebruiker geheg is wat **die maksimum vlak van toestemmings wat die gebruiker of rol kan h√™, aandui**. So, **selfs al het die gebruiker Administrateur toegang**, as die boundary aandui dat hy net S3 buckets kan lees, is dit die maksimum wat hy kan doen.

**Dit**, **SCPs** en **die volgende van die minste voorreg** beginsel is die maniere om te beheer dat gebruikers nie meer toestemmings het as wat hulle nodig het nie.

### Session Policies

'n Session policy is 'n **beleid wat gestel word wanneer 'n rol op een of ander manier aanvaar word**. Dit sal soos 'n **IAM boundary vir daardie sessie** wees: Dit beteken dat die session policy nie toestemmings verleen nie, maar **beperk hulle tot die wat in die beleid aangedui word** (met die maksimum toestemmings wat die rol het).

Dit is nuttig vir **sekuriteitsmaatre√´ls**: Wanneer 'n admin 'n baie bevoorregte rol gaan aanvaar, kan hy die toestemming beperk tot slegs die wat in die session policy aangedui word in geval die sessie gekompromitteer word.
```bash
aws sts assume-role \
--role-arn <value> \
--role-session-name <value> \
[--policy-arns <arn_custom_policy1> <arn_custom_policy2>]
[--policy <file://policy.json>]
```
Let daarop dat **AWS standaard sessiebeleide by sessies kan voeg** wat gegenereer gaan word as gevolg van derde redes. Byvoorbeeld, in [ongemagtigde cognito aangeneemde rolle](../aws-services/aws-cognito-enum/cognito-identity-pools.md#accessing-iam-roles) standaard (met verbeterde verifikasie), sal AWS **sessie geloofsbriewe met 'n sessiebeleid** genereer wat die dienste beperk wat daardie sessie kan toegang [**tot die volgende lys**](https://docs.aws.amazon.com/cognito/latest/developerguide/iam-roles.html#access-policies-scope-down-services).

Daarom, as jy op 'n stadium die fout kry "... omdat geen sessiebeleid die ... toelaat nie", en die rol het toegang om die aksie uit te voer, is dit omdat **daar 'n sessiebeleid is wat dit verhoed**.

### Identiteitsfederasie

Identiteitsfederasie **laat gebruikers van identiteitsverskaffers wat ekstern is** tot AWS toe om AWS-hulpbronne veilig te toegang sonder om AWS-gebruikersgeloofsbriewe van 'n geldige IAM-gebruikersrekening te verskaf.\
'n Voorbeeld van 'n identiteitsverskaffer kan jou eie korporatiewe **Microsoft Active Directory** (via **SAML**) of **OpenID** dienste (soos **Google**) wees. Gefedereerde toegang sal dan die gebruikers binne dit toelaat om AWS te toegang.

Om hierdie vertroue te konfigureer, word 'n **IAM Identiteitsverskaffer gegenereer (SAML of OAuth)** wat die **ander platform** sal **vertrou**. Dan word ten minste een **IAM-rol toegeken (vertrou) aan die Identiteitsverskaffer**. As 'n gebruiker van die vertroude platform AWS toegang, sal hy toegang h√™ as die genoemde rol.

Jy sal egter gewoonlik 'n **ander rol wil gee afhangende van die groep van die gebruiker** in die derdeparty platform. Dan kan verskeie **IAM-rolle die derdeparty Identiteitsverskaffer vertrou** en die derdeparty platform sal die een wees wat gebruikers toelaat om een rol of die ander aan te neem.

<figure><img src="../../../.gitbook/assets/image (247).png" alt=""><figcaption></figcaption></figure>

### IAM Identiteitsentrum

AWS IAM Identiteitsentrum (opvolger van AWS Single Sign-On) brei die vermo√´ns van AWS Identity and Access Management (IAM) uit om 'n **sentrale plek** te bied wat **administrasie van gebruikers en hul toegang tot AWS** rekeninge en wolktoepassings saambring.

Die aanmelddomein gaan iets wees soos `<user_input>.awsapps.com`.

Om gebruikers aan te meld, is daar 3 identiteitsbronne wat gebruik kan word:

* Identiteitsentrum Gids: Gewone AWS-gebruikers
* Active Directory: Ondersteun verskillende verbindings
* Eksterne Identiteitsverskaffer: Alle gebruikers en groepe kom van 'n eksterne Identiteitsverskaffer (IdP)

<figure><img src="../../../.gitbook/assets/image (279).png" alt=""><figcaption></figcaption></figure>

In die eenvoudigste geval van Identiteitsentrum gids, sal die **Identiteitsentrum 'n lys van gebruikers en groepe h√™** en sal in staat wees om **beleide aan hulle toe te ken** aan **enige van die rekeninge** van die organisasie.

Om toegang te gee aan 'n Identiteitsentrum gebruiker/groep tot 'n rekening, sal 'n **SAML Identiteitsverskaffer wat die Identiteitsentrum vertrou geskep word**, en 'n **rol wat die Identiteitsverskaffer met die aangeduide beleide vertrou sal geskep word** in die bestemmingsrekening.

#### AwsSSOInlinePolicy

Dit is moontlik om **toestemmings via inlynbeleide aan rolle wat deur IAM Identiteitsentrum geskep is te gee**. Die rolle wat in die rekeninge geskep is wat **inlynbeleide in AWS Identiteitsentrum gegee word** sal hierdie toestemmings h√™ in 'n inlynbeleid genaamd **`AwsSSOInlinePolicy`**.

Daarom, selfs al sien jy 2 rolle met 'n inlynbeleid genaamd **`AwsSSOInlinePolicy`**, beteken dit **nie dat dit dieselfde toestemmings het nie**.

### Kruisrekening Vertroue en Rolle

**'n Gebruiker** (vertrouend) kan 'n Kruisrekening Rol met sommige beleide skep en dan, **'n ander gebruiker toelaat** (vertrou) om **sy rekening te toegang** maar slegs **met die toegang wat in die nuwe rolbeleide aangedui is**. Om dit te skep, skep net 'n nuwe Rol en kies Kruisrekening Rol. Rolle vir Kruisrekening Toegang bied twee opsies. Om toegang te verskaf tussen AWS-rekeninge wat jy besit, en om toegang te verskaf tussen 'n rekening wat jy besit en 'n derdeparty AWS-rekening.\
Dit word aanbeveel om **die gebruiker wat vertrou word te spesifiseer en nie iets generies te plaas nie** want anders sal ander gemagtigde gebruikers soos gefedereerde gebruikers ook hierdie vertroue kan misbruik.

### AWS Simple AD

Nie ondersteun nie:

* Vertrouensverhoudings
* AD Admin Sentrum
* Volledige PS API ondersteuning
* AD Herwinningsbak
* Groep Bestuurde Diensrekeninge
* Skema Uitbreidings
* Geen Direkte toegang tot OS of Instansies

#### Web Federasie of OpenID Verifikasie

Die app gebruik die AssumeRoleWithWebIdentity om tydelike geloofsbriewe te skep. Dit gee egter nie toegang tot die AWS-konsole nie, net toegang tot hulpbronne binne AWS.

### Ander IAM opsies

* Jy kan **'n wagwoordbeleid instel** wat opsies soos minimum lengte en wagwoordvereistes insluit.
* Jy kan **"Credential Report" aflaai** met inligting oor huidige geloofsbriewe (soos gebruiker skeppingstyd, is wagwoord geaktiveer...). Jy kan 'n geloofsbriewerapport genereer so dikwels as een keer elke **vier uur**.

AWS Identity and Access Management (IAM) bied **fynkorrelige toegangbeheer** oor al AWS. Met IAM kan jy spesifiseer **wie toegang het tot watter dienste en hulpbronne**, en onder watter voorwaardes. Met IAM-beleide bestuur jy toestemmings aan jou werksmag en stelsels om **minimum voorregte toestemmings** te verseker.

### IAM ID Voorvoegsels

In [**hierdie bladsy**](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_identifiers.html#identifiers-unique-ids) kan jy die **IAM ID voorvoegsels** van sleutels vind afhangende van hul aard:

| ABIA | [AWS STS diens draer token](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_bearer.html)                                                                                                         |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ACCA | Konteks-spesifieke geloofsbrief                                                                                                                                                                                           |
| AGPA | Gebruikersgroep                                                                                                                                                                                                            |
| AIDA | IAM gebruiker                                                                                                                                                                                                              |
| AIPA | Amazon EC2 instansie profiel                                                                                                                                                                                           |
| AKIA | Toegangssleutel                                                                                                                                                                                                            |
| ANPA | Bestuurde beleid                                                                                                                                                                                                        |
| ANVA | Weergawe in 'n bestuurde beleid                                                                                                                                                                                           |
| APKA | Publieke sleutel                                                                                                                                                                                                            |
| AROA | Rol                                                                                                                                                                                                                  |
| ASCA | Sertifikaat                                                                                                                                                                                                           |
| ASIA | [Tydelike (AWS STS) toegangssleutel ID's](https://docs.aws.amazon.com/STS/latest/APIReference/API\_Credentials.html) gebruik hierdie voorvoegsel, maar is uniek slegs in kombinasie met die geheime toegangssleutel en die sessie token. |

### Aanbevole toestemmings om rekeninge te oudit

Die volgende voorregte gee verskeie lees toegang van metadata:

* `arn:aws:iam::aws:policy/SecurityAudit`
* `arn:aws:iam::aws:policy/job-function/ViewOnlyAccess`
* `codebuild:ListProjects`
* `config:Describe*`
* `cloudformation:ListStacks`
* `logs:DescribeMetricFilters`
* `directconnect:DescribeConnections`
* `dynamodb:ListTables`

## Verskeie

### CLI Verifikasie

Om 'n gewone gebruiker te laat verifieer na AWS via CLI moet jy **lokale geloofsbriewe** h√™. Standaard kan jy dit **manueel** konfigureer in `~/.aws/credentials` of deur **te hardloop** `aws configure`.\
In daardie l√™er kan jy meer as een profiel h√™, as **geen profiel** gespesifiseer word deur die **aws cli** te gebruik, sal die een genaamd **`[default]`** in daardie l√™er gebruik word.\
Voorbeeld van geloofsbriewe l√™er met meer as 1 profiel:
```
[default]
aws_access_key_id = AKIA5ZDCUJHF83HDTYUT
aws_secret_access_key = uOcdhof683fbOUGFYEQug8fUGIf68greoihef

[Admin]
aws_access_key_id = AKIA8YDCu7TGTR356SHYT
aws_secret_access_key = uOcdhof683fbOUGFYEQuR2EIHG34UY987g6ff7
region = eu-west-2
```
As jy toegang tot **verskillende AWS-rekeninge** nodig het en jou profiel toegang gegee is om **'n rol binne daardie rekeninge aan te neem**, hoef jy nie elke keer handmatig STS aan te roep nie (`aws sts assume-role --role-arn <role-arn> --role-session-name sessname`) en die geloofsbriewe te konfigureer nie.

Jy kan die `~/.aws/config`-l√™er gebruik om [**aan te dui watter rolle aangeneem moet word**](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-role.html), en dan die `--profile`-parameter soos gewoonlik gebruik (die `assume-role` sal op 'n deursigtige manier vir die gebruiker uitgevoer word).\
'n Voorbeeld van 'n konfigurasiel√™er:
```
[profile acc2]
region=eu-west-2
role_arn=arn:aws:iam::<account-id>:role/<role-path>
role_session_name = <session_name>
source_profile = <profile_with_assume_role>
sts_regional_endpoints = regional
```
Met hierdie konfigurasiel√™er kan jy dan aws cli gebruik soos:
```
aws --profile acc2 ...
```
As jy op soek is na iets **soortgelyk** aan hierdie maar vir die **blaaier**, kan jy die **uitbreiding** [**AWS Extend Switch Roles**](https://chrome.google.com/webstore/detail/aws-extend-switch-roles/jpmkfafbacpgapdghgdpembnojdlgkdl?hl=en) nagaan.

## Verwysings

* [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html)
* [https://aws.amazon.com/iam/](https://aws.amazon.com/iam/)
* [https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html](https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html)

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking tricks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
