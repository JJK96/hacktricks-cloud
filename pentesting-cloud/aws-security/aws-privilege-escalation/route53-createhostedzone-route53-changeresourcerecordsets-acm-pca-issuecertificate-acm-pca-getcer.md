# AWS - Route53 Ανύψωση Προνομίων

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 στην [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ υποβάλλοντας PRs** στα αποθετήρια του [**HackTricks**](https://github.com/carlospolop/hacktricks) και του [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

Για περισσότερες πληροφορίες σχετικά με το Route53 ελέγξτε:

{% content-ref url="../aws-services/aws-route53-enum.md" %}
[aws-route53-enum.md](../aws-services/aws-route53-enum.md)
{% endcontent-ref %}

### `route53:CreateHostedZone`, `route53:ChangeResourceRecordSets`, `acm-pca:IssueCertificate`, `acm-pca:GetCertificate`

{% hint style="info" %}
Για να εκτελεστεί αυτή η επίθεση, ο λογαριασμός στόχος πρέπει να έχει ήδη μια [**Αρχή Πιστοποίησης Ιδιωτικού Πιστοποιητικού Διαχειριστή Πιστοποιητικών του AWS**](https://aws.amazon.com/certificate-manager/private-certificate-authority/) **(AWS-PCA)** στον λογαριασμό, και οι EC2 instances στα VPC(s) πρέπει να έχουν ήδη εισαγάγει τα πιστοποιητικά για να το εμπιστευτούν. Με αυτήν την υποδομή στη θέση της, μπορεί να εκτελεστεί η ακόλουθη επίθεση για την παρεμπόδιση της κίνησης του AWS API.
{% endhint %}

Άλλες άδειες **συνιστώνται αλλά δεν απαιτούνται για το μέρος της απαρίθμησης**: `route53:GetHostedZone`, `route53:ListHostedZones`, `acm-pca:ListCertificateAuthorities`, `ec2:DescribeVpcs`

Υποθέτοντας ότι υπάρχει ένα AWS VPC με πολλές εφαρμογές cloud-native που επικοινωνούν μεταξύ τους και με το AWS API. Καθώς η επικοινωνία μεταξύ των μικρουπηρεσιών είναι συχνά κρυπτογραφημένη με TLS, πρέπει να υπάρχει μια ιδιωτική Αρχή Πιστοποίησης για να εκδώσει τα έγκυρα πιστοποιητικά για αυτές τις υπηρεσίες. **Αν χρησιμοποιείται το ACM-PCA** γι' αυτό και ο εχθρός καταφέρει να έχει **πρόσβαση για να ελέγχει τόσο το route53 όσο και το acm-pca ιδιωτική Αρχή Πιστοποίησης** με το ελάχιστο σύνολο δικαιωμάτων που περιγράφονται παραπάνω, μπορεί να **απαγάγει τις κλήσεις της εφαρμογής στο AWS API** παίρνοντας τα δικαιώματα IAM τους.

Αυτό είναι δυνατό επειδή:

* Τα SDK του AWS δεν έχουν [Καρφίτσωμα Πιστοποιητικού](https://www.digicert.com/blog/certificate-pinning-what-is-certificate-pinning)
* Το Route53 επιτρέπει τη δημιουργία Ιδιωτικής Φιλοξενούμενης Ζώνης και εγγραφών DNS για τα ονόματα τομέων του AWS API
* Η Ιδιωτική Αρχή Πιστοποίησης στο ACM-PCA δεν μπορεί να περιοριστεί στο να υπογράφει μόνο πιστοποιητικά για συγκεκριμένα Κοινά Ονόματα

**Πιθανή Επίπτωση:** Έμμεση ανύψωση προνομίων με την παρεμπόδιση ευαίσθητων πληροφοριών στην κίνηση.

#### Εκμετάλλευση <a href="#discovery" id="discovery"></a>

Βρείτε τα βήματα εκμετάλλευσης στην αρχική έρευνα: [**https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/**](https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/)

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 στην [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ υποβάλλοντας PRs** στα αποθετήρια του [**HackTricks**](https://github.com/carlospolop/hacktricks) και του [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
