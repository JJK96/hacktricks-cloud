# AWS - Route53 Escalazione dei Privilegi

{% hint style="success" %}
Impara e pratica l'Hacking AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line"> [**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte) <img src="/.gitbook/assets/image.png" alt="" data-size="line"> \
Impara e pratica l'Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line"> [**HackTricks Training GCP Red Team Expert (GRTE)** <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Sostieni HackTricks</summary>

- Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
- **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
- **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repository di GitHub.

</details>
{% endhint %}

Per ulteriori informazioni su Route53, controlla:

{% content-ref url="../aws-services/aws-route53-enum.md" %}
[aws-route53-enum.md](../aws-services/aws-route53-enum.md)
{% endcontent-ref %}

### `route53:CreateHostedZone`, `route53:ChangeResourceRecordSets`, `acm-pca:IssueCertificate`, `acm-pca:GetCertificate`

{% hint style="info" %}
Per eseguire questo attacco, l'account di destinazione deve gi√† avere un [**Certificato di Autorit√† Privata del Gestore di Certificati AWS**](https://aws.amazon.com/certificate-manager/private-certificate-authority/) **(AWS-PCA)** configurato nell'account, e le istanze EC2 nelle VPC devono aver gi√† importato i certificati per fidarsi di esso. Con questa infrastruttura in atto, l'attacco seguente pu√≤ essere eseguito per intercettare il traffico API AWS.
{% endhint %}

Altre autorizzazioni **raccomandate ma non necessarie per la parte di enumerazione**: `route53:GetHostedZone`, `route53:ListHostedZones`, `acm-pca:ListCertificateAuthorities`, `ec2:DescribeVpcs`

Supponendo che ci sia una VPC AWS con diverse applicazioni native per il cloud che comunicano tra loro e con l'API AWS. Poich√© la comunicazione tra i microservizi √® spesso crittografata con TLS, deve esserci un CA privato per emettere i certificati validi per quei servizi. **Se ACM-PCA viene utilizzato** per questo e il malintenzionato riesce ad avere **accesso al controllo sia di route53 che di acm-pca private CA** con il minimo set di autorizzazioni descritte sopra, pu√≤ **intercettare le chiamate dell'applicazione all'API AWS** assumendo il controllo delle loro autorizzazioni IAM.

Questo √® possibile perch√©:

- Gli SDK AWS non hanno il [Pinning del Certificato](https://www.digicert.com/blog/certificate-pinning-what-is-certificate-pinning)
- Route53 consente di creare una Zona Ospitata Privata e record DNS per i nomi di dominio delle API AWS
- Il CA privato in ACM-PCA non pu√≤ essere limitato a firmare solo certificati per nomi comuni specifici

**Impatto Potenziale:** Escalazione dei privilegi indiretta intercettando informazioni sensibili nel traffico.

#### Sfruttamento <a href="#discovery" id="discovery"></a>

Trova i passaggi di sfruttamento nella ricerca originale: [**https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/**](https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/)

{% hint style="success" %}
Impara e pratica l'Hacking AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line"> [**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte) <img src="/.gitbook/assets/image.png" alt="" data-size="line"> \
Impara e pratica l'Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line"> [**HackTricks Training GCP Red Team Expert (GRTE)** <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Sostieni HackTricks</summary>

- Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
- **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
- **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repository di GitHub.

</details>
{% endhint %}
