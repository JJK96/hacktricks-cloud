# AWS - Route53 Privesc

{% hint style="success" %}
Leer & oefen AWS Hack:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hack: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Controleer die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
{% endhint %}

Vir meer inligting oor Route53 kyk:

{% content-ref url="../aws-services/aws-route53-enum.md" %}
[aws-route53-enum.md](../aws-services/aws-route53-enum.md)
{% endcontent-ref %}

### `route53:CreateHostedZone`, `route53:ChangeResourceRecordSets`, `acm-pca:IssueCertificate`, `acm-pca:GetCertificate`

{% hint style="info" %}
Om hierdie aanval uit te voer, moet die teikengebruikersrekening reeds 'n [**AWS Certificate Manager Private Certificate Authority**](https://aws.amazon.com/certificate-manager/private-certificate-authority/) **(AWS-PCA)** opstel in die rekening, en EC2-instanies in die VPC(s) moet reeds die sertifikate ingevoer het om dit te vertrou. Met hierdie infrastruktuur op sy plek kan die volgende aanval uitgevoer word om AWS API-verkeer te onderskep.
{% endhint %}

Ander toestemmings **word aanbeveel maar nie vereis vir die opname nie**: `route53:GetHostedZone`, `route53:ListHostedZones`, `acm-pca:ListCertificateAuthorities`, `ec2:DescribeVpcs`

Assumeer daar is 'n AWS VPC met verskeie wolk-inheemse toepassings wat met mekaar en met die AWS API praat. Aangesien die kommunikasie tussen die mikrodienste dikwels TLS-gekripteer is, moet daar 'n private CA wees om die geldige sertifikate vir daardie dienste uit te reik. **As ACM-PCA daarvoor gebruik word** en die teenstander daarin slaag om **toegang te kry tot beide route53 en acm-pca private CA** met die minimum stel toestemmings wat hierbo beskryf word, kan dit die aansoeke se oproepe na die AWS API **kaap en hul IAM-toestemmings oorneem**.

Dit is moontlik omdat:

* AWS SDK's het nie [Sertifikaatpenning](https://www.digicert.com/blog/certificate-pinning-what-is-certificate-pinning)
* Route53 maak dit moontlik om 'n Privaat Gehuisvese Sone en DNS-rekords vir AWS API-domeinname te skep
* Privaat CA in ACM-PCA kan nie beperk word om slegs sertifikate vir spesifieke Gemeenskaplike Name te teken nie

**Potensi√´le Impak:** Indirekte privesk deur die onderskepping van sensitiewe inligting in die verkeer.

#### Uitbuiting <a href="#discovery" id="discovery"></a>

Vind die uitbuitingsstappe in die oorspronklike navorsing: [**https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/**](https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/)

{% hint style="success" %}
Leer & oefen AWS Hack:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hack: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Controleer die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
{% endhint %}
