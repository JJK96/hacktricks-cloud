# AWS - Route53 Yetki Yükseltme

{% hint style="success" %}
AWS Hacking'i öğrenin ve uygulayın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking püf noktalarını paylaşarak PR'ler göndererek HackTricks ve HackTricks Cloud github depolarına katkıda bulunun.**

</details>
{% endhint %}

Route53 hakkında daha fazla bilgi için şu adrese bakın:

{% content-ref url="../aws-services/aws-route53-enum.md" %}
[aws-route53-enum.md](../aws-services/aws-route53-enum.md)
{% endcontent-ref %}

### `route53:CreateHostedZone`, `route53:ChangeResourceRecordSets`, `acm-pca:IssueCertificate`, `acm-pca:GetCertificate`

{% hint style="info" %}
Bu saldırıyı gerçekleştirmek için hedef hesabın zaten bir [**AWS Sertifika Yöneticisi Özel Sertifika Yetkilisi**](https://aws.amazon.com/certificate-manager/private-certificate-authority/) **(AWS-PCA)** kurulumuna sahip olması ve VPC(ler) içindeki EC2 örneklerinin zaten güvenmesi için sertifikaları içe aktarmış olması gerekmektedir. Bu altyapı mevcut olduğunda, aşağıdaki saldırı AWS API trafiğini ele geçirmek için gerçekleştirilebilir.
{% endhint %}

Diğer izinler **enumarasyon için önerilir ancak zorunlu değildir**: `route53:GetHostedZone`, `route53:ListHostedZones`, `acm-pca:ListCertificateAuthorities`, `ec2:DescribeVpcs`

Bir AWS VPC'sinin birbirleriyle ve AWS API'leriyle iletişim kuran birden fazla bulut doğal uygulamaya sahip olduğunu varsayalım. Mikroservisler arasındaki iletişim genellikle TLS şifreli olduğundan, bu hizmetler için geçerli sertifikaları vermek için özel bir CA olmalıdır. **Eğer ACM-PCA bunun için kullanılıyorsa** ve saldırgan **hem route53'ü hem de acm-pca özel CA'yı kontrol etmeyi başarırsa** yukarıda tanımlanan minimum izin seti ile, uygulama çağrılarını AWS API'lerine ele geçirerek bunların IAM izinlerini ele geçirebilir.

Bu mümkündür çünkü:

* AWS SDK'larına [Sertifika Pinleme](https://www.digicert.com/blog/certificate-pinning-what-is-certificate-pinning) özelliği yoktur
* Route53, AWS API'leri alan adları için Özel Barındırılan Bölge ve DNS kayıtları oluşturmaya izin verir
* ACM-PCA'daki Özel CA, yalnızca belirli Ortak Adlar için sertifika imzalamaya kısıtlanamaz

**Potansiyel Etki:** Trafikte hassas bilgileri ele geçirerek dolaylı yetki yükseltme.

#### Sömürü <a href="#discovery" id="discovery"></a>

Orijinal araştırmada sömürü adımlarını bulun: [**https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/**](https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/)

{% hint style="success" %}
AWS Hacking'i öğrenin ve uygulayın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking püf noktalarını paylaşarak PR'ler göndererek HackTricks ve HackTricks Cloud github depolarına katkıda bulunun.**

</details>
{% endhint %}
