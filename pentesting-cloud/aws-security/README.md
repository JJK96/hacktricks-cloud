# AWS Pentesting

{% hint style="success" %}
Μάθετε και εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε και εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Δείτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Βασικές Πληροφορίες

**Πριν ξεκινήσετε το pentesting** σε ένα περιβάλλον **AWS** υπάρχουν μερικά **βασικά πράγματα που πρέπει να γνωρίζετε** για το πώς λειτουργεί το AWS για να σας βοηθήσουν να κατανοήσετε τι πρέπει να κάνετε, πώς να βρείτε misconfigurations και πώς να τα εκμεταλλευτείτε.

Έννοιες όπως η ιεραρχία της οργάνωσης, το IAM και άλλες βασικές έννοιες εξηγούνται στο:

{% content-ref url="aws-basic-information/" %}
[aws-basic-information](aws-basic-information/)
{% endcontent-ref %}

## Εργαστήρια για μάθηση

* [https://github.com/RhinoSecurityLabs/cloudgoat](https://github.com/RhinoSecurityLabs/cloudgoat)
* [https://github.com/BishopFox/iam-vulnerable](https://github.com/BishopFox/iam-vulnerable)
* [https://github.com/nccgroup/sadcloud](https://github.com/nccgroup/sadcloud)
* [https://github.com/bridgecrewio/terragoat](https://github.com/bridgecrewio/terragoat)
* [https://github.com/ine-labs/AWSGoat](https://github.com/ine-labs/AWSGoat)
* [http://flaws.cloud/](http://flaws.cloud/)
* [http://flaws2.cloud/](http://flaws2.cloud/)

Εργαλεία για προσομοίωση επιθέσεων:

* [https://github.com/Datadog/stratus-red-team/](https://github.com/Datadog/stratus-red-team/)
* [https://github.com/sbasu7241/AWS-Threat-Simulation-and-Detection/tree/main](https://github.com/sbasu7241/AWS-Threat-Simulation-and-Detection/tree/main)

## Μεθοδολογία AWS Pentester/Red Team

Για να ελέγξετε ένα περιβάλλον AWS είναι πολύ σημαντικό να γνωρίζετε: ποιες **υπηρεσίες χρησιμοποιούνται**, τι **εκτίθεται**, ποιος έχει **πρόσβαση** σε τι, και πώς συνδέονται οι εσωτερικές υπηρεσίες AWS με **εξωτερικές υπηρεσίες**.

Από την άποψη του Red Team, το **πρώτο βήμα για να παραβιάσετε ένα περιβάλλον AWS** είναι να καταφέρετε να αποκτήσετε κάποια **διαπιστευτήρια**. Εδώ έχετε μερικές ιδέες για το πώς να το κάνετε αυτό:

* **Leaks** στο github (ή παρόμοια) - OSINT
* **Κοινωνική** Μηχανική
* **Επαναχρησιμοποίηση** κωδικών πρόσβασης (password leaks)
* Ευπάθειες σε εφαρμογές που φιλοξενούνται στο AWS
* [**Server Side Request Forgery**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf) με πρόσβαση στο metadata endpoint
* **Τοπική Ανάγνωση Αρχείων**
* `/home/USERNAME/.aws/credentials`
* `C:\Users\USERNAME\.aws\credentials`
* Παραβιασμένοι **τρίτοι**
* **Εσωτερικός** Υπάλληλος
* [**Cognito** ](aws-services/aws-cognito-enum/#cognito)credentials

Ή παραβιάζοντας μια **μη αυθεντικοποιημένη υπηρεσία** που εκτίθεται:

{% content-ref url="aws-unauthenticated-enum-access/" %}
[aws-unauthenticated-enum-access](aws-unauthenticated-enum-access/)
{% endcontent-ref %}

Ή αν κάνετε μια **ανασκόπηση** μπορείτε απλά να **ζητήσετε διαπιστευτήρια** με αυτούς τους ρόλους:

{% content-ref url="aws-permissions-for-a-pentest.md" %}
[aws-permissions-for-a-pentest.md](aws-permissions-for-a-pentest.md)
{% endcontent-ref %}

{% hint style="info" %}
Αφού καταφέρετε να αποκτήσετε διαπιστευτήρια, πρέπει να γνωρίζετε **σε ποιον ανήκουν αυτά τα διαπιστευτήρια**, και **σε τι έχουν πρόσβαση**, οπότε πρέπει να εκτελέσετε κάποια βασική απαρίθμηση:
{% endhint %}

## Βασική Απαρίθμηση

### SSRF

Αν βρείτε ένα SSRF σε μια μηχανή μέσα στο AWS, ελέγξτε αυτή τη σελίδα για κόλπα:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### Whoami

Ένα από τα πρώτα πράγματα που πρέπει να γνωρίζετε είναι ποιος είστε (σε ποιον λογαριασμό βρίσκεστε και άλλες πληροφορίες για το περιβάλλον AWS):
```bash
# Easiest way, but might be monitored?
aws sts get-caller-identity
aws iam get-user # This will get your own user

# If you have a Key ID
aws sts get-access-key-info --access-key-id=ASIA1234567890123456

# Get inside error message
aws sns publish --topic-arn arn:aws:sns:us-east-1:*account id*:aaa --message aaa

# From metadata
TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"`
curl -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/dynamic/instance-identity/document
```
{% hint style="danger" %}
Σημειώστε ότι οι εταιρείες μπορεί να χρησιμοποιούν **canary tokens** για να εντοπίζουν πότε **κλέβονται και χρησιμοποιούνται tokens**. Συνιστάται να ελέγξετε αν ένα token είναι canary token ή όχι πριν το χρησιμοποιήσετε.\
Για περισσότερες πληροφορίες [**ελέγξτε αυτή τη σελίδα**](aws-services/aws-security-and-detection-services/aws-cloudtrail-enum.md#honeytokens-bypass).
{% endhint %}

### Org Enumeration

{% content-ref url="aws-services/aws-organizations-enum.md" %}
[aws-organizations-enum.md](aws-services/aws-organizations-enum.md)
{% endcontent-ref %}

### IAM Enumeration

Αν έχετε αρκετά δικαιώματα, **ο έλεγχος των προνομίων κάθε οντότητας μέσα στον λογαριασμό AWS** θα σας βοηθήσει να κατανοήσετε τι μπορείτε να κάνετε εσείς και άλλες ταυτότητες και πώς να **κλιμακώσετε τα προνόμια**.

Αν δεν έχετε αρκετά δικαιώματα για να απαριθμήσετε το IAM, μπορείτε να **κλέψετε ή να τα βρείτε με brute force** για να τα καταλάβετε.\
Ελέγξτε **πώς να κάνετε την απαρίθμηση και το brute-forcing** στο:

{% content-ref url="aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](aws-services/aws-iam-enum.md)
{% endcontent-ref %}

{% hint style="info" %}
Τώρα που **έχετε κάποιες πληροφορίες για τα διαπιστευτήριά σας** (και αν είστε red team ελπίζουμε ότι **δεν έχετε εντοπιστεί**). Είναι ώρα να καταλάβετε ποιες υπηρεσίες χρησιμοποιούνται στο περιβάλλον.\
Στην επόμενη ενότητα μπορείτε να ελέγξετε μερικούς τρόπους για να **απαριθμήσετε μερικές κοινές υπηρεσίες.**
{% endhint %}

## Services Enumeration, Post-Exploitation & Persistence

Η AWS έχει έναν εκπληκτικό αριθμό υπηρεσιών, στην επόμενη σελίδα θα βρείτε **βασικές πληροφορίες, cheatsheets απαρίθμησης**, πώς να **αποφύγετε τον εντοπισμό**, να αποκτήσετε **μονιμότητα**, και άλλα κόλπα **μετά την εκμετάλλευση** για μερικές από αυτές:

{% content-ref url="aws-services/" %}
[aws-services](aws-services/)
{% endcontent-ref %}

Σημειώστε ότι **δεν** χρειάζεται να κάνετε όλη τη δουλειά **χειροκίνητα**, παρακάτω σε αυτή την ανάρτηση μπορείτε να βρείτε μια **ενότητα για** [**αυτόματα εργαλεία**](./#automated-tools).

Επιπλέον, σε αυτό το στάδιο μπορεί να έχετε ανακαλύψει **περισσότερες υπηρεσίες εκτεθειμένες σε μη αυθεντικοποιημένους χρήστες**, μπορεί να είστε σε θέση να τις εκμεταλλευτείτε:

{% content-ref url="aws-unauthenticated-enum-access/" %}
[aws-unauthenticated-enum-access](aws-unauthenticated-enum-access/)
{% endcontent-ref %}

## Privilege Escalation

Αν μπορείτε να **ελέγξετε τουλάχιστον τα δικά σας δικαιώματα** σε διάφορους πόρους, θα μπορούσατε να **ελέγξετε αν μπορείτε να αποκτήσετε περαιτέρω δικαιώματα**. Θα πρέπει να εστιάσετε τουλάχιστον στα δικαιώματα που αναφέρονται στο:

{% content-ref url="aws-privilege-escalation/" %}
[aws-privilege-escalation](aws-privilege-escalation/)
{% endcontent-ref %}

## Publicly Exposed Services

Κατά την απαρίθμηση των υπηρεσιών AWS μπορεί να έχετε βρει μερικές από αυτές **να εκθέτουν στοιχεία στο Διαδίκτυο** (θύρες VM/Containers, βάσεις δεδομένων ή υπηρεσίες ουράς, snapshots ή buckets...).\
Ως pentester/red teamer θα πρέπει πάντα να ελέγχετε αν μπορείτε να βρείτε **ευαίσθητες πληροφορίες / ευπάθειες** σε αυτές καθώς μπορεί να σας παρέχουν **περαιτέρω πρόσβαση στον λογαριασμό AWS**.

Σε αυτό το βιβλίο θα βρείτε **πληροφορίες** για το πώς να βρείτε **εκτεθειμένες υπηρεσίες AWS και πώς να τις ελέγξετε**. Για το πώς να βρείτε **ευπάθειες σε εκτεθειμένες δικτυακές υπηρεσίες** θα σας συνιστούσα να **αναζητήσετε** την συγκεκριμένη **υπηρεσία** στο:

{% embed url="https://book.hacktricks.xyz/" %}

## Compromising the Organization

### From the root/management account

Όταν ο λογαριασμός διαχείρισης δημιουργεί νέους λογαριασμούς στην οργάνωση, δημιουργείται ένας **νέος ρόλος** στον νέο λογαριασμό, ο οποίος ονομάζεται από προεπιλογή **`OrganizationAccountAccessRole`** και δίνει την πολιτική **AdministratorAccess** στον **λογαριασμό διαχείρισης** για πρόσβαση στον νέο λογαριασμό.

<figure><img src="../../.gitbook/assets/image (171).png" alt=""><figcaption></figcaption></figure>

Έτσι, για να αποκτήσετε πρόσβαση ως διαχειριστής σε έναν υπολογαριασμό χρειάζεστε:

* **Να παραβιάσετε** τον **λογαριασμό διαχείρισης** και να βρείτε το **ID** των **υπολογαριασμών** και τα **ονόματα** των **ρόλων** (OrganizationAccountAccessRole από προεπιλογή) που επιτρέπουν στον λογαριασμό διαχείρισης να έχει πρόσβαση ως διαχειριστής.
* Για να βρείτε τους υπολογαριασμούς, πηγαίνετε στην ενότητα οργανισμών στην κονσόλα aws ή εκτελέστε `aws organizations list-accounts`
* Δεν μπορείτε να βρείτε τα ονόματα των ρόλων απευθείας, οπότε ελέγξτε όλες τις προσαρμοσμένες πολιτικές IAM και αναζητήστε οποιαδήποτε επιτρέπει **`sts:AssumeRole` στους προηγουμένως ανακαλυφθέντες υπολογαριασμούς**.
* **Να παραβιάσετε** έναν **principal** στον λογαριασμό διαχείρισης με **`sts:AssumeRole` δικαίωμα στον ρόλο στους υπολογαριασμούς** (ακόμα και αν ο λογαριασμός επιτρέπει σε οποιονδήποτε από τον λογαριασμό διαχείρισης να υποδυθεί, καθώς είναι εξωτερικός λογαριασμός, είναι απαραίτητα συγκεκριμένα δικαιώματα `sts:AssumeRole`).

## Automated Tools

### Recon

* [**aws-recon**](https://github.com/darkbitio/aws-recon): Ένα πολυνηματικό εργαλείο **συλλογής αποθεμάτων** ασφαλείας AWS γραμμένο σε Ruby.
```bash
# Install
gem install aws_recon

# Recon and get json
AWS_PROFILE=<profile> aws_recon \
--services S3,EC2 \
--regions global,us-east-1,us-east-2 \
--verbose
```
* [**cloudlist**](https://github.com/projectdiscovery/cloudlist): Το Cloudlist είναι ένα **εργαλείο πολλαπλών cloud για την απόκτηση Περιουσιακών Στοιχείων** (Ονόματα Υποδοχής, Διευθύνσεις IP) από Παρόχους Cloud.
* [**cloudmapper**](https://github.com/duo-labs/cloudmapper): Το CloudMapper σας βοηθά να αναλύσετε τα περιβάλλοντα Amazon Web Services (AWS). Τώρα περιέχει πολύ περισσότερη λειτουργικότητα, συμπεριλαμβανομένου του ελέγχου για ζητήματα ασφαλείας.
```bash
# Installation steps in github
# Create a config.json file with the aws info, like:
{
"accounts": [
{
"default": true,
"id": "<account id>",
"name": "dev"
}
],
"cidrs":
{
"2.2.2.2/28": {"name": "NY Office"}
}
}

# Enumerate
python3 cloudmapper.py collect --profile dev
## Number of resources discovered
python3 cloudmapper.py stats --accounts dev

# Create HTML report
## In the report you will find all the info already
python3 cloudmapper.py report --accounts dev

# Identify potential issues
python3 cloudmapper.py audit --accounts dev --json > audit.json
python3 cloudmapper.py audit --accounts dev --markdow > audit.md
python3 cloudmapper.py iam_report --accounts dev

# Identify admins
## The permissions search for are in https://github.com/duo-labs/cloudmapper/blob/4df9fd7303e0337ff16a08f5e58f1d46047c4a87/shared/iam_audit.py#L163-L175
python3 cloudmapper.py find_admins --accounts dev

# Identify unused elements
python3 cloudmapper.py find_unused --accounts dev

# Identify publivly exposed resources
python3 cloudmapper.py public --accounts dev

python cloudmapper.py prepare #Prepare webserver
python cloudmapper.py webserver #Show webserver
```
* [**cartography**](https://github.com/lyft/cartography): Το Cartography είναι ένα εργαλείο Python που ενοποιεί τα περιουσιακά στοιχεία της υποδομής και τις σχέσεις μεταξύ τους σε μια διαισθητική γραφική προβολή που υποστηρίζεται από μια βάση δεδομένων Neo4j.
```bash
# Install
pip install cartography
## At the time of this writting you need neo4j version 3.5.*

# Get AWS info
AWS_PROFILE=dev cartography --neo4j-uri bolt://127.0.0.1:7687 --neo4j-password-prompt  --neo4j-user neo4j
```
* [**starbase**](https://github.com/JupiterOne/starbase): Το Starbase συλλέγει στοιχεία και σχέσεις από υπηρεσίες και συστήματα, συμπεριλαμβανομένων cloud υποδομών, SaaS εφαρμογών, ελέγχων ασφαλείας και άλλων, σε μια διαισθητική γραφική απεικόνιση που υποστηρίζεται από τη βάση δεδομένων Neo4j.
* [**aws-inventory**](https://github.com/nccgroup/aws-inventory): (Χρησιμοποιεί python2) Αυτό είναι ένα εργαλείο που προσπαθεί να **ανακαλύψει όλους τους** [**AWS πόρους**](https://docs.aws.amazon.com/general/latest/gr/glos-chap.html#resource) που έχουν δημιουργηθεί σε έναν λογαριασμό.
* [**aws\_public\_ips**](https://github.com/arkadiyt/aws\_public\_ips): Είναι ένα εργαλείο για να **ανακτήσει όλες τις δημόσιες διευθύνσεις IP** (τόσο IPv4/IPv6) που σχετίζονται με έναν λογαριασμό AWS.

### Privesc & Exploiting

* [**SkyArk**](https://github.com/cyberark/SkyArk)**:** Ανακαλύψτε τους πιο προνομιούχους χρήστες στο σαρωμένο περιβάλλον AWS, συμπεριλαμβανομένων των AWS Shadow Admins. Χρησιμοποιεί powershell. Μπορείτε να βρείτε τον **ορισμό των προνομιούχων πολιτικών** στη λειτουργία **`Check-PrivilegedPolicy`** στο [https://github.com/cyberark/SkyArk/blob/master/AWStealth/AWStealth.ps1](https://github.com/cyberark/SkyArk/blob/master/AWStealth/AWStealth.ps1).
* [**pacu**](https://github.com/RhinoSecurityLabs/pacu): Το Pacu είναι ένα ανοιχτού κώδικα **AWS exploitation framework**, σχεδιασμένο για επιθετική ασφάλεια δοκιμών σε cloud περιβάλλοντα. Μπορεί να **καταγράψει**, να βρει **λανθασμένες διαμορφώσεις** και να τις **εκμεταλλευτεί**. Μπορείτε να βρείτε τον **ορισμό των προνομιούχων αδειών** στο [https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/iam\_\_privesc\_scan/main.py#L134](https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/iam\_\_privesc\_scan/main.py#L134) μέσα στο dict **`user_escalation_methods`**.
* Σημειώστε ότι το pacu **ελέγχει μόνο τα δικά σας privescs paths** (όχι σε όλο τον λογαριασμό).
```bash
# Install
## Feel free to use venvs
pip3 install pacu

# Use pacu CLI
pacu
> import_keys <profile_name> # import 1 profile from .aws/credentials
> import_keys --all # import all profiles
> list # list modules
> exec iam__enum_permissions # Get permissions
> exec iam__privesc_scan # List privileged permissions
```
* [**PMapper**](https://github.com/nccgroup/PMapper): Το Principal Mapper (PMapper) είναι ένα script και βιβλιοθήκη για τον εντοπισμό κινδύνων στη διαμόρφωση του AWS Identity and Access Management (IAM) για έναν λογαριασμό AWS ή έναν οργανισμό AWS. Μοντελοποιεί τους διάφορους IAM Users και Roles σε έναν λογαριασμό ως κατευθυνόμενο γράφημα, το οποίο επιτρέπει ελέγχους για **privilege escalation** και για εναλλακτικές διαδρομές που θα μπορούσε να ακολουθήσει ένας επιτιθέμενος για να αποκτήσει πρόσβαση σε έναν πόρο ή ενέργεια στο AWS. Μπορείτε να ελέγξετε τις **permissions used to find privesc** διαδρομές στα αρχεία που τελειώνουν σε `_edges.py` στο [https://github.com/nccgroup/PMapper/tree/master/principalmapper/graphing](https://github.com/nccgroup/PMapper/tree/master/principalmapper/graphing)
```bash
# Install
pip install principalmapper

# Get data
pmapper --profile dev graph create
pmapper --profile dev graph display # Show basic info
# Generate graph
pmapper --profile dev visualize # Generate svg graph file (can also be png, dot and graphml)
pmapper --profile dev visualize --only-privesc # Only privesc permissions

# Generate analysis
pmapper --profile dev analysis
## Run queries
pmapper --profile dev query 'who can do iam:CreateUser'
pmapper --profile dev query 'preset privesc *' # Get privescs with admins

# Get organization hierarchy data
pmapper --profile dev orgs create
pmapper --profile dev orgs display
```
* [**cloudsplaining**](https://github.com/salesforce/cloudsplaining): Το Cloudsplaining είναι ένα εργαλείο αξιολόγησης ασφάλειας AWS IAM που εντοπίζει παραβιάσεις της αρχής των ελάχιστων προνομίων και δημιουργεί μια αναφορά HTML με προτεραιότητα κινδύνου.\
Θα σας δείξει πιθανά **υπερβολικά προνομιούχους** πελάτες, ενσωματωμένες και aws **πολιτικές** και ποιοι **principals έχουν πρόσβαση σε αυτές**. (Δεν ελέγχει μόνο για privesc αλλά και για άλλου είδους ενδιαφέρουσες άδειες, συνιστάται η χρήση).
```bash
# Install
pip install cloudsplaining

# Download IAM policies to check
## Only the ones attached with the versions used
cloudsplaining download --profile dev

# Analyze the IAM policies
cloudsplaining scan --input-file /private/tmp/cloudsplaining/dev.json --output /tmp/files/
```
* [**cloudjack**](https://github.com/prevade/cloudjack): Το CloudJack αξιολογεί λογαριασμούς AWS για **ευπάθειες υποκλοπής υποτομέων** ως αποτέλεσμα αποσυνδεδεμένων διαμορφώσεων Route53 και CloudFront.
* [**ccat**](https://github.com/RhinoSecurityLabs/ccat): List ECR repos -> Pull ECR repo -> Backdoor it -> Push backdoored image
* [**Dufflebag**](https://github.com/bishopfox/dufflebag): Το Dufflebag είναι ένα εργαλείο που **αναζητά** μέσω δημόσιων στιγμιότυπων Elastic Block Storage (**EBS) για μυστικά** που μπορεί να έχουν αφεθεί κατά λάθος.

### Audit

* [**cloudsploit**](https://github.com/aquasecurity/cloudsploit)**:** Το CloudSploit από την Aqua είναι ένα έργο ανοιχτού κώδικα σχεδιασμένο για να επιτρέπει την ανίχνευση **κινδύνων ασφαλείας σε λογαριασμούς υποδομής cloud**, συμπεριλαμβανομένων: Amazon Web Services (AWS), Microsoft Azure, Google Cloud Platform (GCP), Oracle Cloud Infrastructure (OCI), και GitHub (Δεν αναζητά ShadowAdmins).
```bash
./index.js --csv=file.csv --console=table --config ./config.js

# Compiance options: --compliance {hipaa,cis,cis1,cis2,pci}
## use "cis" for cis level 1 and 2
```
* [**Prowler**](https://github.com/prowler-cloud/prowler): Το Prowler είναι ένα εργαλείο ανοιχτού κώδικα για την εκτέλεση αξιολογήσεων βέλτιστων πρακτικών ασφαλείας AWS, ελέγχων, απόκρισης σε περιστατικά, συνεχούς παρακολούθησης, σκλήρυνσης και ετοιμότητας για εγκληματολογικές αναλύσεις.
```bash
# Install python3, jq and git
# Install
pip install prowler
prowler -v

# Run
prowler <provider>
prowler aws --profile custom-profile [-M csv json json-asff html]
```
* [**CloudFox**](https://github.com/BishopFox/cloudfox): Το CloudFox σας βοηθά να αποκτήσετε επίγνωση της κατάστασης σε άγνωστα περιβάλλοντα cloud. Είναι ένα εργαλείο γραμμής εντολών ανοιχτού κώδικα που δημιουργήθηκε για να βοηθήσει τους penetration testers και άλλους επαγγελματίες της επιθετικής ασφάλειας να βρουν εκμεταλλεύσιμα μονοπάτια επίθεσης σε υποδομές cloud.
```bash
cloudfox aws --profile [profile-name] all-checks
```
* [**ScoutSuite**](https://github.com/nccgroup/ScoutSuite): Το Scout Suite είναι ένα εργαλείο ανοιχτού κώδικα για έλεγχο ασφάλειας πολλαπλών cloud, το οποίο επιτρέπει την αξιολόγηση της ασφάλειας των περιβαλλόντων cloud.
```bash
# Install
virtualenv -p python3 venv
source venv/bin/activate
pip install scoutsuite
scout --help

# Get info
scout aws -p dev
```
* [**cs-suite**](https://github.com/SecurityFTW/cs-suite): Cloud Security Suite (χρησιμοποιεί python2.7 και φαίνεται μη συντηρημένο)
* [**Zeus**](https://github.com/DenizParlak/Zeus): Zeus είναι ένα ισχυρό εργαλείο για AWS EC2 / S3 / CloudTrail / CloudWatch / KMS βέλτιστες πρακτικές σκλήρυνσης (φαίνεται μη συντηρημένο). Ελέγχει μόνο προεπιλεγμένα διαμορφωμένα creds μέσα στο σύστημα.

### Συνεχής Έλεγχος

* [**cloud-custodian**](https://github.com/cloud-custodian/cloud-custodian): Cloud Custodian είναι μια μηχανή κανόνων για τη διαχείριση λογαριασμών και πόρων δημόσιου cloud. Επιτρέπει στους χρήστες να **ορίζουν πολιτικές για να επιτρέψουν μια καλά διαχειριζόμενη υποδομή cloud**, που είναι τόσο ασφαλής όσο και βελτιστοποιημένη για κόστος. Ενοποιεί πολλά από τα ad-hoc scripts που έχουν οι οργανισμοί σε ένα ελαφρύ και ευέλικτο εργαλείο, με ενοποιημένες μετρήσεις και αναφορές.
* [**pacbot**](https://github.com/tmobile/pacbot)**: Policy as Code Bot (PacBot)** είναι μια πλατφόρμα για **συνεχή παρακολούθηση συμμόρφωσης, αναφορά συμμόρφωσης και αυτοματοποίηση ασφάλειας για το cloud**. Στο PacBot, οι πολιτικές ασφάλειας και συμμόρφωσης υλοποιούνται ως κώδικας. Όλοι οι πόροι που ανακαλύπτονται από το PacBot αξιολογούνται έναντι αυτών των πολιτικών για να μετρηθεί η συμμόρφωση με τις πολιτικές. Το πλαίσιο **auto-fix** του PacBot παρέχει τη δυνατότητα αυτόματης απόκρισης σε παραβιάσεις πολιτικής με τη λήψη προκαθορισμένων ενεργειών.
* [**streamalert**](https://github.com/airbnb/streamalert)**:** StreamAlert είναι ένα serverless, **πραγματικού χρόνου** πλαίσιο ανάλυσης δεδομένων που σας δίνει τη δυνατότητα να **εισάγετε, αναλύετε και ειδοποιείτε** για δεδομένα από οποιοδήποτε περιβάλλον, **χρησιμοποιώντας πηγές δεδομένων και λογική ειδοποίησης που ορίζετε**. Οι ομάδες ασφάλειας υπολογιστών χρησιμοποιούν το StreamAlert για να σαρώνουν τερραμπάιτ δεδομένων καταγραφής κάθε μέρα για ανίχνευση και απόκριση σε περιστατικά.

## DEBUG: Καταγραφή αιτημάτων AWS cli
```bash
# Set proxy
export HTTP_PROXY=http://localhost:8080
export HTTPS_PROXY=http://localhost:8080

# Capture with burp nor verifying ssl
aws --no-verify-ssl ...

# Dowload brup cert and transform it to pem
curl http://127.0.0.1:8080/cert --output Downloads/certificate.cer
openssl x509 -inform der -in Downloads/certificate.cer -out Downloads/certificate.pem

# Indicate the ca cert to trust
export AWS_CA_BUNDLE=~/Downloads/certificate.pem

# Run aws cli normally trusting burp cert
aws ...
```
## Αναφορές

* [https://www.youtube.com/watch?v=8ZXRw4Ry3mQ](https://www.youtube.com/watch?v=8ZXRw4Ry3mQ)
* [https://cloudsecdocs.com/aws/defensive/tooling/audit/](https://cloudsecdocs.com/aws/defensive/tooling/audit/)

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Γίνετε μέλος της** 💬 [**ομάδας Discord**](https://discord.gg/hRep4RUj7f) ή της [**ομάδας telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}
