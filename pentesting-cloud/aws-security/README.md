# AWS Pentesting

{% hint style="success" %}
AWS Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХреЛ рд╕рдорд░реНрдерди рджреЗрдВ</summary>

* [**subscription plans**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рд╣рдореЗрдВ **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВред**
* **PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>
{% endhint %}

## Basic Information

**AWS environment рдХрд╛ pentesting рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ** рдЖрдкрдХреЛ AWS рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ **рдореВрд▓ рдмрд╛рддреЗрдВ рдЬрд╛рдирдиреА рдЪрд╛рд╣рд┐рдП** рддрд╛рдХрд┐ рдЖрдк рд╕рдордЭ рд╕рдХреЗрдВ рдХрд┐ рдЖрдкрдХреЛ рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ, misconfigurations рдХреИрд╕реЗ рдЦреЛрдЬрдиреА рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдХреИрд╕реЗ exploit рдХрд░рдирд╛ рд╣реИред

рдЬреИрд╕реЗ organization hierarchy, IAM рдФрд░ рдЕрдиреНрдп рдореВрд▓рднреВрдд рдЕрд╡рдзрд╛рд░рдгрд╛рдУрдВ рдХреЛ рд╕рдордЭрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ:

{% content-ref url="aws-basic-information/" %}
[aws-basic-information](aws-basic-information/)
{% endcontent-ref %}

## Labs to learn

* [https://github.com/RhinoSecurityLabs/cloudgoat](https://github.com/RhinoSecurityLabs/cloudgoat)
* [https://github.com/BishopFox/iam-vulnerable](https://github.com/BishopFox/iam-vulnerable)
* [https://github.com/nccgroup/sadcloud](https://github.com/nccgroup/sadcloud)
* [https://github.com/bridgecrewio/terragoat](https://github.com/bridgecrewio/terragoat)
* [https://github.com/ine-labs/AWSGoat](https://github.com/ine-labs/AWSGoat)
* [http://flaws.cloud/](http://flaws.cloud/)
* [http://flaws2.cloud/](http://flaws2.cloud/)

Tools to simulate attacks:

* [https://github.com/Datadog/stratus-red-team/](https://github.com/Datadog/stratus-red-team/)
* [https://github.com/sbasu7241/AWS-Threat-Simulation-and-Detection/tree/main](https://github.com/sbasu7241/AWS-Threat-Simulation-and-Detection/tree/main)

## AWS Pentester/Red Team Methodology

AWS environment рдХрд╛ audit рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЬрд╛рдирдирд╛ рдмрд╣реБрдд рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ: рдХреМрди рд╕реЗ **services рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ**, рдХреНрдпрд╛ **exposed** рд╣реИ, рдХрд┐рд╕рдХреЗ рдкрд╛рд╕ **access** рд╣реИ, рдФрд░ рдЖрдВрддрд░рд┐рдХ AWS services рдФрд░ **рдмрд╛рд╣рд░реА services** рдХреИрд╕реЗ рдЬреБрдбрд╝реЗ рд╣реБрдП рд╣реИрдВред

Red Team рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, **AWS environment рдХреЛ compromise рдХрд░рдиреЗ рдХрд╛ рдкрд╣рд▓рд╛ рдХрджрдо** рдХреБрдЫ **credentials** рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реИред рдпрд╣рд╛рдВ рдХреБрдЫ рд╡рд┐рдЪрд╛рд░ рджрд┐рдП рдЧрдП рд╣реИрдВ рдХрд┐ рдЗрд╕реЗ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

* github (рдпрд╛ рд╕рдорд╛рди) рдореЗрдВ **leaks** - OSINT
* **Social** Engineering
* **Password** reuse (password leaks)
* AWS-Hosted Applications рдореЗрдВ Vulnerabilities
* [**Server Side Request Forgery**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf) metadata endpoint рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд╕рд╛рде
* **Local File Read**
* `/home/USERNAME/.aws/credentials`
* `C:\Users\USERNAME\.aws\credentials`
* 3rd parties **breached**
* **Internal** Employee
* [**Cognito** ](aws-services/aws-cognito-enum/#cognito)credentials

рдпрд╛ **unauthenticated service** рдХреЛ compromise рдХрд░рдХреЗ рдЬреЛ exposed рд╣реИ:

{% content-ref url="aws-unauthenticated-enum-access/" %}
[aws-unauthenticated-enum-access](aws-unauthenticated-enum-access/)
{% endcontent-ref %}

рдпрд╛ рдпрджрд┐ рдЖрдк **review** рдХрд░ рд░рд╣реЗ рд╣реИрдВ рддреЛ рдЖрдк рдмрд╕ рдЗрди roles рдХреЗ рд╕рд╛рде **credentials** рдорд╛рдВрдЧ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="aws-permissions-for-a-pentest.md" %}
[aws-permissions-for-a-pentest.md](aws-permissions-for-a-pentest.md)
{% endcontent-ref %}

{% hint style="info" %}
рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдк credentials рдкреНрд░рд╛рдкреНрдд рдХрд░ рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ **рд╡реЗ credentials рдХрд┐рд╕рдХреЗ рд╣реИрдВ**, рдФрд░ **рдЙрдирдХреЗ рдкрд╛рд╕ рдХреНрдпрд╛ access рд╣реИ**, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдХреБрдЫ рдмреБрдирд┐рдпрд╛рджреА enumeration рдХрд░рдирд╛ рд╣реЛрдЧрд╛:
{% endhint %}

## Basic Enumeration

### SSRF

рдпрджрд┐ рдЖрдкрдиреЗ AWS рдХреЗ рдЕрдВрджрд░ рдХрд┐рд╕реА рдорд╢реАрди рдореЗрдВ SSRF рдкрд╛рдпрд╛ рд╣реИ рддреЛ рдЗрд╕ рдкреЗрдЬ рдкрд░ рдЯреНрд░рд┐рдХреНрд╕ рджреЗрдЦреЗрдВ:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### Whoami

рдкрд╣рд▓реА рдЪреАрдЬреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдЬреЛ рдЖрдкрдХреЛ рдЬрд╛рдирдиреА рдЪрд╛рд╣рд┐рдП рд╡рд╣ рд╣реИ рдХрд┐ рдЖрдк рдХреМрди рд╣реИрдВ (рдХрд┐рд╕ account рдореЗрдВ рдЖрдк рд╣реИрдВ рдФрд░ AWS environment рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдиреНрдп рдЬрд╛рдирдХрд╛рд░реА):
```bash
# Easiest way, but might be monitored?
aws sts get-caller-identity
aws iam get-user # This will get your own user

# If you have a Key ID
aws sts get-access-key-info --access-key-id=ASIA1234567890123456

# Get inside error message
aws sns publish --topic-arn arn:aws:sns:us-east-1:*account id*:aaa --message aaa

# From metadata
TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"`
curl -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/dynamic/instance-identity/document
```
{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрдВрдкрдирд┐рдпрд╛рдВ **canary tokens** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреА рд╣реИрдВ рдпрд╣ рдкрд╣рдЪрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ **tokens рдЪреЛрд░реА рд╣реЛ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ**ред рдЗрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рдЕрдиреБрд╢рдВрд╕рд┐рдд рд╣реИ рдХрд┐ token canary token рд╣реИ рдпрд╛ рдирд╣реАрдВред\
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдЗрд╕ рдкреЗрдЬ рдХреЛ рджреЗрдЦреЗрдВ**](aws-services/aws-security-and-detection-services/aws-cloudtrail-enum.md#honeytokens-bypass)ред
{% endhint %}

### Org Enumeration

{% content-ref url="aws-services/aws-organizations-enum.md" %}
[aws-organizations-enum.md](aws-services/aws-organizations-enum.md)
{% endcontent-ref %}

### IAM Enumeration

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ, рддреЛ **AWS рдЦрд╛рддреЗ рдХреЗ рдЕрдВрджрд░ рдкреНрд░рддреНрдпреЗрдХ рдЗрдХрд╛рдИ рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреА рдЬрд╛рдБрдЪ рдХрд░рдирд╛** рдЖрдкрдХреЛ рдпрд╣ рд╕рдордЭрдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ рдХрд┐ рдЖрдк рдФрд░ рдЕрдиреНрдп рдкрд╣рдЪрд╛рдиреЗрдВ рдХреНрдпрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреИрд╕реЗ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ IAM рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдирд╣реАрдВ рд╣реИрдВ, рддреЛ рдЖрдк рдЙрдиреНрд╣реЗрдВ **bruteforce рдХрд░рдХреЗ рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред\
**рд╕реВрдЪреАрдХрд░рдг рдФрд░ brute-forcing рдХреИрд╕реЗ рдХрд░реЗрдВ** рдЗрд╕рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:

{% content-ref url="aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](aws-services/aws-iam-enum.md)
{% endcontent-ref %}

{% hint style="info" %}
рдЕрдм рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЕрдкрдиреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рдЬрд╛рдирдХрд╛рд░реА рд╣реИ** (рдФрд░ рдпрджрд┐ рдЖрдк рдПрдХ red team рд╣реИрдВ рддреЛ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рдЖрдк **рдкрддрд╛ рдирд╣реАрдВ рдЪрд▓реЗ рд╣реИрдВ**)ред рдЕрдм рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХрд╛ рд╕рдордп рд╣реИ рдХрд┐ рдкрд░реНрдпрд╛рд╡рд░рдг рдореЗрдВ рдХреМрди рд╕реА рд╕реЗрд╡рд╛рдПрдБ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд░рд╣реА рд╣реИрдВред\
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдЖрдк рдХреБрдЫ рд╕рд╛рдорд╛рдиреНрдп рд╕реЗрд╡рд╛рдУрдВ рдХреЛ **рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХреЗ рдХреБрдЫ рддрд░реАрдХреЗ** рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

## Services Enumeration, Post-Exploitation & Persistence

AWS рдореЗрдВ рд╕реЗрд╡рд╛рдУрдВ рдХреА рдПрдХ рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ рдорд╛рддреНрд░рд╛ рд╣реИ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдкрд░ рдЖрдкрдХреЛ **рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА, рд╕реВрдЪреАрдХрд░рдг** cheatsheets\*\*,\*\* **рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рд╕реЗ рдмрдЪрдиреЗ**, **рд╕реНрдерд╛рдпрд┐рддреНрд╡ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ**, рдФрд░ рдЙрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдиреНрдп **post-exploitation** рдЯреНрд░рд┐рдХреНрд╕ рдорд┐рд▓реЗрдВрдЧреЗ:

{% content-ref url="aws-services/" %}
[aws-services](aws-services/)
{% endcontent-ref %}

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдкрдХреЛ **рд╕рд╛рд░рд╛ рдХрд╛рдо рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреЗ рдиреАрдЪреЗ рдЖрдк **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ** [**рдПрдХ рдЕрдиреБрднрд╛рдЧ**](./#automated-tools) рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рдЪрд░рдг рдореЗрдВ рдЖрдкрдиреЗ **рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рд╕реЗрд╡рд╛рдПрдБ рдЙрдЬрд╛рдЧрд░ рдХреА рд╣реЛ рд╕рдХрддреА рд╣реИрдВ**, рдЖрдк рдЙрдиреНрд╣реЗрдВ рд╢реЛрд╖рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="aws-unauthenticated-enum-access/" %}
[aws-unauthenticated-enum-access](aws-unauthenticated-enum-access/)
{% endcontent-ref %}

## Privilege Escalation

рдпрджрд┐ рдЖрдк **рдХрдо рд╕реЗ рдХрдо рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдБрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рд╡рд┐рднрд┐рдиреНрди рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдкрд░ рддреЛ рдЖрдк **рдЕрдзрд┐рдХ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЖрдкрдХреЛ рдХрдо рд╕реЗ рдХрдо рдЙрди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдореЗрдВ рдЗрдВрдЧрд┐рдд рдХреА рдЧрдИ рд╣реИрдВ:

{% content-ref url="aws-privilege-escalation/" %}
[aws-privilege-escalation](aws-privilege-escalation/)
{% endcontent-ref %}

## Publicly Exposed Services

AWS рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рддреЗ рд╕рдордп рдЖрдк рдЙрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдХреЛ **рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рддрддреНрд╡реЛрдВ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рддреЗ рд╣реБрдП** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ (VM/Containers рдкреЛрд░реНрдЯреНрд╕, рдбреЗрдЯрд╛рдмреЗрд╕ рдпрд╛ рдХрддрд╛рд░ рд╕реЗрд╡рд╛рдПрдБ, snapshots рдпрд╛ buckets...)ред\
рдПрдХ pentester/red teamer рдХреЗ рд░реВрдк рдореЗрдВ рдЖрдкрдХреЛ рд╣рдореЗрд╢рд╛ рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдЙрдирдореЗрдВ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА / рдХрдордЬреЛрд░рд┐рдпрд╛рдБ** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдЖрдкрдХреЛ **AWS рдЦрд╛рддреЗ рдореЗрдВ рдФрд░ рдЕрдзрд┐рдХ рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

рдЗрд╕ рдкреБрд╕реНрддрдХ рдореЗрдВ рдЖрдкрдХреЛ **рдЙрдЬрд╛рдЧрд░ AWS рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдФрд░ рдЙрдирдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА** рдорд┐рд▓рдиреА рдЪрд╛рд╣рд┐рдПред рдЙрдЬрд╛рдЧрд░ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВ **рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ** рдореИрдВ рдЖрдкрдХреЛ **рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реЗрд╡рд╛** рдХреЗ рд▓рд┐рдП **рдЦреЛрдЬрдиреЗ** рдХреА рд╕рд▓рд╛рд╣ рджреВрдВрдЧрд╛:

{% embed url="https://book.hacktricks.xyz/" %}

## Compromising the Organization

### From the root/management account

рдЬрдм рдкреНрд░рдмрдВрдзрди рдЦрд╛рддрд╛ рд╕рдВрдЧрдарди рдореЗрдВ рдирдП рдЦрд╛рддреЗ рдмрдирд╛рддрд╛ рд╣реИ, рддреЛ рдПрдХ **рдирдИ рднреВрдорд┐рдХрд╛** рдирдП рдЦрд╛рддреЗ рдореЗрдВ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ, рдЬрд┐рд╕реЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ **`OrganizationAccountAccessRole`** рдирд╛рдо рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ **рдкреНрд░рдмрдВрдзрди рдЦрд╛рддреЗ** рдХреЛ рдирдП рдЦрд╛рддреЗ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП **AdministratorAccess** рдиреАрддрд┐ рджреА рдЬрд╛рддреА рд╣реИред

<figure><img src="../../.gitbook/assets/image (171).png" alt=""><figcaption></figcaption></figure>

рдЗрд╕рд▓рд┐рдП, рдПрдХ child account рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ:

* **рдкреНрд░рдмрдВрдзрди** рдЦрд╛рддреЗ рд╕реЗ **рд╕рдордЭреМрддрд╛** рдХрд░реЗрдВ рдФрд░ **рдмрдЪреНрдЪреЛрдВ рдХреЗ рдЦрд╛рддреЛрдВ** рдХреЗ **ID** рдФрд░ **рднреВрдорд┐рдХрд╛ рдХреЗ рдирд╛рдо** (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ OrganizationAccountAccessRole) рдХреЛ рдЦреЛрдЬреЗрдВ рдЬреЛ рдкреНрд░рдмрдВрдзрди рдЦрд╛рддреЗ рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред
* рдмрдЪреНрдЪреЛрдВ рдХреЗ рдЦрд╛рддреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП aws рдХрдВрд╕реЛрд▓ рдореЗрдВ рд╕рдВрдЧрдардиреЛрдВ рдХреЗ рдЕрдиреБрднрд╛рдЧ рдкрд░ рдЬрд╛рдПрдВ рдпрд╛ `aws organizations list-accounts` рдЪрд▓рд╛рдПрдВ
* рдЖрдк рд╕реАрдзреЗ рднреВрдорд┐рдХрд╛рдУрдВ рдХреЗ рдирд╛рдо рдирд╣реАрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╕рднреА рдХрд╕реНрдЯрдо IAM рдиреАрддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ рдФрд░ рдХрд┐рд╕реА рднреА рдХреЛ рдЦреЛрдЬреЗрдВ рдЬреЛ **`sts:AssumeRole` рдХреЛ рдкрд╣рд▓реЗ рд╕реЗ рдЦреЛрдЬреЗ рдЧрдП рдмрдЪреНрдЪреЛрдВ рдХреЗ рдЦрд╛рддреЛрдВ рдкрд░ рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ**ред
* **рдкреНрд░рдмрдВрдзрди рдЦрд╛рддреЗ** рдореЗрдВ **`sts:AssumeRole` рдЕрдиреБрдорддрд┐** рдХреЗ рд╕рд╛рде **рдПрдХ рдкреНрд░рдореБрдЦ** рд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд░реЗрдВ рдЬреЛ рдмрдЪреНрдЪреЛрдВ рдХреЗ рдЦрд╛рддреЛрдВ рдореЗрдВ рднреВрдорд┐рдХрд╛ рдкрд░ рд╣реИ (рднрд▓реЗ рд╣реА рдЦрд╛рддрд╛ рдХрд┐рд╕реА рдХреЛ рднреА рдкреНрд░рдмрдВрдзрди рдЦрд╛рддреЗ рд╕реЗ рдкреНрд░рддрд┐рд░реВрдкрдг рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд░рд╣рд╛ рд╣реЛ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдПрдХ рдмрд╛рд╣рд░реА рдЦрд╛рддрд╛ рд╣реИ, рд╡рд┐рд╢рд┐рд╖реНрдЯ `sts:AssumeRole` рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВ)ред

## Automated Tools

### Recon

* [**aws-recon**](https://github.com/darkbitio/aws-recon): рдПрдХ рдмрд╣реБ-рдереНрд░реЗрдбреЗрдб AWS рд╕реБрд░рдХреНрд╖рд╛-рдХреЗрдВрджреНрд░рд┐рдд **рдЗрдиреНрд╡реЗрдВрдЯрд░реА рд╕рдВрдЧреНрд░рд╣ рдЙрдкрдХрд░рдг** рдЬреЛ рд░реВрдмреА рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИред
```bash
# Install
gem install aws_recon

# Recon and get json
AWS_PROFILE=<profile> aws_recon \
--services S3,EC2 \
--regions global,us-east-1,us-east-2 \
--verbose
```
* [**cloudlist**](https://github.com/projectdiscovery/cloudlist): Cloudlist рдПрдХ **multi-cloud рдЯреВрд▓ рд╣реИ рдЬреЛ Cloud Providers рд╕реЗ Assets** (Hostnames, IP Addresses) рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИред
* [**cloudmapper**](https://github.com/duo-labs/cloudmapper): CloudMapper рдЖрдкрдХреА Amazon Web Services (AWS) environments рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдореЗрдВ рдЕрдм рдФрд░ рднреА рдЕрдзрд┐рдХ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рдореБрджреНрджреЛрдВ рдХреЗ рд▓рд┐рдП рдСрдбрд┐рдЯрд┐рдВрдЧ рднреА рд╢рд╛рдорд┐рд▓ рд╣реИред
```bash
# Installation steps in github
# Create a config.json file with the aws info, like:
{
"accounts": [
{
"default": true,
"id": "<account id>",
"name": "dev"
}
],
"cidrs":
{
"2.2.2.2/28": {"name": "NY Office"}
}
}

# Enumerate
python3 cloudmapper.py collect --profile dev
## Number of resources discovered
python3 cloudmapper.py stats --accounts dev

# Create HTML report
## In the report you will find all the info already
python3 cloudmapper.py report --accounts dev

# Identify potential issues
python3 cloudmapper.py audit --accounts dev --json > audit.json
python3 cloudmapper.py audit --accounts dev --markdow > audit.md
python3 cloudmapper.py iam_report --accounts dev

# Identify admins
## The permissions search for are in https://github.com/duo-labs/cloudmapper/blob/4df9fd7303e0337ff16a08f5e58f1d46047c4a87/shared/iam_audit.py#L163-L175
python3 cloudmapper.py find_admins --accounts dev

# Identify unused elements
python3 cloudmapper.py find_unused --accounts dev

# Identify publivly exposed resources
python3 cloudmapper.py public --accounts dev

python cloudmapper.py prepare #Prepare webserver
python cloudmapper.py webserver #Show webserver
```
* [**cartography**](https://github.com/lyft/cartography): Cartography рдПрдХ Python рдЯреВрд▓ рд╣реИ рдЬреЛ Neo4j рдбреЗрдЯрд╛рдмреЗрд╕ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд рдПрдХ рд╕рд╣рдЬ рдЧреНрд░рд╛рдлрд╝ рджреГрд╢реНрдп рдореЗрдВ рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдПрд╕реЗрдЯреНрд╕ рдФрд░ рдЙрдирдХреЗ рдмреАрдЪ рдХреЗ рд╕рдВрдмрдВрдзреЛрдВ рдХреЛ рдПрдХрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред
```bash
# Install
pip install cartography
## At the time of this writting you need neo4j version 3.5.*

# Get AWS info
AWS_PROFILE=dev cartography --neo4j-uri bolt://127.0.0.1:7687 --neo4j-password-prompt  --neo4j-user neo4j
```
* [**starbase**](https://github.com/JupiterOne/starbase): Starbase рд╕реЗрд╡рд╛рдУрдВ рдФрд░ рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рд╕реЗ рд╕рдВрдкрддреНрддрд┐рдпреЛрдВ рдФрд░ рд╕рдВрдмрдВрдзреЛрдВ рдХреЛ рдПрдХрддреНрд░ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдХреНрд▓рд╛рдЙрдб рдЗрдиреНрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░, SaaS рдПрдкреНрд▓рд┐рдХреЗрд╢рди, рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рдпрдВрддреНрд░рдг рдФрд░ рдЕрдзрд┐рдХ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдФрд░ рдЗрд╕реЗ Neo4j рдбреЗрдЯрд╛рдмреЗрд╕ рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд рдПрдХ рд╕рд╣рдЬ рдЧреНрд░рд╛рдлрд╝ рджреГрд╢реНрдп рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИред
* [**aws-inventory**](https://github.com/nccgroup/aws-inventory): (python2 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ) рдпрд╣ рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рдПрдХ рдЦрд╛рддреЗ рдореЗрдВ рдмрдирд╛рдП рдЧрдП рд╕рднреА [**AWS рд╕рдВрд╕рд╛рдзрдиреЛрдВ**](https://docs.aws.amazon.com/general/latest/gr/glos-chap.html#resource) рдХреЛ **рдЦреЛрдЬрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ**ред
* [**aws\_public\_ips**](https://github.com/arkadiyt/aws\_public\_ips): рдпрд╣ рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ AWS рдЦрд╛рддреЗ рд╕реЗ рдЬреБрдбрд╝реЗ рд╕рднреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ IP рдкрддреЛрдВ (рджреЛрдиреЛрдВ IPv4/IPv6) рдХреЛ **рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ**ред

### Privesc & Exploiting

* [**SkyArk**](https://github.com/cyberark/SkyArk)**:** рд╕реНрдХреИрди рдХрд┐рдП рдЧрдП AWS рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рд╕рдмрд╕реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рдЬрд┐рд╕рдореЗрдВ AWS Shadow Admins рднреА рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рдпрд╣ powershell рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдЖрдк [https://github.com/cyberark/SkyArk/blob/master/AWStealth/AWStealth.ps1](https://github.com/cyberark/SkyArk/blob/master/AWStealth/AWStealth.ps1) рдореЗрдВ **`Check-PrivilegedPolicy`** рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдиреАрддрд┐рдпреЛрдВ рдХреА **рдкрд░рд┐рднрд╛рд╖рд╛** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред
* [**pacu**](https://github.com/RhinoSecurityLabs/pacu): Pacu рдПрдХ рдУрдкрди-рд╕реЛрд░реНрд╕ **AWS exploitation framework** рд╣реИ, рдЬрд┐рд╕реЗ рдХреНрд▓рд╛рдЙрдб рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рдЦрд┐рд▓рд╛рдл рдЖрдХреНрд░рд╛рдордХ рд╕реБрд░рдХреНрд╖рд╛ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ **рдЧрдгрдирд╛** рдХрд░ рд╕рдХрддрд╛ рд╣реИ, **рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди** рдкрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ **рдЙрдирдХрд╛ рд╢реЛрд╖рдг** рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЖрдк [https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/iam\_\_privesc\_scan/main.py#L134](https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/iam\_\_privesc\_scan/main.py#L134) рдореЗрдВ **`user_escalation_methods`** dict рдХреЗ рдЕрдВрджрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА **рдкрд░рд┐рднрд╛рд╖рд╛** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред
* рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ pacu **рдХреЗрд╡рд▓ рдЖрдкрдХреЗ рдЕрдкрдиреЗ privescs рдкрдереЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ** (рдкреВрд░реЗ рдЦрд╛рддреЗ рдХреА рдирд╣реАрдВ)ред
```bash
# Install
## Feel free to use venvs
pip3 install pacu

# Use pacu CLI
pacu
> import_keys <profile_name> # import 1 profile from .aws/credentials
> import_keys --all # import all profiles
> list # list modules
> exec iam__enum_permissions # Get permissions
> exec iam__privesc_scan # List privileged permissions
```
* [**PMapper**](https://github.com/nccgroup/PMapper): Principal Mapper (PMapper) рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдФрд░ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд╣реИ рдЬреЛ AWS рдЦрд╛рддреЗ рдпрд╛ AWS рд╕рдВрдЧрдарди рдХреЗ рд▓рд┐рдП AWS Identity and Access Management (IAM) рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рдЬреЛрдЦрд┐рдореЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред рдпрд╣ рдПрдХ рдЦрд╛рддреЗ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди IAM Users рдФрд░ Roles рдХреЛ рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдЧреНрд░рд╛рдлрд╝ рдХреЗ рд░реВрдк рдореЗрдВ рдореЙрдбрд▓ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ **privilege escalation** рдФрд░ рд╡реИрдХрд▓реНрдкрд┐рдХ рд░рд╛рд╕реНрддреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХреЛ рд╕рдХреНрд╖рдо рдмрдирд╛рддрд╛ рд╣реИ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ AWS рдореЗрдВ рдХрд┐рд╕реА рд╕рдВрд╕рд╛рдзрди рдпрд╛ рдХреНрд░рд┐рдпрд╛ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЖрдк **permissions used to find privesc** рдкрдереЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдирдХреЗ рдлрд╛рдЗрд▓рдирд╛рдо `_edges.py` рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реЛрддреЗ рд╣реИрдВ [https://github.com/nccgroup/PMapper/tree/master/principalmapper/graphing](https://github.com/nccgroup/PMapper/tree/master/principalmapper/graphing) рдореЗрдВред
```bash
# Install
pip install principalmapper

# Get data
pmapper --profile dev graph create
pmapper --profile dev graph display # Show basic info
# Generate graph
pmapper --profile dev visualize # Generate svg graph file (can also be png, dot and graphml)
pmapper --profile dev visualize --only-privesc # Only privesc permissions

# Generate analysis
pmapper --profile dev analysis
## Run queries
pmapper --profile dev query 'who can do iam:CreateUser'
pmapper --profile dev query 'preset privesc *' # Get privescs with admins

# Get organization hierarchy data
pmapper --profile dev orgs create
pmapper --profile dev orgs display
```
* [**cloudsplaining**](https://github.com/salesforce/cloudsplaining): Cloudsplaining рдПрдХ AWS IAM рд╕реБрд░рдХреНрд╖рд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рдиреНрдпреВрдирддрдо рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рдЙрд▓реНрд▓рдВрдШрдиреЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдЬреЛрдЦрд┐рдо-рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рд╡рд╛рд▓реА HTML рд░рд┐рдкреЛрд░реНрдЯ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред\
рдпрд╣ рдЖрдкрдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд **рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд** рдЧреНрд░рд╛рд╣рдХ, рдЗрдирд▓рд╛рдЗрди рдФрд░ aws **рдиреАрддрд┐рдпреЛрдВ** рдФрд░ рдХрд┐рди **рдкреНрд░рдореБрдЦреЛрдВ рдХреЛ рдЙрди рддрдХ рдкрд╣реБрдВрдЪ рд╣реИ** рджрд┐рдЦрд╛рдПрдЧрд╛ред (рдпрд╣ рдХреЗрд╡рд▓ privesc рдХреЗ рд▓рд┐рдП рд╣реА рдирд╣реАрдВ рдмрд▓реНрдХрд┐ рдЕрдиреНрдп рдкреНрд░рдХрд╛рд░ рдХреА рджрд┐рд▓рдЪрд╕реНрдк рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рднреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ, рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ)ред
```bash
# Install
pip install cloudsplaining

# Download IAM policies to check
## Only the ones attached with the versions used
cloudsplaining download --profile dev

# Analyze the IAM policies
cloudsplaining scan --input-file /private/tmp/cloudsplaining/dev.json --output /tmp/files/
```
* [**cloudjack**](https://github.com/prevade/cloudjack): CloudJack AWS рдЦрд╛рддреЛрдВ рдХрд╛ рдЖрдХрд▓рди рдХрд░рддрд╛ рд╣реИ **subdomain hijacking vulnerabilities** рдХреЗ рд▓рд┐рдП рдЬреЛ decoupled Route53 рдФрд░ CloudFront configurations рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рд╣реЛрддреА рд╣реИрдВред
* [**ccat**](https://github.com/RhinoSecurityLabs/ccat): List ECR repos -> Pull ECR repo -> Backdoor it -> Push backdoored image
* [**Dufflebag**](https://github.com/bishopfox/dufflebag): Dufflebag рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ Elastic Block Storage (**EBS) snapshots рдореЗрдВ **secrets** рдХреА **searches** рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЧрд▓рддреА рд╕реЗ рдЫреЛрдбрд╝реЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред

### Audit

* [**cloudsploit**](https://github.com/aquasecurity/cloudsploit)**:** CloudSploit by Aqua рдПрдХ рдУрдкрди-рд╕реЛрд░реНрд╕ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рд╣реИ рдЬрд┐рд╕реЗ **cloud infrastructure** рдЦрд╛рддреЛрдВ рдореЗрдВ **security risks** рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ: Amazon Web Services (AWS), Microsoft Azure, Google Cloud Platform (GCP), Oracle Cloud Infrastructure (OCI), рдФрд░ GitHub (рдпрд╣ ShadowAdmins рдХреА рдЦреЛрдЬ рдирд╣реАрдВ рдХрд░рддрд╛)ред
```bash
./index.js --csv=file.csv --console=table --config ./config.js

# Compiance options: --compliance {hipaa,cis,cis1,cis2,pci}
## use "cis" for cis level 1 and 2
```
* [**Prowler**](https://github.com/prowler-cloud/prowler): Prowler рдПрдХ рдУрдкрди рд╕реЛрд░реНрд╕ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ AWS рд╕реБрд░рдХреНрд╖рд╛ рд╕рд░реНрд╡реЛрддреНрддрдо рдкреНрд░рдерд╛рдУрдВ рдХреЗ рдЖрдХрд▓рди, рдСрдбрд┐рдЯ, рдШрдЯрдирд╛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛, рдирд┐рд░рдВрддрд░ рдирд┐рдЧрд░рд╛рдиреА, рд╕рдЦреНрддреА рдФрд░ рдлреЛрд░реЗрдВрд╕рд┐рдХ рддреИрдпрд╛рд░реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
```bash
# Install python3, jq and git
# Install
pip install prowler
prowler -v

# Run
prowler <provider>
prowler aws --profile custom-profile [-M csv json json-asff html]
```
* [**CloudFox**](https://github.com/BishopFox/cloudfox): CloudFox рдЖрдкрдХреЛ рдЕрдкрд░рд┐рдЪрд┐рдд cloud environments рдореЗрдВ рд╕реНрдерд┐рддрд┐ рдЬрд╛рдЧрд░реВрдХрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдПрдХ open source command line tool рд╣реИ рдЬрд┐рд╕реЗ penetration testers рдФрд░ рдЕрдиреНрдп offensive security professionals рдХреЛ cloud infrastructure рдореЗрдВ exploitable attack paths рдЦреЛрдЬрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред
```bash
cloudfox aws --profile [profile-name] all-checks
```
* [**ScoutSuite**](https://github.com/nccgroup/ScoutSuite): Scout Suite рдПрдХ рдУрдкрди рд╕реЛрд░реНрд╕ рдорд▓реНрдЯреА-рдХреНрд▓рд╛рдЙрдб рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА-рдСрдбрд┐рдЯрд┐рдВрдЧ рдЯреВрд▓ рд╣реИ, рдЬреЛ рдХреНрд▓рд╛рдЙрдб рд╡рд╛рддрд╛рд╡рд░рдг рдХреА рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрдерд┐рддрд┐ рдХрд╛ рдЖрдХрд▓рди рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдмрдирд╛рддрд╛ рд╣реИред
```bash
# Install
virtualenv -p python3 venv
source venv/bin/activate
pip install scoutsuite
scout --help

# Get info
scout aws -p dev
```
* [**cs-suite**](https://github.com/SecurityFTW/cs-suite): Cloud Security Suite (python2.7 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрдкреНрд░рдЪрд▓рд┐рдд рд▓рдЧрддрд╛ рд╣реИ)
* [**Zeus**](https://github.com/DenizParlak/Zeus): Zeus AWS EC2 / S3 / CloudTrail / CloudWatch / KMS рдХреЗ рд▓рд┐рдП рдПрдХ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдЯреВрд▓ рд╣реИ рдЬреЛ рд╕рд░реНрд╡реЛрддреНрддрдо рд╣рд╛рд░реНрдбрдирд┐рдВрдЧ рдкреНрд░рдерд╛рдУрдВ рдХреЗ рд▓рд┐рдП рд╣реИ (рдЕрдкреНрд░рдЪрд▓рд┐рдд рд▓рдЧрддрд╛ рд╣реИ)ред рдпрд╣ рдХреЗрд╡рд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдЕрдВрджрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рдХреНрд░реЗрдбреНрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИред

### Constant Audit

* [**cloud-custodian**](https://github.com/cloud-custodian/cloud-custodian): Cloud Custodian рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреНрд▓рд╛рдЙрдб рдЦрд╛рддреЛрдВ рдФрд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рдкреНрд░рдмрдВрдзрди рдХреЗ рд▓рд┐рдП рдПрдХ рдирд┐рдпрдо рдЗрдВрдЬрди рд╣реИред рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рдиреАрддрд┐рдпреЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдПрдХ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рдХреНрд▓рд╛рдЙрдб рдЗрдиреНрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рд╕рдХреНрд╖рдо рд╣реЛ**, рдЬреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдФрд░ рд▓рд╛рдЧрдд рдЕрдиреБрдХреВрд▓рд┐рдд рд╣реЛред рдпрд╣ рд╕рдВрдЧрдардиреЛрдВ рдХреЗ рдХрдИ рдПрдбрд╣реЙрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдХреЛ рдПрдХ рд╣рд▓реНрдХреЗ рдФрд░ рд▓рдЪреАрд▓реЗ рдЯреВрд▓ рдореЗрдВ рд╕рдореЗрдХрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдПрдХреАрдХреГрдд рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдФрд░ рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ рд╣реЛрддреА рд╣реИред
* [**pacbot**](https://github.com/tmobile/pacbot)**: Policy as Code Bot (PacBot)** рдПрдХ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рд╣реИ рдЬреЛ **рдирд┐рд░рдВрддрд░ рдЕрдиреБрдкрд╛рд▓рди рдирд┐рдЧрд░рд╛рдиреА, рдЕрдиреБрдкрд╛рд▓рди рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ рдФрд░ рдХреНрд▓рд╛рдЙрдб рдХреЗ рд▓рд┐рдП рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрд╡рдЪрд╛рд▓рди** рдХреЗ рд▓рд┐рдП рд╣реИред PacBot рдореЗрдВ, рд╕реБрд░рдХреНрд╖рд╛ рдФрд░ рдЕрдиреБрдкрд╛рд▓рди рдиреАрддрд┐рдпреЛрдВ рдХреЛ рдХреЛрдб рдХреЗ рд░реВрдк рдореЗрдВ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред PacBot рджреНрд╡рд╛рд░рд╛ рдЦреЛрдЬреЗ рдЧрдП рд╕рднреА рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХрд╛ рдЗрди рдиреАрддрд┐рдпреЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдиреАрддрд┐ рдЕрдиреБрд░реВрдкрддрд╛ рдХрд╛ рдЖрдХрд▓рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред PacBot **рдСрдЯреЛ-рдлрд┐рдХреНрд╕** рдлреНрд░реЗрдорд╡рд░реНрдХ рдиреАрддрд┐ рдЙрд▓реНрд▓рдВрдШрдиреЛрдВ рдХрд╛ рдкреВрд░реНрд╡рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд▓реЗрдХрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред
* [**streamalert**](https://github.com/airbnb/streamalert)**:** StreamAlert рдПрдХ рд╕рд░реНрд╡рд░рд▓реЗрд╕, **рд╡рд╛рд╕реНрддрд╡рд┐рдХ-рд╕рдордп** рдбреЗрдЯрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдлреНрд░реЗрдорд╡рд░реНрдХ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рдХрд┐рд╕реА рднреА рд╡рд╛рддрд╛рд╡рд░рдг рд╕реЗ **рдбреЗрдЯрд╛ рдХреЛ рдЗрдирдЬреЗрд╕реНрдЯ, рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдФрд░ рдЕрд▓рд░реНрдЯ** рдХрд░рдиреЗ рдХреА рд╢рдХреНрддрд┐ рджреЗрддрд╛ рд╣реИ, **рдбреЗрдЯрд╛ рд╕реНрд░реЛрддреЛрдВ рдФрд░ рдЕрд▓рд░реНрдЯрд┐рдВрдЧ рд▓реЙрдЬрд┐рдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЬрд┐рд╕реЗ рдЖрдк рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ**ред рдХрдВрдкреНрдпреВрдЯрд░ рд╕реБрд░рдХреНрд╖рд╛ рдЯреАрдореЗрдВ StreamAlert рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рд░ рджрд┐рди рдЯреЗрд░рд╛рдмрд╛рдЗрдЯреНрд╕ рд▓реЙрдЧ рдбреЗрдЯрд╛ рдХреЛ рд╕реНрдХреИрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреА рд╣реИрдВ рддрд╛рдХрд┐ рдШрдЯрдирд╛ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдПред

## DEBUG: AWS cli рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдВ
```bash
# Set proxy
export HTTP_PROXY=http://localhost:8080
export HTTPS_PROXY=http://localhost:8080

# Capture with burp nor verifying ssl
aws --no-verify-ssl ...

# Dowload brup cert and transform it to pem
curl http://127.0.0.1:8080/cert --output Downloads/certificate.cer
openssl x509 -inform der -in Downloads/certificate.cer -out Downloads/certificate.pem

# Indicate the ca cert to trust
export AWS_CA_BUNDLE=~/Downloads/certificate.pem

# Run aws cli normally trusting burp cert
aws ...
```
## рд╕рдВрджрд░реНрдн

* [https://www.youtube.com/watch?v=8ZXRw4Ry3mQ](https://www.youtube.com/watch?v=8ZXRw4Ry3mQ)
* [https://cloudsecdocs.com/aws/defensive/tooling/audit/](https://cloudsecdocs.com/aws/defensive/tooling/audit/)

{% hint style="success" %}
AWS Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХреЛ рд╕рдорд░реНрдерди рджреЗрдВ</summary>

* [**subscription plans**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram group**](https://t.me/peass) рдпрд╛ **рд╣рдореЗрдВ рдлреЙрд▓реЛ рдХрд░реЗрдВ** **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ред**
* **PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдкрд░ред

</details>
{% endhint %}
