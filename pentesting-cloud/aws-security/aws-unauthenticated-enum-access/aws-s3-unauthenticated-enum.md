# AWS - S3 Unauthenticated Enum

{% hint style="success" %}
AWS Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХреЛ рд╕рдорд░реНрдерди рджреЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдУрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рд╣рдореЗрдВ рдлреЙрд▓реЛ рдХрд░реЗрдВ** **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
{% endhint %}

## S3 Public Buckets

рдПрдХ bucket рдХреЛ **тАЬpublicтАЭ** рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдпрджрд┐ **рдХреЛрдИ рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ bucket рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░ рд╕рдХрддрд╛ рд╣реИ**, рдФрд░ **тАЬprivateтАЭ** рдпрджрд┐ bucket рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ **рдХреЗрд╡рд▓ рдХреБрдЫ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рд╕реВрдЪреАрдмрджреНрдз рдпрд╛ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**ред

рдХрдВрдкрдирд┐рдпреЛрдВ рдХреЗ рдкрд╛рд╕ **buckets permissions рдЧрд▓рдд-рд╕рдВрд╡рд┐рдзрд╛рди** рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдпрд╛ рддреЛ рд╕рдм рдХреБрдЫ рдпрд╛ рдХрд┐рд╕реА рднреА рдЦрд╛рддреЗ рдореЗрдВ AWS рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рд╕рднреА рдХреЛ рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ (рдЗрд╕рд▓рд┐рдП рдХрд┐рд╕реА рдХреЛ рднреА)ред рдзреНрдпрд╛рди рджреЗрдВ, рдХрд┐ рдРрд╕реА рдЧрд▓рдд-рд╕рдВрд╡рд┐рдзрд╛рди рдХреЗ рдмрд╛рд╡рдЬреВрдж рдХреБрдЫ рдХреНрд░рд┐рдпрд╛рдПрдВ рдирд╣реАрдВ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ buckets рдХреЗ рдкрд╛рд╕ рдЕрдкрдиреА рд╕реНрд╡рдпрдВ рдХреА access control lists (ACLs) рд╣реЛ рд╕рдХрддреА рд╣реИрдВред

**AWS-S3 рдЧрд▓рдд-рд╕рдВрд╡рд┐рдзрд╛рди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдпрд╣рд╛рдБ рдЬрд╛рдиреЗрдВ:** [**http://flaws.cloud**](http://flaws.cloud/) **рдФрд░** [**http://flaws2.cloud/**](http://flaws2.cloud)

### AWS Buckets рдвреВрдВрдврдирд╛

рдЬрдм рдХреЛрдИ рд╡реЗрдмрдкреЗрдЬ рдХреБрдЫ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП AWS рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЙрд╕реЗ рдвреВрдВрдврдиреЗ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ:

#### Enumeration & OSINT:

* **wappalyzer** рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдкреНрд▓рдЧрдЗрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛
* burp рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ (**рд╡реЗрдм рдХреЛ spidering рдХрд░рдирд╛**) рдпрд╛ рдкреГрд╖реНрда рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░рдХреЗ рд╕рднреА **рд╕рдВрд╕рд╛рдзрди** **рд▓реЛрдб рдХрд┐рдП рдЧрдП** рдЗрддрд┐рд╣рд╛рд╕ рдореЗрдВ рд╕рд╣реЗрдЬреЗ рдЬрд╛рдПрдВрдЧреЗред
*   **рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ** рдЬреИрд╕реЗ рдбреЛрдореЗрди рдореЗрдВ:

```
http://s3.amazonaws.com/[bucket_name]/
http://[bucket_name].s3.amazonaws.com/
```
* **CNAMES** рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ рдЬреИрд╕реЗ `resources.domain.com` рдХрд╛ CNAME `bucket.s3.amazonaws.com` рд╣реЛ рд╕рдХрддрд╛ рд╣реИ
* [https://buckets.grayhatwarfare.com](https://buckets.grayhatwarfare.com/) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ, рдПрдХ рд╡реЗрдм рдЬрд┐рд╕рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ **рдЦреБрд▓реЗ buckets** рдЦреЛрдЬреЗ рдЧрдП рд╣реИрдВред
* **bucket name** рдФрд░ **bucket domain name** рдХреЛ **рд╕рдорд╛рди** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред
* **flaws.cloud** **IP** 52.92.181.107 рдореЗрдВ рд╣реИ рдФрд░ рдпрджрд┐ рдЖрдк рд╡рд╣рд╛рдВ рдЬрд╛рддреЗ рд╣реИрдВ рддреЛ рдпрд╣ рдЖрдкрдХреЛ [https://aws.amazon.com/s3/](https://aws.amazon.com/s3/) рдкрд░ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, `dig -x 52.92.181.107` `s3-website-us-west-2.amazonaws.com` рджреЗрддрд╛ рд╣реИред
* рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдпрд╣ рдПрдХ bucket рд╣реИ, рдЖрдк [https://flaws.cloud.s3.amazonaws.com/](https://flaws.cloud.s3.amazonaws.com/) рдкрд░ рднреА рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред

#### Brute-Force

рдЖрдк рдХрдВрдкрдиреА рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдирд╛рдореЛрдВ рдХреЛ **brute-forcing** рдХрд░рдХреЗ buckets рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рдЖрдк pentesting рдХрд░ рд░рд╣реЗ рд╣реИрдВ:

* [https://github.com/sa7mon/S3Scanner](https://github.com/sa7mon/S3Scanner)
* [https://github.com/clario-tech/s3-inspector](https://github.com/clario-tech/s3-inspector)
* [https://github.com/jordanpotti/AWSBucketDump](https://github.com/jordanpotti/AWSBucketDump) (рд╕рдВрднрд╛рд╡рд┐рдд bucket рдирд╛рдореЛрдВ рдХреА рд╕реВрдЪреА рд╢рд╛рдорд┐рд▓ рд╣реИ)
* [https://github.com/fellchase/flumberboozle/tree/master/flumberbuckets](https://github.com/fellchase/flumberboozle/tree/master/flumberbuckets)
* [https://github.com/smaranchand/bucky](https://github.com/smaranchand/bucky)
* [https://github.com/tomdev/teh\_s3\_bucketeers](https://github.com/tomdev/teh\_s3\_bucketeers)
* [https://github.com/RhinoSecurityLabs/Security-Research/tree/master/tools/aws-pentest-tools/s3](https://github.com/RhinoSecurityLabs/Security-Research/tree/master/tools/aws-pentest-tools/s3)
* [https://github.com/Eilonh/s3crets\_scanner](https://github.com/Eilonh/s3crets\_scanner)
* [https://github.com/belane/CloudHunter](https://github.com/belane/CloudHunter)

<pre class="language-bash"><code class="lang-bash"># permutations рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ wordlist рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВ
curl -s https://raw.githubusercontent.com/cujanovic/goaltdns/master/words.txt > /tmp/words-s3.txt.temp
curl -s https://raw.githubusercontent.com/jordanpotti/AWSBucketDump/master/BucketNames.txt >>/tmp/words-s3.txt.temp
cat /tmp/words-s3.txt.temp | sort -u > /tmp/words-s3.txt

# рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбреЛрдореЗрди рдФрд░ рдЙрдкрдбреЛрдореЗрди рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдПрдХ wordlist рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВ
## рдЙрди рдбреЛрдореЗрди рдФрд░ рдЙрдкрдбреЛрдореЗрди рдХреЛ subdomains.txt рдореЗрдВ рд▓рд┐рдЦреЗрдВ
cat subdomains.txt > /tmp/words-hosts-s3.txt
cat subdomains.txt | tr "." "-" >> /tmp/words-hosts-s3.txt
cat subdomains.txt | tr "." "\n" | sort -u >> /tmp/words-hosts-s3.txt

# рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рдбреЛрдореЗрди рдФрд░ рдЙрдкрдбреЛрдореЗрди рдХреА рд╕реВрдЪреА рдХреЗ рдЖрдзрд╛рд░ рдкрд░ permutations рдмрдирд╛рдПрдВ
goaltdns -l /tmp/words-hosts-s3.txt -w /tmp/words-s3.txt -o /tmp/final-words-s3.txt.temp
## рдкрд┐рдЫрд▓рд╛ рдЙрдкрдХрд░рдг рдЙрдкрдбреЛрдореЗрди рдХреЗ рд▓рд┐рдП permutations рдмрдирд╛рдиреЗ рдореЗрдВ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рд╣реИ, рдЙрд╕ рд╕реВрдЪреА рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░реЗрдВ
<strong>### ". " рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рд╣рдЯрд╛рдПрдВ
</strong>cat /tmp/final-words-s3.txt.temp | grep -Ev "\.$" > /tmp/final-words-s3.txt.temp2
### TLD рдХреЗ рдмрд┐рдирд╛ рд╕реВрдЪреА рдмрдирд╛рдПрдВ
cat /tmp/final-words-s3.txt.temp2 | sed -E 's/\.[a-zA-Z0-9]+$//' > /tmp/final-words-s3.txt.temp3
### рдмрд┐рдВрджреБрдУрдВ рдХреЗ рдмрд┐рдирд╛ рд╕реВрдЪреА рдмрдирд╛рдПрдВ
cat /tmp/final-words-s3.txt.temp3 | tr -d "." > /tmp/final-words-s3.txt.temp4http://phantom.s3.amazonaws.com/
### рд╣рд╛рдЗрдлрди рдХреЗ рдмрд┐рдирд╛ рд╕реВрдЪреА рдмрдирд╛рдПрдВ
cat /tmp/final-words-s3.txt.temp3 | tr "." "-" > /tmp/final-words-s3.txt.temp5

## рдЕрдВрддрд┐рдо wordlist рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВ
cat /tmp/final-words-s3.txt.temp2 /tmp/final-words-s3.txt.temp3 /tmp/final-words-s3.txt.temp4 /tmp/final-words-s3.txt.temp5 | grep -v -- "-\." | awk '{print tolower($0)}' | sort -u > /tmp/final-words-s3.txt

## s3scanner рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ
s3scanner --threads 100 scan --buckets-file /tmp/final-words-s3.txt  | grep bucket_exists
</code></pre>

#### Loot S3 Buckets

S3 open buckets рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, [**BucketLoot**](https://github.com/redhuntlabs/BucketLoot) рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ **рд░реЛрдЪрдХ рдЬрд╛рдирдХрд╛рд░реА рдЦреЛрдЬ рд╕рдХрддрд╛ рд╣реИ**ред

### Region рдвреВрдВрдвреЗрдВ

рдЖрдк [**https://docs.aws.amazon.com/general/latest/gr/s3.html**](https://docs.aws.amazon.com/general/latest/gr/s3.html) рдореЗрдВ AWS рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд рд╕рднреА regions рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

#### DNS рджреНрд╡рд╛рд░рд╛

рдЖрдк **`dig`** рдФрд░ **`nslookup`** рдХреЗ рд╕рд╛рде рдПрдХ bucket рдХрд╛ region рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, **рдЦреЛрдЬреЗ рдЧрдП IP рдХрд╛ DNS рдЕрдиреБрд░реЛрдз рдХрд░рдХреЗ**:
```bash
dig flaws.cloud
;; ANSWER SECTION:
flaws.cloud.    5    IN    A    52.218.192.11

nslookup 52.218.192.11
Non-authoritative answer:
11.192.218.52.in-addr.arpa name = s3-website-us-west-2.amazonaws.com.
```
Resolved domain рдореЗрдВ "website" рд╢рдмреНрдж рд╣реИ рдпрд╣ рдЬрд╛рдВрдЪреЗрдВред\
рдЖрдк static website рдХреЛ рдпрд╣рд╛рдБ рдЬрд╛рдХрд░ access рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: `flaws.cloud.s3-website-us-west-2.amazonaws.com`\
рдпрд╛ рдЖрдк bucket рдХреЛ рдпрд╣рд╛рдБ visit рдХрд░рдХреЗ access рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: `flaws.cloud.s3-us-west-2.amazonaws.com`

#### рдХреЛрд╢рд┐рд╢ рдХрд░рдХреЗ

рдпрджрд┐ рдЖрдк рдПрдХ bucket рдХреЛ access рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди **domain name рдореЗрдВ рдЖрдк рджреВрд╕рд░реА region specify рдХрд░рддреЗ рд╣реИрдВ** (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП bucket `bucket.s3.amazonaws.com` рдореЗрдВ рд╣реИ рд▓реЗрдХрд┐рди рдЖрдк `bucket.s3-website-us-west-2.amazonaws.com` рдХреЛ access рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ), рддреЛ рдЖрдкрдХреЛ **рд╕рд╣реА location рдХреА рдУрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**:

![](<../../../.gitbook/assets/image (106).png>)

### Bucket рдХреЛ Enumerate рдХрд░рдирд╛

Bucket рдХреА openness рдХреЛ test рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХ user рдмрд╕ рдЕрдкрдиреЗ web browser рдореЗрдВ URL enter рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдПрдХ private bucket "Access Denied" рдХреЗ рд╕рд╛рде respond рдХрд░реЗрдЧрд╛ред рдПрдХ public bucket рдкрд╣рд▓реЗ 1,000 objects рдХреЛ list рдХрд░реЗрдЧрд╛ рдЬреЛ stored рд╣реИрдВред

рд╕рднреА рдХреЗ рд▓рд┐рдП рдЦреБрд▓рд╛:

![](<../../..//.gitbook/assets/image (201).png>)

Private:

![](<../../..//.gitbook/assets/image (83).png>)

рдЖрдк рдЗрд╕реЗ cli рдХреЗ рд╕рд╛рде рднреА check рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
#Use --no-sign-request for check Everyones permissions
#Use --profile <PROFILE_NAME> to indicate the AWS profile(keys) that youwant to use: Check for "Any Authenticated AWS User" permissions
#--recursive if you want list recursivelyls
#Opcionally you can select the region if you now it
aws s3 ls s3://flaws.cloud/ [--no-sign-request] [--profile <PROFILE_NAME>] [ --recursive] [--region us-west-2]
```
рдпрджрд┐ рдмрдХреЗрдЯ рдХрд╛ рдбреЛрдореЗрди рдирд╛рдо рдирд╣реАрдВ рд╣реИ, рддреЛ рдЗрд╕реЗ рдПрдиреНрдпреВрдорд░реЗрдЯ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╕рдордп, **рдХреЗрд╡рд▓ рдмрдХреЗрдЯ рдирд╛рдо рдбрд╛рд▓реЗрдВ** рдФрд░ рдкреВрд░рд╛ AWSs3 рдбреЛрдореЗрди рдирд╣реАрдВред рдЙрджрд╛рд╣рд░рдг: `s3://<BUCKETNAME>`

### Public URL template
```
https://{user_provided}.s3.amazonaws.com
```
### Get Account ID from public Bucket

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдПрдХ AWS рдЦрд╛рддрд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдирдП **`S3:ResourceAccount`** **Policy Condition Key** рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдХрд░ред рдпрд╣ рд╕реНрдерд┐рддрд┐ **S3 рдмрдХреЗрдЯ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдкрд╣реБрдВрдЪ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рддреА рд╣реИ** рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдЦрд╛рддрд╛ рд╣реИ (рдЕрдиреНрдп рдЦрд╛рддрд╛-рдЖрдзрд╛рд░рд┐рдд рдиреАрддрд┐рдпрд╛рдВ рдЙрд╕ рдЦрд╛рддреЗ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рддреА рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рд╣реИ)ред\
рдФрд░ рдХреНрдпреЛрдВрдХрд┐ рдиреАрддрд┐ рдореЗрдВ **рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдбреНрд╕** рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдЦрд╛рддрд╛ рд╕рдВрдЦреНрдпрд╛ **рд╕рд┐рд░реНрдл рдПрдХ рд╕рдВрдЦреНрдпрд╛ рдПрдХ рд╕рдордп рдореЗрдВ** рдкрд╛рдИ рдЬрд╛ рд╕рдХреЗред

рдпрд╣ рдЯреВрд▓ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИ:
```bash
# Installation
pipx install s3-account-search
pip install s3-account-search
# With a bucket
s3-account-search arn:aws:iam::123456789012:role/s3_read s3://my-bucket
# With an object
s3-account-search arn:aws:iam::123456789012:role/s3_read s3://my-bucket/path/to/object.ext
```
рдпрд╣ рддрдХрдиреАрдХ API Gateway URLs, Lambda URLs, Data Exchange рдбреЗрдЯрд╛ рд╕реЗрдЯреНрд╕ рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЯреИрдЧреНрд╕ рдХреЗ рдореВрд▓реНрдп рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХрд╛рдо рдХрд░рддреА рд╣реИ (рдпрджрд┐ рдЖрдкрдХреЛ рдЯреИрдЧ рдХреБрдВрдЬреА рдкрддрд╛ рд╣реИ)ред рдЖрдк рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [**рдореВрд▓ рд╢реЛрдз**](https://blog.plerion.com/conditional-love-for-aws-metadata-enumeration/) рдФрд░ рдЗрд╕ рд╢реЛрд╖рдг рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЯреВрд▓ [**conditional-love**](https://github.com/plerionhq/conditional-love/) рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

### рдкреБрд╖реНрдЯрд┐ рдХрд░рдирд╛ рдХрд┐ рдПрдХ рдмрдХреЗрдЯ рдПрдХ AWS рдЦрд╛рддреЗ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИ

рдЬреИрд╕рд╛ рдХрд┐ [**рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ**](https://blog.plerion.com/things-you-wish-you-didnt-need-to-know-about-s3/) рдореЗрдВ рд╕рдордЭрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, **рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдмрдХреЗрдЯ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ** рддреЛ рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдПрдХ accountID рдХреА рдкреБрд╖реНрдЯрд┐ рдХреА рдЬрд╛ рд╕рдХреЗ рдХрд┐ рдмрдХреЗрдЯ рдХрд┐рд╕ рдЦрд╛рддреЗ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИ, рдПрдХ рдЕрдиреБрд░реЛрдз рднреЗрдЬрдХрд░:
```bash
curl -X GET "[bucketname].amazonaws.com/" \
-H "x-amz-expected-bucket-owner: [correct-account-id]"

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://s3.amazonaws.com/doc/2006-03-01/">...</ListBucketResult>
```
рдпрджрд┐ рддреНрд░реБрдЯрд┐ "Access Denied" рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЦрд╛рддрд╛ ID рдЧрд▓рдд рдереАред

### Root account enumeration рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП Emails

рдЬреИрд╕рд╛ рдХрд┐ [**рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ**](https://blog.plerion.com/things-you-wish-you-didnt-need-to-know-about-s3/) рдореЗрдВ рд╕рдордЭрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдХреЛрдИ рдИрдореЗрд▓ рдкрддрд╛ рдХрд┐рд╕реА AWS рдЦрд╛рддреЗ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИ рдпрд╛ рдирд╣реАрдВ, **рдПрдХ S3 bucket рдкрд░ ACLs рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдИрдореЗрд▓ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рджреЗрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдХреЗ**ред рдпрджрд┐ рдЗрд╕рд╕реЗ рдХреЛрдИ рддреНрд░реБрдЯрд┐ рдЙрддреНрдкрдиреНрди рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдИрдореЗрд▓ рдХрд┐рд╕реА AWS рдЦрд╛рддреЗ рдХрд╛ root user рд╣реИ:
```python
s3_client.put_bucket_acl(
Bucket=bucket_name,
AccessControlPolicy={
'Grants': [
{
'Grantee': {
'EmailAddress': 'some@emailtotest.com',
'Type': 'AmazonCustomerByEmail',
},
'Permission': 'READ'
},
],
'Owner': {
'DisplayName': 'Whatever',
'ID': 'c3d78ab5093a9ab8a5184de715d409c2ab5a0e2da66f08c2f6cc5c0bdeadbeef'
}
}
)
```
## References

* [https://www.youtube.com/watch?v=8ZXRw4Ry3mQ](https://www.youtube.com/watch?v=8ZXRw4Ry3mQ)
* [https://cloudar.be/awsblog/finding-the-account-id-of-any-public-s3-bucket/](https://cloudar.be/awsblog/finding-the-account-id-of-any-public-s3-bucket/)

{% hint style="success" %}
AWS Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХреЛ рд╕рдорд░реНрдерди рджреЗрдВ</summary>

* [**subscription plans**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рд╣рдореЗрдВ **Twitter** ЁЯРж рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ.

</details>
{% endhint %}
