# AWS - IAM & STS Unauthenticated Enum

{% hint style="success" %}
AWS ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ‡§ï‡•ã ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§¶‡•á‡§Ç</summary>

* [**‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ ‡§Ø‡•ã‡§ú‡§®‡§æ‡§ì‡§Ç**](https://github.com/sponsors/carlospolop) ‡§ï‡•Ä ‡§ú‡§æ‡§Å‡§ö ‡§ï‡§∞‡•á‡§Ç!
* üí¨ [**Discord ‡§∏‡§Æ‡•Ç‡§π**](https://discord.gg/hRep4RUj7f) ‡§Ø‡§æ [**telegram ‡§∏‡§Æ‡•Ç‡§π**](https://t.me/peass) ‡§Æ‡•á‡§Ç ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•ã‡§Ç ‡§Ø‡§æ ‡§π‡§Æ‡•á‡§Ç **Twitter** üê¶ ‡§™‡§∞ **‡§´‡•â‡§≤‡•ã** ‡§ï‡§∞‡•á‡§Ç [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç** [**HackTricks**](https://github.com/carlospolop/hacktricks) ‡§î‡§∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos ‡§Æ‡•á‡§Ç PRs ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡§ï‡•á‡•§

</details>
{% endhint %}

## ‡§ï‡§ø‡§∏‡•Ä ‡§ñ‡§æ‡§§‡•á ‡§Æ‡•á‡§Ç Roles ‡§î‡§∞ Usernames ‡§ï‡•ã Enumerate ‡§ï‡§∞‡•á‡§Ç

### ~~Assume Role Brute-Force~~

{% hint style="danger" %}
**‡§Ø‡§π ‡§§‡§ï‡§®‡•Ä‡§ï ‡§Ö‡§¨ ‡§ï‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡•Ä** ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§Ø‡§¶‡§ø role ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à ‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç, ‡§§‡•ã ‡§Ü‡§™‡§ï‡•ã ‡§π‡§Æ‡•á‡§∂‡§æ ‡§Ø‡§π ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§Æ‡§ø‡§≤‡§§‡•Ä ‡§π‡•à:

`An error occurred (AccessDenied) when calling the AssumeRole operation: User: arn:aws:iam::947247140022:user/testenv is not authorized to perform: sts:AssumeRole on resource: arn:aws:iam::429217632764:role/account-balanceasdas`

‡§Ü‡§™ ‡§á‡§∏‡•á **‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç**:

`aws sts assume-role --role-arn arn:aws:iam::412345678909:role/superadmin --role-session-name s3-access-example`
{% endhint %}

‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§¨‡§ø‡§®‡§æ **role ‡§ï‡•ã assume ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏** ‡§ï‡§∞‡§®‡•á ‡§™‡§∞ AWS ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§ü‡•ç‡§∞‡§ø‡§ó‡§∞ ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§Ø‡§¶‡§ø unauthorized ‡§π‡•à, ‡§§‡•ã AWS ‡§Ø‡§π ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§µ‡§æ‡§™‡§∏ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à:
```ruby
An error occurred (AccessDenied) when calling the AssumeRole operation: User: arn:aws:iam::012345678901:user/MyUser is not authorized to perform: sts:AssumeRole on resource: arn:aws:iam::111111111111:role/aws-service-role/rds.amazonaws.com/AWSServiceRoleForRDS
```
‡§Ø‡§π ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ ‡§ï‡•á ‡§Ö‡§∏‡•ç‡§§‡§ø‡§§‡•ç‡§µ ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§≤‡•á‡§ï‡§ø‡§® ‡§Ø‡§π ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§¶‡•á‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§á‡§∏‡§ï‡•Ä assume role ‡§®‡•Ä‡§§‡§ø ‡§Ü‡§™‡§ï‡•Ä ‡§ß‡§æ‡§∞‡§£‡§æ ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á‡§§‡•Ä ‡§π‡•à‡•§ ‡§á‡§∏‡§ï‡•á ‡§µ‡§ø‡§™‡§∞‡•Ä‡§§, **‡§è‡§ï ‡§ó‡•à‡§∞-‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ ‡§ï‡•ã assume ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§è‡§ï ‡§Ö‡§≤‡§ó ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§ï‡•Ä ‡§ì‡§∞ ‡§≤‡•á ‡§ú‡§æ‡§§‡§æ ‡§π‡•à**:
```less
An error occurred (AccessDenied) when calling the AssumeRole operation: Not authorized to perform sts:AssumeRole
```
‡§¶‡§ø‡§≤‡§ö‡§∏‡•ç‡§™ ‡§¨‡§æ‡§§ ‡§Ø‡§π ‡§π‡•à ‡§ï‡§ø **‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§î‡§∞ ‡§ó‡•à‡§∞-‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§Ö‡§Ç‡§§‡§∞ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ø‡§π ‡§µ‡§ø‡§ß‡§ø** ‡§µ‡§ø‡§≠‡§ø‡§®‡•ç‡§® AWS ‡§ñ‡§æ‡§§‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§≠‡•Ä ‡§≤‡§æ‡§ó‡•Ç ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§ ‡§è‡§ï ‡§µ‡•à‡§ß AWS ‡§ñ‡§æ‡§§‡§æ ‡§Ü‡§à‡§°‡•Ä ‡§î‡§∞ ‡§≤‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∂‡§¨‡•ç‡§¶‡§∏‡•Ç‡§ö‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§•, ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§ñ‡§æ‡§§‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§¨‡§ø‡§®‡§æ ‡§ï‡§ø‡§∏‡•Ä ‡§Ö‡§Ç‡§§‡§∞‡•ç‡§®‡§ø‡§π‡§ø‡§§ ‡§∏‡•Ä‡§Æ‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§∏‡§æ‡§Æ‡§®‡§æ ‡§ï‡§ø‡§è ‡§∏‡•Ç‡§ö‡•Ä‡§¨‡§¶‡•ç‡§ß ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§

‡§Ü‡§™ ‡§á‡§∏ [script ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§∏‡§ø‡§™‡§≤‡•ç‡§∏ ‡§ï‡•ã ‡§∏‡•Ç‡§ö‡•Ä‡§¨‡§¶‡•ç‡§ß ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç](https://github.com/RhinoSecurityLabs/Security-Research/tree/master/tools/aws-pentest-tools/assume\_role\_enum) ‡§á‡§∏ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡§æ ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§§‡•á ‡§π‡•Å‡§è‡•§

### Trust Policies: ‡§ï‡•ç‡§∞‡•â‡§∏ ‡§Ö‡§ï‡§æ‡§â‡§Ç‡§ü ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ‡§ì‡§Ç ‡§î‡§∞ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§¨‡•ç‡§∞‡•Ç‡§ü-‡§´‡•ã‡§∞‡•ç‡§∏ ‡§ï‡§∞‡§®‡§æ

‡§è‡§ï **IAM ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ ‡§ï‡•Ä ‡§ü‡•ç‡§∞‡§∏‡•ç‡§ü ‡§™‡•â‡§≤‡§ø‡§∏‡•Ä ‡§ï‡•ã ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞ ‡§Ø‡§æ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§®‡§æ ‡§á‡§∏‡§Æ‡•á‡§Ç ‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•à ‡§ï‡§ø ‡§ï‡•å‡§® ‡§∏‡•á AWS ‡§∏‡§Ç‡§∏‡§æ‡§ß‡§® ‡§Ø‡§æ ‡§∏‡•á‡§µ‡§æ‡§è‡§Ç ‡§â‡§∏ ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ ‡§ï‡•ã ‡§ó‡•ç‡§∞‡§π‡§£ ‡§ï‡§∞‡§®‡•á ‡§î‡§∞ ‡§Ö‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§ï‡•ç‡§∞‡•á‡§°‡•á‡§Ç‡§∂‡§ø‡§Ø‡§≤ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•Ä ‡§ó‡§à ‡§π‡•à‡§Ç**‡•§ ‡§Ø‡§¶‡§ø ‡§®‡•Ä‡§§‡§ø ‡§Æ‡•á‡§Ç ‡§®‡§ø‡§∞‡•ç‡§¶‡§ø‡§∑‡•ç‡§ü ‡§∏‡§Ç‡§∏‡§æ‡§ß‡§® **‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à**, ‡§§‡•ã ‡§ü‡•ç‡§∞‡§∏‡•ç‡§ü ‡§™‡•â‡§≤‡§ø‡§∏‡•Ä **‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï** ‡§∏‡§π‡•á‡§ú ‡§≤‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡•§ ‡§π‡§æ‡§≤‡§æ‡§Ç‡§ï‡§ø, ‡§Ø‡§¶‡§ø ‡§∏‡§Ç‡§∏‡§æ‡§ß‡§® **‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à**, ‡§§‡•ã ‡§è‡§ï **‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§π‡•ã‡§§‡•Ä ‡§π‡•à**, ‡§ú‡•ã ‡§á‡§Ç‡§ó‡§ø‡§§ ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à ‡§ï‡§ø ‡§è‡§ï ‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§™‡•ç‡§∞‡§ø‡§Ç‡§∏‡§ø‡§™‡§≤ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§•‡§æ‡•§

{% hint style="warning" %}
‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç ‡§ï‡§ø ‡§â‡§∏ ‡§∏‡§Ç‡§∏‡§æ‡§ß‡§® ‡§Æ‡•á‡§Ç ‡§Ü‡§™ ‡§è‡§ï ‡§ï‡•ç‡§∞‡•â‡§∏ ‡§Ö‡§ï‡§æ‡§â‡§Ç‡§ü ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ ‡§Ø‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§ø‡§∞‡•ç‡§¶‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:

* `arn:aws:iam::acc_id:role/role_name`
* `arn:aws:iam::acc_id:user/user_name`
{% endhint %}

‡§Ø‡§π ‡§è‡§ï ‡§®‡•Ä‡§§‡§ø ‡§ï‡§æ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§π‡•à:
```json
{
"Version":"2012-10-17",
"Statement":[
{
"Effect":"Allow",
"Principal":
{
"AWS":"arn:aws:iam::216825089941:role\/Test"
},
"Action":"sts:AssumeRole"
}
]
}
```
#### GUI

‡§Ø‡§π **‡§§‡•ç‡§∞‡•Å‡§ü‡§ø** ‡§π‡•à ‡§ú‡•ã ‡§Ü‡§™‡§ï‡•ã ‡§Æ‡§ø‡§≤‡•á‡§ó‡•Ä ‡§Ø‡§¶‡§ø ‡§Ü‡§™ **‡§ê‡§∏‡•Ä ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç ‡§ú‡•ã ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à**‡•§ ‡§Ø‡§¶‡§ø ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ **‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à**, ‡§§‡•ã ‡§®‡•Ä‡§§‡§ø **‡§¨‡§ø‡§®‡§æ ‡§ï‡§ø‡§∏‡•Ä ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§ï‡•á ‡§∏‡§π‡•á‡§ú‡•Ä ‡§ú‡§æ‡§è‡§ó‡•Ä**‡•§ (‡§Ø‡§π ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§Ö‡§¶‡•ç‡§Ø‡§§‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡•à, ‡§≤‡•á‡§ï‡§ø‡§® ‡§Ø‡§π ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§ï‡•á ‡§∏‡§Æ‡§Ø ‡§≠‡•Ä ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à)

![](<../../../.gitbook/assets/image (153).png>)

#### CLI
```bash
### You could also use: aws iam update-assume-role-policy
# When it works
aws iam create-role --role-name Test-Role --assume-role-policy-document file://a.json
{
"Role": {
"Path": "/",
"RoleName": "Test-Role",
"RoleId": "AROA5ZDCUJS3DVEIYOB73",
"Arn": "arn:aws:iam::947247140022:role/Test-Role",
"CreateDate": "2022-05-03T20:50:04Z",
"AssumeRolePolicyDocument": {
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::316584767888:role/account-balance"
},
"Action": [
"sts:AssumeRole"
]
}
]
}
}
}

# When it doesn't work
aws iam create-role --role-name Test-Role2 --assume-role-policy-document file://a.json
An error occurred (MalformedPolicyDocument) when calling the CreateRole operation: Invalid principal in policy: "AWS":"arn:aws:iam::316584767888:role/account-balanceefd23f2"
```
You can automate this process with [https://github.com/carlospolop/aws\_tools](https://github.com/carlospolop/aws\_tools)

* `bash unauth_iam.sh -t user -i 316584767888 -r TestRole -w ./unauth_wordlist.txt`

‡§Ø‡§æ [Pacu](https://github.com/RhinoSecurityLabs/pacu) ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á:

* `run iam__enum_users --role-name admin --account-id 229736458923 --word-list /tmp/names.txt`
* `run iam__enum_roles --role-name admin --account-id 229736458923 --word-list /tmp/names.txt`
* ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§Æ‡•á‡§Ç ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ `admin` role **‡§Ü‡§™‡§ï‡•á ‡§ñ‡§æ‡§§‡•á ‡§Æ‡•á‡§Ç ‡§è‡§ï role ‡§π‡•à ‡§ú‡§ø‡§∏‡•á pacu ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ impersonate ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§®‡§æ ‡§π‡•à** ‡§â‡§® ‡§®‡•Ä‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ú‡§ø‡§®‡•ç‡§π‡•á‡§Ç enumeration ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•à

### Privesc

‡§Ø‡§¶‡§ø role ‡§ó‡§≤‡§§ ‡§§‡§∞‡•Ä‡§ï‡•á ‡§∏‡•á ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§•‡§æ ‡§î‡§∞ ‡§ï‡§ø‡§∏‡•Ä ‡§ï‡•ã ‡§≠‡•Ä ‡§á‡§∏‡•á assume ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": "sts:AssumeRole"
}
]
}
```
‡§Ö‡§ü‡•à‡§ï‡§∞ ‡§á‡§∏‡•á ‡§Æ‡§æ‡§® ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§

## Third Party OIDC Federation

‡§ï‡§≤‡•ç‡§™‡§®‡§æ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§Ü‡§™ ‡§è‡§ï **Github Actions workflow** ‡§™‡§¢‡§º‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§´‡§≤ ‡§π‡•ã ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç ‡§ú‡•ã **AWS** ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§è‡§ï **role** ‡§ï‡•ã ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à‡•§\
‡§Ø‡§π ‡§ü‡•ç‡§∞‡§∏‡•ç‡§ü ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ **trust policy** ‡§ï‡•á ‡§∏‡§æ‡§• ‡§è‡§ï role ‡§ï‡•ã ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§¶‡•á ‡§∏‡§ï‡§§‡§æ ‡§π‡•à:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"Federated": "arn:aws:iam::<acc_id>:oidc-provider/token.actions.githubusercontent.com"
},
"Action": "sts:AssumeRoleWithWebIdentity",
"Condition": {
"StringEquals": {
"token.actions.githubusercontent.com:aud": "sts.amazonaws.com"
}
}
}
]
}
```
‡§Ø‡§π ‡§ü‡•ç‡§∞‡§∏‡•ç‡§ü ‡§™‡•â‡§≤‡§ø‡§∏‡•Ä ‡§∏‡§π‡•Ä ‡§π‡•ã ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à, ‡§≤‡•á‡§ï‡§ø‡§® **‡§Ö‡§ß‡§ø‡§ï ‡§∂‡§∞‡•ç‡§§‡•ã‡§Ç ‡§ï‡•Ä ‡§ï‡§Æ‡•Ä** ‡§Ü‡§™‡§ï‡•ã ‡§á‡§∏‡•á ‡§Ö‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡§ú‡§¨‡•Ç‡§∞ ‡§ï‡§∞ ‡§¶‡•á‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è‡•§\
‡§Ø‡§π ‡§á‡§∏‡§≤‡§ø‡§è ‡§π‡•à ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§™‡§ø‡§õ‡§≤‡•Ä ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ ‡§ï‡•ã **Github Actions ‡§∏‡•á ‡§ï‡•ã‡§à ‡§≠‡•Ä** ‡§ó‡•ç‡§∞‡§π‡§£ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à! ‡§Ü‡§™‡§ï‡•ã ‡§∂‡§∞‡•ç‡§§‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Ö‡§®‡•ç‡§Ø ‡§ö‡•Ä‡§ú‡•á‡§Ç ‡§≠‡•Ä ‡§®‡§ø‡§∞‡•ç‡§¶‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è ‡§ú‡•à‡§∏‡•á ‡§ï‡§ø org name, repo name, env, brach...

‡§è‡§ï ‡§î‡§∞ ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ ‡§ó‡§≤‡§§ ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§® ‡§π‡•à **‡§è‡§ï ‡§∂‡§∞‡•ç‡§§ ‡§ú‡•ã‡§°‡§º‡§®‡§æ** ‡§ú‡•à‡§∏‡•á ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§:
```json
"StringLike": {
"token.actions.githubusercontent.com:sub": "repo:org_name*:*"
}
```
‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç ‡§ï‡§ø **wildcard** (\*) **colon** (:) ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§π‡•à‡•§ ‡§Ü‡§™ **org\_name1** ‡§ú‡•à‡§∏‡•Ä ‡§è‡§ï org ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ Github Action ‡§∏‡•á **role assume** ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

## ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠

* [https://www.youtube.com/watch?v=8ZXRw4Ry3mQ](https://www.youtube.com/watch?v=8ZXRw4Ry3mQ)
* [https://rhinosecuritylabs.com/aws/assume-worst-aws-assume-role-enumeration/](https://rhinosecuritylabs.com/aws/assume-worst-aws-assume-role-enumeration/)

{% hint style="success" %}
AWS Hacking ‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking ‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ‡§ï‡•ã ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§¶‡•á‡§Ç</summary>

* [**subscription plans**](https://github.com/sponsors/carlospolop) ‡§¶‡•á‡§ñ‡•á‡§Ç!
* üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) ‡§Ø‡§æ [**telegram group**](https://t.me/peass) ‡§Æ‡•á‡§Ç ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•ã‡§Ç ‡§Ø‡§æ ‡§π‡§Æ‡•á‡§Ç **Twitter** üê¶ ‡§™‡§∞ **‡§´‡•â‡§≤‡•ã** ‡§ï‡§∞‡•á‡§Ç [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç** [**HackTricks**](https://github.com/carlospolop/hacktricks) ‡§î‡§∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos ‡§Æ‡•á‡§Ç PRs ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡§ï‡•á‡•§

</details>
{% endhint %}
