# AWS - CodeBuild Unauthenticated Access

{% hint style="success" %}
Aprenda e pratique AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprenda e pratique GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo no Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo no telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## CodeBuild

Para mais informa√ß√µes, confira esta p√°gina:

{% content-ref url="../aws-services/aws-codebuild-enum.md" %}
[aws-codebuild-enum.md](../aws-services/aws-codebuild-enum.md)
{% endcontent-ref %}

### buildspec.yml

Se voc√™ comprometer o acesso de escrita a um reposit√≥rio contendo um arquivo chamado **`buildspec.yml`**, voc√™ pode **backdoor** este arquivo, que especifica os **comandos que ser√£o executados** dentro de um projeto CodeBuild e exfiltrar os segredos, comprometer o que √© feito e tamb√©m comprometer as **credenciais do IAM role do CodeBuild**.

Note que mesmo que n√£o exista nenhum arquivo **`buildspec.yml`**, mas voc√™ sabe que o CodeBuild est√° sendo usado (ou um CI/CD diferente), **modificar algum c√≥digo leg√≠timo** que ser√° executado tamb√©m pode te dar um shell reverso, por exemplo.

Para algumas informa√ß√µes relacionadas, voc√™ pode conferir a p√°gina sobre como atacar Github Actions (semelhante a isso):

{% content-ref url="../../../pentesting-ci-cd/github-security/abusing-github-actions/" %}
[abusing-github-actions](../../../pentesting-ci-cd/github-security/abusing-github-actions/)
{% endcontent-ref %}

## Self-hosted GitHub Actions runners in AWS CodeBuild <a href="#action-runner" id="action-runner"></a>

Como [**indicado na documenta√ß√£o**](https://docs.aws.amazon.com/codebuild/latest/userguide/action-runner.html), √© poss√≠vel configurar o **CodeBuild** para executar **Github actions self-hosted** quando um workflow √© acionado dentro de um reposit√≥rio Github configurado. Isso pode ser detectado verificando a configura√ß√£o do projeto CodeBuild porque o **`Event type`** precisa conter: **`WORKFLOW_JOB_QUEUED`** e em um Workflow do Github porque ele selecionar√° um runner **self-hosted** assim:
```bash
runs-on: codebuild-<project-name>-${{ github.run_id }}-${{ github.run_attempt }}
```
Este novo relacionamento entre Github Actions e AWS cria outra maneira de comprometer a AWS a partir do Github, pois o c√≥digo no Github ser√° executado em um projeto CodeBuild com uma fun√ß√£o IAM anexada.

{% hint style="success" %}
Aprenda e pratique AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprenda e pratique GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo no Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo no telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
