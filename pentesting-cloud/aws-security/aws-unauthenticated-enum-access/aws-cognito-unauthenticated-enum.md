# AWS - Cognito Unauthenticated Enum

{% hint style="success" %}
AWSハッキングの学習と練習:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPハッキングの学習と練習: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksのサポート</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
* **HackTricks**と**HackTricks Cloud**のgithubリポジトリにPRを提出して**ハッキングトリックを共有**してください。

</details>
{% endhint %}

## Unauthenticated Cognito

Cognitoは、開発者が**アプリユーザーにAWSサービスへのアクセス権を付与**できるようにするAWSサービスです。開発者は、アプリ内の**認証済みユーザーにIAMロールを付与**し（おそらく人々は単にサインアップすることができるかもしれません）、**未認証ユーザーにIAMロールを付与**することもできます。

Cognitoの基本情報については、以下をチェックしてください：

{% content-ref url="../aws-services/aws-cognito-enum/" %}
[aws-cognito-enum](../aws-services/aws-cognito-enum/)
{% endcontent-ref %}

### ペンテストと列挙のためのPacuモジュール

AWSのExploitationフレームワークである[Pacu](https://github.com/RhinoSecurityLabs/pacu)には、現在、アカウント内のすべてのCognitoアセットの列挙を自動化し、弱い構成、アクセス制御に使用されるユーザー属性などをフラグ付けし、ユーザーの作成（MFAサポートを含む）や、変更可能なカスタム属性に基づく特権昇格、使用可能なアイデンティティプール資格情報、IDトークン内の仮定可能なロールなどを自動化する"cognito__enum"および"cognito__attack"モジュールが含まれています。

モジュールの機能の説明については、[ブログ記事](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2)の第2部を参照してください。インストール手順については、メインの[Pacu](https://github.com/RhinoSecurityLabs/pacu)ページを参照してください。

### 使用方法

指定されたアイデンティティプールとユーザープールクライアントに対してユーザーの作成とすべての特権昇格ベクトルを試行するためのcognito__attackの使用例：
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
以下は、現在のAWSアカウントで表示されるすべてのユーザープール、ユーザープールクライアント、アイデンティティプール、ユーザーなどを収集するためのcognito__enumのサンプル使用法です：
```bash
Pacu (new:test) > run cognito__enum
```
### Identity Pool ID

Identity Poolsは、**未認証ユーザーにIAMロールを付与**することができますが、これは単に**Identity Pool IDを知っている**だけで（かなり**見つけやすい**）、この情報を持つ攻撃者はそのIAMロールに**アクセスを試み**、悪用することができます。\
さらに、IAMロールは、Identity Poolにアクセスする**認証済みユーザー**にも割り当てることができます。攻撃者が**ユーザーを登録**することができるか、またはIdentity Poolで使用されている**IDプロバイダーにアクセス**できる場合、**認証済みユーザーに与えられているIAMロールにアクセス**し、その権限を悪用することができます。

[**ここでその方法を確認**](../aws-services/aws-cognito-enum/cognito-identity-pools.md).

### User Pool ID

デフォルトでは、Cognitoは**新しいユーザーを登録**することを許可します。ユーザーを登録できるようになると、**基盤となるアプリケーション**や、CognitoユーザープールをIDプロバイダーとして受け入れているIdentity Poolの**認証済みIAMアクセスロールにアクセス**できるかもしれません。[**ここでその方法を確認**](../aws-services/aws-cognito-enum/cognito-user-pools.md#registration).
