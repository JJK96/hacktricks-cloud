# AWS - Enumerazione non autenticata di Cognito

{% hint style="success" %}
Impara e pratica l'Hacking su AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Impara e pratica l'Hacking su GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Sostieni HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>
{% endhint %}

## Cognito non autenticato

Cognito √® un servizio AWS che consente agli sviluppatori di **concedere agli utenti dell'app l'accesso ai servizi AWS**. Gli sviluppatori concederanno **ruoli IAM agli utenti autenticati** nella loro app (potenzialmente le persone potranno semplicemente registrarsi) e possono anche concedere un **ruolo IAM agli utenti non autenticati**.

Per informazioni di base su Cognito, controlla:

{% content-ref url="../aws-services/aws-cognito-enum/" %}
[aws-cognito-enum](../aws-services/aws-cognito-enum/)
{% endcontent-ref %}

### Moduli Pacu per pentesting e enumerazione

[Pacu](https://github.com/RhinoSecurityLabs/pacu), il framework di sfruttamento AWS, include ora i moduli "cognito__enum" e "cognito__attack" che automatizzano l'enumerazione di tutti gli asset di Cognito in un account e segnalano configurazioni deboli, attributi utente utilizzati per il controllo degli accessi, ecc., e automatizzano anche la creazione di utenti (incluso il supporto MFA) e l'escalation dei privilegi basata su attributi personalizzabili modificabili, credenziali di pool di identit√† utilizzabili, ruoli assumibili nei token di identit√†, ecc.

Per una descrizione delle funzioni dei moduli, consulta la parte 2 del [post sul blog](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2). Per le istruzioni di installazione, consulta la pagina principale di [Pacu](https://github.com/RhinoSecurityLabs/pacu).

### Utilizzo

Esempio di utilizzo di cognito__attack per tentare la creazione di utenti e tutti i vettori di escalation dei privilegi contro un determinato pool di identit√† e client pool di utenti:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
Campione di utilizzo di cognito__enum per raccogliere tutti i pool di utenti, client pool di utenti, pool di identit√†, utenti, ecc. visibili nell'account AWS corrente:
```bash
Pacu (new:test) > run cognito__enum
```
### ID Pool di identit√†

Gli Identity Pool possono concedere **ruoli IAM agli utenti non autenticati** che conoscono semplicemente l'**ID del Pool di identit√†** (che √® abbastanza comune da **trovare**), e un attaccante con queste informazioni potrebbe cercare di **accedere a quel ruolo IAM** ed sfruttarlo.\
Inoltre, i ruoli IAM potrebbero anche essere assegnati agli **utenti autenticati** che accedono all'Identity Pool. Se un attaccante pu√≤ **registrare un utente** o ha gi√† **accesso al provider di identit√†** utilizzato nel pool di identit√†, potrebbe accedere al **ruolo IAM assegnato agli utenti autenticati** e abusarne dei privilegi.

[**Verifica come fare ci√≤ qui**](../aws-services/aws-cognito-enum/cognito-identity-pools.md).

### ID Pool utente

Per impostazione predefinita, Cognito consente di **registrare nuovi utenti**. Essere in grado di registrare un utente potrebbe darti **accesso** all'**applicazione sottostante** o al **ruolo di accesso IAM autenticato di un Pool di identit√†** che accetta come provider di identit√† il Pool utente Cognito. [**Verifica come fare ci√≤ qui**](../aws-services/aws-cognito-enum/cognito-user-pools.md#registration).
