# AWS - S3 Persistence

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## S3

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ:

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### KMS Client-Side Encryption

–ö–æ–ª–∏ –ø—Ä–æ—Ü–µ—Å —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î KMS API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –Ω–æ–≤–æ–≥–æ –∫–ª—é—á–∞ (`aws kms generate-data-key`) —ñ **–∑–±–µ—Ä—ñ–≥–∞—î –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π –∫–ª—é—á —É –º–µ—Ç–∞–¥–∞–Ω–∏—Ö** —Ñ–∞–π–ª—É ([python code example](https://aioboto3.readthedocs.io/en/latest/cse.html#how-it-works-kms-managed-keys)), —â–æ–± –ø—ñ–¥ —á–∞—Å —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∫–∏ –π–æ–≥–æ –º–æ–∂–Ω–∞ –±—É–ª–æ –∑–Ω–æ–≤—É —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é KMS:

<figure><img src="../../../.gitbook/assets/image (226).png" alt=""><figcaption></figcaption></figure>

–û—Ç–∂–µ, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ü–µ–π –∫–ª—é—á –∑ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö —ñ —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –π–æ–≥–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é KMS (`aws kms decrypt`), —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–ª—é—á, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –æ—Ç—Ä–∏–º–∞—î –∫–ª—é—á —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è, —ñ —è–∫—â–æ —Ü–µ–π –∫–ª—é—á –±—É–¥–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —ñ–Ω—à–∏—Ö —Ñ–∞–π–ª—ñ–≤, –≤—ñ–Ω –∑–º–æ–∂–µ –π–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏.

### Using S3 ACLs

–•–æ—á–∞ –∑–∞–∑–≤–∏—á–∞–π ACL –¥–ª—è –±–∞–∫–µ—Ç—ñ–≤ –≤–∏–º–∫–Ω–µ–Ω—ñ, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∑ –¥–æ—Å—Ç–∞—Ç–Ω—ñ–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏ –º–æ–∂–µ —ó—Ö –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ (—è–∫—â–æ –≤–æ–Ω–∏ —É–≤—ñ–º–∫–Ω–µ–Ω—ñ –∞–±–æ —è–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ —ó—Ö —É–≤—ñ–º–∫–Ω—É—Ç–∏), —â–æ–± –∑–±–µ—Ä–µ–≥—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ S3 –±–∞–∫–µ—Ç—É.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
