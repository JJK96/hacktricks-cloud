# AWS - Lambda Persistence

{% hint style="success" %}
AWS Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХреЛ рд╕рдорд░реНрдерди рджреЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдУрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рд╣рдореЗрдВ рдлреЙрд▓реЛ рдХрд░реЗрдВ** **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
{% endhint %}

## Lambda

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% content-ref url="../../aws-services/aws-lambda-enum.md" %}
[aws-lambda-enum.md](../../aws-services/aws-lambda-enum.md)
{% endcontent-ref %}

### Lambda Layer Persistence

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рдПрдХ рд▓реЗрдпрд░ рдореЗрдВ рдмреИрдХрдбреЛрд░ рдбрд╛рд▓рдХрд░ рдордирдорд╛рдирд╛ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП** рдЬрдм lambda рдХреЛ рдПрдХ рдЧреБрдкреНрдд рддрд░реАрдХреЗ рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП:

{% content-ref url="aws-lambda-layers-persistence.md" %}
[aws-lambda-layers-persistence.md](aws-lambda-layers-persistence.md)
{% endcontent-ref %}

### Lambda Extension Persistence

Lambda Layers рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдпрд╣ рднреА рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреНрд╕ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдП рдФрд░ lambda рдореЗрдВ рд╕реНрдерд╛рдпрд┐рддреНрд╡ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рдП, рд╕рд╛рде рд╣реА рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЪреБрд░рд╛рдпрд╛ рдФрд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПред

{% content-ref url="aws-abusing-lambda-extensions.md" %}
[aws-abusing-lambda-extensions.md](aws-abusing-lambda-extensions.md)
{% endcontent-ref %}

### рд╕рдВрд╕рд╛рдзрди рдиреАрддрд┐рдпреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рд╡рд┐рднрд┐рдиреНрди lambda рдХреНрд░рд┐рдпрд╛рдУрдВ (рдЬреИрд╕реЗ invoke рдпрд╛ рдХреЛрдб рдЕрдкрдбреЗрдЯ) рддрдХ рдкрд╣реБрдВрдЪ рдмрд╛рд╣рд░реА рдЦрд╛рддреЛрдВ рдХреЛ рджреА рдЬрд╛рдП:

<figure><img src="../../../../.gitbook/assets/image (255).png" alt=""><figcaption></figcaption></figure>

### рд╕рдВрд╕реНрдХрд░рдг, рдЙрдкрдирд╛рдо рдФрд░ рднрд╛рд░

рдПрдХ Lambda рдХреЗ **рд╡рд┐рднрд┐рдиреНрди рд╕рдВрд╕реНрдХрд░рдг** рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ (рдкреНрд░рддреНрдпреЗрдХ рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд╕рд╛рде рдЕрд▓рдЧ рдХреЛрдб)ред\
рдлрд┐рд░, рдЖрдк lambda рдХреЗ **рд╡рд┐рднрд┐рдиреНрди рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЗ рд╕рд╛рде рд╡рд┐рднрд┐рдиреНрди рдЙрдкрдирд╛рдо** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рднрд╛рд░ рджреЗ рд╕рдХрддреЗ рд╣реИрдВред\
рдЗрд╕ рддрд░рд╣ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ **рдмреИрдХрдбреЛрд░ рд╕рдВрд╕реНрдХрд░рдг 1** рдФрд░ **рдХреЗрд╡рд▓ рд╡реИрдз рдХреЛрдб рдХреЗ рд╕рд╛рде рд╕рдВрд╕реНрдХрд░рдг 2** рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ **рдХреЗрд╡рд▓ 1% рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ рд╕рдВрд╕реНрдХрд░рдг 1 рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ** рддрд╛рдХрд┐ рдЧреБрдкреНрдд рдмрдирд╛ рд░рд╣реЗред

<figure><img src="../../../../.gitbook/assets/image (120).png" alt=""><figcaption></figcaption></figure>

### рд╕рдВрд╕реНрдХрд░рдг рдмреИрдХрдбреЛрд░ + API Gateway

1. Lambda рдХрд╛ рдореВрд▓ рдХреЛрдб рдХреЙрдкреА рдХрд░реЗрдВ
2. **рдореВрд▓ рдХреЛрдб рдХреЛ рдмреИрдХрдбреЛрд░ рдХрд░рдХреЗ рдПрдХ рдирдпрд╛ рд╕рдВрд╕реНрдХрд░рдг рдмрдирд╛рдПрдВ** (рдпрд╛ рд╕рд┐рд░реНрдл рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдХреЛрдб рдХреЗ рд╕рд╛рде)ред рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░реЗрдВ рдФрд░ **рдЙрд╕ рд╕рдВрд╕реНрдХрд░рдг рдХреЛ $LATEST рдкрд░ рддреИрдирд╛рдд рдХрд░реЗрдВ**
1. рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП lambda рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд API gateway рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ
3. **рдореВрд▓ рдХреЛрдб рдХреЗ рд╕рд╛рде рдПрдХ рдирдпрд╛ рд╕рдВрд╕реНрдХрд░рдг рдмрдирд╛рдПрдВ**, рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░реЗрдВ рдФрд░ **рдЙрд╕ рд╕рдВрд╕реНрдХрд░рдг рдХреЛ $LATEST рдкрд░ рддреИрдирд╛рдд рдХрд░реЗрдВ**ред
1. рдпрд╣ рдмреИрдХрдбреЛрд░ рдХреЛрдб рдХреЛ рдПрдХ рдкрд┐рдЫрд▓реЗ рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рдЫрд┐рдкрд╛ рджреЗрдЧрд╛
4. API Gateway рдкрд░ рдЬрд╛рдПрдВ рдФрд░ **рдПрдХ рдирдпрд╛ POST рд╡рд┐рдзрд┐ рдмрдирд╛рдПрдВ** (рдпрд╛ рдХреЛрдИ рдЕрдиреНрдп рд╡рд┐рдзрд┐ рдЪреБрдиреЗрдВ) рдЬреЛ lambda рдХреЗ рдмреИрдХрдбреЛрд░ рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛: `arn:aws:lambda:us-east-1:<acc_id>:function:<func_name>:1`
1. arn рдХреЗ рдЕрдВрддрд┐рдо :1 рдХреЛ рдиреЛрдЯ рдХрд░реЗрдВ **рдЬреЛ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ** (рдЗрд╕ рдкрд░рд┐рджреГрд╢реНрдп рдореЗрдВ рд╕рдВрд╕реНрдХрд░рдг 1 рдмреИрдХрдбреЛрд░ рд╣реЛрдЧрд╛)ред
5. рдмрдирд╛рдИ рдЧрдИ POST рд╡рд┐рдзрд┐ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рдФрд░ Actions рдореЗрдВ **`Deploy API`** рдЪреБрдиреЗрдВ
6. рдЕрдм, рдЬрдм рдЖрдк **POST рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВрдЧреЗ рддреЛ рдЖрдкрдХрд╛ рдмреИрдХрдбреЛрд░** рд╕рдХреНрд░рд┐рдп рд╣реЛ рдЬрд╛рдПрдЧрд╛

### Cron/Event actuator

рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рдХрд┐ рдЖрдк **lambda рдлрд╝рдВрдХреНрд╢рдВрд╕ рдХреЛ рддрдм рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрдм рдХреБрдЫ рд╣реЛрддрд╛ рд╣реИ рдпрд╛ рдЬрдм рдХреБрдЫ рд╕рдордп рдмреАрддрддрд╛ рд╣реИ**, lambda рдПрдХ рдЕрдЪреНрдЫрд╛ рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рддрд░реАрдХрд╛ рд╣реИ рд╕реНрдерд╛рдпрд┐рддреНрд╡ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рдкрд╣рдЪрд╛рди рд╕реЗ рдмрдЪрдиреЗ рдХрд╛ред\
рдпрд╣рд╛рдВ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреБрдЫ рд╡рд┐рдЪрд╛рд░ рд╣реИрдВ рдХрд┐ **AWS рдореЗрдВ рдЕрдкрдиреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреЛ рдЕрдзрд┐рдХ рдЧреБрдкреНрдд рдХреИрд╕реЗ рдмрдирд╛рдПрдВ lambda рдмрдирд╛рдХрд░**ред

* рд╣рд░ рдмрд╛рд░ рдЬрдм рдПрдХ рдирдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, lambda рдПрдХ рдирдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреБрдВрдЬреА рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рднреЗрдЬрддрд╛ рд╣реИред
* рд╣рд░ рдмрд╛рд░ рдЬрдм рдПрдХ рдирдИ рднреВрдорд┐рдХрд╛ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ, lambda рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рднреВрдорд┐рдХрд╛ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рджреЗрддрд╛ рд╣реИред
* рд╣рд░ рдмрд╛рд░ рдЬрдм рдирдП cloudtrail рд▓реЙрдЧ рдЙрддреНрдкрдиреНрди рд╣реЛрддреЗ рд╣реИрдВ, рдЙрдиреНрд╣реЗрдВ рд╣рдЯрд╛рдПрдВ/рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ

{% hint style="success" %}
AWS Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХреЛ рд╕рдорд░реНрдерди рджреЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдУрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рд╣рдореЗрдВ рдлреЙрд▓реЛ рдХрд░реЗрдВ** **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
{% endhint %}
