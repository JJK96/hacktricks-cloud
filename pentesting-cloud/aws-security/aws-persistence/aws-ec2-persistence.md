# AWS - EC2 Persistence

{% hint style="success" %}
рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ GCP рд╣реИрдХрд┐рдВрдЧ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рдЧреНрд░реБрдк**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдЧреНрд░реБрдк**](https://t.me/peass) рдпрд╛ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдХреЛ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
{% endhint %}

## EC2

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% content-ref url="../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

### рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣ рдХрдиреЗрдХреНрд╢рди рдЯреНрд░реИрдХрд┐рдВрдЧ рдкрд░рд┐рд╕реНрдерд┐рддрд┐

рдпрджрд┐ рдПрдХ рдбрд┐рдлреЗрдВрдбрд░ рдкрд╛рддрд╛ рд╣реИ рдХрд┐ **рдПрдХ EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЛ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝** рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рд╡рд╣ рд╕рдВрднрд╛рд╡рд┐рдд рд╣реИ рдХрд┐ **рдорд╢реАрди рдХреЗ рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рдЕрд▓рдЧ рдХрд░рдиреЗ** рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛ред рд╡рд╣ рдЗрд╕реЗ рдПрдХ рд╕реНрдкрд╖реНрдЯ **рдирдХрд▓ NACL** рдХреЗ рд╕рд╛рде рдХрд░ рд╕рдХрддрд╛ рд╣реИ (рд▓реЗрдХрд┐рди NACL рдкреВрд░реЗ рд╕рдмрдиреЗрдЯ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддреЗ рд╣реИрдВ), рдпрд╛ **рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣ рдХреЛ рдмрджрд▓рдХрд░** рдХрд┐рд╕реА рднреА рдкреНрд░рдХрд╛рд░ рдХреА **рдЗрдирдмрд╛рдЙрдВрдб рдпрд╛ рдЖрдЙрдЯрдмрд╛рдЙрдВрдб** рдЯреНрд░реИрдлрд┐рдХ рдХреА рдЕрдиреБрдорддрд┐ рди рджреЗрдиреЗред

рдпрджрд┐ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдкрд╛рд╕ рдорд╢реАрди рд╕реЗ рдЙрддреНрдкрдиреНрди **рд░рд┐рд╡рд░реНрд╕ рд╢реИрд▓** рдерд╛, рддреЛ рдпрджреА рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ рдЗрдирдмрд╛рдЙрдВрдб рдпрд╛ рдЖрдЙрдЯрдмрд╛рдЙрдВрдб рдЯреНрд░реИрдлрд┐рдХ рдХреА рдЕрдиреБрдорддрд┐ рди рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП, **рдХрдиреЗрдХреНрд╢рди рдорд░рдиреЗ рдХреА рд╡рдЬрд╣ рдирд╣реАрдВ рд╣реЛрдЧреА** [**рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣ рдХрдиреЗрдХреНрд╢рди рдЯреНрд░реИрдХрд┐рдВрдЧ**](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-connection-tracking.html)** рдХреЗ рдХрд╛рд░рдгред**

### EC2 рдЬреАрд╡рдирдЪрдХреНрд░ рдкреНрд░рдмрдВрдзрдХ

рдпрд╣ рд╕реЗрд╡рд╛ **AMIs рдФрд░ рд╕реНрдиреИрдкрд╢реЙрдЯреНрд╕ рдХреА рд░рдЪрдирд╛ рдХреЛ рдЕрдиреБрд╕реВрдЪрд┐рдд** рдХрд░рдиреЗ рджреЗрддреА рд╣реИ рдФрд░ рдпрд╣рд╛рдБ рддрдХ рдХрд┐ **рдЙрдиреНрд╣реЗрдВ рдЕрдиреНрдп рдЦрд╛рддреЛрдВ рдХреЗ рд╕рд╛рде рд╕рд╛рдЭрд╛** рднреА рдХрд░ рд╕рдХрддреА рд╣реИред\
рдПрдХ рд╣рдорд▓рд╛рд╡рд░ **рд╕рднреА рдЫрд╡рд┐рдпреЛрдВ рдпрд╛ рд╕рднреА рд╡реЙрд▓реНрдпреВрдо рдХреА AMIs рдпрд╛ рд╕реНрдиреИрдкрд╢реЙрдЯреНрд╕ рдХреА рд░рдЪрдирд╛** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ **рд╣рд░ рд╣рдлреНрддреЗ** рдФрд░ **рдЙрдиреНрд╣реЗрдВ рдЕрдкрдиреЗ рдЦрд╛рддреЗ рдХреЗ рд╕рд╛рде рд╕рд╛рдЭрд╛** рдХрд░ рд╕рдХрддрд╛ рд╣реИред

### рдЕрдиреБрд╕реВрдЪрд┐рдд рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕

рджреИрдирд┐рдХ, рд╕рд╛рдкреНрддрд╛рд╣рд┐рдХ рдпрд╛ рдорд╛рд╕рд┐рдХ рд░реВрдк рд╕реЗ рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рдХреЛ рдЕрдиреБрд╕реВрдЪрд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рдорд╢реАрди рдХреЛ рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдпрд╛ рджрд┐рд▓рдЪрд╕реНрдк рдкрд╣реБрдВрдЪ рдХреЗ рд╕рд╛рде рдЪрд▓рд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд╣рд╛рдБ рд╡рд╣ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИред

### рд╕реНрдкреЙрдЯ рдлреНрд▓реАрдЯ рдЕрдиреБрд░реЛрдз

рд╕реНрдкреЙрдЯ рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рдирд┐рдпрдорд┐рдд рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рд╕реЗ **рд╕рд╕реНрддреА** рд╣реЛрддреА рд╣реИрдВред рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ **рдЫреЛрдЯреА рд╕реНрдкреЙрдЯ рдлреНрд▓реАрдЯ рдЕрдиреБрд░реЛрдз рд╢реБрд░реВ рдХрд░ рд╕рдХрддрд╛ рд╣реИ 5 рд╕рд╛рд▓** рдХреЗ рд▓рд┐рдП (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП), рдЬрд┐рд╕рдореЗрдВ **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЖрдИрдкреА** рдЕрд╕рд╛рдЗрдирдореЗрдВрдЯ рдФрд░ рдПрдХ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛** рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **рдЬрдм рд╕реНрдкреЙрдЯ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╢реБрд░реВ рд╣реЛрддреА рд╣реИ** рдФрд░ **рдЖрдИрдкреА рдкрддрд╛** рдФрд░ рдПрдХ **рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ IAM рднреВрдорд┐рдХрд╛** рдХреЛ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рднреЗрдЬрддрд╛ рд╣реИред

### рдкрд┐рдЫрд▓реЗ рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдкрд┐рдЫрд▓реЗ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:

* рдПрдХ рдкрд╛рд░рдВрдкрд░рд┐рдХ **рд░реВрдЯрдХрд┐рдЯ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП
* рдПрдХ рдирдпрд╛ **рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ SSH рдХреБрдВрдЬреА** рдЬреЛрдбрд╝рдирд╛ (рдЬрд╛рдВрдЪ рдХрд░реЗрдВ [EC2 рдкреНрд░рд┐рд╡реЗрд╕реНрдХ рд╡рд┐рдХрд▓реНрдк](../../aws-security/aws-privilege-escalation/aws-ec2-privesc.md))
* **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛** рдХреЛ рдкрд┐рдЫрд▓реЗ рдХрд░рдирд╛

### **рдкрд┐рдЫрд▓реЗ рд▓реЙрдиреНрдЪ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди**

* рдЙрдкрдпреЛрдЧ рдХреА рдЧрдИ AMI рдХреЛ рдкрд┐рдЫрд▓реЗ рдХрд░реЗрдВ
* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛ рдХреЛ рдкрд┐рдЫрд▓реЗ рдХрд░реЗрдВ
* рдХреБрдВрдЬреА рдЬреЛрдбрд╝рдирд╛ рдкрд┐рдЫрд▓реЗ рдХрд░реЗрдВ

### рд╡реАрдкреАрдПрди

рдПрдХ рд╡реАрдкреАрдПрди рдмрдирд╛рдПрдВ рддрд╛рдХрд┐ рд╣рдорд▓рд╛рд╡рд░ рд╕реАрдзреЗ рд╡реАрдкреАрд╕реА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХреЗред

### рд╡реАрдкреАрд╕реА рдкреАрдпрд░рд┐рдВрдЧ

рд╣рдорд▓рд╛рд╡рд░ рд╡реАрдкреАрд╕реА рдФрд░ рдЖрдХреНрд░рдордХ рд╡реАрдкреАрд╕реА рдХреЗ рдмреАрдЪ рдПрдХ рдкреАрдпрд░рд┐рдВрдЧ рдХрдиреЗрдХреНрд╢рди рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╡рд╣ рдЖрдХреНрд░рдордХ рд╡реАрдкреАрд╕реА рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХреЗред

{% hint style="success" %}
рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ GCP рд╣реИрдХрд┐рдВрдЧ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рдЧреНрд░реБрдк**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдЧреНрд░реБрдк**](https://t.me/peass) рдпрд╛ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдХреЛ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
{% endhint %}
