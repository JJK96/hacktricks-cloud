# AWS - CloudWatch Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team 전문가)</strong>에서 <strong>AWS 해킹을 처음부터 전문가까지 배우세요</strong>!</summary>

다른 방법으로 HackTricks를 지원하는 방법:

- **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
- [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구입하세요
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
- **💬 [Discord 그룹](https://discord.gg/hRep4RUj7f)** 또는 [텔레그램 그룹](https://t.me/peass)에 **가입**하거나 **트위터** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
- **HackTricks** 및 **HackTricks Cloud** github 저장소에 PR을 제출하여 해킹 트릭을 공유하세요.

</details>

## CloudWatch

**CloudWatch**는 로그/메트릭/이벤트 형식의 모니터링 및 운영 데이터를 수집하여 AWS 리소스, 응용 프로그램 및 서비스의 **통합된 보기**를 제공합니다.\
CloudWatch 로그 이벤트는 각 로그 라인마다 **256KB의 크기 제한**이 있습니다.\
고해상도 알람을 설정할 수 있으며 **로그** 및 **메트릭**을 시각화하여 자동 조치를 취하고 문제를 해결하며 응용 프로그램을 최적화하는 통찰을 얻을 수 있습니다.

예를 들어 CloudTrail에서 로그를 모니터링할 수 있습니다. 모니터링되는 이벤트:

- 보안 그룹 및 NACL 변경
- EC2 인스턴스 시작, 중지, 재부팅 및 종료
- IAM 및 S3 내의 보안 정책 변경
- AWS 관리 콘솔에 대한 로그인 시도 실패
- 권한 부여 실패로 인한 API 호출
- CloudWatch에서 검색할 필터: [https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html](https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html)

## 주요 개념

### 네임스페이스

네임스페이스는 CloudWatch 메트릭의 컨테이너입니다. 메트릭을 분류하고 격리하여 관리하고 분석하기 쉽게 도와줍니다.

- **예시**: EC2 관련 메트릭의 경우 AWS/EC2, RDS 메트릭의 경우 AWS/RDS.

### 메트릭

메트릭은 시간에 따라 수집된 성능 또는 이용률을 나타내는 데이터 포인트입니다. 메트릭은 AWS 서비스, 사용자 지정 응용 프로그램 또는 타사 통합에서 수집할 수 있습니다.

- **예시**: CPUUtilization, NetworkIn, DiskReadOps.

### 디멘션

디멘션은 메트릭의 일부인 키-값 쌍입니다. 메트릭을 고유하게 식별하고 추가적인 컨텍스트를 제공하여 특정 속성을 기반으로 메트릭을 필터링하고 집계할 수 있습니다. 메트릭에 연결할 수 있는 디멘션의 최대 수는 30개입니다.

- **예시**: EC2 인스턴스의 경우 디멘션에는 InstanceId, InstanceType, AvailabilityZone 등이 포함될 수 있습니다.

### 통계

통계는 메트릭 데이터에 대해 수행되는 수학적 계산으로 시간에 걸쳐 데이터를 요약합니다. 일반적인 통계에는 평균, 합계, 최소, 최대, 샘플 수가 포함됩니다.

- **예시**: 1시간 동안의 평균 CPU 이용률 계산.

### 단위

단위는 메트릭과 관련된 측정 유형입니다. 단위는 메트릭 데이터에 컨텍스트와 의미를 제공하는 데 도움이 됩니다. 일반적인 단위에는 Percent, Bytes, Seconds, Count 등이 포함됩니다.

- **예시**: CPUUtilization은 Percent로 측정될 수 있으며, NetworkIn은 Bytes로 측정될 수 있습니다.

## CloudWatch 기능

### 대시보드

**CloudWatch 대시보드**는 AWS CloudWatch 메트릭의 **사용자 정의 뷰**를 제공합니다. 대시보드를 생성하고 구성하여 데이터를 시각화하고 단일 뷰에서 리소스를 모니터링할 수 있으며, 다양한 AWS 서비스에서 다양한 메트릭을 결합할 수 있습니다.

**주요 기능**:

- **위젯**: 그래프, 텍스트, 알람 등을 포함하는 대시보드의 구성 요소.
- **사용자 정의**: 레이아웃 및 콘텐츠를 특정 모니터링 요구에 맞게 사용자 정의할 수 있습니다.

**예시 사용 사례**:

- EC2 인스턴스, RDS 데이터베이스 및 S3 버킷을 포함한 전체 AWS 환경의 주요 메트릭을 보여주는 단일 대시보드.

### 메트릭 스트림 및 메트릭 데이터

AWS CloudWatch의 **메트릭 스트림**을 사용하면 CloudWatch 메트릭을 실시간으로 선택한 대상으로 지속적으로 스트리밍할 수 있습니다. 이는 AWS 외부의 도구를 사용하여 고급 모니터링, 분석 및 사용자 정의 대시보드에 유용합니다.

**메트릭 데이터**는 메트릭 스트림 내부의 실제 측정값 또는 데이터 포인트를 나타냅니다. 이러한 데이터 포인트는 AWS 리소스의 CPU 이용률, 메모리 사용량 등과 같은 다양한 메트릭을 나타냅니다.

**예시 사용 사례**:

- 실시간 메트릭을 제3자 모니터링 서비스로 보내어 고급 분석을 수행합니다.
- 장기 저장 및 규정 준수를 위해 Amazon S3 버킷에 메트릭을 아카이빙합니다.

### 알람

**CloudWatch 알람**은 사전 정의된 임계값을 기반으로 메트릭을 모니터링하고 사전 정의된 임계값을 초과할 때 알림을 보내는 등의 작업을 수행합니다. 메트릭이 임계값을 위반하면 알람이 SNS를 통해 알림을 보내거나 자동 확장 정책을 트리거하거나 AWS Lambda 함수를 실행할 수 있습니다.

**주요 구성 요소**:

- **임계값**: 알람이 트리거되는 값.
- **평가 기간**: 데이터가 평가되는 기간.
- **알람에 필요한 데이터 포인트**: 알람을 트리거하는 데 필요한 임계값에 도달한 기간 수
- **작업**: 알람 상태가 트리거될 때 발생하는 작업(예: SNS를 통해 알림).

**예시 사용 사례**:

- EC2 인스턴스 CPU 이용률을 모니터링하고 5분 연속 80%를 초과하면 SNS를 통해 알림을 보냅니다.

### 이상 탐지기

**이상 탐지기**는 머신러닝을 사용하여 메트릭에서 자동으로 이상을 감지합니다. 이상 탐지를 CloudWatch 메트릭에 적용하여 정상 패턴에서의 이탈을 식별할 수 있습니다.

**주요 구성 요소**:

- **모델 훈련**: CloudWatch는 정상 동작이 어떻게 보이는지를 확립하기 위해 기존 데이터를 사용하여 모델을 훈련합니다.
- **이상 탐지 밴드**: 메트릭의 예상 범위를 시각적으로 나타냅니다.

**예시 사용 사례**:

- 보안 침해 또는 응용프로그램 문제를 나타낼 수 있는 EC2 인스턴스의 CPU 이용률 패턴을 감지합니다.

### Insight Rules 및 관리 Insight Rules

**Insight Rules**를 사용하면 **강력한 수학적 표현**을 사용하여 메트릭 데이터에서 트렌드, 스파이크 또는 기타 관심 패턴을 식별할 수 있습니다. 이러한 규칙을 사용하면 리소스 성능 및 이용률에서 이상 또는 비정상적인 동작을 식별할 수 있습니다.

**관리 Insight Rules**은 AWS가 제공하는 **사전 구성된 Insight Rules**입니다. 이러한 규칙은 특정 AWS 서비스 또는 일반적인 사용 사례를 모니터링하도록 설계되었으며 자세한 구성 없이 활성화할 수 있습니다.

**예시 사용 사례**:

- RDS 성능 모니터링: Amazon RDS를 모니터링하는 관리 Insight Rule을 활성화하여 CPU 이용률, 메모리 사용량, 디스크 I/O와 같은 주요 성능 지표를 모니터링합니다. 이러한 메트릭 중 안전한 운영 임계값을 초과하는 경우 규칙이 경고 또는 자동 조치 작업을 트리거할 수 있습니다.

### CloudWatch Logs <a href="#cloudwatch-logs" id="cloudwatch-logs"></a>

**CloudWatch Logs**는 **AWS 서비스**(CloudTrail 포함) 및 **앱/시스템**(CloudWatch 에이전트를 호스트에 설치할 수 있음)에서 로그를 집계하고 모니터링할 수 있습니다. 로그는 **로그 그룹 설정에 따라 무기한 보관**되며 내보낼 수 있습니다.

**요소**:

| **로그 그룹**            | 동일한 보관, 모니터링 및 액세스 제어 설정을 공유하는 **로그 스트림 모음** |
| ------------------------ | --------------------------------------------------------------------- |
| **로그 스트림**           | **동일한 소스**를 공유하는 **로그 이벤트의 시퀀스**                   |
| **구독 필터** | 특정 로그 그룹의 이벤트와 일치하는 **필터 패턴을 정의**하고 Kinesis Data Firehose 스트림, Kinesis 스트림 또는 Lambda 함수로 전송합니다 |
### CloudWatch 모니터링 및 이벤트

CloudWatch **기본**은 데이터를 **매 5분마다** 집계합니다 (**상세한** 것은 **매 1분마다** 집계합니다). 집계 후 알람의 임계값을 확인하여 트리거할 필요가 있는지 확인합니다.\
이 경우 CloudWatch는 이벤트를 보내고 AWS 람다 함수, SNS 주제, SQS 대기열, Kinesis 스트림을 실행할 수 있습니다.

### 에이전트 설치

머신/컨테이너 내부에 에이전트를 설치하여 로그를 자동으로 CloudWatch로 보낼 수 있습니다.

* **역할**을 **생성**하고 CloudWatch가 인스턴스에서 데이터를 수집하고 AWS 시스템 관리자 SSM과 상호 작용할 수 있도록 허용하는 권한을 가진 **인스턴스**에 **연결**합니다 (CloudWatchAgentAdminPolicy 및 AmazonEC2RoleforSSM).
* EC2 인스턴스에 **에이전트**를 **다운로드**하고 **설치**합니다 ([https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip](https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip)). EC2 내부에서 다운로드하거나 AWS 시스템 관리자를 사용하여 패키지 AWS-ConfigureAWSPackage를 선택하여 자동으로 설치할 수 있습니다.
* CloudWatch 에이전트를 **구성**하고 **시작**합니다.

로그 그룹에는 많은 스트림이 있습니다. 스트림에는 많은 이벤트가 있습니다. 그리고 각 스트림 내에서 이벤트는 순서대로 보장됩니다.

## 열거
```bash
# Dashboards #

## Returns a list of the dashboards of your account
aws cloudwatch list-dashboards

## Retrieves the details of the specified dashboard
aws cloudwatch get-dashboard --dashboard-name <value>

# Metrics #

## Returns a list of the specified metric
aws cloudwatch list-metrics [--namespace <value>] [--metric-name <value>] [--dimensions <value>] [--include-linked-accounts | --no-include-linked-accounts]

## Retrieves metric data (this operation can include a CloudWatch Metrics Insights query, and one or more metric math functions)
aws cloudwatch get-metric-data --metric-data-queries <value> --start-time <value> --end-time <value>

## Retrieves statistics for the specified metric and namespace over a range of time
aws cloudwatch get-metric-statistics --namespace <value> --metric-name <value> [--dimensions <value>] --start-time <value> --end-time <value> --period <value>

## Returns a list of the metric streams of your account
aws cloudwatch list-metric-streams

## Retrieves information about the specified metric stream
aws cloudwatch get-metric-stream --name <value>

## Retrieve snapshots of the specified metric widgets
aws cloudwatch get-metric-widget-image --metric-widget <value>

# Alarms #

## Retrieves the specified alarm
aws cloudwatch describe-alarms [--alarm-names <value>] [--alarm-name-prefix <value>] [--alarm-types <value>] [--state-value <value>]

## Retrieves the alarms history, even for deleted alarms
aws cloudwatch describe-alarm-history [--alarm-name <value>] [--alarm-types <value>] [--history-item-type <ConfigurationUpdate | StateUpdate | Action>] [--start-date <value>] [--end-date <value>]

## Retrieves standard alarms based on the specified metric
aws cloudwatch escribe-alarms-for-metric --metric-name <value> --namespace <value> [--dimensions <value>]

# Anomaly Detections #

## Lists the anomaly detection models that you have created in your account
aws cloudwatch describe-anomaly-detectors [--namespace <value>] [--metric-name <value>] [--dimensions <value>]

## Lists all the Contributor Insight rules in your account
aws cloudwatch describe-insight-rules

## Retrieves the data collected over a time range for a given Contributor Insight rule
aws cloudwatch get-insight-rule-report --rule-name <value> --start-time <value> --end-time <value> --period <value>

## Lists managed Contributor Insights rules in your account for a specified resource
aws cloudwatch list-managed-insight-rules --resource-arn <value>

# Tags #

## Lists the tags associated with the specified CloudWatch resources
aws cloudwatch list-tags-for-resource --resource-arn <value>

# CloudWatch Logs #
aws logs tail "<log_group_name>" --followaws logs get-log-events --log-group-name "<log_group_name>" --log-stream-name "<log_stream_name>" --output text > <output_file>

# CloudWatch Events #
aws events list-rules
aws events describe-rule --name <name>aws events list-targets-by-rule --rule <name>aws events list-archives
aws events describe-archive --archive-name <name>aws events list-connections
aws events describe-connection --name <name>aws events list-endpoints
aws events describe-endpoint --name <name>aws events list-event-sources
aws events describe-event-source --name <name>aws events list-replays
aws events list-api-destinations
aws events list-event-buses
```
## 사후 침투 / 우회

### **`cloudwatch:DeleteAlarms`,`cloudwatch:PutMetricAlarm` , `cloudwatch:PutCompositeAlarm`**

이 권한을 가진 공격자는 조직의 모니터링 및 경보 인프라를 심각하게 약화시킬 수 있습니다. 기존 경보를 삭제함으로써 공격자는 중요한 경보를 비활성화시킬 수 있어서 관리자에게 중요한 성능 문제, 보안 침해 또는 운영 실패를 알리는 경보를 제공할 수 없게 됩니다. 또한, 메트릭 경보를 생성하거나 수정함으로써 공격자는 잘못된 경보로 관리자를 속일 수도 있고, 합법적인 경보를 침묵시켜 악의적인 활동을 숨기며 실제 사건에 대한 적시적인 대응을 방해할 수도 있습니다.

또한 **`cloudwatch:PutCompositeAlarm`** 권한을 가지고 있는 공격자는 합성 경보의 루프 또는 순환을 만들 수 있습니다. 여기서 합성 경보 A는 합성 경보 B에 의존하고, 합성 경보 B도 합성 경보 A에 의존하는 합성 경보의 순환이 만들어집니다. 이러한 시나리오에서는 순환의 일부인 어떤 합성 경보도 삭제할 수 없습니다. 왜냐하면 삭제하려는 경보에 의존하는 합성 경보가 여전히 존재하기 때문입니다.
```bash
aws cloudwatch put-metric-alarm --cli-input-json <value> | --alarm-name <value> --comparison-operator <value> --evaluation-periods <value> [--datapoints-to-alarm <value>] [--threshold <value>] [--alarm-description <value>] [--alarm-actions <value>] [--metric-name <value>] [--namespace <value>] [--statistic <value>] [--dimensions <value>] [--period <value>]
aws cloudwatch delete-alarms --alarm-names <value>
aws cloudwatch put-composite-alarm --alarm-name <value> --alarm-rule <value> [--no-actions-enabled | --actions-enabled [--alarm-actions <value>] [--insufficient-data-actions <value>] [--ok-actions <value>] ]
```
다음 예제는 메트릭 알람을 효과 없게 만드는 방법을 보여줍니다:

- 이 메트릭 알람은 특정 EC2 인스턴스의 평균 CPU 사용률을 모니터링하며, 매 300초마다 메트릭을 평가하고 6개의 평가 기간(총 30분)이 필요합니다. 평균 CPU 사용률이 이 기간 중 최소 4개의 기간에 걸쳐 60%를 초과하면 알람이 트리거되어 지정된 SNS 주제로 알림이 전송됩니다.
- 임계값을 99% 이상으로 수정하고, 기간을 10초로 설정하며, 평가 기간을 8640으로 설정합니다(10초의 8640 기간은 1일과 동일). 또한 데이터포인트를 8640으로 설정하면 CPU 사용률이 24시간 동안 매 10초마다 99%를 초과해야 알람이 트리거되도록 설정됩니다.

{% tabs %}
{% tab title="원본 메트릭 알람" %}
```json
{
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-01234567890123456"
}
],
"AlarmActions": [
"arn:aws:sns:us-east-1:123456789012:example_sns"
],
"ComparisonOperator": "GreaterThanThreshold",
"DatapointsToAlarm": 4,
"EvaluationPeriods": 6,
"Period": 300,
"Statistic": "Average",
"Threshold": 60,
"AlarmDescription": "CPU Utilization of i-01234567890123456 over 60%",
"AlarmName": "EC2 instance i-01234567890123456 CPU Utilization"
}
```
{% endtab %}
{% tab title="수정된 메트릭 알람" %}
```json
{
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-0645d6d414dadf9f8"
}
],
"AlarmActions": [],
"ComparisonOperator": "GreaterThanThreshold",
"DatapointsToAlarm": 8640,
"EvaluationPeriods": 8640,
"Period": 10,
"Statistic": "Average",
"Threshold": 99,
"AlarmDescription": "CPU Utilization of i-01234567890123456 with 60% as threshold",
"AlarmName": "Instance i-0645d6d414dadf9f8 CPU Utilization"
}

```
{% endtab %}
{% endtabs %}
**잠재적 영향**: 중요한 이벤트에 대한 알림 부재, 잠재적으로 감지되지 않는 문제, 잘못된 경보 제거, 진짜 사건의 감지 놓침 가능성.

### **`cloudwatch:DeleteAlarmActions`, `cloudwatch:EnableAlarmActions` , `cloudwatch:SetAlarmState`**

경보 작업을 삭제함으로써 공격자는 경보 상태에 도달했을 때 관리자에게 통지하거나 자동 스케일링 활동을 트리거하는 중요한 경보 및 자동 응답을 방지할 수 있습니다. 부적절하게 경보 작업을 활성화하거나 다시 활성화하면 이전에 비활성화된 작업을 다시 활성화하거나 트리거되는 작업을 수정하여 혼란과 오인을 유발할 수 있습니다.

또한 권한이 있는 공격자는 경보 상태를 조작하여 관리자를 혼란스럽게 만들거나 악의적인 활동이나 중요한 시스템 장애를 숨기기 위해 가짜 경보를 만들거나 진짜 경보를 침묵시킬 수 있습니다.

- 복합 경보에 **`SetAlarmState`**를 사용하는 경우, 복합 경보가 실제 상태로 돌아가지 않을 수 있습니다. 복합 경보는 자식 경보 중 하나라도 상태가 변경될 때만 실제 상태로 돌아갑니다. 또한 구성을 업데이트하면 다시 평가됩니다.
```bash
aws cloudwatch disable-alarm-actions --alarm-names <value>
aws cloudwatch enable-alarm-actions --alarm-names <value>
aws cloudwatch set-alarm-state --alarm-name <value> --state-value <OK | ALARM | INSUFFICIENT_DATA> --state-reason <value> [--state-reason-data <value>]
```
**잠재적 영향**: 중요 이벤트에 대한 알림 부재, 잠재적으로 감지되지 않는 문제, 가짜 경보 억제 및 실제 사건의 놓친 감지 가능성.

### **`cloudwatch:DeleteAnomalyDetector`, `cloudwatch:PutAnomalyDetector`**

공격자는 메트릭 데이터의 이상한 패턴이나 이상 현상에 대한 감지와 대응 능력을 compromise할 수 있습니다. 기존의 이상 탐지기를 삭제함으로써 공격자는 중요한 경보 메커니즘을 비활성화시킬 수 있으며, 생성하거나 수정함으로써 잘못 구성하거나 가짜 양성 결과를 만들어 모니터링을 방해하거나 압도할 수 있습니다.
```bash
aws cloudwatch delete-anomaly-detector [--cli-input-json <value> | --namespace <value> --metric-name <value> --dimensions <value> --stat <value>]
aws cloudwatch put-anomaly-detector [--cli-input-json <value> | --namespace <value> --metric-name <value> --dimensions <value> --stat <value> --configuration <value> --metric-characteristics <value>]
```
다음 예제는 메트릭 이상 탐지기를 효과 없게 만드는 방법을 보여줍니다. 이 메트릭 이상 탐지기는 특정 EC2 인스턴스의 평균 CPU 사용률을 모니터링하며, 원하는 시간 범위를 가진 "ExcludedTimeRanges" 매개변수를 추가함으로써 해당 기간 동안 해당 데이터를 분석하거나 경고하지 않도록 충분합니다.

{% tabs %}
{% tab title="원본 메트릭 이상 탐지기" %}
```json
{
"SingleMetricAnomalyDetector": {
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Stat": "Average",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-0123456789abcdefg"
}
]
}
}
```
{% endtab %}
{% tab title="수정된 메트릭 이상 탐지기" %}
```json
{
"SingleMetricAnomalyDetector": {
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Stat": "Average",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-0123456789abcdefg"
}
]
},
"Configuration": {
"ExcludedTimeRanges": [
{
"StartTime": "2023-01-01T00:00:00Z",
"EndTime": "2053-01-01T23:59:59Z"
}
],
"Timezone": "Europe/Madrid"
}
}
```
{% endtab %}
{% endtabs %}
**잠재적 영향**: 이상한 패턴이나 보안 위협을 감지하는 데 직접적인 영향을 미칠 수 있습니다.

### **`cloudwatch:DeleteDashboards`, `cloudwatch:PutDashboard`**

공격자는 대시보드를 생성, 수정 또는 삭제함으로써 조직의 모니터링 및 시각화 기능을 compromise할 수 있습니다. 이 권한은 시스템의 성능 및 상태에 대한 중요한 가시성을 제거하거나, 대시보드를 잘못된 데이터로 표시하거나 악의적인 활동을 숨기는 데 활용될 수 있습니다.
```bash
aws cloudwatch delete-dashboards --dashboard-names <value>
aws cloudwatch put-dashboard --dashboard-name <value> --dashboard-body <value>
```
**잠재적 영향**: 모니터링 가시성 손실 및 오도된 정보.

### **`cloudwatch:DeleteInsightRules`, `cloudwatch:PutInsightRule` ,`cloudwatch:PutManagedInsightRule`**

인사이트 규칙은 이상을 감지하고 성능을 최적화하며 리소스를 효과적으로 관리하는 데 사용됩니다. 기존 인사이트 규칙을 삭제함으로써 공격자는 중요한 모니터링 기능을 제거할 수 있어 성능 문제와 보안 위협에 대한 시스템이 소경해질 수 있습니다. 또한 공격자는 인사이트 규칙을 생성하거나 수정하여 오도된 데이터를 생성하거나 악의적인 활동을 숨길 수 있어 잘못된 진단과 운영팀으로부터 부적절한 응답을 유발할 수 있습니다.
```bash
aws cloudwatch delete-insight-rules --rule-names <value>
aws cloudwatch put-insight-rule --rule-name <value> --rule-definition <value> [--rule-state <value>]
aws cloudwatch put-managed-insight-rules --managed-rules <value>
```
**잠재적 영향**: 성능 문제 및 이상 현상을 감지하고 대응하는 것이 어려워지며, 잘못된 의사 결정이 이루어지고 악의적인 활동이나 시스템 장애가 숨겨질 수 있습니다.

### **`cloudwatch:DisableInsightRules`, `cloudwatch:EnableInsightRules`**

핵심 인사이트 규칙을 비활성화함으로써 공격자는 조직이 중요한 성능 및 보안 지표를 파악하지 못하게 할 수 있습니다. 반대로, 오도하는 규칙을 활성화하거나 구성함으로써, 거짓 데이터를 생성하거나 악의적인 활동을 숨기는 데 사용할 수도 있습니다.
```bash
aws cloudwatch disable-insight-rules --rule-names <value>
aws cloudwatch enable-insight-rules --rule-names <value>
```
**잠재적 영향**: 운영 팀 간의 혼란으로 실제 문제에 대한 지연된 응답 및 잘못된 경보에 기반한 불필요한 조치 발생 가능.

### **`cloudwatch:DeleteMetricStream`, `cloudwatch:PutMetricStream`, `cloudwatch:PutMetricData`**

**`cloudwatch:DeleteMetricStream`**, **`cloudwatch:PutMetricStream`** 권한을 가진 공격자는 메트릭 데이터 스트림을 생성하고 삭제하여 보안, 모니터링 및 데이터 무결성을 침해할 수 있습니다:

- **악의적인 스트림 생성**: 민감한 데이터를 무단으로 전송하기 위해 메트릭 스트림을 생성합니다.
- **리소스 조작**: 과도한 데이터로 새로운 메트릭 스트림을 생성하면 많은 노이즈가 발생하여 잘못된 경보를 유발하고 실제 문제를 가리게 할 수 있습니다.
- **모니터링 방해**: 메트릭 스트림을 삭제함으로써 공격자는 모니터링 데이터의 연속적인 흐름을 방해할 수 있습니다. 이렇게 하면 악의적인 활동이 효과적으로 숨겨집니다.

**`cloudwatch:PutMetricData`** 권한을 가진 경우 메트릭 스트림에 데이터를 추가할 수 있습니다. 이는 부적절한 데이터 양으로 인해 DoS를 유발할 수 있어 완전히 쓸모 없게 만들 수 있습니다.
```bash
aws cloudwatch delete-metric-stream --name <value>
aws cloudwatch put-metric-stream --name <value> [--include-filters <value>] [--exclude-filters <value>] --firehose-arn <value> --role-arn <value> --output-format <value>
aws cloudwatch put-metric-data --namespace <value> [--metric-data <value>] [--metric-name <value>] [--timestamp <value>] [--unit <value>] [--value <value>] [--dimensions <value>]
```
다음은 특정 EC2 인스턴스에서 CPU 사용률의 70%에 해당하는 데이터를 추가하는 예시입니다:
```bash
aws cloudwatch put-metric-data --namespace "AWS/EC2" --metric-name "CPUUtilization" --value 70 --unit "Percent" --dimensions "InstanceId=i-0123456789abcdefg"
```
**잠재적 영향**: 모니터링 데이터의 흐름 방해로 이상 징후 및 사건 감지에 영향을 미치며, 자원 조작 및 비용이 증가하여 과도한 메트릭 스트림 생성으로 인한 영향을 받을 수 있습니다.

### **`cloudwatch:StopMetricStreams`, `cloudwatch:StartMetricStreams`**

공격자는 영향을 받는 메트릭 데이터 스트림의 흐름을 제어할 수 있습니다(자원 제한이 없는 경우 모든 데이터 스트림). **`cloudwatch:StopMetricStreams`** 권한을 가지고 있는 공격자는 중요한 메트릭 스트림을 중지함으로써 악의적인 활동을 숨길 수 있습니다.
```bash
aws cloudwatch stop-metric-streams --names <value>
aws cloudwatch start-metric-streams --names <value>
```
**잠재적 영향**: 모니터링 데이터의 흐름 방해로 이상 및 사건 감지에 영향을 줄 수 있습니다.

### **`cloudwatch:TagResource`, `cloudwatch:UntagResource`**

공격자는 CloudWatch 리소스(현재는 알람 및 Contributor Insights 규칙에만 해당)에서 태그를 추가, 수정 또는 제거할 수 있습니다. 이로 인해 태그에 기반한 조직의 액세스 제어 정책이 방해될 수 있습니다.
```bash
aws cloudwatch tag-resource --resource-arn <value> --tags <value>
aws cloudwatch untag-resource --resource-arn <value> --tag-keys <value>
```
**잠재적 영향**: 태그 기반 액세스 제어 정책의 중단.

## 참고 자료

* [https://cloudsecdocs.com/aws/services/logging/cloudwatch/](https://cloudsecdocs.com/aws/services/logging/cloudwatch/#general-info)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoncloudwatch.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoncloudwatch.html)
* [https://docs.aws.amazon.com/es_es/AmazonCloudWatch/latest/monitoring/cloudwatch_concepts.html#Metric](https://docs.aws.amazon.com/es_es/AmazonCloudWatch/latest/monitoring/cloudwatch_concepts.html#Metric)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 제로부터 영웅까지 AWS 해킹을 배우세요!</summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구매하세요
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* **💬 [**디스코드 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 가입하거나**트위터** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 팔로우하세요**.
* **HackTricks** 및 **HackTricks Cloud** 깃허브 저장소에 PR을 제출하여 해킹 트릭을 공유하세요.

</details>
