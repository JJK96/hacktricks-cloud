# AWS - CloudWatch Enum

{% hint style="success" %}
Jifunze & zoezi Udukuzi wa AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Mafunzo ya HackTricks ya Mtaalam wa Timu Nyekundu ya AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze & zoezi Udukuzi wa GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Mafunzo ya HackTricks ya Mtaalam wa Timu Nyekundu ya GCP (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>unga mkono HackTricks</summary>

* Angalia [**mpango wa michango**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## CloudWatch

**CloudWatch** **inakusanya** ufuatiliaji na **data** za uendeshaji kwa mfumo wa logs/metrics/events zinazotoa **mtazamo uliojumuishwa wa rasilimali za AWS**, programu na huduma.\
Tukio la Log la CloudWatch lina **kikomo cha ukubwa wa 256KB kwa kila mstari wa log**.\
Inaweza kuweka **vifaa vya tahadhari vya azimio kubwa**, kuonyesha **logs** na **metrics** kando kando, kuchukua hatua za moja kwa moja, kutatua matatizo, na kugundua ufahamu wa kuboresha programu.

Unaweza kufuatilia kwa mfano logs kutoka CloudTrail. Matukio yanayofuatiliwa ni:

* Mabadiliko kwenye Vikundi vya Usalama na NACLs
* Kuanza, Kusimamisha, kuanzisha upya na kufuta mifano ya EC2
* Mabadiliko kwenye Sera za Usalama ndani ya IAM na S3
* Jaribio lililoshindwa la kuingia kwenye Konsoli ya Usimamizi ya AWS
* Wito wa API uliosababisha idhini iliyoshindwa
* Vichujio vya kutafuta katika cloudwatch: [https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html](https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html)

## Dhana muhimu

### Majina ya Nafasi

Nafasi ni chombo cha kuhifadhi takwimu za CloudWatch. Inasaidia kugawa na kuisolate metrics, kufanya iwe rahisi kuzisimamia na kuzianaliza.

- **Mifano**: AWS/EC2 kwa metrics zinazohusiana na EC2, AWS/RDS kwa metrics za RDS.

### Metrics

Metrics ni pointi za data zilizokusanywa kwa muda ambazo zinaonyesha utendaji au matumizi ya rasilimali za AWS. Metrics zinaweza kukusanywa kutoka kwa huduma za AWS, programu za desturi, au ushirikiano wa watu wa tatu.

- **Mfano**: CPUUtilization, NetworkIn, DiskReadOps.

### Vipimo

Vipimo ni jozi za ufunguo-na-thamani ambazo ni sehemu ya metrics. Husaidia kutambua kipekee metric na kutoa muktadha wa ziada, ikiwa 30 ni idadi kubwa ya vipimo vinavyoweza kuambatishwa na metric. Vipimo pia huruhusu kuchuja na kuhesabu metrics kulingana na sifa maalum.

- **Mfano**: Kwa mifano ya EC2, vipimo vinaweza kujumuisha InstanceId, InstanceType, na AvailabilityZone.

### Takwimu

Takwimu ni hesabu za kihisabati zilizofanywa kwenye data ya metric ili kuisawazisha kwa muda. Takwimu za kawaida ni pamoja na Wastani, Jumla, Chini, Juu, na Idadi ya Sampuli.

- **Mfano**: Kuhesabu wastani wa matumizi ya CPU kwa kipindi cha saa moja.

### Vitengo

Vitengo ni aina ya kipimo inayohusishwa na metric. Vitengo husaidia kutoa muktadha na maana kwa data ya metric. Vitengo vya kawaida ni pamoja na Asilimia, Bayti, Sekunde, Idadi.

- **Mfano**: CPUUtilization inaweza kupimwa kwa Asilimia, wakati NetworkIn inaweza kupimwa kwa Bayti.

## Vipengele vya CloudWatch

### Dashibodi

**Dashibodi za CloudWatch** hutoa **mtazamo unaoweza kubadilishwa wa metrics zako za AWS CloudWatch**. Inawezekana kuunda na kusanidi dashibodi kuona data na kufuatilia rasilimali katika mtazamo mmoja, kuchanganya metrics tofauti kutoka kwa huduma mbalimbali za AWS.

**Vipengele muhimu**:

- **Vidude**: Vipande vya kujenga dashibodi, ikiwa ni pamoja na grafu, maandishi, tahadhari, na zaidi.
- **Ubinafsishaji**: Mpangilio na maudhui yanaweza kubinafsishwa ili kufaa mahitaji maalum ya ufuatiliaji.

**Mfano wa Matumizi**:

- Dashibodi moja inayoonyesha metrics muhimu kwa mazingira yako yote ya AWS, ikiwa ni pamoja na mifano ya EC2, databases za RDS, na vikasha vya S3.

### Mtiririko wa Metric na Data ya Metric

**Mtiririko wa Metric** katika AWS CloudWatch inaruhusu kuendelea kusambaza metrics za CloudWatch kwenye marudio unayopenda kwa karibu wakati halisi. Hii ni muhimu hasa kwa ufuatiliaji wa juu, uchambuzi, na dashibodi za desturi kwa kutumia zana nje ya AWS.

**Data ya Metric** ndani ya Mtiririko wa Metric inahusu vipimo halisi au pointi za data zinazosambazwa. Pointi hizi za data zinaonyesha metrics mbalimbali kama matumizi ya CPU, matumizi ya kumbukumbu, n.k., kwa rasilimali za AWS.

**Mfano wa Matumizi**:

- Kutuma metrics za wakati halisi kwa huduma ya ufuatiliaji ya watu wa tatu kwa uchambuzi wa juu.
- Kuhifadhi metrics kwenye kisanduku cha Amazon S3 kwa uhifadhi wa muda mrefu na kufuata sheria.

### Tahadhari

**Tahadhari za CloudWatch** zinafuatilia metrics yako na kutekeleza hatua kulingana na vizingiti vilivyowekwa mapema. Wakati metric inavunja kizingiti, tahadhari inaweza kutekeleza hatua moja au zaidi kama vile kutuma arifa kupitia SNS, kuzindua sera ya kubadilika kiotomatiki, au kukimbia kazi ya Lambda ya AWS.

**Vipengele muhimu**:

- **Kizingiti**: Thamani ambayo tahadhari inaanzisha.
- **Vipindi vya Tathmini**: Idadi ya vipindi ambavyo data inachunguzwa.
- **Data Points kwa Tahadhari**: Idadi ya vipindi na kizingiti kilichofikiwa kinachohitajika kuanzisha tahadhari
- **Hatua**: Kinachotokea wakati hali ya tahadhari inaanzishwa (k.m., arifa kupitia SNS).

**Mfano wa Matumizi**:

- Kufuatilia matumizi ya CPU ya mifano ya EC2 na kutuma arifa kupitia SNS ikiwa inazidi 80% kwa dakika 5 mfululizo.

### Wachunguzi wa Kipimo cha Kipekee

**Wachunguzi wa Kipimo cha Kipekee** hutumia ujifunzaji wa mashine kugundua moja kwa moja tofauti katika metrics zako. Unaweza kutumia uchunguzi wa tofauti kwa metric yoyote ya CloudWatch kutambua mabadiliko kutoka kwa mifumo ya kawaida ambayo inaweza kuashiria masuala.

**Vipengele muhimu**:

- **Mafunzo ya Mfano**: CloudWatch hutumia data ya kihistoria kufundisha mfano na kuanzisha jinsi tabia ya kawaida inavyoonekana.
- **Mstari wa Uchunguzi wa Tofauti**: Uwakilishi wa maadili yanayotarajiwa kwa metric.

**Mfano wa Matumizi**:

- Kugundua mifumo isiyo ya kawaida ya matumizi ya CPU kwenye mifano ya EC2 ambayo inaweza kuashiria uvunjaji wa usalama au suala la programu.

### Miongozo ya Ufahamu na Miongozo ya Ufahamu Iliyosimamiwa

**Miongozo ya Ufahamu** inakuruhusu kutambua mwelekeo, kugundua vikwazo, au mifano mingine ya maslahi katika data yako ya metric kwa kutumia **mielekeo yenye nguvu ya hisabati** kufafanua hali ambazo hatua zinapaswa kuchukuliwa. Miongozo hii inaweza kukusaidia kutambua tofauti au tabia za kawaida katika utendaji na matumizi ya rasilimali yako.

**Miongozo ya Ufahamu Iliyosimamiwa** ni **miongozo ya ufahamu iliyopangwa mapema inayotolewa na AWS**. Imepangwa kufuatilia huduma maalum za AWS au matumizi ya kawaida na inaweza kuwezeshwa bila kuhitaji usanidi wa kina.

**Mfano wa Matumizi**:

- Kufuatilia Utendaji wa RDS: Wezesha miongozo ya ufahamu iliyosimamiwa kwa Amazon RDS inayofuatilia viashiria muhimu vya utendaji kama matumizi ya CPU, matumizi ya kumbukumbu, na disk I/O. Ikiwa mojawapo ya metrics hizi inazidi vizingiti salama vya uendeshaji, miongozo inaweza kuzindua tahadhari au hatua ya kiotomatiki.

### CloudWatch Logs <a href="#cloudwatch-logs" id="cloudwatch-logs"></a>

Inaruhusu **kukusanya na kufuatilia logs kutoka kwa programu** na mifumo kutoka **huduma za AWS** (ikiwa ni pamoja na CloudTrail) na **kutoka kwa programu/mifumo** (**CloudWatch Agent** inaweza kusakinishwa kwenye mwenyeji). Logs zinaweza **kuhifadhiwa kwa muda usiojulikana** (kulingana na mipangilio ya Kikundi cha Logi) na zinaweza kusafirishwa.

**Vipengele**:

| **Kikundi cha Logi**      | **Mkusanyiko wa mtiririko wa logs** ambao unashiriki mipangilio sawa ya uhifadhi, ufuatiliaji, na udhibiti wa ufikiaji                                                     |
| ------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Mtiririko wa Logi**     | Mfululizo wa **matukio ya log** ambayo yanashiriki **chanzo sawa**                                                                                                |
| **Vichujio vya Usajili** | Hufafanua **muundo wa kichujio unaolingana na matukio** katika kikundi cha logi fulani, kisha vitume kwenye mtiririko wa Kinesis Data Firehose, mtiririko wa Kinesis, au kazi ya Lambda |
### Ufuatiliaji na Matukio ya CloudWatch

CloudWatch **msingi** hukusanya data **kila baada ya dakika 5** (ile ya **maelezo zaidi** hufanya hivyo **kila baada ya dakika 1**). Baada ya kukusanya data, inachunguza **vigezo vya vifaa vya tahadhari** kwa kesi inahitaji kuzindua moja.\
Katika kesi hiyo, CloudWatch inaweza kuwa tayari kutuma tukio na kutekeleza baadhi ya hatua za moja kwa moja (kazi za AWS lambda, mada za SNS, foleni za SQS, mito ya Kinesis)

### Usanidi wa Wakala

Unaweza kusakinisha mawakala ndani ya mashine/kontena zako ili kutuma kiotomatiki nyuma kwa CloudWatch.

* **Tengeneza** jukumu na **ambatisha** kwa **kifaa** na ruhusa inayoruhusu CloudWatch kukusanya data kutoka kwa vifaa pamoja na kuingiliana na meneja wa mifumo ya AWS SSM (CloudWatchAgentAdminPolicy & AmazonEC2RoleforSSM)
* **Pakua** na **sakinisha** wakala kwenye kifaa cha EC2 ([https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip](https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip)). Unaweza kupakua kutoka ndani ya EC2 au kusakinisha kiotomatiki kutumia Meneja wa Mifumo ya AWS kwa kuchagua pakiti AWS-ConfigureAWSPackage
* **Sanidi** na **anzisha** Wakala wa CloudWatch

Kikundi cha logi kina mito mingi. Mto una matukio mengi. Na ndani ya kila mto, matukio yamehakikishiwa kuwa kwa mpangilio.
```bash
# Dashboards #

## Returns a list of the dashboards of your account
aws cloudwatch list-dashboards

## Retrieves the details of the specified dashboard
aws cloudwatch get-dashboard --dashboard-name <value>

# Metrics #

## Returns a list of the specified metric
aws cloudwatch list-metrics [--namespace <value>] [--metric-name <value>] [--dimensions <value>] [--include-linked-accounts | --no-include-linked-accounts]

## Retrieves metric data (this operation can include a CloudWatch Metrics Insights query, and one or more metric math functions)
aws cloudwatch get-metric-data --metric-data-queries <value> --start-time <value> --end-time <value>

## Retrieves statistics for the specified metric and namespace over a range of time
aws cloudwatch get-metric-statistics --namespace <value> --metric-name <value> [--dimensions <value>] --start-time <value> --end-time <value> --period <value>

## Returns a list of the metric streams of your account
aws cloudwatch list-metric-streams

## Retrieves information about the specified metric stream
aws cloudwatch get-metric-stream --name <value>

## Retrieve snapshots of the specified metric widgets
aws cloudwatch get-metric-widget-image --metric-widget <value>

# Alarms #

## Retrieves the specified alarm
aws cloudwatch describe-alarms [--alarm-names <value>] [--alarm-name-prefix <value>] [--alarm-types <value>] [--state-value <value>]

## Retrieves the alarms history, even for deleted alarms
aws cloudwatch describe-alarm-history [--alarm-name <value>] [--alarm-types <value>] [--history-item-type <ConfigurationUpdate | StateUpdate | Action>] [--start-date <value>] [--end-date <value>]

## Retrieves standard alarms based on the specified metric
aws cloudwatch escribe-alarms-for-metric --metric-name <value> --namespace <value> [--dimensions <value>]

# Anomaly Detections #

## Lists the anomaly detection models that you have created in your account
aws cloudwatch describe-anomaly-detectors [--namespace <value>] [--metric-name <value>] [--dimensions <value>]

## Lists all the Contributor Insight rules in your account
aws cloudwatch describe-insight-rules

## Retrieves the data collected over a time range for a given Contributor Insight rule
aws cloudwatch get-insight-rule-report --rule-name <value> --start-time <value> --end-time <value> --period <value>

## Lists managed Contributor Insights rules in your account for a specified resource
aws cloudwatch list-managed-insight-rules --resource-arn <value>

# Tags #

## Lists the tags associated with the specified CloudWatch resources
aws cloudwatch list-tags-for-resource --resource-arn <value>

# CloudWatch Logs #
aws logs tail "<log_group_name>" --followaws logs get-log-events --log-group-name "<log_group_name>" --log-stream-name "<log_stream_name>" --output text > <output_file>

# CloudWatch Events #
aws events list-rules
aws events describe-rule --name <name>aws events list-targets-by-rule --rule <name>aws events list-archives
aws events describe-archive --archive-name <name>aws events list-connections
aws events describe-connection --name <name>aws events list-endpoints
aws events describe-endpoint --name <name>aws events list-event-sources
aws events describe-event-source --name <name>aws events list-replays
aws events list-api-destinations
aws events list-event-buses
```
## Baada ya Uvamizi / Kupita

### **`cloudwatch:DeleteAlarms`,`cloudwatch:PutMetricAlarm` ,¬†`cloudwatch:PutCompositeAlarm`**

Mshambuliaji mwenye ruhusa hizi anaweza kudhoofisha sana miundombinu ya ufuatiliaji na onyo ya shirika. Kwa kufuta tahadhari zilizopo, mshambuliaji anaweza kulemaza tahadhari muhimu zinazowajulisha waendeshaji wa masuala muhimu ya utendaji, uvunjaji wa usalama, au kushindwa kwa uendeshaji. Zaidi ya hayo, kwa kuunda au kurekebisha tahadhari za metriki, mshambuliaji pia anaweza kuwapotosha waendeshaji kwa tahadhari za uwongo au kuzima tahadhari halali, hivyo kuficha shughuli za uovu na kuzuia majibu ya wakati kwa matukio halisi.

Kwa kuongezea, kwa ruhusa ya **`cloudwatch:PutCompositeAlarm`**, mshambuliaji angekuwa na uwezo wa kuunda mzunguko au mzunguko wa tahadhari za mchanganyiko, ambapo tahadhari ya mchanganyiko A inategemea tahadhari ya mchanganyiko B, na tahadhari ya mchanganyiko B pia inategemea tahadhari ya mchanganyiko A. Katika hali hii, haiwezekani kufuta tahadhari yoyote ya mchanganyiko ambayo ni sehemu ya mzunguko kwa sababu daima bado kuna tahadhari ya mchanganyiko inayotegemea tahadhari hiyo unayotaka kufuta.
```bash
aws cloudwatch put-metric-alarm --cli-input-json <value> | --alarm-name <value> --comparison-operator <value> --evaluation-periods <value> [--datapoints-to-alarm <value>] [--threshold <value>] [--alarm-description <value>] [--alarm-actions <value>] [--metric-name <value>] [--namespace <value>] [--statistic <value>] [--dimensions <value>] [--period <value>]
aws cloudwatch delete-alarms --alarm-names <value>
aws cloudwatch put-composite-alarm --alarm-name <value> --alarm-rule <value> [--no-actions-enabled | --actions-enabled [--alarm-actions <value>] [--insufficient-data-actions <value>] [--ok-actions <value>] ]
```
```swahili
Mfano ufuatao unaonyesha jinsi ya kufanya kengele ya metriki isiwe na ufanisi:

- Kengele hii ya metriki inachunguza matumizi ya wastani ya CPU ya kifaa maalum cha EC2, inahakiki metriki kila sekunde 300 na inahitaji vipindi vya tathmini 6 (jumla ya dakika 30). Ikiwa matumizi ya wastani ya CPU yanazidi 60% kwa angalau vipindi 4 kati ya hivi, kengele itaanzishwa na kutuma arifa kwenye mada ya SNS iliyotajwa.
- Kwa kubadilisha Kizingiti kiwe zaidi ya 99%, kuweka Kipindi kuwa sekunde 10, Vipindi vya Tathmini kuwa 8640 (kwa kuwa vipindi 8640 vya sekunde 10 ni sawa na siku 1), na Pointi za Data kwa Kengele kuwa 8640 pia, itakuwa muhimu matumizi ya CPU yawe zaidi ya 99% kila sekunde 10 kwa kipindi chote cha masaa 24 ili kuanzisha kengele.
```
```json
{
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-01234567890123456"
}
],
"AlarmActions": [
"arn:aws:sns:us-east-1:123456789012:example_sns"
],
"ComparisonOperator": "GreaterThanThreshold",
"DatapointsToAlarm": 4,
"EvaluationPeriods": 6,
"Period": 300,
"Statistic": "Average",
"Threshold": 60,
"AlarmDescription": "CPU Utilization of i-01234567890123456 over 60%",
"AlarmName": "EC2 instance i-01234567890123456 CPU Utilization"
}
```
{% endtab %}
{% tab title="Kengele ya Kipimo iliyobadilishwa" %}
```json
{
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-0645d6d414dadf9f8"
}
],
"AlarmActions": [],
"ComparisonOperator": "GreaterThanThreshold",
"DatapointsToAlarm": 8640,
"EvaluationPeriods": 8640,
"Period": 10,
"Statistic": "Average",
"Threshold": 99,
"AlarmDescription": "CPU Utilization of i-01234567890123456 with 60% as threshold",
"AlarmName": "Instance i-0645d6d414dadf9f8 CPU Utilization"
}

```
{% endtab %}
{% endtabs %}
**Athari Inayowezekana**: Kutokuwepo kwa arifa kwa matukio muhimu, masuala yanayoweza kutopatikana, arifa za uwongo, kuzuia arifa halisi na uwezekano wa kutopata uchunguzi wa matukio halisi.

### **`cloudwatch:DeleteAlarmActions`,¬†`cloudwatch:EnableAlarmActions` , `cloudwatch:SetAlarmState`**

Kwa kufuta hatua za onyo, mkaidi anaweza kuzuia arifa muhimu na majibu ya moja kwa moja kutotolewa wakati hali ya onyo inafikiwa, kama vile kuwajulisha waendeshaji au kuzindua shughuli za kujipanua kiotomatiki. Kuwezesha au kuwezesha tena hatua za onyo kwa njia isiyo sahihi inaweza pia kusababisha tabia zisizotarajiwa, ama kwa kuwasha upya hatua zilizozimwa awali au kwa kubadilisha ni hatua zipi zinazosababishwa, hivyo kusababisha mkanganyiko na upotoshaji katika majibu ya tukio.

Zaidi ya hayo, mkaidi mwenye idhini anaweza kubadilisha hali za onyo, hivyo kuweza kuunda arifa za uwongo ili kudanganya na kuchanganya waendeshaji, au kuzima arifa halisi ili kuficha shughuli za uovu zinazoendelea au kushindwa kwa mfumo muhimu.

- Ikiwa unatumia **`SetAlarmState`** kwenye onyo la mchanganyiko, onyo la mchanganyiko halihakikishi kurudi kwenye hali yake halisi. Linarudi kwenye hali yake halisi mara tu onyo lolote la watoto wake linapobadilisha hali. Pia linachunguzwa upya ikiwa unaboresha mazingira yake.
```bash
aws cloudwatch disable-alarm-actions --alarm-names <value>
aws cloudwatch enable-alarm-actions --alarm-names <value>
aws cloudwatch set-alarm-state --alarm-name <value> --state-value <OK | ALARM | INSUFFICIENT_DATA> --state-reason <value> [--state-reason-data <value>]
```
**Athari Inayoweza Kutokea**: Kutokuwepo kwa arifa za matukio muhimu, masuala yanayoweza kutambuliwa, tahadhari za uwongo, kuzuia tahadhari halisi na uwezekano wa kutopata uchunguzi wa matukio halisi.

### **`cloudwatch:DeleteAnomalyDetector`, `cloudwatch:PutAnomalyDetector`**

Mshambuliaji angekuwa na uwezo wa kuhatarisha uwezo wa kutambua na kujibu mifumo isiyo ya kawaida au mizunguko ya kutatanisha katika data ya metric. Kwa kufuta detekta za kutatanisha zilizopo, mshambuliaji anaweza kulemaza mifumo muhimu ya kutuma tahadhari; na kwa kuunda au kuzibadilisha, itakuwa na uwezo wa kuzipangilia vibaya au kuunda matokeo sahihi ya uwongo ili kuleta mkanganyiko au kuzidi ufuatiliaji.
```bash
aws cloudwatch delete-anomaly-detector [--cli-input-json <value> | --namespace <value> --metric-name <value> --dimensions <value> --stat <value>]
aws cloudwatch put-anomaly-detector [--cli-input-json <value> | --namespace <value> --metric-name <value> --dimensions <value> --stat <value> --configuration <value> --metric-characteristics <value>]
```
Mfano ufuatao unaonyesha jinsi ya kufanya kifaa cha kugundua mabadiliko ya metric kuwa batili. Kifaa hiki cha kugundua mabadiliko ya metric huchunguza matumizi ya wastani ya CPU ya kifaa maalum cha EC2, na kwa kuongeza parameter ya "ExcludedTimeRanges" na muda uliotaka, itakuwa ya kutosha kuhakikisha kuwa kifaa cha kugundua mabadiliko hakingeanaliza wala kutoa tahadhari kuhusu data yoyote inayofaa wakati huo.
```json
{
"SingleMetricAnomalyDetector": {
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Stat": "Average",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-0123456789abcdefg"
}
]
}
}
```
{% endtab %}
{% tab title="Kichunguzi cha Anomali ya Metric iliyobadilishwa" %}
```json
{
"SingleMetricAnomalyDetector": {
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Stat": "Average",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-0123456789abcdefg"
}
]
},
"Configuration": {
"ExcludedTimeRanges": [
{
"StartTime": "2023-01-01T00:00:00Z",
"EndTime": "2053-01-01T23:59:59Z"
}
],
"Timezone": "Europe/Madrid"
}
}
```
**Athari Inayowezekana**: Athari moja kwa moja katika ugunduzi wa mifumo isiyo ya kawaida au vitisho vya usalama.

### **`cloudwatch:DeleteDashboards`, `cloudwatch:PutDashboard`**

Mshambuliaji angekuwa na uwezo wa kuhatarisha uwezo wa ufuatiliaji na uchoraji wa uwezo wa shirika kwa kujenga, kurekebisha au kufuta dashibodi zake. Ruhusa hizi zinaweza kutumika kuondoa uwezo muhimu wa kuona utendaji na afya ya mifumo, kubadilisha dashibodi kuonyesha data isiyo sahihi au kuficha shughuli za uovu.
```bash
aws cloudwatch delete-dashboards --dashboard-names <value>
aws cloudwatch put-dashboard --dashboard-name <value> --dashboard-body <value>
```
**Athari Inayoweza Kutokea**: Upotevu wa uwezo wa ufuatiliaji na taarifa za kupotosha.

### **`cloudwatch:DeleteInsightRules`, `cloudwatch:PutInsightRule`, `cloudwatch:PutManagedInsightRule`**

Sheria za ufahamu hutumiwa kugundua tofauti, kuboresha utendaji, na kusimamia rasilimali kwa ufanisi. Kwa kufuta sheria za ufahamu zilizopo, mshambuliaji anaweza kuondoa uwezo muhimu wa ufuatiliaji, kuacha mfumo bila uwezo wa kutambua matatizo ya utendaji na vitisho vya usalama. Aidha, mshambuliaji anaweza kuunda au kurekebisha sheria za ufahamu ili kuzalisha data inayopotosha au kuficha shughuli za uovu, hivyo kusababisha uchambuzi usio sahihi na majibu yasiyofaa kutoka kwa timu za uendeshaji.
```bash
aws cloudwatch delete-insight-rules --rule-names <value>
aws cloudwatch put-insight-rule --rule-name <value> --rule-definition <value> [--rule-state <value>]
aws cloudwatch put-managed-insight-rules --managed-rules <value>
```
**Athari Inayowezekana**: Ugumu wa kugundua na kujibu masuala ya utendaji na tofauti, kufanya maamuzi yasiyo sahihi na kuficha shughuli za uovu au kushindwa kwa mfumo.

### **`cloudwatch:DisableInsightRules`,¬†`cloudwatch:EnableInsightRules`**

Kwa kulemaza sheria muhimu za ufahamu, mshambuliaji anaweza kufanya shirika kuwa kipofu kwa vipimo muhimu vya utendaji na usalama. Kinyume chake, kwa kuwezesha au kusanidi sheria za kupotosha, inaweza kuwa rahisi kuzalisha data bandia, kujenga kelele, au kuficha shughuli za uovu.
```bash
aws cloudwatch disable-insight-rules --rule-names <value>
aws cloudwatch enable-insight-rules --rule-names <value>
```
**Athari Inayowezekana**: Kuchanganyikiwa kwa timu za uendeshaji, ikisababisha majibu yaliyopunguzwa kwa masuala halisi na hatua zisizohitajika kulingana na tahadhari za uwongo.

### **`cloudwatch:DeleteMetricStream` ,¬†`cloudwatch:PutMetricStream` , `cloudwatch:PutMetricData`**

Mshambuliaji mwenye ruhusa za **`cloudwatch:DeleteMetricStream`** ,¬†**`cloudwatch:PutMetricStream`** angekuwa na uwezo wa kuunda na kufuta mito ya data ya metric, kuhatarisha usalama, ufuatiliaji na uadilifu wa data:

- **Kuunda mito ya data yenye nia mbaya**: Kuunda mito ya metric kutuma data nyeti kwenye vituo visivyoruhusiwa.
- **Udanganyifu wa rasilimali**: Kuunda mito mpya ya metric na data nyingi kupita kiasi inaweza kutoa kelele nyingi, kusababisha tahadhari zisizo sahihi, kuficha masuala halisi.
- **Kuvuruga ufuatiliaji**: Kwa kufuta mito ya metric, wadukuzi wangeweza kuvuruga mtiririko wa data ya ufuatiliaji. Kwa njia hii, shughuli zao za nia mbaya zingefichwa kwa ufanisi.

Vivyo hivyo, kwa ruhusa ya **`cloudwatch:PutMetricData`**, ingewezekana kuongeza data kwenye mtiririko wa metric. Hii inaweza kusababisha DoS kutokana na idadi kubwa ya data isiyo sahihi iliyoundwa, ikifanya iwe kabisa isiyo na maana.
```bash
aws cloudwatch delete-metric-stream --name <value>
aws cloudwatch put-metric-stream --name <value> [--include-filters <value>] [--exclude-filters <value>] --firehose-arn <value> --role-arn <value> --output-format <value>
aws cloudwatch put-metric-data --namespace <value> [--metric-data <value>] [--metric-name <value>] [--timestamp <value>] [--unit <value>] [--value <value>] [--dimensions <value>]
```
Mfano wa kuongeza data inayolingana na 70% ya utumiaji wa CPU kwenye kifaa cha EC2 kilichopewa:
```bash
aws cloudwatch put-metric-data --namespace "AWS/EC2" --metric-name "CPUUtilization" --value 70 --unit "Percent" --dimensions "InstanceId=i-0123456789abcdefg"
```
**Athari Inayowezekana**: Kuvuruga mtiririko wa data ya ufuatiliaji, ikileta athari kwa uchunguzi wa tofauti na matukio, upangaji wa rasilimali na ongezeko la gharama kutokana na uundaji wa mito ya metric kupita kiasi.

### **`cloudwatch:StopMetricStreams`,¬†`cloudwatch:StartMetricStreams`**

Mshambuliaji angekuwa na udhibiti wa mtiririko wa data za metric zilizoathiriwa (kila mtiririko wa data ikiwa hakuna kizuizi cha rasilimali). Kwa idhini ya **`cloudwatch:StopMetricStreams`**, wadukuzi wangeweza kuficha shughuli zao za uovu kwa kusimamisha mito muhimu ya metric.
```bash
aws cloudwatch stop-metric-streams --names <value>
aws cloudwatch start-metric-streams --names <value>
```
**Athari Inayoweza Kutokea**: Kuvuruga mtiririko wa data ya ufuatiliaji, ikileta athari kwa uchunguzi wa tofauti na matukio.

### **`cloudwatch:TagResource`,¬†`cloudwatch:UntagResource`**

Mshambuliaji angekuwa na uwezo wa kuongeza, kuhariri, au kuondoa vitambulisho kutoka kwa rasilimali za CloudWatch (kwa sasa ni vifaa vya tahadhari na sheria za Mchango wa Mchango). Hii inaweza kuvuruga sera za kudhibiti upatikanaji wa shirika lako kulingana na vitambulisho.
```bash
aws cloudwatch tag-resource --resource-arn <value> --tags <value>
aws cloudwatch untag-resource --resource-arn <value> --tag-keys <value>
```
**Athari Inayowezekana**: Kuvuruga sera za udhibiti wa ufikiaji kulingana na lebo.

## Marejeo

* [https://cloudsecdocs.com/aws/services/logging/cloudwatch/](https://cloudsecdocs.com/aws/services/logging/cloudwatch/#general-info)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoncloudwatch.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoncloudwatch.html)
* [https://docs.aws.amazon.com/es_es/AmazonCloudWatch/latest/monitoring/cloudwatch_concepts.html#Metric](https://docs.aws.amazon.com/es_es/AmazonCloudWatch/latest/monitoring/cloudwatch_concepts.html#Metric)

{% hint style="success" %}
Jifunze & zoezi Udukuzi wa AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Mafunzo ya HackTricks AWS Timu Nyekundu Mtaalam (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze & zoezi Udukuzi wa GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Mafunzo ya HackTricks GCP Timu Nyekundu Mtaalam (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>unga mkono HackTricks</summary>

* Angalia [**mpango wa usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
