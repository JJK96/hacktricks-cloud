# AWS - Macie Aufz√§hlung

{% hint style="success" %}
Lernen Sie AWS-Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen Sie GCP-Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
{% endhint %}

# Macie

Amazon Macie sticht als Dienst hervor, der entworfen wurde, um **Daten automatisch zu erkennen, zu klassifizieren und zu identifizieren** innerhalb eines AWS-Kontos. Es nutzt **maschinelles Lernen**, um kontinuierlich Daten zu √ºberwachen und zu analysieren, wobei der Schwerpunkt haupts√§chlich auf der Erkennung und Benachrichtigung √ºber ungew√∂hnliche oder verd√§chtige Aktivit√§ten liegt, indem **Cloud-Trail-Ereignisdaten** und Benutzerverhaltensmuster untersucht werden.

Hauptmerkmale von Amazon Macie:

1. **Aktive Daten√ºberpr√ºfung**: Nutzt maschinelles Lernen, um Daten aktiv zu √ºberpr√ºfen, w√§hrend verschiedene Aktionen im AWS-Konto stattfinden.
2. **Anomalieerkennung**: Identifiziert unregelm√§√üige Aktivit√§ten oder Zugriffsmuster und generiert Warnungen, um potenzielle Risiken f√ºr die Datenexposition zu mindern.
3. **Kontinuierliche √úberwachung**: √úberwacht und erkennt automatisch neue Daten in Amazon S3, wobei maschinelles Lernen und k√ºnstliche Intelligenz eingesetzt werden, um sich im Laufe der Zeit an Datenzugriffsmuster anzupassen.
4. **Datenklassifizierung mit NLP**: Nutzt Natural Language Processing (NLP), um verschiedene Datentypen zu klassifizieren und zu interpretieren, Risikobewertungen zuzuweisen, um Ergebnisse zu priorisieren.
5. **Sicherheits√ºberwachung**: Identifiziert sicherheitssensible Daten, einschlie√ülich API-Schl√ºssel, geheimer Schl√ºssel und pers√∂nlicher Informationen, um Datenlecks zu verhindern.

Amazon Macie ist ein **regionaler Dienst** und erfordert die 'AWSMacieServiceCustomerSetupRole' IAM-Rolle und einen aktivierten AWS CloudTrail f√ºr die Funktionalit√§t.

## Warnsystem

Macie kategorisiert Warnungen in vordefinierte Kategorien wie:

- Anonymisierter Zugriff
- Datenkonformit√§t
- Verlust von Anmeldeinformationen
- Privilegieneskalation
- Ransomware
- Verd√§chtiger Zugriff usw.

Diese Warnungen bieten detaillierte Beschreibungen und Ergebnisaufschl√ºsselungen f√ºr eine effektive Reaktion und L√∂sung.

## Dashboard-Funktionen

Das Dashboard kategorisiert Daten in verschiedene Abschnitte, einschlie√ülich:

- S3-Objekte (nach Zeitbereich, ACL, PII)
- Hochrisiko-CloudTrail-Ereignisse/Benutzer
- Aktivit√§tsorte
- CloudTrail-Benutzeridentit√§tstypen und mehr.

## Benutzerkategorisierung

Benutzer werden in Kategorien eingeteilt, basierend auf dem Risikolevel ihrer API-Aufrufe:

- **Platin**: Hochriskante API-Aufrufe, oft mit Administratorrechten.
- **Gold**: Infrastrukturbezogene API-Aufrufe.
- **Silber**: API-Aufrufe mit mittlerem Risiko.
- **Bronze**: API-Aufrufe mit geringem Risiko.

## Identit√§tstypen

Identit√§tstypen umfassen Root, IAM-Benutzer, Angenommene Rolle, F√∂derierter Benutzer, AWS-Konto und AWS-Dienst, die die Quelle der Anfragen anzeigen.

## Datenklassifizierung

Die Datenklassifizierung umfasst:

- Inhaltstyp: Basierend auf erkanntem Inhaltstyp.
- Dateierweiterung: Basierend auf Dateierweiterung.
- Thema: Kategorisiert nach Schl√ºsselw√∂rtern in Dateien.
- Regex: Kategorisiert anhand spezifischer Regex-Muster.

Das h√∂chste Risiko unter diesen Kategorien bestimmt den endg√ºltigen Risikolevel der Datei.

## Forschung und Analyse

Die Forschungsfunktion von Amazon Macie erm√∂glicht benutzerdefinierte Abfragen √ºber alle Macie-Daten f√ºr eine eingehende Analyse. Filter umfassen CloudTrail-Daten, S3-Bucket-Eigenschaften und S3-Objekte. Dar√ºber hinaus unterst√ºtzt es das Einladen anderer Konten zum Teilen von Amazon Macie, um die gemeinsame Datenverwaltung und Sicherheits√ºberwachung zu erleichtern.


## Aufz√§hlung
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### Post-Exploitation

{% hint style="success" %}
Aus der Perspektive eines Angreifers ist dieser Dienst nicht dazu gedacht, den Angreifer zu erkennen, sondern um sensible Informationen in den gespeicherten Dateien zu erkennen. Daher k√∂nnte dieser Dienst einem Angreifer helfen, sensible Informationen in den Buckets zu finden.\
M√∂glicherweise ist ein Angreifer jedoch auch daran interessiert, diesen zu st√∂ren, um zu verhindern, dass das Opfer Warnungen erh√§lt und um diese Informationen leichter zu stehlen.
{% endhint %}

TODO: Pull Requests sind willkommen!

# Referenzen
* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

{% hint style="success" %}
Lerne & √ºbe AWS-Hacking: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP-Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Trete der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **GitHub-Repositories einreichst.**

</details>
{% endhint %}
