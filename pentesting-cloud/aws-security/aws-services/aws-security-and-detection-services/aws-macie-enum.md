# AWS - Macie Enum

{% hint style="success" %}
Leer & oefen AWS Hack:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hack: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Controleer die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** 💬 [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
{% endhint %}

# Macie

Amazon Macie steek uit as 'n diens wat ontwerp is om **data outomaties op te spoor, te klassifiseer, en te identifiseer** binne 'n AWS-rekening. Dit maak gebruik van **masjienleer** om deurlopend data te monitor en analiseer, met 'n primêre fokus op die opsporing en waarskuwing teen ongewone of verdagte aktiwiteite deur **cloud trail event** data en gebruikersgedragspatrone te ondersoek.

Kernkenmerke van Amazon Macie:

1. **Aktiewe Data-oorsig**: Maak gebruik van masjienleer om data aktief te oorsien terwyl verskeie aksies binne die AWS-rekening plaasvind.
2. **Anomalie-opsporing**: Identifiseer onreëlmatige aktiwiteite of toegangspatrone, genereer waarskuwings om potensiële data blootstellingsrisiko's te verminder.
3. **Deurlopende Monitering**: Monitor en spoor outomaties nuwe data in Amazon S3 op, deur masjienleer en kunsmatige intelligensie te gebruik om aan te pas by data-toegangspatrone oor tyd.
4. **Dataklassifikasie met NLP**: Maak gebruik van natuurlike taalverwerking (NLP) om verskillende datatipes te klassifiseer en te interpreteer, en risikoskore toe te ken om bevindinge te prioritiseer.
5. **Sekuriteitsmonitering**: Identifiseer sekuriteitsensitiewe data, insluitend API-sleutels, geheime sleutels, en persoonlike inligting, om te help om datalekke te voorkom.

Amazon Macie is 'n **streeksdiens** en vereis die 'AWSMacieServiceCustomerSetupRole' IAM Rol en 'n geaktiveerde AWS CloudTrail vir funksionaliteit.

## Waarskuwingsisteem

Macie kategoriseer waarskuwings in voorafbepaalde kategorieë soos:

- Geanonimiseerde toegang
- Data-nakoming
- Kredensieverlies
- Bevoegdheidsverhoging
- Ransomware
- Verdagte toegang, ens.

Hierdie waarskuwings bied gedetailleerde beskrywings en resultaatontledings vir effektiewe reaksie en oplossing.

## Dashboardkenmerke

Die dashboard kategoriseer data in verskeie afdelings, insluitend:

- S3-voorwerpe (volgens tydreeks, ACL, PII)
- Hoërisiko CloudTrail-gebeure/gebruikers
- Aktiwiteitslokasies
- CloudTrail-gebruikeridentiteitstipes, en meer.

## Gebruikerskategorisering

Gebruikers word geklassifiseer in grade gebaseer op die risikovlak van hul API-oproepe:

- **Platina**: Hoërisiko API-oproepe, dikwels met administratiewe voorregte.
- **Goud**: Infrastruktuurverwante API-oproepe.
- **Silwer**: Medium-risiko API-oproepe.
- **Bronse**: Lae-risiko API-oproepe.

## Identiteitstipes

Identiteitstipes sluit in Root, IAM-gebruiker, Aangeneemde Rol, Gefedereerde Gebruiker, AWS-rekening, en AWS-diens, wat die bron van versoeke aandui.

## Dataklassifikasie

Dataklassifikasie behels:

- Inhoudstipe: Gebaseer op opgespoorde inhoudstipe.
- Lêeruitbreiding: Gebaseer op lêeruitbreiding.
- Tema: Gekategoriseer deur sleutelwoorde binne lêers.
- Regex: Gekategoriseer op grond van spesifieke regex-patrone.

Die hoogste risiko onder hierdie kategorieë bepaal die lêer se finale risikovlak.

## Navorsing en Analise

Amazon Macie se navorsingsfunksie maak aangepaste navrae oor alle Macie-data vir diepgaande analise moontlik. Filtre sluit CloudTrail Data, S3 Emmereienskappe, en S3-voorwerpe in. Dit ondersteun ook die uitnodiging van ander rekeninge om Amazon Macie te deel, wat samewerkende datamanagement en sekuriteitsmonitering fasiliteer.


## Enumerasie
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### Post Exploitation

{% hint style="success" %}
Vanuit 'n aanvaller se perspektief is hierdie diens nie daarop gemik om die aanvaller op te spoor nie, maar om sensitiewe inligting in die gestoorde lêers op te spoor. Daarom kan hierdie diens 'n aanvaller help om sensitiewe inligting binne die emmers te vind.\
Nietemin, dalk sal 'n aanvaller ook daarin belangstel om dit te ontwrig ten einde te voorkom dat die slagoffer waarskuwings ontvang en om daardie inligting makliker te steel.
{% endhint %}

TODO: PR's is welkom!

# Verwysings
* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

{% hint style="success" %}
Leer & oefen AWS Hack:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hack: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** 💬 [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
{% endhint %}
