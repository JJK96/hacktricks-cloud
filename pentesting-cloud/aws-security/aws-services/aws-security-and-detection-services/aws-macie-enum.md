# AWS - Macie Enum

{% hint style="success" %}
Ucz się i praktykuj Hacking w AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Ucz się i praktykuj Hacking w GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* Sprawdź [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel się trikami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na githubie.

</details>
{% endhint %}

# Macie

Amazon Macie wyróżnia się jako usługa zaprojektowana do **automatycznego wykrywania, klasyfikowania i identyfikowania danych** w ramach konta AWS. Wykorzystuje **uczenie maszynowe** do ciągłego monitorowania i analizowania danych, głównie skupiając się na wykrywaniu i alarmowaniu w przypadku nietypowych lub podejrzanych działań poprzez analizę danych z **cloud trail event** oraz wzorce zachowań użytkowników.

Główne funkcje Amazon Macie:

1. **Aktywne Przeglądanie Danych**: Wykorzystuje uczenie maszynowe do aktywnego przeglądania danych w miarę różnych akcji zachodzących w koncie AWS.
2. **Wykrywanie Anomalii**: Identyfikuje nieregularne działania lub wzorce dostępu, generując alerty w celu zmniejszenia potencjalnych ryzyk związanych z ujawnieniem danych.
3. **Monitorowanie Ciągłe**: Automatycznie monitoruje i wykrywa nowe dane w Amazon S3, wykorzystując uczenie maszynowe i sztuczną inteligencję do dostosowywania się do wzorców dostępu do danych w czasie.
4. **Klasyfikacja Danych z NLP**: Wykorzystuje przetwarzanie języka naturalnego (NLP) do klasyfikowania i interpretowania różnych typów danych, przypisując wynikom punktacje ryzyka w celu priorytetyzacji wyników.
5. **Monitorowanie Bezpieczeństwa**: Identyfikuje dane wrażliwe pod względem bezpieczeństwa, w tym klucze API, klucze prywatne i dane osobowe, pomagając zapobiegać wyciekom danych.

Amazon Macie jest usługą **regionalną** i wymaga roli IAM 'AWSMacieServiceCustomerSetupRole' oraz włączonego AWS CloudTrail do funkcjonowania.

## System Alertów

Macie kategoryzuje alerty na predefiniowane kategorie, takie jak:

- Anonimowy dostęp
- Zgodność danych
- Utrata poświadczeń
- Eskalacja uprawnień
- Ransomware
- Podejrzany dostęp, itp.

Te alerty zapewniają szczegółowe opisy i podziały wyników dla skutecznej reakcji i rozwiązania.

## Funkcje Dashboardu

Dashboard kategoryzuje dane na różne sekcje, w tym:

- Obiekty S3 (według zakresu czasu, ACL, PII)
- Wydarzenia/Użytkownicy o wysokim ryzyku w CloudTrail
- Lokalizacje aktywności
- Typy tożsamości użytkowników CloudTrail, i inne.

## Kategoryzacja Użytkowników

Użytkownicy są klasyfikowani na poziomy na podstawie poziomu ryzyka ich wywołań API:

- **Platynowy**: Wywołania API o wysokim ryzyku, często z uprawnieniami administratora.
- **Złoty**: Wywołania API związane z infrastrukturą.
- **Srebrny**: Wywołania API o średnim ryzyku.
- **Brązowy**: Wywołania API o niskim ryzyku.

## Typy Tożsamości

Typy tożsamości obejmują Root, Użytkownik IAM, Przyjęta Rola, Użytkownik Federowany, Konto AWS i Usługę AWS, wskazując źródło żądań.

## Klasyfikacja Danych

Klasyfikacja danych obejmuje:

- Typ Zawartości: Na podstawie wykrytego typu zawartości.
- Rozszerzenie Pliku: Na podstawie rozszerzenia pliku.
- Temat: Kategoryzowane według słów kluczowych w plikach.
- Regex: Kategoryzowane na podstawie określonych wzorców regex.

Najwyższe ryzyko wśród tych kategorii określa ostateczny poziom ryzyka pliku.

## Badania i Analizy

Funkcja badawcza Amazon Macie pozwala na niestandardowe zapytania we wszystkich danych Macie w celu głębokiej analizy. Filtry obejmują Dane CloudTrail, Właściwości Kubła S3 i Obiekty S3. Ponadto obsługuje zapraszanie innych kont do udostępniania Amazon Macie, ułatwiając wspólne zarządzanie danymi i monitorowanie bezpieczeństwa.


## Wyliczenie
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### Post Eksploatacja

{% hint style="success" %}
Z perspektywy atakującego, usługa ta nie jest przeznaczona do wykrywania atakującego, ale do wykrywania wrażliwych informacji w przechowywanych plikach. Dlatego ta usługa może **pomóc atakującemu znaleźć wrażliwe informacje** wewnątrz kubełków.\
Jednak atakujący może także być zainteresowany zakłóceniem jej działania, aby uniemożliwić ofierze otrzymywanie alertów i łatwiej ukraść te informacje.
{% endhint %}

TODO: PRy są mile widziane!

# Odnośniki
* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

{% hint style="success" %}
Dowiedz się i ćwicz Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Dowiedz się i ćwicz Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* Sprawdź [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel się trikami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
