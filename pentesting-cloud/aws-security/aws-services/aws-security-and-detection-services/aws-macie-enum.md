# AWS - Καταγραφή Macie

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 [**στην ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Κοινοποιήστε τεχνικές χάκινγκ υποβάλλοντας PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

# Macie

Το Amazon Macie ξεχωρίζει ως ένα υπηρεσία σχεδιασμένη για τον **αυτόματο εντοπισμό, ταξινόμηση και αναγνώριση δεδομένων** εντός ενός λογαριασμού AWS. Χρησιμοποιεί **μηχανική μάθηση** για συνεχή παρακολούθηση και ανάλυση δεδομένων, επικεντρώνοντας κυρίως στον εντοπισμό και την ειδοποίηση για ασυνήθιστες ή ύποπτες δραστηριότητες εξετάζοντας δεδομένα γεγονότων **cloud trail** και πρότυπα συμπεριφοράς χρηστών.

Βασικά Χαρακτηριστικά του Amazon Macie:

1. **Ενεργή Αναθεώρηση Δεδομένων**: Χρησιμοποιεί μηχανική μάθηση για την ενεργή αναθεώρηση δεδομένων καθώς συμβαίνουν διάφορες ενέργειες εντός του λογαριασμού AWS.
2. **Ανίχνευση Ανωμαλιών**: Αναγνωρίζει ανεπιθύμητες δραστηριότητες ή πρότυπα πρόσβασης, δημιουργώντας ειδοποιήσεις για τη μείωση των πιθανών κινδύνων εκθέσεως δεδομένων.
3. **Συνεχής Παρακολούθηση**: Αυτόματα παρακολουθεί και ανιχνεύει νέα δεδομένα στο Amazon S3, χρησιμοποιώντας μηχανική μάθηση και τεχνητή νοημοσύνη για να προσαρμοστεί στα πρότυπα πρόσβασης δεδομένων με τον χρόνο.
4. **Ταξινόμηση Δεδομένων με NLP**: Χρησιμοποιεί επεξεργασία φυσικής γλώσσας (NLP) για την ταξινόμηση και ερμηνεία διαφορετικών τύπων δεδομένων, αναθέτοντας βαθμολογίες κινδύνου για την προτεραιοποίηση των ευρημάτων.
5. **Παρακολούθηση Ασφάλειας**: Αναγνωρίζει δεδομένα που αφορούν την ασφάλεια, συμπεριλαμβανομένων κλειδιών API, μυστικών κλειδιών και προσωπικών πληροφοριών, βοηθώντας στην πρόληψη διαρροών δεδομένων.

Το Amazon Macie είναι μια **περιφερειακή υπηρεσία** και απαιτεί τον ρόλο IAM 'AWSMacieServiceCustomerSetupRole' και ένα ενεργοποιημένο AWS CloudTrail για λειτουργικότητα.

## Σύστημα Ειδοποιήσεων

Το Macie κατηγοριοποιεί τις ειδοποιήσεις σε προκαθορισμένες κατηγορίες όπως:

- Ανωνυμοποιημένη πρόσβαση
- Συμμόρφωση δεδομένων
- Απώλεια διαπιστευτηρίων
- Ανόδου προνομίων
- Ransomware
- Υπούλωτη πρόσβαση, κ.λπ.

Αυτές οι ειδοποιήσεις παρέχουν λεπτομερείς περιγραφές και αναλύσεις αποτελεσμάτων για αποτελεσματική αντίδραση και επίλυση.

## Χαρακτηριστικά Πίνακα Ελέγχου

Ο πίνακας ελέγχου κατηγοριοποιεί τα δεδομένα σε διάφορες ενότητες, συμπεριλαμβανομένων:

- Αντικείμενα S3 (ανά εύρος χρόνου, ACL, PII)
- Υψηλού κινδύνου γεγονότα/χρήστες CloudTrail
- Τοποθεσίες Δραστηριότητας
- Τύποι ταυτότητας χρηστών CloudTrail, κ.α.

## Κατηγοριοποίηση Χρηστών

Οι χρήστες κατηγοριοποιούνται σε επίπεδα με βάση το επίπεδο κινδύνου των κλήσεών τους στο API:

- **Πλατίνα**: Κλήσεις API υψηλού κινδύνου, συχνά με διαχειριστικά προνόμια.
- **Χρυσός**: Κλήσεις API που σχετίζονται με την υποδομή.
- **Ασημένιος**: Κλήσεις API με μέτριο κίνδυνο.
- **Χάλκινος**: Κλήσεις API χαμηλού κινδύνου.

## Τύποι Ταυτότητας

Οι τύποι ταυτότητας περιλαμβάνουν Ρίζα, Χρήστη IAM, Υποθετικό Ρόλο, Επικεφαλής Χρήστη, Λογαριασμό AWS και Υπηρεσία AWS, υποδεικνύοντας την πηγή των αιτημάτων.

## Κατηγοριοποίηση Δεδομένων

Η κατηγοριοποίηση δεδομένων περιλαμβάνει:

- Τύπος Περιεχομένου: Βασισμένο στον εντοπισμένο τύπο περιεχομένου.
- Επέκταση Αρχείου: Βασισμένο στην επέκταση αρχείου.
- Θέμα: Κατηγοριοποιημένο με βάση λέξεις-κλειδιά εντός αρχείων.
- Regex: Κατηγοριοποιημένο βάσει συγκεκριμένων μοτίβων regex.

Η υψηλότερη κίνδυνος μεταξύ αυτών των κατηγοριών καθορίζει το τελικό επίπεδο κινδύνου του αρχείου.

## Έρευνα και Ανάλυση

Η λειτουργία έρευνας του Amazon Macie επιτρέπει προσαρμοσμένες ερωτήσεις σε όλα τα δεδομένα του Macie για εμβάθυνση στην ανάλυση. Οι φίλτρα περιλαμβάνουν Δεδομένα CloudTrail, Ιδιότητες Κάδου S3 και Αντικείμενα S3. Επιπλέον, υποστηρίζει την πρόσκληση άλλων λογαριασμών για να μοιραστεί το Amazon Macie, διευκολύνοντας τη συνεργασία στη διαχείριση δεδομένων και την παρακολούθηση της ασφάλειας.


## Απαρίθμηση
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### Post Exploitation

{% hint style="success" %}
Από την οπτική γωνία ενός εισβολέα, αυτή η υπηρεσία δεν έχει σχεδιαστεί για τον εντοπισμό του εισβολέα, αλλά για τον εντοπισμό ευαίσθητων πληροφοριών στα αποθηκευμένα αρχεία. Επομένως, αυτή η υπηρεσία μπορεί **να βοηθήσει έναν εισβολέα να βρει ευαίσθητες πληροφορίες** μέσα στα buckets.\
Ωστόσο, ίσως ένας εισβολέας ενδιαφέρεται επίσης να την αναταράξει προκειμένου να εμποδίσει το θύμα από το να λαμβάνει ειδοποιήσεις και να κλέψει αυτές τις πληροφορίες πιο εύκολα.
{% endhint %}

TODO: Οι αιτήσεις συνεισφοράς είναι ευπρόσδεκτες!

# Αναφορές
* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** στην 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Κοινοποιήστε κόλπα χάκερ υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο GitHub.

</details>
{% endhint %}
