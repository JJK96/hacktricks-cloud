# AWS - Config Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## AWS Config

AWS Config **captura mudan√ßas de recursos**, ent√£o qualquer altera√ß√£o em um recurso suportado pelo Config pode ser registrada, o que **registrar√° o que mudou junto com outros metadados √∫teis, todos mantidos em um arquivo conhecido como item de configura√ß√£o**, um CI. Este servi√ßo √© **espec√≠fico da regi√£o**.

Um item de configura√ß√£o ou **CI**, como √© conhecido, √© um componente chave do AWS Config. √â composto por um arquivo JSON que **cont√©m as informa√ß√µes de configura√ß√£o, informa√ß√µes de relacionamento e outros metadados como uma vis√£o instant√¢nea de um recurso suportado**. Todas as informa√ß√µes que o AWS Config pode registrar para um recurso s√£o capturadas dentro do CI. Um CI √© criado **toda vez** que um recurso suportado tem uma altera√ß√£o feita em sua configura√ß√£o de qualquer forma. Al√©m de registrar os detalhes do recurso afetado, o AWS Config tamb√©m registrar√° CIs para quaisquer recursos diretamente relacionados para garantir que a altera√ß√£o n√£o afetou esses recursos tamb√©m.

* **Metadados**: Cont√©m detalhes sobre o pr√≥prio item de configura√ß√£o. Um ID de vers√£o e um ID de configura√ß√£o, que identificam exclusivamente o CI. Outras informa√ß√µes podem incluir um MD5Hash que permite comparar outros CIs j√° registrados contra o mesmo recurso.
* **Atributos**: Isso cont√©m informa√ß√µes comuns de **atributos contra o recurso real**. Dentro desta se√ß√£o, tamb√©m temos um ID de recurso exclusivo e quaisquer tags de valor chave associadas ao recurso. O tipo de recurso tamb√©m √© listado. Por exemplo, se este fosse um CI para uma inst√¢ncia EC2, os tipos de recursos listados poderiam ser a interface de rede ou o endere√ßo IP el√°stico para essa inst√¢ncia EC2.
* **Relacionamentos**: Isso cont√©m informa√ß√µes para qualquer **relacionamento conectado que o recurso possa ter**. Ent√£o, dentro desta se√ß√£o, mostraria uma descri√ß√£o clara de qualquer relacionamento com outros recursos que este recurso tinha. Por exemplo, se o CI fosse para uma inst√¢ncia EC2, a se√ß√£o de relacionamento poderia mostrar a conex√£o com um VPC junto com a sub-rede em que a inst√¢ncia EC2 reside.
* **Configura√ß√£o atual:** Isso exibir√° as mesmas informa√ß√µes que seriam geradas se voc√™ realizasse uma chamada de API de descri√ß√£o ou lista feita pelo AWS CLI. O AWS Config usa as mesmas chamadas de API para obter as mesmas informa√ß√µes.
* **Eventos relacionados**: Isso se relaciona ao AWS CloudTrail. Isso exibir√° o **ID do evento do AWS CloudTrail que est√° relacionado √† altera√ß√£o que desencadeou a cria√ß√£o deste CI**. H√° um novo CI feito para cada altera√ß√£o feita em um recurso. Como resultado, diferentes IDs de eventos do CloudTrail ser√£o criados.

**Hist√≥rico de Configura√ß√£o**: √â poss√≠vel obter o hist√≥rico de configura√ß√£o dos recursos gra√ßas aos itens de configura√ß√£o. Um hist√≥rico de configura√ß√£o √© entregue a cada 6 horas e cont√©m todos os CIs para um tipo de recurso espec√≠fico.

**Streams de Configura√ß√£o**: Itens de configura√ß√£o s√£o enviados para um T√≥pico SNS para permitir a an√°lise dos dados.

**Snapshots de Configura√ß√£o**: Itens de configura√ß√£o s√£o usados para criar um snapshot de ponto no tempo de todos os recursos suportados.

**S3 √© usado para armazenar** os arquivos de Hist√≥rico de Configura√ß√£o e quaisquer snapshots de Configura√ß√£o dos seus dados dentro de um √∫nico bucket, que √© definido dentro do gravador de Configura√ß√£o. Se voc√™ tiver v√°rias contas AWS, pode querer agregar seus arquivos de hist√≥rico de configura√ß√£o no mesmo bucket S3 para sua conta principal. No entanto, voc√™ precisar√° conceder acesso de grava√ß√£o para este princ√≠pio de servi√ßo, config.amazonaws.com, e suas contas secund√°rias com acesso de grava√ß√£o ao bucket S3 em sua conta principal.

### Funcionamento

* Quando fizer altera√ß√µes, por exemplo, na lista de controle de acesso do grupo de seguran√ßa ou do bucket ‚Äî> dispara como um Evento captado pelo AWS Config
* Armazena tudo no bucket S3
* Dependendo da configura√ß√£o, assim que algo mudar, pode acionar uma fun√ß√£o lambda OU agendar uma fun√ß√£o lambda para periodicamente examinar as configura√ß√µes do AWS Config
* Lambda alimenta de volta ao Config
* Se uma regra foi quebrada, o Config aciona um SNS

![](<../../../../.gitbook/assets/image (126).png>)

### Regras de Configura√ß√£o

Regras de configura√ß√£o s√£o uma √≥tima maneira de ajudar voc√™ a **impor verifica√ß√µes de conformidade espec√≠ficas** **e controles em seus recursos**, e permite que voc√™ adote uma especifica√ß√£o de implanta√ß√£o ideal para cada um dos seus tipos de recursos. Cada regra **√© essencialmente uma fun√ß√£o lambda** que, quando chamada, avalia o recurso e realiza alguma l√≥gica simples para determinar o resultado de conformidade com a regra. **Cada vez que uma altera√ß√£o √© feita** em um dos seus recursos suportados, **o AWS Config verificar√° a conformidade contra quaisquer regras de configura√ß√£o que voc√™ tenha em vigor**.\
A AWS possui v√°rias **regras predefinidas** que se enquadram no guarda-chuva de seguran√ßa e est√£o prontas para uso. Por exemplo, Rds-storage-encrypted. Isso verifica se a criptografia de armazenamento est√° ativada pelas suas inst√¢ncias de banco de dados RDS. Encrypted-volumes. Isso verifica se algum volume EBS que tem um estado anexado est√° criptografado.

* **Regras gerenciadas pela AWS**: Conjunto de regras predefinidas que cobrem muitas das melhores pr√°ticas, ent√£o sempre vale a pena navegar por essas regras primeiro antes de configurar as suas pr√≥prias, pois h√° uma chance de que a regra j√° exista.
* **Regras personalizadas**: Voc√™ pode criar suas pr√≥prias regras para verificar configura√ß√µes personalizadas espec√≠ficas.

Limite de 50 regras de configura√ß√£o por regi√£o antes de voc√™ precisar entrar em contato com a AWS para um aumento.\
Resultados n√£o conformes N√ÉO s√£o exclu√≠dos.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
