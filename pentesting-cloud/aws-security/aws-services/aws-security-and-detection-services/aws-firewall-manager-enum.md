# AWS - Firewall Manager Enum

{% hint style="success" %}
Μάθετε και εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε και εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}

## Firewall Manager

Το **AWS Firewall Manager** απλοποιεί τη διαχείριση και τη συντήρηση των **AWS WAF, AWS Shield Advanced, Amazon VPC security groups και Network Access Control Lists (ACLs), και AWS Network Firewall, AWS Route 53 Resolver DNS Firewall και third-party firewalls** σε πολλαπλούς λογαριασμούς και πόρους. Σας επιτρέπει να διαμορφώσετε τους κανόνες firewall, τις προστασίες Shield Advanced, τα security groups του VPC και τις ρυθμίσεις του Network Firewall μόνο μία φορά, με την υπηρεσία να **επιβάλλει αυτόματα αυτούς τους κανόνες και τις προστασίες σε όλους τους λογαριασμούς και τους πόρους σας**, συμπεριλαμβανομένων των νέων που προστίθενται.

Η υπηρεσία προσφέρει τη δυνατότητα να **ομαδοποιήσετε και να προστατεύσετε συγκεκριμένους πόρους μαζί**, όπως αυτούς που μοιράζονται μια κοινή ετικέτα ή όλες τις διανομές CloudFront σας. Ένα σημαντικό πλεονέκτημα του Firewall Manager είναι η ικανότητά του να **επεκτείνει αυτόματα την προστασία σε νέους πόρους** στον λογαριασμό σας.

Μια **ομάδα κανόνων** (μια συλλογή κανόνων WAF) μπορεί να ενσωματωθεί σε μια πολιτική του AWS Firewall Manager, η οποία στη συνέχεια συνδέεται με συγκεκριμένους πόρους του AWS, όπως διανομές CloudFront ή application load balancers.

Το AWS Firewall Manager παρέχει **διαχειριζόμενες λίστες εφαρμογών και πρωτοκόλλων** για να απλοποιήσει τη διαμόρφωση και τη διαχείριση των πολιτικών security group. Αυτές οι λίστες σας επιτρέπουν να ορίσετε τα πρωτόκολλα και τις εφαρμογές που επιτρέπονται ή απορρίπτονται από τις πολιτικές σας. Υπάρχουν δύο τύποι διαχειριζόμενων λιστών:

* **Firewall Manager managed lists**: Αυτές οι λίστες περιλαμβάνουν τις **FMS-Default-Public-Access-Apps-Allowed**, **FMS-Default-Protocols-Allowed** και **FMS-Default-Protocols-Allowed**. Διαχειρίζονται από το Firewall Manager και περιλαμβάνουν συνήθως χρησιμοποιούμενες εφαρμογές και πρωτόκολλα που πρέπει να επιτρέπονται ή να απορρίπτονται στο ευρύ κοινό. Δεν είναι δυνατή η επεξεργασία ή η διαγραφή τους, ωστόσο, μπορείτε να επιλέξετε την έκδοσή τους.
* **Custom managed lists**: Αυτές τις λίστες τις διαχειρίζεστε εσείς. Μπορείτε να δημιουργήσετε προσαρμοσμένες λίστες εφαρμογών και πρωτοκόλλων προσαρμοσμένες στις ανάγκες του οργανισμού σας. Σε αντίθεση με τις διαχειριζόμενες λίστες του Firewall Manager, αυτές οι λίστες δεν έχουν εκδόσεις, αλλά έχετε πλήρη έλεγχο στις προσαρμοσμένες λίστες, επιτρέποντάς σας να τις δημιουργήσετε, να τις επεξεργαστείτε και να τις διαγράψετε όπως απαιτείται.

Είναι σημαντικό να σημειωθεί ότι **οι πολιτικές του Firewall Manager επιτρέπουν μόνο ενέργειες "Block" ή "Count"** για μια ομάδα κανόνων, χωρίς επιλογή "Allow".

### Προαπαιτούμενα

Τα παρακάτω προαπαιτούμενα βήματα πρέπει να ολοκληρωθούν πριν προχωρήσετε στη διαμόρφωση του Firewall Manager για να αρχίσετε να προστατεύετε αποτελεσματικά τους πόρους του οργανισμού σας. Αυτά τα βήματα παρέχουν τη βασική ρύθμιση που απαιτείται για το Firewall Manager να επιβάλλει πολιτικές ασφαλείας και να διασφαλίζει τη συμμόρφωση σε όλο το περιβάλλον AWS σας:

1. **Εγγραφή και διαμόρφωση AWS Organizations:** Βεβαιωθείτε ότι ο λογαριασμός AWS σας είναι μέρος του οργανισμού AWS Organizations όπου σχεδιάζονται να εφαρμοστούν οι πολιτικές του AWS Firewall Manager. Αυτό επιτρέπει την κεντρική διαχείριση των πόρων και των πολιτικών σε πολλαπλούς λογαριασμούς AWS εντός του οργανισμού.
2. **Δημιουργία ενός AWS Firewall Manager Default Administrator Account:** Δημιουργήστε έναν προεπιλεγμένο λογαριασμό διαχειριστή ειδικά για τη διαχείριση των πολιτικών ασφαλείας του Firewall Manager. Αυτός ο λογαριασμός θα είναι υπεύθυνος για τη διαμόρφωση και την επιβολή των πολιτικών ασφαλείας σε όλο τον οργανισμό. Μόνο ο λογαριασμός διαχείρισης του οργανισμού μπορεί να δημιουργήσει προεπιλεγμένους λογαριασμούς διαχειριστή του Firewall Manager.
3. **Ενεργοποίηση του AWS Config:** Ενεργοποιήστε το AWS Config για να παρέχετε στο Firewall Manager τα απαραίτητα δεδομένα διαμόρφωσης και τις πληροφορίες που απαιτούνται για την αποτελεσματική επιβολή των πολιτικών ασφαλείας. Το AWS Config βοηθά στην ανάλυση, τον έλεγχο, την παρακολούθηση και τον έλεγχο των διαμορφώσεων και των αλλαγών των πόρων, διευκολύνοντας τη βελτίωση της διαχείρισης της ασφάλειας.
4. **Για Third-Party Policies, εγγραφή στο AWS Marketplace και διαμόρφωση των ρυθμίσεων τρίτων:** Εάν σκοπεύετε να χρησιμοποιήσετε πολιτικές firewall τρίτων, εγγραφείτε σε αυτές στο AWS Marketplace και διαμορφώστε τις απαραίτητες ρυθμίσεις. Αυτό το βήμα διασφαλίζει ότι το Firewall Manager μπορεί να ενσωματώσει και να επιβάλλει πολιτικές από αξιόπιστους προμηθευτές τρίτων.
5. **Για Network Firewall και DNS Firewall Policies, ενεργοποίηση κοινής χρήσης πόρων:** Ενεργοποιήστε την κοινή χρήση πόρων ειδικά για τις πολιτικές Network Firewall και DNS Firewall. Αυτό επιτρέπει στο Firewall Manager να εφαρμόζει προστασίες firewall στα VPCs και την επίλυση DNS του οργανισμού σας, ενισχύοντας την ασφάλεια του δικτύου.
6. **Για να χρησιμοποιήσετε το AWS Firewall Manager σε περιοχές που είναι απενεργοποιημένες από προεπιλογή:** Εάν σκοπεύετε να χρησιμοποιήσετε το Firewall Manager σε περιοχές AWS που είναι απενεργοποιημένες από προεπιλογή, βεβαιωθείτε ότι έχετε λάβει τα απαραίτητα μέτρα για να ενεργοποιήσετε τη λειτουργικότητά του σε αυτές τις περιοχές. Αυτό διασφαλίζει συνεπή επιβολή της ασφάλειας σε όλες τις περιοχές όπου λειτουργεί ο οργανισμός σας.

Για περισσότερες πληροφορίες, ελέγξτε: [Getting started with AWS Firewall Manager AWS WAF policies](https://docs.aws.amazon.com/waf/latest/developerguide/getting-started-fms.html).

### Τύποι πολιτικών προστασίας

Το AWS Firewall Manager διαχειρίζεται διάφορους τύπους πολιτικών για την επιβολή ελέγχων ασφαλείας σε διαφορετικές πτυχές της υποδομής του οργανισμού σας:

1. **AWS WAF Policy:** Αυτός ο τύπος πολιτικής υποστηρίζει τόσο το AWS WAF όσο και το AWS WAF Classic. Μπορείτε να ορίσετε ποιοι πόροι προστατεύονται από την πολιτική. Για τις πολιτικές AWS WAF, μπορείτε να καθορίσετε σύνολα ομάδων κανόνων που θα εκτελούνται πρώτα και τελευταία στο web ACL. Επιπλέον, οι ιδιοκτήτες λογαριασμών μπορούν να προσθέσουν κανόνες και ομάδες κανόνων για να εκτελούνται μεταξύ αυτών των συνόλων.
2. **Shield Advanced Policy:** Αυτή η πολιτική εφαρμόζει προστασίες Shield Advanced σε όλο τον οργανισμό σας για συγκεκριμένους τύπους πόρων. Βοηθά στην προστασία από επιθέσεις DDoS και άλλες απειλές.
3. **Amazon VPC Security Group Policy:** Με αυτήν την πολιτική, μπορείτε να διαχειριστείτε τα security groups που χρησιμοποιούνται σε όλο τον οργανισμό σας, επιβάλλοντας ένα βασικό σύνολο κανόνων σε όλο το περιβάλλον AWS σας για τον έλεγχο της πρόσβασης στο δίκτυο.
4. **Amazon VPC Network Access Control List (ACL) Policy:** Αυτός ο τύπος πολιτικής σας δίνει έλεγχο στα network ACLs που χρησιμοποιούνται στον οργανισμό σας, επιτρέποντάς σας να επιβάλλετε ένα βασικό σύνολο network ACLs σε όλο το περιβάλλον AWS σας.
5. **Network Firewall Policy:** Αυτή η πολιτική εφαρμόζει προστασία AWS Network Firewall στα VPCs του οργανισμού σας, ενισχύοντας την ασφάλεια του δικτύου με τη φιλτράρισμα της κυκλοφορίας βάσει προκαθορισμένων κανόνων.
6. **Amazon Route 53 Resolver DNS Firewall Policy:** Αυτή η πολιτική εφαρμόζει προστασίες DNS Firewall στα VPCs του οργανισμού σας, βοηθώντας να μπλοκάρετε κακόβουλες προσπάθειες επίλυσης domain και να επιβάλλετε πολιτικές ασφαλείας για την κυκλοφορία DNS.
7. **Third-Party Firewall Policy:** Αυτός ο τύπος πολιτικής εφαρμόζει προστασίες από third-party firewalls, τα οποία είναι διαθέσιμα με συνδρομή μέσω της κονσόλας AWS Marketplace. Σας επιτρέπει να ενσωματώσετε επιπλέον μέτρα ασφαλείας από αξιόπιστους προμηθευτές στο περιβάλλον AWS σας.
1. **Palo Alto Networks Cloud NGFW Policy:** Αυτή η πολιτική εφαρμόζει προστασίες και κανόνες Palo Alto Networks Cloud Next Generation Firewall (NGFW) στα VPCs του οργανισμού σας, παρέχοντας προηγμένη πρόληψη απειλών και ελέγχους ασφαλείας σε επίπεδο εφαρμογών.
2. **Fortigate Cloud Native Firewall (CNF) as a Service Policy:** Αυτή η πολιτική εφαρμόζει προστασίες Fortigate Cloud Native Firewall (CNF) as a Service, προσφέροντας κορυφαία πρόληψη απειλών, web application firewall (WAF) και προστασία API προσαρμοσμένη για υποδομές cloud.

### Λογαριασμοί διαχειριστή

Το AWS Firewall Manager προσφέρει ευελιξία στη διαχείριση των πόρων firewall εντός του οργανισμού σας μέσω του διοικητικού πεδίου εφαρμογής και δύο τύπων λογαριασμών διαχειριστή.

**Το διοικητικό πεδίο εφαρμογής ορίζει τους πόρους που μπορεί να διαχειριστεί ένας διαχειριστής του Firewall Manager**. Μετά την εγγραφή ενός λογαριασμού διαχείρισης AWS Organizations στον οργανισμό στο Firewall Manager, μπορεί να δημιουργήσει επιπλέον διαχειριστές με διαφορετικά διοικητικά πεδία εφαρμογής. Αυτά τα πεδία εφαρμογής μπορούν να περιλαμβάνουν:

- Λογαριασμούς ή οργανωτικές μονάδες (OUs) στους οποίους ο διαχειριστής μπορεί να εφαρμόσει πολιτικές.
- Περιοχές όπου ο διαχειριστής μπορεί να εκτελεί ενέργειες.
- Τύπους πολιτικών του Firewall Manager που μπορεί να διαχειριστεί ο διαχειριστής.

Το διοικητικό πεδίο εφαρμογής μπορεί να είναι είτε **πλήρες είτε περιορισμένο**. Το πλήρες πεδίο εφαρμογής παρέχει στον διαχειριστή πρόσβαση σε **όλους τους καθορισμένους τύπους πόρων, περιοχές και τύπους πολιτικών**. Αντίθετα, το **περιορισμένο πεδίο εφαρμογής παρέχει διοικητική άδεια μόνο σε ένα υποσύνολο πόρων, περιοχών ή τύπων πολιτικών**. Συνιστάται να παρέχετε στους διαχειριστές μόνο τις άδειες που χρειάζονται για να εκπληρώσουν αποτελεσματικά τους ρόλους τους. Μπορείτε να εφαρμόσετε οποιονδήποτε συνδυασμό αυτών των συνθηκών διοικητικού πεδίου εφαρμογής σε έναν διαχειριστή, διασφαλίζοντας τη συμμόρφωση με την αρχή της ελάχιστης προνομιακής πρόσβασης.

Υπάρχουν δύο διακριτοί τύποι λογαριασμών διαχειριστή, καθένας από τους οποίους εξυπηρετεί συγκεκριμένους ρόλους και ευθύνες:

- **Default Administrator:**
- Ο προεπιλεγμένος λογαριασμός διαχειριστή δημιουργείται από τον λογαριασμό διαχείρισης του οργανισμού AWS Organizations κατά τη διαδικασία εγγραφής στο Firewall Manager.
- Αυτός ο λογαριασμός έχει τη δυνατότητα να διαχειρίζεται third-party firewalls και διαθέτει πλήρες διοικητικό πεδίο εφαρμογής.
- Λειτουργεί ως ο κύριος λογαριασμός διαχειριστή για το Firewall Manager, υπεύθυνος για τη διαμόρφωση και την επιβολή των πολιτικών ασφαλείας σε όλο τον οργανισμό.
- Ενώ ο προεπιλεγμένος διαχειριστής έχει πλήρη πρόσβαση σε όλους τους τύπους πόρων και τις διοικητικές λειτουργίες, λειτουργεί στο ίδιο επίπεδο με άλλους διαχειριστές εάν χρησιμοποιούνται πολλαπλοί διαχειριστές εντός του οργανισμού.
- **Firewall Manager Administrators:**
- Αυτοί οι διαχειριστές μπορούν να διαχειρίζονται πόρους εντός του πεδίου εφαρμογής που ορίζεται από τον λογαριασμό διαχείρισης του AWS Organizations, όπως ορίζεται από τη διαμόρφωση του διοικητικού πεδίου εφαρμογής.
- Οι διαχειριστές του Firewall Manager δημιουργούνται για να εκπληρώσουν συγκεκριμένους ρόλους εντός του οργανισμού, επιτρέποντας την ανάθεση ευθυνών ενώ διατηρούν τα πρότυπα ασφάλειας και συμμόρφωσης.
- Κατά τη δημιουργία, το Firewall Manager ελέγχει με το AWS Organizations για να καθορίσει εάν ο λογαριασμός είναι ήδη εξουσιοδοτημένος διαχειριστής. Εάν όχι, το Firewall Manager καλεί το Organizations για να ορίσει τον λογαριασμό ως εξουσιοδοτημένο διαχειριστή για το Firewall Manager.

Η διαχείριση αυτών των λογαριασμών διαχειριστή περιλαμβάνει τη δημιουργία τους εντός του Firewall Manager και τον καθορισμό των διοικητικών πεδίων εφαρμογής τους σύμφωνα με τις απαιτήσεις ασφαλείας του οργανισμού και την αρχή της ελάχιστης προνομιακής πρόσβασης. Με την ανάθεση κατάλληλων διοικητικών ρόλων, οι οργανισμοί μπορούν να διασφαλίσουν αποτελεσματική διαχείριση της ασφάλειας ενώ διατηρούν λεπτομερή έλεγχο της πρόσβασης σε ευαίσθητους πόρους.

Είναι σημαντικό να τονιστεί ότι **μόνο ένας λογαριασμός εντός ενός οργανισμού μπορεί να λειτουργεί ως ο προεπιλεγμένος διαχειριστής του Firewall Manager**, τηρώντας την αρχή του "**πρώτος μέσα, τελευταίος έξω**". Για να ορίσετε έναν νέο προεπιλεγμένο διαχειριστή, πρέπει να ακολουθηθεί μια σειρά βημάτων:

- Πρώτον, κάθε λογαριασμός διαχειριστή του Firewall Manager πρέπει να ανακαλέσει τον δικό του λογαριασμό.
- Στη συνέχεια, ο υπάρχων προεπιλεγμένος διαχειριστής μπορεί να ανακαλέσει τον δικό του λογαριασμό, αποσυνδέοντας αποτελεσματικά τον οργανισμό από το Firewall Manager. Αυτή η διαδικασία οδηγεί στη διαγραφή όλων των πολιτικών του Firewall Manager που δημιουργήθηκαν από τον ανακληθέντα λογαριασμό.
- Τέλος, ο λογαριασμός διαχείρισης του AWS Organizations πρέπει να ορίσει τον προεπιλεγμένο διαχειριστή του Firewall Manager.

## Enumeration
```
# Users/Administrators

## Get the AWS Organizations account that is associated with AWS Firewall Manager as the AWS Firewall Manager default administrator
aws fms get-admin-account

## List of Firewall Manager administrators within the organization
aws fms list-admin-accounts-for-organization # ReadOnlyAccess policy is not enough for this

## Return a list of the member accounts in the FM administrator's AWS organization
aws fms list-member-accounts # Only a Firewall Manager administrator or the Organization's management account can make this request

## List the accounts that are managing the specified AWS Organizations member account
aws fms list-admins-managing-account # ReadOnlyAccess policy is not enough for this

# Resources

## Get the resources that a Firewall Manager administrator can manage
aws fms get-admin-scope --admin-account <value> # ReadOnlyAccess policy is not enough for this

## Returns the summary of the resource sets used
aws fms list-resource-sets # ReadOnlyAccess policy is not enough for this

## Get information about a specific resource set
aws fms get-resource-set --identifier <value>  # ReadOnlyAccess policy is not enough for this

## Retrieve the list of tags for a given resource
aws fms list-tags-for-resource --resource-arn <value>

## List of the resources in the AWS Organization's accounts that are available to be associated with a FM resource set. Only one account is supported per request.
aws fms list-compliance-status --member-account-ids <value> --resource-type <value> # ReadOnlyAccess policy is not enough for this

## List the resources that are currently associated to a resource set
aws fms list-resource-set-resources --identifier <value> # ReadOnlyAccess policy is not enough for this

# Policies

## Returns the list of policies
aws fms list-policies

## Get information about the specified AWS Firewall Manager policy
aws fms get-policy --policy-id <value>

## List all of the third-party firewall policies that are associated with the third-party firewall administrator's account
aws fms list-third-party-firewall-firewall-policies --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

# AppsList

## Return a list of apps list
aws fms list-apps-lists --max-results [1-100]

## Get information about the specified AWS Firewall Manager applications list
aws fms get-apps-list --list-id <value>

# Protocols

## Get the details of the Firewall Manager protocols list.
aws fms list-protocols-lists

## Get information about the specified AWS Firewall Manager Protocols list
aws fms get-protocols-list --list-id <value>

# Compliance

## Return a summary of which member accounts are protected by the specified policy
aws fms list-compliance-status --policy-id <policy-id>

## Get detailed compliance information about the specified member account (resources that are in and out of compliance with the specified policy)
aws fms get-compliance-detail --policy-id <value> --member-account <value>

# Other useful info

## Get information about the SNS topic that is used to record AWS Firewall Manager SNS logs (if any)
aws fms get-notification-channel

## Get policy-level attack summary information in the event of a potential DDoS attack
aws fms get-protection-status --policy-id <value> # Just for Shield Advanced policy

## Get the onboarding status of a Firewall Manager admin account to third-party firewall vendor tenant.
aws fms get-third-party-firewall-association-status --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

## Get violations' details for a resource based on the specified AWS Firewall Manager policy and AWS account.
aws fms get-violation-details --policy-id <value> --member-account <value> --resource-id <value> --resource-type <value>
```
## Post Exploitation / Bypass Detection

### `organizations:DescribeOrganization` & (`fms:AssociateAdminAccount`, `fms:DisassociateAdminAccount`, `fms:PutAdminAccount`)
Ένας επιτιθέμενος με την άδεια **`fms:AssociateAdminAccount`** θα μπορούσε να ορίσει τον προεπιλεγμένο λογαριασμό διαχειριστή του Firewall Manager. Με την άδεια **`fms:PutAdminAccount`**, ένας επιτιθέμενος θα μπορούσε να δημιουργήσει ή να ενημερώσει έναν λογαριασμό διαχειριστή του Firewall Manager και με την άδεια **`fms:DisassociateAdminAccount`**, ένας πιθανός επιτιθέμενος θα μπορούσε να αφαιρέσει τη συσχέτιση του τρέχοντος λογαριασμού διαχειριστή του Firewall Manager.

- Η αποσύνδεση του **προεπιλεγμένου διαχειριστή του Firewall Manager ακολουθεί την πολιτική first-in-last-out**. Όλοι οι διαχειριστές του Firewall Manager πρέπει να αποσυνδεθούν πριν ο προεπιλεγμένος διαχειριστής του Firewall Manager μπορέσει να αποσυνδέσει τον λογαριασμό.
- Για να δημιουργηθεί ένας διαχειριστής του Firewall Manager μέσω **PutAdminAccount**, ο λογαριασμός πρέπει να ανήκει στον οργανισμό που είχε προηγουμένως ενταχθεί στο Firewall Manager χρησιμοποιώντας **AssociateAdminAccount**.
- Η δημιουργία ενός λογαριασμού διαχειριστή του Firewall Manager μπορεί να γίνει μόνο από τον λογαριασμό διαχείρισης του οργανισμού.
```bash
aws fms associate-admin-account --admin-account <value>
aws fms disassociate-admin-account
aws fms put-admin-account --admin-account <value>
```
**Πιθανή Επίπτωση:** Απώλεια κεντρικής διαχείρισης, παράκαμψη πολιτικής, παραβιάσεις συμμόρφωσης και διακοπή των ελέγχων ασφαλείας εντός του περιβάλλοντος.

### `fms:PutPolicy`, `fms:DeletePolicy`

Ένας επιτιθέμενος με τις άδειες **`fms:PutPolicy`**, **`fms:DeletePolicy`** θα μπορούσε να δημιουργήσει, να τροποποιήσει ή να διαγράψει μόνιμα μια πολιτική του AWS Firewall Manager.
```bash
aws fms put-policy --policy <value> | --cli-input-json file://<policy.json> [--tag-list <value>]
aws fms delete-policy --policy-id <value> [--delete-all-policy-resources | --no-delete-all-policy-resources]
```
Ένα παράδειγμα επιτρεπτικής πολιτικής μέσω επιτρεπτικής ομάδας ασφαλείας, για να παρακαμφθεί η ανίχνευση, θα μπορούσε να είναι το ακόλουθο:
```json
{
"Policy": {
"PolicyName": "permisive_policy",
"SecurityServicePolicyData": {
"Type": "SECURITY_GROUPS_COMMON",
"ManagedServiceData": "{\"type\":\"SECURITY_GROUPS_COMMON\",\"securityGroups\":[{\"id\":\"<permisive_security_group_id>\"}], \"applyToAllEC2InstanceENIs\":\"true\",\"IncludeSharedVPC\":\"true\"}"
},
"ResourceTypeList": ["AWS::EC2::Instance", "AWS::EC2::NetworkInterface", "AWS::EC2::SecurityGroup", "AWS::ElasticLoadBalancingV2::LoadBalancer", "AWS::ElasticLoadBalancing::LoadBalancer"],
"ResourceType": "AWS::EC2::SecurityGroup",
"ExcludeResourceTags": false,
"ResourceTags": [],
"RemediationEnabled": true
},
"TagList": []
}
```
**Πιθανές Επιπτώσεις:** Αποσυναρμολόγηση ελέγχων ασφαλείας, παράκαμψη πολιτικών, παραβιάσεις συμμόρφωσης, λειτουργικές διακοπές και πιθανές διαρροές δεδομένων εντός του περιβάλλοντος.

### `fms:BatchAssociateResource`, `fms:BatchDisassociateResource`, `fms:PutResourceSet`, `fms:DeleteResourceSet`

Ένας επιτιθέμενος με τις άδειες **`fms:BatchAssociateResource`** και **`fms:BatchDisassociateResource`** θα μπορούσε να συσχετίσει ή να αποσυσχετίσει πόρους από ένα σύνολο πόρων του Firewall Manager αντίστοιχα. Επιπλέον, οι άδειες **`fms:PutResourceSet`** και **`fms:DeleteResourceSet`** θα επέτρεπαν σε έναν επιτιθέμενο να δημιουργήσει, να τροποποιήσει ή να διαγράψει αυτά τα σύνολα πόρων από το AWS Firewall Manager.
```bash
# Associate/Disassociate resources from a resource set
aws fms batch-associate-resource --resource-set-identifier <value> --items <value>
aws fms batch-disassociate-resource --resource-set-identifier <value> --items <value>

# Create, modify or delete a resource set
aws fms put-resource-set --resource-set <value> [--tag-list <value>]
aws fms delete-resource-set --identifier <value>
```
**Πιθανός Αντίκτυπος:** Η προσθήκη περιττού αριθμού στοιχείων σε ένα σύνολο πόρων θα αυξήσει το επίπεδο θορύβου στην Υπηρεσία, ενδεχομένως προκαλώντας DoS. Επιπλέον, οι αλλαγές στα σύνολα πόρων θα μπορούσαν να οδηγήσουν σε διακοπή πόρων, παράκαμψη πολιτικών, παραβιάσεις συμμόρφωσης και διακοπή των ελέγχων ασφαλείας εντός του περιβάλλοντος.

### `fms:PutAppsList`, `fms:DeleteAppsList`

Ένας επιτιθέμενος με τις άδειες **`fms:PutAppsList`** και **`fms:DeleteAppsList`** θα μπορούσε να δημιουργήσει, να τροποποιήσει ή να διαγράψει λίστες εφαρμογών από το AWS Firewall Manager. Αυτό θα μπορούσε να είναι κρίσιμο, καθώς μη εξουσιοδοτημένες εφαρμογές θα μπορούσαν να επιτραπούν να έχουν πρόσβαση στο ευρύ κοινό, ή η πρόσβαση σε εξουσιοδοτημένες εφαρμογές θα μπορούσε να απορριφθεί, προκαλώντας DoS.
```bash
aws fms put-apps-list --apps-list <value> [--tag-list <value>]
aws fms delete-apps-list --list-id <value>
```
**Πιθανός Αντίκτυπος:** Αυτό θα μπορούσε να οδηγήσει σε λανθασμένες ρυθμίσεις, παράκαμψη πολιτικών, παραβιάσεις συμμόρφωσης και διακοπή των ελέγχων ασφαλείας εντός του περιβάλλοντος.

### `fms:PutProtocolsList`, `fms:DeleteProtocolsList`

Ένας επιτιθέμενος με τις άδειες **`fms:PutProtocolsList`** και **`fms:DeleteProtocolsList`** θα μπορούσε να δημιουργήσει, να τροποποιήσει ή να διαγράψει λίστες πρωτοκόλλων από το AWS Firewall Manager. Παρομοίως με τις λίστες εφαρμογών, αυτό θα μπορούσε να είναι κρίσιμο καθώς μη εξουσιοδοτημένα πρωτόκολλα θα μπορούσαν να χρησιμοποιηθούν από το ευρύ κοινό, ή η χρήση εξουσιοδοτημένων πρωτοκόλλων θα μπορούσε να απαγορευτεί, προκαλώντας DoS.
```bash
aws fms put-protocols-list --apps-list <value> [--tag-list <value>]
aws fms delete-protocols-list --list-id <value>
```
**Πιθανή Επίπτωση:** Αυτό θα μπορούσε να οδηγήσει σε λανθασμένες ρυθμίσεις, αποφυγή πολιτικών, παραβιάσεις συμμόρφωσης και διακοπή των ελέγχων ασφαλείας εντός του περιβάλλοντος.

### `fms:PutNotificationChannel`, `fms:DeleteNotificationChannel`

Ένας επιτιθέμενος με τις άδειες **`fms:PutNotificationChannel`** και **`fms:DeleteNotificationChannel`** θα μπορούσε να διαγράψει και να ορίσει τον ρόλο IAM και το θέμα Amazon Simple Notification Service (SNS) που χρησιμοποιεί το Firewall Manager για την καταγραφή των αρχείων καταγραφής SNS.

Για να χρησιμοποιήσετε το **`fms:PutNotificationChannel`** εκτός της κονσόλας, πρέπει να ρυθμίσετε την πολιτική πρόσβασης του θέματος SNS, επιτρέποντας στον καθορισμένο **SnsRoleName** να δημοσιεύει αρχεία καταγραφής SNS. Εάν ο παρεχόμενος **SnsRoleName** είναι ρόλος άλλος από τον **`AWSServiceRoleForFMS`**, απαιτείται μια σχέση εμπιστοσύνης που να επιτρέπει στον κύριο υπηρεσίας Firewall Manager **fms.amazonaws.com** να αναλάβει αυτόν τον ρόλο.

Για πληροφορίες σχετικά με τη ρύθμιση μιας πολιτικής πρόσβασης SNS:

{% content-ref url="../aws-services/aws-sns-enum.md" %}
[aws-sns-enum.md](../aws-services/aws-sns-enum.md)
{% endcontent-ref %}
```bash
aws fms put-notification-channel --sns-topic-arn <value> --sns-role-name <value>
aws fms delete-notification-channel
```
**Πιθανός Αντίκτυπος:** Αυτό θα μπορούσε να οδηγήσει σε απώλεια ειδοποιήσεων ασφαλείας, καθυστερημένη απόκριση σε περιστατικά, πιθανές παραβιάσεις δεδομένων και λειτουργικές διακοπές στο περιβάλλον.

### `fms:AssociateThirdPartyFirewall`, `fms:DisssociateThirdPartyFirewall`
Ένας επιτιθέμενος με τις άδειες **`fms:AssociateThirdPartyFirewall`**, **`fms:DisssociateThirdPartyFirewall`** θα μπορούσε να συνδέσει ή να αποσυνδέσει τρίτους firewalls από τη διαχείριση κεντρικά μέσω AWS Firewall Manager.
{% hint style="warning" %}
Μόνο ο προεπιλεγμένος διαχειριστής μπορεί να δημιουργήσει και να διαχειριστεί τρίτους firewalls.
{% endhint %}
```bash
aws fms associate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
aws fms disassociate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
```
**Πιθανός Αντίκτυπος:** Η αποσύνδεση θα οδηγούσε σε αποφυγή πολιτικής, παραβιάσεις συμμόρφωσης και διακοπή των ελέγχων ασφαλείας εντός του περιβάλλοντος. Η σύνδεση, από την άλλη πλευρά, θα οδηγούσε σε διακοπή του κόστους και της κατανομής του προϋπολογισμού.

### `fms:TagResource`, `fms:UntagResource`

Ένας επιτιθέμενος θα μπορούσε να προσθέσει, να τροποποιήσει ή να αφαιρέσει ετικέτες από πόρους του Firewall Manager, διαταράσσοντας την κατανομή κόστους, την παρακολούθηση πόρων και τις πολιτικές ελέγχου πρόσβασης της οργάνωσής σας που βασίζονται σε ετικέτες.
```bash
aws fms tag-resource --resource-arn <value> --tag-list <value>
aws fms untag-resource --resource-arn <value> --tag-keys <value>
```
**Πιθανή Επίπτωση**: Διακοπή της κατανομής κόστους, παρακολούθησης πόρων και πολιτικών ελέγχου πρόσβασης βάσει ετικετών.

## Αναφορές

* [https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html](https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list_awsfirewallmanager.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_awsfirewallmanager.html)
* [https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html](https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html)

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Δείτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Γίνετε μέλος της** 💬 [**ομάδας Discord**](https://discord.gg/hRep4RUj7f) ή της [**ομάδας telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}
