# AWS - STS Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahramana kadar AWS hacklemeyi öğrenin!</summary>

HackTricks'i desteklemenin diğer yolları:

- **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
- [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
- [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
- 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'da **takip edin**.
- **Hacking püf noktalarınızı paylaşarak PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>

## STS

**AWS Güvenlik Token Hizmeti (STS)** genellikle **geçici, sınırlı ayrıcalıklı kimlik bilgileri** vermek için tasarlanmıştır. Bu kimlik bilgileri, **AWS Kimlik ve Erişim Yönetimi (IAM)** kullanıcıları veya doğrulanmış kullanıcılar (federasyon kullanıcıları) için istenebilir.

STS'nin amacının **kimlik taklit için kimlik bilgileri vermek** olduğu göz önüne alındığında, hizmet, **ayrıcalıkları yükseltmek ve kalıcılığı sürdürmek** için son derece değerlidir, ancak geniş bir seçenek yelpazesine sahip olmayabilir.

### Rol Taklidi

AWS STS tarafından sağlanan [AssumeRole](https://docs.aws.amazon.com/STS/latest/APIReference/API\_AssumeRole.html) eylemi, bir prensibin başka bir prensip için kimlik bilgileri almasına izin veren kritik bir eylemdir, temelde onları taklit eder. Çağrıldığında, belirtilen ARN'ye karşılık gelen bir erişim anahtar kimliği, gizli anahtar ve oturum belirteci ile yanıt verir.

Sızma Testçileri veya Kırmızı Takım üyeleri için bu teknik, ayrıcalık yükseltme için önemlidir (burada ayrıntılı olarak açıklanmıştır [**burada**](../aws-privilege-escalation/aws-sts-privesc.md#sts-assumerole)). Ancak, bu teknik oldukça göze çarpan ve saldırganı hazırlıksız yakalayamayabilir.

#### Rolü Assume Etme Mantığı

Aynı hesapta bir rolü assume etmek için **assume edilecek rol özellikle bir rol ARN'sine izin veriyorsa** gibi:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:role/priv-role"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```
Bu durumda **`priv-role`** rolünün, o rolü üstlenmesine özellikle izin verilmesine **gerek yoktur** (bu izin yeterlidir).

Ancak, bir rolün bir hesabın onu üstlenmesine izin veriyorsa, örneğin:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:root"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```
Rolü almaya çalışan rolün, onu **almak için belirli bir `sts:AssumeRole` iznine** ihtiyacı olacak.

Farklı bir hesaptan bir **rolü** almaya çalışırsanız, **alınan rolün buna izin vermesi gerekir** (rol **ARN**'sini veya **harici hesabı** belirterek), ve **almaya çalışan rolün** diğerini **almak için izinlere sahip OLMASI GEREKİR** (bu durumda alınan rol bir ARN belirtse bile bu isteğe bağlı değildir).

### Numaralandırma
```bash
# Get basic info of the creds
aws sts get-caller-identity
aws sts get-access-key-info --access-key-id <AccessKeyID>

# Get CLI a session token with current creds
## Using CLI creds
## You cannot get session creds using session creds
aws sts get-session-token
## MFA
aws sts get-session-token --serial-number <arn_device> --token-code <otp_code>
```
### İst Privileges

Aşağıdaki sayfada **yetkileri yükseltmek için STS izinlerini kötüye kullanma** yöntemlerini kontrol edebilirsiniz:

{% content-ref url="../aws-privilege-escalation/aws-sts-privesc.md" %}
[aws-sts-privesc.md](../aws-privilege-escalation/aws-sts-privesc.md)
{% endcontent-ref %}

### Saldırı Sonrası İşlemler

{% content-ref url="../aws-post-exploitation/aws-sts-post-exploitation.md" %}
[aws-sts-post-exploitation.md](../aws-post-exploitation/aws-sts-post-exploitation.md)
{% endcontent-ref %}

### Kalıcılık

{% content-ref url="../aws-persistence/aws-sts-persistence.md" %}
[aws-sts-persistence.md](../aws-persistence/aws-sts-persistence.md)
{% endcontent-ref %}

## Referanslar

* [https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist](https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist)

<details>

<summary><strong>Sıfırdan kahraman olana kadar AWS hacklemeyi öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'da takip edin.**
* **Hacking püf noktalarınızı paylaşarak PR'ler göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
