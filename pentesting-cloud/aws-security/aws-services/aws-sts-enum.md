# AWS - STS Απαρίθμηση

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε** στην 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα τηλεγραφήματος**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs** στα [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## STS

**Η Υπηρεσία Κατάστασης Καταχώρησης Ασφάλειας του AWS (STS)** είναι κυρίως σχεδιασμένη για την έκδοση **προσωρινών, περιορισμένων δικαιωμάτων**. Αυτά τα διαπιστευτήρια μπορούν να ζητηθούν για **χρήστες Διαχείρισης Ταυτότητας και Πρόσβασης (IAM)** ή για πιστοποιημένους χρήστες (εξωτερικούς χρήστες).

Δεδομένου ότι ο σκοπός του STS είναι να **εκδίδει διαπιστευτήρια για την υποκλοπή ταυτότητας**, η υπηρεσία είναι απίστευτα χρήσιμη για **ανάδειξη προνομίων και διατήρηση επιμονής**, ακόμη κι αν δεν έχει μια ευρεία γκάμα επιλογών.

### Υποκλοπή Ρόλου Υποκλοπής

Η ενέργεια [AssumeRole](https://docs.aws.amazon.com/STS/latest/APIReference/API\_AssumeRole.html) που παρέχεται από το AWS STS είναι κρίσιμη καθώς επιτρέπει σε έναν αρχέτυπο να αποκτήσει διαπιστευτήρια για έναν άλλο αρχέτυπο, ουσιαστικά υποκλοπή του. Κατά την εκκίνηση, απαντά με ένα αναγνωριστικό κλειδιού πρόσβασης, ένα μυστικό κλειδί και ένα διακριτικό συνεδρίας που αντιστοιχούν στο συγκεκριμένο ARN.

Για Ελεγκτές Διείσδυσης ή μέλη Ερυθράς Ομάδας, αυτή η τεχνική είναι ουσιώδης για την ανάδειξη προνομίων (όπως αναλύεται [**εδώ**](../aws-privilege-escalation/aws-sts-privesc.md#sts-assumerole)). Ωστόσο, αξίζει να σημειωθεί ότι αυτή η τεχνική είναι αρκετά εμφανής και ενδέχεται να μην εκπλήξει έναν εισβολέα.
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:role/priv-role"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```
Ο ρόλος **`priv-role`** σε αυτήν την περίπτωση, **δεν χρειάζεται να επιτραπεί ειδικά** να υιοθετήσει αυτόν τον ρόλο (η άδεια αυτή είναι αρκετή).

Ωστόσο, αν ένας ρόλος επιτρέπει σε ένα λογαριασμό να τον υιοθετήσει, όπως στο:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:root"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```
Ο ρόλος που προσπαθεί να υιοθετήσει θα χρειαστεί μια **συγκεκριμένη άδεια `sts:AssumeRole`** πάνω σε αυτόν τον ρόλο **για να τον υιοθετήσει**.

Εάν προσπαθήσετε να υιοθετήσετε ένα **ρόλο** **από διαφορετικό λογαριασμό**, ο **υιοθετημένος ρόλος πρέπει να το επιτρέπει** (δηλώνοντας το ARN του ρόλου ή τον **εξωτερικό λογαριασμό**), και ο **ρόλος που προσπαθεί να υιοθετήσει** τον άλλο **ΠΡΕΠΕΙ** να **έχει άδειες για να τον υιοθετήσει** (σε αυτήν την περίπτωση αυτό δεν είναι προαιρετικό ακόμα κι αν ο υιοθετημένος ρόλος καθορίζει ένα ARN).

### Απαρίθμηση
```bash
# Get basic info of the creds
aws sts get-caller-identity
aws sts get-access-key-info --access-key-id <AccessKeyID>

# Get CLI a session token with current creds
## Using CLI creds
## You cannot get session creds using session creds
aws sts get-session-token
## MFA
aws sts get-session-token --serial-number <arn_device> --token-code <otp_code>
```
### Ανύψωση Δικαιωμάτων

Στην παρακάτω σελίδα μπορείτε να ελέγξετε πώς να **καταχραστείτε τα δικαιώματα STS για ανύψωση δικαιωμάτων**:

{% content-ref url="../aws-privilege-escalation/aws-sts-privesc.md" %}
[aws-sts-privesc.md](../aws-privilege-escalation/aws-sts-privesc.md)
{% endcontent-ref %}

### Μετά την Εκμετάλλευση

{% content-ref url="../aws-post-exploitation/aws-sts-post-exploitation.md" %}
[aws-sts-post-exploitation.md](../aws-post-exploitation/aws-sts-post-exploitation.md)
{% endcontent-ref %}

### Διατήρηση

{% content-ref url="../aws-persistence/aws-sts-persistence.md" %}
[aws-sts-persistence.md](../aws-persistence/aws-sts-persistence.md)
{% endcontent-ref %}

## Αναφορές

* [https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist](https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist)

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας διαφημισμένη στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**Την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε** στην 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα τηλεγραφήματος**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs** στα [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο GitHub.

</details>
