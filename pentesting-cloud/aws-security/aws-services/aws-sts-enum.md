# AWS - STS Enum

{% hint style="success" %}
Jifunze na kufanya mazoezi ya AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze na kufanya mazoezi ya GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mipango ya usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## STS

**AWS Security Token Service (STS)** kimsingi imeundwa kutoa **vitambulisho vya muda, vyenye upendeleo mdogo**. Vitambulisho hivi vinaweza kuombwa kwa **watumiaji wa AWS Identity and Access Management (IAM)** au kwa watumiaji waliothibitishwa (watumiaji waliounganishwa).

Kwa kuwa lengo la STS ni **kutoa vitambulisho kwa kuiga utambulisho**, huduma hii ni muhimu sana kwa **kuongeza upendeleo na kudumisha uthabiti**, ingawa inaweza isiwe na chaguo nyingi.

### Assume Role Impersonation

Kitendo cha [AssumeRole](https://docs.aws.amazon.com/STS/latest/APIReference/API\_AssumeRole.html) kinachotolewa na AWS STS ni muhimu kwani kinamruhusu mhusika kupata vitambulisho vya mhusika mwingine, kimsingi kuiga wao. Baada ya kuitwa, inajibu na kitambulisho cha ufunguo wa ufikiaji, ufunguo wa siri, na tokeni ya kikao inayolingana na ARN maalum.

Kwa Wataalamu wa Penetration au wanachama wa Red Team, mbinu hii ni muhimu kwa kuongeza upendeleo (kama ilivyoelezwa [**hapa**](../aws-privilege-escalation/aws-sts-privesc.md#sts-assumerole)). Hata hivyo, ni vyema kutambua kuwa mbinu hii ni dhahiri sana na inaweza isiwashitue wavamizi.

#### Assume Role Logic

Ili kuchukua jukumu katika akaunti hiyo hiyo ikiwa **jukumu la kuchukua linakubali hasa ARN ya jukumu** kama katika:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:role/priv-role"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```
The role **`priv-role`** katika kesi hii, **haitaji kuruhusiwa maalum** kuchukua jukumu hilo (kwa ruhusa hiyo inatosha).

Hata hivyo, kama jukumu linavyoruhusu akaunti kuchukua, kama katika:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:root"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```
The role inayojaribu kuichukua itahitaji **ruhusa maalum ya `sts:AssumeRole`** juu ya hiyo role **ili kuichukua**.

Ukijaribu kuchukua **role** **kutoka akaunti tofauti**, **role iliyochukuliwa lazima iruhusu** (ikionyesha role **ARN** au **akaunti ya nje**), na **role inayojaribu kuchukua** nyingine **LAZIMA** iwe na **ruhusa za kuichukua** (katika kesi hii hii si hiari hata kama role iliyochukuliwa inabainisha ARN).

### Enumeration
```bash
# Get basic info of the creds
aws sts get-caller-identity
aws sts get-access-key-info --access-key-id <AccessKeyID>

# Get CLI a session token with current creds
## Using CLI creds
## You cannot get session creds using session creds
aws sts get-session-token
## MFA
aws sts get-session-token --serial-number <arn_device> --token-code <otp_code>
```
### Privesc

Katika ukurasa ufuatao unaweza kuangalia jinsi ya **kutumia vibaya ruhusa za STS ili kuongeza marupurupu**:

{% content-ref url="../aws-privilege-escalation/aws-sts-privesc.md" %}
[aws-sts-privesc.md](../aws-privilege-escalation/aws-sts-privesc.md)
{% endcontent-ref %}

### Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-sts-post-exploitation.md" %}
[aws-sts-post-exploitation.md](../aws-post-exploitation/aws-sts-post-exploitation.md)
{% endcontent-ref %}

### Persistence

{% content-ref url="../aws-persistence/aws-sts-persistence.md" %}
[aws-sts-persistence.md](../aws-persistence/aws-sts-persistence.md)
{% endcontent-ref %}

## References

* [https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist](https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist)

{% hint style="success" %}
Jifunze na fanya mazoezi ya AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze na fanya mazoezi ya GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mipango ya usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
{% endhint %}
