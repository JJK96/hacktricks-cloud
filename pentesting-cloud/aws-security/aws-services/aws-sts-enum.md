# AWS - STS Enum

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## STS

**Huduma ya Kitambulisho cha Usalama cha AWS (STS)** imeundwa kimsingi kutoa **vitambulisho vya muda na vya kikomo**. Vitambulisho hivi vinaweza kuombwa kwa watumiaji wa **Usimamizi wa Kitambulisho na Upatikanaji wa AWS (IAM)** au kwa watumiaji waliothibitishwa (watumiaji waliounganishwa).

Kwa kuwa lengo la STS ni **kutoa vitambulisho kwa udanganyifu wa kitambulisho**, huduma hii ni ya thamani kubwa kwa **kuinua mamlaka na kudumisha uthabiti**, ingawa inaweza isiwe na chaguzi nyingi.

### Udanganyifu wa Kudai Jukumu

Hatua ya [AssumeRole](https://docs.aws.amazon.com/STS/latest/APIReference/API\_AssumeRole.html) inayotolewa na AWS STS ni muhimu kwani inaruhusu mwakilishi kupata vitambulisho kwa mwakilishi mwingine, kimsingi kujifanya kuwa wao. Kwa kuita, inajibu na kitambulisho cha ufikiaji cha ID, kitufe cha siri, na ishara ya kikao inayolingana na ARN iliyotajwa.

Kwa Wapenyezaji au wanachama wa Timu Nyekundu, mbinu hii ni muhimu kwa kuinua mamlaka (kama ilivyoelezwa [**hapa**](../aws-privilege-escalation/aws-sts-privesc.md#sts-assumerole)). Walakini, ni muhimu kutambua kuwa mbinu hii inaonekana wazi na inaweza isiweze kumshangaza mshambuliaji.

#### Mantiki ya Kudai Jukumu

Ili kudai jukumu katika akaunti ile ile ikiwa **jukumu la kudai linaruhusu hasa ARN ya jukumu** kama vile:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:role/priv-role"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```
Jukumu **`priv-role`** katika kesi hii, **hakuhitaji kuwezeshwa kwa kipekee** kuchukua jukumu hilo (kwa idhini hiyo ya kutosha). 

Hata hivyo, ikiwa jukumu linaruhusu akaunti kuchukua jukumu hilo, kama ifuatavyo:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:root"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```
Jukumu linalojaribu kuchukua litahitaji **ruhusa maalum ya `sts:AssumeRole`** juu ya jukumu hilo **ili kulichukua**.

Ikiwa unajaribu kuchukua **jukumu** **kutoka kwenye akaunti tofauti**, **jukumu lililochukuliwa lazima liiruhusu** hilo (ikiashiria **ARN** ya jukumu au **akaunti ya nje**), na **jukumu linalojaribu kuchukua** lingine **LAZIMA** liwe na ruhusa ya **kulichukua** (katika kesi hii hata kama jukumu lililochukuliwa linataja ARN).
```bash
# Get basic info of the creds
aws sts get-caller-identity
aws sts get-access-key-info --access-key-id <AccessKeyID>

# Get CLI a session token with current creds
## Using CLI creds
## You cannot get session creds using session creds
aws sts get-session-token
## MFA
aws sts get-session-token --serial-number <arn_device> --token-code <otp_code>
```
### Privesc

Kwenye ukurasa ufuatao unaweza kuangalia jinsi ya **kutumia vibali vya STS kwa kusudi la kuinua mamlaka**:

{% content-ref url="../aws-privilege-escalation/aws-sts-privesc.md" %}
[aws-sts-privesc.md](../aws-privilege-escalation/aws-sts-privesc.md)
{% endcontent-ref %}

### Baada ya Kudukua

{% content-ref url="../aws-post-exploitation/aws-sts-post-exploitation.md" %}
[aws-sts-post-exploitation.md](../aws-post-exploitation/aws-sts-post-exploitation.md)
{% endcontent-ref %}

### Uthabiti

{% content-ref url="../aws-persistence/aws-sts-persistence.md" %}
[aws-sts-persistence.md](../aws-persistence/aws-sts-persistence.md)
{% endcontent-ref %}

## Marejeo

* [https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist](https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist)

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
