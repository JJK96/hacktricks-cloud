# AWS - VPC & Networking Basic Information

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## AWS Networking in a Nutshell

A **VPC** contains a **network CIDR** like 10.0.0.0/16 (with its **routing table** and **network ACL**).

рдпрд╣ VPC рдиреЗрдЯрд╡рд░реНрдХ **рдЙрдкрдиреЗрдЯрд╡рд░реНрдХ** рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рд╣реИ, рдЗрд╕рд▓рд┐рдП рдПрдХ **рдЙрдкрдиреЗрдЯрд╡рд░реНрдХ** рд╕реАрдзреЗ **VPC**, **рд░реВрдЯрд┐рдВрдЧ** **рдЯреЗрдмрд▓** рдФрд░ **рдиреЗрдЯрд╡рд░реНрдХ ACL** рд╕реЗ **рд╕рдВрдмрдВрдзрд┐рдд** рд╣реИред

рдлрд┐рд░, **рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлреЗрд╕** рдЬреЛ рд╕реЗрд╡рд╛рдУрдВ (рдЬреИрд╕реЗ EC2 рдЙрджрд╛рд╣рд░рдг) рд╕реЗ рдЬреБрдбрд╝реЗ рд╣реЛрддреЗ рд╣реИрдВ, **рдЙрдкрдиреЗрдЯрд╡рд░реНрдХ** рд╕реЗ **рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣реЛрдВ** рдХреЗ рд╕рд╛рде **рдЬреБрдбрд╝реЗ** рд╣реЛрддреЗ рд╣реИрдВред

рдЗрд╕рд▓рд┐рдП, рдПрдХ **рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣** рдиреЗрдЯрд╡рд░реНрдХ **рдЗрдВрдЯрд░рдлреЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп** рдЙрдЬрд╛рдЧрд░ рдкреЛрд░реНрдЯ рдХреЛ рд╕реАрдорд┐рдд рдХрд░реЗрдЧрд╛, **рдЙрдкрдиреЗрдЯрд╡рд░реНрдХ рд╕реЗ рд╕реНрд╡рддрдВрддреНрд░**ред рдФрд░ рдПрдХ **рдиреЗрдЯрд╡рд░реНрдХ ACL** **рдкреВрд░реЗ рдиреЗрдЯрд╡рд░реНрдХ** рдХреЗ рд▓рд┐рдП рдЙрдЬрд╛рдЧрд░ рдкреЛрд░реНрдЯ рдХреЛ **рд╕реАрдорд┐рдд** рдХрд░реЗрдЧрд╛ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **рдЗрдВрдЯрд░рдиреЗрдЯ** рддрдХ **рдкрд╣реБрдБрдЪрдиреЗ** рдХреЗ рд▓рд┐рдП, рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЬрд╛рдВрдЪрдирд╛ рд╣реИ:

* рдПрдХ **рдЙрдкрдиреЗрдЯрд╡рд░реНрдХ** **рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ IPv4 рдкрддреЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЕрд╕рд╛рдЗрди рдХрд░ рд╕рдХрддрд╛ рд╣реИ**
* рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ **рдмрдирд╛рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг** рдХреЛ **IPv4 рдкрддреЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЕрд╕рд╛рдЗрди** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ
* рдПрдХ **рдЗрдВрдЯрд░рдиреЗрдЯ рдЧреЗрдЯрд╡реЗ** рдХреЛ **VPC** рд╕реЗ **рдЬреБрдбрд╝рд╛** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП
* рдЖрдк **Egress-only рдЗрдВрдЯрд░рдиреЗрдЯ рдЧреЗрдЯрд╡реЗ** рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ
* рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ **NAT рдЧреЗрдЯрд╡реЗ** рдПрдХ **рдирд┐рдЬреА рдЙрдкрдиреЗрдЯ** рдореЗрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЙрд╕ рдирд┐рдЬреА рдЙрдкрдиреЗрдЯ рд╕реЗ **рдмрд╛рд╣рд░реА рд╕реЗрд╡рд╛рдУрдВ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдирд╛** рд╕рдВрднрд╡ рд╣реЛ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ **рдмрд╛рд╣рд░ рд╕реЗ рдкрд╣реБрдБрдЪрдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ**ред
* NAT рдЧреЗрдЯрд╡реЗ **рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ** (рдЗрдВрдЯрд░рдиреЗрдЯ рддрдХ рдкрд╣реБрдБрдЪ) рдпрд╛ **рдирд┐рдЬреА** (рдЕрдиреНрдп VPCs рддрдХ рдкрд╣реБрдБрдЪ) рд╣реЛ рд╕рдХрддрд╛ рд╣реИ

![](<../../../../.gitbook/assets/image (274).png>)

## VPC

Amazon **Virtual Private Cloud** (Amazon VPC) рдЖрдкрдХреЛ **рдПрдХ рд╡рд░реНрдЪреБрдЕрд▓ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ AWS рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдкрдиреЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рд╣реИред рдЗрд╕ рд╡рд░реНрдЪреБрдЕрд▓ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдХрдИ рдЙрдкрдиреЗрдЯ, рдЗрдВрдЯрд░рдиреЗрдЯ рдЧреЗрдЯрд╡реЗ рдЗрдВрдЯрд░рдиреЗрдЯ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, ACLs, рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣, IPs...

### Subnets

рдЙрдкрдиреЗрдЯ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рдПрдХ рдЙрдЪреНрдЪ рд╕реНрддрд░ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддреЗ рд╣реИрдВред **рд╕рдорд╛рди рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХрд╛ рддрд╛рд░реНрдХрд┐рдХ рд╕рдореВрд╣** рдЖрдкрдХреЗ рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдВрдЪреЗ рдореЗрдВ **рдкреНрд░рдмрдВрдзрди рдореЗрдВ рдЖрд╕рд╛рдиреА** рдмрдирд╛рдП рд░рдЦрдиреЗ рдореЗрдВ рднреА рдорджрдж рдХрд░рддрд╛ рд╣реИред

* рдорд╛рдиреНрдп CIDR рдПрдХ /16 рдиреЗрдЯрдорд╛рд╕реНрдХ рд╕реЗ рд▓реЗрдХрд░ /28 рдиреЗрдЯрдорд╛рд╕реНрдХ рддрдХ рд╣реИрдВред
* рдПрдХ рдЙрдкрдиреЗрдЯ рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рдЙрдкрд▓рдмреНрдзрддрд╛ рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ред
* **AWS рдкреНрд░рддреНрдпреЗрдХ рдЙрдкрдиреЗрдЯ рдХреЗ рдкрд╣рд▓реЗ рддреАрди рд╣реЛрд╕реНрдЯ IP рдкрддреЗ** рдХреЛ **рдЖрдВрддрд░рд┐рдХ AWS рдЙрдкрдпреЛрдЧ** рдХреЗ рд▓рд┐рдП **рдЖрд░рдХреНрд╖рд┐рдд** рдХрд░рддрд╛ рд╣реИ: рдкрд╣рд▓рд╛ рд╣реЛрд╕реНрдЯ рдкрддрд╛ VPC рд░рд╛рдЙрдЯрд░ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рджреВрд╕рд░рд╛ рдкрддрд╛ AWS DNS рдХреЗ рд▓рд┐рдП рдЖрд░рдХреНрд╖рд┐рдд рд╣реИ рдФрд░ рддреАрд╕рд░рд╛ рдкрддрд╛ рднрд╡рд┐рд╖реНрдп рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдЖрд░рдХреНрд╖рд┐рдд рд╣реИред
* рдЙрдиреНрд╣реЗрдВ **рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЙрдкрдиреЗрдЯ** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рдирдХрд╛ **рдЗрдВрдЯрд░рдиреЗрдЯ рддрдХ рд╕реАрдзрд╛ рдкрд╣реБрдБрдЪ рд╣реИ, рдЬрдмрдХрд┐ рдирд┐рдЬреА рдЙрдкрдиреЗрдЯ рдХрд╛ рдирд╣реАрдВред**

<figure><img src="https://lh5.googleusercontent.com/N_WTrTrDAHwN61FMKJvLSHVua2EM0IazHH1fSTg8JQfTChm-dLN9mn7wkjz2MlpD-uOUqtWdMZpqKOp4VxaHy5-5X66GD1K8y1UGc27r-GbHdFty9ImpXdcjEsC7u4vjxKme_B_HwDOUnG6camxENYECTw=s2048" alt=""><figcaption></figcaption></figure>

<figure><img src="https://lh3.googleusercontent.com/MmjfVzGmV4jM7tO8lVoTKONoeqbq6E40DGeKUoo4kN-lmMDKnEiGNB-gGVx3EvjK9UV844im225CA8aAjomHf1Modt3MramHrHZdEGbeSZncWhVuT9R8f7tQZ2pXjdSJxeNfErmJ-0mmcUaV6dcU0TAd2A=s2048" alt=""><figcaption></figcaption></figure>

### Route Tables

Route tables рдПрдХ VPC рдХреЗ рднреАрддрд░ рдПрдХ рдЙрдкрдиреЗрдЯ рдХреЗ рд▓рд┐рдП рдЯреНрд░реИрдлрд╝рд┐рдХ рд░реВрдЯрд┐рдВрдЧ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред рд╡реЗ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рд╕рд╛ рдиреЗрдЯрд╡рд░реНрдХ рдЯреНрд░реИрдлрд╝рд┐рдХ рдЗрдВрдЯрд░рдиреЗрдЯ рдпрд╛ VPN рдХрдиреЗрдХреНрд╢рди рдХреА рдУрд░ рдЕрдЧреНрд░реЗрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЖрдк рдЖрдорддреМрд░ рдкрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрдХ рдкрд╣реБрдБрдЪ рдкрд╛рдПрдВрдЧреЗ:

* рд╕реНрдерд╛рдиреАрдп VPC
* NAT
* рдЗрдВрдЯрд░рдиреЗрдЯ рдЧреЗрдЯрд╡реЗ / Egress-only рдЗрдВрдЯрд░рдиреЗрдЯ рдЧреЗрдЯрд╡реЗ (рдЬреЛ VPC рдХреЛ рдЗрдВрдЯрд░рдиреЗрдЯ рддрдХ рдкрд╣реБрдБрдЪ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВ)ред
* рдПрдХ рдЙрдкрдиреЗрдЯ рдХреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЕрдкрдиреЗ VPC рдореЗрдВ рдПрдХ **рдЗрдВрдЯрд░рдиреЗрдЯ рдЧреЗрдЯрд╡реЗ** **рдмрдирд╛рдирд╛** рдФрд░ **рдЬреЛрдбрд╝рдирд╛** рд╣реЛрдЧрд╛ред
* VPC рдПрдВрдбрдкреЙрдЗрдВрдЯ (рдирд┐рдЬреА рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗ S3 рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП)

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЫрд╡рд┐рдпреЛрдВ рдореЗрдВ рдЖрдк рдПрдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рдФрд░ рдПрдХ рдирд┐рдЬреА рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдмреАрдЪ рдХреЗ рдЕрдВрддрд░ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:

<figure><img src="https://lh3.googleusercontent.com/q4ASpcLAYqijdNMLhMLl8EoowDtTMU5I_7YCVfk7-5hxDyeQOik9ImHnD2SYy32XUA2qXjEbXTAxA1lP--znJASdhYOdBveDcrD42f9XBKZ3EmjJCazN3YPLC6oS0xtRMmfORuwCszmMt-KrAkH07_izwg=s2048" alt=""><figcaption></figcaption></figure>

<figure><img src="https://lh5.googleusercontent.com/30psylXAI0gRN6_LK-reP00aGIlMma64E1qafCVPunn6nS-y5jAO6Y2JiempKcf6-LFi7ScicYcOh7BbHEya2VWtksnFX_8SPXQf97tKkg2tNZzrArWbiDCCn2m2LP1QUq6MZ_KayH3yir7t8zpO7CEQOw=s2048" alt=""><figcaption></figcaption></figure>

### ACLs

**рдиреЗрдЯрд╡рд░реНрдХ рдПрдХреНрд╕реЗрд╕ рдХрдВрдЯреНрд░реЛрд▓ рд╕реВрдЪрд┐рдпрд╛рдБ (ACLs)**: рдиреЗрдЯрд╡рд░реНрдХ ACLs рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдо рд╣реИрдВ рдЬреЛ рдПрдХ рдЙрдкрдиреЗрдЯ рдХреЗ рд▓рд┐рдП рдЖрдиреЗ рд╡рд╛рд▓реЗ рдФрд░ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдиреЗрдЯрд╡рд░реНрдХ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред рдЗрдиреНрд╣реЗрдВ рд╡рд┐рд╢рд┐рд╖реНрдЯ IP рдкрддреЗ рдпрд╛ рд░реЗрдВрдЬреЛрдВ рдХреЗ рд▓рд┐рдП рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдпрд╛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

* рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд╣реБрдБрдЪ рдХреЛ рдЕрдиреБрдорддрд┐/рдЕрд╕реНрд╡реАрдХреГрдд рдХрд░рдирд╛ рд╕рдмрд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд╕реНрдерд╛рдкрд┐рдд рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдХрд╛рдЯрдиреЗ рдХрд╛ рдПрдХрдорд╛рддреНрд░ рддрд░реАрдХрд╛ рд╣реИред рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣реЛрдВ рдореЗрдВ рд╕рдВрд╢реЛрдзрд┐рдд рдирд┐рдпрдо рдкрд╣рд▓реЗ рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдХреЛ рд░реЛрдХрддреЗ рдирд╣реАрдВ рд╣реИрдВ
* рд╣рд╛рд▓рд╛рдБрдХрд┐, рдпрд╣ рдкреВрд░реЗ рдЙрдкрдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЪреАрдЬрд╝реЛрдВ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рддреЗ рд╕рдордп рд╕рд╛рд╡рдзрд╛рди рд░рд╣реЗрдВ рдХреНрдпреЛрдВрдХрд┐ рдЖрд╡рд╢реНрдпрдХ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдкреНрд░рднрд╛рд╡рд┐рдд рд╣реЛ рд╕рдХрддреА рд╣реИ

### Security Groups

рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣ рдПрдХ рд╡рд░реНрдЪреБрдЕрд▓ **рдлрд╝рд╛рдпрд░рд╡реЙрд▓** рд╣реИрдВ рдЬреЛ VPC рдореЗрдВ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдЗрдирдмрд╛рдЙрдВрдб рдФрд░ рдЖрдЙрдЯрдмрд╛рдЙрдВрдб рдиреЗрдЯрд╡рд░реНрдХ **рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд** рдХрд░рддреЗ рд╣реИрдВред рд╕рдВрдмрдВрдз 1 SG рд╕реЗ M рдЙрджрд╛рд╣рд░рдгреЛрдВ (рдЖрдорддреМрд░ рдкрд░ 1 рд╕реЗ 1)ред\
рдЖрдорддреМрд░ рдкрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдореЗрдВ рдЦрддрд░рдирд╛рдХ рдкреЛрд░реНрдЯ рдЦреЛрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдкреЛрд░реНрдЯ 22:

<figure><img src="https://lh5.googleusercontent.com/LliB7eb3cYfkEyOpyw1-eYgWsn2kq1yF6uRn5VYndvOuTvDlURimYx9UvuK8F2impTLmx50mid4MdTXE-Ljt2i_rxaIfnKUdji_hFjCdU9tdoW-axng9-W4tSL71gbbjrPQ7IYY5lAdH_G3UoMRMGGGOxQ=s2048" alt=""><figcaption></figcaption></figure>

### Elastic IP Addresses

An _Elastic IP address_ is a **static IPv4 address** designed for dynamic cloud computing. An Elastic IP address is allocated to your AWS account, and is yours until you release it. By using an Elastic IP address, you can mask the failure of an instance or software by rapidly remapping the address to another instance in your account.

### Connection between subnets

By default, all subnets have the **automatic assigned of public IP addresses turned off** but it can be turned on.

**A local route within a route table enables communication between VPC subnets.**

рдпрджрд┐ рдЖрдк **рдПрдХ рдЙрдкрдиреЗрдЯ рдХреЛ рдПрдХ рдЕрд▓рдЧ рдЙрдкрдиреЗрдЯ рд╕реЗ рдЬреЛрдбрд╝ рд░рд╣реЗ рд╣реИрдВ рддреЛ рдЖрдк рдЕрдиреНрдп рдЙрдкрдиреЗрдЯ рд╕реЗ рдЬреБрдбрд╝реЗ рдЙрдкрдиреЗрдЯреНрд╕ рддрдХ рдкрд╣реБрдБрдЪ рдирд╣реАрдВ рд╕рдХрддреЗ**, рдЖрдкрдХреЛ рдЙрдирдХреЗ рд╕рд╛рде рд╕реАрдзреЗ рдХрдиреЗрдХреНрд╢рди рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ред **рдпрд╣ рдЗрдВрдЯрд░рдиреЗрдЯ рдЧреЗрдЯрд╡реЗ рдкрд░ рднреА рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ**ред рдЖрдк рдЗрдВрдЯрд░рдиреЗрдЯ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдкрдиреЗрдЯ рдХрдиреЗрдХреНрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд╣реАрдВ рдЬрд╛ рд╕рдХрддреЗ, рдЖрдкрдХреЛ рдЕрдкрдиреЗ рдЙрдкрдиреЗрдЯ рдореЗрдВ рдЗрдВрдЯрд░рдиреЗрдЯ рдЧреЗрдЯрд╡реЗ рдЕрд╕рд╛рдЗрди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

### VPC Peering

VPC рдкреАрдпрд░рд┐рдВрдЧ рдЖрдкрдХреЛ **рджреЛ рдпрд╛ рджреЛ рд╕реЗ рдЕрдзрд┐рдХ VPCs рдХреЛ рдПрдХ рд╕рд╛рде рдЬреЛрдбрд╝рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, IPV4 рдпрд╛ IPV6 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдЬреИрд╕реЗ рдХрд┐ рд╡реЗ рдПрдХ рд╣реА рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реЛрдВред

рдПрдХ рдмрд╛рд░ рдЬрдм рдкреАрдпрд░ рдХрдиреЗрдХреНрдЯрд┐рд╡рд┐рдЯреА рд╕реНрдерд╛рдкрд┐рдд рд╣реЛ рдЬрд╛рддреА рд╣реИ, рддреЛ **рдПрдХ VPC рдореЗрдВ рд╕рдВрд╕рд╛рдзрди рджреВрд╕рд░реЗ рдореЗрдВ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ**ред VPCs рдХреЗ рдмреАрдЪ рдХрдиреЗрдХреНрдЯрд┐рд╡рд┐рдЯреА рдореМрдЬреВрджрд╛ AWS рдиреЗрдЯрд╡рд░реНрдХ рдЕрд╡рд╕рдВрд░рдЪрдирд╛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓рд╛рдЧреВ рдХреА рдЬрд╛рддреА рд╣реИ, рдФрд░ рдЗрд╕рд▓рд┐рдП рдпрд╣ рдЙрдЪреНрдЪ рдЙрдкрд▓рдмреНрдзрддрд╛ рдХреЗ рд╕рд╛рде рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреЛрдИ рдмреИрдВрдбрд╡рд┐рдбреНрде рдмрд╛рдзрд╛ рдирд╣реАрдВ рд╣реЛрддреАред рдЪреВрдВрдХрд┐ **рдкреАрдпрд░реНрдб рдХрдиреЗрдХреНрд╢рди рдРрд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рд╡реЗ рдПрдХ рд╣реА рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реЛрдВ**, рдЖрдкрдХреЗ CIDR рдмреНрд▓реЙрдХ рд░реЗрдВрдЬ рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдХреБрдЫ рдкреНрд░рддрд┐рдмрдВрдз рд╣реИрдВред\
рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЕрдкрдиреЗ VPC рдХреЗ рд▓рд┐рдП **рдУрд╡рд░рд▓реИрдкрд┐рдВрдЧ рдпрд╛ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ CIDR** рд░реЗрдВрдЬ рд╣реИрдВ, рддреЛ **рдЖрдк VPCs рдХреЛ рдПрдХ рд╕рд╛рде рдкреАрдпрд░ рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗ**ред\
рдкреНрд░рддреНрдпреЗрдХ AWS VPC **рдХреЗрд╡рд▓ рдЕрдкрдиреЗ рдкреАрдпрд░ рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░реЗрдЧрд╛**ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ VPC 1 рдФрд░ VPC 2 рдХреЗ рдмреАрдЪ рдПрдХ рдкреАрдпрд░рд┐рдВрдЧ рдХрдиреЗрдХреНрд╢рди рд╣реИ, рдФрд░ VPC 2 рдФрд░ VPC 3 рдХреЗ рдмреАрдЪ рдПрдХ рдФрд░ рдХрдиреЗрдХреНрд╢рди рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ VPC 1 рдФрд░ 2 рдПрдХ-рджреВрд╕рд░реЗ рдХреЗ рд╕рд╛рде рд╕реАрдзреЗ рд╕рдВрд╡рд╛рдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ VPC 2 рдФрд░ VPC 3, рд╣рд╛рд▓рд╛рдБрдХрд┐, VPC 1 рдФрд░ VPC 3 рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред **рдЖрдк рдПрдХ VPC рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рджреВрд╕рд░реЗ рддрдХ рдкрд╣реБрдБрдЪ рдирд╣реАрдВ рд╕рдХрддреЗред**

### **VPC Flow Logs**

Within your VPC, you could potentially have hundreds or even thousands of resources all communicating between different subnets both public and private and also between different VPCs through VPC peering connections. **VPC Flow Logs allow you to capture IP traffic information that flows between your network interfaces of your resources within your VPC**.

Unlike S3 access logs and CloudFront access logs, the **log data generated by VPC Flow Logs is not stored in S3. Instead, the log data captured is sent to CloudWatch logs**.

Limitations:

* If you are running a VPC peered connection, then you'll only be able to see flow logs of peered VPCs that are within the same account.
* If you are still running resources within the EC2-Classic environment, then unfortunately you are not able to retrieve information from their interfaces
* Once a VPC Flow Log has been created, it cannot be changed. To alter the VPC Flow Log configuration, you need to delete it and then recreate a new one.
* The following traffic is not monitored and captured by the logs. DHCP traffic within the VPC, traffic from instances destined for the Amazon DNS Server.
* Any traffic destined to the IP address for the VPC default router and traffic to and from the following addresses, 169.254.169.254 which is used for gathering instance metadata, and 169.254.169.123 which is used for the Amazon Time Sync Service.
* Traffic relating to an Amazon Windows activation license from a Windows instance
* Traffic between a network load balancer interface and an endpoint network interface

For every network interface that publishes data to the CloudWatch log group, it will use a different log stream. And within each of these streams, there will be the flow log event data that shows the content of the log entries. Each of these **logs captures data during a window of approximately 10 to 15 minutes**.

## VPN

### Basic AWS VPN Components

1. **Customer Gateway**:
* A Customer Gateway is a resource that you create in AWS to represent your side of a VPN connection.
* It is essentially a physical device or software application on your side of the Site-to-Site VPN connection.
* You provide routing information and the public IP address of your network device (such as a router or a firewall) to AWS to create a Customer Gateway.
* It serves as a reference point for setting up the VPN connection and doesn't incur additional charges.
2. **Virtual Private Gateway**:
* A Virtual Private Gateway (VPG) is the VPN concentrator on the Amazon side of the Site-to-Site VPN connection.
* It is attached to your VPC and serves as the target for your VPN connection.
* VPG is the AWS side endpoint for the VPN connection.
* It handles the secure communication between your VPC and your on-premises network.
3. **Site-to-Site VPN Connection**:
* A Site-to-Site VPN connection connects your on-premises network to a VPC through a secure, IPsec VPN tunnel.
* This type of connection requires a Customer Gateway and a Virtual Private Gateway.
* It's used for secure, stable, and consistent communication between your data center or network and your AWS environment.
* Typically used for regular, long-term connections and is billed based on the amount of data transferred over the connection.
4. **Client VPN Endpoint**:
* A Client VPN endpoint is a resource that you create in AWS to enable and manage client VPN sessions.
* It is used for allowing individual devices (like laptops, smartphones, etc.) to securely connect to AWS resources or your on-premises network.
* It differs from Site-to-Site VPN in that it is designed for individual clients rather than connecting entire networks.
* With Client VPN, each client device uses a VPN client software to establish a secure connection.

### Site-to-Site VPN

**Connect your on premisses network with your VPC.**

* **VPN connection**: A secure connection between your on-premises equipment and your VPCs.
*   **VPN tunnel**: An encrypted link where data can pass from the customer network to or from AWS.

Each VPN connection includes two VPN tunnels which you can simultaneously use for high availability.
* **Customer gateway**: An AWS resource which provides information to AWS about your customer gateway device.
* **Customer gateway device**: A physical device or software application on your side of the Site-to-Site VPN connection.
* **Virtual private gateway**: The VPN concentrator on the Amazon side of the Site-to-Site VPN connection. You use a virtual private gateway or a transit gateway as the gateway for the Amazon side of the Site-to-Site VPN connection.
* **Transit gateway**: A transit hub that can be used to interconnect your VPCs and on-premises networks. You use a transit gateway or virtual private gateway as the gateway for the Amazon side of the Site-to-Site VPN connection.

#### Limitations

* IPv6 traffic is not supported for VPN connections on a virtual private gateway.
* An AWS VPN connection does not support Path MTU Discovery.

In addition, take the following into consideration when you use Site-to-Site VPN.

* When connecting your VPCs to a common on-premises network, we recommend that you use non-overlapping CIDR blocks for your networks.

### Client VPN <a href="#what-is-components" id="what-is-components"></a>

**Connect from your machine to your VPC**

#### Concepts

* **Client VPN endpoint:** The resource that you create and configure to enable and manage client VPN sessions. It is the resource where all client VPN sessions are terminated.
* **Target network:** A target network is the network that you associate with a Client VPN endpoint. **A subnet from a VPC is a target network**. Associating a subnet with a Client VPN endpoint enables you to establish VPN sessions. You can associate multiple subnets with a Client VPN endpoint for high availability. All subnets must be from the same VPC. Each subnet must belong to a different Availability Zone.
* **Route**: Each Client VPN endpoint has a route table that describes the available destination network routes. Each route in the route table specifies the path for traffic to specific resources or networks.
* **Authorization rules:** An authorization rule **restricts the users who can access a network**. For a specified network, you configure the Active Directory or identity provider (IdP) group that is allowed access. Only users belonging to this group can access the specified network. **By default, there are no authorization rules** and you must configure authorization rules to enable users to access resources and networks.
* **Client:** The end user connecting to the Client VPN endpoint to establish a VPN session. End users need to download an OpenVPN client and use the Client VPN configuration file that you created to establish a VPN session.
* **Client CIDR range:** An IP address range from which to assign client IP addresses. Each connection to the Client VPN endpoint is assigned a unique IP address from the client CIDR range. You choose the client CIDR range, for example, `10.2.0.0/16`.
* **Client VPN ports:** AWS Client VPN supports ports 443 and 1194 for both TCP and UDP. The default is port 443.
* **Client VPN network interfaces:** When you associate a subnet with your Client VPN endpoint, we create Client VPN network interfaces in that subnet. **Traffic that's sent to the VPC from the Client VPN endpoint is sent through a Client VPN network interface**. Source network address translation (SNAT) is then applied, where the source IP address from the client CIDR range is translated to the Client VPN network interface IP address.
* **Connection logging:** You can enable connection logging for your Client VPN endpoint to log connection events. You can use this information to run forensics, analyze how your Client VPN endpoint is being used, or debug connection issues.
* **Self-service portal:** You can enable a self-service portal for your Client VPN endpoint. Clients can log into the web-based portal using their credentials and download the latest version of the Client VPN endpoint configuration file, or the latest version of the AWS provided client.

#### Limitations

* **Client CIDR ranges cannot overlap with the local CIDR** of the VPC in which the associated subnet is located, or any routes manually added to the Client VPN endpoint's route table.
* Client CIDR ranges must have a block size of at **least /22** and must **not be greater than /12.**
* A **portion of the addresses** in the client CIDR range are used to **support the availability** model of the Client VPN endpoint, and cannot be assigned to clients. Therefore, we recommend that you **assign a CIDR block that contains twice the number of IP addresses that are required** to enable the maximum number of concurrent connections that you plan to support on the Client VPN endpoint.
* The **client CIDR range cannot be changed** after you create the Client VPN endpoint.
* The **subnets** associated with a Client VPN endpoint **must be in the same VPC**.
* You **cannot associate multiple subnets from the same Availability Zone with a Client VPN endpoint**.
* A Client VPN endpoint **does not support subnet associations in a dedicated tenancy VPC**.
* Client VPN supports **IPv4** traffic only.
* Client VPN is **not** Federal Information Processing Standards (**FIPS**) **compliant**.
*   If multi-factor authentication (MFA) is disabled for your Active Directory, a user password cannot be in the following format.

```
SCRV1:<base64_encoded_string>:<base64_encoded_string>
```
* The self-service portal is **not available for clients that authenticate using mutual authentication**.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
