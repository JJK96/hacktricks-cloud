# AWS - VPC & Networking Basiese Inligting

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## AWS Netwerking in 'n Neutedop

'n **VPC** bevat 'n **netwerk CIDR** soos 10.0.0.0/16 (met sy **roeteringstabel** en **netwerk ACL**).

Hierdie VPC-netwerk is verdeel in **subnetwerke**, so 'n **subnetwerk** is direk **gekoppel** aan die **VPC**, **roeteringstabel** en **netwerk ACL**.

Dan is **Netwerk Koppelvlakke** wat aan dienste (soos EC2-instansies) geheg is, **gekoppel** aan die **subnetwerke** met **sekuriteitsgroep(e)**.

Daarom sal 'n **sekuriteitsgroep** die blootgestelde poorte van die netwerk **koppelvlakke wat dit gebruik** beperk, **onafhanklik van die subnetwerk**. En 'n **netwerk ACL** sal die blootgestelde poorte na die **hele netwerk** beperk.

Verder, om toegang tot die **Internet** te kry, is daar 'n paar interessante konfigurasies om na te kyk:

* 'n **Subnetwerk** kan **outomaties publieke IPv4-adresse toeken**
* 'n **Instansie** wat in die netwerk geskep is wat **outomaties IPv4-adresse toeken, kan een kry**
* 'n **Internet-gateway** moet aan die **VPC** geheg wees
* Jy kan ook **Egress-only internet gateways** gebruik
* Jy kan ook 'n **NAT-gateway** in 'n **privaat subnet** h√™ sodat dit moontlik is om **aan eksterne dienste te koppel** vanaf daardie privaat subnet, maar dit is **nie moontlik om hulle van buite af te bereik nie**.
* Die NAT-gateway kan **publiek** (toegang tot die internet) of **privaat** (toegang tot ander VPC's) wees

![](<../../../../.gitbook/assets/image (274).png>)

## VPC

Amazon **Virtual Private Cloud** (Amazon VPC) stel jou in staat om **AWS-hulpbronne in 'n virtuele netwerk te begin** wat jy gedefinieer het. Hierdie virtuele netwerk sal verskeie subnetwerke, Internet Gateways om toegang tot die Internet te kry, ACL's, Sekuriteitsgroepe, IP's h√™...

### Subnetwerke

Subnetwerke help om 'n groter vlak van sekuriteit af te dwing. **Logiese groepering van soortgelyke hulpbronne** help jou ook om 'n **maklike bestuur** oor jou infrastruktuur te handhaaf.

* Geldige CIDR is van 'n /16-netmasker tot 'n /28-netmasker.
* 'n Subnetwerk kan nie terselfdertyd in verskillende beskikbaarheidsones wees nie.
* **AWS behou die eerste drie gasheer-IP-adresse** van elke subnet **vir** **interne AWS-gebruik**: die eerste gasheeradres wat gebruik word, is vir die VPC-roeteerder. Die tweede adres is gereserveer vir AWS DNS en die derde adres is gereserveer vir toekomstige gebruik.
* Dit word **publieke subnetwerke** genoem vir diegene wat **direkte toegang tot die Internet het, terwyl private subnetwerke dit nie het nie.**

<figure><img src="https://lh5.googleusercontent.com/N_WTrTrDAHwN61FMKJvLSHVua2EM0IazHH1fSTg8JQfTChm-dLN9mn7wkjz2MlpD-uOUqtWdMZpqKOp4VxaHy5-5X66GD1K8y1UGc27r-GbHdFty9ImpXdcjEsC7u4vjxKme_B_HwDOUnG6camxENYECTw=s2048" alt=""><figcaption></figcaption></figure>

<figure><img src="https://lh3.googleusercontent.com/MmjfVzGmV4jM7tO8lVoTKONoeqbq6E40DGeKUoo4kN-lmMDKnEiGNB-gGVx3EvjK9UV844im225CA8aAjomHf1Modt3MramHrHZdEGbeSZncWhVuT9R8f7tQZ2pXjdSJxeNfErmJ-0mmcUaV6dcU0TAd2A=s2048" alt=""><figcaption></figcaption></figure>

### Roeteringstabelle

Roeteringstabelle bepaal die verkeersroetering vir 'n subnet binne 'n VPC. Hulle bepaal watter netwerkverkeer na die internet of na 'n VPN-verbinding gestuur word. Jy sal gewoonlik toegang vind tot die:

* Plaaslike VPC
* NAT
* Internet Gateways / Egress-only Internet gateways (nodig om 'n VPC toegang tot die Internet te gee).
* Om 'n subnet publiek te maak, moet jy 'n **Internet-gateway** aan jou VPC **skep** en **heg**.
* VPC-eindpunte (om toegang tot S3 vanaf private netwerke te kry)

In die volgende beelde kan jy die verskille in 'n standaard publieke netwerk en 'n private een nagaan:

<figure><img src="https://lh3.googleusercontent.com/q4ASpcLAYqijdNMLhMLl8EoowDtTMU5I_7YCVfk7-5hxDyeQOik9ImHnD2SYy32XUA2qXjEbXTAxA1lP--znJASdhYOdBveDcrD42f9XBKZ3EmjJCazN3YPLC6oS0xtRMmfORuwCszmMt-KrAkH07_izwg=s2048" alt=""><figcaption></figcaption></figure>

<figure><img src="https://lh5.googleusercontent.com/30psylXAI0gRN6_LK-reP00aGIlMma64E1qafCVPunn6nS-y5jAO6Y2JiempKcf6-LFi7ScicYcOh7BbHEya2VWtksnFX_8SPXQf97tKkg2tNZzrArWbiDCCn2m2LP1QUq6MZ_KayH3yir7t8zpO7CEQOw=s2048" alt=""><figcaption></figcaption></figure>

### ACL's

**Netwerk Toegang Beheer Lyste (ACL's)**: Netwerk ACL's is firewall-re√´ls wat inkomende en uitgaande netwerkverkeer na 'n subnet beheer. Hulle kan gebruik word om verkeer na spesifieke IP-adresse of reekse toe te laat of te weier.

* Dit is die meeste algemeen om toegang toe te laat/weier deur sekuriteitsgroepe te gebruik, maar dit is die enigste manier om gevestigde omgekeerde doppe heeltemal te sny. 'n Gewysigde re√´l in 'n sekuriteitsgroep stop nie reeds gevestigde verbindings nie
* Dit geld egter vir die hele subnetwerk, wees versigtig wanneer jy dinge verbied omdat nodige funksionaliteit versteur kan word

### Sekuriteitsgroepe

Sekuriteitsgroepe is 'n virtuele **firewall** wat inkomende en uitgaande netwerk **verkeer na instansies** in 'n VPC beheer. Verhouding 1 SG tot M instansies (gewoonlik 1 tot 1).\
Gewoonlik word dit gebruik om gevaarlike poorte in instansies oop te maak, soos byvoorbeeld poort 22:

<figure><img src="https://lh5.googleusercontent.com/LliB7eb3cYfkEyOpyw1-eYgWsn2kq1yF6uRn5VYndvOuTvDlURimYx9UvuK8F2impTLmx50mid4MdTXE-Ljt2i_rxaIfnKUdji_hFjCdU9tdoW-axng9-W4tSL71gbbjrPQ7IYY5lAdH_G3UoMRMGGGOxQ=s2048" alt=""><figcaption></figcaption></figure>

### Elastiese IP-adresse

'n _Elastiese IP-adres_ is 'n **statiese IPv4-adres** wat ontwerp is vir dinamiese wolkrekenaars. 'n Elastiese IP-adres word aan jou AWS-rekening toegewys, en is joune totdat jy dit vrystel. Deur 'n Elastiese IP-adres te gebruik, kan jy die mislukking van 'n instansie of sagteware masker deur die adres vinnig na 'n ander instansie in jou rekening te herkaart.

### Verbinding tussen subnetwerke

Standaard het alle subnetwerke die **outomatiese toekenning van publieke IP-adresse afgeskakel**, maar dit kan aangeskakel word.

**'n Plaaslike roete binne 'n roeteringstabel stel kommunikasie tussen VPC-subnetwerke in staat.**

As jy 'n **subnet met 'n ander subnet verbind, kan jy nie toegang tot die subnetwerke wat met die ander subnet verbind is, kry nie, jy moet direk met hulle verbind. Dit geld ook vir internet-gateways**. Jy kan nie deur 'n subnet-verbinding gaan om toegang tot die internet te kry nie, jy moet die internet-gateway aan jou subnet toewys.

### VPC Peering

VPC peering stel jou in staat om **twee of meer VPC's aan mekaar te koppel**, met behulp van IPV4 of IPV6, asof hulle deel was van dieselfde netwerk.

Sodra die peerkonnektiwiteit gevestig is, kan **hulpbronne in een VPC toegang tot hulpbronne in die ander h√™**. Die konnektiwiteit tussen die VPC's word ge√Ømplementeer deur die bestaande AWS-netwerkinfrastruktuur, en dit is dus hoogs beskikbaar sonder bandwydte-bottelnek. Aangesien **gepeerde verbindings werk asof hulle deel was van dieselfde netwerk**, is daar beperkings wanneer dit kom by jou CIDR-blokreekse wat gebruik kan word.\
As jy **oorvleuelende of duplikaat CIDR**-reekse vir jou VPC het, sal jy **nie in staat wees om die VPC's aan mekaar te peer nie**.\
Elke AWS VPC sal **slegs met sy peer kommunikeer**. As 'n voorbeeld, as jy 'n peerkonneksie tussen VPC 1 en VPC 2 het, en 'n ander konneksie tussen VPC 2 en VPC 3 soos getoon, dan kan VPC 1 en 2 direk met mekaar kommunikeer, net soos VPC 2 en VPC 3, maar VPC 1 en VPC 3 kan nie. **Jy kan nie deur een VPC roeteer om by 'n ander uit te kom nie.**

### **VPC Vloei Logs**

Binne jou VPC kan jy moontlik honderde of selfs duisende hulpbronne h√™ wat almal tussen verskillende subnetwerke kommunikeer, beide publiek en privaat, en ook tussen verskillende VPC's deur VPC peering verbindings. **VPC Vloei Logs stel jou in staat om IP-verkeersinligting vas te vang wat tussen jou netwerk koppelvlakke van jou hulpbronne binne jou VPC vloei**.

Anders as S3-toegangslogs en CloudFront-toegangslogs, word die **logdata wat deur VPC Vloei Logs gegenereer word, nie in S3 gestoor nie. In plaas daarvan word die logdata wat vasgevang word, na CloudWatch logs gestuur**.

Beperkings:

* As jy 'n VPC-gepeerde verbinding het, sal jy slegs in staat wees om vloei-logs van gepeerde VPC's wat binne dieselfde rekening is, te sien.
* As jy steeds hulpbronne binne die EC2-Classic-omgewing bestuur, sal jy ongelukkig nie in staat wees om inligting van hul koppelvlakke te kry nie
* Sodra 'n VPC Vloei Log geskep is, kan dit nie verander word nie. Om die VPC Vloei Log-konfigurasie te verander, moet jy dit uitvee en dan 'n nuwe een skep.
* Die volgende verkeer word nie gemonitor en deur die logs vasgevang nie. DHCP-verkeer binne die VPC, verkeer van instansies wat bestem is vir die Amazon DNS-bediener.
* Enige verkeer wat bestem is vir die IP-adres vir die VPC-standaardroeteerder en verkeer na en van die volgende adresse, 169.254.169.254 wat gebruik word vir die versameling van instansiemetadata, en 169.254.169.123 wat gebruik word vir die Amazon Time Sync-diens.
* Verkeer wat verband hou met 'n Amazon Windows-aktiveringslisensie vanaf 'n Windows-instansie
* Verkeer tussen 'n netwerklaaibalans-koppelvlak en 'n eindpunt-netwerkkoppelvlak

Vir elke netwerkkoppelvlak wat data na die CloudWatch-loggroep publiseer, sal dit 'n ander logstroom gebruik. En binne elk van hierdie strome sal daar die vloei-loggebeurtenisdata wees wat die inhoud van die loginskrywings wys. Elk van hierdie **logs vang data vas gedurende 'n venster van ongeveer 10 tot 15 minute**.

## VPN

### Basiese AWS VPN Komponente

1. **Kli√´nt Gateway**:
* 'n Kli√´nt Gateway is 'n hulpbron wat jy in AWS skep om jou kant van 'n VPN-verbinding te verteenwoordig.
* Dit is basies 'n fisiese toestel of sagtewaretoepassing aan jou kant van die Site-to-Site VPN-verbinding.
* Jy verskaf roeteringsinligting en die publieke IP-adres van jou netwerktoestel (soos 'n roeteerder of 'n firewall) aan AWS om 'n Kli√´nt Gateway te skep.
* Dit dien as 'n verwysingspunt vir die opstel van die VPN-verbinding en veroorsaak geen bykomende koste nie.
2. **Virtuele Private Gateway**:
* 'n Virtuele Private Gateway (VPG) is die VPN-konsentrator aan die Amazon-kant van die Site-to-Site VPN-verbinding.
* Dit is aan jou VPC geheg en dien as die teiken vir jou VPN-verbinding.
* VPG is die AWS-kant eindpunt vir die VPN-verbinding.
* Dit hanteer die veilige kommunikasie tussen jou VPC en jou op-perseel netwerk.
3. **Site-to-Site VPN Verbinding**:
* 'n Site-to-Site VPN-verbinding verbind jou op-perseel netwerk met 'n VPC deur 'n veilige, IPsec VPN-tonnel.
* Hierdie tipe verbinding vereis 'n Kli√´nt Gateway en 'n Virtuele Private Gateway.
* Dit word gebruik vir veilige, stabiele en konsekwente kommunikasie tussen jou datacentrum of netwerk en jou AWS-omgewing.
* Gewoonlik gebruik vir gereelde, langtermyn verbindings en word gefaktureer gebaseer op die hoeveelheid data wat oor die verbinding oorgedra word.
4. **Kli√´nt VPN Eindpunt**:
* 'n Kli√´nt VPN eindpunt is 'n hulpbron wat jy in AWS skep om kli√´nt VPN-sessies moontlik te maak en te bestuur.
* Dit word gebruik om individuele toestelle (soos skootrekenaars, slimfone, ens.) in staat te stel om veilig aan AWS-hulpbronne of jou op-perseel netwerk te koppel.
* Dit verskil van Site-to-Site VPN deurdat dit ontwerp is vir individuele kli√´nte eerder as om hele netwerke te verbind.
* Met Kli√´nt VPN gebruik elke kli√´nttoestel 'n VPN-kli√´ntsagteware om 'n veilige verbinding te vestig.

### Site-to-Site VPN

**Verbind jou op-perseel netwerk met jou VPC.**

* **VPN-verbinding**: 'n Veilige verbinding tussen jou op-perseel toerusting en jou VPC's.
*   **VPN-tonnel**: 'n Ge√´nkripteerde skakel waar data van die kli√´ntnetwerk na of van AWS kan beweeg.

Elke VPN-verbinding sluit twee VPN-tonnels in wat jy gelyktydig kan gebruik vir ho√´ beskikbaarheid.
* **Kli√´nt gateway**: 'n AWS-hulpbron wat inligting aan AWS verskaf oor jou kli√´nt gateway-toestel.
* **Kli√´nt gateway-toestel**: 'n Fisiese toestel of sagtewaretoepassing aan jou kant van die Site-to-Site VPN-verbinding.
* **Virtuele private gateway**: Die VPN-konsentrator aan die Amazon-kant van
