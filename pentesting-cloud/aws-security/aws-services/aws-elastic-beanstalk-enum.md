# AWS - Elastic Beanstalk Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Elastic Beanstalk

Amazon Elastic Beanstalkは、**ウェブアプリケーションやサービスのデプロイ、管理、スケーリングを簡素化するプラットフォーム**を提供します。Java、.NET、PHP、Node.js、Python、Ruby、Goなどのさまざまなプログラミング言語やフレームワーク、Dockerコンテナをサポートしています。このサービスは、Apache、Nginx、Passenger、IISなどの広く使用されているサーバーと互換性があります。

Elastic Beanstalkは、**AWSクラウドにアプリケーションをデプロイするためのシンプルで柔軟な方法**を提供し、基盤となるインフラストラクチャについて心配する必要がありません。**自動的に**キャパシティの**プロビジョニング**、負荷**分散**、**スケーリング**、アプリケーションの健康状態の**監視**の詳細を処理し、コードの記述とデプロイに集中できるようにします。

Elastic Beanstalkによって作成されるインフラストラクチャは、**EC2**の**オートスケーリング**グループ（ロードバランサー付き）によって管理されます。つまり、最終的には**ホストを侵害**した場合、EC2について知っておく必要があります。

{% content-ref url="aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

さらに、Dockerが使用されている場合、**ECS**を使用することが可能です。

{% content-ref url="aws-eks-enum.md" %}
[aws-eks-enum.md](aws-eks-enum.md)
{% endcontent-ref %}

### Application & Environments

AWS Elastic Beanstalkでは、「アプリケーション」と「環境」の概念は異なる目的を持ち、デプロイプロセスにおいて異なる役割を果たします。

#### Application

* Elastic Beanstalkのアプリケーションは、**アプリケーションのソースコード、環境、および設定の論理コンテナ**です。アプリケーションコードの異なるバージョンをまとめて管理することができます。
* アプリケーションを作成するとき、名前と説明を提供しますが、この段階ではリソースはプロビジョニングされません。これは、コードと関連リソースを整理および管理するための方法です。
* アプリケーション内には**複数のアプリケーションバージョン**を持つことができます。各バージョンはコードの特定のリリースに対応し、1つ以上の環境にデプロイすることができます。

#### Environment

* 環境は、AWSインフラストラクチャ上で実行される**アプリケーションのプロビジョニングされたインスタンス**です。これは**アプリケーションコードがデプロイされ、実行される場所**です。Elastic Beanstalkは、環境設定に基づいて必要なリソース（例：EC2インスタンス、ロードバランサー、オートスケーリンググループ、データベース）をプロビジョニングします。
* **各環境はアプリケーションの単一バージョンを実行**し、開発、テスト、ステージング、本番などの異なる目的のために複数の環境を持つことができます。
* 環境を作成するとき、プラットフォーム（例：Java、.NET、Node.jsなど）と環境タイプ（例：ウェブサーバーまたはワーカー）を選択します。また、インフラストラクチャおよびアプリケーション設定のさまざまな側面を制御するために環境設定をカスタマイズすることもできます。

### 2 types of Environments

1. **Web Server Environment**: これは**ウェブアプリケーションやAPIをホストおよび提供する**ために設計されています。これらのアプリケーションは通常、HTTP/HTTPSリクエストを処理します。ウェブサーバー環境は、**EC2インスタンス、ロードバランサー、オートスケーリング**グループなどのリソースをプロビジョニングし、トラフィックの処理、キャパシティの管理、アプリケーションの高可用性を確保します。
2. **Worker Environment**: これは**バックグラウンドタスク**を処理するために設計されています。これらのタスクは通常、時間がかかるかリソースを多く消費する操作であり、クライアントへの即時応答を必要としません。ワーカー環境は**EC2インスタンスとオートスケーリンググループ**のようなリソースをプロビジョニングしますが、HTTP/HTTPSリクエストを直接処理しないため、ロードバランサーはありません。代わりに、**Amazon Simple Queue Service (SQS) キュー**からタスクを消費し、ワーカー環境と処理するタスクの間のバッファとして機能します。

### Security

Beanstalkでアプリを作成する際には、3つの非常に重要なセキュリティオプションを選択する必要があります：

* **EC2 key pair**: これは、アプリを実行しているEC2インスタンスにアクセスできる**SSHキー**です。
* **IAM instance profile**: これは、インスタンスが持つ**インスタンスプロファイル**（**IAM権限**）です。
* 自動生成されたロールは**`aws-elasticbeanstalk-ec2-role`**と呼ばれ、すべてのECS、すべてのSQS、DynamoDB、elasticbeanstalk、およびelasticbeanstalk S3に対するいくつかの興味深いアクセス権を持ち、AWS管理ポリシーを使用します：[AWSElasticBeanstalkWebTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier), [AWSElasticBeanstalkMulticontainerDocker](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkMulticontainerDocker), [AWSElasticBeanstalkWorkerTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWorkerTier).
* **Service role**: これは、必要なすべてのアクションを実行するためにAWSサービスが使用する**ロール**です。私の知る限り、通常のAWSユーザーはそのロールにアクセスできません。
* AWSによって生成されたこのロールは**`aws-elasticbeanstalk-service-role`**と呼ばれ、AWS管理ポリシー[AWSElasticBeanstalkEnhancedHealth](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/service-role/AWSElasticBeanstalkEnhancedHealth)および[AWSElasticBeanstalkManagedUpdatesCustomerRolePolicy](https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/roles/details/aws-elasticbeanstalk-service-role?section=permissions)を使用します。

デフォルトでは**メタデータバージョン1は無効**です：

<figure><img src="../../../.gitbook/assets/image (103).png" alt=""><figcaption></figcaption></figure>

### Exposure

Beanstalkデータは、**S3バケット**に次の名前で保存されます：**`elasticbeanstalk-<region>-<acc-id>`**（AWSコンソールで作成された場合）。このバケットの中には、アップロードされた**アプリケーションのソースコード**が見つかります。

作成されたウェブページの**URL**は**`http://<webapp-name>-env.<random>.<region>.elasticbeanstalk.com/`**です。

{% hint style="warning" %}
バケットに対する**読み取りアクセス**を取得した場合、**ソースコードを読み取る**ことができ、さらには**機密情報**を見つけることもできます。

バケットに対する**書き込みアクセス**を取得した場合、ソースコードを**変更**して、次回実行されるときにアプリケーションが使用する**IAMロールを侵害**することができます。
{% endhint %}

### Enumeration

{% code overflow="wrap" %}
```bash
# Find S3 bucket
ACCOUNT_NUMBER=<account_number>
for r in us-east-1 us-east-2 us-west-1 us-west-2 ap-south-1 ap-south-2 ap-northeast-1 ap-northeast-2 ap-northeast-3 ap-southeast-1 ap-southeast-2 ap-southeast-3 ca-central-1 eu-central-1 eu-central-2 eu-west-1 eu-west-2 eu-west-3 eu-north-1 sa-east-1 af-south-1 ap-east-1 eu-south-1 eu-south-2 me-south-1 me-central-1; do aws s3 ls elasticbeanstalk-$r-$ACCOUNT_NUMBER 2>/dev/null && echo "Found in: elasticbeanstalk-$r-$ACCOUNT_NUMBER"; done

# Get apps and URLs
aws elasticbeanstalk describe-applications # List apps
aws elasticbeanstalk describe-application-versions # Get apps & bucket name with source code
aws elasticbeanstalk describe-environments # List envs
aws elasticbeanstalk describe-environments | grep -E "EndpointURL|CNAME"
aws elasticbeanstalk describe-configuration-settings --application-name <app_name> --environment-name <env_name>
aws elasticbeanstalk describe-environment-resources --environment-name <env_name> # Get env info such as SQS used queues
aws elasticbeanstalk describe-instances-health --environment-name <env_name> # Get the instances of an environment

# Get events
aws elasticbeanstalk describe-events
```
{% endcode %}

### 認証されていないアクセス

{% content-ref url="../aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md" %}
[aws-elastic-beanstalk-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md)
{% endcontent-ref %}

### 永続性

{% content-ref url="../aws-persistence/aws-elastic-beanstalk-persistence.md" %}
[aws-elastic-beanstalk-persistence.md](../aws-persistence/aws-elastic-beanstalk-persistence.md)
{% endcontent-ref %}

### 特権昇格

{% content-ref url="../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md" %}
[aws-elastic-beanstalk-privesc.md](../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md)
{% endcontent-ref %}

### ポストエクスプロイト

{% content-ref url="../aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md" %}
[aws-elastic-beanstalk-post-exploitation.md](../aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md)
{% endcontent-ref %}

{% hint style="success" %}
AWSハッキングを学び、練習する:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPハッキングを学び、練習する: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポートする</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォローする。**
* **ハッキングトリックを共有するには、** [**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>
{% endhint %}
