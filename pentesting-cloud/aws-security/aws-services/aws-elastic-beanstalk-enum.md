# AWS - Elastic Beanstalk Enum

{% hint style="success" %}
Μάθετε και εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε και εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}

## Elastic Beanstalk

Το Amazon Elastic Beanstalk παρέχει μια απλοποιημένη πλατφόρμα για **ανάπτυξη, διαχείριση και κλιμάκωση εφαρμογών και υπηρεσιών ιστού**. Υποστηρίζει μια ποικιλία γλωσσών προγραμματισμού και πλαισίων, όπως Java, .NET, PHP, Node.js, Python, Ruby και Go, καθώς και Docker containers. Η υπηρεσία είναι συμβατή με ευρέως χρησιμοποιούμενους διακομιστές όπως Apache, Nginx, Passenger και IIS.

Το Elastic Beanstalk παρέχει έναν απλό και ευέλικτο τρόπο για να **αναπτύξετε τις εφαρμογές σας στο AWS cloud**, χωρίς να χρειάζεται να ανησυχείτε για την υποκείμενη υποδομή. **Αυτόματα** διαχειρίζεται τις λεπτομέρειες της **παροχής** χωρητικότητας, της **εξισορρόπησης φορτίου**, της **κλιμάκωσης** και της **παρακολούθησης** της υγείας της εφαρμογής, επιτρέποντάς σας να επικεντρωθείτε στη συγγραφή και την ανάπτυξη του κώδικά σας.

Η υποδομή που δημιουργείται από το Elastic Beanstalk διαχειρίζεταιται από **Autoscaling** Groups στο **EC2** (με έναν load balancer). Αυτό σημαίνει ότι στο τέλος της ημέρας, αν **παραβιάσετε τον host**, θα πρέπει να γνωρίζετε για το EC2:

{% content-ref url="aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

Επιπλέον, αν χρησιμοποιείται Docker, είναι δυνατό να χρησιμοποιηθεί το **ECS**.

{% content-ref url="aws-eks-enum.md" %}
[aws-eks-enum.md](aws-eks-enum.md)
{% endcontent-ref %}

### Εφαρμογή & Περιβάλλοντα

Στο AWS Elastic Beanstalk, οι έννοιες της "εφαρμογής" και του "περιβάλλοντος" εξυπηρετούν διαφορετικούς σκοπούς και έχουν διακριτούς ρόλους στη διαδικασία ανάπτυξης.

#### Εφαρμογή

* Μια εφαρμογή στο Elastic Beanstalk είναι ένας **λογικός περιέκτης για τον πηγαίο κώδικα της εφαρμογής σας, τα περιβάλλοντα και τις διαμορφώσεις**. Ομαδοποιεί διαφορετικές εκδόσεις του κώδικα της εφαρμογής σας και σας επιτρέπει να τις διαχειρίζεστε ως μία οντότητα.
* Όταν δημιουργείτε μια εφαρμογή, παρέχετε ένα όνομα και μια περιγραφή, αλλά **δεν παρέχονται πόροι** σε αυτό το στάδιο. Είναι απλώς ένας τρόπος να οργανώσετε και να διαχειριστείτε τον κώδικα και τους σχετικούς πόρους σας.
* Μπορείτε να έχετε **πολλαπλές εκδόσεις εφαρμογών** μέσα σε μια εφαρμογή. Κάθε έκδοση αντιστοιχεί σε μια συγκεκριμένη έκδοση του κώδικά σας, η οποία μπορεί να αναπτυχθεί σε ένα ή περισσότερα περιβάλλοντα.

#### Περιβάλλον

* Ένα περιβάλλον είναι μια **παρεχόμενη περίπτωση της εφαρμογής σας** που εκτελείται στην υποδομή του AWS. Είναι **όπου αναπτύσσεται και εκτελείται ο κώδικας της εφαρμογής σας**. Το Elastic Beanstalk παρέχει τους απαραίτητους πόρους (π.χ., EC2 instances, load balancers, auto-scaling groups, βάσεις δεδομένων) με βάση τη διαμόρφωση του περιβάλλοντος.
* **Κάθε περιβάλλον εκτελεί μια μόνο έκδοση της εφαρμογής σας**, και μπορείτε να έχετε πολλαπλά περιβάλλοντα για διαφορετικούς σκοπούς, όπως ανάπτυξη, δοκιμή, staging και παραγωγή.
* Όταν δημιουργείτε ένα περιβάλλον, επιλέγετε μια πλατφόρμα (π.χ., Java, .NET, Node.js, κ.λπ.) και έναν τύπο περιβάλλοντος (π.χ., web server ή worker). Μπορείτε επίσης να προσαρμόσετε τη διαμόρφωση του περιβάλλοντος για να ελέγξετε διάφορες πτυχές της υποδομής και των ρυθμίσεων της εφαρμογής.

### 2 τύποι Περιβαλλόντων

1. **Web Server Environment**: Είναι σχεδιασμένο να **φιλοξενεί και να εξυπηρετεί εφαρμογές και APIs ιστού**. Αυτές οι εφαρμογές συνήθως διαχειρίζονται εισερχόμενα αιτήματα HTTP/HTTPS. Το web server environment παρέχει πόρους όπως **EC2 instances, load balancers και auto-scaling** groups για να διαχειρίζεται την εισερχόμενη κίνηση, να διαχειρίζεται τη χωρητικότητα και να εξασφαλίζει την υψηλή διαθεσιμότητα της εφαρμογής.
2. **Worker Environment**: Είναι σχεδιασμένο να επεξεργάζεται **εργασίες παρασκηνίου**, οι οποίες συχνά είναι χρονοβόρες ή απαιτούν πολλούς πόρους και δεν απαιτούν άμεσες απαντήσεις στους πελάτες. Το worker environment παρέχει πόρους όπως **EC2 instances και auto-scaling groups**, αλλά **δεν έχει load balancer** καθώς δεν διαχειρίζεται άμεσα αιτήματα HTTP/HTTPS. Αντίθετα, καταναλώνει εργασίες από μια **Amazon Simple Queue Service (SQS) queue**, η οποία λειτουργεί ως buffer μεταξύ του worker environment και των εργασιών που επεξεργάζεται.

### Ασφάλεια

Όταν δημιουργείτε μια εφαρμογή στο Beanstalk, υπάρχουν 3 πολύ σημαντικές επιλογές ασφάλειας για να επιλέξετε:

* **EC2 key pair**: Αυτό θα είναι το **SSH key** που θα μπορεί να έχει πρόσβαση στα EC2 instances που εκτελούν την εφαρμογή
* **IAM instance profile**: Αυτό είναι το **instance profile** που θα έχουν τα instances (**IAM privileges**)
* Ο αυτόματα δημιουργούμενος ρόλος ονομάζεται **`aws-elasticbeanstalk-ec2-role`** και έχει ενδιαφέρουσα πρόσβαση σε όλα τα ECS, όλα τα SQS, DynamoDB elasticbeanstalk και elasticbeanstalk S3 χρησιμοποιώντας τις AWS managed policies: [AWSElasticBeanstalkWebTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier), [AWSElasticBeanstalkMulticontainerDocker](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkMulticontainerDocker), [AWSElasticBeanstalkWorkerTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWorkerTier).
* **Service role**: Αυτός είναι ο **ρόλος που θα χρησιμοποιήσει η υπηρεσία AWS** για να εκτελέσει όλες τις απαραίτητες ενέργειες. Όσο γνωρίζω, ένας κανονικός χρήστης AWS δεν μπορεί να έχει πρόσβαση σε αυτόν τον ρόλο.
* Αυτός ο ρόλος που δημιουργείται από το AWS ονομάζεται **`aws-elasticbeanstalk-service-role`** και χρησιμοποιεί τις AWS managed policies [AWSElasticBeanstalkEnhancedHealth](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/service-role/AWSElasticBeanstalkEnhancedHealth) και [AWSElasticBeanstalkManagedUpdatesCustomerRolePolicy](https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/roles/details/aws-elasticbeanstalk-service-role?section=permissions)

Από προεπιλογή, **η έκδοση μεταδεδομένων 1 είναι απενεργοποιημένη**:

<figure><img src="../../../.gitbook/assets/image (103).png" alt=""><figcaption></figcaption></figure>

### Έκθεση

Τα δεδομένα του Beanstalk αποθηκεύονται σε έναν **S3 bucket** με το ακόλουθο όνομα: **`elasticbeanstalk-<region>-<acc-id>`** (αν δημιουργήθηκε στην κονσόλα του AWS). Μέσα σε αυτόν τον bucket θα βρείτε τον ανεβασμένο **πηγαίο κώδικα της εφαρμογής**.

Η **URL** της δημιουργημένης ιστοσελίδας είναι **`http://<webapp-name>-env.<random>.<region>.elasticbeanstalk.com/`**

{% hint style="warning" %}
Αν αποκτήσετε **πρόσβαση ανάγνωσης** στον bucket, μπορείτε να **διαβάσετε τον πηγαίο κώδικα** και ακόμη να βρείτε **ευαίσθητα διαπιστευτήρια** σε αυτόν

αν αποκτήσετε **πρόσβαση εγγραφής** στον bucket, θα μπορούσατε να **τροποποιήσετε τον πηγαίο κώδικα** για να **παραβιάσετε** τον **IAM ρόλο** που χρησιμοποιεί η εφαρμογή την επόμενη φορά που θα εκτελεστεί.
{% endhint %}

### Απαρίθμηση

{% code overflow="wrap" %}
```bash
# Find S3 bucket
ACCOUNT_NUMBER=<account_number>
for r in us-east-1 us-east-2 us-west-1 us-west-2 ap-south-1 ap-south-2 ap-northeast-1 ap-northeast-2 ap-northeast-3 ap-southeast-1 ap-southeast-2 ap-southeast-3 ca-central-1 eu-central-1 eu-central-2 eu-west-1 eu-west-2 eu-west-3 eu-north-1 sa-east-1 af-south-1 ap-east-1 eu-south-1 eu-south-2 me-south-1 me-central-1; do aws s3 ls elasticbeanstalk-$r-$ACCOUNT_NUMBER 2>/dev/null && echo "Found in: elasticbeanstalk-$r-$ACCOUNT_NUMBER"; done

# Get apps and URLs
aws elasticbeanstalk describe-applications # List apps
aws elasticbeanstalk describe-application-versions # Get apps & bucket name with source code
aws elasticbeanstalk describe-environments # List envs
aws elasticbeanstalk describe-environments | grep -E "EndpointURL|CNAME"
aws elasticbeanstalk describe-configuration-settings --application-name <app_name> --environment-name <env_name>
aws elasticbeanstalk describe-environment-resources --environment-name <env_name> # Get env info such as SQS used queues
aws elasticbeanstalk describe-instances-health --environment-name <env_name> # Get the instances of an environment

# Get events
aws elasticbeanstalk describe-events
```
{% endcode %}

### Μη Εξουσιοδοτημένη Πρόσβαση

{% content-ref url="../aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md" %}
[aws-elastic-beanstalk-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md)
{% endcontent-ref %}

### Επιμονή

{% content-ref url="../aws-persistence/aws-elastic-beanstalk-persistence.md" %}
[aws-elastic-beanstalk-persistence.md](../aws-persistence/aws-elastic-beanstalk-persistence.md)
{% endcontent-ref %}

### Αύξηση Δικαιωμάτων

{% content-ref url="../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md" %}
[aws-elastic-beanstalk-privesc.md](../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md)
{% endcontent-ref %}

### Μετα-Εκμετάλλευση

{% content-ref url="../aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md" %}
[aws-elastic-beanstalk-post-exploitation.md](../aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md)
{% endcontent-ref %}

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}
