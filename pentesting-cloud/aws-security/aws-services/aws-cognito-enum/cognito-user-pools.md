# Cognito User Pools

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repo's.

</details>
{% endhint %}

## Basiese Inligting

'n Gebruikerspoel is 'n gebruikersgids in Amazon Cognito. Met 'n gebruikerspoel kan jou gebruikers **aanmeld by jou web- of mobiele app** deur Amazon Cognito, **of federateer** deur 'n **derdeparty** identiteitsverskaffer (IdP). Of jou gebruikers direk of deur 'n derde party aanmeld, alle lede van die gebruikerspoel het 'n gidsprofiel wat jy deur 'n SDK kan toegang kry.

Gebruikerspoele bied:

* Dienste vir aanmelding en aanmelding.
* 'n Ingeboude, aanpasbare web UI om gebruikers aan te meld.
* Sosiale aanmelding met Facebook, Google, Login met Amazon, en Aanmelding met Apple, en deur SAML en OIDC identiteitsverskaffers van jou gebruikerspoel.
* Gebruikersgidsbestuur en gebruikersprofiele.
* Sekuriteitskenmerke soos multi-faktor verifikasie (MFA), kontrole vir gekompromitteerde geloofsbriewe, rekeningoorname beskerming, en telefoon- en e-posverifikasie.
* Aangepaste werkvloeie en gebruikersmigrasie deur AWS Lambda snellers.

**Bronkode** van toepassings sal gewoonlik ook die **gebruikerspoel-ID** en die **kli√´nttoepassing-ID** bevat, (en soms die **toepassingsgeheim**?) wat nodig is vir 'n **gebruiker om aan te meld** by 'n Cognito Gebruikerspoel.

### Potensi√´le aanvalle

* **Registrasie**: Deur verstek kan 'n gebruiker homself registreer, so hy kan 'n gebruiker vir homself skep.
* **Gebruikersopname**: Die registrasiefunksionaliteit kan gebruik word om gebruikersname te vind wat reeds bestaan. Hierdie inligting kan nuttig wees vir die brute-force aanval.
* **Aanmelding brute-force**: In die [**Verifikasie**](cognito-user-pools.md#authentication) afdeling het jy al die **metodes** wat 'n gebruiker het om **aan te meld**, jy kan probeer om hulle brute-force om **geldige geloofsbriewe te vind**.

### Gereedskap vir pentesting

* [Pacu](https://github.com/RhinoSecurityLabs/pacu), die AWS eksploitasieraamwerk, sluit nou die "cognito\_\_enum" en "cognito\_\_attack" modules in wat outomatisering van alle Cognito bates in 'n rekening en vlag swak konfigurasies, gebruikerskenmerke wat vir toegangbeheer gebruik word, ens., en ook outomatisering van gebruikerskepping (insluitend MFA ondersteuning) en voorregverhoging gebaseer op wysigbare pasgemaakte kenmerke, bruikbare identiteitspoel geloofsbriewe, aanneembare rolle in id tokens, ens.

Vir 'n beskrywing van die modules se funksies, sien deel 2 van die [blogpos](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2). Vir installasie-instruksies, sien die hoof [Pacu](https://github.com/RhinoSecurityLabs/pacu) bladsy.

#### Gebruik

Voorbeeld van cognito\_\_attack gebruik om gebruikerskepping en alle privesc vektore teen 'n gegewe identiteitspoel en gebruikerspoel kli√´nt te probeer:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
Voorbeeld van cognito\_\_enum gebruik om alle gebruikerspoele, gebruikerspoel kli√´nte, identiteits poele, gebruikers, ens. sigbaar in die huidige AWS rekening te versamel:
```bash
Pacu (new:test) > run cognito__enum
```
* [Cognito Scanner](https://github.com/padok-team/cognito-scanner) is 'n CLI-instrument in python wat verskillende aanvalle op Cognito implementeer, insluitend ongewenste rekening skepping en rekening orakel.

#### Installasie
```bash
$ pip install cognito-scanner
```
#### Gebruik
```bash
$ cognito-scanner --help
```
Vir meer inligting, besoek https://github.com/padok-team/cognito-scanner

## Registrasie

User Pools laat **standaard** toe om **nuwe gebruikers te registreer**.
```bash
aws cognito-idp sign-up --client-id <client-id> \
--username <username> --password <password> \
--region <region> --no-sign-request
```
#### As iemand kan registreer

Jy mag 'n fout vind wat jou aandui dat jy **meer besonderhede** oor die gebruiker moet verskaf:
```
An error occurred (InvalidParameterException) when calling the SignUp operation: Attributes did not conform to the schema: address: The attribute is required
```
Jy kan die nodige besonderhede verskaf met 'n JSON soos:
```json
--user-attributes '[{"Name": "email", "Value": "carlospolop@gmail.com"}, {"Name":"gender", "Value": "M"}, {"Name": "address", "Value": "street"}, {"Name": "custom:custom_name", "Value":"supername&\"*$"}]'
```
Jy kan hierdie funksionaliteit ook gebruik om **bestaande gebruikers te enumereer.** Dit is die foutboodskap wanneer 'n gebruiker reeds met daardie naam bestaan:
```
An error occurred (UsernameExistsException) when calling the SignUp operation: User already exists
```
{% hint style="info" %}
Let op in die vorige opdrag hoe die **pasgemaakte eienskappe begin met "custom:"**.\
Weet ook dat wanneer jy registreer, jy **nie nuwe pasgemaakte eienskappe vir die gebruiker kan skep nie**. Jy kan slegs waarde gee aan **standaard eienskappe** (selfs al is hulle nie vereis nie) en **gespesifiseerde pasgemaakte eienskappe**.
{% endhint %}

Of net om te toets of 'n kli√´nt-ID bestaan. Dit is die fout as die kli√´nt-ID nie bestaan nie:
```
An error occurred (ResourceNotFoundException) when calling the SignUp operation: User pool client 3ig612gjm56p1ljls1prq2miut does not exist.
```
#### As slegs admin gebruikers kan registreer

Jy sal hierdie fout vind en jy sal nie in staat wees om gebruikers te registreer of te enumereer nie:
```
An error occurred (NotAuthorizedException) when calling the SignUp operation: SignUp is not permitted for this user pool
```
### Verifying Registration

Cognito laat toe om **'n nuwe gebruiker te verifieer deur sy e-pos of telefoonnommer te verifieer**. Daarom, wanneer 'n gebruiker geskep word, sal jy gewoonlik ten minste die gebruikersnaam en wagwoord en die **e-pos en/of telefoonnommer** moet verskaf. Stel net een in wat **jy beheer** sodat jy die kode sal ontvang om **jou** nuutgeskepte gebruiker **rekening** te verifieer soos volg:
```bash
aws cognito-idp confirm-sign-up --client-id <cliet_id> \
--username aasdasd2 --confirmation-code <conf_code> \
--no-sign-request --region us-east-1
```
{% hint style="warning" %}
Selfs al **lyk dit of jy dieselfde e-pos** en telefoonnommer kan gebruik, wanneer jy die geskepte gebruiker moet verifieer, sal Cognito kla oor die gebruik van dieselfde inligting en **sal jou nie toelaat om die rekening te verifieer nie**.
{% endhint %}

### Voorregverhoging / Opdatering van Eienskappe

'n Gebruiker kan standaard **die waarde van sy eienskappe verander** met iets soos:
```bash
aws cognito-idp update-user-attributes \
--region us-east-1 --no-sign-request \
--user-attributes Name=address,Value=street \
--access-token <access token>
```
#### Custom attribute privesc

{% hint style="danger" %}
Jy mag dalk **pasgemaakte eienskappe** vind wat gebruik word (soos `isAdmin`), aangesien jy standaard die **waardes van jou eie eienskappe kan verander**, mag jy dalk in staat wees om **voorregte te verhoog** deur die waarde self te verander!
{% endhint %}

#### E-pos/gebruikersnaam wysiging privesc

Jy kan dit gebruik om die **e-pos en telefoonnommer** van 'n gebruiker te **wysig**, maar dan, selfs al bly die rekening as geverifieer, word daardie eienskappe in **onverifieerde status** gestel (jy moet hulle weer verifieer).

{% hint style="warning" %}
Jy sal **nie in staat wees om met e-pos of telefoonnommer aan te meld** totdat jy hulle verifieer nie, maar jy sal **in staat wees om met die gebruikersnaam aan te meld**.\
Let daarop dat selfs al is die e-pos gewysig en nie geverifieer nie, dit in die ID Token sal verskyn binne die **`email`** **veld** en die veld **`email_verified`** sal **vals** wees, maar as die app **dit nie nagaan nie, mag jy ander gebruikers naboots**.

Verder, let daarop dat jy enigiets binne die **`name`** veld kan plaas deur net die **naam eienskap** te wysig. As 'n app **daardie** veld om een of ander rede **nagaan** **in plaas van die `email`** (of enige ander eienskap), mag jy in staat wees om **ander gebruikers na te boots**.
{% endhint %}

In elk geval, as jy om een of ander rede jou e-pos verander het na 'n nuwe een wat jy kan toegang, kan jy die **e-pos bevestig met die kode wat jy in daardie e-posadres ontvang het**:
```bash
aws cognito-idp verify-user-attribute \
--access-token <access_token> \
--attribute-name email --code <code> \
--region <region> --no-sign-request
```
Gebruik **`phone_number`** in plaas van **`email`** om 'n **nuwe telefoonnommer** te verander/verifieer.

{% hint style="info" %}
Die admin kan ook die opsie aktiveer om **met 'n gebruiker se voorkeurgebruikersnaam aan te meld**. Let daarop dat jy nie hierdie waarde kan verander na **enige gebruikersnaam of preferred\_username wat reeds gebruik word** om 'n ander gebruiker na te boots nie.
{% endhint %}

### Herstel/Verander Wagwoord

Dit is moontlik om 'n wagwoord te herstel net deur **die gebruikersnaam te ken** (of e-pos of telefoon word aanvaar) en toegang daartoe te h√™ aangesien 'n kode daarheen gestuur sal word:
```bash
aws cognito-idp forgot-password \
--client-id <client_id> \
--username <username/email/phone> --region <region>
```
{% hint style="info" %}
Die reaksie van die bediener gaan altyd positief wees, asof die gebruikersnaam bestaan. Jy kan nie hierdie metode gebruik om gebruikers te enumereer nie.
{% endhint %}

Met die kode kan jy die wagwoord verander met:
```bash
aws cognito-idp confirm-forgot-password \
--client-id <client_id> \
--username <username> \
--confirmation-code <conf_code> \
--password <pwd> --region <region>
```
Om die wagwoord te verander moet jy **die vorige wagwoord ken**:
```bash
aws cognito-idp change-password \
--previous-password <value> \
--proposed-password <value> \
--access-token <value>
```
## Verifikasie

'n Gebruikerspoel ondersteun **verskillende maniere om te verifieer**. As jy 'n **gebruikersnaam en wagwoord** het, is daar ook **verskillende metodes** om aan te meld.\
Verder, wanneer 'n gebruiker in die Poel geverifieer is, word **3 tipes tokens gegee**: Die **ID Token**, die **Toegangstoken** en die **Herlaaitoken**.

* [**ID Token**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-id-token.html): Dit bevat eise oor die **identiteit van die geverifieerde gebruiker**, soos `naam`, `e-pos`, en `telefoonnommer`. Die ID-token kan ook gebruik word om **gebruikers te verifieer by jou hulpbronbedieners of bedienertoepassings**. Jy moet die **handtekening** van die ID-token **verifieer** voordat jy enige eise binne die ID-token kan vertrou as jy dit in eksterne toepassings gebruik.
* Die ID-token is die token wat **die attribuutwaardes van die gebruiker bevat**, selfs die pasgemaakte.
* [**Toegangstoken**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-access-token.html): Dit bevat eise oor die geverifieerde gebruiker, 'n lys van die **gebruiker se groepe, en 'n lys van omvang**. Die doel van die toegangstoken is om **API-operasies te magtig** in die konteks van die gebruiker in die gebruikerspoel. Byvoorbeeld, jy kan die toegangstoken gebruik om **jou gebruiker toegang te gee** om gebruikerskenmerke by te voeg, te verander of te verwyder.
* [**Herlaaitoken**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-refresh-token.html): Met herlaaitokens kan jy **nuwe ID Tokens en Toegangstokens** vir die gebruiker kry totdat die **herlaaitoken ongeldig is**. By **versteking** verval die herlaaitoken **30 dae nadat** jou toepassingsgebruiker by jou gebruikerspoel aangemeld het. Wanneer jy 'n toepassing vir jou gebruikerspoel skep, kan jy die toepassing se herlaaitoken-verval stel op **enige waarde tussen 60 minute en 10 jaar**.

### ADMIN\_NO\_SRP\_AUTH & ADMIN\_USER\_PASSWORD\_AUTH

Dit is die bedienerkant-verifikasievloei:

* Die bedienerkant-toepassing roep die **`AdminInitiateAuth` API-operasie** (in plaas van `InitiateAuth`). Hierdie operasie vereis AWS-geloofsbriewe met toestemmings wat **`cognito-idp:AdminInitiateAuth`** en **`cognito-idp:AdminRespondToAuthChallenge`** insluit. Die operasie gee die vereiste verifikasieparameters terug.
* Nadat die bedienerkant-toepassing die **verifikasieparameters** het, roep dit die **`AdminRespondToAuthChallenge` API-operasie**. Die `AdminRespondToAuthChallenge` API-operasie slaag slegs wanneer jy AWS-geloofsbriewe verskaf.

Hierdie **metode is NIE verstek geaktiveer** nie.

Om **aan te meld** moet jy weet:

* gebruikerspoel id
* kli√´nt id
* gebruikersnaam
* wagwoord
* kli√´ntgeheim (slegs as die toepassing gekonfigureer is om 'n geheim te gebruik)

{% hint style="info" %}
Om **met hierdie metode te kan aanmeld** moet daardie toepassing toelaat om aan te meld met `ALLOW_ADMIN_USER_PASSWORD_AUTH`.\
Verder, om hierdie aksie uit te voer, benodig jy geloofsbriewe met die toestemmings **`cognito-idp:AdminInitiateAuth`** en **`cognito-idp:AdminRespondToAuthChallenge`**
{% endhint %}
```python
aws cognito-idp admin-initiate-auth \
--client-id <client-id> \
--auth-flow ADMIN_USER_PASSWORD_AUTH \
--region <region> \
--auth-parameters 'USERNAME=<username>,PASSWORD=<password>,SECRET_HASH=<hash_if_needed>'
--user-pool-id "<pool-id>"

# Check the python code to learn how to generate the hsecret_hash
```
<details>

<summary>Kode om aan te meld</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64


client_id = "<client-id>"
user_pool_id = "<user-pool-id>"
client_secret = "<client-secret>"
username = "<username>"
password = "<pwd>"

boto_client = boto3.client('cognito-idp', region_name='us-east-1')

def get_secret_hash(username, client_id, client_secret):
key = bytes(client_secret, 'utf-8')
message = bytes(f'{username}{client_id}', 'utf-8')
return base64.b64encode(hmac.new(key, message, digestmod=hashlib.sha256).digest()).decode()

# If the Client App isn't configured to use a secret
## just delete the line setting the SECRET_HASH
def login_user(username_or_alias, password, client_id, client_secret, user_pool_id):
try:
return boto_client.admin_initiate_auth(
UserPoolId=user_pool_id,
ClientId=client_id,
AuthFlow='ADMIN_USER_PASSWORD_AUTH',
AuthParameters={
'USERNAME': username_or_alias,
'PASSWORD': password,
'SECRET_HASH': get_secret_hash(username_or_alias, client_id, client_secret)
}
)
except botocore.exceptions.ClientError as e:
return e.response

print(login_user(username, password, client_id, client_secret, user_pool_id))
```
</details>

### USER\_PASSWORD\_AUTH

Hierdie metode is nog 'n eenvoudige en **tradisionele gebruiker & wagwoord-verifikasie** vloei. Dit word aanbeveel om **'n tradisionele** verifikasiemetode **na Cognito te migreer** en dan aan te beveel om dit **te deaktiveer** en dan die **ALLOW\_USER\_SRP\_AUTH** metode te gebruik (aangesien daardie een nooit die wagwoord oor die netwerk stuur nie).\
Hierdie **metode is NIE standaard geaktiveer** nie.

Die hoof **verskil** met die **vorige verifikasiemetode** binne die kode is dat jy **nie die gebruikerpoel-ID hoef te ken nie** en dat jy **nie ekstra toestemmings nodig het** in die Cognito Gebruikerpoel nie.

Om **aan te meld** moet jy weet:

* kli√´nt-ID
* gebruikersnaam
* wagwoord
* kli√´ntgeheim (slegs as die app gekonfigureer is om 'n geheim te gebruik)

{% hint style="info" %}
Om **met hierdie metode te kan aanmeld** moet daardie toepassing toelaat om aan te meld met ALLOW\_USER\_PASSWORD\_AUTH.
{% endhint %}
```python
aws cognito-idp initiate-auth  --client-id <client-id> \
--auth-flow USER_PASSWORD_AUTH --region <region> \
--auth-parameters 'USERNAME=<username>,PASSWORD=<password>,SECRET_HASH=<hash_if_needed>'

# Check the python code to learn how to generate the secret_hash
```
<details>

<summary>Python kode om aan te meld</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64


client_id = "<client-id>"
user_pool_id = "<user-pool-id>"
client_secret = "<client-secret>"
username = "<username>"
password = "<pwd>"

boto_client = boto3.client('cognito-idp', region_name='us-east-1')

def get_secret_hash(username, client_id, client_secret):
key = bytes(client_secret, 'utf-8')
message = bytes(f'{username}{client_id}', 'utf-8')
return base64.b64encode(hmac.new(key, message, digestmod=hashlib.sha256).digest()).decode()

# If the Client App isn't configured to use a secret
## just delete the line setting the SECRET_HASH
def login_user(username_or_alias, password, client_id, client_secret, user_pool_id):
try:
return boto_client.initiate_auth(
ClientId=client_id,
AuthFlow='ADMIN_USER_PASSWORD_AUTH',
AuthParameters={
'USERNAME': username_or_alias,
'PASSWORD': password,
'SECRET_HASH': get_secret_hash(username_or_alias, client_id, client_secret)
}
)
except botocore.exceptions.ClientError as e:
return e.response

print(login_user(username, password, client_id, client_secret, user_pool_id))
```
</details>

### USER\_SRP\_AUTH

Hierdie scenario is soortgelyk aan die vorige een, maar **in plaas daarvan om die wagwoord** deur die netwerk te stuur om aan te meld, word 'n **uitdaging-verifikasie uitgevoer** (dus geen wagwoord wat selfs ge√Ønkripteer deur die netwerk navigeer nie).\
Hierdie **metode is standaard geaktiveer**.

Om **aan te meld** moet jy **weet**:

* user pool id
* client id
* gebruikersnaam
* wagwoord
* kli√´nt geheim (slegs as die app gekonfigureer is om 'n geheim te gebruik)

<details>

<summary>Kode om aan te meld</summary>
```python
from warrant.aws_srp import AWSSRP
import os

USERNAME='xxx'
PASSWORD='yyy'
POOL_ID='us-east-1_zzzzz'
CLIENT_ID = '12xxxxxxxxxxxxxxxxxxxxxxx'
CLIENT_SECRET = 'secreeeeet'
os.environ["AWS_DEFAULT_REGION"] = "<region>"

aws = AWSSRP(username=USERNAME, password=PASSWORD, pool_id=POOL_ID,
client_id=CLIENT_ID, client_secret=CLIENT_SECRET)
tokens = aws.authenticate_user()
id_token = tokens['AuthenticationResult']['IdToken']
refresh_token = tokens['AuthenticationResult']['RefreshToken']
access_token = tokens['AuthenticationResult']['AccessToken']
token_type = tokens['AuthenticationResult']['TokenType']
```
</details>

### REFRESH\_TOKEN\_AUTH & REFRESH\_TOKEN

Hierdie **metode gaan altyd geldig wees** (dit kan nie gedeaktiveer word nie) maar jy moet 'n geldige verfrissingstoken h√™.
```bash
aws cognito-idp initiate-auth \
--client-id 3ig6h5gjm56p1ljls1prq2miut \
--auth-flow REFRESH_TOKEN_AUTH \
--region us-east-1 \
--auth-parameters 'REFRESH_TOKEN=<token>'
```
<details>

<summary>Kode om te verfris</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64

client_id = "<client-id>"
token = '<token>'

boto_client = boto3.client('cognito-idp', region_name='<region>')

def refresh(client_id, refresh_token):
try:
return boto_client.initiate_auth(
ClientId=client_id,
AuthFlow='REFRESH_TOKEN_AUTH',
AuthParameters={
'REFRESH_TOKEN': refresh_token
}
)
except botocore.exceptions.ClientError as e:
return e.response


print(refresh(client_id, token))
```
</details>

### CUSTOM\_AUTH

In hierdie geval gaan die **verifikasie** uitgevoer word deur die **uitvoering van 'n lambda-funksie**.

## Ekstra Sekuriteit

### Gevorderde Sekuriteit

Dit is standaard gedeaktiveer, maar as dit geaktiveer is, kan Cognito moontlik **rekening oornames opspoor**. Om die waarskynlikheid te verminder, moet jy aanmeld vanaf 'n **netwerk binne dieselfde stad, met dieselfde gebruiker agent** (en IP indien moontlik)**.**

### **MFA Onthou toestel**

As die gebruiker vanaf dieselfde toestel aanmeld, kan die MFA omseil word, probeer dus om aan te meld vanaf dieselfde blaaier met dieselfde metadata (IP?) om te probeer om die MFA beskerming te omseil.

## Gebruiker Poel Groepe IAM Rolle

Dit is moontlik om **gebruikers by Gebruiker Poel** groepe te voeg wat verband hou met een **IAM rolle**.\
Boonop kan **gebruikers** aan **meer as 1 groep met verskillende IAM rolle** gekoppel word.

Let daarop dat selfs al is 'n groep binne 'n groep met 'n IAM rol gekoppel, om toegang te h√™ tot IAM geloofsbriewe van daardie groep is dit nodig dat die **Gebruiker Poel vertrou word deur 'n Identiteit Poel** (en die besonderhede van daardie Identiteit Poel ken).

Nog 'n vereiste om die **IAM rol aangedui in die IdToken** te kry wanneer 'n gebruiker geverifieer is in die Gebruiker Poel (`aws cognito-idp initiate-auth...`) is dat die **Identiteit Verskaffer Verifikasie verskaffer** moet aandui dat die **rol uit die token gekies moet word.**

<figure><img src="../../../../.gitbook/assets/image (250).png" alt=""><figcaption></figcaption></figure>

Die **rolle** waartoe 'n gebruiker toegang het, is **binne die `IdToken`**, en 'n gebruiker kan **kies watter rol hy geloofsbriewe vir wil h√™** met die **`--custom-role-arn`** van `aws cognito-identity get-credentials-for-identity`.\
As die **standaard opsie** egter die een is wat **gekonfigureer** is (`use default role`), en jy probeer toegang kry tot 'n rol vanaf die IdToken, sal jy 'n **fout** kry (dis hoekom die vorige konfigurasie nodig is):

{% code overflow="wrap" %}
```
An error occurred (InvalidParameterException) when calling the GetCredentialsForIdentity operation: Only SAML providers and providers with RoleMappings support custom role ARN.
```
{% endcode %}

{% hint style="warning" %}
Let daarop dat die rol wat aan 'n **User Pool Group** toegewys is, **toeganklik moet wees deur die Identity Provider** wat **die User Pool vertrou** (aangesien die IAM rol **sessie geloofsbriewe daaruit verkry gaan word**).
{% endhint %}
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"Federated": "cognito-identity.amazonaws.com"
},
"Action": "sts:AssumeRoleWithWebIdentity",
"Condition": {
"StringEquals": {
"cognito-identity.amazonaws.com:aud": "us-east-1:2361092e-9db6-a876-1027-10387c9de439"
},
"ForAnyValue:StringLike": {
"cognito-identity.amazonaws.com:amr": "authenticated"
}
}
}
]
}js
```
{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
