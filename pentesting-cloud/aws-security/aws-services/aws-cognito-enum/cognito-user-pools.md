# Cognito User Pools

{% hint style="success" %}
AWS Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХреЛ рд╕рдорд░реНрдерди рджреЗрдВ</summary>

* [**subscription plans**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рд╣рдореЗрдВ **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
{% endhint %}

## Basic Information

рдПрдХ user pool Amazon Cognito рдореЗрдВ рдПрдХ user directory рд╣реИред рдПрдХ user pool рдХреЗ рд╕рд╛рде, рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ Amazon Cognito рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдЖрдкрдХреЗ рд╡реЗрдм рдпрд╛ рдореЛрдмрд╛рдЗрд▓ рдРрдк рдореЗрдВ рд╕рд╛рдЗрди рдЗрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, **рдпрд╛ рдПрдХ рддреГрддреАрдп-рдкрдХреНрд╖** рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛ (IdP) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдВрдШрдмрджреНрдз рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдЪрд╛рд╣реЗ рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реАрдзреЗ рд╕рд╛рдЗрди рдЗрди рдХрд░реЗрдВ рдпрд╛ рдХрд┐рд╕реА рддреГрддреАрдп рдкрдХреНрд╖ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ, user pool рдХреЗ рд╕рднреА рд╕рджрд╕реНрдп рдХреЗ рдкрд╛рд╕ рдПрдХ directory рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк SDK рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

User pools рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ:

* рд╕рд╛рдЗрди-рдЕрдк рдФрд░ рд╕рд╛рдЗрди-рдЗрди рд╕реЗрд╡рд╛рдПрдВред
* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕рд╛рдЗрди рдЗрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдВрддрд░реНрдирд┐рд░реНрдорд┐рдд, рдЕрдиреБрдХреВрд▓рди рдпреЛрдЧреНрдп рд╡реЗрдм UIред
* Facebook, Google, Login with Amazon, рдФрд░ Sign in with Apple рдХреЗ рд╕рд╛рде рд╕реЛрд╢рд▓ рд╕рд╛рдЗрди-рдЗрди, рдФрд░ рдЖрдкрдХреЗ user pool рд╕реЗ SAML рдФрд░ OIDC рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред
* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ directory рдкреНрд░рдмрдВрдзрди рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░реЛрдлрд╛рдЗрд▓ред
* рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд╡рд┐рдзрд╛рдПрдБ рдЬреИрд╕реЗ рдмрд╣реБ-рдХрд╛рд░рдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг (MFA), рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдЬрд╛рдВрдЪ, рдЦрд╛рддрд╛ рдЕрдзрд┐рдЧреНрд░рд╣рдг рд╕реБрд░рдХреНрд╖рд╛, рдФрд░ рдлреЛрди рдФрд░ рдИрдореЗрд▓ рд╕рддреНрдпрд╛рдкрдиред
* AWS Lambda рдЯреНрд░рд┐рдЧрд░реНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдиреБрдХреВрд▓рд┐рдд рд╡рд░реНрдХрдлрд╝реНрд▓реЛрдЬрд╝ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдорд╛рдЗрдЧреНрд░реЗрд╢рдиред

рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ **рд╕реНрд░реЛрдд рдХреЛрдб** рдЖрдорддреМрд░ рдкрд░ **user pool ID** рдФрд░ **client application ID** (рдФрд░ рдХрднреА-рдХрднреА **application secret**?) рднреА рд╢рд╛рдорд┐рд▓ рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ Cognito User Pool рдореЗрдВ **рд▓реЙрдЧрд┐рди** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддреЗ рд╣реИрдВред

### рд╕рдВрднрд╛рд╡рд┐рдд рд╣рдорд▓реЗ

* **рдкрдВрдЬреАрдХрд░рдг**: рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрд╡рдпрдВ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡рд╣ рдЕрдкрдиреЗ рд▓рд┐рдП рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред
* **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЧрдгрдирд╛**: рдкрдВрдЬреАрдХрд░рдг рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рд╣реИрдВред рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА brute-force рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреА рд╣реИред
* **рд▓реЙрдЧрд┐рди brute-force**: [**Authentication**](cognito-user-pools.md#authentication) рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╕рднреА **рд╡рд┐рдзрд┐рдпрд╛рдБ** рд╣реИрдВ рдЬрд┐рдирдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рд▓реЙрдЧрд┐рди** рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЖрдк рдЙрдиреНрд╣реЗрдВ brute-force рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ **рдорд╛рдиреНрдп рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП**ред

### Pentesting рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг

* [Pacu](https://github.com/RhinoSecurityLabs/pacu), AWS exploitation framework, рдЕрдм "cognito\_\_enum" рдФрд░ "cognito\_\_attack" рдореЙрдбреНрдпреВрд▓ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдЦрд╛рддреЗ рдореЗрдВ рд╕рднреА Cognito рд╕рдВрдкрддреНрддрд┐рдпреЛрдВ рдХреА рдЧрдгрдирд╛ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдХрдордЬреЛрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди, рдПрдХреНрд╕реЗрд╕ рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЧреБрдг рдЖрджрд┐ рдХреЛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рд░реНрдорд╛рдг (MFA рд╕рдорд░реНрдерди рд╕рд╣рд┐рдд) рдФрд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдХрд╕реНрдЯрдо рдЧреБрдгреЛрдВ, рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдкрд╣рдЪрд╛рди pool рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕, id tokens рдореЗрдВ рдЧреНрд░рд╣рдгреАрдп рднреВрдорд┐рдХрд╛рдУрдВ рдЖрджрд┐ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдХреЛ рднреА рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИред

рдореЙрдбреНрдпреВрд▓ рдХреЗ рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рд╡рд┐рд╡рд░рдг [blog post](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2) рдХреЗ рднрд╛рдЧ 2 рдореЗрдВ рджреЗрдЦреЗрдВред рд╕реНрдерд╛рдкрдирд╛ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рд▓рд┐рдП рдореБрдЦреНрдп [Pacu](https://github.com/RhinoSecurityLabs/pacu) рдкреГрд╖реНрда рджреЗрдЦреЗрдВред

#### рдЙрдкрдпреЛрдЧ

рджрд┐рдП рдЧрдП identity pool рдФрд░ user pool client рдХреЗ рдЦрд┐рд▓рд╛рдл рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рд░реНрдорд╛рдг рдФрд░ рд╕рднреА privesc рд╡реЗрдХреНрдЯрд░ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирдореВрдирд╛ cognito\_\_attack рдЙрдкрдпреЛрдЧ:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
```markdown
рд╡рд░реНрддрдорд╛рди AWS рдЦрд╛рддреЗ рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрдиреЗ рд╡рд╛рд▓реЗ рд╕рднреА user pools, user pool clients, identity pools, users, рдЖрджрд┐ рдХреЛ рдПрдХрддреНрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП cognito__enum рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдирдореВрдирд╛:
```
```bash
Pacu (new:test) > run cognito__enum
```
* [Cognito Scanner](https://github.com/padok-team/cognito-scanner) рдПрдХ CLI рдЯреВрд▓ рд╣реИ рдЬреЛ python рдореЗрдВ рд╣реИ рдФрд░ Cognito рдкрд░ рд╡рд┐рднрд┐рдиреНрди рд╣рдорд▓реЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЕрд╡рд╛рдВрдЫрд┐рдд рдЦрд╛рддрд╛ рдирд┐рд░реНрдорд╛рдг рдФрд░ рдЦрд╛рддрд╛ рдУрд░реЗрдХрд▓ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред

#### Installation
```bash
$ pip install cognito-scanner
```
#### рдЙрдкрдпреЛрдЧ

```bash
./cognito-user-pools.py -h
usage: cognito-user-pools.py [-h] -u USERNAME -p POOL_ID [-r REGION] [-d]

Cognito User Pools Enumeration

optional arguments:
  -h, --help            show this help message and exit
  -u USERNAME, --username USERNAME
                        Username to check
  -p POOL_ID, --pool-id POOL_ID
                        User pool ID
  -r REGION, --region REGION
                        AWS region
  -d, --debug           Enable debug output
```

#### Example

```bash
./cognito-user-pools.py -u test@example.com -p us-east-1_example
```

рдпрд╣ рд╕реНрдХреНрд░рд┐рдкреНрдЯ AWS Cognito User Pools рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИред
```bash
$ cognito-scanner --help
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ https://github.com/padok-team/cognito-scanner

## Registration

User Pools **рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рд░реВрдк рд╕реЗ **рдирдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкрдВрдЬреАрдХреГрдд** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред
```bash
aws cognito-idp sign-up --client-id <client-id> \
--username <username> --password <password> \
--region <region> --no-sign-request
```
#### рдпрджрд┐ рдХреЛрдИ рднреА рдкрдВрдЬреАрдХрд░рдг рдХрд░ рд╕рдХрддрд╛ рд╣реИ

рдЖрдкрдХреЛ рдПрдХ рддреНрд░реБрдЯрд┐ рдорд┐рд▓ рд╕рдХрддреА рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рд╕рдВрдХреЗрдд рджреЗрддреА рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ **рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рдкреНрд░рджрд╛рди рдХрд░рдиреЗ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ:
```
An error occurred (InvalidParameterException) when calling the SignUp operation: Attributes did not conform to the schema: address: The attribute is required
```
рдЖрдк рдЖрд╡рд╢реНрдпрдХ рд╡рд┐рд╡рд░рдг JSON рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ:

```json
{
  "UserPoolId": "us-east-1_example",
  "ClientId": "1example23456789"
}
```

### Enumerating Users

#### Using AWS CLI

AWS CLI рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:

```sh
aws cognito-idp list-users --user-pool-id us-east-1_example
```

#### Using Python and Boto3

Python рдФрд░ Boto3 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:

```python
import boto3

client = boto3.client('cognito-idp')

response = client.list_users(
    UserPoolId='us-east-1_example'
)

for user in response['Users']:
    print(user['Username'])
```

### Detecting User Existence

#### Using AWS CLI

рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЕрд╕реНрддрд┐рддреНрд╡ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:

```sh
aws cognito-idp admin-get-user --user-pool-id us-east-1_example --username example_user
```

#### Using Python and Boto3

Python рдФрд░ Boto3 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЕрд╕реНрддрд┐рддреНрд╡ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:

```python
import boto3

client = boto3.client('cognito-idp')

try:
    response = client.admin_get_user(
        UserPoolId='us-east-1_example',
        Username='example_user'
    )
    print("User exists")
except client.exceptions.UserNotFoundException:
    print("User does not exist")
```

### Conclusion

AWS Cognito User Pools рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдирд╛ рдФрд░ рдЙрдирдХреЗ рдЕрд╕реНрддрд┐рддреНрд╡ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИред рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА pentesting рдХреЗ рджреМрд░рд╛рди рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреА рд╣реИред
```json
--user-attributes '[{"Name": "email", "Value": "carlospolop@gmail.com"}, {"Name":"gender", "Value": "M"}, {"Name": "address", "Value": "street"}, {"Name": "custom:custom_name", "Value":"supername&\"*$"}]'
```
рдЖрдк рдЗрд╕ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдореМрдЬреВрджрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рдЧрд┐рдирдиреЗ** рдХреЗ рд▓рд┐рдП рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рд╡рд╣ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рд╣реИ рдЬрдм рдЙрд╕ рдирд╛рдо рдХреЗ рд╕рд╛рде рдкрд╣рд▓реЗ рд╕реЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдореМрдЬреВрдж рд╣реИ:
```
An error occurred (UsernameExistsException) when calling the SignUp operation: User already exists
```
{% hint style="info" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкрд┐рдЫрд▓реЗ рдХрдорд╛рдВрдб рдореЗрдВ **рдХрд╕реНрдЯрдо рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯреНрд╕ "custom:" рд╕реЗ рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реИрдВ**ред\
рдпрд╣ рднреА рдЬрд╛рди рд▓реЗрдВ рдХрд┐ рдЬрдм рдЖрдк рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░ рд░рд╣реЗ рд╣реЛрддреЗ рд╣реИрдВ рддреЛ рдЖрдк **рдпреВрдЬрд░ рдХреЗ рд▓рд┐рдП рдирдП рдХрд╕реНрдЯрдо рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯреНрд╕ рдирд╣реАрдВ рдмрдирд╛ рд╕рдХрддреЗ**ред рдЖрдк рдХреЗрд╡рд▓ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯреНрд╕** (рднрд▓реЗ рд╣реА рд╡реЗ рдЖрд╡рд╢реНрдпрдХ рди рд╣реЛрдВ) рдФрд░ **рд╕реНрдкреЗрд╕рд┐рдлрд╛рдЗрдб рдХрд╕реНрдЯрдо рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯреНрд╕** рдХреЛ рд╣реА рдорд╛рди рджреЗ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

рдпрд╛ рдмрд╕ рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдПрдХ client id рдореМрдЬреВрдж рд╣реИред рдпрд╣ рддреНрд░реБрдЯрд┐ рд╣реИ рдпрджрд┐ client-id рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ:
```
An error occurred (ResourceNotFoundException) when calling the SignUp operation: User pool client 3ig612gjm56p1ljls1prq2miut does not exist.
```
#### рдпрджрд┐ рдХреЗрд╡рд▓ рдПрдбрдорд┐рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ

рдЖрдкрдХреЛ рдпрд╣ рддреНрд░реБрдЯрд┐ рдорд┐рд▓реЗрдЧреА рдФрд░ рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдпрд╛ рдЧрд┐рдирддреА рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗ:
```
An error occurred (NotAuthorizedException) when calling the SignUp operation: SignUp is not permitted for this user pool
```
### рдкрдВрдЬреАрдХрд░рдг рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдирд╛

Cognito **рдирдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЙрд╕рдХреЗ рдИрдореЗрд▓ рдпрд╛ рдлреЛрди рдирдВрдмрд░ рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдХреЗ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ**ред рдЗрд╕рд▓рд┐рдП, рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдЖрдорддреМрд░ рдкрд░ рдЖрдкрдХреЛ рдХрдо рд╕реЗ рдХрдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдФрд░ **рдИрдореЗрд▓ рдФрд░/рдпрд╛ рдЯреЗрд▓реАрдлреЛрди рдирдВрдмрд░** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред рдмрд╕ рдПрдХ **рдЖрдк рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ** рд╕реЗрдЯ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЖрдк **рдЕрдкрдиреЗ** рдирдП рдмрдирд╛рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдЦрд╛рддреЗ** рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗрдВ, рдЗрд╕ рдкреНрд░рдХрд╛рд░:
```bash
aws cognito-idp confirm-sign-up --client-id <cliet_id> \
--username aasdasd2 --confirmation-code <conf_code> \
--no-sign-request --region us-east-1
```
{% hint style="warning" %}
рднрд▓реЗ рд╣реА **рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЖрдк рд╡рд╣реА рдИрдореЗрд▓** рдФрд░ рдлреЛрди рдирдВрдмрд░ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрдм рдЖрдкрдХреЛ рдмрдирд╛рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рддреЛ Cognito рдЙрд╕реА рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╢рд┐рдХрд╛рдпрдд рдХрд░реЗрдЧрд╛ рдФрд░ **рдЖрдкрдХреЛ рдЦрд╛рддрд╛ рд╕рддреНрдпрд╛рдкрд┐рдд рдирд╣реАрдВ рдХрд░рдиреЗ рджреЗрдЧрд╛**ред
{% endhint %}

### Privilege Escalation / Updating Attributes

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдЕрдкрдиреЗ рдЧреБрдгреЛрдВ рдХреЗ рдорд╛рди рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ** рдХреБрдЫ рдЗрд╕ рддрд░рд╣:
```bash
aws cognito-idp update-user-attributes \
--region us-east-1 --no-sign-request \
--user-attributes Name=address,Value=street \
--access-token <access token>
```
#### рдХрд╕реНрдЯрдо рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рдкреНрд░рд╛рдЗрд╡реЗрд╕реНрдХ

{% hint style="danger" %}
рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **рдХрд╕реНрдЯрдо рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ (рдЬреИрд╕реЗ `isAdmin`), рдХреНрдпреЛрдВрдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЖрдк **рдЕрдкрдиреЗ рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯреНрд╕ рдХреЗ рдорд╛рди рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ**, рдЖрдк **рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬ рдПрд╕реНрдХреЗрд▓реЗрдЯ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЕрдкрдиреЗ рдЖрдк рдорд╛рди рдмрджрд▓рдХрд░!
{% endhint %}

#### рдИрдореЗрд▓/рдпреВрдЬрд░рдиреЗрдо рдореЙрдбрд┐рдлрд┐рдХреЗрд╢рди рдкреНрд░рд╛рдЗрд╡реЗрд╕реНрдХ

рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдпреВрдЬрд░ рдХрд╛ рдИрдореЗрд▓ рдФрд░ рдлреЛрди рдирдВрдмрд░ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ**, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА, рднрд▓реЗ рд╣реА рдЦрд╛рддрд╛ рд╕рддреНрдпрд╛рдкрд┐рдд рд░рд╣реЗ, рд╡реЗ рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯреНрд╕ **рдЕрд╕рддреНрдпрд╛рдкрд┐рдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╕реЗрдЯ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ** (рдЖрдкрдХреЛ рдЙрдиреНрд╣реЗрдВ рдлрд┐рд░ рд╕реЗ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛)ред

{% hint style="warning" %}
рдЖрдк **рдИрдореЗрд▓ рдпрд╛ рдлреЛрди рдирдВрдмрд░ рд╕реЗ рд▓реЙрдЧрд┐рди рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗ** рдЬрдм рддрдХ рдЖрдк рдЙрдиреНрд╣реЗрдВ рд╕рддреНрдпрд╛рдкрд┐рдд рдирд╣реАрдВ рдХрд░рддреЗ, рд▓реЗрдХрд┐рди рдЖрдк **рдпреВрдЬрд░рдиреЗрдо рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░ рдкрд╛рдПрдВрдЧреЗ**ред\
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рднрд▓реЗ рд╣реА рдИрдореЗрд▓ рдмрджрд▓рд╛ рдЧрдпрд╛ рд╣реЛ рдФрд░ рд╕рддреНрдпрд╛рдкрд┐рдд рди рд╣реЛ, рдпрд╣ ID Token рдХреЗ рдЕрдВрджрд░ **`email`** **рдлреАрд▓реНрдб** рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ рдФрд░ рдлреАрд▓реНрдб **`email_verified`** **рдлреЙрд▓реНрд╕** рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдРрдк **рдпрд╣ рдЪреЗрдХ рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реИ рддреЛ рдЖрдк рдЕрдиреНрдп рдпреВрдЬрд░реНрд╕ рдХрд╛ рдкреНрд░рддрд┐рд░реВрдкрдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк **`name`** рдлреАрд▓реНрдб рдХреЗ рдЕрдВрджрд░ рдХреБрдЫ рднреА рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ рдмрд╕ **name рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ** рдХреЛ рдмрджрд▓рдХрд░ред рдЕрдЧрд░ рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ рдРрдк **рдЙрд╕** рдлреАрд▓реНрдб рдХреЛ рдЪреЗрдХ рдХрд░ рд░рд╣рд╛ рд╣реИ **`email`** (рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ) рдХреЗ рдмрдЬрд╛рдп, рддреЛ рдЖрдк **рдЕрдиреНрдп рдпреВрдЬрд░реНрд╕ рдХрд╛ рдкреНрд░рддрд┐рд░реВрдкрдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред
{% endhint %}

рд╡реИрд╕реЗ рднреА, рдЕрдЧрд░ рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ рдЖрдкрдиреЗ рдЕрдкрдирд╛ рдИрдореЗрд▓ рдмрджрд▓ рджрд┐рдпрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ рдирдП рдкрд░ рдЬрд┐рд╕реЗ рдЖрдк рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **рдЙрд╕ рдИрдореЗрд▓ рдкрддреЗ рдкрд░ рдкреНрд░рд╛рдкреНрдд рдХреЛрдб рдХреЗ рд╕рд╛рде рдИрдореЗрд▓ рдХреЛ рдХрдиреНрдлрд░реНрдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**:
```bash
aws cognito-idp verify-user-attribute \
--access-token <access_token> \
--attribute-name email --code <code> \
--region <region> --no-sign-request
```
**`phone_number`** рдХрд╛ рдЙрдкрдпреЛрдЧ **`email`** рдХреЗ рдмрдЬрд╛рдп **рдирдпрд╛ рдлреЛрди рдирдВрдмрд░** рдмрджрд▓рдиреЗ/рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВред

{% hint style="info" %}
рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкрд╕рдВрджреАрджрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХрд╛ рд╡рд┐рдХрд▓реНрдк рднреА рд╕рдХреНрд╖рдо рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк рдЗрд╕ рдорд╛рди рдХреЛ **рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдпрд╛ preferred\_username рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рдЙрдкрдпреЛрдЧ рдореЗрдВ рд╣реИ** рдореЗрдВ рдмрджрд▓рдХрд░ рдХрд┐рд╕реА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдкреНрд░рддрд┐рд░реВрдкрдг рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗред
{% endhint %}

### рдкрд╛рд╕рд╡рд░реНрдб рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд/рдмрджрд▓реЗрдВ

рдХреЗрд╡рд▓ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо** (рдпрд╛ рдИрдореЗрд▓ рдпрд╛ рдлреЛрди рд╕реНрд╡реАрдХрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ) рдЬрд╛рдирдХрд░ рдФрд░ рдЙрд╕ рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛрдиреЗ рдкрд░ рдкрд╛рд╕рд╡рд░реНрдб рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╡рд╣рд╛рдВ рдПрдХ рдХреЛрдб рднреЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛:
```bash
aws cognito-idp forgot-password \
--client-id <client_id> \
--username <username/email/phone> --region <region>
```
{% hint style="info" %}
рд╕рд░реНрд╡рд░ рдХреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╣рдореЗрд╢рд╛ рд╕рдХрд╛рд░рд╛рддреНрдордХ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдореМрдЬреВрдж рдерд╛ред рдЖрдк рдЗрд╕ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЧрд┐рдирдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ
{% endhint %}

рдХреЛрдб рдХреЗ рд╕рд╛рде рдЖрдк рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
aws cognito-idp confirm-forgot-password \
--client-id <client_id> \
--username <username> \
--confirmation-code <conf_code> \
--password <pwd> --region <region>
```
рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдкрд┐рдЫрд▓рд╛ рдкрд╛рд╕рд╡рд░реНрдб рдЬрд╛рдирдирд╛** рдЖрд╡рд╢реНрдпрдХ рд╣реИ:
```bash
aws cognito-idp change-password \
--previous-password <value> \
--proposed-password <value> \
--access-token <value>
```
## Authentication

рдПрдХ рдпреВрдЬрд░ рдкреВрд▓ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ** рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб** рд╣реИ, рддреЛ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА **рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рдзрд┐рдпрд╛рдБ** рд╕рдорд░реНрдерд┐рдд рд╣реИрдВред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ **3 рдкреНрд░рдХрд╛рд░ рдХреЗ рдЯреЛрдХрди рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ**: **ID Token**, **Access token** рдФрд░ **Refresh token**ред

* [**ID Token**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-id-token.html): рдЗрд╕рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА **рдкрд╣рдЪрд╛рди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рджрд╛рд╡реЗ** рд╣реЛрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ `name`, `email`, рдФрд░ `phone_number`ред ID рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ **рдЖрдкрдХреЗ рд╕рдВрд╕рд╛рдзрди рд╕рд░реНрд╡рд░реЛрдВ рдпрд╛ рд╕рд░реНрд╡рд░ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдЗрд╕реЗ рдмрд╛рд╣рд░реА рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ ID рдЯреЛрдХрди рдХреЗ рдЕрдВрджрд░ рдХрд┐рд╕реА рднреА рджрд╛рд╡реЗ рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ ID рдЯреЛрдХрди рдХреЗ **рд╣рд╕реНрддрд╛рдХреНрд╖рд░** рдХреЛ **рд╕рддреНрдпрд╛рдкрд┐рдд** рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред
* ID Token рд╡рд╣ рдЯреЛрдХрди рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЧреБрдгреЛрдВ рдХреЗ рдорд╛рди** рд╣реЛрддреЗ рд╣реИрдВ, рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдХрд╕реНрдЯрдо рд╡рд╛рд▓реЗ рднреАред
* [**Access Token**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-access-token.html): рдЗрд╕рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рджрд╛рд╡реЗ, **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рдореВрд╣реЛрдВ рдХреА рд╕реВрдЪреА, рдФрд░ рд╕реНрдХреЛрдк рдХреА рд╕реВрдЪреА** рд╣реЛрддреА рд╣реИред рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ **API рд╕рдВрдЪрд╛рд▓рди рдХреЛ рдЕрдзрд┐рдХреГрдд рдХрд░рдирд╛** рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдЕрдкрдиреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЧреБрдгреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ, рдмрджрд▓рдиреЗ рдпрд╛ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП **рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ** рдХреЗ рд▓рд┐рдП рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* [**Refresh Token**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-refresh-token.html): рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рдХреЗ рд╕рд╛рде рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП **рдирдП ID рдЯреЛрдХрди рдФрд░ рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдЬрдм рддрдХ рдХрд┐ **рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рдЕрдорд╛рдиреНрдп** рди рд╣реЛ рдЬрд╛рдПред **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ**, рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди **рдЖрдкрдХреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдореЗрдВ рд╕рд╛рдЗрди рдЗрди рдХрд░рдиреЗ рдХреЗ 30 рджрд┐рди рдмрд╛рдж рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ**ред рдЬрдм рдЖрдк рдЕрдкрдиреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рдХреА рд╕рдорд╛рдкреНрддрд┐ рдХреЛ **60 рдорд┐рдирдЯ рдФрд░ 10 рд╡рд░реНрд╖реЛрдВ рдХреЗ рдмреАрдЪ рдХрд┐рд╕реА рднреА рдорд╛рди** рдкрд░ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### ADMIN\_NO\_SRP\_AUTH & ADMIN\_USER\_PASSWORD\_AUTH

рдпрд╣ рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рд╡рд╛рд╣ рд╣реИ:

* рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдРрдк **`AdminInitiateAuth` API рдСрдкрд░реЗрд╢рди** рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ (`InitiateAuth` рдХреЗ рдмрдЬрд╛рдп)ред рдЗрд╕ рдСрдкрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП AWS рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдЬрд┐рдирдореЗрдВ **`cognito-idp:AdminInitiateAuth`** рдФрд░ **`cognito-idp:AdminRespondToAuthChallenge`** рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рдСрдкрд░реЗрд╢рди рдЖрд╡рд╢реНрдпрдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреИрд░рд╛рдореАрдЯрд░ рд▓реМрдЯрд╛рддрд╛ рд╣реИред
* рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдРрдк рдХреЗ рдкрд╛рд╕ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреИрд░рд╛рдореАрдЯрд░** рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рдпрд╣ **`AdminRespondToAuthChallenge` API рдСрдкрд░реЗрд╢рди** рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред `AdminRespondToAuthChallenge` API рдСрдкрд░реЗрд╢рди рдХреЗрд╡рд▓ рддрднреА рд╕рдлрд▓ рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдЖрдк AWS рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред

рдпрд╣ **рд╡рд┐рдзрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реИ**ред

рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдЬрд╛рдирдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ**:

* user pool id
* client id
* username
* password
* client secret (рдХреЗрд╡рд▓ рдпрджрд┐ рдРрдк рдХреЛ рдПрдХ рд╕реАрдХреНрд░реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ)

{% hint style="info" %}
рдЗрд╕ рд╡рд┐рдзрд┐ рд╕реЗ **рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП** рдЙрд╕ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ `ALLOW_ADMIN_USER_PASSWORD_AUTH` рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреА рдЪрд╛рд╣рд┐рдПред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рдХреНрд░рд┐рдпрд╛ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **`cognito-idp:AdminInitiateAuth`** рдФрд░ **`cognito-idp:AdminRespondToAuthChallenge`** рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред
{% endhint %}
```python
aws cognito-idp admin-initiate-auth \
--client-id <client-id> \
--auth-flow ADMIN_USER_PASSWORD_AUTH \
--region <region> \
--auth-parameters 'USERNAME=<username>,PASSWORD=<password>,SECRET_HASH=<hash_if_needed>'
--user-pool-id "<pool-id>"

# Check the python code to learn how to generate the hsecret_hash
```
<details>

<summary>рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64


client_id = "<client-id>"
user_pool_id = "<user-pool-id>"
client_secret = "<client-secret>"
username = "<username>"
password = "<pwd>"

boto_client = boto3.client('cognito-idp', region_name='us-east-1')

def get_secret_hash(username, client_id, client_secret):
key = bytes(client_secret, 'utf-8')
message = bytes(f'{username}{client_id}', 'utf-8')
return base64.b64encode(hmac.new(key, message, digestmod=hashlib.sha256).digest()).decode()

# If the Client App isn't configured to use a secret
## just delete the line setting the SECRET_HASH
def login_user(username_or_alias, password, client_id, client_secret, user_pool_id):
try:
return boto_client.admin_initiate_auth(
UserPoolId=user_pool_id,
ClientId=client_id,
AuthFlow='ADMIN_USER_PASSWORD_AUTH',
AuthParameters={
'USERNAME': username_or_alias,
'PASSWORD': password,
'SECRET_HASH': get_secret_hash(username_or_alias, client_id, client_secret)
}
)
except botocore.exceptions.ClientError as e:
return e.response

print(login_user(username, password, client_id, client_secret, user_pool_id))
```
</details>

### USER\_PASSWORD\_AUTH

рдпрд╣ рд╡рд┐рдзрд┐ рдПрдХ рдФрд░ рд╕рд░рд▓ рдФрд░ **рдкрд╛рд░рдВрдкрд░рд┐рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдкреНрд░рд╡рд╛рд╣ рд╣реИред рдпрд╣ **рдкрд╛рд░рдВрдкрд░рд┐рдХ** рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд┐рдзрд┐ рдХреЛ **Cognito рдореЗрдВ рдорд╛рдЗрдЧреНрд░реЗрдЯ** рдХрд░рдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ рдФрд░ рдлрд┐рд░ рдЗрд╕реЗ **рдЕрдХреНрд╖рдо** рдХрд░рдиреЗ рдФрд░ рдЗрд╕рдХреЗ рдмрдЬрд╛рдп **ALLOW\_USER\_SRP\_AUTH** рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ (рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдХрднреА рдирд╣реАрдВ рднреЗрдЬрддрд╛)ред\
рдпрд╣ **рд╡рд┐рдзрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рдирд╣реАрдВ** рд╣реИред

рдХреЛрдб рдХреЗ рдЕрдВрджрд░ **рдкрд┐рдЫрд▓реА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд┐рдзрд┐** рдХреЗ рд╕рд╛рде рдореБрдЦреНрдп **рдЕрдВрддрд░** рдпрд╣ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдЖрдИрдбреА рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ** рд╣реИ рдФрд░ рдЖрдкрдХреЛ Cognito User Pool рдореЗрдВ **рдЕрддрд┐рд░рд┐рдХреНрдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ** рд╣реИред

**рд▓реЙрдЧрд┐рди** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдЬрд╛рдирдирд╛** рд╣реЛрдЧрд╛:

* client id
* username
* password
* client secret (рдХреЗрд╡рд▓ рдпрджрд┐ рдРрдк рдХреЛ рдПрдХ рдЧреБрдкреНрдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ)

{% hint style="info" %}
рдЗрд╕ рд╡рд┐рдзрд┐ рд╕реЗ **рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП** рдЙрд╕ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ ALLOW\_USER\_PASSWORD\_AUTH рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреА рдЪрд╛рд╣рд┐рдПред
{% endhint %}
```python
aws cognito-idp initiate-auth  --client-id <client-id> \
--auth-flow USER_PASSWORD_AUTH --region <region> \
--auth-parameters 'USERNAME=<username>,PASSWORD=<password>,SECRET_HASH=<hash_if_needed>'

# Check the python code to learn how to generate the secret_hash
```
<details>

<summary>рд▓реЙрдЧрд┐рди рдХреЗ рд▓рд┐рдП Python рдХреЛрдб</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64


client_id = "<client-id>"
user_pool_id = "<user-pool-id>"
client_secret = "<client-secret>"
username = "<username>"
password = "<pwd>"

boto_client = boto3.client('cognito-idp', region_name='us-east-1')

def get_secret_hash(username, client_id, client_secret):
key = bytes(client_secret, 'utf-8')
message = bytes(f'{username}{client_id}', 'utf-8')
return base64.b64encode(hmac.new(key, message, digestmod=hashlib.sha256).digest()).decode()

# If the Client App isn't configured to use a secret
## just delete the line setting the SECRET_HASH
def login_user(username_or_alias, password, client_id, client_secret, user_pool_id):
try:
return boto_client.initiate_auth(
ClientId=client_id,
AuthFlow='ADMIN_USER_PASSWORD_AUTH',
AuthParameters={
'USERNAME': username_or_alias,
'PASSWORD': password,
'SECRET_HASH': get_secret_hash(username_or_alias, client_id, client_secret)
}
)
except botocore.exceptions.ClientError as e:
return e.response

print(login_user(username, password, client_id, client_secret, user_pool_id))
```
</details>

### USER\_SRP\_AUTH

рдпрд╣ рдкрд░рд┐рджреГрд╢реНрдп рдкрд┐рдЫрд▓реЗ рд╡рд╛рд▓реЗ рдХреЗ рд╕рдорд╛рди рд╣реИ рд▓реЗрдХрд┐рди **рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╛рд╕рд╡рд░реНрдб рднреЗрдЬрдиреЗ рдХреЗ рдмрдЬрд╛рдп** рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдЪреИрд▓реЗрдВрдЬ рдСрдереЗрдВрдЯрд┐рдХреЗрд╢рди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** (рдЗрд╕рд▓рд┐рдП рдкрд╛рд╕рд╡рд░реНрдб рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд░реВрдк рдореЗрдВ рднреА рдиреЗрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд╣реАрдВ рдЬрд╛рддрд╛)ред\
рдпрд╣ **рд╡рд┐рдзрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо** рд╣реИред

**рд▓реЙрдЧрд┐рди** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдЬрд╛рдирдирд╛** рд╣реЛрдЧрд╛:

* user pool id
* client id
* username
* password
* client secret (рдХреЗрд╡рд▓ рдЕрдЧрд░ рдРрдк рдХреЛ рдПрдХ рд╕реАрдХреНрд░реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ)

<details>

<summary>рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб</summary>
```python
from warrant.aws_srp import AWSSRP
import os

USERNAME='xxx'
PASSWORD='yyy'
POOL_ID='us-east-1_zzzzz'
CLIENT_ID = '12xxxxxxxxxxxxxxxxxxxxxxx'
CLIENT_SECRET = 'secreeeeet'
os.environ["AWS_DEFAULT_REGION"] = "<region>"

aws = AWSSRP(username=USERNAME, password=PASSWORD, pool_id=POOL_ID,
client_id=CLIENT_ID, client_secret=CLIENT_SECRET)
tokens = aws.authenticate_user()
id_token = tokens['AuthenticationResult']['IdToken']
refresh_token = tokens['AuthenticationResult']['RefreshToken']
access_token = tokens['AuthenticationResult']['AccessToken']
token_type = tokens['AuthenticationResult']['TokenType']
```
</details>

### REFRESH\_TOKEN\_AUTH & REFRESH\_TOKEN

рдпрд╣ **рд╡рд┐рдзрд┐ рд╣рдореЗрд╢рд╛ рдорд╛рдиреНрдп рд░рд╣реЗрдЧреА** (рдЗрд╕реЗ рдЕрдХреНрд╖рдо рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛) рд▓реЗрдХрд┐рди рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдорд╛рдиреНрдп refresh token рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред
```bash
aws cognito-idp initiate-auth \
--client-id 3ig6h5gjm56p1ljls1prq2miut \
--auth-flow REFRESH_TOKEN_AUTH \
--region us-east-1 \
--auth-parameters 'REFRESH_TOKEN=<token>'
```
<details>

<summary>рдХреЛрдб рдХреЛ рд░рд┐рдлреНрд░реЗрд╢ рдХрд░реЗрдВ</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64

client_id = "<client-id>"
token = '<token>'

boto_client = boto3.client('cognito-idp', region_name='<region>')

def refresh(client_id, refresh_token):
try:
return boto_client.initiate_auth(
ClientId=client_id,
AuthFlow='REFRESH_TOKEN_AUTH',
AuthParameters={
'REFRESH_TOKEN': refresh_token
}
)
except botocore.exceptions.ClientError as e:
return e.response


print(refresh(client_id, token))
```
</details>

### CUSTOM\_AUTH

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдПрдХ **lambda function рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

## рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд░рдХреНрд╖рд╛

### рдЙрдиреНрдирдд рд╕реБрд░рдХреНрд╖рд╛

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдпрд╣ рдЕрдХреНрд╖рдо рд╣реИ, рд▓реЗрдХрд┐рди рдпрджрд┐ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЧрдпрд╛, рддреЛ Cognito **рдЦрд╛рддреЗ рдХреЗ рдЕрдзрд┐рдЧреНрд░рд╣рдг рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддрд╛ рд╣реИ**ред рд╕рдВрднрд╛рд╡рдирд╛ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдЙрд╕реА рд╢рд╣рд░ рдХреЗ рдЕрдВрджрд░ рдПрдХ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗ, рдЙрд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдЬреЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ** (рдФрд░ рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ рддреЛ IP) рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред

### **MFA рдбрд┐рд╡рд╛рдЗрд╕ рдпрд╛рдж рд░рдЦреЗрдВ**

рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЙрд╕реА рдбрд┐рд╡рд╛рдЗрд╕ рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░рддрд╛ рд╣реИ, рддреЛ MFA рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП MFA рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрд╕реА рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╕реЗ рдЙрд╕реА рдореЗрдЯрд╛рдбреЗрдЯрд╛ (IP?) рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред

## рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рд╕рдореВрд╣ IAM рднреВрдорд┐рдХрд╛рдПрдБ

**IAM рднреВрдорд┐рдХрд╛рдУрдВ** рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓** рд╕рдореВрд╣реЛрдВ рдореЗрдВ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ** рдХреЛ рдЬреЛрдбрд╝рдирд╛ рд╕рдВрднрд╡ рд╣реИред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ** рдХреЛ **рд╡рд┐рднрд┐рдиреНрди IAM рднреВрдорд┐рдХрд╛рдУрдВ** рдХреЗ рд╕рд╛рде **1 рд╕реЗ рдЕрдзрд┐рдХ рд╕рдореВрд╣реЛрдВ** рдореЗрдВ рдЕрд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рднрд▓реЗ рд╣реА рдПрдХ рд╕рдореВрд╣ рдореЗрдВ рдПрдХ IAM рднреВрдорд┐рдХрд╛ рд╕рдВрд▓рдЧреНрди рд╣реЛ, рдЙрд╕ рд╕рдореВрд╣ рдХреА IAM рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХрд┐ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдХреЛ рдПрдХ рдкрд╣рдЪрд╛рди рдкреВрд▓ рджреНрд╡рд╛рд░рд╛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдорд╛рдирд╛ рдЬрд╛рдП** (рдФрд░ рдЙрд╕ рдкрд╣рдЪрд╛рди рдкреВрд▓ рдХрд╛ рд╡рд┐рд╡рд░рдг рдкрддрд╛ рд╣реЛ)ред

рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рд╣реЛрддрд╛ рд╣реИ (`aws cognito-idp initiate-auth...`), рддреЛ **IdToken рдореЗрдВ рдЗрдВрдЧрд┐рдд IAM рднреВрдорд┐рдХрд╛** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдФрд░ рдЖрд╡рд╢реНрдпрдХрддрд╛ рдпрд╣ рд╣реИ рдХрд┐ **рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рджрд╛рддрд╛** рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ **рднреВрдорд┐рдХрд╛ рдХреЛ рдЯреЛрдХрди рд╕реЗ рдЪреБрдирд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред**

<figure><img src="../../../../.gitbook/assets/image (250).png" alt=""><figcaption></figcaption></figure>

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рдЬрд┐рди **рднреВрдорд┐рдХрд╛рдУрдВ** рддрдХ рдкрд╣реБрдВрдЪ рд╣реИ, рд╡реЗ **`IdToken` рдХреЗ рдЕрдВрджрд░** рд╣реЛрддреА рд╣реИрдВ, рдФрд░ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **`--custom-role-arn`** рдХреЗ рд╕рд╛рде **рдХреМрди рд╕реА рднреВрдорд┐рдХрд╛ рдХреЗ рд▓рд┐рдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЪрд╛рд╣рд┐рдП** рдЪреБрди рд╕рдХрддрд╛ рд╣реИ `aws cognito-identity get-credentials-for-identity` рд╕реЗред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╡рд┐рдХрд▓реНрдк** рд╡рд╣ рд╣реИ рдЬреЛ **рдХреЙрдиреНрдлрд╝рд┐рдЧрд░** рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ (`рдбрд┐рдлрд╝реЙрд▓реНрдЯ рднреВрдорд┐рдХрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ`), рдФрд░ рдЖрдк IdToken рд╕реЗ рдПрдХ рднреВрдорд┐рдХрд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ **рддреНрд░реБрдЯрд┐** рдорд┐рд▓реЗрдЧреА (рдЗрд╕рд▓рд┐рдП рдкрд┐рдЫрд▓реА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ):

{% code overflow="wrap" %}
```
An error occurred (InvalidParameterException) when calling the GetCredentialsForIdentity operation: Only SAML providers and providers with RoleMappings support custom role ARN.
```
{% endcode %}

{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **User Pool Group** рдХреЛ рдЕрд╕рд╛рдЗрди рдХреА рдЧрдИ рднреВрдорд┐рдХрд╛ **Identity Provider** рджреНрд╡рд╛рд░рд╛ **рдПрдХреНрд╕реЗрд╕рд┐рдмрд▓** рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП рдЬреЛ **User Pool рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рддрд╛ рд╣реИ** (рдХреНрдпреЛрдВрдХрд┐ IAM рднреВрдорд┐рдХрд╛ **рд╕рддреНрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЗрд╕рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗ**).
{% endhint %}
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"Federated": "cognito-identity.amazonaws.com"
},
"Action": "sts:AssumeRoleWithWebIdentity",
"Condition": {
"StringEquals": {
"cognito-identity.amazonaws.com:aud": "us-east-1:2361092e-9db6-a876-1027-10387c9de439"
},
"ForAnyValue:StringLike": {
"cognito-identity.amazonaws.com:amr": "authenticated"
}
}
}
]
}js
```
{% hint style="success" %}
AWS Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХреЛ рд╕рдорд░реНрдерди рджреЗрдВ</summary>

* [**subscription plans**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рд╣рдореЗрдВ **Twitter** ЁЯРж рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
