# AWS - MSK Enum

{% hint style="success" %}
рдПрдбрдмреНрд▓реНрдпреВрдПрд╕ рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдПрдбрдмреНрд▓реНрдпреВрдПрд╕ рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
рдЬреАрд╕реАрдкреА рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдЬреАрд╕реАрдкреА рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдФрд░ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдХреЛ** **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕** рдФрд░ [**рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗред

</details>
{% endhint %}

## рдЕрдореЗрдЬрд╝рди рдПрдордПрд╕рдХреЗ

**рдЕрдореЗрдЬрд╝рди рдореИрдиреЗрдЬреНрдб рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдлреЙрд░ рдЕрдкрд╛рдЪреЗ рдХрд╛рдлреНрдХрд╛ (рдЕрдореЗрдЬрд╝рди рдПрдордПрд╕рдХреЗ)** рдПрдХ рд╕реЗрд╡рд╛ рд╣реИ рдЬреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рд╣реИ, рдЬреЛ **рдЕрдкрд╛рдЪреЗ рдХрд╛рдлреНрдХрд╛** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдбреЗрдЯрд╛ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдХреЗ рд╡рд┐рдХрд╛рд╕ рдФрд░ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрди рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рддреА рд╣реИред рдЕрдореЗрдЬрд╝рди рдПрдордПрд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ **рдХреНрд▓рд╕реНрдЯрд░** рдХреЗ рдирд┐рд░реНрдорд╛рдг, рдЕрдкрдбреЗрдЯ, рдФрд░ рд╣рдЯрд╛рдиреЗ рдЬреИрд╕реЗ рдХрдВрдЯреНрд░реЛрд▓-рдкреНрд▓реЗрди рдХрд╛рд░реНрдп рдкреНрд░рджрд╛рди рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред
рдпрд╣ рд╕реЗрд╡рд╛ рдЕрдкрд╛рдЪреЗ рдХрд╛рдлреНрдХрд╛ **рдбреЗрдЯрд╛-рдкреНрд▓реЗрди рдХрд╛рд░реНрдпреЛрдВ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдбреЗрдЯрд╛ рдЙрддреНрдкрд╛рджрди рдФрд░ рдЙрдкрднреЛрдХреНрддрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рдпрд╣ **рдУрдкрди-рд╕реЛрд░реНрд╕ рд╕рдВрд╕реНрдХрд░рдг** рдкрд░ рдХрд╛рдо рдХрд░рддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдореМрдЬреВрджрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди, рдЯреВрд▓рд┐рдВрдЧ, рдФрд░ рдкреНрд▓рдЧрдЗрдиреНрд╕ рдХреЗ рд╕рд╛рде рд╕рдВрдЧрддрд┐ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХреА рдЬрд╛рддреА рд╣реИ, рдЬреЛ рдЙрдкрднреЛрдХреНрддрд╛рдУрдВ рдФрд░ **рдЕрдкрд╛рдЪреЗ рдХрд╛рдлреНрдХрд╛ рд╕рдореБрджрд╛рдп** рд╕реЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛрдб рдореЗрдВ рдХреЛрдИ рдкрд░рд┐рд╡рд░реНрддрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреАред

рд╕рдВрдмрдВрдзрд┐рддрддрд╛ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЕрдореЗрдЬрд╝рди рдПрдордПрд╕рдХреЗ рдХрд╛ рдирд┐рд░реНрдорд╛рдг **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкреНрд░рдореБрдЦ рдХреНрд▓рд╕реНрдЯрд░ рд╡рд┐рдлрд▓рддрд╛ рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рдФрд░ рд╕реБрдзрд╛рд░рдирд╛** рдбреЗрдЯрд╛ рд▓реЗрдЦрди рдФрд░ рдкрдарди рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдореЗрдВ рдЕрд╡рд░реБрджреНрдзрд┐ рдХрдо рдХрд░рддреЗ рд╣реБрдП рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдпрд╣ рдЕрдкрд╛рдЪреЗ рдХрд╛рдлреНрдХрд╛ рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрдХреВрд▓рд┐рдд рдбреЗрдЯрд╛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдиреЗ рдХрд╛ рд▓рдХреНрд╖реНрдп рд░рдЦрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ **рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдмреНрд░реЛрдХрд░реЛрдВ рдХреЗ рд╕рдВрдЧреНрд░рд╣ рдХрд╛ рдкреБрдирдГ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд╕реЗ рдЕрдкрд╛рдЪреЗ рдХрд╛рдлреНрдХрд╛ рджреНрд╡рд╛рд░рд╛ рдкреБрдирдГ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдбреЗрдЯрд╛ рдХреА рдорд╛рддреНрд░рд╛ рдХреЛ рдХрдо рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### **рдкреНрд░рдХрд╛рд░**

рдПрдбрдмреНрд▓реНрдпреВрдПрд╕ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА 2 рдкреНрд░рдХрд╛рд░ рдХреА рдХрд╛рдлреНрдХрд╛ рдХреНрд▓рд╕реНрдЯрд░ рд╣реИрдВ: рдкреНрд░реЛрд╡рд┐рдЬрд╝рдиреНрдб рдФрд░ рд╕рд░реНрд╡рд░рд▓реЗрд╕ред

рд╣рдорд▓реЗрд░реНрд╕ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐:

* **рд╕рд░реНрд╡рд░рд▓реЗрд╕ рд╕реАрдзреЗ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛** (рдпрд╣ рдХреЗрд╡рд▓ рдПрдХ рд╡реАрдкреАрдПрди рдореЗрдВ рдЪрд▓ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреЛрдИ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЖрдИрдкреА рдкрддрд╛ рдирд╣реАрдВ рд╣реИ)ред рд╣рд╛рд▓рд╛рдВрдХрд┐, **рдкреНрд░реЛрд╡рд┐рдЬрд╝рдиреНрдб** рдХреЛ **рдПрдХ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЖрдИрдкреА** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдирд╣реАрдВ) рдФрд░ **рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣** рдХреЛ **рдЕрдиреБрдХрд░рдг** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╖рдпрд╕рдВрдмрдВрдзреА рдкреЛрд░реНрдЯреНрд╕ рдХреЛ **рдЙрдЬрд╛рдЧрд░** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* **рд╕рд░реНрд╡рд░рд▓реЗрд╕** рдХреЗрд╡рд▓ IAM рдХреЛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд┐рдзрд┐ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред **рдкреНрд░реЛрд╡рд┐рдЬрд╝рдиреНрдб** SASL/SCRAM (**рдкрд╛рд╕рд╡рд░реНрдб**) рдкреНрд░рдорд╛рдгреАрдХрд░рдг, **IAM** рдкреНрд░рдорд╛рдгреАрдХрд░рдг, рдПрдбрдмреНрд▓реНрдпреВрдПрд╕ **рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ** рдкреНрд░рдмрдВрдзрдХ (рдПрд╕реАрдПрдо) рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдФрд░ **рдЕрдкреНрд░рдорд╛рдгрд┐рдд** рдкрд╣реБрдВрдЪ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред
* рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдкрд╣реБрдВрдЪ рд╕рдХреНрд╖рдо рд╣реИ рддреЛ рдкреНрд░реЛрд╡рд┐рдЬрд╝рдиреНрдб рдХрд╛рдлреНрдХрд╛ рдХреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдЙрдЬрд╛рдЧрд░ рдХрд░рдирд╛ рд╕рдВрднрд╛рд╡рд┐рдд рдирд╣реАрдВ рд╣реИред

### рдЧрдгрдирд╛
```bash
#Get clusters
aws kafka list-clusters
aws kafka list-clusters-v2

# Check the supported authentication
aws kafka list-clusters |  jq -r ".ClusterInfoList[].ClientAuthentication"

# Get Zookeeper endpoints
aws kafka list-clusters | jq -r ".ClusterInfoList[].ZookeeperConnectString, .ClusterInfoList[].ZookeeperConnectStringTls"

# Get nodes and node enspoints
aws kafka kafka list-nodes --cluster-arn <cluster-arn>
aws kafka kafka list-nodes --cluster-arn <cluster-arn> | jq -r ".NodeInfoList[].BrokerNodeInfo.Endpoints" # Get endpoints

# Get used kafka configs
aws kafka list-configurations #Get Kafka config file
aws kafka describe-configuration --arn <config-arn> # Get version of config
aws kafka describe-configuration-revision --arn <config-arn> --revision <version> # Get content of config version

# If using SCRAN authentication, get used AWS secret name (not secret value)
aws kafka list-scram-secrets --cluster-arn <cluster-arn>
```
### Kafka IAM рдкрд╣реБрдВрдЪ (рд╕рд░реНрд╡рд░рд▓реЗрд╕ рдореЗрдВ)
```bash
# Guide from https://docs.aws.amazon.com/msk/latest/developerguide/create-serverless-cluster.html
# Download Kafka
wget https://archive.apache.org/dist/kafka/2.8.1/kafka_2.12-2.8.1.tgz
tar -xzf kafka_2.12-2.8.1.tgz

# In kafka_2.12-2.8.1/libs download the MSK IAM JAR file.
cd kafka_2.12-2.8.1/libs
wget https://github.com/aws/aws-msk-iam-auth/releases/download/v1.1.1/aws-msk-iam-auth-1.1.1-all.jar

# Create file client.properties in kafka_2.12-2.8.1/bin
security.protocol=SASL_SSL
sasl.mechanism=AWS_MSK_IAM
sasl.jaas.config=software.amazon.msk.auth.iam.IAMLoginModule required;
sasl.client.callback.handler.class=software.amazon.msk.auth.iam.IAMClientCallbackHandler

# Export endpoints address
export BS=boot-ok2ngypz.c2.kafka-serverless.us-east-1.amazonaws.com:9098
## Make sure you will be able to access the port 9098 from the EC2 instance (check VPS, subnets and SG)

# Create a topic called msk-serverless-tutorial
kafka_2.12-2.8.1/bin/kafka-topics.sh --bootstrap-server $BS --command-config client.properties --create --topic msk-serverless-tutorial --partitions 6

# Send message of every new line
kafka_2.12-2.8.1/bin/kafka-console-producer.sh --broker-list $BS --producer.config client.properties --topic msk-serverless-tutorial

# Read messages
kafka_2.12-2.8.1/bin/kafka-console-consumer.sh --bootstrap-server $BS --consumer.config client.properties --topic msk-serverless-tutorial --from-beginning
```
### рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░

{% content-ref url="../aws-privilege-escalation/aws-msk-privesc.md" %}
[aws-msk-privesc.md](../aws-privilege-escalation/aws-msk-privesc.md)
{% endcontent-ref %}

### рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдкрд╣реБрдВрдЪ

{% content-ref url="../aws-unauthenticated-enum-access/aws-msk-unauthenticated-enum.md" %}
[aws-msk-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-msk-unauthenticated-enum.md)
{% endcontent-ref %}

### рд╕реНрдерд┐рд░рддрд╛

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ Provisioned Kafka рдХреЗ VPC рдореЗрдВ рдкрд╣реБрдВрдЪ рд╣реИ, рддреЛ рдЖрдк **рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ** рд╕рдХрддреЗ рд╣реИрдВ, рдпрджрд┐ **SASL/SCRAM рдкреНрд░рдорд╛рдгреАрдХрд░рдг**, **рдЧреБрдкреНрдд рд╕реЗ рдкрд╛рд╕рд╡рд░реНрдб рдкрдврд╝реЗрдВ**, рдХрд┐рд╕реА **рдЕрдиреНрдп рдирд┐рдпрдВрддреНрд░рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ IAM рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рджреЗрдВ (рдпрджрд┐ IAM рдпрд╛ рд╕рд░реНрд╡рд░рд▓реЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ) рдпрд╛ **рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ** рдХреЗ рд╕рд╛рде рд╕реНрдерд┐рд░ рд░рд╣реЗрдВред

## рд╕рдВрджрд░реНрдн

* [https://docs.aws.amazon.com/msk/latest/developerguide/what-is-msk.html](https://docs.aws.amazon.com/msk/latest/developerguide/what-is-msk.html)

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдФрд░ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдХреЛ** **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
{% endhint %}
