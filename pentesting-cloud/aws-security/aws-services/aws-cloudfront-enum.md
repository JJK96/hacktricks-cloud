# AWS - Enumeraci칩n de CloudFront

{% hint style="success" %}
Aprende y practica Hacking en AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}

## CloudFront

CloudFront es la **red de entrega de contenido de AWS que acelera la distribuci칩n** de tu contenido est치tico y din치mico a trav칠s de su red mundial de ubicaciones de borde. Cuando utilizas una solicitud de contenido que est치s alojando a trav칠s de Amazon CloudFront, la solicitud se dirige a la ubicaci칩n de borde m치s cercana que proporciona la latencia m치s baja para ofrecer el mejor rendimiento. Cuando se habilitan los **registros de acceso de CloudFront**, puedes registrar la solicitud de cada usuario que solicita acceso a tu sitio web y distribuci칩n. Al igual que con los registros de acceso de S3, estos registros tambi칠n se **almacenan en Amazon S3 para un almacenamiento duradero y persistente**. No hay cargos por habilitar el registro en s칤, sin embargo, como los registros se almacenan en S3, se almacenar치n por el almacenamiento utilizado por S3.

Los archivos de registro capturan datos durante un per칤odo de tiempo y dependiendo de la cantidad de solicitudes que recibe Amazon CloudFront para esa distribuci칩n, depender치 de la cantidad de archivos de registro que se generen. Es importante saber que estos archivos de registro no se crean ni se escriben en S3. S3 es simplemente donde se entregan una vez que el archivo de registro est치 lleno. **Amazon CloudFront retiene estos registros hasta que est칠n listos para ser entregados a S3**. Nuevamente, dependiendo del tama침o de estos archivos de registro, esta entrega puede tardar **entre una y 24 horas**.

**Por defecto, el registro de cookies est치 deshabilitado** pero puedes habilitarlo.

### Funciones

Puedes crear funciones en CloudFront. Estas funciones tendr치n su **punto final en cloudfront** definido y ejecutar치n un **c칩digo NodeJS** declarado. Este c칩digo se ejecutar치 dentro de un **sandbox** en una m치quina que se ejecuta bajo una m치quina administrada por AWS (necesitar칤as un bypass de sandbox para lograr escapar al sistema operativo subyacente).

Como las funciones no se ejecutan en la cuenta de AWS de los usuarios, no se adjunta ning칰n rol de IAM, por lo que no es posible realizar una escalada de privilegios directa abusando de esta caracter칤stica.

### Enumeraci칩n
```bash
aws cloudfront list-distributions
aws cloudfront get-distribution --id <id> # Just get 1
aws cloudfront get-distribution-config --id <id>

aws cloudfront list-functions
aws cloudfront get-function --name TestFunction function_code.js

aws cloudfront list-distributions | jq ".DistributionList.Items[] | .Id, .Origins.Items[].Id, .Origins.Items[].DomainName, .AliasICPRecordals[].CNAME"
```
## Acceso no autenticado

{% content-ref url="../aws-unauthenticated-enum-access/aws-cloudfront-unauthenticated-enum.md" %}
[aws-cloudfront-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-cloudfront-unauthenticated-enum.md)
{% endcontent-ref %}

## Post Explotaci칩n

{% content-ref url="../aws-post-exploitation/aws-cloudfront-post-exploitation.md" %}
[aws-cloudfront-post-exploitation.md](../aws-post-exploitation/aws-cloudfront-post-exploitation.md)
{% endcontent-ref %}

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
