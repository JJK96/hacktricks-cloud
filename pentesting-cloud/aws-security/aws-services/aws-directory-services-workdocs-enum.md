# AWS - Υπηρεσίες Καταλόγου / Απαρίθμηση WorkDocs

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 στην [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ καταχωρώντας PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Υπηρεσίες Καταλόγου

Η Υπηρεσία Καταλόγου AWS για το Microsoft Active Directory είναι μια διαχειριζόμενη υπηρεσία που καθιστά εύκολη τη **δημιουργία, λειτουργία και κλιμάκωση ενός καταλόγου** στο AWS Cloud. Είναι βασισμένη στο πραγματικό **Microsoft Active Directory** και ενσωματώνεται στενά με άλλες υπηρεσίες του AWS, κάνοντας εύκολη τη διαχείριση των φορτίων εργασίας που βασίζονται στον κατάλογο και των πόρων του AWS. Με το AWS Managed Microsoft AD, μπορείτε **να χρησιμοποιήσετε τους υπάρχοντες** χρήστες, ομάδες και πολιτικές του Active Directory για τη διαχείριση της πρόσβασης στους πόρους του AWS σας. Αυτό μπορεί να βοηθήσει στην απλοποίηση της διαχείρισης ταυτότητας σας και στη μείωση της ανάγκης για επιπλέον λύσεις ταυτότητας. Το AWS Managed Microsoft AD παρέχει επίσης αυτόματα αντίγραφα ασφαλείας και δυνατότητες ανάκτησης μετά από καταστροφή, βοηθώντας στη διασφάλιση της διαθεσιμότητας και της ανθεκτικότητας του καταλόγου σας. Συνολικά, η Υπηρεσία Καταλόγου AWS για το Microsoft Active Directory μπορεί να σας βοηθήσει να εξοικονομήσετε χρόνο και πόρους παρέχοντας μια διαχειριζόμενη, υψηλής διαθεσιμότητας και κλιμάκωσης υπηρεσία Active Directory στο AWS Cloud.

### Επιλογές

Η Υπηρεσία Καταλόγου επιτρέπει τη δημιουργία 5 τύπων καταλόγων:

* **AWS Managed Microsoft AD**: Ο οποίος θα εκτελέσει ένα νέο **Microsoft AD στο AWS**. Θα μπορείτε να ορίσετε τον κωδικό διαχειριστή και να έχετε πρόσβαση στα DCs σε ένα VPC.
* **Simple AD**: Ο οποίος θα είναι ένας **Linux-Samba** διακομιστής συμβατός με το Active Directory. Θα μπορείτε να ορίσετε τον κωδικό διαχειριστή και να έχετε πρόσβαση στα DCs σε ένα VPC.
* **AD Connector**: Ένας διαμεσολαβητής για την **ανακατεύθυνση αιτημάτων καταλόγου στο υπάρχον Microsoft Active Directory** χωρίς να αποθηκεύει κάποιες πληροφορίες στο cloud. Θα είναι σε ακρόαση σε ένα **VPC** και θα χρειαστείτε **διαπιστευτήρια για πρόσβαση στο υπάρχον AD**.
* **Amazon Cognito User Pools**: Αυτό είναι το ίδιο με τα Cognito User Pools.
* **Cloud Directory**: Αυτός είναι ο **απλούστερος**. Ένας κατάλογος **serverless** όπου υποδεικνύετε το **σχήμα** που θα χρησιμοποιηθεί και χρεώνεστε ανάλογα με τη χρήση.

Οι υπηρεσίες καταλόγου του AWS επιτρέπουν τη **συγχρονισμό** με τον υπάρχοντα **on-premises** Microsoft AD σας, τη **λειτουργία του δικού σας** στο AWS ή τον συγχρονισμό με **άλλους τύπους καταλόγων**.

### Εργαστήριο

Εδώ μπορείτε να βρείτε ένα ωραίο εγχειρίδιο για τη δημιουργία του δικού σας Microsoft AD στο AWS: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html)

### Απαρίθμηση
```bash
# Get directories and DCs
aws ds describe-directories
aws ds describe-domain-controllers --directory-id <id>
# Get directory settings
aws ds describe-trusts
aws ds describe-ldaps-settings --directory-id <id>
aws ds describe-shared-directories --owner-directory-id <id>
aws ds get-directory-limits
aws ds list-certificates --directory-id <id>
aws ds describe-certificate --directory-id <id> --certificate-id <id>
```
### Σύνδεση

Σημειώστε ότι αν η **περιγραφή** του καταλόγου περιείχε ένα **domain** στο πεδίο **`AccessUrl`** είναι επειδή ένας **χρήστης** μπορεί πιθανόν να **συνδεθεί** με τα **AD διαπιστευτήριά του** σε κάποιες **υπηρεσίες AWS:**

- `<name>.awsapps.com/connect` (Amazon Connect)
- `<name>.awsapps.com/workdocs` (Amazon WorkDocs)
- `<name>.awsapps.com/workmail` (Amazon WorkMail)
- `<name>.awsapps.com/console` (Amazon Management Console)
- `<name>.awsapps.com/start` (IAM Identity Center)

### Ανόδος Προνομίων

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md" %}
[aws-directory-services-privesc.md](../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md)
{% endcontent-ref %}

## Διατήρηση

### Χρήση ενός χρήστη AD

Ένας **χρήστης AD** μπορεί να δοθεί **πρόσβαση στον πίνακα διαχείρισης AWS** μέσω ενός Ρόλου προς υπόθεση. Το **προεπιλεγμένο όνομα χρήστη είναι Admin** και είναι δυνατόν να **αλλάξετε τον κωδικό πρόσβασης** από τον πίνακα διαχείρισης της AWS.

Συνεπώς, είναι δυνατόν να **αλλάξετε τον κωδικό του Admin**, **να δημιουργήσετε ένα νέο χρήστη** ή **να αλλάξετε τον κωδικό** ενός χρήστη και να του δώσετε ένα Ρόλο για να διατηρήσει την πρόσβαση.\
Είναι επίσης δυνατόν να **προσθέσετε ένα χρήστη σε μια ομάδα μέσα στο AD** και **να δώσετε σε αυτή την ομάδα AD πρόσβαση σε ένα Ρόλο** (για να κάνετε αυτή τη διατήρηση πιο αόρατη).

### Κοινοποίηση AD (από θύμα σε επιτιθέμενο)

Είναι δυνατόν να κοινοποιήσετε ένα περιβάλλον AD από ένα θύμα σε έναν επιτιθέμενο. Με αυτόν τον τρόπο ο επιτιθέμενος θα μπορεί να συνεχίσει να έχει πρόσβαση στο περιβάλλον AD.\
Ωστόσο, αυτό σημαίνει την κοινοποίηση του διαχειριζόμενου AD και τη δημιουργία μιας σύνδεσης VPC peering.

Μπορείτε να βρείτε έναν οδηγό εδώ: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html)

### ~~Κοινοποίηση AD (από επιτιθέμενο σε θύμα)~~

Δεν φαίνεται δυνατό να δοθεί πρόσβαση AWS σε χρήστες από διαφορετικό περιβάλλον AD σε ένα λογαριασμό AWS. 

## WorkDocs

Το Amazon Web Services (AWS) WorkDocs είναι ένα υπηρεσία αποθήκευσης και κοινοποίησης αρχείων στο cloud. Ανήκει στη σουίτα υπηρεσιών υπολογιστικού cloud της AWS και σχεδιάστηκε για να παρέχει μια ασφαλή και κλιμακούμενη λύση για οργανισμούς να αποθηκεύουν, να μοιράζονται και να συνεργάζονται σε αρχεία και έγγραφα.

Το AWS WorkDocs παρέχει μια διαδικτυακή διεπαφή για τους χρήστες να ανεβάζουν, να έχουν πρόσβαση και να διαχειρίζονται τα αρχεία και τα έγγραφά τους. Προσφέρει επίσης χαρακτηριστικά όπως έλεγχος εκδόσεων, συνεργασία σε πραγματικό χρόνο και ενσωμάτωση με άλλες υπηρεσίες της AWS και εργαλεία τρίτων.

### Απαρίθμηση

{% code overflow="wrap" %}
```bash
# Get AD users (Admin not included)
aws workdocs describe-users --organization-id <directory-id>
# Get AD groups (containing "a")
aws workdocs describe-groups --organization-id d-9067a0285c --search-query a

# Create user (created inside the AD)
aws workdocs create-user --username testingasd --given-name testingasd --surname testingasd --password <password> --email-address name@directory.domain --organization-id <directory-id>

# Get what each user has created
aws workdocs describe-activities --user-id "S-1-5-21-377..."

# Get what was created in the directory
aws workdocs describe-activities --organization-id <directory-id>

# Get folder content
aws workdocs describe-folder-contents --folder-id <fold-id>

# Get file (a url to access with the content will be retreived)
aws workdocs get-document --document-id <doc-id>

# Get resource permissions if any
aws workdocs describe-resource-permissions --resource-id <value>

# Add permission so anyway can see the file
aws workdocs add-resource-permissions --resource-id <id> --principals Id=anonymous,Type=ANONYMOUS,Role=VIEWER
## This will give an id, the file will be acesible in: https://<name>.awsapps.com/workdocs/index.html#/share/document/<id>
```
{% endcode %}

### Ανύψωση δικαιωμάτων

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md" %}
[aws-workdocs-privesc.md](../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md)
{% endcontent-ref %}

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking στο AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking στο GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** στην 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ υποβάλλοντας PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
