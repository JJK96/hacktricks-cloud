# AWS - Dizin Hizmetleri / WorkDocs Enum

{% hint style="success" %}
AWS Hacking'ı öğrenin ve uygulayın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'ini öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking püf noktalarını paylaşarak PR'ler göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
{% endhint %}

## Dizin Hizmetleri

AWS Directory Service for Microsoft Active Directory, AWS Cloud'da bir dizini **kurmayı, işletmeyi ve ölçeklendirmeyi** kolaylaştıran yönetilen bir hizmettir. Gerçek **Microsoft Active Directory** üzerine inşa edilmiş olup diğer AWS hizmetleriyle sıkı entegrasyon sağlar, bu da dizin tabanlı iş yüklerinizi ve AWS kaynaklarını yönetmeyi kolaylaştırır. AWS Yönetilen Microsoft AD ile **mevcut** Active Directory kullanıcıları, grupları ve politikalarını AWS kaynaklarına erişimi yönetmek için kullanabilirsiniz. Bu, kimlik yönetimini basitleştirmenize ve ek kimlik çözümlerine duyulan ihtiyacı azaltmanıza yardımcı olabilir. AWS Yönetilen Microsoft AD ayrıca otomatik yedekleme ve felaket kurtarma yetenekleri sağlayarak dizininizin kullanılabilirliğini ve dayanıklılığını sağlamaya yardımcı olur. Genel olarak, AWS Directory Service for Microsoft Active Directory, AWS Cloud'da yönetilen, yüksek kullanılabilirlikli ve ölçeklenebilir bir Active Directory hizmeti sağlayarak zaman ve kaynak tasarrufu yapmanıza yardımcı olabilir.

### Seçenekler

Dizin Hizmetleri, 5 tür dizin oluşturmanıza izin verir:

* **AWS Yönetilen Microsoft AD**: AWS'de yeni bir **Microsoft AD çalıştıracak**. Yönetici şifresini belirleyebilecek ve bir VPC'deki DC'lere erişebileceksiniz.
* **Basit AD**: Bir **Linux-Samba** Active Directory uyumlu sunucu olacak. Yönetici şifresini belirleyebilecek ve bir VPC'deki DC'lere erişebileceksiniz.
* **AD Bağlayıcı**: Bulutta herhangi bir bilgiyi önbelleğe almadan **mevcut Microsoft Active Directory'e yönlendirme dizin istekleri için bir proxy**. Bir **VPC** içinde dinleyecek ve mevcut AD'ye erişim vermek için **kimlik bilgilerini vermeniz gerekecek**.
* **Amazon Cognito Kullanıcı Havuzları**: Bu, Cognito Kullanıcı Havuzları ile aynıdır.
* **Cloud Dizini**: Bu, **en basit** olanıdır. Kullanılacak **şemayı belirttiğiniz ve kullanıma göre faturalandırıldığınız** bir **sunucusuz** dizin.

AWS Dizin hizmetleri, mevcut **yerindeki** Microsoft AD'nizle **senkronize etmenize**, AWS'de **kendi AD'nizi çalıştırmanıza** veya **diğer dizin türleriyle senkronize etmenize** olanak tanır.

### Laboratuvar

AWS'de kendi Microsoft AD'nizi oluşturmak için güzel bir öğreticiye buradan ulaşabilirsiniz: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html)

### Numaralandırma
```bash
# Get directories and DCs
aws ds describe-directories
aws ds describe-domain-controllers --directory-id <id>
# Get directory settings
aws ds describe-trusts
aws ds describe-ldaps-settings --directory-id <id>
aws ds describe-shared-directories --owner-directory-id <id>
aws ds get-directory-limits
aws ds list-certificates --directory-id <id>
aws ds describe-certificate --directory-id <id> --certificate-id <id>
```
### Giriş

Dikkat edilmesi gereken bir nokta, **dizin**nin **`AccessUrl`** alanında bir **alan** içeriyorsa, bir **kullanıcının** muhtemelen **AD kimlik bilgileriyle giriş yapabileceği bazı **AWS hizmetleri**:

- `<name>.awsapps.com/connect` (Amazon Connect)
- `<name>.awsapps.com/workdocs` (Amazon WorkDocs)
- `<name>.awsapps.com/workmail` (Amazon WorkMail)
- `<name>.awsapps.com/console` (Amazon Yönetim Konsolu)
- `<name>.awsapps.com/start` (IAM Kimlik Merkezi)

### Yetki Yükseltme

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md" %}
[aws-directory-services-privesc.md](../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md)
{% endcontent-ref %}

## Kalıcılık

### Bir AD kullanıcısı kullanarak

Bir **AD kullanıcısına**, bir Rol aracılığıyla **AWS yönetim konsoluna erişim verilebilir**. **Varsayılan kullanıcı adı Admin'dir** ve AWS konsolundan **şifresi değiştirilebilir**.

Bu nedenle, **Admin'in şifresi değiştirilebilir**, **yeni bir kullanıcı oluşturulabilir** veya bir kullanıcının şifresi değiştirilebilir ve bu kullanıcıya erişimi sürdürmesi için bir Rol verilebilir.\
Ayrıca, bir kullanıcıyı AD içinde bir gruba eklemek ve bu AD grubuna bir Rol erişimi vermek de mümkündür (bu kalıcılığı daha gizli hale getirmek için).

### AD paylaşımı (kurbandan saldırgana)

Bir AD ortamını kurbandan saldırgana paylaşmak mümkündür. Bu şekilde saldırgan, AD ortamına erişmeye devam edebilecektir.\
Ancak, bu yöntem yönetilen AD'nin paylaşılmasını ve ayrıca bir VPC eşleme bağlantısı oluşturulmasını gerektirir.

Bir kılavuz burada bulunabilir: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html)

### ~~AD paylaşımı (saldırgandan kurbandan)~~

Farklı bir AD ortamından kullanıcılara AWS erişimi vermek mümkün görünmemektedir.

## WorkDocs

Amazon Web Services (AWS) WorkDocs, bulut tabanlı bir **dosya depolama ve paylaşma hizmetidir**. AWS bulut bilişim hizmetleri paketinin bir parçasıdır ve organizasyonların dosya ve belgeleri depolamak, paylaşmak ve işbirliği yapmak için güvenli ve ölçeklenebilir bir çözüm sunmak üzere tasarlanmıştır.

AWS WorkDocs, kullanıcıların dosyalarını ve belgelerini yüklemelerine, erişmelerine ve yönetmelerine olanak tanıyan web tabanlı bir arayüz sunar. Ayrıca sürüm kontrolü, gerçek zamanlı işbirliği ve diğer AWS hizmetleri ile ve üçüncü taraf araçlarla entegrasyon gibi özellikler sunar.

### Numaralandırma

{% code overflow="wrap" %}
```bash
# Get AD users (Admin not included)
aws workdocs describe-users --organization-id <directory-id>
# Get AD groups (containing "a")
aws workdocs describe-groups --organization-id d-9067a0285c --search-query a

# Create user (created inside the AD)
aws workdocs create-user --username testingasd --given-name testingasd --surname testingasd --password <password> --email-address name@directory.domain --organization-id <directory-id>

# Get what each user has created
aws workdocs describe-activities --user-id "S-1-5-21-377..."

# Get what was created in the directory
aws workdocs describe-activities --organization-id <directory-id>

# Get folder content
aws workdocs describe-folder-contents --folder-id <fold-id>

# Get file (a url to access with the content will be retreived)
aws workdocs get-document --document-id <doc-id>

# Get resource permissions if any
aws workdocs describe-resource-permissions --resource-id <value>

# Add permission so anyway can see the file
aws workdocs add-resource-permissions --resource-id <id> --principals Id=anonymous,Type=ANONYMOUS,Role=VIEWER
## This will give an id, the file will be acesible in: https://<name>.awsapps.com/workdocs/index.html#/share/document/<id>
```
{% endcode %}

### İst Privileges

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md" %}
[aws-workdocs-privesc.md](../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md)
{% endcontent-ref %}

{% hint style="success" %}
AWS Hacking'i öğrenin ve uygulayın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking püf noktalarını paylaşarak PR göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ve** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github depolarına katkıda bulunun.**

</details>
{% endhint %}
