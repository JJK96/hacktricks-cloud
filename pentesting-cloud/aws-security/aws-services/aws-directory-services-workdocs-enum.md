# AWS - Directory Services / WorkDocs Enum

{% hint style="success" %}
Učite i vežbajte hakovanje AWS-a:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Obuka AWS Crveni Tim Ekspert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Učite i vežbajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Obuka GCP Crveni Tim Ekspert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Pomozite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Directory Services

AWS Directory Service za Microsoft Active Directory je upravljana usluga koja olakšava **postavljanje, upravljanje i skaliranje direktorijuma** u AWS oblaku. Izgrađena je na stvarnom **Microsoft Active Directory-u** i čvrsto se integriše sa drugim AWS uslugama, čime se olakšava upravljanje vašim radnim opterećenjima koja zahtevaju direktorijume i AWS resursima. Sa AWS Managed Microsoft AD, možete **koristiti vaše postojeće** Active Directory korisnike, grupe i politike za upravljanje pristupom vašim AWS resursima. Ovo može olakšati upravljanje identitetima i smanjiti potrebu za dodatnim rešenjima za identitet. AWS Managed Microsoft AD takođe pruža automatske rezervne kopije i mogućnosti oporavka od katastrofe, pomažući da se obezbedi dostupnost i trajnost vašeg direktorijuma. Sveukupno, AWS Directory Service za Microsoft Active Directory može vam pomoći da uštedite vreme i resurse pružajući upravljenu, visoko dostupnu i skalabilnu uslugu Active Directory-a u AWS oblaku.

### Opcije

Directory Services omogućava kreiranje 5 vrsta direktorijuma:

* **AWS Managed Microsoft AD**: Koja će pokrenuti novi **Microsoft AD u AWS-u**. Bićete u mogućnosti da postavite administratorsku lozinku i pristupite DC-ima u VPC-u.
* **Simple AD**: Koja će biti **Linux-Samba** Active Directory–kompatibilni server. Bićete u mogućnosti da postavite administratorsku lozinku i pristupite DC-ima u VPC-u.
* **AD Connector**: Proxy za **preusmeravanje zahteva direktorijuma ka vašem postojećem Microsoft Active Directory-u** bez keširanja bilo koje informacije u oblaku. Slušaće u **VPC-u** i morate dati **poverljive podatke za pristup postojećem AD-u**.
* **Amazon Cognito User Pools**: Ovo je isto što i Cognito User Pools.
* **Cloud Directory**: Ovo je **najjednostavniji**. Serverless direktorijum gde naznačujete **šemu** koju želite da koristite i plaćate se **prema korišćenju**.

AWS Directory Services omogućava **sinhronizaciju** sa vašim postojećim **on-premises** Microsoft AD-om, **pokretanje vašeg sopstvenog** u AWS-u ili sinhronizaciju sa **drugim vrstama direktorijuma**.

### Laboratorija

Ovde možete pronaći lep tutorijal za kreiranje vašeg Microsoft AD-a u AWS-u: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html)

### Enumeracija
```bash
# Get directories and DCs
aws ds describe-directories
aws ds describe-domain-controllers --directory-id <id>
# Get directory settings
aws ds describe-trusts
aws ds describe-ldaps-settings --directory-id <id>
aws ds describe-shared-directories --owner-directory-id <id>
aws ds get-directory-limits
aws ds list-certificates --directory-id <id>
aws ds describe-certificate --directory-id <id> --certificate-id <id>
```
### Prijavljivanje

Imajte na umu da ako **opis** direktorijuma sadrži **domen** u polju **`AccessUrl`**, to je zato što **korisnik** verovatno može **da se prijavi** sa svojim **AD pristupnim podacima** na neke **AWS usluge:**

* `<name>.awsapps.com/connect` (Amazon Connect)
* `<name>.awsapps.com/workdocs` (Amazon WorkDocs)
* `<name>.awsapps.com/workmail` (Amazon WorkMail)
* `<name>.awsapps.com/console` (Amazon Management Console)
* `<name>.awsapps.com/start` (IAM Identity Center)

### Eskalacija privilegija

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md" %}
[aws-directory-services-privesc.md](../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md)
{% endcontent-ref %}

## Upornost

### Korišćenje AD korisnika

**AD korisniku** se može dati **pristup preko AWS upravljačke konzole** putem uloge koju preuzima. **Podrazumevano korisničko ime je Admin** i moguće je **promeniti njegovu lozinku** sa AWS konzole.

Stoga je moguće **promeniti lozinku Admina**, **kreirati novog korisnika** ili **promeniti lozinku** korisnika i dodeliti tom korisniku ulogu za održavanje pristupa.\
Takođe je moguće **dodati korisnika u grupu unutar AD** i **dodeliti toj AD grupi pristup ulozi** (da bi se ova upornost učinila diskretnijom).

### Deljenje AD (od žrtve ka napadaču)

Moguće je deliti AD okruženje od žrtve ka napadaču. Na ovaj način, napadač će moći nastaviti pristupati AD okruženju.\
Međutim, ovo podrazumeva deljenje upravljanih AD i takođe kreiranje VPC peering veze.

Možete pronaći vodič ovde: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html)

### ~~Deljenje AD (od napadača ka žrtvi)~~

Ne izgleda moguće omogućiti pristup AWS korisnicima iz različitih AD okruženja jednom AWS nalogu.

## WorkDocs

Amazon Web Services (AWS) WorkDocs je cloud-based **servis za skladištenje i deljenje fajlova**. Deo je AWS paketa cloud computing usluga i dizajniran je da pruži sigurno i skalabilno rešenje organizacijama za skladištenje, deljenje i saradnju na fajlovima i dokumentima.

AWS WorkDocs pruža web interfejs korisnicima za otpremanje, pristup i upravljanje njihovim fajlovima i dokumentima. Takođe nudi funkcije kao što su kontrola verzija, saradnja u realnom vremenu i integracija sa drugim AWS uslugama i alatima trećih strana.

### Enumeracija

{% code overflow="wrap" %}
```bash
# Get AD users (Admin not included)
aws workdocs describe-users --organization-id <directory-id>
# Get AD groups (containing "a")
aws workdocs describe-groups --organization-id d-9067a0285c --search-query a

# Create user (created inside the AD)
aws workdocs create-user --username testingasd --given-name testingasd --surname testingasd --password <password> --email-address name@directory.domain --organization-id <directory-id>

# Get what each user has created
aws workdocs describe-activities --user-id "S-1-5-21-377..."

# Get what was created in the directory
aws workdocs describe-activities --organization-id <directory-id>

# Get folder content
aws workdocs describe-folder-contents --folder-id <fold-id>

# Get file (a url to access with the content will be retreived)
aws workdocs get-document --document-id <doc-id>

# Get resource permissions if any
aws workdocs describe-resource-permissions --resource-id <value>

# Add permission so anyway can see the file
aws workdocs add-resource-permissions --resource-id <id> --principals Id=anonymous,Type=ANONYMOUS,Role=VIEWER
## This will give an id, the file will be acesible in: https://<name>.awsapps.com/workdocs/index.html#/share/document/<id>
```
{% endcode %}

### Povećanje privilegija

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md" %}
[aws-workdocs-privesc.md](../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md)
{% endcontent-ref %}

{% hint style="success" %}
Naučite i vežbajte hakovanje AWS-a:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Obuka AWS Crveni Tim Ekspert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Naučite i vežbajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Obuka GCP Crveni Tim Ekspert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
