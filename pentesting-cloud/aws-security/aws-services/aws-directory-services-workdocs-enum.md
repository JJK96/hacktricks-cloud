# AWS - Gidsdienste / WorkDocs Enum

{% hint style="success" %}
Leer & oefen AWS Hack: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hack: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Controleer die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
{% endhint %}

## Gidsdienste

AWS Gidsdiens vir Microsoft Active Directory is 'n bestuurde diens wat dit maklik maak om 'n gids op te **stel, te bedryf en te skaal** in die AWS-wolke. Dit is gebou op werklike **Microsoft Active Directory** en integreer nou met ander AWS-dienste, wat dit maklik maak om jou gidsbewuste werklaste en AWS-hulpbronne te bestuur. Met AWS Bestuurde Microsoft AD kan jy **jou bestaande** Active Directory-gebruikers, groepe en beleide gebruik om toegang tot jou AWS-hulpbronne te bestuur. Dit kan help om jou identiteitsbestuur te vereenvoudig en die behoefte aan addisionele identiteitsoplossings te verminder. AWS Bestuurde Microsoft AD bied ook outomatiese rugsteun en rampherstelvermo√´ns, wat help om die beskikbaarheid en duursaamheid van jou gids te verseker. Oor die algemeen kan AWS Gidsdiens vir Microsoft Active Directory jou tyd en hulpbronne bespaar deur 'n bestuurde, hoogs beskikbare en skaalbare Active Directory-diens in die AWS-wolke te bied.

### Opsies

Gidsdienste maak dit moontlik om 5 soorte gidse te skep:

* **AWS Bestuurde Microsoft AD**: Wat 'n nuwe **Microsoft AD in AWS** sal hardloop. Jy sal die admin-wagwoord kan instel en toegang tot die DC's in 'n VPC h√™.
* **Eenvoudige AD**: Wat 'n **Linux-Samba** Active Directory-verenigbare bediener sal wees. Jy sal die admin-wagwoord kan instel en toegang tot die DC's in 'n VPC h√™.
* **AD-konnekteerder**: 'n proksi vir **omleiding van gidsversoeke na jou bestaande Microsoft Active Directory** sonder om enige inligting in die wolk te kombineer. Dit sal in 'n **VPC** luister en jy moet **gelde gee om toegang tot die bestaande AD** te kry.
* **Amazon Cognito-gebruikerspoele**: Dit is dieselfde as Cognito-gebruikerspoele.
* **Wolkgids**: Dit is die **eenvoudigste** een. 'n **Bedienerlose** gids waar jy die **skema** aandui om te gebruik en volgens die gebruik **gefaktureer word**.

AWS Gidsdiens maak dit moontlik om te **sinchroniseer** met jou bestaande **plaaslike** Microsoft AD, **jou eie een** in AWS te laat loop of te sinchroniseer met **ander gidstipes**.

### Laboratorium

Hier kan jy 'n goeie handleiding vind om jou eie Microsoft AD in AWS te skep: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html)

### Enumerasie
```bash
# Get directories and DCs
aws ds describe-directories
aws ds describe-domain-controllers --directory-id <id>
# Get directory settings
aws ds describe-trusts
aws ds describe-ldaps-settings --directory-id <id>
aws ds describe-shared-directories --owner-directory-id <id>
aws ds get-directory-limits
aws ds list-certificates --directory-id <id>
aws ds describe-certificate --directory-id <id> --certificate-id <id>
```
### Aantekening

Let daarop dat as die **beskrywing** van die gids 'n **domein** in die veld **`AccessUrl`** bevat, is dit omdat 'n **gebruiker** waarskynlik met sy **AD-legitimasie** in sommige **AWS-diens kan **aanmeld**:

* `<name>.awsapps.com/connect` (Amazon Connect)
* `<name>.awsapps.com/workdocs` (Amazon WorkDocs)
* `<name>.awsapps.com/workmail` (Amazon WorkMail)
* `<name>.awsapps.com/console` (Amazon-bestuurskonsole)
* `<name>.awsapps.com/start` (IAM Identiteitsentrum)

### Voorregverhoging

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md" %}
[aws-directory-services-privesc.md](../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md)
{% endcontent-ref %}

## Volharding

### Gebruik van 'n AD-gebruiker

'n **AD-gebruiker** kan **toegang tot die AWS-bestuurskonsole** verkry deur 'n Rol om aan te neem. Die **verstek-gebruikersnaam is Admin** en dit is moontlik om **die wagwoord te verander** vanaf die AWS-konsole.

Daarom is dit moontlik om **die wagwoord van Admin te verander**, 'n nuwe gebruiker te skep of **die wagwoord van 'n gebruiker te verander** en daardie gebruiker 'n Rol te gee om toegang te behou.\
Dit is ook moontlik om **'n gebruiker by 'n groep binne AD te voeg** en **daardie AD-groep toegang tot 'n Rol te gee** (om hierdie volharding meer heimlik te maak).

### Deel AD (van slagoffer na aanvaller)

Dit is moontlik om 'n AD-omgewing van 'n slagoffer na 'n aanvaller te deel. Op hierdie manier sal die aanvaller in staat wees om voort te gaan om toegang tot die AD-omgewing te verkry.\
Dit impliseer egter die deel van die bestuurde AD en die skep van 'n VPC-peering-verbinding.

Jy kan 'n gids hier vind: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html)

### ~~Deel AD (van aanvaller na slagoffer)~~

Dit lyk nie asof dit moontlik is om AWS-toegang aan gebruikers van 'n ander AD-omgewing tot een AWS-rekening te verleen nie.

## WorkDocs

Amazon Web Services (AWS) WorkDocs is 'n op die wolk gebaseerde **l√™erberging- en deel-diens**. Dit is deel van die AWS-reeks van wolkrekenaardiens en is ontwerp om 'n veilige en skaalbare oplossing vir organisasies te bied om l√™ers en dokumente te stoor, te deel en saam te werk.

AWS WorkDocs bied 'n webgebaseerde koppelvlak vir gebruikers om hul l√™ers en dokumente te laai, toegang te verkry en te bestuur. Dit bied ook funksies soos weergawebeheer, werklike samewerking en integrasie met ander AWS-diens en derdeparty-hulpmiddels.

### Enumerasie

{% code overflow="wrap" %}
```bash
# Get AD users (Admin not included)
aws workdocs describe-users --organization-id <directory-id>
# Get AD groups (containing "a")
aws workdocs describe-groups --organization-id d-9067a0285c --search-query a

# Create user (created inside the AD)
aws workdocs create-user --username testingasd --given-name testingasd --surname testingasd --password <password> --email-address name@directory.domain --organization-id <directory-id>

# Get what each user has created
aws workdocs describe-activities --user-id "S-1-5-21-377..."

# Get what was created in the directory
aws workdocs describe-activities --organization-id <directory-id>

# Get folder content
aws workdocs describe-folder-contents --folder-id <fold-id>

# Get file (a url to access with the content will be retreived)
aws workdocs get-document --document-id <doc-id>

# Get resource permissions if any
aws workdocs describe-resource-permissions --resource-id <value>

# Add permission so anyway can see the file
aws workdocs add-resource-permissions --resource-id <id> --principals Id=anonymous,Type=ANONYMOUS,Role=VIEWER
## This will give an id, the file will be acesible in: https://<name>.awsapps.com/workdocs/index.html#/share/document/<id>
```
{% endcode %}

### Bevoorregte skakeling

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md" %}
[aws-workdocs-privesc.md](../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md)
{% endcontent-ref %}

{% hint style="success" %}
Leer & oefen AWS-hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP-hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kontroleer die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
{% endhint %}
