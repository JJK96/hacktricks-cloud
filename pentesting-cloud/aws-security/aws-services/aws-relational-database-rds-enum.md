# AWS - Relational Database (RDS) Enum

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking öğrenin ve pratik yapın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'ı takip edin.**
* **HackTricks'e PR göndererek hacking ipuçlarını paylaşın** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına.

</details>
{% endhint %}

## Temel Bilgiler

AWS tarafından sunulan **Relational Database Service (RDS)**, **bulutta ilişkisel bir veritabanının** dağıtımını, işletimini ve ölçeklendirilmesini kolaylaştırmak için tasarlanmıştır. Bu hizmet, donanım sağlama, veritabanı yapılandırma, yamalama ve yedekleme gibi emek yoğun görevleri otomatikleştirirken maliyet etkinliği ve ölçeklenebilirlik avantajları sunar.

AWS RDS, MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server ve Amazon Aurora gibi çeşitli yaygın olarak kullanılan ilişkisel veritabanı motorlarını destekler ve hem MySQL hem de PostgreSQL ile uyumludur.

RDS'nin ana özellikleri şunlardır:

* **Veritabanı örneklerinin yönetimi** basitleştirilmiştir.
* Okuma performansını artırmak için **okuma replikaları** oluşturma.
* Yüksek kullanılabilirlik ve hata toleransı sağlamak için **çoklu-Availability Zone (AZ) dağıtımları** yapılandırma.
* Diğer AWS hizmetleri ile **entegrasyon**, örneğin:
* Güçlü erişim kontrolü için AWS Kimlik ve Erişim Yönetimi (**IAM**).
* Kapsamlı izleme ve metrikler için AWS **CloudWatch**.
* Dinlenme halinde şifreleme sağlamak için AWS Anahtar Yönetim Hizmeti (**KMS**).

## Kimlik Bilgileri

DB kümesini oluştururken ana **kullanıcı adı** yapılandırılabilir (**`admin`** varsayılan olarak). Bu kullanıcının şifresini oluşturmak için şunları yapabilirsiniz:

* Kendiniz bir **şifre** belirleyin
* RDS'ye **otomatik olarak oluşturmasını** söyleyin
* RDS'ye bir KMS anahtarı ile şifrelenmiş **AWS Secret Manager**'da yönetmesini söyleyin

<figure><img src="../../../.gitbook/assets/image (144).png" alt=""><figcaption></figcaption></figure>

### Kimlik Doğrulama

3 tür kimlik doğrulama seçeneği vardır, ancak **ana şifreyi kullanmak her zaman mümkündür**:

<figure><img src="../../../.gitbook/assets/image (227).png" alt=""><figcaption></figcaption></figure>

### Genel Erişim & VPC

Varsayılan olarak **veritabanlarına genel erişim verilmez**, ancak **verilebilir**. Bu nedenle, varsayılan olarak yalnızca aynı VPC'den makineler, seçilen **güvenlik grubu** (EC2 SG'de saklanır) izin veriyorsa erişebilir.

Bir DB örneğini açığa çıkarmak yerine, DB kümesinin **ölçeklenebilirliğini** ve **kullanılabilirliğini** artıran bir **RDS Proxy** oluşturmak mümkündür.

Ayrıca, **veritabanı portu da değiştirilebilir**.

### Şifreleme

**Şifreleme varsayılan olarak etkinleştirilmiştir** ve AWS yönetilen bir anahtar kullanır (bunun yerine bir CMK seçilebilir).

Şifrelemeyi etkinleştirerek, **depolama, anlık görüntüler, okuma replikaları ve yedekleriniz için dinlenme halinde şifrelemeyi** etkinleştiriyorsunuz. Bu şifrelemeyi yönetmek için anahtarlar **KMS** kullanılarak sağlanabilir.\
Veritabanınız oluşturulduktan sonra bu seviyede şifreleme eklemek mümkün değildir. **Oluşturma sırasında yapılması gerekir**.

Ancak, şifrelenmemiş bir veritabanını şifrelemenize olanak tanıyan bir **geçici çözüm** vardır. Şifrelenmemiş veritabanınızın bir anlık görüntüsünü oluşturabilir, bu anlık görüntünün şifrelenmiş bir kopyasını oluşturabilir, bu şifrelenmiş anlık görüntüyü kullanarak yeni bir veritabanı oluşturabilir ve sonunda veritabanınız şifrelenmiş olur.

#### Şeffaf Veri Şifreleme (TDE)

RDS'nin uygulama düzeyinde yerleşik şifreleme yeteneklerinin yanı sıra, RDS ayrıca dinlenme halindeki verileri korumak için **ek platform düzeyinde şifreleme mekanizmalarını** destekler. Bu, Oracle ve SQL Server için **Şeffaf Veri Şifreleme (TDE)**'yi içerir. Ancak, TDE'nin dinlenme halindeki verileri şifreleyerek güvenliği artırırken, aynı zamanda **veritabanı performansını etkileyebileceğini** unutmamak önemlidir. Bu performans etkisi, özellikle MySQL kriptografik işlevleri veya Microsoft Transact-SQL kriptografik işlevleri ile birlikte kullanıldığında belirgindir.

TDE'yi kullanmak için belirli ön adımlar gereklidir:

1. **Seçenek Grubu İlişkilendirmesi**:
* Veritabanı bir seçenek grubuyla ilişkilendirilmelidir. Seçenek grupları, veritabanı yönetimini, güvenlik iyileştirmeleri de dahil olmak üzere kolaylaştıran ayar ve özellikler için konteynerler olarak hizmet eder.
* Ancak, seçenek gruplarının yalnızca belirli veritabanı motorları ve sürümleri için mevcut olduğunu unutmamak önemlidir.
2. **TDE'nin Seçenek Grubuna Dahil Edilmesi**:
* Bir seçenek grubuyla ilişkilendirildikten sonra, Oracle Şeffaf Veri Şifreleme seçeneği o gruba dahil edilmelidir.
* TDE seçeneği bir seçenek grubuna eklendikten sonra, kalıcı bir özellik haline gelir ve kaldırılamaz.
3. **TDE Şifreleme Modları**:
* TDE iki farklı şifreleme modu sunar:
* **TDE Tablespace Şifreleme**: Bu mod, daha geniş bir veri koruma kapsamı sağlayarak tüm tabloları şifreler.
* **TDE Sütun Şifreleme**: Bu mod, veritabanındaki belirli, bireysel öğeleri şifrelemeye odaklanarak daha ayrıntılı kontrol sağlar.

TDE'nin bu ön koşullarını ve operasyonel ayrıntılarını anlamak, RDS içinde şifrelemeyi etkili bir şekilde uygulamak ve yönetmek için kritik öneme sahiptir, hem veri güvenliğini sağlamak hem de gerekli standartlara uyumu sağlamak için.

### Enumeration

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Kimlik Doğrulaması Olmayan Erişim

{% content-ref url="../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Yetki Yükseltme

{% content-ref url="../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Sömürü Sonrası

{% content-ref url="../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Kalıcılık

{% content-ref url="../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQL Enjeksiyonu

**SQL sözdizimi** ile DynamoDB verilerine erişmenin yolları vardır, bu nedenle, tipik **SQL enjeksiyonları da mümkündür**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking öğrenin ve pratik yapın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **Discord grubuna** 💬 [**katılın**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live) **bizi takip edin.**
* **HackTricks'e PR göndererek hacking ipuçlarını paylaşın** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına.

</details>
{% endhint %}
