# AWS - Relational Database (RDS) Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

AWS에서 제공하는 **Relational Database Service (RDS)**는 **클라우드에서 관계형 데이터베이스**의 배포, 운영 및 확장을 간소화하도록 설계되었습니다. 이 서비스는 하드웨어 프로비저닝, 데이터베이스 구성, 패치 및 백업과 같은 노동 집약적인 작업을 자동화하면서 비용 효율성과 확장성을 제공합니다.

AWS RDS는 MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server 및 MySQL과 PostgreSQL과 호환되는 Amazon Aurora를 포함한 다양한 널리 사용되는 관계형 데이터베이스 엔진을 지원합니다.

RDS의 주요 기능은 다음과 같습니다:

* **데이터베이스 인스턴스 관리**가 간소화됩니다.
* 읽기 성능을 향상시키기 위해 **읽기 복제본**을 생성합니다.
* 고가용성과 장애 조치 메커니즘을 보장하기 위해 **다중 가용 영역(AZ) 배포**를 구성합니다.
* 다음과 같은 다른 AWS 서비스와의 **통합**:
* 강력한 액세스 제어를 위한 AWS Identity and Access Management (**IAM**).
* 포괄적인 모니터링 및 메트릭을 위한 AWS **CloudWatch**.
* 저장 시 암호화를 보장하기 위한 AWS Key Management Service (**KMS**).

## Credentials

DB 클러스터를 생성할 때 기본 **사용자 이름**을 구성할 수 있습니다(기본값은 **`admin`**). 이 사용자의 비밀번호를 생성하려면:

* **직접 비밀번호**를 지정합니다.
* RDS에 **자동 생성**을 요청합니다.
* KMS 키로 암호화된 **AWS Secret Manager**에서 관리하도록 RDS에 요청합니다.

<figure><img src="../../../.gitbook/assets/image (144).png" alt=""><figcaption></figcaption></figure>

### Authentication

3가지 유형의 인증 옵션이 있지만 **마스터 비밀번호 사용은 항상 허용**됩니다:

<figure><img src="../../../.gitbook/assets/image (227).png" alt=""><figcaption></figcaption></figure>

### Public Access & VPC

기본적으로 **공개 액세스는 허용되지 않습니다**, 그러나 **허용될 수 있습니다**. 따라서 기본적으로 동일한 VPC의 머신만 선택된 **보안 그룹**(EC2 SG에 저장됨)이 허용하는 경우 액세스할 수 있습니다.

DB 인스턴스를 노출하는 대신, **RDS Proxy**를 생성하여 DB 클러스터의 **확장성** 및 **가용성**을 **향상**시킬 수 있습니다.

또한, **데이터베이스 포트를 수정**할 수도 있습니다.

### Encryption

**암호화는 기본적으로 활성화**되어 있으며 AWS 관리 키(CMK를 대신 선택할 수 있음)를 사용합니다.

암호화를 활성화하면 **저장소, 스냅샷, 읽기 복제본 및 백업에 대한 저장 시 암호화**가 활성화됩니다. 이 암호화를 관리하기 위한 키는 **KMS**를 사용하여 발급할 수 있습니다.\
데이터베이스가 생성된 후에는 이 수준의 암호화를 추가할 수 없습니다. **생성 시에만 가능합니다**.

그러나 다음과 같은 방법으로 암호화되지 않은 데이터베이스를 암호화할 수 있는 **해결 방법**이 있습니다. 암호화되지 않은 데이터베이스의 스냅샷을 생성하고, 해당 스냅샷의 암호화된 복사본을 생성한 다음, 그 암호화된 스냅샷을 사용하여 새 데이터베이스를 생성하면 최종적으로 데이터베이스가 암호화됩니다.

#### Transparent Data Encryption (TDE)

RDS의 애플리케이션 수준 암호화 기능과 함께, RDS는 저장된 데이터를 보호하기 위해 **추가적인 플랫폼 수준 암호화 메커니즘**도 지원합니다. 여기에는 Oracle 및 SQL Server용 **Transparent Data Encryption (TDE)**이 포함됩니다. 그러나 TDE는 저장된 데이터를 암호화하여 보안을 강화하지만, MySQL 암호화 함수나 Microsoft Transact-SQL 암호화 함수와 함께 사용할 때 **데이터베이스 성능에 영향을 미칠 수 있습니다**.

TDE를 사용하려면 몇 가지 사전 단계가 필요합니다:

1. **옵션 그룹 연결**:
* 데이터베이스는 옵션 그룹과 연결되어야 합니다. 옵션 그룹은 설정 및 기능을 포함하는 컨테이너로, 보안 향상을 포함한 데이터베이스 관리를 용이하게 합니다.
* 그러나 옵션 그룹은 특정 데이터베이스 엔진 및 버전에만 사용할 수 있습니다.
2. **옵션 그룹에 TDE 포함**:
* 옵션 그룹과 연결된 후, Oracle Transparent Data Encryption 옵션을 해당 그룹에 포함시켜야 합니다.
* TDE 옵션이 옵션 그룹에 추가되면 영구적으로 고정되며 제거할 수 없습니다.
3. **TDE 암호화 모드**:
* TDE는 두 가지 다른 암호화 모드를 제공합니다:
* **TDE 테이블스페이스 암호화**: 이 모드는 전체 테이블을 암호화하여 더 넓은 범위의 데이터 보호를 제공합니다.
* **TDE 열 암호화**: 이 모드는 데이터베이스 내의 특정 개별 요소를 암호화하여 더 세밀한 제어를 제공합니다.

이러한 사전 요구 사항과 TDE의 운영적 복잡성을 이해하는 것은 RDS 내에서 암호화를 효과적으로 구현하고 관리하여 데이터 보안과 필요한 표준 준수를 보장하는 데 중요합니다.

### Enumeration

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Unauthenticated Access

{% content-ref url="../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Persistence

{% content-ref url="../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQL Injection

**SQL 구문**을 사용하여 DynamoDB 데이터에 접근할 수 있는 방법이 있으며, 따라서 일반적인 **SQL 인젝션도 가능**합니다.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

{% hint style="success" %}
AWS 해킹 학습 및 연습:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP 해킹 학습 및 연습: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks 지원하기</summary>

* [**구독 플랜**](https://github.com/sponsors/carlospolop)을 확인하세요!
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**telegram 그룹**](https://t.me/peass)에 가입하거나 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)을 팔로우하세요.
* **PR을 제출하여 해킹 트릭을 공유하세요:** [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소.

</details>
{% endhint %}
