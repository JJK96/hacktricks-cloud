# AWS - Relational Database (RDS) Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)をフォローしてください。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出してハッキングトリックを共有してください。

</details>
{% endhint %}

## Basic Information

AWSが提供する**Relational Database Service (RDS)**は、**クラウド上のリレーショナルデータベース**の展開、運用、およびスケーリングを簡素化するように設計されています。このサービスは、ハードウェアのプロビジョニング、データベースの構成、パッチ適用、バックアップなどの労働集約的なタスクを自動化しながら、コスト効率とスケーラビリティの利点を提供します。

AWS RDSは、MySQL、PostgreSQL、MariaDB、Oracle Database、Microsoft SQL Server、Amazon Aurora（MySQLおよびPostgreSQL互換）など、さまざまな広く使用されているリレーショナルデータベースエンジンをサポートしています。

RDSの主な機能には以下が含まれます：

* **データベースインスタンスの管理**が簡素化されます。
* 読み取りパフォーマンスを向上させるための**リードレプリカの作成**。
* 高可用性とフェイルオーバーメカニズムを確保するための**マルチアベイラビリティゾーン（AZ）デプロイメントの構成**。
* 他のAWSサービスとの**統合**、例えば：
* 強力なアクセス制御のためのAWS Identity and Access Management（**IAM**）。
* 包括的な監視とメトリクスのためのAWS **CloudWatch**。
* 保存時の暗号化を確保するためのAWS Key Management Service（**KMS**）。

## Credentials

DBクラスターを作成する際、マスター**ユーザー名**を設定できます（デフォルトでは**`admin`**）。このユーザーのパスワードを生成するには：

* **自分でパスワードを指定**する
* RDSに**自動生成**させる
* KMSキーで暗号化された**AWS Secret Manager**で管理させる

<figure><img src="../../../.gitbook/assets/image (144).png" alt=""><figcaption></figcaption></figure>

### Authentication

認証オプションは3種類ありますが、**マスターパスワードの使用は常に許可されています**：

<figure><img src="../../../.gitbook/assets/image (227).png" alt=""><figcaption></figcaption></figure>

### Public Access & VPC

デフォルトでは**パブリックアクセスは許可されていません**が、**許可することもできます**。したがって、デフォルトでは選択された**セキュリティグループ**（EC2 SGに保存されている）が許可する場合にのみ、同じVPCからのマシンがアクセスできます。

DBインスタンスを公開する代わりに、**RDS Proxy**を作成してDBクラスターの**スケーラビリティ**と**可用性**を向上させることができます。

さらに、**データベースポートも変更可能**です。

### Encryption

**暗号化はデフォルトで有効**になっており、AWS管理キー（代わりにCMKを選択することも可能）を使用します。

暗号化を有効にすることで、**ストレージ、スナップショット、リードレプリカ、およびバックアップの保存時の暗号化**が有効になります。この暗号化を管理するためのキーは**KMS**を使用して発行できます。\
データベース作成後にこのレベルの暗号化を追加することはできません。**作成時に行う必要があります**。

ただし、次のようにして暗号化されていないデータベースを暗号化する**回避策**があります。暗号化されていないデータベースのスナップショットを作成し、そのスナップショットの暗号化コピーを作成し、その暗号化スナップショットを使用して新しいデータベースを作成します。最終的に、データベースは暗号化されます。

#### Transparent Data Encryption (TDE)

RDSのアプリケーションレベルでの暗号化機能に加えて、RDSは保存データを保護するための**追加のプラットフォームレベルの暗号化メカニズム**もサポートしています。これには、OracleおよびSQL Serverの**Transparent Data Encryption (TDE)**が含まれます。ただし、TDEは保存データを暗号化することでセキュリティを強化しますが、**データベースのパフォーマンスに影響を与える可能性**があることに注意が必要です。このパフォーマンスの影響は、MySQLの暗号化関数やMicrosoft Transact-SQLの暗号化関数と併用する場合に特に顕著です。

TDEを利用するには、いくつかの前提条件があります：

1. **オプショングループの関連付け**：
* データベースはオプショングループに関連付けられている必要があります。オプショングループは設定や機能のコンテナとして機能し、セキュリティ強化を含むデータベース管理を容易にします。
* ただし、オプショングループは特定のデータベースエンジンおよびバージョンにのみ利用可能です。
2. **オプショングループにTDEを含める**：
* オプショングループに関連付けられた後、Oracle Transparent Data Encryptionオプションをそのグループに含める必要があります。
* TDEオプションがオプショングループに追加されると、それは恒久的なものであり、削除することはできません。
3. **TDE暗号化モード**：
* TDEは2つの異なる暗号化モードを提供します：
* **TDEテーブルスペース暗号化**：このモードは、データ全体を暗号化し、より広範なデータ保護を提供します。
* **TDEカラム暗号化**：このモードは、データベース内の特定の個々の要素を暗号化することに焦点を当て、暗号化するデータに対するより細かい制御を可能にします。

これらの前提条件とTDEの運用の詳細を理解することは、RDS内での暗号化の効果的な実装と管理に不可欠であり、データのセキュリティと必要な基準への準拠を確保します。

### Enumeration

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Unauthenticated Access

{% content-ref url="../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Persistence

{% content-ref url="../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQL Injection

**SQL構文**を使用してDynamoDBデータにアクセスする方法があるため、典型的な**SQLインジェクションも可能**です。

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

{% hint style="success" %}
AWSハッキングを学び、練習する:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPハッキングを学び、練習する: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポートする</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)をフォローする。
* **PRを提出してハッキングトリックを共有する** [**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリに。

</details>
{% endhint %}
