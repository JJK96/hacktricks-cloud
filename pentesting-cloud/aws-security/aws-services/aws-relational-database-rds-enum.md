# AWS - Relational Database (RDS) Enum

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστήριξη HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Βασικές Πληροφορίες

Η **Υπηρεσία Σχεσιακής Βάσης Δεδομένων (RDS)** που προσφέρεται από την AWS έχει σχεδιαστεί για να απλοποιεί την ανάπτυξη, τη λειτουργία και την κλιμάκωση μιας **σχεσιακής βάσης δεδομένων στο cloud**. Αυτή η υπηρεσία προσφέρει τα πλεονεκτήματα της οικονομικής αποδοτικότητας και της κλιμάκωσης, ενώ αυτοματοποιεί χρονοβόρες εργασίες όπως η προμήθεια υλικού, η διαμόρφωση βάσεων δεδομένων, οι ενημερώσεις και τα αντίγραφα ασφαλείας.

Η AWS RDS υποστηρίζει διάφορους ευρέως χρησιμοποιούμενους μηχανισμούς σχεσιακής βάσης δεδομένων, συμπεριλαμβανομένων των MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server και Amazon Aurora, με συμβατότητα και για MySQL και PostgreSQL.

Τα κύρια χαρακτηριστικά του RDS περιλαμβάνουν:

* **Η διαχείριση των στιγμιότυπων βάσεων δεδομένων** είναι απλοποιημένη.
* Δημιουργία **αντιγράφων ανάγνωσης** για τη βελτίωση της απόδοσης ανάγνωσης.
* Διαμόρφωση **αναπτύξεων πολλαπλών Ζωνών Διαθεσιμότητας (AZ)** για να διασφαλιστεί η υψηλή διαθεσιμότητα και οι μηχανισμοί εναλλαγής.
* **Ενσωμάτωση** με άλλες υπηρεσίες AWS, όπως:
* AWS Identity and Access Management (**IAM**) για ισχυρό έλεγχο πρόσβασης.
* AWS **CloudWatch** για ολοκληρωμένη παρακολούθηση και μετρήσεις.
* AWS Key Management Service (**KMS**) για τη διασφάλιση της κρυπτογράφησης σε κατάσταση αδράνειας.

## Διαπιστευτήρια

Κατά τη δημιουργία του DB cluster, το κύριο **όνομα χρήστη** μπορεί να διαμορφωθεί (**`admin`** από προεπιλογή). Για να δημιουργήσετε τον κωδικό πρόσβασης αυτού του χρήστη μπορείτε να:

* **Υποδείξετε** έναν **κωδικό πρόσβασης** εσείς
* Πείτε στην RDS να **δημιουργήσει αυτόματα** τον κωδικό
* Πείτε στην RDS να τον διαχειριστεί στο **AWS Secret Manager** κρυπτογραφημένο με ένα κλειδί KMS

<figure><img src="../../../.gitbook/assets/image (144).png" alt=""><figcaption></figcaption></figure>

### Αυθεντικοποίηση

Υπάρχουν 3 τύποι επιλογών αυθεντικοποίησης, αλλά η χρήση του **κύριου κωδικού πρόσβασης επιτρέπεται πάντα**:

<figure><img src="../../../.gitbook/assets/image (227).png" alt=""><figcaption></figcaption></figure>

### Δημόσια Πρόσβαση & VPC

Από προεπιλογή **δεν παρέχεται δημόσια πρόσβαση** στις βάσεις δεδομένων, ωστόσο **μπορεί να παραχωρηθεί**. Επομένως, από προεπιλογή μόνο οι μηχανές από την ίδια VPC θα μπορούν να έχουν πρόσβαση αν η επιλεγμένη **ομάδα ασφαλείας** (που αποθηκεύεται στο EC2 SG) το επιτρέπει.

Αντί να εκθέσετε ένα DB instance, είναι δυνατό να δημιουργήσετε ένα **RDS Proxy** που **βελτιώνει** την **κλιμάκωση** & **διαθεσιμότητα** του DB cluster.

Επιπλέον, η **θύρα της βάσης δεδομένων μπορεί να τροποποιηθεί** επίσης.

### Κρυπτογράφηση

**Η κρυπτογράφηση είναι ενεργοποιημένη από προεπιλογή** χρησιμοποιώντας ένα κλειδί διαχείρισης της AWS (ένα CMK μπορεί να επιλεγεί αντί αυτού).

Με την ενεργοποίηση της κρυπτογράφησής σας, ενεργοποιείτε την **κρυπτογράφηση σε κατάσταση αδράνειας για την αποθήκευσή σας, τα στιγμιότυπα, τα αντίγραφα ανάγνωσης και τα αντίγραφα ασφαλείας σας**. Κλειδιά για τη διαχείριση αυτής της κρυπτογράφησης μπορούν να εκδοθούν χρησιμοποιώντας **KMS**.\
Δεν είναι δυνατό να προστεθεί αυτό το επίπεδο κρυπτογράφησης αφού έχει δημιουργηθεί η βάση δεδομένων σας. **Πρέπει να γίνει κατά τη διάρκεια της δημιουργίας της**.

Ωστόσο, υπάρχει μια **λύση που σας επιτρέπει να κρυπτογραφήσετε μια μη κρυπτογραφημένη βάση δεδομένων ως εξής**. Μπορείτε να δημιουργήσετε ένα στιγμιότυπο της μη κρυπτογραφημένης βάσης δεδομένων σας, να δημιουργήσετε ένα κρυπτογραφημένο αντίγραφο αυτού του στιγμιότυπου, να χρησιμοποιήσετε αυτό το κρυπτογραφημένο στιγμιότυπο για να δημιουργήσετε μια νέα βάση δεδομένων και, τελικά, η βάση δεδομένων σας θα είναι κρυπτογραφημένη.

#### Διαφανής Κρυπτογράφηση Δεδομένων (TDE)

Μαζί με τις δυνατότητες κρυπτογράφησης που είναι εγγενείς στο RDS σε επίπεδο εφαρμογής, το RDS υποστηρίζει επίσης **επιπλέον μηχανισμούς κρυπτογράφησης σε επίπεδο πλατφόρμας** για την προστασία των δεδομένων σε κατάσταση αδράνειας. Αυτό περιλαμβάνει τη **Διαφανή Κρυπτογράφηση Δεδομένων (TDE)** για Oracle και SQL Server. Ωστόσο, είναι κρίσιμο να σημειωθεί ότι ενώ η TDE ενισχύει την ασφάλεια κρυπτογραφώντας τα δεδομένα σε κατάσταση αδράνειας, μπορεί επίσης να **επηρεάσει την απόδοση της βάσης δεδομένων**. Αυτή η επίδραση στην απόδοση είναι ιδιαίτερα αισθητή όταν χρησιμοποιείται σε συνδυασμό με τις κρυπτογραφικές λειτουργίες MySQL ή τις κρυπτογραφικές λειτουργίες Microsoft Transact-SQL.

Για να χρησιμοποιήσετε την TDE, απαιτούνται ορισμένα προκαταρκτικά βήματα:

1. **Συσχέτιση Ομάδας Επιλογών**:
* Η βάση δεδομένων πρέπει να συσχετιστεί με μια ομάδα επιλογών. Οι ομάδες επιλογών λειτουργούν ως δοχεία για ρυθμίσεις και δυνατότητες, διευκολύνοντας τη διαχείριση της βάσης δεδομένων, συμπεριλαμβανομένων των βελτιώσεων ασφαλείας.
* Ωστόσο, είναι σημαντικό να σημειωθεί ότι οι ομάδες επιλογών είναι διαθέσιμες μόνο για συγκεκριμένους μηχανισμούς βάσεων δεδομένων και εκδόσεις.
2. **Συμπερίληψη της TDE στην Ομάδα Επιλογών**:
* Αφού συσχετιστεί με μια ομάδα επιλογών, η επιλογή Διαφανούς Κρυπτογράφησης Δεδομένων Oracle πρέπει να συμπεριληφθεί σε αυτήν την ομάδα.
* Είναι ουσιώδες να αναγνωρίσετε ότι μόλις προστεθεί η επιλογή TDE σε μια ομάδα επιλογών, γίνεται μόνιμο χαρακτηριστικό και δεν μπορεί να αφαιρεθεί.
3. **Λειτουργίες Κρυπτογράφησης TDE**:
* Η TDE προσφέρει δύο διακριτές λειτουργίες κρυπτογράφησης:
* **Κρυπτογράφηση Χώρου Πινάκων TDE**: Αυτή η λειτουργία κρυπτογραφεί ολόκληρους πίνακες, παρέχοντας ευρύτερη προστασία δεδομένων.
* **Κρυπτογράφηση Στήλης TDE**: Αυτή η λειτουργία επικεντρώνεται στην κρυπτογράφηση συγκεκριμένων, μεμονωμένων στοιχείων μέσα στη βάση δεδομένων, επιτρέποντας πιο λεπτομερή έλεγχο σχετικά με τα δεδομένα που κρυπτογραφούνται.

Η κατανόηση αυτών των προϋποθέσεων και των λειτουργικών λεπτομερειών της TDE είναι κρίσιμη για την αποτελεσματική εφαρμογή και διαχείριση της κρυπτογράφησης εντός του RDS, διασφαλίζοντας τόσο την ασφάλεια των δεδομένων όσο και τη συμμόρφωση με τις απαραίτητες προδιαγραφές.

### Αριθμητική

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Μη Αυθεντικοποιημένη Πρόσβαση

{% content-ref url="../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Privilege Escalation

{% content-ref url="../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Μετά την Εκμετάλλευση

{% content-ref url="../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Επιμονή

{% content-ref url="../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQL Injection

Υπάρχουν τρόποι πρόσβασης σε δεδομένα του DynamoDB με **SQL σύνταξη**, επομένως, τυπικές **SQL injections είναι επίσης δυνατές**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστήριξη HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
