# AWS - Relational Database (RDS) Enum

{% hint style="success" %}
Μάθετε και εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε και εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}

## Βασικές Πληροφορίες

Η **Υπηρεσία Σχεσιακής Βάσης Δεδομένων (RDS)** που προσφέρεται από την AWS έχει σχεδιαστεί για να απλοποιεί την ανάπτυξη, λειτουργία και κλιμάκωση μιας **σχεσιακής βάσης δεδομένων στο cloud**. Αυτή η υπηρεσία προσφέρει τα πλεονεκτήματα της οικονομικής αποδοτικότητας και της κλιμάκωσης, ενώ αυτοματοποιεί εργασίες που απαιτούν πολύ χρόνο, όπως η προμήθεια υλικού, η διαμόρφωση της βάσης δεδομένων, η ενημέρωση και τα αντίγραφα ασφαλείας.

Η AWS RDS υποστηρίζει διάφορες ευρέως χρησιμοποιούμενες μηχανές σχεσιακών βάσεων δεδομένων, όπως MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server και Amazon Aurora, με συμβατότητα τόσο για MySQL όσο και για PostgreSQL.

Κύρια χαρακτηριστικά του RDS περιλαμβάνουν:

* **Διαχείριση των περιπτώσεων βάσεων δεδομένων** είναι απλοποιημένη.
* Δημιουργία **αντιγράφων ανάγνωσης** για βελτίωση της απόδοσης ανάγνωσης.
* Διαμόρφωση **αναπτύξεων πολλαπλών Ζωνών Διαθεσιμότητας (AZ)** για εξασφάλιση υψηλής διαθεσιμότητας και μηχανισμών αποκατάστασης.
* **Ενσωμάτωση** με άλλες υπηρεσίες AWS, όπως:
* AWS Identity and Access Management (**IAM**) για ισχυρό έλεγχο πρόσβασης.
* AWS **CloudWatch** για ολοκληρωμένη παρακολούθηση και μετρήσεις.
* AWS Key Management Service (**KMS**) για εξασφάλιση κρυπτογράφησης σε κατάσταση ηρεμίας.

## Διαπιστευτήρια

Κατά τη δημιουργία του συμπλέγματος βάσης δεδομένων, το κύριο **όνομα χρήστη** μπορεί να διαμορφωθεί (**`admin`** από προεπιλογή). Για να δημιουργήσετε τον κωδικό πρόσβασης αυτού του χρήστη μπορείτε:

* **Να υποδείξετε** έναν **κωδικό πρόσβασης** μόνοι σας
* Να πείτε στο RDS να **τον δημιουργήσει αυτόματα**
* Να πείτε στο RDS να τον διαχειριστεί στο **AWS Secret Manager** κρυπτογραφημένο με ένα κλειδί KMS

<figure><img src="../../../.gitbook/assets/image (144).png" alt=""><figcaption></figcaption></figure>

### Αυθεντικοποίηση

Υπάρχουν 3 τύποι επιλογών αυθεντικοποίησης, αλλά η χρήση του **κύριου κωδικού πρόσβασης είναι πάντα επιτρεπτή**:

<figure><img src="../../../.gitbook/assets/image (227).png" alt=""><figcaption></figcaption></figure>

### Δημόσια Πρόσβαση & VPC

Από προεπιλογή **δεν παρέχεται δημόσια πρόσβαση** στις βάσεις δεδομένων, ωστόσο **θα μπορούσε να παραχωρηθεί**. Επομένως, από προεπιλογή μόνο μηχανές από το ίδιο VPC θα μπορούν να έχουν πρόσβαση σε αυτήν εάν η επιλεγμένη **ομάδα ασφαλείας** (αποθηκεύονται στο EC2 SG) το επιτρέπει.

Αντί να εκθέσετε μια περίπτωση βάσης δεδομένων, είναι δυνατό να δημιουργήσετε ένα **RDS Proxy** το οποίο **βελτιώνει** την **κλιμάκωση** και τη **διαθεσιμότητα** του συμπλέγματος βάσης δεδομένων.

Επιπλέον, η **θύρα της βάσης δεδομένων μπορεί να τροποποιηθεί** επίσης.

### Κρυπτογράφηση

**Η κρυπτογράφηση είναι ενεργοποιημένη από προεπιλογή** χρησιμοποιώντας ένα διαχειριζόμενο κλειδί AWS (θα μπορούσε να επιλεγεί ένα CMK αντί αυτού).

Ενεργοποιώντας την κρυπτογράφηση σας, ενεργοποιείτε την **κρυπτογράφηση σε κατάσταση ηρεμίας για την αποθήκευση, τα στιγμιότυπα, τα αντίγραφα ανάγνωσης και τα αντίγραφα ασφαλείας σας**. Τα κλειδιά για τη διαχείριση αυτής της κρυπτογράφησης μπορούν να εκδοθούν χρησιμοποιώντας το **KMS**.\
Δεν είναι δυνατό να προσθέσετε αυτό το επίπεδο κρυπτογράφησης μετά τη δημιουργία της βάσης δεδομένων σας. **Πρέπει να γίνει κατά τη δημιουργία της**.

Ωστόσο, υπάρχει μια **παράκαμψη που σας επιτρέπει να κρυπτογραφήσετε μια μη κρυπτογραφημένη βάση δεδομένων ως εξής**. Μπορείτε να δημιουργήσετε ένα στιγμιότυπο της μη κρυπτογραφημένης βάσης δεδομένων σας, να δημιουργήσετε ένα κρυπτογραφημένο αντίγραφο αυτού του στιγμιότυπου, να χρησιμοποιήσετε αυτό το κρυπτογραφημένο στιγμιότυπο για να δημιουργήσετε μια νέα βάση δεδομένων και στη συνέχεια, τελικά, η βάση δεδομένων σας θα είναι κρυπτογραφημένη.

#### Διαφανής Κρυπτογράφηση Δεδομένων (TDE)

Παράλληλα με τις δυνατότητες κρυπτογράφησης που είναι εγγενείς στο RDS σε επίπεδο εφαρμογής, το RDS υποστηρίζει επίσης **πρόσθετους μηχανισμούς κρυπτογράφησης σε επίπεδο πλατφόρμας** για την προστασία των δεδομένων σε κατάσταση ηρεμίας. Αυτό περιλαμβάνει τη **Διαφανή Κρυπτογράφηση Δεδομένων (TDE)** για Oracle και SQL Server. Ωστόσο, είναι σημαντικό να σημειωθεί ότι ενώ η TDE ενισχύει την ασφάλεια κρυπτογραφώντας τα δεδομένα σε κατάσταση ηρεμίας, μπορεί επίσης να **επηρεάσει την απόδοση της βάσης δεδομένων**. Αυτή η επίδραση στην απόδοση είναι ιδιαίτερα αισθητή όταν χρησιμοποιείται σε συνδυασμό με τις κρυπτογραφικές λειτουργίες MySQL ή τις κρυπτογραφικές λειτουργίες Microsoft Transact-SQL.

Για να χρησιμοποιήσετε την TDE, απαιτούνται ορισμένα προκαταρκτικά βήματα:

1. **Σύνδεση Ομάδας Επιλογών**:
* Η βάση δεδομένων πρέπει να συνδεθεί με μια ομάδα επιλογών. Οι ομάδες επιλογών λειτουργούν ως δοχεία για ρυθμίσεις και χαρακτηριστικά, διευκολύνοντας τη διαχείριση της βάσης δεδομένων, συμπεριλαμβανομένων των βελτιώσεων ασφαλείας.
* Ωστόσο, είναι σημαντικό να σημειωθεί ότι οι ομάδες επιλογών είναι διαθέσιμες μόνο για συγκεκριμένες μηχανές και εκδόσεις βάσεων δεδομένων.
2. **Συμπερίληψη της TDE στην Ομάδα Επιλογών**:
* Μόλις συνδεθεί με μια ομάδα επιλογών, η επιλογή Διαφανής Κρυπτογράφηση Δεδομένων Oracle πρέπει να συμπεριληφθεί σε αυτήν την ομάδα.
* Είναι σημαντικό να αναγνωριστεί ότι μόλις προστεθεί η επιλογή TDE σε μια ομάδα επιλογών, γίνεται μόνιμο χαρακτηριστικό και δεν μπορεί να αφαιρεθεί.
3. **Λειτουργίες Κρυπτογράφησης TDE**:
* Η TDE προσφέρει δύο διακριτές λειτουργίες κρυπτογράφησης:
* **Κρυπτογράφηση Χώρου Αποθήκευσης TDE**: Αυτή η λειτουργία κρυπτογραφεί ολόκληρους πίνακες, παρέχοντας ευρύτερη προστασία δεδομένων.
* **Κρυπτογράφηση Στήλης TDE**: Αυτή η λειτουργία επικεντρώνεται στην κρυπτογράφηση συγκεκριμένων, μεμονωμένων στοιχείων εντός της βάσης δεδομένων, επιτρέποντας πιο λεπτομερή έλεγχο του τι κρυπτογραφείται.

Η κατανόηση αυτών των προαπαιτούμενων και των λειτουργικών λεπτομερειών της TDE είναι κρίσιμη για την αποτελεσματική εφαρμογή και διαχείριση της κρυπτογράφησης στο RDS, εξασφαλίζοντας τόσο την ασφάλεια των δεδομένων όσο και τη συμμόρφωση με τα απαραίτητα πρότυπα.

### Απαρίθμηση

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Μη Εξουσιοδοτημένη Πρόσβαση

{% content-ref url="../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Μετα-Εκμετάλλευση

{% content-ref url="../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Εμμονή

{% content-ref url="../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQL Injection

Υπάρχουν τρόποι πρόσβασης σε δεδομένα DynamoDB με **σύνταξη SQL**, επομένως, τυπικές **SQL injections είναι επίσης δυνατές**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
