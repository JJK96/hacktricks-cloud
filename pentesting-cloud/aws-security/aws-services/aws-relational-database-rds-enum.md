# AWS - Relational Database (RDS) Enum

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## Grundlegende Informationen

Der **Relational Database Service (RDS)**, der von AWS angeboten wird, ist darauf ausgelegt, die Bereitstellung, den Betrieb und die Skalierung einer **relationalen Datenbank in der Cloud** zu vereinfachen. Dieser Dienst bietet die Vorteile von Kosteneffizienz und Skalierbarkeit, w√§hrend er arbeitsintensive Aufgaben wie Hardwarebereitstellung, Datenbankkonfiguration, Patchen und Backups automatisiert.

AWS RDS unterst√ºtzt verschiedene weit verbreitete relationale Datenbank-Engines, darunter MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server und Amazon Aurora, mit Kompatibilit√§t f√ºr sowohl MySQL als auch PostgreSQL.

Wichtige Funktionen von RDS umfassen:

* **Verwaltung von Datenbankinstanzen** wird vereinfacht.
* Erstellung von **Read Replicas**, um die Leseleistung zu verbessern.
* Konfiguration von **Multi-Availability Zone (AZ) Deployments**, um hohe Verf√ºgbarkeit und Failover-Mechanismen sicherzustellen.
* **Integration** mit anderen AWS-Diensten, wie:
* AWS Identity and Access Management (**IAM**) f√ºr robuste Zugriffskontrolle.
* AWS **CloudWatch** f√ºr umfassende √úberwachung und Metriken.
* AWS Key Management Service (**KMS**) zur Sicherstellung der Verschl√ºsselung im Ruhezustand.

## Anmeldeinformationen

Beim Erstellen des DB-Clusters kann der Master-**Benutzername** konfiguriert werden (**`admin`** standardm√§√üig). Um das Passwort dieses Benutzers zu generieren, k√∂nnen Sie:

* **Ein Passwort** selbst angeben
* RDS anweisen, es **automatisch zu generieren**
* RDS anweisen, es im **AWS Secret Manager** verschl√ºsselt mit einem KMS-Schl√ºssel zu verwalten

<figure><img src="../../../.gitbook/assets/image (144).png" alt=""><figcaption></figcaption></figure>

### Authentifizierung

Es gibt 3 Arten von Authentifizierungsoptionen, aber die Verwendung des **Master-Passworts ist immer erlaubt**:

<figure><img src="../../../.gitbook/assets/image (227).png" alt=""><figcaption></figcaption></figure>

### √ñffentlicher Zugriff & VPC

Standardm√§√üig wird **kein √∂ffentlicher Zugriff** auf die Datenbanken gew√§hrt, jedoch **k√∂nnte er gew√§hrt werden**. Daher k√∂nnen standardm√§√üig nur Maschinen aus derselben VPC darauf zugreifen, wenn die ausgew√§hlte **Sicherheitsgruppe** (werden in EC2 SG gespeichert) dies erlaubt.

Anstatt eine DB-Instanz offenzulegen, ist es m√∂glich, einen **RDS Proxy** zu erstellen, der die **Skalierbarkeit** und **Verf√ºgbarkeit** des DB-Clusters **verbessert**.

Dar√ºber hinaus kann auch der **Datenbankport ge√§ndert** werden.

### Verschl√ºsselung

**Verschl√ºsselung ist standardm√§√üig aktiviert** unter Verwendung eines von AWS verwalteten Schl√ºssels (ein CMK k√∂nnte stattdessen gew√§hlt werden).

Durch Aktivierung Ihrer Verschl√ºsselung aktivieren Sie **Verschl√ºsselung im Ruhezustand f√ºr Ihren Speicher, Snapshots, Read Replicas und Ihre Backups**. Schl√ºssel zur Verwaltung dieser Verschl√ºsselung k√∂nnen mit **KMS** ausgestellt werden.\
Es ist nicht m√∂glich, diese Verschl√ºsselungsebene nach der Erstellung Ihrer Datenbank hinzuzuf√ºgen. **Es muss w√§hrend der Erstellung erfolgen**.

Es gibt jedoch eine **Problemumgehung, die es Ihnen erm√∂glicht, eine unverschl√ºsselte Datenbank wie folgt zu verschl√ºsseln**. Sie k√∂nnen einen Snapshot Ihrer unverschl√ºsselten Datenbank erstellen, eine verschl√ºsselte Kopie dieses Snapshots erstellen, diesen verschl√ºsselten Snapshot verwenden, um eine neue Datenbank zu erstellen, und schlie√ülich w√§re Ihre Datenbank dann verschl√ºsselt.

#### Transparent Data Encryption (TDE)

Neben den auf Anwendungsebene inh√§renten Verschl√ºsselungsfunktionen von RDS unterst√ºtzt RDS auch **zus√§tzliche Plattform-Verschl√ºsselungsmechanismen**, um Daten im Ruhezustand zu sch√ºtzen. Dazu geh√∂rt **Transparent Data Encryption (TDE)** f√ºr Oracle und SQL Server. Es ist jedoch wichtig zu beachten, dass TDE zwar die Sicherheit durch Verschl√ºsselung von Daten im Ruhezustand erh√∂ht, es jedoch auch die **Datenbankleistung beeintr√§chtigen** kann. Diese Leistungsbeeintr√§chtigung ist besonders bemerkbar, wenn sie in Verbindung mit MySQL-Kryptografiefunktionen oder Microsoft Transact-SQL-Kryptografiefunktionen verwendet wird.

Um TDE zu nutzen, sind bestimmte Vorbereitungen erforderlich:

1. **Option Group Association**:
* Die Datenbank muss mit einer Optionsgruppe verkn√ºpft sein. Optionsgruppen dienen als Container f√ºr Einstellungen und Funktionen, die die Datenbankverwaltung, einschlie√ülich Sicherheitsverbesserungen, erleichtern.
* Es ist jedoch wichtig zu beachten, dass Optionsgruppen nur f√ºr bestimmte Datenbank-Engines und -Versionen verf√ºgbar sind.
2. **Einbeziehung von TDE in die Optionsgruppe**:
* Sobald die Datenbank mit einer Optionsgruppe verkn√ºpft ist, muss die Oracle Transparent Data Encryption-Option in diese Gruppe aufgenommen werden.
* Es ist wichtig zu erkennen, dass die TDE-Option, sobald sie zu einer Optionsgruppe hinzugef√ºgt wurde, eine dauerhafte Einrichtung ist und nicht entfernt werden kann.
3. **TDE-Verschl√ºsselungsmodi**:
* TDE bietet zwei verschiedene Verschl√ºsselungsmodi:
* **TDE Tablespace Encryption**: Dieser Modus verschl√ºsselt ganze Tabellen und bietet einen breiteren Schutzumfang.
* **TDE Column Encryption**: Dieser Modus konzentriert sich auf die Verschl√ºsselung spezifischer, einzelner Elemente innerhalb der Datenbank und erm√∂glicht eine granularere Kontrolle dar√ºber, welche Daten verschl√ºsselt werden.

Das Verst√§ndnis dieser Voraussetzungen und der betrieblichen Feinheiten von TDE ist entscheidend f√ºr die effektive Implementierung und Verwaltung der Verschl√ºsselung innerhalb von RDS, um sowohl die Datensicherheit als auch die Einhaltung notwendiger Standards zu gew√§hrleisten.

### Enumeration

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Unauthenticated Access

{% content-ref url="../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Persistence

{% content-ref url="../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQL Injection

Es gibt M√∂glichkeiten, auf DynamoDB-Daten mit **SQL-Syntax** zuzugreifen, daher sind typische **SQL-Injektionen ebenfalls m√∂glich**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
