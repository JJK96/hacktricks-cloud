# AWS - Redshift Enum

{% hint style="success" %}
Jifunze & zoezi Udukuzi wa AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Mafunzo ya HackTricks ya Mtaalam wa Timu Nyekundu ya AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze & zoezi Udukuzi wa GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Mafunzo ya HackTricks ya Mtaalam wa Timu Nyekundu ya GCP (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa michango**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
{% endhint %}

## Amazon Redshift

Redshift ni huduma iliyosimamiwa kabisa ambayo inaweza kupanuka hadi zaidi ya petabyte moja, ambayo hutumiwa kama **ghala la data kwa suluhisho kubwa za data**. Kwa kutumia vikundi vya Redshift, unaweza kufanya uchambuzi dhidi ya seti yako ya data kwa kutumia zana za uchambuzi wa haraka za msingi wa SQL na programu za ujasusi wa biashara ili kupata uelewa mkubwa wa maono ya biashara yako.

**Redshift inatoa encryption wakati wa kupumzika kwa kutumia ierarkia ya funguo nne za encryption kwa kutumia KMS au CloudHSM kusimamia safu ya juu ya funguo**. **Wakati encryption inapowashwa kwa kikundi chako, haiwezi kuzimwa na kinyume chake**. Ukiona kikundi kisichokuwa na encryption, hakiwezi kuwa na encryption.

Encryption kwa kikundi chako inaweza kutokea wakati wa uumbaji wake, na mara tu inapokuwa encrypted, data, metadata, na snapshots zote pia zina encryption. Viwango vya ierarkia ya funguo za encryption ni kama ifuatavyo, **kiwango cha kwanza ni funguo la msingi, kiwango cha pili ni funguo la encryption la kikundi, CEK, kiwango cha tatu, funguo la encryption la database, DEK, na hatimaye kiwango cha nne, funguo za encryption za data wenyewe**.

### KMS

Wakati wa uumbaji wa kikundi chako, unaweza kuchagua **funguo la KMS la chaguo-msingi** kwa Redshift au kuchagua **CMK yako mwenyewe**, ambayo inakupa uwezo zaidi juu ya udhibiti wa funguo, hasa kutoka mtazamo wa ukaguzi.

Funguo la KMS la chaguo-msingi kwa Redshift hujengwa moja kwa moja na Redshift mara ya kwanza chaguo la funguo linapochaguliwa na kutumika, na inasimamiwa kabisa na AWS.

Kisha funguo hili la KMS linachapishwa na funguo la msingi la CMK, kiwango cha kwanza. Funguo hili la KMS lililo encrypted kisha hutumiwa kama funguo la encryption la kikundi, CEK, kiwango cha pili. CEK hii kisha hutumwa na KMS kwa Redshift ambapo inahifadhiwa kando na kikundi. Redshift kisha hutoa CEK hii iliyofungwa kwa kikundi kupitia kituo salama ambapo inahifadhiwa kwenye kumbukumbu.

Redshift kisha inaomba KMS kufichua CEK, kiwango cha pili. CEK hii iliyofichuliwa kisha pia hifadhiwa kwenye kumbukumbu. Redshift kisha hujenga funguo la encryption la database la random, DEK, kiwango cha tatu, na kulipakia kwenye kumbukumbu ya kikundi. CEK iliyofichuliwa kwenye kumbukumbu kisha inaficha DEK, ambayo pia inahifadhiwa kwenye kumbukumbu.

DEK hii iliyofungwa kisha hutumwa kupitia kituo salama na kuhifadhiwa kwenye Redshift kando na kikundi. Vyote CEK na DEK sasa vimehifadhiwa kwenye kumbukumbu ya kikundi kwa hali ya kufichuliwa na kufungwa. DEK iliyofichuliwa kisha hutumiwa kuficha funguo za data, kiwango cha nne, ambazo zinazalishwa kwa nasibu na Redshift kwa kila bloki ya data katika database.

Unaweza kutumia Mshauri Mteule wa AWS kufuatilia usanidi wa vikasha vyako vya Amazon S3 na kuhakikisha kuwa uandikishaji wa kikasha umewezeshwa, ambao unaweza kuwa na manufaa kwa kufanya ukaguzi wa usalama na kufuatilia mifumo ya matumizi katika S3.

### CloudHSM

<details>

<summary>Kutumia Redshift na CloudHSM</summary>

Unapotumia CloudHSM kufanya encryption yako, kwanza unahitaji kuweka uhusiano wa kuaminika kati ya mteja wako wa HSM na Redshift wakati unatumia vyeti vya mteja na seva.

Uhusiano huu unahitajika kutoa mawasiliano salama, kuruhusu funguo za encryption kutumwa kati ya mteja wako wa HSM na vikundi vyako vya Redshift. Kwa kutumia jozi ya funguo ya faragha na ya umma iliyozalishwa kwa nasibu, Redshift hujenga cheti cha mteja cha umma, ambacho kinafichuliwa na kuhifadhiwa na Redshift. Hiki lazima kipakuliwe na kusajiliwa kwa mteja wako wa HSM, na kuhusishwa na sehemu sahihi ya HSM.

Kisha unapaswa kuiwezesha Redshift na maelezo yafuatayo ya mteja wako wa HSM: anwani ya IP ya HSM, jina la sehemu ya HSM, nenosiri la sehemu ya HSM, na cheti cha seva cha HSM cha umma, ambacho kimefichuliwa na CloudHSM kwa kutumia funguo la msingi la ndani. Mara tu maelezo haya yametolewa, Redshift itathibitisha na kuhakikisha kuwa inaweza kuunganisha na kufikia sehemu ya maendeleo.

Ikiwa sera zako za usalama za ndani au udhibiti wa utawala unahitaji ugeuzaji wa funguo, basi hii inawezekana na Redshift ikikuruhusu kugeuza funguo za encryption kwa vikundi vilivyo na encryption, hata hivyo, unahitaji kufahamu kuwa wakati wa mchakato wa ugeuzaji wa funguo, itafanya kikundi kuwa haipatikani kwa kipindi kifupi sana, hivyo ni bora kugeuza funguo wakati unahitaji tu, au ikiwa unahisi kuwa zimevujishwa.

Wakati wa ugeuzaji, Redshift itageuza CEK kwa kikundi chako na kwa nakala rudufu za kikundi hicho. Itageuza DEK kwa kikundi lakini haiwezekani kugeuza DEK kwa picha za nakala rudufu zilizohifadhiwa kwenye S3 ambazo zimefichwa kwa kutumia DEK. Itaweka kikundi katika hali ya 'kupepesuka funguo' mpaka mchakato utakapokamilika wakati hali itarudi kuwa 'ipatikanayo'.

</details>

### Urambazaji
```bash
# Get clusters
aws redshift describe-clusters
## Get if publicly accessible
aws redshift describe-clusters | jq -r ".Clusters[].PubliclyAccessible"
## Get DB username to login
aws redshift describe-clusters | jq -r ".Clusters[].MasterUsername"
## Get endpoint
aws redshift describe-clusters | jq -r ".Clusters[].Endpoint"
## Public addresses of the nodes
aws redshift describe-clusters | jq -r ".Clusters[].ClusterNodes[].PublicIPAddress"
## Get IAM roles of the clusters
aws redshift describe-clusters | jq -r ".Clusters[].IamRoles"

# Endpoint access & authorization
aws redshift describe-endpoint-access
aws redshift describe-endpoint-authorization

# Get credentials
aws redshift get-cluster-credentials --db-user <username> --cluster-identifier <cluster-id>
## By default, the temporary credentials expire in 900 seconds. You can optionally specify a duration between 900 seconds (15 minutes) and 3600 seconds (60 minutes).
aws redshift get-cluster-credentials-with-iam --cluster-identifier <cluster-id>
## Gives creds to access redshift with the IAM redshift permissions given to the current AWS account
## More in https://docs.aws.amazon.com/redshift/latest/mgmt/redshift-iam-access-control-identity-based.html

# Authentication profiles
aws redshift describe-authentication-profiles

# Snapshots
aws redshift describe-cluster-snapshots

# Scheduled actions
aws redshift describe-scheduled-actions

# Connect
# The redshift instance must be publicly available (not by default), the sg need to allow inbounds connections to the port and you need creds
psql -h redshift-cluster-1.sdflju3jdfkfg.us-east-1.redshift.amazonaws.com -U admin -d dev -p 5439
```
## Privesc

{% content-ref url="../../aws-privilege-escalation/aws-redshift-privesc.md" %}
[aws-redshift-privesc.md](../../aws-privilege-escalation/aws-redshift-privesc.md)
{% endcontent-ref %}

## Uthabiti

Vitendo vifuatavyo vinawezesha kutoa upatikanaji kwa akaunti zingine za AWS kwa kikundi:

* [authorize-endpoint-access](https://docs.aws.amazon.com/cli/latest/reference/redshift/authorize-endpoint-access.html)
* [authorize-snapshot-access](https://docs.aws.amazon.com/cli/latest/reference/redshift/authorize-snapshot-access.html)

{% hint style="success" %}
Jifunze & zoezi Udukuzi wa AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Mafunzo ya HackTricks AWS Timu Nyekundu Mtaalam (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze & zoezi Udukuzi wa GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Mafunzo ya HackTricks GCP Timu Nyekundu Mtaalam (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa michango**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
