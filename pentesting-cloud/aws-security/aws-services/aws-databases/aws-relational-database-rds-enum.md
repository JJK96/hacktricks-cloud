# AWS - Enumeraci칩n de Base de Datos Relacional (RDS)

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}

## Informaci칩n B치sica

El **Servicio de Base de Datos Relacional (RDS)** ofrecido por AWS est치 dise침ado para simplificar la implementaci칩n, operaci칩n y escalado de una **base de datos relacional en la nube**. Este servicio ofrece las ventajas de eficiencia de costos y escalabilidad al automatizar tareas intensivas en mano de obra como la provisi칩n de hardware, configuraci칩n de la base de datos, parches y copias de seguridad.

AWS RDS soporta varios motores de base de datos relacionales ampliamente utilizados, incluyendo MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server y Amazon Aurora, con compatibilidad tanto para MySQL como para PostgreSQL.

Las caracter칤sticas clave de RDS incluyen:

- La **gesti칩n de instancias de base de datos** se simplifica.
- Creaci칩n de **r칠plicas de lectura** para mejorar el rendimiento de lectura.
- Configuraci칩n de **despliegues en m칰ltiples Zonas de Disponibilidad (AZ)** para garantizar alta disponibilidad y mecanismos de conmutaci칩n por error.
- **Integraci칩n** con otros servicios de AWS, como:
  - AWS Identity and Access Management (**IAM**) para un control de acceso robusto.
  - AWS **CloudWatch** para monitoreo y m칠tricas completas.
  - AWS Key Management Service (**KMS**) para garantizar cifrado en reposo.

## Credenciales

Al crear el cl칰ster de la base de datos, se puede configurar el **nombre de usuario** maestro (**`admin`** de forma predeterminada). Para generar la contrase침a de este usuario puedes:

* **Indicar** una **contrase침a** t칰 mismo
* Decirle a RDS que la **genere autom치ticamente**
* Decirle a RDS que la administre en **AWS Secret Manager** cifrada con una clave KMS

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### Autenticaci칩n

Existen 3 tipos de opciones de autenticaci칩n, pero siempre se permite usar la **contrase침a maestra**:

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### Acceso P칰blico y VPC

Por defecto **no se otorga acceso p칰blico** a las bases de datos, sin embargo **podr칤a ser otorgado**. Por lo tanto, por defecto solo las m치quinas del mismo VPC podr치n acceder si el **grupo de seguridad** seleccionado (almacenado en EC2 SG) lo permite.

En lugar de exponer una instancia de base de datos, es posible crear un **Proxy de RDS** que **mejora** la **escalabilidad** y **disponibilidad** del cl칰ster de la base de datos.

Adem치s, el **puerto de la base de datos tambi칠n puede ser modificado**.

### Cifrado

El **cifrado est치 habilitado de forma predeterminada** utilizando una clave gestionada por AWS (se podr칤a elegir un CMK en su lugar).

Al habilitar el cifrado, est치s activando **cifrado en reposo para tu almacenamiento, instant치neas, r칠plicas de lectura y tus copias de seguridad**. Las claves para gestionar este cifrado pueden ser emitidas utilizando **KMS**.\
No es posible agregar este nivel de cifrado despu칠s de que se haya creado tu base de datos. **Debe hacerse durante su creaci칩n**.

Sin embargo, hay un **m칠todo que te permite cifrar una base de datos no cifrada de la siguiente manera**. Puedes crear una instant치nea de tu base de datos no cifrada, crear una copia cifrada de esa instant치nea, usar esa instant치nea cifrada para crear una nueva base de datos y luego, finalmente, tu base de datos estar칤a cifrada.

#### Cifrado de Datos Transparente (TDE)

Junto con las capacidades de cifrado inherentes a RDS a nivel de aplicaci칩n, RDS tambi칠n soporta **mecanismos de cifrado adicionales a nivel de plataforma** para proteger los datos en reposo. Esto incluye **Cifrado de Datos Transparente (TDE)** para Oracle y SQL Server. Sin embargo, es crucial tener en cuenta que si bien TDE mejora la seguridad al cifrar datos en reposo, tambi칠n puede **afectar el rendimiento de la base de datos**. Este impacto en el rendimiento es especialmente notable cuando se utiliza en conjunto con funciones criptogr치ficas de MySQL o funciones criptogr치ficas de Microsoft Transact-SQL.

Para utilizar TDE, se requieren ciertos pasos preliminares:

1. **Asociaci칩n de Grupo de Opciones**:
- La base de datos debe estar asociada con un grupo de opciones. Los grupos de opciones sirven como contenedores para configuraciones y caracter칤sticas, facilitando la gesti칩n de la base de datos, incluidas las mejoras de seguridad.
- Sin embargo, es importante tener en cuenta que los grupos de opciones solo est치n disponibles para motores de base de datos y versiones espec칤ficas.

2. **Inclusi칩n de TDE en Grupo de Opciones**:
- Una vez asociado con un grupo de opciones, la opci칩n de Cifrado Transparente de Datos de Oracle debe ser incluida en ese grupo.
- Es esencial reconocer que una vez que la opci칩n de TDE se agrega a un grupo de opciones, se convierte en una caracter칤stica permanente y no se puede eliminar.

3. **Modos de Cifrado TDE**:
- TDE ofrece dos modos de cifrado distintos:
- **Cifrado de Espacio de Tabla TDE**: Este modo cifra tablas completas, proporcionando un alcance m치s amplio de protecci칩n de datos.
- **Cifrado de Columna TDE**: Este modo se centra en cifrar elementos espec칤ficos e individuales dentro de la base de datos, permitiendo un control m치s granular sobre qu칠 datos se cifran.

Comprender estos requisitos previos y las complejidades operativas de TDE es crucial para implementar y gestionar de manera efectiva el cifrado dentro de RDS, asegurando tanto la seguridad de los datos como el cumplimiento de los est치ndares necesarios.

### Enumeraci칩n

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Acceso no autenticado

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Escalada de privilegios

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Post Explotaci칩n

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### Inyecci칩n SQL

Existen formas de acceder a los datos de DynamoDB con **sintaxis SQL**, por lo tanto, las **inyecciones SQL t칤picas tambi칠n son posibles**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* 춰Consulta los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
