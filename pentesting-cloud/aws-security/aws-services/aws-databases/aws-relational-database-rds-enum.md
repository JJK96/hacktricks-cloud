# AWS - Enumeratingi ya Database ya Kirelationali (RDS)

{% hint style="success" %}
Jifunze & zoezi Udukuzi wa AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Mafunzo ya HackTricks ya Mtaalam wa Timu Nyekundu ya AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze & zoezi Udukuzi wa GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Mafunzo ya HackTricks ya Mtaalam wa Timu Nyekundu ya GCP (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa michango**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
{% endhint %}

## Taarifa Msingi

**Huduma ya Database ya Kirelationali (RDS)** inayotolewa na AWS imeundwa kusaidia kuweka, kutekeleza, na kupanua **database ya kirelationali kwenye wingu**. Huduma hii inatoa faida za ufanisi wa gharama na upanuzi wakati inasimamia kazi zenye mahitaji mengi kama utoaji wa vifaa, usanidi wa database, kusasisha, na nakala rudufu.

AWS RDS inasaidia injini mbalimbali za database za kirelationali zinazotumiwa sana ikiwa ni pamoja na MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server, na Amazon Aurora, na inaambatana na MySQL na PostgreSQL.

Vipengele muhimu vya RDS ni pamoja na:

- **Usimamizi wa mifano ya database** umepunguzwa.
- Uundaji wa **nakala za kusoma** ili kuboresha utendaji wa kusoma.
- Usanidi wa **mipangilio ya eneo la upatikanaji (AZ)** ili kuhakikisha upatikanaji wa juu na mifumo ya kufanya kazi.
- **Ushirikiano** na huduma zingine za AWS, kama vile:
- Utambulisho na Usimamizi wa Upatikanaji wa AWS (**IAM**) kwa udhibiti imara wa upatikanaji.
- AWS **CloudWatch** kwa ufuatiliaji na vipimo kamili.
- Huduma ya Usimamizi wa Kichavi cha Kufungua (**KMS**) kwa kuhakikisha encryption wakati wa kupumzika.

## Sifa za Kuingia

Wakati wa kuunda kikundi cha DB, jina la **mtumiaji wa msingi** linaweza kusanidiwa (**`admin`** kwa chaguo-msingi). Ili kuzalisha nenosiri la mtumiaji huyu unaweza:

* **Taja** nenosiri **mwenyewe**
* Ambia RDS ijitengenezee yenyewe
* Ambia RDS iisimamie katika **Meneja wa Siri wa AWS** iliyofichwa na ufunguo wa KMS

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### Uthibitishaji

Kuna aina 3 za chaguo za uthibitishaji, lakini kutumia **nenosiri la msingi daima kuruhusiwa**:

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### Upatikanaji wa Umma & VPC

Kwa chaguo-msingi **hakuna upatikanaji wa umma unaruhusiwa** kwa databases, hata hivyo **inaweza kuruhusiwa**. Kwa hiyo, kwa chaguo-msingi tu mashine kutoka kwenye VPC moja itaweza kufikia ikiwa kikundi cha **usalama** kilichochaguliwa (kimehifadhiwa katika EC2 SG) kinairuhusu.

Badala ya kufunua kifaa cha DB, niwezekanavyo kuunda **RDS Proxy** ambayo **inaboresha** **upanuzi** & **upatikanaji** wa kikundi cha DB.

Zaidi ya hayo, **bandari ya database inaweza kubadilishwa** pia.

### Encryption

**Encryption imezimwa kwa chaguo-msingi** kwa kutumia ufunguo uliosimamiwa na AWS (CMK inaweza kuchaguliwa badala yake).

Kwa kuwezesha encryption yako, unawezesha **encryption wakati wa kupumzika kwa uhifadhi wako, nakala rudufu, nakala za kusoma na nakala zako za kurejesha**. Vifunguo vya kusimamia encryption hii vinaweza kutolewa kwa kutumia **KMS**.\
Siwezekani kuongeza kiwango hiki cha encryption baada ya database yako kuundwa. **Inapaswa kufanywa wakati wa uundaji wake**.

Hata hivyo, kuna **njia mbadala inayoruhusu kuweka encryption kwenye database isiyokuwa na encryption kama ifuatavyo**. Unaweza kuunda nakala ya database yako isiyokuwa na encryption, kuunda nakala iliyofichwa ya nakala hiyo, kutumia nakala iliyofichwa hiyo kuunda database mpya, na kisha, hatimaye, database yako itakuwa imefichwa.

#### Encryption ya Data ya Wazi (TDE)

Pamoja na uwezo wa encryption uliojumuishwa kwenye RDS kwenye kiwango cha maombi, RDS pia inasaidia **mifumo ya encryption ya kiwango cha jukwaa** ya ziada kulinda data wakati wa kupumzika. Hii ni pamoja na **Encryption ya Data ya Wazi (TDE)** kwa Oracle na SQL Server. Hata hivyo, ni muhimu kufahamu kwamba wakati TDE inaboresha usalama kwa kuficha data wakati wa kupumzika, inaweza pia **kuathiri utendaji wa database**. Athari hii ya utendaji inaonekana hasa wakati inatumika pamoja na MySQL cryptographic functions au Microsoft Transact-SQL cryptographic functions.

Kutumia TDE, hatua za awali fulani zinahitajika:

1. **Unganisho wa Kikundi cha Chaguo**:
- Database lazima iunganishwe na kikundi cha chaguo. Vikundi vya chaguo ni vyombo vya kuhifadhi mipangilio na vipengele, vikirahisisha usimamizi wa database, ikiwa ni pamoja na kuboresha usalama.
- Hata hivyo, ni muhimu kufahamu kwamba vikundi vya chaguo vinapatikana tu kwa injini maalum za database na toleo.

2. **Kuingiza TDE katika Kikundi cha Chaguo**:
- Mara baada ya kuunganishwa na kikundi cha chaguo, chaguo la Encryption ya Data ya Wazi la Oracle linahitaji kuingizwa katika kikundi hicho.
- Ni muhimu kutambua kwamba mara chaguo la TDE linapoongezwa kwenye kikundi cha chaguo, linakuwa sehemu ya kudumu na haliwezi kuondolewa.

3. **Modes ya Encryption ya TDE**:
- TDE inatoa modes mbili tofauti za encryption:
- **Encryption ya Tablespace ya TDE**: Mode hii inaficha meza nzima, ikitoa wigo mpana wa ulinzi wa data.
- **Encryption ya Column ya TDE**: Mode hii inazingatia kuficha vipengele maalum, binafsi ndani ya database, kuruhusu udhibiti zaidi juu ya ni data gani inafichwa.

Kuelewa mahitaji haya ya awali na utata wa uendeshaji wa TDE ni muhimu kwa utekelezaji na usimamizi wa ufanisi wa encryption ndani ya RDS, kuhakikisha usalama wa data na kufuata viwango muhimu. 

### Urambazaji

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
### Upatikanaji usiothibitishwa

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Baada ya Uvamizi

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Uthabiti

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### Uingizaji wa SQL

Kuna njia za kupata data ya DynamoDB kwa **muundo wa SQL**, hivyo, **uingizaji wa SQL wa kawaida pia ni wa kufanyika**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

{% hint style="success" %}
Jifunze & zoezi Udukuzi wa AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Mafunzo ya HackTricks ya Mtaalam wa Timu Nyekundu ya AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze & zoezi Udukuzi wa GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Mafunzo ya HackTricks ya Mtaalam wa Timu Nyekundu ya GCP (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
