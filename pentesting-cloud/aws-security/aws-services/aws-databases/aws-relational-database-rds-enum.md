# AWS - İlişkisel Veritabanı (RDS) Enum

{% hint style="success" %}
AWS Hacking'i öğrenin ve uygulayın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **Katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin**.
* **HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına PR göndererek hacking püf noktalarını paylaşın.

</details>
{% endhint %}

## Temel Bilgiler

AWS tarafından sunulan **İlişkisel Veritabanı Hizmeti (RDS)**, bir **ilişkisel veritabanının bulut** üzerinde dağıtımını, işletimini ve ölçeklendirilmesini kolaylaştırmak üzere tasarlanmıştır. Bu hizmet, maliyet verimliliği ve ölçeklenebilirlik avantajlarını sunarken donanım sağlama, veritabanı yapılandırma, yamalama ve yedekleme gibi işgücü yoğun görevleri otomatikleştirir.

AWS RDS, MySQL, PostgreSQL, MariaDB, Oracle Veritabanı, Microsoft SQL Server ve Amazon Aurora da dahil olmak üzere çeşitli yaygın olarak kullanılan ilişkisel veritabanı motorlarını destekler ve hem MySQL hem de PostgreSQL için uyumluluk sağlar.

RDS'nin temel özellikleri şunlardır:

- **Veritabanı örneklerinin yönetimi** basitleştirilmiştir.
- Okuma performansını artırmak için **okuma kopyaları** oluşturulabilir.
- Yüksek kullanılabilirlik ve otomatik geçiş mekanizmalarını sağlamak için **çoklu Erişilebilirlik Bölgesi (AZ) dağıtımları** yapılandırılabilir.
- Diğer AWS hizmetleriyle **entegrasyon** sağlar, örneğin:
- Sağlam erişim kontrolü için AWS Kimlik ve Erişim Yönetimi (**IAM**).
- Kapsamlı izleme ve metrikler için AWS **CloudWatch**.
- Dinlenme sırasında şifreleme sağlamak için AWS Anahtar Yönetimi Servisi (**KMS**).

## Kimlik Bilgileri

DB kümesi oluşturulurken ana **kullanıcı adı yapılandırılabilir** (**varsayılan olarak `admin`**). Bu kullanıcının şifresini oluşturmak için şunları yapabilirsiniz:

* Kendiniz bir **şifre belirtin**
* RDS'ye **otomatik oluşturmasını** söyleyin
* RDS'ye bunu bir KMS anahtarı ile şifrelenmiş olarak **AWS Secret Manager**'ı yönetmesini söyleyin

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### Kimlik Doğrulama

3 tür kimlik doğrulama seçeneği bulunmaktadır, ancak **ana şifre** kullanımı her zaman **izinlidir**:

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### Genel Erişim ve VPC

Varsayılan olarak veritabanlarına **genel erişim verilmez**, ancak **verilebilir**. Bu nedenle, varsayılan olarak yalnızca aynı VPC'den makineler erişebilir, seçilen **güvenlik grubu** (EC2 SG'de saklanır) bunu izin veriyorsa.

Bir DB örneğini açığa çıkarmak yerine, DB kümesinin **ölçeklenebilirliğini** ve **yayılabilirliğini artıran** bir **RDS Proxy** oluşturmak mümkündür.

Ayrıca, **veritabanı bağlantı noktası da değiştirilebilir**.

### Şifreleme

AWS yönetilen bir anahtar kullanılarak varsayılan olarak **şifreleme etkinleştirilir** (bunun yerine bir CMK seçilebilir).

Şifrelemenizi etkinleştirerek, depolama, anlık görüntüler, okuma kopyaları ve yedekleriniz için **dinlenme sırasında şifrelemeyi etkinleştirirsiniz**. Bu şifrelemeyi yönetmek için anahtarlar, **KMS** kullanılarak verilebilir.\
Bu düzeyde şifrelemeyi veritabanınız oluşturulduktan sonra eklemek mümkün değildir. **Oluşturulurken yapılması gerekir**.

Ancak, aşağıdaki gibi bir **şifrelenmemiş veritabanını şifrelemeye izin veren bir çözüm vardır**. Şifrelenmemiş veritabanınızın bir anlık görüntüsünü oluşturabilir, bu anlık görüntünün şifrelenmiş bir kopyasını oluşturabilir, bu şifrelenmiş anlık görüntüyü kullanarak yeni bir veritabanı oluşturabilir ve ardından veritabanınız şifrelenmiş olacaktır.

#### Şeffaf Veri Şifreleme (TDE)

Uygulama düzeyinde RDS'nin sahip olduğu şifreleme yeteneklerinin yanı sıra, RDS ayrıca verileri dinlenme sırasında korumak için **ek platform düzeyinde şifreleme mekanizmalarını** destekler. Bu, Oracle ve SQL Server için **Şeffaf Veri Şifreleme (TDE)**'yi içerir. Ancak, TDE, verileri dinlenme sırasında şifreleyerek güvenliği artırırken aynı zamanda **veritabanı performansını etkileyebileceğini** önemli bir şekilde belirtmek önemlidir. Bu performans etkisi özellikle MySQL şifreleme işlevleri veya Microsoft Transact-SQL şifreleme işlevleri ile birlikte kullanıldığında fark edilir.

TDE'yi kullanmak için belirli ön adımlar gereklidir:

1. **Seçenek Grubu İlişkilendirme**:
- Veritabanı bir seçenek grubu ile ilişkilendirilmelidir. Seçenek grupları, ayarlar ve özellikler için konteynerler olarak hizmet verir, güvenlik geliştirmeleri de dahil olmak üzere veritabanı yönetimini kolaylaştırır.
- Ancak, seçenek gruplarının yalnızca belirli veritabanı motorları ve sürümleri için mevcut olduğunu unutmamak önemlidir.

2. **Seçenek Grubuna TDE Dahil Etme**:
- Bir seçenek grubu ile ilişkilendirildikten sonra, Oracle Şeffaf Veri Şifreleme seçeneği o gruba dahil edilmelidir.
- TDE seçeneği bir seçenek grubuna eklendikten sonra, kalıcı bir özellik haline gelir ve kaldırılamaz.

3. **TDE Şifreleme Modları**:
- TDE iki farklı şifreleme modu sunar:
- **TDE Tablespace Şifrelemesi**: Bu mod, tüm tabloları şifreler ve daha geniş bir veri koruma kapsamı sağlar.
- **TDE Sütun Şifrelemesi**: Bu mod, veritabanı içinde belirli, bireysel öğeleri şifrelemeye odaklanarak hangi verilerin şifreleneceği konusunda daha ayrıntılı kontrol sağlar.

Bu ön koşulları ve TDE'nin işletimsel inceliklerini anlamak, RDS içinde şifreleme etkin bir şekilde uygulamak ve yönetmek için kritik öneme sahiptir, veri güvenliğini sağlamak ve gerekli standartlara uygunluğu sağlamak için. 

### Numaralandırma

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Kimlik Doğrulamasız Erişim

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### İzin Yükseltme

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Saldırı Sonrası İşlemler

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Kalıcılık

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQL Enjeksiyonu

DynamoDB verilerine **SQL sözdizimi** ile erişmenin yolları vardır, bu nedenle tipik **SQL enjeksiyonları da mümkündür**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

{% hint style="success" %}
AWS Hacking'i öğrenin ve uygulayın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi Twitter'da takip edin 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* Hacking püf noktalarını paylaşarak PR'ler göndererek [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
{% endhint %}
