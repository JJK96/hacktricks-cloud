# AWS - 关系型数据库（RDS）枚举

{% hint style="success" %}
学习和实践AWS黑客技术：<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks培训AWS红队专家（ARTE）**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
学习和实践GCP黑客技术：<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks培训GCP红队专家（GRTE）**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持HackTricks</summary>

- 检查[**订阅计划**](https://github.com/sponsors/carlospolop)!
- **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或 **关注**我们的 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
- 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享黑客技巧。

</details>
{% endhint %}

## 基本信息

AWS提供的**关系型数据库服务（RDS）**旨在简化在云中部署、运行和扩展**关系型数据库**。该服务提供了成本效益和可伸缩性的优势，同时自动化了诸如硬件配置、数据库配置、打补丁和备份等繁重的任务。

AWS RDS支持包括MySQL、PostgreSQL、MariaDB、Oracle数据库、Microsoft SQL Server和Amazon Aurora在内的各种广泛使用的关系型数据库引擎，兼容MySQL和PostgreSQL。

RDS的关键特性包括：

- **简化数据库实例的管理**。
- 创建**只读副本**以提高读取性能。
- 配置**多可用区（AZ）部署**以确保高可用性和故障转移机制。
- 与其他AWS服务的**集成**，例如：
- 用于强大访问控制的AWS身份和访问管理（**IAM**）。
- 用于全面监控和指标的AWS **CloudWatch**。
- 用于确保静态加密的AWS密钥管理服务（**KMS**）。

## 凭据

在创建DB集群时，可以配置主**用户名**（默认为**`admin`**）。要生成此用户的密码，您可以：

- **自己指定**一个**密码**
- 告诉RDS**自动生成**它
- 告诉RDS将其管理在使用KMS密钥加密的**AWS Secret Manager**中

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### 认证

有3种认证选项，但始终允许使用**主密码**：

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### 公共访问和VPC

默认情况下，数据库**不允许公共访问**，但是**可以允许**。因此，默认情况下，只有来自相同VPC的计算机才能访问它，如果所选的**安全组**（存储在EC2 SG中）允许。

可以创建一个**RDS代理**，而不是暴露一个DB实例，这将**提高**DB集群的**可伸缩性**和**可用性**。

此外，还可以修改**数据库端口**。

### 加密

使用AWS托管密钥（也可以选择CMK）默认启用**加密**。

通过启用加密，您正在为您的存储、快照、只读副本和备份启用**静态加密**。可以通过使用**KMS**发放管理此加密的密钥。\
在创建数据库后，无法添加此加密级别。**必须在创建期间完成**。

但是，有一个**解决方法允许您对未加密的数据库进行加密**。您可以创建未加密数据库的快照，创建该快照的加密副本，使用该加密快照创建新数据库，然后最终，您的数据库将被加密。

#### 透明数据加密（TDE）

除了RDS在应用程序级别固有的加密功能外，RDS还支持**额外的平台级别加密机制**，以保护静态数据。这包括Oracle和SQL Server的**透明数据加密（TDE）**。但是，需要注意的是，虽然TDE通过加密静态数据增强了安全性，但它也可能**影响数据库性能**。当与MySQL加密函数或Microsoft Transact-SQL加密函数一起使用时，特别容易注意到这种性能影响。

要使用TDE，需要进行一些预备步骤：

1. **选项组关联**：
- 数据库必须与选项组关联。选项组用作设置和功能的容器，促进数据库管理，包括安全增强功能。
- 但是，重要的是要注意，选项组仅适用于特定的数据库引擎和版本。

2. **在选项组中包含TDE**：
- 一旦与选项组关联，需要在该组中包含Oracle透明数据加密选项。
- 需要认识到一旦TDE选项添加到选项组中，它就成为一个永久的组成部分，无法移除。

3. **TDE加密模式**：
- TDE提供两种不同的加密模式：
- **TDE表空间加密**：此模式加密整个表，提供更广泛的数据保护范围。
- **TDE列加密**：此模式专注于加密数据库中的特定单个元素，允许更精细的控制哪些数据被加密。

了解这些先决条件和TDE的操作复杂性对于有效实施和管理RDS内的加密至关重要，确保数据安全性并符合必要的标准。

### 枚举

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### 未经身份验证的访问

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### 提权

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### 后渗透

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### 持久性

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQL注入

有方法可以使用**SQL语法**访问DynamoDB数据，因此，典型的**SQL注入也是可能的**。

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

{% hint style="success" %}
学习并练习AWS黑客技能：<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks培训AWS红队专家（ARTE）**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
学习并练习GCP黑客技能：<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks培训GCP红队专家（GRTE）**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持HackTricks</summary>

* 查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**电报群组**](https://t.me/peass) 或 **关注**我们的**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享黑客技巧。

</details>
{% endhint %}
