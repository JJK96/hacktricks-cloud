# AWS - Enumera√ß√£o do Banco de Dados Relacional (RDS)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Treinamento HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Treinamento HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Suporte ao HackTricks</summary>

* Verifique os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>
{% endhint %}

## Informa√ß√µes B√°sicas

O **Servi√ßo de Banco de Dados Relacional (RDS)** oferecido pela AWS √© projetado para simplificar a implanta√ß√£o, opera√ß√£o e dimensionamento de um **banco de dados relacional na nuvem**. Este servi√ßo oferece as vantagens de efici√™ncia de custos e escalabilidade, automatizando tarefas intensivas em m√£o de obra como provisionamento de hardware, configura√ß√£o de banco de dados, aplica√ß√£o de patches e backups.

O AWS RDS suporta v√°rios motores de banco de dados relacionais amplamente utilizados, incluindo MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server e Amazon Aurora, com compatibilidade tanto para MySQL quanto para PostgreSQL.

Recursos-chave do RDS incluem:

- A **gest√£o de inst√¢ncias de banco de dados** √© simplificada.
- Cria√ß√£o de **r√©plicas de leitura** para melhorar o desempenho de leitura.
- Configura√ß√£o de **implanta√ß√µes multi-zona de disponibilidade (AZ)** para garantir alta disponibilidade e mecanismos de failover.
- **Integra√ß√£o** com outros servi√ßos da AWS, como:
- AWS Identity and Access Management (**IAM**) para controle de acesso robusto.
- AWS **CloudWatch** para monitoramento abrangente e m√©tricas.
- AWS Key Management Service (**KMS**) para garantir criptografia em repouso.

## Credenciais

Ao criar o cluster de banco de dados, o **nome de usu√°rio** principal pode ser configurado (**`admin`** por padr√£o). Para gerar a senha deste usu√°rio, voc√™ pode:

* **Indicar** uma **senha** voc√™ mesmo
* Dizer ao RDS para **gerar automaticamente** a senha
* Dizer ao RDS para gerenci√°-la no **AWS Secret Manager** criptografada com uma chave KMS

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### Autentica√ß√£o

Existem 3 tipos de op√ß√µes de autentica√ß√£o, mas usar a **senha principal √© sempre permitido**:

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### Acesso P√∫blico & VPC

Por padr√£o, **nenhum acesso p√∫blico √© concedido** aos bancos de dados, no entanto, **pode ser concedido**. Portanto, por padr√£o, apenas m√°quinas da mesma VPC poder√£o acess√°-lo se o **grupo de seguran√ßa** selecionado (armazenado em SG EC2) permitir.

Em vez de expor uma inst√¢ncia de banco de dados, √© poss√≠vel criar um **Proxy RDS** que **melhora** a **escalabilidade** e **disponibilidade** do cluster de banco de dados.

Al√©m disso, a **porta do banco de dados pode ser modificada** tamb√©m.

### Criptografia

**A criptografia √© habilitada por padr√£o** usando uma chave gerenciada pela AWS (poderia ser escolhida uma CMK).

Ao habilitar sua criptografia, voc√™ est√° ativando **criptografia em repouso para seu armazenamento, snapshots, r√©plicas de leitura e backups**. Chaves para gerenciar essa criptografia podem ser emitidas usando **KMS**.\
N√£o √© poss√≠vel adicionar esse n√≠vel de criptografia ap√≥s a cria√ß√£o do seu banco de dados. **Deve ser feito durante a sua cria√ß√£o**.

No entanto, h√° uma **solu√ß√£o alternativa que permite criptografar um banco de dados n√£o criptografado da seguinte forma**. Voc√™ pode criar um snapshot do seu banco de dados n√£o criptografado, criar uma c√≥pia criptografada desse snapshot, usar esse snapshot criptografado para criar um novo banco de dados e, finalmente, seu banco de dados estaria ent√£o criptografado.

#### Criptografia de Dados Transparente (TDE)

Junto com as capacidades de criptografia inerentes ao RDS no n√≠vel da aplica√ß√£o, o RDS tamb√©m suporta **mecanismos adicionais de criptografia em n√≠vel de plataforma** para proteger os dados em repouso. Isso inclui **Criptografia de Dados Transparente (TDE)** para Oracle e SQL Server. No entanto, √© crucial notar que enquanto o TDE aprimora a seguran√ßa criptografando dados em repouso, tamb√©m pode **afetar o desempenho do banco de dados**. Esse impacto de desempenho √© especialmente percept√≠vel quando usado em conjunto com fun√ß√µes criptogr√°ficas do MySQL ou fun√ß√µes criptogr√°ficas do Microsoft Transact-SQL.

Para utilizar o TDE, s√£o necess√°rias certas etapas preliminares:

1. **Associa√ß√£o de Grupo de Op√ß√µes**:
- O banco de dados deve ser associado a um grupo de op√ß√µes. Os grupos de op√ß√µes servem como cont√™ineres para configura√ß√µes e recursos, facilitando a gest√£o do banco de dados, incluindo aprimoramentos de seguran√ßa.
- No entanto, √© importante observar que os grupos de op√ß√µes est√£o dispon√≠veis apenas para motores de banco de dados e vers√µes espec√≠ficas.

2. **Inclus√£o do TDE no Grupo de Op√ß√µes**:
- Uma vez associado a um grupo de op√ß√µes, a op√ß√£o de Criptografia de Dados Transparente do Oracle precisa ser inclu√≠da nesse grupo.
- √â essencial reconhecer que uma vez que a op√ß√£o TDE √© adicionada a um grupo de op√ß√µes, ela se torna uma caracter√≠stica permanente e n√£o pode ser removida.

3. **Modos de Criptografia TDE**:
- O TDE oferece dois modos de criptografia distintos:
- **Criptografia de Espa√ßo de Tabelas TDE**: Este modo criptografa tabelas inteiras, proporcionando um escopo mais amplo de prote√ß√£o de dados.
- **Criptografia de Coluna TDE**: Este modo concentra-se na criptografia de elementos espec√≠ficos e individuais dentro do banco de dados, permitindo um controle mais granular sobre quais dados s√£o criptografados.

Compreender esses pr√©-requisitos e as complexidades operacionais do TDE √© crucial para implementar e gerenciar efetivamente a criptografia dentro do RDS, garantindo tanto a seguran√ßa dos dados quanto a conformidade com os padr√µes necess√°rios.

### Enumera√ß√£o

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
### Acesso n√£o autenticado

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Privil√©gio de Escala√ß√£o

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### P√≥s Explora√ß√£o

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Persist√™ncia

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### Inje√ß√£o de SQL

Existem maneiras de acessar dados do DynamoDB com **sintaxe SQL**, portanto, **inje√ß√µes de SQL t√≠picas tamb√©m s√£o poss√≠veis**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

{% hint style="success" %}
Aprenda e pratique Hacking na AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Treinamento HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprenda e pratique Hacking no GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Treinamento HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Suporte ao HackTricks</summary>

* Verifique os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
