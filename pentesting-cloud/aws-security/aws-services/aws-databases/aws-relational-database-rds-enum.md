# AWS - Enumerazione del Database Relazionale (RDS)

{% hint style="success" %}
Impara e pratica l'Hacking AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Impara e pratica l'Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Sostieni HackTricks</summary>

- Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
- **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
- **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repository di Github.

</details>
{% endhint %}

## Informazioni di Base

Il **Servizio Database Relazionale (RDS)** offerto da AWS √® progettato per semplificare il rilascio, il funzionamento e la scalabilit√† di un **database relazionale nel cloud**. Questo servizio offre i vantaggi dell'efficienza dei costi e della scalabilit√† automatizzando compiti intensivi come la fornitura di hardware, la configurazione del database, il patching e i backup.

AWS RDS supporta vari motori di database relazionali ampiamente utilizzati tra cui MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server e Amazon Aurora, con compatibilit√† sia per MySQL che per PostgreSQL.

Le caratteristiche chiave di RDS includono:

- La **gestione delle istanze del database** √® semplificata.
- Creazione di **repliche di lettura** per migliorare le prestazioni di lettura.
- Configurazione di **implementazioni multi-Zona di Disponibilit√† (AZ)** per garantire alta disponibilit√† e meccanismi di failover.
- **Integrazione** con altri servizi AWS, come:
  - AWS Identity and Access Management (**IAM**) per un robusto controllo degli accessi.
  - AWS **CloudWatch** per il monitoraggio e le metriche completi.
  - AWS Key Management Service (**KMS**) per garantire la crittografia al riposo.

## Credenziali

Quando si crea il cluster del database il **nome utente** principale pu√≤ essere configurato (**`admin`** di default). Per generare la password di questo utente √® possibile:

- **Indicare** una **password** tu stesso
- Dire a RDS di **generarla automaticamente**
- Dire a RDS di gestirla in **AWS Secret Manager** criptata con una chiave KMS

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### Autenticazione

Ci sono 3 tipi di opzioni di autenticazione, ma l'uso della **password principale √® sempre consentito**:

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### Accesso Pubblico e VPC

Di default **non √® concesso alcun accesso pubblico** ai database, tuttavia **potrebbe essere concesso**. Quindi, di default solo le macchine dalla stessa VPC potranno accedervi se il **gruppo di sicurezza** selezionato (sono memorizzati in EC2 SG) lo consente.

Invece di esporre un'istanza del database, √® possibile creare un **Proxy RDS** che **migliora** la **scalabilit√†** e la **disponibilit√†** del cluster del database.

Inoltre, la **porta del database pu√≤ essere modificata** anche.

### Crittografia

**La crittografia √® abilitata di default** utilizzando una chiave gestita da AWS (potrebbe essere scelta una CMK).

Abilitando la crittografia, si abilita la **crittografia al riposo per il tuo storage, snapshot, repliche di lettura e i tuoi backup**. Le chiavi per gestire questa crittografia possono essere emesse utilizzando **KMS**.\
Non √® possibile aggiungere questo livello di crittografia dopo che il tuo database √® stato creato. **Deve essere fatto durante la sua creazione**.

Tuttavia, c'√® un **workaround che ti consente di crittografare un database non crittografato come segue**. Puoi creare uno snapshot del tuo database non crittografato, creare una copia crittografata di tale snapshot, utilizzare quel snapshot crittografato per creare un nuovo database e quindi, infine, il tuo database sarebbe crittografato.

#### Crittografia dei Dati Trasparente (TDE)

Oltre alle capacit√† di crittografia intrinseche a RDS a livello di applicazione, RDS supporta anche **meccanismi di crittografia a livello di piattaforma aggiuntivi** per proteggere i dati al riposo. Questo include la **Crittografia dei Dati Trasparente (TDE)** per Oracle e SQL Server. Tuttavia, √® cruciale notare che mentre TDE migliora la sicurezza crittografando i dati al riposo, potrebbe anche **influenzare le prestazioni del database**. Questo impatto sulle prestazioni √® particolarmente evidente quando viene utilizzato in concomitanza con le funzioni crittografiche MySQL o le funzioni crittografiche Transact-SQL di Microsoft.

Per utilizzare TDE, sono necessari determinati passaggi preliminari:

1. **Associazione del Gruppo di Opzioni**:
   - Il database deve essere associato a un gruppo di opzioni. I gruppi di opzioni fungono da contenitori per impostazioni e funzionalit√†, facilitando la gestione del database, inclusi miglioramenti della sicurezza.
   - Tuttavia, √® importante notare che i gruppi di opzioni sono disponibili solo per motori di database e versioni specifiche.

2. **Inclusione di TDE nel Gruppo di Opzioni**:
   - Una volta associato a un gruppo di opzioni, l'opzione di Crittografia dei Dati Trasparente di Oracle deve essere inclusa in tale gruppo.
   - √à essenziale riconoscere che una volta che l'opzione TDE √® aggiunta a un gruppo di opzioni, diventa una caratteristica permanente e non pu√≤ essere rimossa.

3. **Modalit√† di Crittografia TDE**:
   - TDE offre due modalit√† di crittografia distinte:
     - **Crittografia dello Spazio delle Tabelle TDE**: Questa modalit√† crittografa intere tabelle, fornendo un'ampia protezione dei dati.
     - **Crittografia delle Colonne TDE**: Questa modalit√† si concentra sulla crittografia di elementi specifici e individuali all'interno del database, consentendo un controllo pi√π granulare su quali dati vengono crittografati.

Comprendere questi requisiti preliminari e le complessit√† operative di TDE √® cruciale per implementare e gestire in modo efficace la crittografia all'interno di RDS, garantendo sia la sicurezza dei dati che la conformit√† agli standard necessari.

### Enumerazione

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Accesso non autenticato

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Post Esploitation

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Persistenza

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQL Injection

Ci sono modi per accedere ai dati di DynamoDB con **sintassi SQL**, quindi, sono possibili anche **iniezioni SQL tipiche**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

{% hint style="success" %}
Impara e pratica l'Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Impara e pratica l'Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repository di Github.

</details>
{% endhint %}
