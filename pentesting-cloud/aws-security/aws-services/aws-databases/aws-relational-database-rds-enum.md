# AWS - Base de donn√©es relationnelle (RDS) Enum

{% hint style="success" %}
Apprenez et pratiquez le piratage AWS :<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Formation HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez le piratage GCP : <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Formation HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
{% endhint %}

## Informations de base

Le **Service de base de donn√©es relationnelle (RDS)** propos√© par AWS est con√ßu pour simplifier le d√©ploiement, l'exploitation et la mise √† l'√©chelle d'une **base de donn√©es relationnelle dans le cloud**. Ce service offre les avantages de l'efficacit√© financi√®re et de la scalabilit√© tout en automatisant des t√¢ches intensives en main-d'≈ìuvre telles que la provision de mat√©riel, la configuration de la base de donn√©es, le patching et les sauvegardes.

AWS RDS prend en charge divers moteurs de base de donn√©es relationnelle largement utilis√©s, notamment MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server et Amazon Aurora, avec une compatibilit√© pour MySQL et PostgreSQL.

Les fonctionnalit√©s cl√©s de RDS comprennent :

- La **simplification de la gestion des instances de base de donn√©es**.
- La cr√©ation de **r√©pliques de lecture** pour am√©liorer les performances en lecture.
- La configuration de **d√©ploiements multi-zones de disponibilit√© (AZ)** pour garantir une haute disponibilit√© et des m√©canismes de basculement.
- **L'int√©gration** avec d'autres services AWS, tels que :
  - AWS Identity and Access Management (**IAM**) pour un contr√¥le d'acc√®s robuste.
  - AWS **CloudWatch** pour une surveillance et des m√©triques compl√®tes.
  - AWS Key Management Service (**KMS**) pour garantir le chiffrement au repos.

## Informations d'identification

Lors de la cr√©ation du cluster de base de donn√©es, le **nom d'utilisateur** principal peut √™tre configur√© (**`admin`** par d√©faut). Pour g√©n√©rer le mot de passe de cet utilisateur, vous pouvez :

* **Indiquer** un **mot de passe** vous-m√™me
* Demander √† RDS de le **g√©n√©rer automatiquement**
* Demander √† RDS de le g√©rer dans **AWS Secret Manager** chiffr√© avec une cl√© KMS

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### Authentification

Il existe 3 options d'authentification, mais l'utilisation du **mot de passe principal est toujours autoris√©e** :

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### Acc√®s public & VPC

Par d√©faut, **aucun acc√®s public n'est accord√©** aux bases de donn√©es, cependant cela **pourrait √™tre autoris√©**. Par cons√©quent, par d√©faut, seules les machines du m√™me VPC pourront y acc√©der si le **groupe de s√©curit√©** s√©lectionn√© (stock√© dans EC2 SG) le permet.

Au lieu d'exposer une instance de base de donn√©es, il est possible de cr√©er un **proxy RDS** qui **am√©liore** la **scalabilit√©** et la **disponibilit√©** du cluster de base de donn√©es.

De plus, le **port de la base de donn√©es peut √©galement √™tre modifi√©**.

### Chiffrement

**Le chiffrement est activ√© par d√©faut** en utilisant une cl√© g√©r√©e par AWS (une CMK pourrait √™tre choisie √† la place).

En activant votre chiffrement, vous activez le **chiffrement au repos pour votre stockage, vos instantan√©s, vos r√©pliques de lecture et vos sauvegardes**. Les cl√©s pour g√©rer ce chiffrement peuvent √™tre √©mises en utilisant **KMS**.\
Il n'est pas possible d'ajouter ce niveau de chiffrement apr√®s la cr√©ation de votre base de donn√©es. **Cela doit √™tre fait lors de sa cr√©ation**.

Cependant, il existe une **solution de contournement vous permettant de chiffrer une base de donn√©es non chiffr√©e comme suit**. Vous pouvez cr√©er un instantan√© de votre base de donn√©es non chiffr√©e, cr√©er une copie chiffr√©e de cet instantan√©, utiliser cet instantan√© chiffr√© pour cr√©er une nouvelle base de donn√©es, et ensuite, enfin, votre base de donn√©es serait alors chiffr√©e.

#### Chiffrement des donn√©es transparent (TDE)

En plus des capacit√©s de chiffrement inh√©rentes √† RDS au niveau de l'application, RDS prend √©galement en charge des **m√©canismes de chiffrement suppl√©mentaires au niveau de la plate-forme** pour prot√©ger les donn√©es au repos. Cela inclut le **chiffrement transparent des donn√©es (TDE)** pour Oracle et SQL Server. Cependant, il est crucial de noter que tandis que le TDE renforce la s√©curit√© en chiffrant les donn√©es au repos, cela peut √©galement **affecter les performances de la base de donn√©es**. Cet impact sur les performances est particuli√®rement notable lorsqu'il est utilis√© en conjonction avec des fonctions cryptographiques MySQL ou des fonctions cryptographiques Transact-SQL de Microsoft.

Pour utiliser le TDE, certaines √©tapes pr√©liminaires sont n√©cessaires :

1. **Association du groupe d'options** :
- La base de donn√©es doit √™tre associ√©e √† un groupe d'options. Les groupes d'options servent de conteneurs pour les param√®tres et les fonctionnalit√©s, facilitant la gestion de la base de donn√©es, y compris les am√©liorations de s√©curit√©.
- Cependant, il est important de noter que les groupes d'options ne sont disponibles que pour des moteurs de base de donn√©es et des versions sp√©cifiques.

2. **Inclusion du TDE dans le groupe d'options** :
- Une fois associ√© √† un groupe d'options, l'option de chiffrement transparent des donn√©es Oracle doit √™tre incluse dans ce groupe.
- Il est essentiel de reconna√Ætre que une fois que l'option TDE est ajout√©e √† un groupe d'options, elle devient une fonctionnalit√© permanente et ne peut pas √™tre supprim√©e.

3. **Modes de chiffrement TDE** :
- Le TDE offre deux modes de chiffrement distincts :
- **Chiffrement de l'espace de table TDE** : Ce mode chiffre des tables enti√®res, offrant une protection des donn√©es plus √©tendue.
- **Chiffrement de colonne TDE** : Ce mode se concentre sur le chiffrement d'√©l√©ments sp√©cifiques et individuels dans la base de donn√©es, permettant un contr√¥le plus granulaire sur les donn√©es √† chiffrer.

Comprendre ces pr√©requis et les subtilit√©s op√©rationnelles du TDE est crucial pour impl√©menter et g√©rer efficacement le chiffrement dans RDS, garantissant √† la fois la s√©curit√© des donn√©es et la conformit√© aux normes n√©cessaires.

### √ânum√©ration

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
### Acc√®s non authentifi√©

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### √âl√©vation de privil√®ges

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Post-exploitation

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Persistance

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### Injection SQL

Il existe des moyens d'acc√©der aux donn√©es DynamoDB avec une **syntaxe SQL**, par cons√©quent, les **injections SQL classiques sont √©galement possibles**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

{% hint style="success" %}
Apprenez et pratiquez le piratage AWS : <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Formation HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez le piratage GCP : <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Formation HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
