# AWS - Relacijska baza podataka (RDS) Enum

{% hint style="success" %}
Naučite i vežbajte hakovanje AWS-a:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Naučite i vežbajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Osnovne informacije

**Relacijska baza podataka (RDS)** koju nudi AWS dizajnirana je da olakša implementaciju, operaciju i skaliranje **relacione baze podataka u oblaku**. Ova usluga nudi prednosti u pogledu efikasnosti troškova i skalabilnosti dok automatizuje zadatke koji zahtevaju puno rada, poput obezbeđivanja hardvera, konfiguracije baze podataka, zakrpa i rezervnih kopija.

AWS RDS podržava različite široko korišćene motore relacijskih baza podataka, uključujući MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server i Amazon Aurora, sa kompatibilnošću za MySQL i PostgreSQL.

Ključne karakteristike RDS-a uključuju:

- Pojednostavljenje **upravljanja instancama baze podataka**.
- Kreiranje **read replika** radi poboljšanja performansi čitanja.
- Konfiguracija **multi-Availability Zone (AZ) implementacija** radi obezbeđivanja visoke dostupnosti i mehanizama preusmeravanja.
- **Integracija** sa drugim AWS uslugama, kao što su:
- AWS Identity and Access Management (**IAM**) za snažnu kontrolu pristupa.
- AWS **CloudWatch** za sveobuhvatno praćenje i metrike.
- AWS Key Management Service (**KMS**) za obezbeđivanje šifrovanja u mirovanju.

## Kredencijali

Prilikom kreiranja DB klastera, glavno **korisničko ime** može se konfigurisati (podrazumevano je **`admin`**). Da biste generisali lozinku ovog korisnika, možete:

* **Navesti** lozinku sami
* Recite RDS-u da je **automatski generiše**
* Recite RDS-u da je upravlja u **AWS Secret Manageru** šifrovano sa KMS ključem

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### Autentikacija

Postoje 3 vrste opcija za autentikaciju, ali korišćenje **glavne lozinke je uvek dozvoljeno**:

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### Javni pristup & VPC

Podrazumevano **nema javnog pristupa** bazama podataka, međutim, **može se omogućiti**. Stoga, podrazumevano samo mašine iz iste VPC će moći da joj pristupe ako odabrana **sigurnosna grupa** (koje se čuvaju u EC2 SG) to dozvoljava.

Umesto izlaganja DB instance, moguće je kreirati **RDS Proxy** koji **unapređuje** **skalabilnost** i **dostupnost** DB klastera.

Takođe, **port baze podataka se može izmeniti**.

### Šifrovanje

**Šifrovanje je podrazumevano omogućeno** korišćenjem AWS upravljanih ključeva (umesto toga može se izabrati CMK).

Omogućavanjem šifrovanja, omogućavate **šifrovanje u mirovanju za vaše skladište, snimke, read replike i rezervne kopije**. Ključevi za upravljanje ovim šifrovanjem mogu se izdati korišćenjem **KMS**-a.\
Nije moguće dodati ovaj nivo šifrovanja nakon što je vaša baza podataka kreirana. **To se mora uraditi tokom njenog kreiranja**.

Međutim, postoji **obilaženje koje vam omogućava da šifrujete nešifrovanu bazu podataka na sledeći način**. Možete kreirati snimak vaše nešifrovane baze podataka, kreirati šifrovanu kopiju tog snimka, koristiti taj šifrovani snimak da kreirate novu bazu podataka, a zatim, na kraju, vaša baza podataka biće šifrovana.

#### Transparentno šifrovanje podataka (TDE)

Pored sposobnosti šifrovanja inherentnih RDS-u na nivou aplikacije, RDS takođe podržava **dodatne mehanizme šifrovanja na platformi** radi zaštite podataka u mirovanju. To uključuje **Transparentno šifrovanje podataka (TDE)** za Oracle i SQL Server. Međutim, važno je napomenuti da dok TDE unapređuje bezbednost šifrovanjem podataka u mirovanju, može takođe **uticati na performanse baze podataka**. Ovaj uticaj na performanse posebno je primetan kada se koristi u kombinaciji sa MySQL kriptografskim funkcijama ili Microsoft Transact-SQL kriptografskim funkcijama.

Da biste koristili TDE, potrebni su određeni preliminarni koraci:

1. **Asocijacija grupe opcija**:
- Baza podataka mora biti povezana sa grupom opcija. Grupe opcija služe kao kontejneri za podešavanja i funkcije, olakšavajući upravljanje bazom podataka, uključujući bezbednosna unapređenja.
- Međutim, važno je napomenuti da su grupe opcija dostupne samo za određene motore baza podataka i verzije.

2. **Uključivanje TDE-a u grupu opcija**:
- Jednom kada je povezan sa grupom opcija, opcija Transparentnog šifrovanja podataka za Oracle mora biti uključena u tu grupu.
- Važno je prepoznati da kada se TDE opcija doda grupi opcija, postaje trajni element i ne može se ukloniti.

3. **TDE režimi šifrovanja**:
- TDE nudi dva različita režima šifrovanja:
- **Šifrovanje tabele TDE**: Ovaj režim šifruje cele tabele, pružajući širi opseg zaštite podataka.
- **Šifrovanje kolone TDE**: Ovaj režim se fokusira na šifrovanje određenih, pojedinačnih elemenata unutar baze podataka, omogućavajući precizniju kontrolu nad tim koje podatke su šifrovani.

Razumevanje ovih preduslova i operativnih složenosti TDE-a ključno je za efikasnu implementaciju i upravljanje šifrovanjem unutar RDS-a, obezbeđujući kako bezbednost podataka, tako i usklađenost sa neophodnim standardima.

### Enumeracija

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Neautentifikovan pristup

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Post Eksploatacija

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Upornost

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQL Injection

Postoje načini za pristup podacima DynamoDB-a sa **SQL sintaksom**, stoga su mogući i tipični **SQL injection napadi**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

{% hint style="success" %}
Naučite i vežbajte hakovanje AWS-a:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Naučite i vežbajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili **telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
