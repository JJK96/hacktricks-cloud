# AWS - DynamoDB Enum

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** στη 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ υποβάλλοντας PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## DynamoDB

### Βασικές Πληροφορίες

Το Amazon DynamoDB παρουσιάζεται από το AWS ως μια **πλήρως διαχειριζόμενη, serverless, key-value NoSQL βάση δεδομένων**, σχεδιασμένη για την υποστήριξη υψηλής απόδοσης εφαρμογών ανεξαρτήτως μεγέθους τους. Η υπηρεσία εξασφαλίζει αξιόπιστα χαρακτηριστικά, συμπεριλαμβανομένων ενσωματωμένων μέτρων ασφαλείας, αδιάκοπων αντιγράφων ασφαλείας, αυτόματης αντιγραφής σε πολλαπλές περιοχές, ολοκληρωμένης μνήμης cache και βολικών εργαλείων εξαγωγής δεδομένων.

Στο πλαίσιο του DynamoDB, αντί να δημιουργείτε μια παραδοσιακή βάση δεδομένων, **δημιουργούνται πίνακες**. Κάθε πίνακας απαιτεί την καθορισμό ενός **κλειδιού διαμερισμού** ως ουσιώδες στοιχείο του **κύριου κλειδιού του πίνακα**. Αυτό το κλειδί διαμερισμού, ουσιαστικά μια **τιμή κατακερματισμού**, διαδραματίζει κρίσιμο ρόλο τόσο στην ανάκτηση στοιχείων όσο και στη διανομή δεδομένων σε διάφορους κόμβους. Αυτή η διανομή είναι κρίσιμη για τη διατήρηση τόσο της επεκτασιμότητας όσο και της διαθεσιμότητας της βάσης δεδομένων. Επιπλέον, υπάρχει η δυνατότητα να ενσωματωθεί ένα **κλειδί ταξινόμησης** για περαιτέρω διαμόρφωση της οργάνωσης των δεδομένων.

### Κρυπτογράφηση

Από προεπιλογή, το DynamoDB χρησιμοποιεί ένα κλειδί KMS που **ανήκει στο Amazon DynamoDB**, ακόμη και όχι το διαχειριζόμενο κλειδί του AWS που τουλάχιστον ανήκει στο λογαριασμό σας.

<figure><img src="https://lh4.googleusercontent.com/JjtNS7aA-_GRMgZb4v93jWEQJi6DQdUPq0FEpzZPdeyCeNoG05p0NJiV9Zs-ULs_-Tfjmx0W1ZgsE2Ui2ljo7D-1a87Xny-gpLVQO0XmXdFoph9ci1RepbVNwaCe9oPruEZSEDxGTxF5dIv6pW1WpT6kWA=s2048" alt=""><figcaption></figcaption></figure>

### Αντίγραφα Ασφαλείας & Εξαγωγή σε S3

Είναι δυνατόν να **προγραμματίσετε** τη δημιουργία **αντιγράφων ασφαλείας πινάκων** ή να τα δημιουργήσετε κατά **αίτηση**. Επιπλέον, είναι επίσης δυνατόν να ενεργοποιήσετε τη **ανάκτηση σε σημείο χρόνου (PITR) για έναν πίνακα.** Η ανάκτηση σε σημείο χρόνου παρέχει συνεχή **αντίγραφα ασφαλείας** των δεδομένων του DynamoDB για **35 ημέρες** για να σας βοηθήσει να προστατευτείτε από ατυχείς εγγραφές ή διαγραφές.

Είναι επίσης δυνατόν να εξάγετε **τα δεδομένα ενός πίνακα στο S3**, αλλά ο πίνακας πρέπει να έχει ενεργοποιημένη τη **ανάκτηση σε σημείο χρόνου (PITR)**.

### Γραφική Διεπαφή

Υπάρχει μια γραφική διεπαφή για τις τοπικές υπηρεσίες Dynamo όπως το [DynamoDB Local](https://aws.amazon.com/blogs/aws/dynamodb-local-for-desktop-development/), το [dynalite](https://github.com/mhart/dynalite), το [localstack](https://github.com/localstack/localstack), κ.λπ., που μπορεί να είναι χρήσιμη: [https://github.com/aaronshaf/dynamodb-admin](https://github.com/aaronshaf/dynamodb-admin)

### Απαρίθμηση
```bash
# Tables
aws dynamodb list-tables
aws dynamodb describe-table --table-name <t_name> #Get metadata info
## The primary key and sort key will appear inside the KeySchema field

#Check if point in time recovery is enabled
aws dynamodb describe-continuous-backups \
--table-name tablename

# Backups
aws dynamodb list-backups
aws dynamodb describe-backup --backup-arn <arn>
aws dynamodb describe-continuous-backups --table-name <t_name>

# Global tables
aws dynamodb list-global-tables
aws dynamodb describe-global-table --global-table-name <name>

# Exports
aws dynamodb list-exports
aws dynamodb describe-export --export-arn <arn>

# Misc
aws dynamodb describe-endpoints #Dynamodb endpoints
```
### Μη εξουσιοδοτημένη πρόσβαση

{% content-ref url="../../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md" %}
[aws-dynamodb-unauthenticated-access.md](../../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md)
{% endcontent-ref %}

### Ανύψωση δικαιωμάτων

{% content-ref url="../../aws-privilege-escalation/aws-dynamodb-privesc.md" %}
[aws-dynamodb-privesc.md](../../aws-privilege-escalation/aws-dynamodb-privesc.md)
{% endcontent-ref %}

### Μετά από εκμετάλλευση

{% content-ref url="../../aws-post-exploitation/aws-dynamodb-post-exploitation.md" %}
[aws-dynamodb-post-exploitation.md](../../aws-post-exploitation/aws-dynamodb-post-exploitation.md)
{% endcontent-ref %}

### Διατήρηση

{% content-ref url="../../aws-persistence/aws-dynamodb-persistence.md" %}
[aws-dynamodb-persistence.md](../../aws-persistence/aws-dynamodb-persistence.md)
{% endcontent-ref %}

## Ενσωμάτωση DynamoDB

### Ενσωμάτωση SQL

Υπάρχουν τρόποι να έχετε πρόσβαση σε δεδομένα DynamoDB με **σύνταξη SQL**, επομένως, τυπικές **ενσωματώσεις SQL είναι επίσης δυνατές**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

### Ενσωμάτωση NoSQL

Στο DynamoDB μπορούν να χρησιμοποιηθούν διαφορετικές **συνθήκες** για την ανάκτηση δεδομένων, όπως σε μια κοινή ενσωμάτωση NoSQL αν είναι δυνατόν να **αλυσιδωθούν περισσότερες συνθήκες για την ανάκτηση** δεδομένων μπορείτε να ανακτήσετε κρυφά δεδομένα (ή να ανακτήσετε ολόκληρο τον πίνακα).\
Μπορείτε να βρείτε εδώ τις συνθήκες που υποστηρίζονται από το DynamoDB: [https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html](https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html)

Σημειώστε ότι υποστηρίζονται **διαφορετικές συνθήκες** εάν τα δεδομένα προσπελαίνονται μέσω **`query`** ή μέσω **`scan`**.

{% hint style="info" %}
Πράγματι, οι ενέργειες **Query** πρέπει να καθορίσουν τη **συνθήκη "EQ" (ίσο)** στο **κύριο** κλειδί για να λειτουργήσουν, κάτι που καθιστά τη διαδικασία πολύ **λιγότερο ευάλωτη σε ενσωματώσεις NoSQL** (και κάνοντας επίσης τη λειτουργία πολύ περιορισμένη).
{% endhint %}

Αν μπορείτε να **αλλάξετε τη σύγκριση** που πραγματοποιείται ή να προσθέσετε νέες, μπορείτε να ανακτήσετε περισσότερα δεδομένα.
```bash
# Comparators to dump the database
"NE": "a123" #Get everything that doesn't equal "a123"
"NOT_CONTAINS": "a123" #What you think
"GT": " " #All strings are greater than a space
```
{% embed url="https://book.hacktricks.xyz/pentesting-web/nosql-injection" %}

### Ενσωμάτωση Raw Json

Το **DynamoDB** δέχεται αντικείμενα **Json** για να **αναζητήσει** δεδομένα μέσα στη βάση. Αν ανακαλύψετε ότι μπορείτε να γράψετε στο αντικείμενο json που στέλνετε για αναζήτηση, θα μπορούσατε να κάνετε αντιγραφή της βάσης δεδομένων, όλο το περιεχόμενο.

Για παράδειγμα, ενσωματώνοντας σε ένα αίτημα όπως:

{% code overflow="wrap" %}
```bash
'{"Id": {"ComparisonOperator": "EQ","AttributeValueList": [{"N": "' + user_input + '"}]}}'
```
{% endcode %}

Ένας επιτιθέμενος θα μπορούσε να εισχωρήσει κάτι τέτοιο:

`1000"}],"ComparisonOperator": "GT","AttributeValueList": [{"N": "0`

διορθώνοντας την συνθήκη "EQ" αναζητώντας το ID 1000 και στη συνέχεια αναζητώντας όλα τα δεδομένα με ένα Id string μεγαλύτερο από 0, που είναι όλα.

### :property Injection

Κάποια SDK επιτρέπει τη χρήση ενός string που υποδηλώνει το φιλτράρισμα που πρέπει να πραγματοποιηθεί όπως:
```java
new ScanSpec().withProjectionExpression("UserName").withFilterExpression(user_input+" = :username and Password = :password").withValueMap(valueMap)
```
{% endcode %}

Πρέπει να γνωρίζετε ότι κατά την αναζήτηση στο DynamoDB για την **αντικατάσταση** μιας τιμής χαρακτηριστικού στις **εκφράσεις φίλτρου** κατά τη σάρωση των στοιχείων, οι δείκτες πρέπει να **ξεκινούν** με τον χαρακτήρα **`:`**. Τέτοιοι δείκτες θα **αντικατασταθούν** με την πραγματική **τιμή του χαρακτηριστικού κατά την εκτέλεση**.

Έτσι, μια σύνδεση όπως η προηγούμενη μπορεί να παρακαμφθεί με κάτι παρόμοιο:
```bash
:username = :username or :username
# This will generate the query:
# :username = :username or :username = :username and Password = :password
# which is always true
```
{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Συμμετέχετε** 💬 [**στην ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Κοινοποιήστε τεχνικές χάκινγκ υποβάλλοντας PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
