# AWS - DynamoDB Enum

{% hint style="success" %}
Öğren ve AWS Hacking pratiği yap:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Öğren ve GCP Hacking pratiği yap: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekle</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol et!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katıl veya [**telegram grubuna**](https://t.me/peass) katıl veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip et.**
* **Hacking püf noktalarını paylaşmak için PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulun.

</details>
{% endhint %}

## DynamoDB

### Temel Bilgiler

Amazon DynamoDB, boyutları ne olursa olsun yüksek performanslı uygulamaları desteklemek üzere özelleştirilmiş, **tamamen yönetilen, sunucusuz, anahtar-değer NoSQL veritabanı** olarak AWS tarafından sunulmaktadır. Hizmet, doğal güvenlik önlemleri, kesintisiz yedeklemeler, birden fazla bölgeye otomatik replikasyon, entegre bellek önbelleği ve kullanışlı veri dışa aktarma araçları gibi güçlü özellikleri garanti altına almaktadır.

DynamoDB bağlamında, geleneksel bir veritabanı oluşturmak yerine **tablolar oluşturulur**. Her tablo, **tablonun birincil anahtarı**nın ayrılmaz bir bileşeni olarak bir **bölüm anahtarı**nın belirlenmesini zorunlu kılar. Bu bölüm anahtarı, esasen bir **hash değeri** olup, öğelerin alınması ve verilerin çeşitli ana bilgisayarlar arasında dağıtılmasında kritik bir rol oynar. Bu dağıtım, veritabanının hem ölçeklenebilirliğini hem de erişilebilirliğini sürdürmek için hayati öneme sahiptir. Ayrıca, veri düzenini daha da rafine etmek için bir **sıralama anahtarı** eklemek de mümkündür.

### Şifreleme

Varsayılan olarak, DynamoDB, **Amazon DynamoDB'ye ait olan bir KMS anahtarını** kullanır, hatta en azından hesabınıza ait olan AWS yönetilen anahtardan bile değildir.

<figure><img src="https://lh4.googleusercontent.com/JjtNS7aA-_GRMgZb4v93jWEQJi6DQdUPq0FEpzZPdeyCeNoG05p0NJiV9Zs-ULs_-Tfjmx0W1ZgsE2Ui2ljo7D-1a87Xny-gpLVQO0XmXdFoph9ci1RepbVNwaCe9oPruEZSEDxGTxF5dIv6pW1WpT6kWA=s2048" alt=""><figcaption></figcaption></figure>

### Yedekler ve S3'e Aktarım

**Tablo yedeklerinin** oluşturulmasını **zamanlamak** veya bunları **istenildiğinde** oluşturmak mümkündür. Ayrıca, bir tablo için **Zamana Göre Kurtarma (PITR) özelliğini etkinleştirmek** de mümkündür. Zamana Göre Kurtarma, yanlış yazma veya silme işlemlerine karşı korunmanıza yardımcı olmak için DynamoDB verilerinizin **35 gün boyunca sürekli yedeklerini** sağlar.

Ayrıca, bir tablonun verilerini S3'e aktarmak da mümkündür, ancak tablonun **PITR özelliğinin etkin olması** gerekir.

### GUI

[Amazon DynamoDB Local](https://aws.amazon.com/blogs/aws/dynamodb-local-for-desktop-development), [dynalite](https://github.com/mhart/dynalite), [localstack](https://github.com/localstack/localstack) gibi yerel Dynamo hizmetleri için bir GUI bulunmaktadır, bu da faydalı olabilir: [https://github.com/aaronshaf/dynamodb-admin](https://github.com/aaronshaf/dynamodb-admin)

### Numaralandırma
```bash
# Tables
aws dynamodb list-tables
aws dynamodb describe-table --table-name <t_name> #Get metadata info
## The primary key and sort key will appear inside the KeySchema field

#Check if point in time recovery is enabled
aws dynamodb describe-continuous-backups \
--table-name tablename

# Backups
aws dynamodb list-backups
aws dynamodb describe-backup --backup-arn <arn>
aws dynamodb describe-continuous-backups --table-name <t_name>

# Global tables
aws dynamodb list-global-tables
aws dynamodb describe-global-table --global-table-name <name>

# Exports
aws dynamodb list-exports
aws dynamodb describe-export --export-arn <arn>

# Misc
aws dynamodb describe-endpoints #Dynamodb endpoints
```
### Kimlik Doğrulamasız Erişim

{% content-ref url="../../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md" %}
[aws-dynamodb-unauthenticated-access.md](../../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md)
{% endcontent-ref %}

### Ayrıcalık Yükseltme

{% content-ref url="../../aws-privilege-escalation/aws-dynamodb-privesc.md" %}
[aws-dynamodb-privesc.md](../../aws-privilege-escalation/aws-dynamodb-privesc.md)
{% endcontent-ref %}

### Saldırı Sonrası İşlemler

{% content-ref url="../../aws-post-exploitation/aws-dynamodb-post-exploitation.md" %}
[aws-dynamodb-post-exploitation.md](../../aws-post-exploitation/aws-dynamodb-post-exploitation.md)
{% endcontent-ref %}

### Kalıcılık

{% content-ref url="../../aws-persistence/aws-dynamodb-persistence.md" %}
[aws-dynamodb-persistence.md](../../aws-persistence/aws-dynamodb-persistence.md)
{% endcontent-ref %}

## DynamoDB Enjeksiyonu

### SQL Enjeksiyonu

DynamoDB verilerine **SQL sözdizimi** ile erişmenin yolları vardır, bu nedenle tipik **SQL enjeksiyonları da mümkündür**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

### NoSQL Enjeksiyonu

DynamoDB'de farklı **koşullar** kullanılarak veri alınabilir, bu nedenle, mümkünse verileri almak için **daha fazla koşul eklemek** gibi tipik NoSQL Enjeksiyonu da mümkündür (veya tüm tabloyu dökümlemek).\
DynamoDB tarafından desteklenen koşulları burada bulabilirsiniz: [https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html](https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html)

Verilere **`query`** veya **`scan`** yoluyla erişiliyorsa **farklı koşulların** desteklendiğini unutmayın.

{% hint style="info" %}
Aslında, **Sorgu** işlemleri, işlem yapmak için **anahtar "EQ" (eşit)** koşulunu belirtmek zorundadır, bu da onu NoSQL enjeksiyonlarına karşı çok **daha az savunmasız** hale getirir (ve işlemi çok sınırlı hale getirir).
{% endhint %}

Yapılan karşılaştırmayı değiştirebilir veya yeni karşılaştırmalar ekleyebilirseniz, daha fazla veri alabilirsiniz.
```bash
# Comparators to dump the database
"NE": "a123" #Get everything that doesn't equal "a123"
"NOT_CONTAINS": "a123" #What you think
"GT": " " #All strings are greater than a space
```
### Ham Json enjeksiyonu

**DynamoDB**, DB içindeki verileri aramak için **Json** nesnelerini kabul eder. Eğer gönderilen json nesnesine yazabileceğinizi bulursanız, veritabanını dump edebilirsiniz, tüm içeriği.

Örneğin, şu şekilde bir isteğe enjekte ederek:
```bash
'{"Id": {"ComparisonOperator": "EQ","AttributeValueList": [{"N": "' + user_input + '"}]}}'
```
{% endcode %}

Bir saldırgan şöyle bir şey enjekte edebilir:

`1000"}],"ComparisonOperator": "GT","AttributeValueList": [{"N": "0`

ID'si 1000 olan verileri arayan "EQ" koşulunu değiştirerek, 0'dan büyük olan tüm verileri arayabilir.

### :property Enjeksiyonu

Bazı SDK'lar, yapılacak filtrelemenin belirtildiği bir dize kullanmaya izin verir:
```java
new ScanSpec().withProjectionExpression("UserName").withFilterExpression(user_input+" = :username and Password = :password").withValueMap(valueMap)
```
{% endcode %}

DynamoDB'de **öğeleri tararken filtre ifadelerinde** bir **özniteliği değerle değiştirmek** için arama yaparken, **token'ların** **`:`** karakteri ile **başlaması gerektiğini** bilmelisiniz. Bu tür token'lar **çalışma zamanında** gerçek **öznitelik değeriyle değiştirilecektir**.

Bu nedenle, önceki gibi bir giriş, aşağıdakine benzer bir şeyle atlatılabilir:
```bash
:username = :username or :username
# This will generate the query:
# :username = :username or :username = :username and Password = :password
# which is always true
```
{% hint style="success" %}
AWS Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking püf noktalarını paylaşarak PR'ler göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
{% endhint %}
