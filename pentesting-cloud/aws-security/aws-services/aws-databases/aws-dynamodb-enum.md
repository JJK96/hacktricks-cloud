# AWS - Enumerazione di DynamoDB

{% hint style="success" %}
Impara e pratica l'Hacking su AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Impara e pratica l'Hacking su GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Sostieni HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>
{% endhint %}

## DynamoDB

### Informazioni di Base

Amazon DynamoDB √® presentato da AWS come un **database NoSQL chiave-valore completamente gestito e serverless**, progettato per alimentare applicazioni ad alte prestazioni indipendentemente dalle loro dimensioni. Il servizio garantisce funzionalit√† robuste, tra cui misure di sicurezza intrinseche, backup continui, replica automatica su pi√π regioni, caching in memoria integrato e comode utilit√† di esportazione dei dati.

Nel contesto di DynamoDB, invece di stabilire un database tradizionale, vengono **create tabelle**. Ogni tabella richiede la specifica di una **chiave di partizione** come componente integrante della **chiave primaria della tabella**. Questa chiave di partizione, essenzialmente un **valore hash**, svolge un ruolo critico sia nel recupero degli elementi che nella distribuzione dei dati su vari host. Questa distribuzione √® fondamentale per mantenere sia la scalabilit√† che la disponibilit√† del database. Inoltre, c'√® la possibilit√† di incorporare una **chiave di ordinamento** per ulteriori raffinamenti nell'organizzazione dei dati.

### Crittografia

Per impostazione predefinita, DynamoDB utilizza una chiave KMS che **appartiene ad Amazon DynamoDB**, non alla chiave gestita da AWS che almeno appartiene al tuo account.

<figure><img src="https://lh4.googleusercontent.com/JjtNS7aA-_GRMgZb4v93jWEQJi6DQdUPq0FEpzZPdeyCeNoG05p0NJiV9Zs-ULs_-Tfjmx0W1ZgsE2Ui2ljo7D-1a87Xny-gpLVQO0XmXdFoph9ci1RepbVNwaCe9oPruEZSEDxGTxF5dIv6pW1WpT6kWA=s2048" alt=""><figcaption></figcaption></figure>

### Backup ed Esportazione su S3

√à possibile **programmare** la generazione di **backup delle tabelle** o crearli **su richiesta**. Inoltre, √® anche possibile abilitare il **recovery al punto nel tempo (PITR) per una tabella**. Il recovery al punto nel tempo fornisce **backup continui** dei dati di DynamoDB per **35 giorni** per aiutarti a proteggerti da operazioni di scrittura o cancellazione accidentali.

√à inoltre possibile esportare **i dati di una tabella su S3**, ma la tabella deve avere **PITR abilitato**.

### GUI

Esiste una GUI per i servizi Dynamo locali come [DynamoDB Local](https://aws.amazon.com/blogs/aws/dynamodb-local-for-desktop-development/), [dynalite](https://github.com/mhart/dynalite), [localstack](https://github.com/localstack/localstack), ecc, che potrebbero essere utili: [https://github.com/aaronshaf/dynamodb-admin](https://github.com/aaronshaf/dynamodb-admin)

### Enumerazione
```bash
# Tables
aws dynamodb list-tables
aws dynamodb describe-table --table-name <t_name> #Get metadata info
## The primary key and sort key will appear inside the KeySchema field

#Check if point in time recovery is enabled
aws dynamodb describe-continuous-backups \
--table-name tablename

# Backups
aws dynamodb list-backups
aws dynamodb describe-backup --backup-arn <arn>
aws dynamodb describe-continuous-backups --table-name <t_name>

# Global tables
aws dynamodb list-global-tables
aws dynamodb describe-global-table --global-table-name <name>

# Exports
aws dynamodb list-exports
aws dynamodb describe-export --export-arn <arn>

# Misc
aws dynamodb describe-endpoints #Dynamodb endpoints
```
### Accesso non autenticato

{% content-ref url="../../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md" %}
[aws-dynamodb-unauthenticated-access.md](../../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../../aws-privilege-escalation/aws-dynamodb-privesc.md" %}
[aws-dynamodb-privesc.md](../../aws-privilege-escalation/aws-dynamodb-privesc.md)
{% endcontent-ref %}

### Post Esploitation

{% content-ref url="../../aws-post-exploitation/aws-dynamodb-post-exploitation.md" %}
[aws-dynamodb-post-exploitation.md](../../aws-post-exploitation/aws-dynamodb-post-exploitation.md)
{% endcontent-ref %}

### Persistenza

{% content-ref url="../../aws-persistence/aws-dynamodb-persistence.md" %}
[aws-dynamodb-persistence.md](../../aws-persistence/aws-dynamodb-persistence.md)
{% endcontent-ref %}

## Iniezione DynamoDB

### Iniezione SQL

Esistono modi per accedere ai dati di DynamoDB con **sintassi SQL**, pertanto, sono possibili anche **iniezioni SQL tipiche**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

### Iniezione NoSQL

In DynamoDB possono essere utilizzate diverse **condizioni** per recuperare dati, come in una comune Iniezione NoSQL se √® possibile **concatenare pi√π condizioni per recuperare** dati si potrebbero ottenere dati nascosti (o scaricare l'intera tabella).\
Qui puoi trovare le condizioni supportate da DynamoDB: [https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html](https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html)

Nota che sono supportate **diverse condizioni** se i dati vengono accessi tramite **`query`** o tramite **`scan`**.

{% hint style="info" %}
Attualmente, le azioni di **Query** devono specificare la **condizione "EQ" (uguale)** nella chiave **primaria** per funzionare, rendendola molto **meno suscettibile alle iniezioni NoSQL** (e rendendo anche l'operazione molto limitata).
{% endhint %}

Se puoi **modificare il confronto** eseguito o aggiungerne di nuovi, potresti recuperare pi√π dati.
```bash
# Comparators to dump the database
"NE": "a123" #Get everything that doesn't equal "a123"
"NOT_CONTAINS": "a123" #What you think
"GT": " " #All strings are greater than a space
```
{% embed url="https://book.hacktricks.xyz/pentesting-web/nosql-injection" %}

### Iniezione di Json grezzo

**DynamoDB** accetta oggetti **Json** per **ricercare** dati all'interno del DB. Se scopri che puoi scrivere nell'oggetto json inviato per la ricerca, potresti fare il dump del DB, di tutti i contenuti.

Ad esempio, iniettando in una richiesta come:
```bash
'{"Id": {"ComparisonOperator": "EQ","AttributeValueList": [{"N": "' + user_input + '"}]}}'
```
{% endcode %}

un attaccante potrebbe iniettare qualcosa del genere:

`1000"}],"ComparisonOperator": "GT","AttributeValueList": [{"N": "0`

correggere la condizione "EQ" cercando l'ID 1000 e quindi cercando tutti i dati con una stringa Id maggiore di 0, che √® tutto.

### Iniezione di propriet√†

Alcune SDK consentono di utilizzare una stringa che indica il filtro da eseguire come:
```java
new ScanSpec().withProjectionExpression("UserName").withFilterExpression(user_input+" = :username and Password = :password").withValueMap(valueMap)
```
{% endcode %}

√à necessario sapere che cercando in DynamoDB per **sostituire** un **valore** di attributo nelle **espressioni di filtro** durante la scansione degli elementi, i token dovrebbero **iniziare** con il carattere **`:`**. Tali token verranno **sostituiti** con il **valore effettivo dell'attributo al momento dell'esecuzione**.

Pertanto, un accesso come il precedente pu√≤ essere bypassato con qualcosa del genere:
```bash
:username = :username or :username
# This will generate the query:
# :username = :username or :username = :username and Password = :password
# which is always true
```
{% hint style="success" %}
Impara e pratica l'hacking su AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Impara e pratica l'hacking su GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Sostieni HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repository di Github.

</details>
{% endhint %}
