# AWS - ECS Enum

{% hint style="success" %}
Ucz się i praktykuj Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Ucz się i praktykuj Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* Sprawdź [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel się trikami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na githubie.

</details>
{% endhint %}

## ECS

### Podstawowe informacje

Amazon **Elastic Container Services** lub ECS dostarcza platformę do **hostowania aplikacji w kontenerach w chmurze**. ECS ma dwie metody **wdrożenia**, typ instancji **EC2** i opcję **bezserwerową**, **Fargate**. Usługa **ułatwia uruchamianie kontenerów w chmurze**.

ECS działa przy użyciu trzech podstawowych elementów: **Klastry**, **Usługi** i **Definicje Zadań**.

* **Klastry** to **grupy kontenerów**, które działają w chmurze. Jak już wspomniano, istnieją dwa typy uruchomienia kontenerów, EC2 i Fargate. AWS definiuje typ uruchomienia **EC2** jako umożliwiający klientom „uruchamianie \[ich] zkonteneryzowanych aplikacji na klastrze instancji Amazon EC2, które \[samodzielnie zarządzają]”. **Fargate** jest podobny i jest zdefiniowany jako „umożliwiający uruchamianie zkonteneryzowanych aplikacji **bez konieczności dostarczania i zarządzania** infrastrukturą backendową”.
* **Usługi** są tworzone wewnątrz klastra i odpowiedzialne za **uruchamianie zadań**. W definicji usługi **określasz liczbę zadań do uruchomienia, automatyczne skalowanie, dostawcę pojemności (Fargate/EC2/Zewnętrzny),** **informacje o sieci** takie jak VPC, podsieci i grupy zabezpieczeń.
* Istnieją **2 rodzaje aplikacji**:
* **Usługa**: Grupa zadań obsługujących długotrwałą pracę obliczeniową, która może być zatrzymywana i uruchamiana ponownie. Na przykład aplikacja internetowa.
* **Zadanie**: Samodzielne zadanie, które się uruchamia i kończy. Na przykład zadanie wsadowe.
* Wśród aplikacji usługowych istnieją **2 rodzaje planistów usług**:
* [**REPLIKA**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html): Strategia planowania replik umieszcza i **utrzymuje żądaną liczbę** zadań w całym klastrze. Jeśli z jakiegoś powodu zadanie zostanie zatrzymane, uruchamiane jest nowe na tym samym lub innym węźle.
* [**DAEMON**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html): Wdraża dokładnie jedno zadanie na każdym aktywnym egzemplarzu kontenera, który ma wymagane wymagania. Nie trzeba określać żądanej liczby zadań, strategii lokalizacji zadań ani korzystać z zasad automatycznego skalowania usługi.
* **Definicje Zadań** są odpowiedzialne za **określenie, jakie kontenery zostaną uruchomione** oraz różne parametry, które zostaną skonfigurowane w kontenerach, takie jak **mapowanie portów** z hostem, **zmienne środowiskowe**, **punkt wejścia** Docker...
* Sprawdź **zmienne środowiskowe w poszukiwaniu poufnych informacji**!

### Dane Wrażliwe w Definicjach Zadań

Definicje zadań są odpowiedzialne za **konfigurowanie rzeczywistych kontenerów, które będą uruchamiane w ECS**. Ponieważ definicje zadań określają sposób uruchamiania kontenerów, w nich można znaleźć wiele informacji.

Pacu może wyliczać ECS (list-clusters, list-container-instances, list-services, list-task-definitions), może również wyświetlać definicje zadań.

### Wyliczenie
```bash
# Clusters info
aws ecs list-clusters
aws ecs describe-clusters --clusters <cluster>

# Container instances
## An Amazon ECS container instance is an Amazon EC2 instance that is running the Amazon ECS container agent and has been registered into an Amazon ECS cluster.
aws ecs list-container-instances --cluster <cluster>
aws ecs describe-container-instances --cluster <cluster> --container-instances <container_instance_arn>

# Services info
aws ecs list-services --cluster <cluster>
aws ecs describe-services --cluster <cluster> --services <services>
aws ecs describe-task-sets --cluster <cluster> --service <service>

# Task definitions
aws ecs list-task-definition-families
aws ecs list-task-definitions
aws ecs list-tasks --cluster <cluster>
aws ecs describe-tasks --cluster <cluster> --tasks <tasks>
## Look for env vars and secrets used from the task definition
aws ecs describe-task-definition --task-definition <TASK_NAME>:<VERSION>
```
### Nieuwierzytelniony dostęp

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md" %}
[aws-ecs-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md)
{% endcontent-ref %}

### Przywłaszczenie

Na następnej stronie możesz sprawdzić, jak **nadużyć uprawnienia ECS do eskalacji uprawnień**:

{% content-ref url="../aws-privilege-escalation/aws-ecs-privesc.md" %}
[aws-ecs-privesc.md](../aws-privilege-escalation/aws-ecs-privesc.md)
{% endcontent-ref %}

### Po eksploatacji

{% content-ref url="../aws-post-exploitation/aws-ecs-post-exploitation.md" %}
[aws-ecs-post-exploitation.md](../aws-post-exploitation/aws-ecs-post-exploitation.md)
{% endcontent-ref %}

### Trwałość

{% content-ref url="../aws-persistence/aws-ecs-persistence.md" %}
[aws-ecs-persistence.md](../aws-persistence/aws-ecs-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Dowiedz się i ćwicz Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Dowiedz się i ćwicz Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* Sprawdź [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Dołącz do** 💬 [**Grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Udostępnij sztuczki hakerskie, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
