# AWS - ECS Απαρίθμηση

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** στην 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ καταθέτοντας PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) στο github.

</details>
{% endhint %}

## ECS

### Βασικές Πληροφορίες

Το **Amazon Elastic Container Services** ή ECS παρέχει μια πλατφόρμα για τη **φιλοξενία εφαρμογών σε containers στο cloud**. Το ECS έχει δύο **μέθοδους αναπτύξεις**, τον τύπο **EC2** και μια επιλογή **serverless**, το **Fargate**. Η υπηρεσία **καθιστά πολύ εύκολη και ανέμελη την εκτέλεση των containers στο cloud**.

Το ECS λειτουργεί χρησιμοποιώντας τα ακόλουθα τρία στοιχεία: **Συστάδες (Clusters)**, **Υπηρεσίες (Services)** και **Ορισμοί Εργασιών (Task Definitions)**.

* Οι **Συστάδες (Clusters)** είναι **ομάδες containers** που εκτελούνται στο cloud. Όπως αναφέρθηκε προηγουμένως, υπάρχουν δύο τύποι εκκίνησης για τα containers, EC2 και Fargate. Η AWS ορίζει τον τύπο εκκίνησης **EC2** ως τη δυνατότητα των πελατών "να εκτελέσουν τις εφαρμογές τους σε containers σε μια συστάδα από περιπτώσεις Amazon EC2 που **διαχειρίζονται**". Το **Fargate** είναι παρόμοιο και ορίζεται ως "να σας επιτρέπει να εκτελέσετε τις εφαρμογές σας σε containers **χωρίς την ανάγκη προμήθειας και διαχείρισης** της υποκείμενης υποδομής".
* Οι **Υπηρεσίες (Services)** δημιουργούνται μέσα σε μια συστάδα και είναι υπεύθυνες για τη **εκτέλεση των εργασιών**. Μέσα σε μια ορισμένη υπηρεσία **ορίζετε τον αριθμό των εργασιών που θα εκτελεστούν, την αυτόματη κλιμάκωση, τον πάροχο χωρητικότητας (Fargate/EC2/Εξωτερικό),** **πληροφορίες δικτύωσης** όπως VPC, υποδίκτυα και ομάδες ασφαλείας.
* Υπάρχουν **2 τύποι εφαρμογών**:
  * **Υπηρεσία (Service)**: Μια ομάδα εργασιών που χειρίζονται μια εργασία υπολογισμού με μακρά διάρκεια που μπορεί να διακοπεί και να επανεκκινηθεί. Για παράδειγμα, μια web εφαρμογή.
  * **Εργασία (Task)**: Μια αυτόνομη εργασία που εκτελείται και τερματίζεται. Για παράδειγμα, μια δουλειά παρτίδας.
* Μεταξύ των εφαρμογών υπηρεσιών, υπάρχουν **2 τύποι προγραμματιστών υπηρεσιών**:
  * [**REPLICA**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html): Η στρατηγική προγραμματισμού αντιγράφων τοποθετεί και **διατηρεί τον επιθυμητό αριθμό** εργασιών σε ολόκληρη τη συστάδα σας. Αν για κάποιο λόγο μια εργασία τερματιστεί, μια νέα εκκινείται στον ίδιο ή διαφορετικό κόμβο.
  * [**DAEMON**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html): Αναπτύσσει ακριβώς μια εργασία σε κάθε ενεργή περίπτωση container που έχει τις απαιτούμενες προϋποθέσεις. Δεν χρειάζεται να καθορίσετε έναν επιθυμητό αριθμό εργασιών, μια στρατηγική τοποθέτησης εργασιών ή να χρησιμοποιήσετε πολιτικές αυτόματης κλιμάκωσης υπηρεσίας.
* Οι **Ορισμοί Εργασιών (Task Definitions)** είναι υπεύθυνοι για τον **ορισμό των containers που θα εκτελεστοώσν** και των διαφόρων παραμέτρων που θα ρυθμιστούν με τα containers όπως **αντιστοιχίσεις θυρών** με τον κεντρικό υπολογιστή, **μεταβλητές περιβάλλοντος**, **σημείο εισόδου Docker**...
* Ελέγξτε τις **μεταβλητές περιβάλλοντος για ευαίσθητες πληροφορίες**!

### Ευαίσθητα Δεδομένα στους Ορισμούς Εργασιών

Οι ορισμοί εργασιών είναι υπεύθυνοι για τη **ρύθμιση των πραγματικών containers που θα εκτελεστούν στο ECS**. Καθώς οι ορισμοί εργασιών ορίζουν πώς θα εκτελεστούν τα containers, μπορεί να βρεθεί μια πληθώρα πληροφοριών μέσα σε αυτούς.

Το Pacu μπορεί να απαριθμήσει το ECS (list-clusters, list-container-instances, list-services, list-task-definitions), μπορεί επίσης να απορροφήσει τους ορισμούς εργασιών.

### Απαρίθμηση
```bash
# Clusters info
aws ecs list-clusters
aws ecs describe-clusters --clusters <cluster>

# Container instances
## An Amazon ECS container instance is an Amazon EC2 instance that is running the Amazon ECS container agent and has been registered into an Amazon ECS cluster.
aws ecs list-container-instances --cluster <cluster>
aws ecs describe-container-instances --cluster <cluster> --container-instances <container_instance_arn>

# Services info
aws ecs list-services --cluster <cluster>
aws ecs describe-services --cluster <cluster> --services <services>
aws ecs describe-task-sets --cluster <cluster> --service <service>

# Task definitions
aws ecs list-task-definition-families
aws ecs list-task-definitions
aws ecs list-tasks --cluster <cluster>
aws ecs describe-tasks --cluster <cluster> --tasks <tasks>
## Look for env vars and secrets used from the task definition
aws ecs describe-task-definition --task-definition <TASK_NAME>:<VERSION>
```
### Μη εξουσιοδοτημένη πρόσβαση

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md" %}
[aws-ecs-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md)
{% endcontent-ref %}

### Ανύψωση δικαιωμάτων

Στην ακόλουθη σελίδα μπορείτε να ελέγξετε πώς να **καταχραστείτε τα δικαιώματα του ECS για ανύψωση δικαιωμάτων**:

{% content-ref url="../aws-privilege-escalation/aws-ecs-privesc.md" %}
[aws-ecs-privesc.md](../aws-privilege-escalation/aws-ecs-privesc.md)
{% endcontent-ref %}

### Μετά την εκμετάλλευση

{% content-ref url="../aws-post-exploitation/aws-ecs-post-exploitation.md" %}
[aws-ecs-post-exploitation.md](../aws-post-exploitation/aws-ecs-post-exploitation.md)
{% endcontent-ref %}

### Διατήρηση

{% content-ref url="../aws-persistence/aws-ecs-persistence.md" %}
[aws-ecs-persistence.md](../aws-persistence/aws-ecs-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 στην [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκινγκ υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο GitHub.

</details>
{% endhint %}
