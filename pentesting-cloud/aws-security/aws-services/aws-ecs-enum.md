# AWS - ECS Enum

{% hint style="success" %}
AWS 해킹을 배우고 실습하세요:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP 해킹을 배우고 실습하세요: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks 지원</summary>

* [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* 💬 [**디스코드 그룹**](https://discord.gg/hRep4RUj7f)에 가입하거나 [**텔레그램 그룹**](https://t.me/peass)에 가입하거나 **트위터** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**를 팔로우**하세요.
* **HackTricks** 및 **HackTricks Cloud** 깃허브 저장소에 PR을 제출하여 해킹 트릭을 공유하세요.

</details>
{% endhint %}

## ECS

### 기본 정보

Amazon **Elastic Container Services** 또는 ECS는 **컨테이너화된 응용 프로그램을 클라우드에서 호스팅**할 수 있는 플랫폼을 제공합니다. ECS에는 **EC2** 인스턴스 유형과 **서버리스** 옵션 인 **Fargate** 두 가지 **배포** 방법이 있습니다. 이 서비스는 **클라우드에서 컨테이너를 실행하는 것을 매우 쉽고 무료**하게 만듭니다.

ECS는 다음 세 가지 구성 요소를 사용하여 작동합니다: **클러스터**, **서비스** 및 **작업 정의**.

* **클러스터**는 클라우드에서 실행 중인 **컨테이너 그룹**입니다. 이전에 언급했듯이 컨테이너에는 EC2 및 Fargate 두 가지 **로컬** 유형이 있습니다. AWS는 **EC2** 로컬 유형을 "Amazon EC2 인스턴스 클러스터에서 \[고객이] 컨테이너화된 응용 프로그램을 실행할 수 있게 해준다"고 정의합니다. **Fargate**는 유사하며 "백엔드 인프라를 프로비저닝하고 관리할 필요 없이 컨테이너화된 응용 프로그램을 실행할 수 있게 해줍니다".
* **서비스**는 클러스터 내에서 생성되며 **작업 실행**을 담당합니다. 서비스 정의 내에서 **실행할 작업 수, 자동 확장, 용량 제공자 (Fargate/EC2/외부),** VPC, 서브넷 및 보안 그룹과 같은 **네트워킹** 정보를 정의합니다.
* **2 종류의 응용 프로그램**이 있습니다:
* **서비스**: 중단되고 다시 시작할 수 있는 장기 실행 컴퓨팅 작업을 처리하는 작업 그룹입니다. 예를 들어, 웹 응용 프로그램.
* **작업**: 실행되고 종료되는 독립적인 작업입니다. 예를 들어, 일괄 작업.
* 서비스 응용 프로그램 중에는 **2 종류의 서비스 스케줄러**가 있습니다:
* [**REPLICA**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html): 복제 스케줄링 전략은 클러스터 전체에 **원하는 수**의 작업을 배치하고 **유지**합니다. 어떤 이유로든 작업이 종료되면 동일한 노드 또는 다른 노드에 새 작업이 시작됩니다.
* [**DAEMON**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html): 필요한 요구 사항을 갖춘 각 활성 컨테이너 인스턴스에 정확히 하나의 작업을 배포합니다. 원하는 작업 수, 작업 배치 전략 또는 서비스 자동 확장 정책을 지정할 필요가 없습니다.
* **작업 정의**는 실행할 컨테이너와 컨테이너와 관련된 다양한 매개변수를 정의하는 데 책임이 있습니다. 호스트와의 **포트 매핑**, **환경 변수**, Docker **진입점**과 같은 컨테이너와 구성할 매개변수를 정의합니다.
* **민감한 정보를 위한 환경 변수를 확인하세요**!

### 작업 정의에서 민감한 데이터

작업 정의는 ECS에서 실행될 **실제 컨테이너를 구성**하는 데 책임이 있습니다. 작업 정의는 컨테이너가 어떻게 실행될지 정의하므로 다양한 정보가 포함될 수 있습니다.

Pacu는 ECS를 열거할 수 있습니다 (list-clusters, list-container-instances, list-services, list-task-definitions) 및 작업 정의를 덤프할 수도 있습니다.

### 열거
```bash
# Clusters info
aws ecs list-clusters
aws ecs describe-clusters --clusters <cluster>

# Container instances
## An Amazon ECS container instance is an Amazon EC2 instance that is running the Amazon ECS container agent and has been registered into an Amazon ECS cluster.
aws ecs list-container-instances --cluster <cluster>
aws ecs describe-container-instances --cluster <cluster> --container-instances <container_instance_arn>

# Services info
aws ecs list-services --cluster <cluster>
aws ecs describe-services --cluster <cluster> --services <services>
aws ecs describe-task-sets --cluster <cluster> --service <service>

# Task definitions
aws ecs list-task-definition-families
aws ecs list-task-definitions
aws ecs list-tasks --cluster <cluster>
aws ecs describe-tasks --cluster <cluster> --tasks <tasks>
## Look for env vars and secrets used from the task definition
aws ecs describe-task-definition --task-definition <TASK_NAME>:<VERSION>
```
### 인증되지 않은 액세스

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md" %}
[aws-ecs-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md)
{% endcontent-ref %}

### 권한 상승

다음 페이지에서 **ECS 권한을 남용하여 권한 상승하는 방법**을 확인할 수 있습니다:

{% content-ref url="../aws-privilege-escalation/aws-ecs-privesc.md" %}
[aws-ecs-privesc.md](../aws-privilege-escalation/aws-ecs-privesc.md)
{% endcontent-ref %}

### 사후 공격

{% content-ref url="../aws-post-exploitation/aws-ecs-post-exploitation.md" %}
[aws-ecs-post-exploitation.md](../aws-post-exploitation/aws-ecs-post-exploitation.md)
{% endcontent-ref %}

### 지속성

{% content-ref url="../aws-persistence/aws-ecs-persistence.md" %}
[aws-ecs-persistence.md](../aws-persistence/aws-ecs-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
AWS 해킹 학습 및 실습:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP 해킹 학습 및 실습: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks 지원</summary>

* [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* 💬 [**디스코드 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **트위터** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**를 팔로우**하세요.
* [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) 깃헙 레포지토리에 PR을 제출하여 해킹 트릭을 공유하세요.

</details>
{% endhint %}
