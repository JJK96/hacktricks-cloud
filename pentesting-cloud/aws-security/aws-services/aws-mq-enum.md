# AWS - Enumeración de MQ

{% hint style="success" %}
Aprende y practica Hacking en AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Entrenamiento de HackTricks para Expertos en Equipos Rojos de AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Entrenamiento de HackTricks para Expertos en Equipos Rojos de GCP (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* ¡Consulta los [**planes de suscripción**](https://github.com/sponsors/carlospolop)!
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **síguenos** en **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Amazon MQ

### Introducción a los Corredores de Mensajes
Los **corredores de mensajes** actúan como intermediarios, facilitando la comunicación entre diferentes sistemas de software, que pueden estar construidos en plataformas variadas y programados en diferentes lenguajes. **Amazon MQ** simplifica la implementación, operación y mantenimiento de corredores de mensajes en AWS. Proporciona servicios gestionados para **Apache ActiveMQ** y **RabbitMQ**, garantizando una provisión sin problemas y actualizaciones automáticas de versiones de software.

### AWS - RabbitMQ
RabbitMQ es un software de **cola de mensajes** prominente, también conocido como un _corredor de mensajes_ o _gestor de colas_. Es fundamentalmente un sistema donde se configuran colas. Las aplicaciones interactúan con estas colas para **enviar y recibir mensajes**. Los mensajes en este contexto pueden llevar una variedad de información, que va desde comandos para iniciar procesos en otras aplicaciones (potencialmente en servidores diferentes) hasta mensajes de texto simples. Los mensajes son retenidos por el software del gestor de colas hasta que son recuperados y procesados por una aplicación receptora. AWS proporciona una solución fácil de usar para alojar y gestionar servidores RabbitMQ.

### AWS - ActiveMQ
Apache ActiveMQ® es un destacado **corredor de mensajes** de código abierto basado en Java conocido por su versatilidad. Admite múltiples protocolos estándar de la industria, ofreciendo una amplia compatibilidad con clientes en una amplia gama de lenguajes y plataformas. Los usuarios pueden:

- Conectar con clientes escritos en JavaScript, C, C++, Python, .Net y más.
- Aprovechar el protocolo **AMQP** para integrar aplicaciones de diferentes plataformas.
- Utilizar **STOMP** sobre websockets para intercambios de mensajes de aplicaciones web.
- Gestionar dispositivos IoT con **MQTT**.
- Mantener la infraestructura existente de **JMS** y ampliar sus capacidades.

La robustez y flexibilidad de ActiveMQ lo hacen adecuado para una multitud de requisitos de mensajería.


## Enumeración
```bash
# List brokers
aws mq list-brokers

# Get broker info
aws mq describe-broker --broker-id <broker-id>
## Find endpoints in .BrokerInstances
## Find if public accessible in .PubliclyAccessible

# List usernames (only for ActiveMQ)
aws mq list-users --broker-id <broker-id>

# Get user info (PASSWORD NOT INCLUDED)
aws mq describe-user --broker-id <broker-id> --username <username>

# Lits configurations (only for ActiveMQ)
aws mq list-configurations
## Here you can find if simple or LDAP authentication is used

# Creacte Active MQ user
aws mq create-user --broker-id <value> --password <value> --username <value> --console-access
```
{% hint style="warning" %}
TODO: Indicar cómo enumerar RabbitMQ y ActiveMQ internamente y cómo escuchar en todas las colas y enviar datos (enviar PR si sabes cómo hacerlo)
{% endhint %}

## Escalada de privilegios

{% content-ref url="../aws-privilege-escalation/aws-mq-privesc.md" %}
[aws-mq-privesc.md](../aws-privilege-escalation/aws-mq-privesc.md)
{% endcontent-ref %}

## Acceso no autenticado

{% content-ref url="../aws-unauthenticated-enum-access/aws-mq-unauthenticated-enum.md" %}
[aws-mq-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-mq-unauthenticated-enum.md)
{% endcontent-ref %}

## Persistencia

Si conoces las credenciales para acceder a la consola web de RabbitMQ, puedes crear un nuevo usuario con privilegios de administrador.

## Referencias

* [https://www.cloudamqp.com/blog/part1-rabbitmq-for-beginners-what-is-rabbitmq.html](https://www.cloudamqp.com/blog/part1-rabbitmq-for-beginners-what-is-rabbitmq.html)
* [https://activemq.apache.org/](https://activemq.apache.org/)

{% hint style="success" %}
Aprende y practica Hacking en AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* ¡Consulta los [**planes de suscripción**](https://github.com/sponsors/carlospolop)!
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **síguenos** en **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
