# AWS - Step Functions 포스트 익스플로잇레이션

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 제로부터 히어로까지 AWS 해킹을 배우세요!</summary>

HackTricks를 지원하는 다른 방법:

- **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하고 싶다면 [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
- [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구매하세요.
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
- 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **가입**하거나 **트위터** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
- 여러분의 해킹 기술을 공유하려면 [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) 깃헙 저장소에 PR을 제출하세요.

</details>

## Step Functions

이 AWS 서비스에 대한 자세한 정보는 다음을 확인하세요:

{% content-ref url="../aws-services/aws-stepfunctions-enum.md" %}
[aws-stepfunctions-enum.md](../aws-services/aws-stepfunctions-enum.md)
{% endcontent-ref %}

### `states:DeleteStateMachine`, `states:DeleteStateMachineVersion`, `states:DeleteStateMachineAlias`

이 권한을 가진 공격자는 상태 머신, 그 버전 및 별칭을 영구적으로 삭제할 수 있습니다. 이는 중요한 워크플로우를 방해하고 데이터 손실을 초래하며, 영향을 받은 상태 머신을 복구하고 복원하는 데 상당한 시간이 소요될 수 있습니다. 또한 사용된 트랙을 가리고 포렌식 조사를 방해하며, 필수 자동화 프로세스 및 상태 구성을 제거함으로써 운영을 마비시킬 수 있습니다.

{% hint style="info" %}

- 상태 머신을 삭제하면 해당하는 모든 버전 및 별칭이 삭제됩니다.
- 상태 머신 별칭을 삭제하면 이 별칭을 참조하는 상태 머신 버전은 삭제되지 않습니다.
- 현재 하나 이상의 별칭에서 참조하는 상태 머신 버전은 삭제할 수 없습니다.

{% endhint %}
```bash
# Delete state machine
aws stepfunctions delete-state-machine --state-machine-arn <value>
# Delete state machine version
aws stepfunctions delete-state-machine-version --state-machine-version-arn <value>
# Delete state machine alias
aws stepfunctions delete-state-machine-alias --state-machine-alias-arn <value>
```
- **잠재적 영향**: 중요한 워크플로우의 중단, 데이터 손실 및 운영 다운타임.

### `states:UpdateMapRun`

이 권한을 가진 공격자는 Map Run 실패 구성 및 병렬 설정을 조작할 수 있으며, 최대 허용 자식 워크플로우 실행 수를 증가 또는 감소시킬 수 있어 서비스의 성능에 직접적인 영향을 줄 수 있습니다. 또한 공격자는 허용된 실패 비율 및 횟수를 조작할 수 있어 이 값을 0으로 줄여 매번 항목이 실패할 때마다 전체 맵 실행이 실패하도록 만들 수 있어 상태 머신 실행에 직접적인 영향을 주며 중요한 워크플로우를 방해할 수 있습니다.
```bash
aws stepfunctions update-map-run --map-run-arn <value> [--max-concurrency <value>] [--tolerated-failure-percentage <value>] [--tolerated-failure-count <value>]
```
- **잠재적 영향**: 성능 저하 및 중요한 워크플로우 방해.

### `states:StopExecution`

이 권한을 가진 공격자는 어떤 상태 머신의 실행을 중지할 수 있어서 진행 중인 워크플로우와 프로세스를 방해할 수 있습니다. 이로 인해 미완료된 트랜잭션, 중단된 비즈니스 운영 및 잠재적 데이터 손상이 발생할 수 있습니다.

{% hint style="warning" %}
이 작업은 **표현 상태 머신**에서 지원되지 않습니다.
{% endhint %}
```bash
aws stepfunctions stop-execution --execution-arn <value> [--error <value>] [--cause <value>]
```
- **잠재적 영향**: 진행 중인 워크플로우 방해, 운영 다운타임 및 잠재적 데이터 손상.

### `states:TagResource`, `states:UntagResource`

공격자는 Step Functions 리소스에서 태그를 추가, 수정 또는 제거하여 조직의 비용 할당, 리소스 추적 및 태그에 기반한 액세스 제어 정책을 방해할 수 있습니다.
```bash
aws stepfunctions tag-resource --resource-arn <value> --tags Key=<key>,Value=<value>
aws stepfunctions untag-resource --resource-arn <value> --tag-keys <key>
```
**잠재적 영향**: 비용 할당, 자원 추적 및 태그 기반 액세스 제어 정책 방해.

<details>

<summary><strong>제로부터 영웅이 될 때까지 AWS 해킹 배우기</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team 전문가)</strong></a><strong>!</strong></summary>

다른 방법으로 HackTricks를 지원하는 방법:

* **회사가 HackTricks에 광고되길 원하거나** **PDF로 HackTricks 다운로드**하려면 [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구입하세요
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* **💬 [**디스코드 그룹**](https://discord.gg/hRep4RUj7f)에 가입하거나 [**텔레그램 그룹**](https://t.me/peass)에 가입하거나** **트위터** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**를 팔로우하세요.**
* **HackTricks** 및 **HackTricks Cloud** github 저장소에 PR을 제출하여 해킹 트릭을 공유하세요.

</details>
