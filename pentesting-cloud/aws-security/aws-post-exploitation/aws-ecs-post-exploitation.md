# AWS - ECS ‡§™‡•ã‡§∏‡•ç‡§ü ‡§è‡§ï‡•ç‡§∏‡§™‡•ç‡§≤‡•ã‡§á‡§ü‡•á‡§∂‡§®

{% hint style="success" %}
AWS ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§™‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§ø‡§∏ ‡§ï‡§∞‡•á‡§Ç:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks ‡§™‡•ç‡§∞‡§∂‡§ø‡§ï‡•ç‡§∑‡§£ AWS ‡§∞‡•á‡§° ‡§ü‡•Ä‡§Æ ‡§è‡§ï‡•ç‡§∏‡§™‡§∞‡•ç‡§ü (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§™‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§ø‡§∏ ‡§ï‡§∞‡•á‡§Ç: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks ‡§™‡•ç‡§∞‡§∂‡§ø‡§ï‡•ç‡§∑‡§£ GCP ‡§∞‡•á‡§° ‡§ü‡•Ä‡§Æ ‡§è‡§ï‡•ç‡§∏‡§™‡§∞‡•ç‡§ü (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>‡§π‡•à‡§ï‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§ï‡§æ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§ï‡§∞‡•á‡§Ç</summary>

* [**‡§∏‡§¨‡•ç‡§∏‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§∂‡§® ‡§™‡•ç‡§≤‡§æ‡§®**](https://github.com/sponsors/carlospolop) ‡§ï‡•Ä ‡§ú‡§æ‡§Å‡§ö ‡§ï‡§∞‡•á‡§Ç!
* **‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•ã‡§Ç** üí¨ [**‡§°‡§ø‡§∏‡•ç‡§ï‡•â‡§∞‡•ç‡§° ‡§∏‡§Æ‡•Ç‡§π**](https://discord.gg/hRep4RUj7f) ‡§Ø‡§æ [**‡§ü‡•á‡§≤‡•Ä‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§Æ‡•Ç‡§π**](https://t.me/peass) ‡§î‡§∞ **‡§ü‡•ç‡§µ‡§ø‡§ü‡§∞** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ‡§ï‡•ã** **‡§´‡•â‡§≤‡•ã** ‡§ï‡§∞‡•á‡§Ç‡•§
* **‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç, PRs ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡§ï‡•á** [**HackTricks**](https://github.com/carlospolop/hacktricks) **‡§î‡§∞** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github ‡§∞‡•á‡§™‡•ã ‡§Æ‡•á‡§Ç**‡•§

</details>
{% endhint %}

## ECS

‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¶‡•á‡§ñ‡•á‡§Ç:

{% content-ref url="../aws-services/aws-ecs-enum.md" %}
[aws-ecs-enum.md](../aws-services/aws-ecs-enum.md)
{% endcontent-ref %}

### ‡§π‡•ã‡§∏‡•ç‡§ü IAM ‡§∞‡•ã‡§≤‡•ç‡§∏

ECS ‡§Æ‡•á‡§Ç **‡§ü‡§æ‡§∏‡•ç‡§ï ‡§ï‡•ã ‡§è‡§ï IAM ‡§∞‡•ã‡§≤ ‡§∏‡•å‡§Ç‡§™‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à** ‡§ú‡•ã ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§ö‡§≤ ‡§∞‡§π‡§æ ‡§π‡•à‡•§ **‡§Ö‡§ó‡§∞** ‡§ü‡§æ‡§∏‡•ç‡§ï **EC2** ‡§á‡§Ç‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏ ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§ö‡§≤‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à, ‡§§‡•ã **EC2 ‡§á‡§Ç‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏** ‡§ï‡•á ‡§∏‡§æ‡§• ‡§è‡§ï **‡§î‡§∞ IAM** ‡§∞‡•ã‡§≤ ‡§ú‡•Å‡§°‡§º‡§æ ‡§π‡•ã‡§ó‡§æ‡•§\
‡§á‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§Ö‡§ó‡§∞ ‡§Ü‡§™‡§ï‡•ã **ECS ‡§á‡§Ç‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏ ‡§ï‡•ã ‡§ï‡§Ç‡§™‡•ç‡§∞‡•ã‡§Æ‡§æ‡§á‡§ú** ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§ï‡§æ‡§Æ‡§Ø‡§æ‡§¨ ‡§π‡•ã ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§§‡•ã ‡§Ü‡§™ ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á **ECR ‡§î‡§∞ EC2 ‡§á‡§Ç‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏ ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ IAM ‡§∞‡•ã‡§≤** ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§á‡§® ‡§ï‡•ç‡§∞‡•á‡§°‡•á‡§Ç‡§∂‡§ø‡§Ø‡§≤‡•ç‡§∏ ‡§ï‡•ã ‡§ï‡•à‡§∏‡•á ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§á‡§∏‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¶‡•á‡§ñ‡•á‡§Ç:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

{% hint style="danger" %}
‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç ‡§ï‡§ø ‡§Ö‡§ó‡§∞ EC2 ‡§á‡§Ç‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏ IMDSv2 ‡§ï‡•ã ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à, [**‡§°‡•â‡§ï‡•ç‡§∏**](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-metadata-v2-how-it-works.html) ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞, **‡§™‡•Å‡§ü ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§ï‡§æ ‡§™‡•ç‡§∞‡§§‡§ø‡§∏‡§æ‡§¶** **‡§π‡•â‡§™ ‡§∏‡•Ä‡§Æ‡§æ 1** ‡§π‡•ã‡§ó‡§æ, ‡§ú‡§ø‡§∏‡§∏‡•á EC2 ‡§Æ‡•á‡§ü‡§æ‡§°‡•á‡§ü‡§æ ‡§ï‡•ã EC2 ‡§á‡§Ç‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏ ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§∏‡•á ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§ï‡§∞‡§®‡§æ ‡§Ö‡§∏‡§Ç‡§≠‡§µ ‡§π‡•ã ‡§ú‡§æ‡§è‡§ó‡§æ‡•§
{% endhint %}

### ‡§®‡•ã‡§° ‡§ï‡•ã ‡§™‡•ç‡§∞‡§æ‡§á‡§µ‡•á‡§∏‡•ç‡§ï ‡§ï‡§∞‡§®‡§æ ‡§î‡§∞ ‡§Ö‡§®‡•ç‡§Ø ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§ï‡•ç‡§∞‡•á‡§°‡•á‡§Ç‡§∂‡§ø‡§Ø‡§≤‡•ç‡§∏ ‡§î‡§∞ ‡§∏‡•Ä‡§ï‡•ç‡§∞‡•á‡§ü‡•ç‡§∏ ‡§ö‡•Å‡§∞‡§æ‡§®‡§æ

‡§á‡§∏‡§ï‡•á ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§, EC2 ‡§°‡•â‡§ï‡§∞ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ECS ‡§ü‡§æ‡§∏‡•ç‡§ï ‡§ö‡§≤‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§á‡§∏‡§≤‡§ø‡§è ‡§Ö‡§ó‡§∞ ‡§Ü‡§™ ‡§®‡•ã‡§° ‡§§‡§ï ‡§≠‡§æ‡§ó‡§®‡•á ‡§Ø‡§æ **‡§°‡•â‡§ï‡§∞ ‡§∏‡•â‡§ï‡•á‡§ü ‡§§‡§ï ‡§™‡§π‡•Å‡§Ç‡§ö** ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§Ü‡§™ **‡§ú‡§æ‡§Ç‡§ö ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç** ‡§ï‡§ø ‡§ï‡•å‡§® ‡§∏‡•á **‡§Ö‡§®‡•ç‡§Ø ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞** ‡§ö‡§≤ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç, ‡§î‡§∞ ‡§â‡§®‡§Æ‡•á‡§Ç ‡§ú‡§æ‡§ï‡§∞ **‡§â‡§®‡§ï‡•á ‡§∏‡§æ‡§• ‡§ö‡§≤‡§æ‡§è ‡§ó‡§è IAM ‡§∞‡•ã‡§≤‡•ç‡§∏** ‡§ö‡•Å‡§∞‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

#### ‡§Æ‡•å‡§ú‡•Ç‡§¶‡§æ ‡§π‡•ã‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§ö‡§≤‡§æ‡§®‡§æ

‡§á‡§∏‡§ï‡•á ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§, **EC2 ‡§á‡§Ç‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏ ‡§∞‡•ã‡§≤** ‡§Æ‡•á‡§Ç ‡§Ü‡§Æ ‡§§‡•å‡§∞ ‡§™‡§∞ ‡§™‡§∞‡•ç‡§Ø‡§æ‡§™‡•ç‡§§ **‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø‡§Ø‡§æ‡§Å** ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡§Ç ‡§ï‡§ø EC2 ‡§á‡§Ç‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏ ‡§ï‡•á ‡§®‡•ã‡§° ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§è ‡§ú‡§æ ‡§∞‡§π‡•á EC2 ‡§á‡§Ç‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏ ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ï‡•ã **‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç**‡•§ ‡§è‡§ï ‡§π‡§Æ‡§≤‡§æ‡§µ‡§æ‡§¶ ‡§á‡§Ç‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏ ‡§ï‡§ø‡§∏‡•Ä ‡§á‡§Ç‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏ ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ï‡•ã **DRAINING** ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à, ‡§´‡§ø‡§∞ ECS **‡§â‡§∏‡§∏‡•á ‡§∏‡§≠‡•Ä ‡§ü‡§æ‡§∏‡•ç‡§ï ‡§π‡§ü‡§æ ‡§¶‡•á‡§ó‡§æ** ‡§î‡§∞ **REPLICA** ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§ö‡§≤ ‡§∞‡§π‡•á ‡§ü‡§æ‡§∏‡•ç‡§ï ‡§è‡§ï ‡§Ö‡§≤‡§ó ‡§á‡§Ç‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏ ‡§Æ‡•á‡§Ç **‡§ö‡§≤‡§æ‡§è ‡§ú‡§æ‡§è‡§Ç‡§ó‡•á**, ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§π‡§Æ‡§≤‡§æ‡§µ‡§æ‡§¶ ‡§ï‡•Ä ‡§á‡§Ç‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏ ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞, ‡§§‡§æ‡§ï‡§ø ‡§µ‡§π **‡§â‡§®‡§ï‡•á IAM ‡§∞‡•ã‡§≤‡•ç‡§∏** ‡§î‡§∞ ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•ã **‡§ö‡•Å‡§∞‡§æ ‡§∏‡§ï‡•á**‡•§
```bash
aws ecs update-container-instances-state \
--cluster <cluster> --status DRAINING --container-instances <container-instance-id>
```
‡§Ø‡§π‡•Ä ‡§§‡§ï‡§®‡•Ä‡§ï **‡§ï‡•ç‡§≤‡§∏‡•ç‡§ü‡§∞ ‡§∏‡•á EC2 ‡§á‡§Ç‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏ ‡§ï‡•ã ‡§°‡•Ä‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡§ï‡•á** ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ï‡§Æ ‡§ó‡•Å‡§™‡•ç‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§π‡•à ‡§≤‡•á‡§ï‡§ø‡§® ‡§Ø‡§π **‡§ü‡§æ‡§∏‡•ç‡§ï ‡§ï‡•ã ‡§Ö‡§®‡•ç‡§Ø ‡§á‡§Ç‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏ ‡§Æ‡•á‡§Ç ‡§ö‡§≤‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡§ú‡§¨‡•Ç‡§∞ ‡§ï‡§∞‡•á‡§ó‡§æ:**
```bash
aws ecs deregister-container-instance \
--cluster <cluster> --container-instance <container-instance-id> --force
```
‡§è‡§ï ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§§‡§ï‡§®‡•Ä‡§ï ‡§ü‡§æ‡§∏‡•ç‡§ï ‡§ï‡•ã ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§ö‡§≤‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ECS ‡§ï‡•ã ‡§∏‡•Ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡•à ‡§ï‡§ø **‡§ü‡§æ‡§∏‡•ç‡§ï ‡§Ø‡§æ ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§¨‡§Ç‡§¶ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§•‡§æ**‡•§ ‡§á‡§∏‡•á ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è 3 ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ API ‡§π‡•à‡§Ç:
```bash
# Needs: ecs:SubmitTaskStateChange
aws ecs submit-task-state-change --cluster <value> \
--status STOPPED --reason "anything" --containers [...]

# Needs: ecs:SubmitContainerStateChange
aws ecs submit-container-state-change ...

# Needs: ecs:SubmitAttachmentStateChanges
aws ecs submit-attachment-state-changes ...
```
### ECR ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§∏‡•á ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ö‡•Å‡§∞‡§æ‡§è‡§Ç

EC2 ‡§á‡§Ç‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏ ‡§∂‡§æ‡§Ø‡§¶ ‡§≠‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø `ecr:GetAuthorizationToken` ‡§∞‡§ñ‡•á‡§ó‡§æ ‡§ú‡§ø‡§∏‡§∏‡•á ‡§Ø‡§π **‡§õ‡§µ‡§ø‡§Ø‡§æ‡§Å ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°** ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à (‡§Ü‡§™ ‡§â‡§®‡§Æ‡•á‡§Ç ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ñ‡•ã‡§ú ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç)‡•§
