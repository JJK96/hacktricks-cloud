# AWS - S3 Post Exploitation

{% hint style="success" %}
Lernen & √ºben Sie AWS-Hacking: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys senden.

</details>
{% endhint %}

## S3

F√ºr weitere Informationen siehe:

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### Sensible Informationen

Manchmal k√∂nnen sensible Informationen in lesbarem Format in den Buckets gefunden werden. Zum Beispiel Terraform-Statusgeheimnisse.

### Pivoting

Verschiedene Plattformen k√∂nnten S3 verwenden, um sensible Verm√∂genswerte zu speichern.\
Zum Beispiel k√∂nnte **Airflow** den **DAG-Code** dort speichern, oder **Webseiten** k√∂nnten direkt von S3 bereitgestellt werden. Ein Angreifer mit Schreibberechtigungen k√∂nnte den Code aus dem Bucket **√§ndern**, um zu anderen Plattformen zu **pivotieren**, oder **Konten √ºbernehmen**, indem er JS-Dateien √§ndert.

### S3-Ransomware

In diesem Szenario erstellt der **Angreifer einen KMS (Key Management Service) Schl√ºssel in seinem eigenen AWS-Konto** oder einem anderen kompromittierten Konto. Anschlie√üend macht er diesen **Schl√ºssel f√ºr jeden auf der Welt zug√§nglich**, sodass jeder AWS-Benutzer, Rolle oder Konto Objekte mit diesem Schl√ºssel verschl√ºsseln kann. Die Objekte k√∂nnen jedoch nicht entschl√ºsselt werden.

Der Angreifer identifiziert einen Ziel-**S3-Bucket und erlangt Schreibzugriff** darauf mithilfe verschiedener Methoden. Dies kann aufgrund einer schlechten Bucket-Konfiguration geschehen, die ihn √∂ffentlich zug√§nglich macht, oder der Angreifer erh√§lt Zugriff auf die AWS-Umgebung selbst. Der Angreifer zielt typischerweise auf Buckets ab, die sensible Informationen wie personenbezogene Daten (PII), gesch√ºtzte Gesundheitsinformationen (PHI), Protokolle, Backups und mehr enthalten.

Um festzustellen, ob der Bucket f√ºr Ransomware angegriffen werden kann, √ºberpr√ºft der Angreifer dessen Konfiguration. Dazu geh√∂rt die √úberpr√ºfung, ob **S3-Objektversionierung** aktiviert ist und ob **Multi-Faktor-Authentifizierung l√∂schen (MFA l√∂schen) aktiviert ist**. Wenn die Objektversionierung nicht aktiviert ist, kann der Angreifer fortfahren. Wenn die Objektversionierung aktiviert ist, aber MFA l√∂schen deaktiviert ist, kann der Angreifer die Objektversionierung **deaktivieren**. Wenn sowohl die Objektversionierung als auch MFA l√∂schen aktiviert sind, wird es f√ºr den Angreifer schwieriger, diesen spezifischen Bucket zu ransomwaren.

Mithilfe der AWS-API ersetzt der Angreifer **jedes Objekt im Bucket durch eine verschl√ºsselte Kopie unter Verwendung seines KMS-Schl√ºssels**. Dadurch werden die Daten im Bucket effektiv verschl√ºsselt und sind ohne den Schl√ºssel nicht zug√§nglich.

Um zus√§tzlichen Druck auszu√ºben, plant der Angreifer die L√∂schung des f√ºr den Angriff verwendeten KMS-Schl√ºssels. Dies gibt dem Ziel ein 7-t√§giges Zeitfenster, um ihre Daten wiederherzustellen, bevor der Schl√ºssel gel√∂scht wird und die Daten dauerhaft verloren gehen.

Schlie√ülich k√∂nnte der Angreifer eine abschlie√üende Datei hochladen, die in der Regel "ransom-note.txt" genannt wird und Anweisungen f√ºr das Ziel enth√§lt, wie es seine Dateien wiederherstellen kann. Diese Datei wird unverschl√ºsselt hochgeladen, wahrscheinlich um die Aufmerksamkeit des Ziels zu erregen und es √ºber den Ransomware-Angriff zu informieren.

**F√ºr weitere Informationen** [**√ºberpr√ºfen Sie die Originalforschung**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**.**

{% hint style="success" %}
Lernen & √ºben Sie AWS-Hacking: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys senden.

</details>
{% endhint %}
