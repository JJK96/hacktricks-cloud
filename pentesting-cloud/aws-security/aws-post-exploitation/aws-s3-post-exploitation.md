# AWS - S3 Post Exploitation

{% hint style="success" %}
Impara e pratica l'Hacking su AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Impara e pratica l'Hacking su GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Sostieni HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di Github.

</details>
{% endhint %}

## S3

Per ulteriori informazioni controlla:

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### Informazioni Sensibili

A volte potresti trovare informazioni sensibili leggibili nei bucket. Ad esempio, segreti di stato di terraform.

### Pivoting

Diverse piattaforme potrebbero utilizzare S3 per memorizzare risorse sensibili.\
Ad esempio, **airflow** potrebbe memorizzare il **codice DAGs** l√¨, o le **pagine web** potrebbero essere servite direttamente da S3. Un attaccante con permessi di scrittura potrebbe **modificare il codice** dal bucket per **pivoting** su altre piattaforme, o **prendere il controllo degli account** modificando i file JS.

### Ransomware su S3

In questo scenario, l'**attaccante crea una chiave KMS (Key Management Service) nel proprio account AWS** o in un altro account compromesso. Quindi rende questa **chiave accessibile a chiunque nel mondo**, consentendo a qualsiasi utente, ruolo o account AWS di crittografare oggetti utilizzando questa chiave. Tuttavia, gli oggetti non possono essere decrittografati.

L'attaccante identifica un **bucket S3 di destinazione e ottiene l'accesso a livello di scrittura** ad esso utilizzando vari metodi. Ci√≤ potrebbe essere dovuto a una cattiva configurazione del bucket che lo espone pubblicamente o all'attaccante che ottiene l'accesso all'ambiente AWS stesso. L'attaccante di solito mira ai bucket che contengono informazioni sensibili come informazioni personalmente identificabili (PII), informazioni sanitarie protette (PHI), log, backup e altro ancora.

Per determinare se il bucket pu√≤ essere preso di mira per il ransomware, l'attaccante controlla la sua configurazione. Ci√≤ include la verifica se √® abilitato il **versioning degli oggetti S3** e se √® abilitata la **cancellazione con autenticazione a due fattori (MFA delete)**. Se il versioning degli oggetti non √® abilitato, l'attaccante pu√≤ procedere. Se il versioning degli oggetti √® abilitato ma la cancellazione MFA √® disabilitata, l'attaccante pu√≤ **disabilitare il versioning degli oggetti**. Se sia il versioning degli oggetti che la cancellazione MFA sono abilitati, diventa pi√π difficile per l'attaccante eseguire il ransomware su quel bucket specifico.

Utilizzando l'API AWS, l'attaccante **sostituisce ciascun oggetto nel bucket con una copia crittografata utilizzando la propria chiave KMS**. Questo cripta efficacemente i dati nel bucket, rendendoli inaccessibili senza la chiave.

Per aumentare la pressione, l'attaccante pianifica la cancellazione della chiave KMS utilizzata nell'attacco. Questo d√† al bersaglio una finestra temporale di 7 giorni per recuperare i propri dati prima che la chiave venga cancellata e i dati vengano persi definitivamente.

Infine, l'attaccante potrebbe caricare un file finale, di solito chiamato "ransom-note.txt," che contiene istruzioni per il bersaglio su come recuperare i propri file. Questo file viene caricato senza crittografia, probabilmente per attirare l'attenzione del bersaglio e renderlo consapevole dell'attacco ransomware.

**Per ulteriori informazioni** [**controlla la ricerca originale**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**.**

{% hint style="success" %}
Impara e pratica l'Hacking su AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Impara e pratica l'Hacking su GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Sostieni HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di Github.

</details>
{% endhint %}
