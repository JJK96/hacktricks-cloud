# AWS - Post eksploatacija S3

{% hint style="success" %}
Naučite i vežbajte hakovanje AWS-a:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Naučite i vežbajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## S3

Za više informacija pogledajte:

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### Osetljive informacije

Ponekad ćete moći pronaći osetljive informacije čitljive u kantama. Na primer, tajne stanja terraforma.

### Pivoting

Različite platforme mogu koristiti S3 za skladištenje osetljivih resursa. Na primer, **airflow** bi mogao skladištiti **DAGs** **kod** tamo, ili **veb stranice** bi mogle direktno biti poslužene iz S3. Napadač sa dozvolama za pisanje bi mogao **modifikovati kod** iz kante da bi **prešao** na druge platforme, ili **preuzeo naloge** modifikujući JS fajlove.

### S3 Ransomware

U ovom scenariju, **napadač kreira KMS (Key Management Service) ključ u svom AWS nalogu** ili drugom kompromitovanom nalogu. Zatim ovaj **ključ čini dostupnim svima u svetu**, omogućavajući bilo kom AWS korisniku, roli ili nalogu da enkriptuje objekte koristeći ovaj ključ. Međutim, objekti ne mogu biti dekriptovani.

Napadač identifikuje ciljnu **S3 kantu i dobija pristup nivou pisanja** koristeći različite metode. To može biti zbog loše konfiguracije kante koja je javno izložena ili napadač dobija pristup samom AWS okruženju. Napadač obično cilja kante koje sadrže osetljive informacije kao što su lično prepoznatljive informacije (PII), zaštićene zdravstvene informacije (PHI), logovi, rezervne kopije i više.

Da bi utvrdio da li se kanta može ciljati ransomware-om, napadač proverava njenu konfiguraciju. To uključuje proveru da li je omogućeno **S3 verzionisanje objekata** i da li je omogućeno **brisanje više faktora autentifikacije (MFA delete)**. Ako verzionisanje objekata nije omogućeno, napadač može nastaviti. Ako je verzionisanje objekata omogućeno ali je MFA delete onemogućen, napadač može **onemogućiti verzionisanje objekata**. Ako su i verzionisanje objekata i MFA delete omogućeni, postaje teže za napadača da ransomware-uje tu specifičnu kantu.

Koristeći AWS API, napadač **zamenjuje svaki objekat u kanti enkriptovanom kopijom koristeći svoj KMS ključ**. Ovo efikasno enkriptuje podatke u kanti, čineći ih nedostupnim bez ključa.

Da bi dodao dodatan pritisak, napadač zakazuje brisanje KMS ključa korištenog u napadu. Ovo daje cilju prozor od 7 dana da povrati svoje podatke pre nego što ključ bude obrisan i podaci postanu trajno izgubljeni.

Na kraju, napadač bi mogao otpremiti konačni fajl, obično nazvan "ransom-note.txt," koji sadrži instrukcije za cilj kako da povrati svoje fajlove. Ovaj fajl se otprema bez enkripcije, verovatno da bi privukao pažnju cilja i obavestio ih o ransomware napadu.

**Za više informacija** [**proverite originalno istraživanje**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**.**

{% hint style="success" %}
Naučite i vežbajte hakovanje AWS-a:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Naučite i vežbajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
