# AWS - S3后渗透

{% hint style="success" %}
学习并练习AWS黑客技术：<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks培训AWS红队专家（ARTE）**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
学习并练习GCP黑客技术：<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks培训GCP红队专家（GRTE）**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持HackTricks</summary>

* 查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或 **关注**我们的**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享黑客技巧。

</details>
{% endhint %}

## S3

有关更多信息，请查看：

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### 敏感信息

有时您可以在存储桶中找到可读取的敏感信息。例如，terraform状态机密信息。

### 枢纽

不同的平台可能使用S3存储敏感资产。\
例如，**airflow**可能会在其中存储**DAGs代码**，或者**网页**可能直接从S3提供。具有写入权限的攻击者可以从存储桶中**修改代码**以**枢纽**到其他平台，或者**接管帐户**修改JS文件。

### S3勒索软件

在这种情况下，**攻击者在其自己的AWS帐户**或另一个受损帐户中创建了一个KMS（密钥管理服务）密钥。然后，他们使这个**密钥对世界上的任何人都可访问**，允许任何AWS用户、角色或帐户使用此密钥加密对象。但是，这些对象无法解密。

攻击者确定目标**S3存储桶并获得写入级别访问**，使用各种方法。这可能是由于暴露给公众的存储桶配置不当，或者攻击者获得对AWS环境本身的访问。攻击者通常针对包含个人可识别信息（PII）、受保护的健康信息（PHI）、日志、备份等敏感信息的存储桶。

为了确定存储桶是否可以成为勒索软件的目标，攻击者检查其配置。这包括验证是否启用了**S3对象版本控制**以及是否启用了**多因素身份验证删除（MFA删除）**。如果未启用对象版本控制，攻击者可以继续。如果启用了对象版本控制但未启用MFA删除，攻击者可以**禁用对象版本控制**。如果对象版本控制和MFA删除都已启用，则攻击者更难以对特定存储桶进行勒索软件攻击。

使用AWS API，攻击者**用其KMS密钥替换存储桶中的每个对象的加密副本**。这有效地加密了存储桶中的数据，使其在没有密钥的情况下无法访问。

为了施加进一步的压力，攻击者安排删除在攻击中使用的KMS密钥。这给目标一个7天的时间窗口来恢复他们的数据，然后密钥将被删除，数据将永久丢失。

最后，攻击者可以上传一个最终文件，通常命名为“ransom-note.txt”，其中包含目标如何检索其文件的说明。这个文件是未加密上传的，可能是为了引起目标的注意，让他们意识到勒索软件攻击。

**欲了解更多信息** [**查看原始研究**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**.**

{% hint style="success" %}
学习并练习AWS黑客技术：<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks培训AWS红队专家（ARTE）**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
学习并练习GCP黑客技术：<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks培训GCP红队专家（GRTE）**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持HackTricks</summary>

* 查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或 **关注**我们的**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享黑客技巧。

</details>
{% endhint %}
