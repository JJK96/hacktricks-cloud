# AWS - S3 Post Exploitation

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 [**στην ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ υποβάλλοντας PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## S3

Για περισσότερες πληροφορίες ελέγξτε:

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### Ευαίσθητες Πληροφορίες

Μερικές φορές μπορείτε να βρείτε ευαίσθητες πληροφορίες που είναι αναγνώσιμες στα buckets. Για παράδειγμα, μυστικά καταστάσεων terraform.

### Περιστροφή

Διαφορετικές πλατφόρμες μπορεί να χρησιμοποιούν το S3 για την αποθήκευση ευαίσθητων περιουσιακών στοιχείων. Για παράδειγμα, το **airflow** μπορεί να αποθηκεύει τον **κώδικα DAGs** εκεί, ή **ιστοσελίδες** μπορεί να εξυπηρετούνται απευθείας από το S3. Ένας επιτιθέμενος με δικαιώματα εγγραφής μπορεί να **τροποποιήσει τον κώδικα** από το bucket για να **περιστραφεί** σε άλλες πλατφόρμες, ή να **αναλάβει λογαριασμούς** τροποποιώντας αρχεία JS.

### S3 Ransomware

Σε αυτό το σενάριο, ο **επιτιθέμενος δημιουργεί ένα KMS (Key Management Service) κλειδί στο δικό του λογαριασμό AWS** ή σε έναν άλλο συμβεβλημένο λογαριασμό. Στη συνέχεια καθιστά αυτό το **κλειδί προσβάσιμο σε οποιονδήποτε στον κόσμο**, επιτρέποντας σε οποιονδήποτε χρήστη, ρόλο ή λογαριασμό AWS να κρυπτογραφήσει αντικείμενα χρησιμοποιώντας αυτό το κλειδί. Ωστόσο, τα αντικείμενα δεν μπορούν να αποκρυπτογραφηθούν.

Ο επιτιθέμενος εντοπίζει ένα στόχο **κάδο S3 και αποκτά πρόσβαση επιπέδου εγγραφής** σε αυτό χρησιμοποιώντας διάφορες μεθόδους. Αυτό μπορεί να οφείλεται σε κακή διαμόρφωση του κάδου που το εκθέτει δημόσια ή στον επιτιθέμενο που αποκτά πρόσβαση στο περιβάλλον AWS ίδιο. Ο επιτιθέμενος συνήθως στοχεύει κάδους που περιέχουν ευαίσθητες πληροφορίες όπως προσωπικά αναγνωρίσιμες πληροφορίες (PII), προστατευμένες πληροφορίες υγείας (PHI), καταγραφές, αντίγραφα ασφαλείας και άλλα.

Για να καθορίσει αν ο κάδος μπορεί να είναι στόχος για ransomware, ο επιτιθέμενος ελέγχει τη διαμόρφωσή του. Αυτό περιλαμβάνει τον έλεγχο εάν η **εκδοχή αντικειμένου S3** είναι ενεργοποιημένη και εάν η **διαγραφή με πολλαπλά παράγοντα επαλήθευσης (MFA delete) είναι ενεργοποιημένη**. Εάν η Εκδοχή Αντικειμένου δεν είναι ενεργοποιημένη, ο επιτιθέμενος μπορεί να προχωρήσει. Εάν η Εκδοχή Αντικειμένου είναι ενεργοποιημένη αλλά η διαγραφή MFA είναι απενεργοποιημένη, ο επιτιθέμενος μπορεί να **απενεργοποιήσει την Εκδοχή Αντικειμένου**. Εάν και η Εκδοχή Αντικειμένου και η διαγραφή MFA είναι ενεργοποιημένες, γίνεται πιο δύσκολο για τον επιτιθέμενο να κάνει ransomware σε αυτόν τον συγκεκριμένο κάδο.

Χρησιμοποιώντας το AWS API, ο επιτιθέμενος **αντικαθιστά κάθε αντικείμενο στον κάδο με ένα κρυπτογραφημένο αντίγραφο χρησιμοποιώντας το KMS κλειδί τους**. Αυτό κρυπτογραφεί αποτελεσματικά τα δεδομένα στον κάδο, κάνοντάς τα μη προσβάσιμα χωρίς το κλειδί.

Για να ασκήσει περαιτέρω πίεση, ο επιτιθέμενος προγραμματίζει τη διαγραφή του KMS κλειδιού που χρησιμοποιήθηκε στην επίθεση. Αυτό δίνει στον στόχο ένα παράθυρο 7 ημερών για να ανακτήσει τα δεδομένα του πριν το κλειδί διαγραφεί και τα δεδομένα γίνουν μόνιμα χαμένα.

Τέλος, ο επιτιθέμενος θα μπορούσε να μεταφορτώσει ένα τελικό αρχείο, συνήθως με το όνομα "ransom-note.txt," το οποίο περιέχει οδηγίες για τον στόχο για το πώς να ανακτήσει τα αρχεία του. Αυτό το αρχείο μεταφορτώνεται χωρίς κρυπτογράφηση, πιθανότατα για να τραβήξει την προσοχή του στόχου και να τον ενημερώσει για την επίθεση ransomware.

**Για περισσότερες πληροφορίες** [**ελέγξτε την αρχική έρευνα**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**.**

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 [**στην ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ υποβάλλοντας PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
