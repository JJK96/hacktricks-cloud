# AWS - CodeBuild Post Exploitation

{% hint style="success" %}
Μάθετε και εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε και εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Γίνετε μέλος της** 💬 [**ομάδας Discord**](https://discord.gg/hRep4RUj7f) ή της [**ομάδας telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}

## CodeBuild

Για περισσότερες πληροφορίες, ελέγξτε:

{% content-ref url="../../aws-services/aws-codebuild-enum.md" %}
[aws-codebuild-enum.md](../../aws-services/aws-codebuild-enum.md)
{% endcontent-ref %}

### Abuse CodeBuild Repo Access

Για να διαμορφώσετε το **CodeBuild**, θα χρειαστεί **πρόσβαση στο αποθετήριο κώδικα** που θα χρησιμοποιεί. Διάφορες πλατφόρμες θα μπορούσαν να φιλοξενούν αυτόν τον κώδικα:

<figure><img src="../../../../.gitbook/assets/image (96).png" alt=""><figcaption></figcaption></figure>

Το **CodeBuild project πρέπει να έχει πρόσβαση** στον διαμορφωμένο πάροχο πηγής, είτε μέσω **IAM role** είτε με ένα github/bitbucket **token ή OAuth access**.

Ένας επιτιθέμενος με **ανυψωμένα δικαιώματα σε ένα CodeBuild** θα μπορούσε να εκμεταλλευτεί αυτήν την διαμορφωμένη πρόσβαση για να διαρρεύσει τον κώδικα του διαμορφωμένου αποθετηρίου και άλλων όπου τα διαμορφωμένα διαπιστευτήρια έχουν πρόσβαση.\
Για να το κάνει αυτό, ένας επιτιθέμενος θα χρειαστεί απλώς να **αλλάξει το URL του αποθετηρίου σε κάθε αποθετήριο που έχουν πρόσβαση τα διαπιστευτήρια της διαμόρφωσης** (σημειώστε ότι το aws web θα τα καταγράψει όλα για εσάς):

<figure><img src="../../../../.gitbook/assets/image (107).png" alt=""><figcaption></figcaption></figure>

Και **αλλάξτε τις εντολές Buildspec για να εξάγετε κάθε αποθετήριο**.

{% hint style="warning" %}
Ωστόσο, αυτή η **εργασία είναι επαναλαμβανόμενη και κουραστική** και αν ένα github token διαμορφώθηκε με **δικαιώματα εγγραφής**, ένας επιτιθέμενος **δεν θα μπορέσει να (κατα)χρησιμοποιήσει αυτά τα δικαιώματα** καθώς δεν έχει πρόσβαση στο token.\
Ή μήπως έχει; Ελέγξτε την επόμενη ενότητα
{% endhint %}

### Leaking Access Tokens from AWS CodeBuild

Μπορείτε να διαρρεύσετε την πρόσβαση που δόθηκε στο CodeBuild σε πλατφόρμες όπως το Github. Ελέγξτε αν δόθηκε πρόσβαση σε εξωτερικές πλατφόρμες με:
```bash
aws codebuild list-source-credentials
```
{% content-ref url="aws-codebuild-token-leakage.md" %}
[aws-codebuild-token-leakage.md](aws-codebuild-token-leakage.md)
{% endcontent-ref %}

### `codebuild:DeleteProject`

Ένας επιτιθέμενος θα μπορούσε να διαγράψει ένα ολόκληρο έργο CodeBuild, προκαλώντας απώλεια της διαμόρφωσης του έργου και επηρεάζοντας τις εφαρμογές που βασίζονται στο έργο.
```bash
aws codebuild delete-project --name <value>
```
**Πιθανός Αντίκτυπος**: Απώλεια διαμόρφωσης έργου και διακοπή υπηρεσίας για εφαρμογές που χρησιμοποιούν το διαγραμμένο έργο.

### `codebuild:TagResource` , `codebuild:UntagResource`

Ένας επιτιθέμενος θα μπορούσε να προσθέσει, να τροποποιήσει ή να αφαιρέσει ετικέτες από πόρους του CodeBuild, διαταράσσοντας την κατανομή κόστους, την παρακολούθηση πόρων και τις πολιτικές ελέγχου πρόσβασης της οργάνωσής σας που βασίζονται σε ετικέτες.
```bash
aws codebuild tag-resource --resource-arn <value> --tags <value>
aws codebuild untag-resource --resource-arn <value> --tag-keys <value>
```
**Πιθανός Αντίκτυπος**: Διακοπή της κατανομής κόστους, της παρακολούθησης πόρων και των πολιτικών ελέγχου πρόσβασης βάσει ετικετών.

### `codebuild:DeleteSourceCredentials`

Ένας επιτιθέμενος θα μπορούσε να διαγράψει τα διαπιστευτήρια πηγής για ένα αποθετήριο Git, επηρεάζοντας τη φυσιολογική λειτουργία των εφαρμογών που βασίζονται στο αποθετήριο.
```sql
aws codebuild delete-source-credentials --arn <value>
```
**Πιθανός Αντίκτυπος**: Διακοπή της κανονικής λειτουργίας για εφαρμογές που βασίζονται στο επηρεαζόμενο αποθετήριο λόγω της αφαίρεσης των διαπιστευτηρίων πηγής.

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}
