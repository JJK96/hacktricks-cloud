# AWS - CodeBuild Post Exploitation

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## CodeBuild

F√ºr weitere Informationen siehe:

{% content-ref url="../../aws-services/aws-codebuild-enum.md" %}
[aws-codebuild-enum.md](../../aws-services/aws-codebuild-enum.md)
{% endcontent-ref %}

### Missbrauch von CodeBuild Repo-Zugriff

Um **CodeBuild** zu konfigurieren, ben√∂tigt es **Zugriff auf das Code-Repo**, das es verwenden wird. Mehrere Plattformen k√∂nnten diesen Code hosten:

<figure><img src="../../../../.gitbook/assets/image (96).png" alt=""><figcaption></figcaption></figure>

Das **CodeBuild-Projekt muss Zugriff** auf den konfigurierten Quellanbieter haben, entweder √ºber **IAM-Rolle** oder mit einem github/bitbucket **Token oder OAuth-Zugriff**.

Ein Angreifer mit **erh√∂hten Berechtigungen in einem CodeBuild** k√∂nnte diesen konfigurierten Zugriff missbrauchen, um den Code des konfigurierten Repos und anderer Repos, auf die die gesetzten Anmeldeinformationen Zugriff haben, zu leaken.\
Um dies zu tun, m√ºsste ein Angreifer nur die **Repository-URL zu jedem Repo √§ndern, auf das die Konfigurationsanmeldeinformationen Zugriff haben** (beachte, dass die aws-Webseite alle f√ºr dich auflisten wird):

<figure><img src="../../../../.gitbook/assets/image (107).png" alt=""><figcaption></figcaption></figure>

Und **die Buildspec-Befehle √§ndern, um jedes Repo zu exfiltrieren**.

{% hint style="warning" %}
Diese **Aufgabe ist jedoch repetitiv und m√ºhsam** und wenn ein github-Token mit **Schreibberechtigungen** konfiguriert wurde, kann ein Angreifer **diese Berechtigungen nicht (miss)brauchen**, da er keinen Zugriff auf das Token hat.\
Oder doch? Siehe den n√§chsten Abschnitt
{% endhint %}

### Leaking von Zugriffstokens aus AWS CodeBuild

Du kannst den Zugriff, der in CodeBuild auf Plattformen wie Github gew√§hrt wurde, leaken. √úberpr√ºfe, ob ein Zugriff auf externe Plattformen gew√§hrt wurde mit:
```bash
aws codebuild list-source-credentials
```
{% content-ref url="aws-codebuild-token-leakage.md" %}
[aws-codebuild-token-leakage.md](aws-codebuild-token-leakage.md)
{% endcontent-ref %}

### `codebuild:DeleteProject`

Ein Angreifer k√∂nnte ein gesamtes CodeBuild-Projekt l√∂schen, was zum Verlust der Projektkonfiguration und zur Beeintr√§chtigung von Anwendungen f√ºhrt, die auf das Projekt angewiesen sind.
```bash
aws codebuild delete-project --name <value>
```
**Potentieller Einfluss**: Verlust der Projektkonfiguration und Dienstunterbrechung f√ºr Anwendungen, die das gel√∂schte Projekt verwenden.

### `codebuild:TagResource` , `codebuild:UntagResource`

Ein Angreifer k√∂nnte Tags von CodeBuild-Ressourcen hinzuf√ºgen, √§ndern oder entfernen, was die Kostenverteilung, Ressourcennachverfolgung und Zugriffskontrollrichtlinien Ihrer Organisation basierend auf Tags st√∂ren k√∂nnte.
```bash
aws codebuild tag-resource --resource-arn <value> --tags <value>
aws codebuild untag-resource --resource-arn <value> --tag-keys <value>
```
**Potentieller Einfluss**: St√∂rung der Kostenverteilung, Ressourcennachverfolgung und tag-basierten Zugriffskontrollrichtlinien.

### `codebuild:DeleteSourceCredentials`

Ein Angreifer k√∂nnte Quellanmeldeinformationen f√ºr ein Git-Repository l√∂schen, was die normale Funktion von Anwendungen, die auf das Repository angewiesen sind, beeintr√§chtigen k√∂nnte.
```sql
aws codebuild delete-source-credentials --arn <value>
```
**Potentieller Einfluss**: St√∂rung des normalen Betriebs von Anwendungen, die auf das betroffene Repository angewiesen sind, aufgrund der Entfernung von Quell-Anmeldeinformationen.

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* Schau dir die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop) an!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
