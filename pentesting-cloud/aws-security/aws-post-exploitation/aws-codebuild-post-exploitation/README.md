# AWS - CodeBuild Post Exploitation

{% hint style="success" %}
AWSハッキングを学び、練習する:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPハッキングを学び、練習する: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポートする</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォローする。**
* **PRを提出してハッキングトリックを共有する** [**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリ。

</details>
{% endhint %}

## CodeBuild

詳細については、以下を参照してください:

{% content-ref url="../../aws-services/aws-codebuild-enum.md" %}
[aws-codebuild-enum.md](../../aws-services/aws-codebuild-enum.md)
{% endcontent-ref %}

### CodeBuild Repo Accessの悪用

**CodeBuild**を設定するためには、使用するコードリポジトリへの**アクセス**が必要です。いくつかのプラットフォームがこのコードをホスティングしている可能性があります:

<figure><img src="../../../../.gitbook/assets/image (96).png" alt=""><figcaption></figcaption></figure>

**CodeBuildプロジェクトは、**IAMロール**またはgithub/bitbucketの**トークンまたはOAuthアクセス**を介して、設定されたソースプロバイダーへのアクセスを持っている必要があります。

**CodeBuild**上で**昇格された権限**を持つ攻撃者は、この設定されたアクセスを悪用して、設定されたリポジトリや設定されたクレデンシャルがアクセスできる他のリポジトリのコードを漏洩させることができます。\
これを行うために、攻撃者は**設定クレデンシャルがアクセスできる各リポジトリのURLを変更**するだけでよいです（awsウェブはすべてをリストアップしてくれます）:

<figure><img src="../../../../.gitbook/assets/image (107).png" alt=""><figcaption></figcaption></figure>

そして、**Buildspecコマンドを変更して各リポジトリを流出させる**。

{% hint style="warning" %}
しかし、この**タスクは反復的で面倒**であり、githubトークンが**書き込み権限**で設定されている場合、攻撃者は**その権限を（悪）用することができません**。なぜなら、トークンにアクセスできないからです。\
それともできるのでしょうか？次のセクションを確認してください
{% endhint %}

### AWS CodeBuildからのアクセストークンの漏洩

CodeBuildでGithubなどのプラットフォームに与えられたアクセスを漏洩させることができます。外部プラットフォームへのアクセスが与えられているかどうかを確認してください:
```bash
aws codebuild list-source-credentials
```
{% content-ref url="aws-codebuild-token-leakage.md" %}
[aws-codebuild-token-leakage.md](aws-codebuild-token-leakage.md)
{% endcontent-ref %}

### `codebuild:DeleteProject`

攻撃者は、CodeBuildプロジェクト全体を削除することができ、プロジェクトの設定が失われ、そのプロジェクトに依存するアプリケーションに影響を与える可能性があります。
```bash
aws codebuild delete-project --name <value>
```
**潜在的影響**: プロジェクト構成の喪失および削除されたプロジェクトを使用するアプリケーションのサービス中断。

### `codebuild:TagResource` , `codebuild:UntagResource`

攻撃者は、CodeBuildリソースからタグを追加、変更、または削除することで、組織のコスト配分、リソース追跡、およびタグに基づくアクセス制御ポリシーを混乱させる可能性があります。
```bash
aws codebuild tag-resource --resource-arn <value> --tags <value>
aws codebuild untag-resource --resource-arn <value> --tag-keys <value>
```
**潜在的影響**: コスト配分、リソース追跡、およびタグベースのアクセス制御ポリシーの混乱。

### `codebuild:DeleteSourceCredentials`

攻撃者はGitリポジトリのソース資格情報を削除し、リポジトリに依存するアプリケーションの正常な機能に影響を与える可能性があります。
```sql
aws codebuild delete-source-credentials --arn <value>
```
**潜在的な影響**: ソース認証情報の削除により、影響を受けるリポジトリに依存するアプリケーションの正常な機能が中断される可能性があります。

{% hint style="success" %}
AWSハッキングを学び、練習する:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPハッキングを学び、練習する: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポートする</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォローする。**
* **PRを提出してハッキングトリックを共有する** [**HackTricks**](https://github.com/carlospolop/hacktricks) および [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubリポジトリ。

</details>
{% endhint %}
