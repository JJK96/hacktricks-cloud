# Az - Υπηρεσία Azure App & Λειτουργικές Εφαρμογές

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 [**στην ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Βασικές Πληροφορίες Υπηρεσίας Εφαρμογής

[Από τα έγγραφα:](https://learn.microsoft.com/en-us/azure/app-service/overview) Η υπηρεσία _Azure App Service_ είναι μια υπηρεσία βασισμένη σε HTTP για τη φιλοξενία web εφαρμογών, REST APIs και mobile back ends. Μπορείτε να αναπτύξετε στη γλώσσα της επιλογής σας, είτε είναι .NET, .NET Core, Java, Ruby, Node.js, PHP, ή Python. Οι εφαρμογές τρέχουν και κλιμακώνονται εύκολα τόσο σε περιβάλλοντα Windows όσο και Linux.

Κάθε εφαρμογή τρέχει μέσα σε ένα χώρο ασφαλείας, αλλά η απομόνωση εξαρτάται από τα σχέδια της υπηρεσίας εφαρμογής

* Οι εφαρμογές στα tiers Free και Shared τρέχουν σε κοινόχρηστα VMs
* Οι εφαρμογές στα tiers Standard και Premium τρέχουν σε αφιερωμένα VMs

{% hint style="warning" %}
Σημειώστε ότι **καμία** από αυτές τις απομονώσεις **δεν εμποδίζει** άλλες κοινές **ευπάθειες του web** (όπως η μεταφόρτωση αρχείων ή ενσωματώσεις). Και αν χρησιμοποιείται μια **ταυτότητα διαχείρισης**, θα μπορούσε να **θέσει σε κίνδυνο τα δικαιώματά της**.
{% endhint %}

### Απαρίθμηση

{% tabs %}
{% tab title="az" %}
{% code overflow="wrap" %}
```bash
# List webapps
az webapp list

## Less information
az webapp list --query "[].{hostName: defaultHostName, state: state, name: name, resourcegroup: resourceGroup}"

# Get access restrictions
az webapp config access-restriction show --resource-group <res-group> -n <name>

# Remove access restrictions
az webapp config access-restriction remove --resource-group <res-group> -n <name> --rule-name <rule-name>

# Get snapshots
az webapp config snapshot list --resource-group <res-group> -n <name>

# Restore snapshot
az webapp config snapshot restore -g <res-group> -n <name> --time 2018-12-11T23:34:16.8388367

# Restart webapp
az webapp restart --name <name> --resource-group <res-group>
```
{% endcode %}
{% endtab %}

{% tab title="Az Powershell" %}
```powershell
# Get App Services and Function Apps
Get-AzWebApp
# Get only App Services
Get-AzWebApp | ?{$_.Kind -notmatch "functionapp"}
```
{% endtab %}

{% tab title="az πάρε όλα" %}
{% code overflow="wrap" %}
```bash
#!/bin/bash

# Get all App Service and Function Apps

# Define Azure subscription ID
azure_subscription="your_subscription_id"

# Log in to Azure
az login

# Select Azure subscription
az account set --subscription $azure_subscription

# Get all App Services in the specified subscription
list_app_services=$(az appservice list --query "[].{appServiceName: name, group: resourceGroup}" -o tsv)

# Iterate over each App Service
echo "$list_app_services" | while IFS=$'\t' read -r appServiceName group; do
# Get the type of the App Service
service_type=$(az appservice show --name $appServiceName --resource-group $group --query "kind" -o tsv)

# Check if it is a Function App and print its name
if [ "$service_type" == "functionapp" ]; then
echo "Function App Name: $appServiceName"
fi
done
```
#### Απόκτηση διαπιστευτηρίων & πρόσβαση στον κώδικα της web εφαρμογής
```bash
# Get connection strings that could contain credentials (with DBs for example)
az webapp config connection-string list --name <name> --resource-group <res-group>
## Check how to use the DBs connection strings in the SQL page

# Get credentials to access the code and DB credentials if configured.
az webapp deployment list-publishing-profiles --resource-group <res-group> -n <name>


# Get git URL to access the code
az webapp deployment source config-local-git --resource-group <res-group> -n <name>

# Access/Modify the code via git
git clone 'https://<username>:<password>@name.scm.azurewebsites.net/repo-name.git'
## In my case the username was: $nameofthewebapp and the password some random chars
## If you change the code and do a push, the app is automatically redeployed
```
#### Πρόσβαση στον Docker container με τη webapp μέσω ssh:
```bash
# Get ssh session
az webapp create-remote-connection --subscription <SUBSCRIPTION-ID> --resource-group <RG-NAME> -n <APP-SERVICE-NAME>

## If successfull you will get a message such as:
#Verifying if app is running....
#App is running. Trying to establish tunnel connection...
#Opening tunnel on port: 39895
#SSH is available { username: root, password: Docker! }

## So from that machine ssh into that port (you might need generate a new ssh session to the jump host)
ssh root@127.0.0.1 -p 39895
```
## Βασικές Πληροφορίες για τις Εφαρμογές Λειτουργιών

Τα Azure Functions είναι μια λύση **serverless** που σας επιτρέπει να γράψετε λιγότερο κώδικα, να διατηρήσετε λιγότερη υποδομή και να εξοικονομήσετε χρήματα. Αντί να ανησυχείτε για την αναπτυξη και τη διατήρηση διακομιστών, η υποδομή στο cloud παρέχει όλους τους ενημερωμένους πόρους που χρειάζονται για να διατηρούνται οι εφαρμογές σας σε λειτουργία.

Στο portal του Azure, η ενσωμάτωση μεταξύ των Azure Functions και του Azure API Management διευκολύνεται, επιτρέποντας στα **σημεία λειτουργίας ενεργοποίησης HTTP να εκτίθενται ως REST APIs**. Τα APIs που εκτίθενται με αυτόν τον τρόπο περιγράφονται χρησιμοποιώντας μια ορισμένη απόδοση OpenAPI, παρέχοντας ένα πρότυπο, γλωσσο-ανεξάρτητο διεπαφή για τα RESTful APIs.

Οι **Εφαρμογές Λειτουργιών υποστηρίζουν τα Managed Identities**.

Επιπλέον, η Εφαρμογή Λειτουργιών μπορεί να έχει ορισμένα σημεία εντοπισμού που απαιτούν ένα συγκεκριμένο επίπεδο πιστοποίησης, όπως "διαχειριστή" ή "ανώνυμο". \
Ένας επιτιθέμενος θα μπορούσε να προσπαθήσει να έχει πρόσβαση στα **σημεία εντοπισμού που επιτρέπονται σε ανώνυμους χρήστες** για να παρακάμψει τους περιορισμούς και να αποκτήσει πρόσβαση σε ευαίσθητα δεδομένα ή λειτουργικότητα.

### Απαρίθμηση
```powershell
# Get only Function Apps
Get-AzFunctionApp
```
## Αναφορές

* [https://learn.microsoft.com/en-in/azure/app-service/overview](https://learn.microsoft.com/en-in/azure/app-service/overview)
* [https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition](https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition)

{% hint style="success" %}
Μάθε & εξάσκησε το Hacking στο AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθε & εξάσκησε το Hacking στο GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστήριξε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Συμμετέχετε** 💬 [**στην ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
