# Az - Azure Network

{% hint style="success" %}
Μάθετε και εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε και εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Γίνετε μέλος της** 💬 [**ομάδας Discord**](https://discord.gg/hRep4RUj7f) ή της [**ομάδας telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}

## Βασικές Πληροφορίες

Τα δίκτυα στο Azure λειτουργούν ως αναπόσπαστο μέρος της πλατφόρμας υπολογιστικού νέφους, επιτρέποντας τη **σύνδεση και επικοινωνία μεταξύ διαφόρων υπηρεσιών και πόρων του Azure**. Η αρχιτεκτονική δικτύου στο Azure έχει σχεδιαστεί για να είναι εξαιρετικά επεκτάσιμη, ασφαλής και προσαρμόσιμη.

Στον πυρήνα του, το Azure παρέχει ένα **εικονικό δίκτυο (VNet)** που επιτρέπει στους χρήστες να δημιουργούν **απομονωμένα** **δίκτυα** στο νέφος του Azure. Μέσα σε αυτά τα VNets, πόροι όπως εικονικές μηχανές, εφαρμογές και βάσεις δεδομένων μπορούν να φιλοξενούνται και να διαχειρίζονται με ασφάλεια. Η δικτύωση στο Azure υποστηρίζει τόσο την επικοινωνία εντός του νέφους (μεταξύ υπηρεσιών του Azure) όσο και τη σύνδεση με εξωτερικά δίκτυα και το διαδίκτυο.

Η **ασφάλεια** είναι ένας κρίσιμος τομέας της δικτύωσης στο Azure, με διάφορα εργαλεία και υπηρεσίες διαθέσιμα για την προστασία των δεδομένων, τη διαχείριση της πρόσβασης και την εξασφάλιση της συμμόρφωσης. Αυτά τα μέτρα ασφαλείας περιλαμβάνουν **firewalls**, **ομάδες ασφαλείας δικτύου** και δυνατότητες **κρυπτογράφησης**, επιτρέποντας υψηλό επίπεδο ελέγχου της κυκλοφορίας και της πρόσβασης.

Συνολικά, οι δυνατότητες δικτύωσης του Azure έχουν σχεδιαστεί για να προσφέρουν ευελιξία, επιτρέποντας στους χρήστες να δημιουργούν ένα περιβάλλον δικτύου που να ταιριάζει στις συγκεκριμένες ανάγκες των εφαρμογών και των φορτίων εργασίας τους, διατηρώντας παράλληλα έντονη έμφαση στην ασφάλεια και την αξιοπιστία.

## Εικονικό Δίκτυο (VNET) & Υποδίκτυα

Ένα VNet στο Azure είναι ουσιαστικά μια αναπαράσταση του δικού σας δικτύου στο νέφος. Είναι μια **λογική απομόνωση του νέφους του Azure αφιερωμένη στη συνδρομή σας**. Ένα VNet σας επιτρέπει να προμηθεύετε και να διαχειρίζεστε εικονικά ιδιωτικά δίκτυα (VPNs) στο Azure και μπορεί να χρησιμοποιηθεί για τη φιλοξενία και **διαχείριση πολλών τύπων πόρων του Azure**, όπως Εικονικές Μηχανές (VMs), βάσεις δεδομένων και υπηρεσίες εφαρμογών.

Τα VNets σας παρέχουν **πλήρη έλεγχο των ρυθμίσεων του δικτύου σας**, συμπεριλαμβανομένων των **εύρους διευθύνσεων IP**, της δημιουργίας υποδικτύων, των πινάκων δρομολόγησης και των πυλών δικτύου.

Ένα **υποδίκτυο** είναι ένα **εύρος διευθύνσεων IP στο VNet σας**. Μπορείτε να διαιρέσετε ένα VNet σε πολλά υποδίκτυα για οργάνωση και ασφάλεια. Κάθε υποδίκτυο σε ένα VNet μπορεί να χρησιμοποιηθεί για την απομόνωση και την ομαδοποίηση πόρων σύμφωνα με την αρχιτεκτονική του δικτύου και της εφαρμογής σας.

Επιπλέον, τα υποδίκτυα σας επιτρέπουν να **κατατμήσετε το VNet σας σε ένα ή περισσότερα υποδίκτυα**, παρέχοντας ένα εύρος διευθύνσεων IP που μπορούν να χρησιμοποιήσουν οι πόροι.

### **Παράδειγμα**

* Υποθέστε ότι έχετε ένα VNet με το όνομα `MyVNet` με εύρος διευθύνσεων IP `10.0.0.0/16`. Μπορείτε να δημιουργήσετε ένα υποδίκτυο μέσα σε αυτό το VNet, ας πούμε `Subnet-1`, με εύρος διευθύνσεων IP `10.0.0.0/24` για τη φιλοξενία των διακομιστών ιστού σας. Ένα άλλο υποδίκτυο, `Subnet-2` με εύρος `10.0.1.0/24`, θα μπορούσε να χρησιμοποιηθεί για τους διακομιστές βάσεων δεδομένων σας. Αυτή η κατατμήση επιτρέπει την αποδοτική διαχείριση και τους ελέγχους ασφαλείας μέσα στο δίκτυο.

### Καταμέτρηση

Για να καταγράψετε όλα τα VNets και τα υποδίκτυα σε έναν λογαριασμό Azure, μπορείτε να χρησιμοποιήσετε το Azure Command-Line Interface (CLI). Εδώ είναι τα βήματα:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Network Security Groups (NSG)

Στο Azure, μια **Ομάδα Ασφαλείας Δικτύου (NSG)** εξυπηρετεί την κύρια λειτουργία του φιλτραρίσματος της δικτυακής κίνησης τόσο προς όσο και από πόρους του Azure μέσα σε ένα Εικονικό Δίκτυο Azure (VNet). Περιέχει ένα σύνολο από **κανόνες ασφαλείας** που υπαγορεύουν με ακρίβεια τη ροή της δικτυακής κίνησης.

Βασικές πτυχές της NSG περιλαμβάνουν:

* **Έλεγχος Κίνησης**: Κάθε NSG περιέχει κανόνες που είναι καθοριστικοί είτε για την άδεια είτε για την παρεμπόδιση της εισερχόμενης και εξερχόμενης δικτυακής κίνησης που σχετίζεται με διάφορους πόρους του Azure.
* **Συστατικά Κανόνων**: Οι κανόνες μέσα σε μια NSG είναι εξαιρετικά συγκεκριμένοι, φιλτράροντας την κίνηση βάσει κριτηρίων όπως η διεύθυνση IP προέλευσης/προορισμού, η θύρα και το πρωτόκολλο. Αυτή η εξειδίκευση επιτρέπει τη λεπτομερή διαχείριση της δικτυακής κίνησης.
* **Ενίσχυση Ασφαλείας**: Εξασφαλίζοντας ότι μόνο εξουσιοδοτημένη κίνηση μπορεί να εισέλθει ή να εξέλθει από τους πόρους του Azure, οι NSG παίζουν κρίσιμο ρόλο στην ενίσχυση της ασφάλειας της δικτυακής σας υποδομής.

### **Παράδειγμα**

* Φανταστείτε ότι έχετε μια NSG με το όνομα `MyNSG` εφαρμοσμένη σε ένα υποδίκτυο ή σε μια συγκεκριμένη εικονική μηχανή μέσα στο VNet σας. Μπορείτε να δημιουργήσετε κανόνες όπως:
* Ένας εισερχόμενος κανόνας που επιτρέπει την κίνηση HTTP (θύρα 80) από οποιαδήποτε πηγή στους διακομιστές ιστού σας.
* Ένας εξερχόμενος κανόνας που επιτρέπει μόνο την κίνηση SQL (θύρα 1433) σε ένα συγκεκριμένο εύρος διευθύνσεων IP προορισμού.

### Απαρίθμηση

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Το Azure Firewall είναι μια διαχειριζόμενη, βασισμένη στο cloud **υπηρεσία ασφάλειας δικτύου που προστατεύει τους πόρους του Azure Virtual Network**. Είναι ένα πλήρως stateful firewall ως υπηρεσία με ενσωματωμένα χαρακτηριστικά υψηλής διαθεσιμότητας και κλιμακωσιμότητας.

Το Azure Firewall παρέχει **πιο προηγμένα** χαρακτηριστικά από τα **NSGs**, συμπεριλαμβανομένων **φιλτραρίσματος σε επίπεδο εφαρμογής**, φιλτραρίσματος σε επίπεδο δικτύου, φιλτραρίσματος βασισμένου σε πληροφορίες απειλών και ενσωμάτωσης με το Azure Monitor για καταγραφή και ανάλυση.\
Μπορεί να φιλτράρει εξερχόμενη, εισερχόμενη, spoke-to-spoke, VPN και ExpressRoute κίνηση. **Οι κανόνες firewall μπορούν να δημιουργηθούν με βάση το FQDN (Fully Qualified Domain Name), τις διευθύνσεις IP και τις θύρες**.

### Διαφορές μεταξύ Azure Firewall και NSGs

1. **Πεδίο εφαρμογής:**
* **NSG:** Λειτουργεί σε επίπεδο υποδικτύου ή διεπαφής δικτύου. Προορίζεται για την παροχή βασικού φιλτραρίσματος της εισερχόμενης και εξερχόμενης κίνησης από διεπαφές δικτύου (NIC), VMs ή υποδίκτυα.
* **Azure Firewall:** Λειτουργεί σε επίπεδο VNet, παρέχοντας ευρύτερο πεδίο προστασίας. Σχεδιάστηκε για να ασφαλίζει τους πόρους του εικονικού δικτύου σας και να διαχειρίζεται την κίνηση που ρέει μέσα και έξω από το VNet.
2. **Δυνατότητες:**
* **NSG:** Παρέχει βασικές δυνατότητες φιλτραρίσματος με βάση τη διεύθυνση IP, τη θύρα και το πρωτόκολλο. Δεν υποστηρίζει προηγμένα χαρακτηριστικά όπως επιθεώρηση σε επίπεδο εφαρμογής ή πληροφορίες απειλών.
* **Azure Firewall:** Προσφέρει προηγμένα χαρακτηριστικά όπως φιλτράρισμα κίνησης σε επίπεδο εφαρμογής (Layer 7), φιλτράρισμα βασισμένο σε πληροφορίες απειλών, φιλτράρισμα κίνησης δικτύου και άλλα. Υποστηρίζει επίσης πολλαπλές δημόσιες διευθύνσεις IP.
3. **Περιπτώσεις χρήσης:**
* **NSG:** Ιδανικό για βασικό φιλτράρισμα κίνησης σε επίπεδο δικτύου.
* **Azure Firewall:** Κατάλληλο για πιο σύνθετα σενάρια φιλτραρίσματος όπου απαιτείται έλεγχος σε επίπεδο εφαρμογής, καταγραφή και πληροφορίες απειλών.
4. **Διαχείριση και Παρακολούθηση:**
* **NSG:** Προσφέρει βασική καταγραφή και ενσωμάτωση με το Azure Monitor.
* **Azure Firewall:** Παρέχει προηγμένες δυνατότητες καταγραφής και ανάλυσης μέσω του Azure Monitor, που είναι απαραίτητες για την κατανόηση της φύσης και του προτύπου της κίνησης.

### Απαρίθμηση

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Network Virtual Appliance (NVA)

Μια Εικονική Συσκευή Δικτύου (**NVA**) στο Azure είναι μια εικονική συσκευή που **εκτελεί λειτουργίες δικτύου μέσα σε ένα εικονικό δίκτυο**. Οι NVAs χρησιμοποιούνται συνήθως για λειτουργίες δικτύου που **δεν είναι εγγενώς διαθέσιμες** στο Azure ή όταν απαιτείται περισσότερη προσαρμογή. Είναι ουσιαστικά **VMs που εκτελούν εφαρμογές ή υπηρεσίες δικτύου**, όπως firewalls, WAN optimizers, ή load balancers.

Οι NVAs χρησιμοποιούνται για σύνθετες εργασίες δρομολόγησης, **ασφάλειας**, και **διαχείρισης κυκλοφορίας δικτύου**. Μπορούν να αναπτυχθούν από το Azure **Marketplace**, όπου πολλοί τρίτοι προμηθευτές προσφέρουν τις συσκευές τους έτοιμες για ενσωμάτωση σε περιβάλλοντα Azure.

### **Παράδειγμα**

* Μια οργάνωση μπορεί να αναπτύξει μια NVA στο Azure για να δημιουργήσει μια **προσαρμοσμένη λύση firewall**. Αυτή η NVA θα μπορούσε να εκτελεί ένα **λογισμικό firewall τρίτου μέρους**, παρέχοντας προηγμένα χαρακτηριστικά όπως ανίχνευση εισβολών, επιθεώρηση πακέτων, ή συνδεσιμότητα VPN. Η NVA μπορεί να διαμορφωθεί για να επιθεωρεί και να φιλτράρει την κυκλοφορία που περνάει από αυτήν, εξασφαλίζοντας ενισχυμένα μέτρα ασφαλείας σύμφωνα με τις πολιτικές της οργάνωσης.

### **Απαρίθμηση**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Azure Route Tables & User Defined Routes (UDR)

**Azure Route Tables** είναι μια δυνατότητα στο Microsoft Azure που επιτρέπει τον **έλεγχο της δρομολόγησης δικτυακής κίνησης εντός των Azure Virtual Networks (VNets)**. Ουσιαστικά, ορίζουν πώς **προωθούνται τα πακέτα** μεταξύ υποδικτύων εντός των VNets, μεταξύ VNets ή σε εξωτερικά δίκτυα. Κάθε πίνακας δρομολόγησης περιέχει ένα σύνολο κανόνων, γνωστών ως δρομολογήσεις, που καθορίζουν πώς πρέπει να δρομολογούνται τα πακέτα βάσει των διευθύνσεων IP προορισμού τους.

**User Defined Routes (UDR)** στο Azure είναι **προσαρμοσμένες δρομολογήσεις που δημιουργείτε εντός των Azure Route Tables** για να ελέγχετε τη **ροή της δικτυακής κίνησης** εντός και μεταξύ των Azure Virtual Networks (VNets), και σε εξωτερικές συνδέσεις. Οι UDRs σας δίνουν την ευελιξία να κατευθύνετε τη δικτυακή κίνηση σύμφωνα με τις συγκεκριμένες απαιτήσεις σας, παρακάμπτοντας τις προεπιλεγμένες αποφάσεις δρομολόγησης του Azure.

Αυτές οι δρομολογήσεις είναι ιδιαίτερα χρήσιμες για σενάρια όπου χρειάζεται να **δρομολογήσετε την κίνηση μέσω μιας εικονικής συσκευής**, να επιβάλετε μια συγκεκριμένη διαδρομή για λόγους ασφάλειας ή συμμόρφωσης με πολιτικές, ή να ενσωματώσετε δίκτυα on-premises.

### **Παράδειγμα**

* Υποθέστε ότι έχετε αναπτύξει μια Network Virtual Appliance (NVA) για την επιθεώρηση της κίνησης μεταξύ υποδικτύων εντός ενός VNet. Μπορείτε να δημιουργήσετε μια UDR που κατευθύνει όλη την κίνηση από ένα υποδίκτυο σε άλλο υποδίκτυο μέσω της NVA. Αυτή η UDR διασφαλίζει ότι η NVA επιθεωρεί την κίνηση για λόγους ασφαλείας πριν φτάσει στον προορισμό της.

### **Απαρίθμηση**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Το Azure Private Link είναι μια υπηρεσία στο Azure που **επιτρέπει ιδιωτική πρόσβαση σε υπηρεσίες Azure** διασφαλίζοντας ότι **η κίνηση μεταξύ του Azure virtual network (VNet) και της υπηρεσίας ταξιδεύει εξ ολοκλήρου εντός του δικτύου backbone της Microsoft Azure**. Ουσιαστικά φέρνει την υπηρεσία στο VNet σας. Αυτή η ρύθμιση ενισχύει την ασφάλεια, καθώς δεν εκθέτει τα δεδομένα στο δημόσιο διαδίκτυο.

Το Private Link μπορεί να χρησιμοποιηθεί με διάφορες υπηρεσίες Azure, όπως το Azure Storage, το Azure SQL Database, και προσαρμοσμένες υπηρεσίες που μοιράζονται μέσω του Private Link. Παρέχει έναν ασφαλή τρόπο κατανάλωσης υπηρεσιών από το δικό σας VNet ή ακόμα και από διαφορετικές συνδρομές Azure.

{% hint style="danger" %}
Τα NSGs δεν εφαρμόζονται σε ιδιωτικά endpoints, που σημαίνει ξεκάθαρα ότι η συσχέτιση ενός NSG με ένα subnet που περιέχει το Private Link δεν θα έχει καμία επίδραση.
{% endhint %}

### **Παράδειγμα**

* Σκεφτείτε ένα σενάριο όπου έχετε μια **Azure SQL Database που θέλετε να έχετε πρόσβαση με ασφάλεια από το VNet σας**. Κανονικά, αυτό μπορεί να περιλαμβάνει τη διέλευση από το δημόσιο διαδίκτυο. Με το Private Link, μπορείτε να δημιουργήσετε ένα **ιδιωτικό endpoint στο VNet σας** που συνδέεται απευθείας με την υπηρεσία Azure SQL Database. Αυτό το endpoint κάνει τη βάση δεδομένων να φαίνεται σαν να είναι μέρος του δικού σας VNet, προσβάσιμη μέσω μιας ιδιωτικής διεύθυνσης IP, διασφαλίζοντας έτσι ασφαλή και ιδιωτική πρόσβαση.

### **Απαρίθμηση**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Azure Service Endpoints

Οι Azure Service Endpoints επεκτείνουν τον ιδιωτικό χώρο διευθύνσεων του εικονικού σας δικτύου και την ταυτότητα του VNet σας στις υπηρεσίες Azure μέσω μιας άμεσης σύνδεσης. Ενεργοποιώντας τα service endpoints, **οι πόροι στο VNet σας μπορούν να συνδεθούν με ασφάλεια στις υπηρεσίες Azure**, όπως το Azure Storage και το Azure SQL Database, χρησιμοποιώντας το backbone δίκτυο της Azure. Αυτό διασφαλίζει ότι η **κίνηση από το VNet προς την υπηρεσία Azure παραμένει εντός του δικτύου Azure**, παρέχοντας έναν πιο ασφαλή και αξιόπιστο δρόμο.

### **Παράδειγμα**

* Για παράδειγμα, ένας **Azure Storage** λογαριασμός από προεπιλογή είναι προσβάσιμος μέσω του δημόσιου διαδικτύου. Ενεργοποιώντας ένα **service endpoint για το Azure Storage εντός του VNet σας**, μπορείτε να διασφαλίσετε ότι μόνο η κίνηση από το VNet σας μπορεί να έχει πρόσβαση στον λογαριασμό αποθήκευσης. Το firewall του λογαριασμού αποθήκευσης μπορεί στη συνέχεια να ρυθμιστεί ώστε να δέχεται κίνηση μόνο από το VNet σας.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Διαφορές Μεταξύ Service Endpoints και Private Links

Η Microsoft συνιστά τη χρήση Private Links στα [**docs**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\\

<figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Service Endpoints:**

* Η κίνηση από το VNet σας προς την υπηρεσία Azure ταξιδεύει μέσω του δικτύου backbone της Microsoft Azure, παρακάμπτοντας το δημόσιο διαδίκτυο.
* Το endpoint είναι μια άμεση σύνδεση με την υπηρεσία Azure και δεν παρέχει ιδιωτική IP για την υπηρεσία εντός του VNet.
* Η υπηρεσία είναι ακόμα προσβάσιμη μέσω του δημόσιου endpoint της από έξω από το VNet σας, εκτός αν διαμορφώσετε το firewall της υπηρεσίας για να μπλοκάρει τέτοια κίνηση.
* Είναι μια σχέση ένα προς ένα μεταξύ του subnet και της υπηρεσίας Azure.
* Λιγότερο δαπανηρό από τα Private Links.

**Private Links:**

* Το Private Link χαρτογραφεί τις υπηρεσίες Azure στο VNet σας μέσω ενός ιδιωτικού endpoint, το οποίο είναι μια διεπαφή δικτύου με ιδιωτική διεύθυνση IP εντός του VNet σας.
* Η υπηρεσία Azure είναι προσβάσιμη χρησιμοποιώντας αυτήν την ιδιωτική διεύθυνση IP, κάνοντάς την να φαίνεται σαν να είναι μέρος του δικτύου σας.
* Οι υπηρεσίες που συνδέονται μέσω Private Link μπορούν να προσπελαστούν μόνο από το VNet σας ή συνδεδεμένα δίκτυα. Δεν υπάρχει πρόσβαση στο δημόσιο διαδίκτυο για την υπηρεσία.
* Επιτρέπει μια ασφαλή σύνδεση με τις υπηρεσίες Azure ή τις δικές σας υπηρεσίες που φιλοξενούνται στο Azure, καθώς και μια σύνδεση με υπηρεσίες που μοιράζονται άλλοι.
* Παρέχει πιο λεπτομερή έλεγχο πρόσβασης μέσω ενός ιδιωτικού endpoint στο VNet σας, σε αντίθεση με τον ευρύτερο έλεγχο πρόσβασης σε επίπεδο subnet με τα service endpoints.

Συνοψίζοντας, ενώ και τα Service Endpoints και τα Private Links παρέχουν ασφαλή συνδεσιμότητα στις υπηρεσίες Azure, **τα Private Links προσφέρουν υψηλότερο επίπεδο απομόνωσης και ασφάλειας διασφαλίζοντας ότι οι υπηρεσίες προσπελαύνονται ιδιωτικά χωρίς να εκτίθενται στο δημόσιο διαδίκτυο**. Τα Service Endpoints, από την άλλη, είναι ευκολότερα στη ρύθμιση για γενικές περιπτώσεις όπου απαιτείται απλή, ασφαλής πρόσβαση στις υπηρεσίες Azure χωρίς την ανάγκη για ιδιωτική IP στο VNet.

## Azure Front Door (AFD) & AFD WAF

Το **Azure Front Door** είναι ένα κλιμακούμενο και ασφαλές σημείο εισόδου για **γρήγορη παράδοση** των παγκόσμιων web εφαρμογών σας. **Συνδυάζει** διάφορες υπηρεσίες όπως **global load balancing, site acceleration, SSL offloading, και Web Application Firewall (WAF)** δυνατότητες σε μία υπηρεσία. Το Azure Front Door παρέχει έξυπνη δρομολόγηση με βάση την **πλησιέστερη τοποθεσία άκρης στον χρήστη**, διασφαλίζοντας βέλτιστη απόδοση και αξιοπιστία. Επιπλέον, προσφέρει δρομολόγηση βάσει URL, φιλοξενία πολλαπλών τοποθεσιών, συνεδριακή συγγένεια και ασφάλεια επιπέδου εφαρμογής.

Το **Azure Front Door WAF** έχει σχεδιαστεί για να **προστατεύει τις web εφαρμογές από επιθέσεις μέσω διαδικτύου** χωρίς τροποποίηση του κώδικα back-end. Περιλαμβάνει προσαρμοσμένους κανόνες και διαχειριζόμενα σύνολα κανόνων για την προστασία από απειλές όπως SQL injection, cross-site scripting, και άλλες κοινές επιθέσεις.

### **Παράδειγμα**

* Φανταστείτε ότι έχετε μια παγκοσμίως διανεμημένη εφαρμογή με χρήστες σε όλο τον κόσμο. Μπορείτε να χρησιμοποιήσετε το Azure Front Door για να **δρομολογήσετε τα αιτήματα των χρηστών στο πλησιέστερο περιφερειακό κέντρο δεδομένων** που φιλοξενεί την εφαρμογή σας, μειώνοντας έτσι την καθυστέρηση, βελτιώνοντας την εμπειρία του χρήστη και **προστατεύοντάς την από επιθέσεις μέσω διαδικτύου με τις δυνατότητες του WAF**. Εάν μια συγκεκριμένη περιοχή αντιμετωπίσει διακοπή λειτουργίας, το Azure Front Door μπορεί αυτόματα να αναδρομολογήσει την κίνηση στην επόμενη καλύτερη τοποθεσία, διασφαλίζοντας υψηλή διαθεσιμότητα.

### Enumeration

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway and Azure Application Gateway WAF

Το Azure Application Gateway είναι ένας **ισοζυγιστής φόρτου διαδικτυακής κίνησης** που σας επιτρέπει να διαχειρίζεστε την κίνηση προς τις **διαδικτυακές** εφαρμογές σας. Προσφέρει **ισοζύγιση φόρτου επιπέδου 7, τερματισμό SSL και δυνατότητες τείχους προστασίας διαδικτυακών εφαρμογών (WAF)** στην Υπηρεσία Παράδοσης Εφαρμογών (ADC). Τα βασικά χαρακτηριστικά περιλαμβάνουν δρομολόγηση βάσει URL, συνεδριακή συγγένεια βάσει cookies και εκφόρτωση ασφαλών υποδοχών (SSL), τα οποία είναι κρίσιμα για εφαρμογές που απαιτούν σύνθετες δυνατότητες ισοζύγισης φόρτου όπως παγκόσμια δρομολόγηση και δρομολόγηση βάσει διαδρομής.

### Παράδειγμα

* Σκεφτείτε ένα σενάριο όπου έχετε έναν ιστότοπο ηλεκτρονικού εμπορίου που περιλαμβάνει πολλαπλούς υποτομείς για διαφορετικές λειτουργίες, όπως λογαριασμούς χρηστών και επεξεργασία πληρωμών. Το Azure Application Gateway μπορεί να **δρομολογήσει την κίνηση στους κατάλληλους διακομιστές ιστού βάσει της διαδρομής URL**. Για παράδειγμα, η κίνηση προς `example.com/accounts` θα μπορούσε να κατευθυνθεί στην υπηρεσία λογαριασμών χρηστών, και η κίνηση προς `example.com/pay` θα μπορούσε να κατευθυνθεί στην υπηρεσία επεξεργασίας πληρωμών.\
Και **να προστατεύσετε τον ιστότοπό σας από επιθέσεις χρησιμοποιώντας τις δυνατότητες WAF.**

### **Απαρίθμηση**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** είναι μια δυνατότητα δικτύωσης στο Azure που **επιτρέπει τη σύνδεση διαφορετικών Virtual Networks (VNets) άμεσα και απρόσκοπτα**. Μέσω του VNet peering, οι πόροι σε ένα VNet μπορούν να επικοινωνούν με πόρους σε άλλο VNet χρησιμοποιώντας ιδιωτικές διευθύνσεις IP, **σαν να βρίσκονταν στο ίδιο δίκτυο**.\
**Το VNet Peering μπορεί επίσης να χρησιμοποιηθεί με δίκτυα on-prem** ρυθμίζοντας ένα site-to-site VPN ή Azure ExpressRoute.

**Azure Hub and Spoke** είναι μια τοπολογία δικτύου που χρησιμοποιείται στο Azure για τη διαχείριση και την οργάνωση της κυκλοφορίας δικτύου. **Το "hub" είναι ένα κεντρικό σημείο που ελέγχει και δρομολογεί την κυκλοφορία μεταξύ διαφορετικών "spokes"**. Το hub συνήθως περιέχει κοινές υπηρεσίες όπως network virtual appliances (NVAs), Azure VPN Gateway, Azure Firewall, ή Azure Bastion. Τα **"spokes" είναι VNets που φιλοξενούν φορτία εργασίας και συνδέονται με το hub χρησιμοποιώντας VNet peering**, επιτρέποντάς τους να αξιοποιούν τις κοινές υπηρεσίες εντός του hub. Αυτό το μοντέλο προάγει μια καθαρή διάταξη δικτύου, μειώνοντας την πολυπλοκότητα με την κεντροποίηση κοινών υπηρεσιών που μπορούν να χρησιμοποιηθούν από πολλαπλά φορτία εργασίας σε διαφορετικά VNets.

{% hint style="danger" %}
**Το VNET pairing δεν είναι μεταβατικό στο Azure**, που σημαίνει ότι αν το spoke 1 είναι συνδεδεμένο με το spoke 2 και το spoke 2 είναι συνδεδεμένο με το spoke 3, τότε το spoke 1 δεν μπορεί να επικοινωνήσει άμεσα με το spoke 3.
{% endhint %}

### Παραδείγματα

* Φανταστείτε μια εταιρεία με ξεχωριστά τμήματα όπως Πωλήσεις, Ανθρώπινοι Πόροι και Ανάπτυξη, **το καθένα με το δικό του VNet (τα spokes)**. Αυτά τα VNets **απαιτούν πρόσβαση σε κοινόχρηστους πόρους** όπως μια κεντρική βάση δεδομένων, ένα firewall και μια πύλη στο διαδίκτυο, που βρίσκονται όλα σε **άλλο VNet (το hub)**. Χρησιμοποιώντας το μοντέλο Hub and Spoke, κάθε τμήμα μπορεί **να συνδεθεί με ασφάλεια στους κοινόχρηστους πόρους μέσω του hub VNet χωρίς να εκθέτει αυτούς τους πόρους στο δημόσιο διαδίκτυο** ή να δημιουργεί μια πολύπλοκη δομή δικτύου με πολυάριθμες συνδέσεις.

### Απαρίθμηση

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Ένα Site-to-Site VPN στο Azure σας επιτρέπει να **συνδέσετε το τοπικό σας δίκτυο με το Azure Virtual Network (VNet)**, επιτρέποντας πόρους όπως VMs στο Azure να εμφανίζονται σαν να είναι στο τοπικό σας δίκτυο. Αυτή η σύνδεση καθιερώνεται μέσω ενός **VPN gateway που κρυπτογραφεί την κυκλοφορία** μεταξύ των δύο δικτύων.

### **Παράδειγμα**

* Μια επιχείρηση με το κύριο γραφείο της στη Νέα Υόρκη έχει ένα τοπικό κέντρο δεδομένων που χρειάζεται να συνδεθεί με ασφάλεια με το VNet της στο Azure, το οποίο φιλοξενεί τις εικονικοποιημένες εργασίες της. Με τη ρύθμιση ενός **Site-to-Site VPN, η εταιρεία μπορεί να εξασφαλίσει κρυπτογραφημένη συνδεσιμότητα μεταξύ των τοπικών servers και των Azure VMs**, επιτρέποντας την ασφαλή πρόσβαση στους πόρους και στα δύο περιβάλλοντα σαν να ήταν στο ίδιο τοπικό δίκτυο.

### **Απαρίθμηση**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Το Azure ExpressRoute είναι μια υπηρεσία που παρέχει μια **ιδιωτική, αποκλειστική, υψηλής ταχύτητας σύνδεση μεταξύ της υποδομής σας στις εγκαταστάσεις σας και των κέντρων δεδομένων του Azure**. Αυτή η σύνδεση γίνεται μέσω ενός παρόχου συνδεσιμότητας, παρακάμπτοντας το δημόσιο διαδίκτυο και προσφέροντας περισσότερη αξιοπιστία, ταχύτερες ταχύτητες, χαμηλότερες καθυστερήσεις και υψηλότερη ασφάλεια από τις τυπικές συνδέσεις στο διαδίκτυο.

### **Παράδειγμα**

* Μια πολυεθνική εταιρεία απαιτεί μια **συνεπή και αξιόπιστη σύνδεση με τις υπηρεσίες Azure της λόγω του μεγάλου όγκου δεδομένων** και της ανάγκης για υψηλή διαμετακόμιση. Η εταιρεία επιλέγει το Azure ExpressRoute για να συνδέσει άμεσα το κέντρο δεδομένων της στις εγκαταστάσεις της με το Azure, διευκολύνοντας τις μεγάλης κλίμακας μεταφορές δεδομένων, όπως καθημερινά αντίγραφα ασφαλείας και ανάλυση δεδομένων σε πραγματικό χρόνο, με αυξημένη ιδιωτικότητα και ταχύτητα.

### **Απαρίθμηση**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

{% hint style="success" %}
Μάθετε και εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε και εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Δείτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Γίνετε μέλος της** 💬 [**ομάδας Discord**](https://discord.gg/hRep4RUj7f) ή της [**ομάδας telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}
