# Az - Azure Network

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## Grundlegende Informationen

Netzwerke innerhalb von Azure fungieren als integraler Bestandteil seiner Cloud-Computing-Plattform und erm√∂glichen die **Verbindung und Kommunikation zwischen verschiedenen Azure-Diensten und -Ressourcen**. Die Netzwerkarchitektur in Azure ist darauf ausgelegt, hoch skalierbar, sicher und anpassbar zu sein.

Im Kern bietet Azure ein **virtuelles Netzwerk (VNet)**, das es Benutzern erm√∂glicht, **isolierte Netzwerke** innerhalb der Azure-Cloud zu erstellen. Innerhalb dieser VNets k√∂nnen Ressourcen wie virtuelle Maschinen, Anwendungen und Datenbanken sicher gehostet und verwaltet werden. Das Netzwerk in Azure unterst√ºtzt sowohl die Kommunikation innerhalb der Cloud (zwischen Azure-Diensten) als auch die Verbindung zu externen Netzwerken und dem Internet.

**Sicherheit** ist ein kritischer Aspekt des Azure-Netzwerks, mit verschiedenen Tools und Diensten zum Schutz von Daten, zur Verwaltung des Zugriffs und zur Gew√§hrleistung der Compliance. Diese Sicherheitsma√ünahmen umfassen **Firewalls**, **Netzwerksicherheitsgruppen** und **Verschl√ºsselungsf√§higkeiten**, die ein hohes Ma√ü an Kontrolle √ºber den Datenverkehr und den Zugriff erm√∂glichen.

Insgesamt sind die Netzwerkkapazit√§ten von Azure darauf ausgelegt, Flexibilit√§t zu bieten, sodass Benutzer eine Netzwerkumgebung erstellen k√∂nnen, die ihren spezifischen Anwendungs- und Arbeitslastanforderungen entspricht, w√§hrend gleichzeitig ein starker Fokus auf Sicherheit und Zuverl√§ssigkeit gelegt wird.

## Virtuelles Netzwerk (VNET) & Subnetze

Ein VNet in Azure ist im Wesentlichen eine Darstellung Ihres eigenen Netzwerks in der Cloud. Es ist eine **logische Isolation der Azure-Cloud, die Ihrem Abonnement gewidmet ist**. Ein VNet erm√∂glicht es Ihnen, virtuelle private Netzwerke (VPNs) in Azure bereitzustellen und zu verwalten und kann verwendet werden, um **verschiedene Arten von Azure-Ressourcen zu hosten und zu verwalten**, wie virtuelle Maschinen (VMs), Datenbanken und Anwendungsdienste.

VNets bieten Ihnen **volle Kontrolle √ºber Ihre Netzwerkeinstellungen**, einschlie√ülich **IP-Adressbereiche**, Subnetz-Erstellung, Routentabellen und Netzwerk-Gateways.

Ein **Subnetz** ist ein **Bereich von IP-Adressen in Ihrem VNet**. Sie k√∂nnen ein VNet in mehrere Subnetze unterteilen, um Organisation und Sicherheit zu gew√§hrleisten. Jedes Subnetz in einem VNet kann verwendet werden, um Ressourcen gem√§√ü Ihrer Netzwerk- und Anwendungsarchitektur zu isolieren und zu gruppieren.

Dar√ºber hinaus erm√∂glichen Subnetze, Ihr VNet in ein oder mehrere Teilnetzwerke zu segmentieren, die einen Bereich von IP-Adressen bereitstellen, die Ressourcen verwenden k√∂nnen.

### **Beispiel**

* Angenommen, Sie haben ein VNet namens `MyVNet` mit einem IP-Adressbereich von `10.0.0.0/16`. Sie k√∂nnen ein Subnetz innerhalb dieses VNets erstellen, sagen wir `Subnet-1`, mit einem IP-Adressbereich von `10.0.0.0/24` f√ºr das Hosting Ihrer Webserver. Ein weiteres Subnetz, `Subnet-2` mit einem Bereich von `10.0.1.0/24`, k√∂nnte f√ºr Ihre Datenbankserver verwendet werden. Diese Segmentierung erm√∂glicht eine effiziente Verwaltung und Sicherheitskontrollen innerhalb des Netzwerks.

### Aufz√§hlung

Um alle VNets und Subnetze in einem Azure-Konto aufzulisten, k√∂nnen Sie die Azure Command-Line Interface (CLI) verwenden. Hier sind die Schritte:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Network Security Groups (NSG)

In Azure dient eine **Network Security Group (NSG)** der Hauptfunktion, den Netzwerkverkehr sowohl zu als auch von Azure-Ressourcen innerhalb eines Azure Virtual Network (VNet) zu filtern. Sie enth√§lt eine Reihe von **Sicherheitsregeln**, die den Netzwerkverkehr genau vorschreiben.

Wichtige Aspekte der NSG umfassen:

* **Verkehrskontrolle**: Jede NSG enth√§lt Regeln, die entscheidend sind, um eingehenden und ausgehenden Netzwerkverkehr, der mit verschiedenen Azure-Ressourcen verbunden ist, entweder zuzulassen oder zu blockieren.
* **Regelkomponenten**: Die Regeln innerhalb einer NSG sind sehr spezifisch und filtern den Verkehr basierend auf Kriterien wie Quell-/Ziel-IP-Adresse, Port und Protokoll. Diese Spezifit√§t erm√∂glicht eine granulare Verwaltung des Netzwerkverkehrs.
* **Sicherheitsverbesserung**: Durch die Gew√§hrleistung, dass nur autorisierter Verkehr Ihre Azure-Ressourcen betreten oder verlassen kann, spielen NSGs eine entscheidende Rolle bei der St√§rkung der Sicherheitslage Ihrer Netzwerk-Infrastruktur.

### **Beispiel**

* Stellen Sie sich vor, Sie haben eine NSG namens `MyNSG`, die auf ein Subnetz oder eine bestimmte virtuelle Maschine innerhalb Ihres VNet angewendet wird. Sie k√∂nnen Regeln erstellen wie:
* Eine eingehende Regel, die HTTP-Verkehr (Port 80) von jeder Quelle zu Ihren Webservern zul√§sst.
* Eine ausgehende Regel, die nur SQL-Verkehr (Port 1433) zu einem bestimmten Ziel-IP-Adressbereich zul√§sst.

### Enumeration

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Azure Firewall ist ein verwalteter, cloudbasierter **Netzwerksicherheitsdienst, der Ihre Azure Virtual Network-Ressourcen sch√ºtzt**. Es ist eine vollst√§ndig zustandsbehaftete Firewall als Dienst mit integrierten Hochverf√ºgbarkeits- und Skalierbarkeitsfunktionen.

Azure Firewall bietet **fortschrittlichere** Funktionen als **NSGs**, einschlie√ülich **Anwendungsfilterung**, Netzwerkfilterung, Bedrohungsintelligenz-basierte Filterung und Integration mit Azure Monitor f√ºr Protokollierung und Analysen.\
Es kann ausgehenden, eingehenden, spoke-to-spoke, VPN- und ExpressRoute-Verkehr filtern. **Firewall-Regeln k√∂nnen basierend auf FQDN (Fully Qualified Domain Name), IP-Adressen und Ports erstellt werden**.

### Unterschiede zwischen Azure Firewall und NSGs

1. **Umfang:**
* **NSG:** Arbeitet auf Subnetz- oder Netzwerkschnittstellenebene. Es soll eine grundlegende Filterung des eingehenden und ausgehenden Datenverkehrs von Netzwerkschnittstellen (NIC), VMs oder Subnetzen bieten.
* **Azure Firewall:** Arbeitet auf VNet-Ebene und bietet einen breiteren Schutzumfang. Es ist darauf ausgelegt, Ihre virtuellen Netzwerkressourcen zu sichern und den Datenverkehr, der in und aus dem VNet flie√üt, zu verwalten.
2. **F√§higkeiten:**
* **NSG:** Bietet grundlegende Filterfunktionen basierend auf IP-Adresse, Port und Protokoll. Es unterst√ºtzt keine erweiterten Funktionen wie Anwendungsinspektion oder Bedrohungsintelligenz.
* **Azure Firewall:** Bietet erweiterte Funktionen wie Anwendungsfilterung (Layer 7), Bedrohungsintelligenz-basierte Filterung, Netzwerkverkehrsfilterung und mehr. Es unterst√ºtzt auch mehrere √∂ffentliche IP-Adressen.
3. **Anwendungsf√§lle:**
* **NSG:** Ideal f√ºr grundlegende Netzwerkverkehrsfilterung.
* **Azure Firewall:** Geeignet f√ºr komplexere Filterungsszenarien, bei denen Anwendungssteuerung, Protokollierung und Bedrohungsintelligenz erforderlich sind.
4. **Verwaltung und √úberwachung:**
* **NSG:** Bietet grundlegende Protokollierung und Integration mit Azure Monitor.
* **Azure Firewall:** Bietet erweiterte Protokollierungs- und Analysefunktionen √ºber Azure Monitor, was f√ºr das Verst√§ndnis der Art und des Musters des Datenverkehrs unerl√§sslich ist.

### Enumeration

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Network Virtual Appliance (NVA)

Ein Network Virtual Appliance (**NVA**) in Azure ist ein virtuelles Ger√§t, das **Netzwerkfunktionen innerhalb eines virtuellen Netzwerks ausf√ºhrt**. NVAs werden typischerweise f√ºr Netzwerkfunktionen verwendet, die **nicht nativ in Azure verf√ºgbar** sind oder wenn mehr Anpassung erforderlich ist. Sie sind im Wesentlichen **VMs, die Netzwerk-Anwendungen oder -Dienste ausf√ºhren**, wie Firewalls, WAN-Optimierer oder Load Balancer.

NVAs werden f√ºr komplexe Routing-, **Sicherheits-** und **Netzwerkverkehrsmanagement**-Aufgaben verwendet. Sie k√∂nnen aus dem Azure **Marketplace** bereitgestellt werden, wo viele Drittanbieter ihre Appliances zur Integration in Azure-Umgebungen anbieten.

### **Beispiel**

* Eine Organisation kann ein NVA in Azure bereitstellen, um eine **benutzerdefinierte Firewall-L√∂sung** zu erstellen. Dieses NVA k√∂nnte eine **Drittanbieter-Firewall-Software** ausf√ºhren, die erweiterte Funktionen wie Intrusion Detection, Paketinspektion oder VPN-Konnektivit√§t bietet. Das NVA kann so konfiguriert werden, dass es den durchlaufenden Datenverkehr inspiziert und filtert, um sicherzustellen, dass erweiterte Sicherheitsma√ünahmen gem√§√ü den Richtlinien der Organisation vorhanden sind.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Azure Route Tables & User Defined Routes (UDR)

**Azure Route Tables** sind eine Funktion innerhalb von Microsoft Azure, die die **Kontrolle des Netzwerkverkehrs innerhalb von Azure Virtual Networks (VNets)** erm√∂glicht. Im Wesentlichen definieren sie, wie **Pakete** **zwischen Subnetzen innerhalb von VNets, zwischen VNets oder zu externen Netzwerken weitergeleitet** werden. Jede Routentabelle enth√§lt eine Reihe von Regeln, die als Routen bekannt sind und festlegen, wie Pakete basierend auf ihren Ziel-IP-Adressen weitergeleitet werden sollen.

**User Defined Routes (UDR)** in Azure sind **benutzerdefinierte Routen, die Sie innerhalb von Azure Route Tables erstellen**, um den **Fluss des Netzwerkverkehrs** innerhalb und zwischen Azure Virtual Networks (VNets) und zu externen Verbindungen zu steuern. UDRs bieten Ihnen die Flexibilit√§t, den Netzwerkverkehr gem√§√ü Ihren spezifischen Anforderungen zu lenken und die standardm√§√üigen Routing-Entscheidungen von Azure zu √ºberschreiben.

Diese Routen sind besonders n√ºtzlich in Szenarien, in denen Sie den **Verkehr durch ein virtuelles Ger√§t leiten**, einen bestimmten Pfad aus Sicherheits- oder Richtliniengr√ºnden erzwingen oder mit lokalen Netzwerken integrieren m√ºssen.

### **Beispiel**

* Angenommen, Sie haben ein Network Virtual Appliance (NVA) bereitgestellt, um den Verkehr zwischen Subnetzen innerhalb eines VNet zu inspizieren. Sie k√∂nnen eine UDR erstellen, die den gesamten Verkehr von einem Subnetz zu einem anderen Subnetz durch das NVA leitet. Diese UDR stellt sicher, dass das NVA den Verkehr aus Sicherheitsgr√ºnden inspiziert, bevor er sein Ziel erreicht.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link ist ein Dienst in Azure, der **privaten Zugriff auf Azure-Dienste erm√∂glicht**, indem er sicherstellt, dass **der Datenverkehr zwischen Ihrem Azure Virtual Network (VNet) und dem Dienst vollst√§ndig innerhalb des Azure-Backbone-Netzwerks von Microsoft bleibt**. Es bringt den Dienst effektiv in Ihr VNet. Diese Konfiguration erh√∂ht die Sicherheit, indem die Daten nicht dem √∂ffentlichen Internet ausgesetzt werden.

Private Link kann mit verschiedenen Azure-Diensten verwendet werden, wie Azure Storage, Azure SQL Database und benutzerdefinierten Diensten, die √ºber Private Link geteilt werden. Es bietet eine sichere M√∂glichkeit, Dienste innerhalb Ihres eigenen VNets oder sogar aus verschiedenen Azure-Abonnements zu nutzen.

{% hint style="danger" %}
NSGs gelten nicht f√ºr private Endpunkte, was eindeutig bedeutet, dass die Zuordnung eines NSG zu einem Subnetz, das den Private Link enth√§lt, keine Wirkung hat.
{% endhint %}

### **Beispiel**

* Betrachten Sie ein Szenario, in dem Sie eine **Azure SQL Database sicher von Ihrem VNet aus zugreifen m√∂chten**. Normalerweise k√∂nnte dies den √∂ffentlichen Internetverkehr umfassen. Mit Private Link k√∂nnen Sie einen **privaten Endpunkt in Ihrem VNet erstellen**, der direkt mit dem Azure SQL Database-Dienst verbunden ist. Dieser Endpunkt l√§sst die Datenbank so erscheinen, als w√§re sie Teil Ihres eigenen VNets, zug√§nglich √ºber eine private IP-Adresse, und gew√§hrleistet so einen sicheren und privaten Zugriff.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Azure Service Endpoints

Azure Service Endpoints erweitern den privaten Adressraum Ihres virtuellen Netzwerks und die Identit√§t Ihres VNet zu Azure-Diensten √ºber eine direkte Verbindung. Durch das Aktivieren von Service-Endpunkten k√∂nnen **Ressourcen in Ihrem VNet sicher mit Azure-Diensten** wie Azure Storage und Azure SQL Database √ºber das Backbone-Netzwerk von Azure verbinden. Dies stellt sicher, dass der **Datenverkehr vom VNet zum Azure-Dienst innerhalb des Azure-Netzwerks bleibt**, was einen sichereren und zuverl√§ssigeren Pfad bietet.

### **Beispiel**

* Zum Beispiel ist ein **Azure Storage**-Konto standardm√§√üig √ºber das √∂ffentliche Internet zug√§nglich. Durch das Aktivieren eines **Service-Endpunkts f√ºr Azure Storage innerhalb Ihres VNet** k√∂nnen Sie sicherstellen, dass nur Datenverkehr von Ihrem VNet auf das Speicherkonto zugreifen kann. Die Firewall des Speicherkontos kann dann so konfiguriert werden, dass sie nur Datenverkehr von Ihrem VNet akzeptiert.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Unterschiede zwischen Service Endpoints und Private Links

Microsoft empfiehlt die Verwendung von Private Links in den [**Dokumentationen**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\\

<figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Service Endpoints:**

* Der Datenverkehr von Ihrem VNet zum Azure-Dienst erfolgt √ºber das Microsoft Azure-Backbone-Netzwerk und umgeht das √∂ffentliche Internet.
* Der Endpoint ist eine direkte Verbindung zum Azure-Dienst und stellt keine private IP f√ºr den Dienst innerhalb des VNet bereit.
* Der Dienst selbst ist weiterhin √ºber seinen √∂ffentlichen Endpoint von au√üerhalb Ihres VNet zug√§nglich, es sei denn, Sie konfigurieren die Dienst-Firewall so, dass solcher Datenverkehr blockiert wird.
* Es besteht eine Eins-zu-Eins-Beziehung zwischen dem Subnetz und dem Azure-Dienst.
* G√ºnstiger als Private Links.

**Private Links:**

* Private Link ordnet Azure-Dienste √ºber einen privaten Endpoint, der eine Netzwerkschnittstelle mit einer privaten IP-Adresse innerhalb Ihres VNet ist, Ihrem VNet zu.
* Der Azure-Dienst wird √ºber diese private IP-Adresse aufgerufen, wodurch er so erscheint, als w√§re er Teil Ihres Netzwerks.
* Dienste, die √ºber Private Link verbunden sind, k√∂nnen nur von Ihrem VNet oder verbundenen Netzwerken aus aufgerufen werden; es gibt keinen √∂ffentlichen Internetzugang zum Dienst.
* Es erm√∂glicht eine sichere Verbindung zu Azure-Diensten oder Ihren eigenen in Azure gehosteten Diensten sowie eine Verbindung zu von anderen geteilten Diensten.
* Es bietet eine granularere Zugriffskontrolle √ºber einen privaten Endpoint in Ihrem VNet im Gegensatz zu einer breiteren Zugriffskontrolle auf Subnetzebene mit Service Endpoints.

Zusammenfassend l√§sst sich sagen, dass sowohl Service Endpoints als auch Private Links eine sichere Konnektivit√§t zu Azure-Diensten bieten, **Private Links jedoch ein h√∂heres Ma√ü an Isolation und Sicherheit bieten, indem sie sicherstellen, dass Dienste privat aufgerufen werden, ohne sie dem √∂ffentlichen Internet auszusetzen**. Service Endpoints hingegen sind einfacher einzurichten f√ºr allgemeine F√§lle, in denen ein einfacher, sicherer Zugriff auf Azure-Dienste erforderlich ist, ohne dass eine private IP im VNet ben√∂tigt wird.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** ist ein skalierbarer und sicherer Einstiegspunkt f√ºr die **schnelle Bereitstellung** Ihrer globalen Webanwendungen. Es **kombiniert** verschiedene Dienste wie globales **Load Balancing, Site-Beschleunigung, SSL-Offloading und Web Application Firewall (WAF)**-Funktionen in einem einzigen Dienst. Azure Front Door bietet intelligentes Routing basierend auf dem **n√§chstgelegenen Edge-Standort zum Benutzer**, um optimale Leistung und Zuverl√§ssigkeit zu gew√§hrleisten. Dar√ºber hinaus bietet es URL-basiertes Routing, Hosting mehrerer Sites, Sitzungsaffinit√§t und Sicherheit auf Anwendungsebene.

**Azure Front Door WAF** ist darauf ausgelegt, **Webanwendungen vor web-basierten Angriffen zu sch√ºtzen**, ohne den Backend-Code zu √§ndern. Es umfasst benutzerdefinierte Regeln und verwaltete Regelsets, um Bedrohungen wie SQL-Injection, Cross-Site-Scripting und andere h√§ufige Angriffe abzuwehren.

### **Beispiel**

* Stellen Sie sich vor, Sie haben eine global verteilte Anwendung mit Benutzern auf der ganzen Welt. Sie k√∂nnen Azure Front Door verwenden, um **Benutzeranfragen zum n√§chstgelegenen regionalen Rechenzentrum** zu leiten, das Ihre Anwendung hostet, wodurch die Latenz verringert, die Benutzererfahrung verbessert und **die Anwendung mit den WAF-Funktionen vor Webangriffen gesch√ºtzt** wird. Wenn eine bestimmte Region einen Ausfall erlebt, kann Azure Front Door den Datenverkehr automatisch zum n√§chstbesten Standort umleiten, um eine hohe Verf√ºgbarkeit sicherzustellen.

### Enumeration

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway und Azure Application Gateway WAF

Azure Application Gateway ist ein **Web-Traffic-Load-Balancer**, der es Ihnen erm√∂glicht, den Traffic zu Ihren **Web**-Anwendungen zu verwalten. Es bietet **Layer-7-Load-Balancing, SSL-Termination und Web Application Firewall (WAF) F√§higkeiten** im Application Delivery Controller (ADC) als Service. Wichtige Funktionen umfassen URL-basiertes Routing, Cookie-basierte Sitzungsaffinit√§t und Secure Sockets Layer (SSL) Offloading, die f√ºr Anwendungen, die komplexe Load-Balancing-F√§higkeiten wie globales Routing und pfadbasiertes Routing erfordern, entscheidend sind.

### Beispiel

* Betrachten Sie ein Szenario, in dem Sie eine E-Commerce-Website haben, die mehrere Subdomains f√ºr verschiedene Funktionen umfasst, wie Benutzerkonten und Zahlungsabwicklung. Azure Application Gateway kann **Traffic basierend auf dem URL-Pfad zu den entsprechenden Webservern routen**. Zum Beispiel k√∂nnte Traffic zu `example.com/accounts` zum Benutzerkonten-Service geleitet werden, und Traffic zu `example.com/pay` k√∂nnte zum Zahlungsabwicklungs-Service geleitet werden.\
Und **sch√ºtzen Sie Ihre Website vor Angriffen mit den WAF-F√§higkeiten.**

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** ist eine Netzwerkfunktion in Azure, die **es erm√∂glicht, verschiedene Virtual Networks (VNets) direkt und nahtlos zu verbinden**. Durch VNet Peering k√∂nnen Ressourcen in einem VNet mit Ressourcen in einem anderen VNet unter Verwendung privater IP-Adressen kommunizieren, **als ob sie sich im selben Netzwerk bef√§nden**.\
**VNet Peering kann auch mit On-Prem-Netzwerken verwendet werden**, indem ein Site-to-Site-VPN oder Azure ExpressRoute eingerichtet wird.

**Azure Hub and Spoke** ist eine Netzwerktopologie, die in Azure verwendet wird, um den Netzwerkverkehr zu verwalten und zu organisieren. **Der "Hub" ist ein zentraler Punkt, der den Verkehr zwischen verschiedenen "Spokes" steuert und routet**. Der Hub enth√§lt typischerweise gemeinsame Dienste wie Network Virtual Appliances (NVAs), Azure VPN Gateway, Azure Firewall oder Azure Bastion. Die **"Spokes" sind VNets, die Workloads hosten und sich √ºber VNet Peering mit dem Hub verbinden**, wodurch sie die gemeinsamen Dienste im Hub nutzen k√∂nnen. Dieses Modell f√∂rdert eine saubere Netzwerkstruktur und reduziert die Komplexit√§t, indem gemeinsame Dienste zentralisiert werden, die von mehreren Workloads in verschiedenen VNets genutzt werden k√∂nnen.

{% hint style="danger" %}
**VNET Peering ist in Azure nicht transitiv**, was bedeutet, dass wenn Spoke 1 mit Spoke 2 verbunden ist und Spoke 2 mit Spoke 3 verbunden ist, Spoke 1 nicht direkt mit Spoke 3 kommunizieren kann.
{% endhint %}

### Beispiele

* Stellen Sie sich ein Unternehmen mit separaten Abteilungen wie Vertrieb, Personalwesen und Entwicklung vor, **jede mit ihrem eigenen VNet (den Spokes)**. Diese VNets **ben√∂tigen Zugriff auf gemeinsame Ressourcen** wie eine zentrale Datenbank, eine Firewall und ein Internet-Gateway, die sich alle in **einem anderen VNet (dem Hub)** befinden. Durch die Verwendung des Hub-and-Spoke-Modells kann jede Abteilung **sicher auf die gemeinsamen Ressourcen √ºber das Hub-VNet zugreifen, ohne diese Ressourcen dem √∂ffentlichen Internet auszusetzen** oder eine komplexe Netzwerkstruktur mit zahlreichen Verbindungen zu erstellen.

### Enumeration

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Ein Site-to-Site VPN in Azure erm√∂glicht es Ihnen, **Ihr lokales Netzwerk mit Ihrem Azure Virtual Network (VNet) zu verbinden**, sodass Ressourcen wie VMs in Azure erscheinen, als w√§ren sie in Ihrem lokalen Netzwerk. Diese Verbindung wird durch ein **VPN-Gateway hergestellt, das den Datenverkehr zwischen den beiden Netzwerken verschl√ºsselt**.

### **Beispiel**

* Ein Unternehmen mit Hauptsitz in New York hat ein lokales Rechenzentrum, das sicher mit seinem VNet in Azure verbunden werden muss, das seine virtualisierten Workloads hostet. Durch die Einrichtung eines **Site-to-Site VPN kann das Unternehmen eine verschl√ºsselte Verbindung zwischen den lokalen Servern und den Azure VMs sicherstellen**, sodass Ressourcen sicher in beiden Umgebungen zugegriffen werden k√∂nnen, als w√§ren sie im selben lokalen Netzwerk.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute ist ein Dienst, der eine **private, dedizierte, hochgeschwindigkeits Verbindung zwischen Ihrer lokalen Infrastruktur und Azure-Rechenzentren** bietet. Diese Verbindung wird √ºber einen Konnektivit√§tsanbieter hergestellt, der das √∂ffentliche Internet umgeht und mehr Zuverl√§ssigkeit, h√∂here Geschwindigkeiten, geringere Latenzen und h√∂here Sicherheit als typische Internetverbindungen bietet.

### **Beispiel**

* Ein multinationales Unternehmen ben√∂tigt eine **konsistente und zuverl√§ssige Verbindung zu seinen Azure-Diensten aufgrund des hohen Datenvolumens** und des Bedarfs an hoher Durchsatzrate. Das Unternehmen entscheidet sich f√ºr Azure ExpressRoute, um sein lokales Rechenzentrum direkt mit Azure zu verbinden, was gro√ü angelegte Daten√ºbertragungen wie t√§gliche Backups und Echtzeit-Datenanalysen mit erh√∂hter Privatsph√§re und Geschwindigkeit erleichtert.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
