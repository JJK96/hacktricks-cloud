# Az - Azure Network

{% hint style="success" %}
Aprende y practica AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Informaci칩n B치sica

Las redes dentro de Azure funcionan como una parte integral de su plataforma de computaci칩n en la nube, permitiendo la **conexi칩n y comunicaci칩n entre varios servicios y recursos de Azure**. La arquitectura de red en Azure est치 dise침ada para ser altamente escalable, segura y personalizable.

En su n칰cleo, Azure proporciona una **red virtual (VNet)** que permite a los usuarios crear **redes aisladas** dentro de la nube de Azure. Dentro de estas VNets, se pueden alojar y gestionar de manera segura recursos como m치quinas virtuales, aplicaciones y bases de datos. La red en Azure soporta tanto la comunicaci칩n dentro de la nube (entre servicios de Azure) como la conexi칩n a redes externas e internet.

La **seguridad** es un aspecto cr칤tico de la red en Azure, con varias herramientas y servicios disponibles para proteger datos, gestionar el acceso y asegurar el cumplimiento. Estas medidas de seguridad incluyen **firewalls**, **grupos de seguridad de red** y capacidades de **encriptaci칩n**, permitiendo un alto nivel de control sobre el tr치fico y el acceso.

En general, las capacidades de red de Azure est치n dise침adas para ofrecer flexibilidad, permitiendo a los usuarios crear un entorno de red que se adapte a sus necesidades espec칤ficas de aplicaci칩n y carga de trabajo, manteniendo un fuerte 칠nfasis en la seguridad y la fiabilidad.

## Red Virtual (VNET) y Subredes

Una VNet en Azure es esencialmente una representaci칩n de tu propia red en la nube. Es un **aislamiento l칩gico de la nube de Azure dedicado a tu suscripci칩n**. Una VNet te permite aprovisionar y gestionar redes privadas virtuales (VPNs) en Azure y puede ser utilizada para alojar y **gestionar m칰ltiples tipos de recursos de Azure**, como M치quinas Virtuales (VMs), bases de datos y servicios de aplicaciones.

Las VNets te proporcionan **control total sobre la configuraci칩n de tu red**, incluyendo rangos de **direcciones IP**, creaci칩n de subredes, tablas de rutas y puertas de enlace de red.

Una **subred** es un **rango de direcciones IP en tu VNet**. Puedes dividir una VNet en m칰ltiples subredes para organizaci칩n y seguridad. Cada subred en una VNet puede ser utilizada para aislar y agrupar recursos de acuerdo a tu arquitectura de red y aplicaci칩n.

Adem치s, las subredes te permiten **segmentar tu VNet en una o m치s sub-redes**, proporcionando un rango de direcciones IP que los recursos pueden usar.

### **Ejemplo**

* Supongamos que tienes una VNet llamada `MyVNet` con un rango de direcciones IP de `10.0.0.0/16`. Puedes crear una subred dentro de esta VNet, digamos `Subnet-1`, con un rango de direcciones IP de `10.0.0.0/24` para alojar tus servidores web. Otra subred, `Subnet-2` con un rango de `10.0.1.0/24`, podr칤a ser utilizada para tus servidores de bases de datos. Esta segmentaci칩n permite una gesti칩n eficiente y controles de seguridad dentro de la red.

### Enumeraci칩n

Para listar todas las VNets y subredes en una cuenta de Azure, puedes usar la Interfaz de L칤nea de Comandos de Azure (CLI). Aqu칤 est치n los pasos:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Network Security Groups (NSG)

En Azure, un **Network Security Group (NSG)** tiene la funci칩n principal de filtrar el tr치fico de red tanto hacia como desde los recursos de Azure dentro de una Azure Virtual Network (VNet). Contiene un conjunto de **reglas de seguridad** que dictan meticulosamente el flujo del tr치fico de red.

Aspectos clave de NSG incluyen:

* **Control de Tr치fico**: Cada NSG contiene reglas que son fundamentales para permitir o bloquear el tr치fico de red entrante y saliente asociado con varios recursos de Azure.
* **Componentes de las Reglas**: Las reglas dentro de un NSG son altamente espec칤ficas, filtrando el tr치fico basado en criterios como la direcci칩n IP de origen/destino, puerto y protocolo. Esta especificidad permite una gesti칩n granular del tr치fico de red.
* **Mejora de la Seguridad**: Al asegurar que solo el tr치fico autorizado pueda entrar o salir de tus recursos de Azure, los NSG juegan un papel crucial en fortalecer la postura de seguridad de tu infraestructura de red.

### **Ejemplo**

* Imagina que tienes un NSG llamado `MyNSG` aplicado a una subred o a una m치quina virtual espec칤fica dentro de tu VNet. Puedes crear reglas como:
* Una regla entrante que permita el tr치fico HTTP (puerto 80) desde cualquier origen a tus servidores web.
* Una regla saliente que permita solo el tr치fico SQL (puerto 1433) a un rango espec칤fico de direcciones IP de destino.

### Enumeraci칩n

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Azure Firewall es un **servicio de seguridad de red gestionado y basado en la nube que protege tus recursos de Azure Virtual Network**. Es un firewall completamente con estado como servicio con caracter칤sticas integradas de alta disponibilidad y escalabilidad.

Azure Firewall proporciona caracter칤sticas **m치s avanzadas** que **NSGs**, incluyendo **filtrado a nivel de aplicaci칩n**, filtrado a nivel de red, filtrado basado en inteligencia de amenazas e integraci칩n con Azure Monitor para registro y an치lisis.\
Puede filtrar tr치fico saliente, entrante, de spoke a spoke, VPN y ExpressRoute. **Las reglas del firewall se pueden crear basadas en FQDN (Fully Qualified Domain Name), direcciones IP y puertos**.

### Diferencias entre Azure Firewall y NSGs

1. **Alcance:**
* **NSG:** Funciona a nivel de subred o interfaz de red. Est치 destinado a proporcionar filtrado b치sico del tr치fico entrante y saliente desde interfaces de red (NIC), VMs o subredes.
* **Azure Firewall:** Opera a nivel de VNet, proporcionando un alcance de protecci칩n m치s amplio. Est치 dise침ado para asegurar tus recursos de red virtual y gestionar el tr치fico que fluye dentro y fuera de la VNet.
2. **Capacidades:**
* **NSG:** Proporciona capacidades de filtrado b치sicas basadas en direcci칩n IP, puerto y protocolo. No soporta caracter칤sticas avanzadas como inspecci칩n a nivel de aplicaci칩n o inteligencia de amenazas.
* **Azure Firewall:** Ofrece caracter칤sticas avanzadas como filtrado de tr치fico a nivel de aplicaci칩n (Capa 7), filtrado basado en inteligencia de amenazas, filtrado de tr치fico de red y m치s. Tambi칠n soporta m칰ltiples direcciones IP p칰blicas.
3. **Casos de Uso:**
* **NSG:** Ideal para filtrado de tr치fico a nivel de red b치sico.
* **Azure Firewall:** Adecuado para escenarios de filtrado m치s complejos donde se necesita control a nivel de aplicaci칩n, registro e inteligencia de amenazas.
4. **Gesti칩n y Monitoreo:**
* **NSG:** Ofrece registro b치sico e integraci칩n con Azure Monitor.
* **Azure Firewall:** Proporciona capacidades avanzadas de registro y an치lisis a trav칠s de Azure Monitor, lo cual es esencial para entender la naturaleza y el patr칩n del tr치fico.

### Enumeraci칩n

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Network Virtual Appliance (NVA)

Un Network Virtual Appliance (**NVA**) en Azure es un appliance virtual que **realiza funciones de red dentro de una red virtual**. Los NVAs se utilizan t칤picamente para funciones de red que **no est치n disponibles de forma nativa** en Azure o cuando se requiere m치s personalizaci칩n. Esencialmente son **VMs que ejecutan aplicaciones o servicios de red**, como firewalls, optimizadores WAN o balanceadores de carga.

Los NVAs se utilizan para tareas complejas de enrutamiento, **seguridad** y **gesti칩n del tr치fico de red**. Pueden ser desplegados desde Azure **Marketplace**, donde muchos proveedores de terceros ofrecen sus appliances listos para integrarse en entornos de Azure.

### **Ejemplo**

* Una organizaci칩n puede desplegar un NVA en Azure para crear una **soluci칩n de firewall personalizada**. Este NVA podr칤a ejecutar un **software de firewall de terceros**, proporcionando caracter칤sticas avanzadas como detecci칩n de intrusiones, inspecci칩n de paquetes o conectividad VPN. El NVA puede ser configurado para inspeccionar y filtrar el tr치fico que pasa a trav칠s de 칠l, asegurando que se implementen medidas de seguridad mejoradas seg칰n las pol칤ticas de la organizaci칩n.

### **Enumeraci칩n**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Azure Route Tables & User Defined Routes (UDR)

**Azure Route Tables** son una caracter칤stica dentro de Microsoft Azure que permite el **control del enrutamiento del tr치fico de red dentro de Azure Virtual Networks (VNets)**. Esencialmente, definen c칩mo se **reenv칤an los paquetes** entre subredes dentro de VNets, entre VNets o hacia redes externas. Cada tabla de rutas contiene un conjunto de reglas, conocidas como rutas, que especifican c칩mo deben ser enrutados los paquetes bas치ndose en sus direcciones IP de destino.

**User Defined Routes (UDR)** en Azure son **rutas personalizadas que creas dentro de Azure Route Tables** para controlar el **flujo del tr치fico de red** dentro y entre Azure Virtual Networks (VNets), y hacia conexiones externas. Los UDR te dan la flexibilidad de dirigir el tr치fico de red seg칰n tus requisitos espec칤ficos, anulando las decisiones de enrutamiento predeterminadas de Azure.

Estas rutas son particularmente 칰tiles para escenarios donde necesitas **enrutar el tr치fico a trav칠s de un appliance virtual**, imponer un camino espec칤fico por razones de seguridad o cumplimiento de pol칤ticas, o integrarte con redes locales.

### **Ejemplo**

* Supongamos que has desplegado un Network Virtual Appliance (NVA) para inspeccionar el tr치fico entre subredes dentro de un VNet. Puedes crear un UDR que dirija todo el tr치fico de una subred a otra subred a trav칠s del NVA. Este UDR asegura que el NVA inspeccione el tr치fico por razones de seguridad antes de que llegue a su destino.

### **Enumeraci칩n**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link es un servicio en Azure que **habilita el acceso privado a servicios de Azure** asegurando que **el tr치fico entre tu red virtual de Azure (VNet) y el servicio viaje completamente dentro de la red backbone de Azure de Microsoft**. Efectivamente, trae el servicio a tu VNet. Esta configuraci칩n mejora la seguridad al no exponer los datos a internet p칰blico.

Private Link se puede usar con varios servicios de Azure, como Azure Storage, Azure SQL Database y servicios personalizados compartidos a trav칠s de Private Link. Proporciona una forma segura de consumir servicios desde dentro de tu propia VNet o incluso desde diferentes suscripciones de Azure.

{% hint style="danger" %}
NSGs no se aplican a endpoints privados, lo que claramente significa que asociar un NSG con una subred que contiene el Private Link no tendr치 efecto.
{% endhint %}

### **Ejemplo**

* Considera un escenario donde tienes una **Azure SQL Database a la que quieres acceder de manera segura desde tu VNet**. Normalmente, esto podr칤a implicar atravesar internet p칰blico. Con Private Link, puedes crear un **endpoint privado en tu VNet** que se conecta directamente al servicio de Azure SQL Database. Este endpoint hace que la base de datos parezca como si fuera parte de tu propia VNet, accesible a trav칠s de una direcci칩n IP privada, asegurando as칤 un acceso seguro y privado.

### **Enumeraci칩n**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Azure Service Endpoints

Azure Service Endpoints extienden el espacio de direcciones privadas de tu red virtual y la identidad de tu VNet a los servicios de Azure a trav칠s de una conexi칩n directa. Al habilitar los service endpoints, **los recursos en tu VNet pueden conectarse de manera segura a los servicios de Azure**, como Azure Storage y Azure SQL Database, utilizando la red troncal de Azure. Esto asegura que **el tr치fico desde la VNet hacia el servicio de Azure permanezca dentro de la red de Azure**, proporcionando un camino m치s seguro y confiable.

### **Ejemplo**

* Por ejemplo, una cuenta de **Azure Storage** por defecto es accesible a trav칠s de internet p칰blico. Al habilitar un **service endpoint para Azure Storage dentro de tu VNet**, puedes asegurar que solo el tr치fico desde tu VNet pueda acceder a la cuenta de almacenamiento. El firewall de la cuenta de almacenamiento puede entonces configurarse para aceptar tr치fico solo desde tu VNet.

### **Enumeraci칩n**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Diferencias Entre Service Endpoints y Private Links

Microsoft recomienda usar Private Links en los [**docs**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\\

<figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Service Endpoints:**

* El tr치fico desde tu VNet al servicio de Azure viaja a trav칠s de la red backbone de Microsoft Azure, evitando el internet p칰blico.
* El endpoint es una conexi칩n directa al servicio de Azure y no proporciona una IP privada para el servicio dentro de la VNet.
* El servicio en s칤 sigue siendo accesible a trav칠s de su endpoint p칰blico desde fuera de tu VNet a menos que configures el firewall del servicio para bloquear dicho tr치fico.
* Es una relaci칩n uno a uno entre la subred y el servicio de Azure.
* Menos costoso que Private Links.

**Private Links:**

* Private Link mapea servicios de Azure en tu VNet a trav칠s de un endpoint privado, que es una interfaz de red con una direcci칩n IP privada dentro de tu VNet.
* El servicio de Azure se accede usando esta direcci칩n IP privada, haciendo que parezca como si fuera parte de tu red.
* Los servicios conectados a trav칠s de Private Link solo pueden ser accedidos desde tu VNet o redes conectadas; no hay acceso a internet p칰blico al servicio.
* Permite una conexi칩n segura a servicios de Azure o tus propios servicios alojados en Azure, as칤 como una conexi칩n a servicios compartidos por otros.
* Proporciona un control de acceso m치s granular a trav칠s de un endpoint privado en tu VNet, en contraste con el control de acceso m치s amplio a nivel de subred con service endpoints.

En resumen, aunque tanto Service Endpoints como Private Links proporcionan conectividad segura a servicios de Azure, **Private Links ofrecen un mayor nivel de aislamiento y seguridad al asegurar que los servicios se accedan de manera privada sin exponerlos al internet p칰blico**. Service Endpoints, por otro lado, son m치s f치ciles de configurar para casos generales donde se requiere un acceso seguro y simple a servicios de Azure sin la necesidad de una IP privada en la VNet.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** es un punto de entrada escalable y seguro para la **entrega r치pida** de tus aplicaciones web globales. **Combina** varios servicios como **balanceo de carga global, aceleraci칩n de sitios, descarga de SSL y capacidades de Web Application Firewall (WAF)** en un solo servicio. Azure Front Door proporciona enrutamiento inteligente basado en la **ubicaci칩n de borde m치s cercana al usuario**, asegurando un rendimiento y fiabilidad 칩ptimos. Adem치s, ofrece enrutamiento basado en URL, alojamiento de m칰ltiples sitios, afinidad de sesi칩n y seguridad a nivel de aplicaci칩n.

**Azure Front Door WAF** est치 dise침ado para **proteger aplicaciones web de ataques basados en la web** sin modificar el c칩digo de back-end. Incluye reglas personalizadas y conjuntos de reglas gestionadas para proteger contra amenazas como inyecci칩n SQL, cross-site scripting y otros ataques comunes.

### **Ejemplo**

* Imagina que tienes una aplicaci칩n distribuida globalmente con usuarios en todo el mundo. Puedes usar Azure Front Door para **enrutar las solicitudes de los usuarios al centro de datos regional m치s cercano** que aloja tu aplicaci칩n, reduciendo as칤 la latencia, mejorando la experiencia del usuario y **defendi칠ndola de ataques web con las capacidades de WAF**. Si una regi칩n en particular experimenta tiempo de inactividad, Azure Front Door puede redirigir autom치ticamente el tr치fico a la siguiente mejor ubicaci칩n, asegurando alta disponibilidad.

### Enumeraci칩n

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway y Azure Application Gateway WAF

Azure Application Gateway es un **balanceador de carga de tr치fico web** que te permite gestionar el tr치fico hacia tus aplicaciones **web**. Ofrece **balanceo de carga en la Capa 7, terminaci칩n SSL y capacidades de firewall de aplicaciones web (WAF)** en el Controlador de Entrega de Aplicaciones (ADC) como servicio. Las caracter칤sticas clave incluyen enrutamiento basado en URL, afinidad de sesi칩n basada en cookies y descarga de capa de sockets seguros (SSL), que son cruciales para aplicaciones que requieren capacidades de balanceo de carga complejas como enrutamiento global y enrutamiento basado en rutas.

### Ejemplo

* Considera un escenario donde tienes un sitio web de comercio electr칩nico que incluye m칰ltiples subdominios para diferentes funciones, como cuentas de usuario y procesamiento de pagos. Azure Application Gateway puede **enrutar el tr치fico a los servidores web apropiados basado en la ruta de la URL**. Por ejemplo, el tr치fico a `example.com/accounts` podr칤a ser dirigido al servicio de cuentas de usuario, y el tr치fico a `example.com/pay` podr칤a ser dirigido al servicio de procesamiento de pagos.\
Y **proteger tu sitio web de ataques utilizando las capacidades de WAF.**

### **Enumeraci칩n**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** es una caracter칤stica de red en Azure que **permite que diferentes Redes Virtuales (VNets) se conecten directamente y sin problemas**. A trav칠s de VNet peering, los recursos en una VNet pueden comunicarse con recursos en otra VNet usando direcciones IP privadas, **como si estuvieran en la misma red**.\
**VNet Peering tambi칠n se puede usar con redes locales** configurando una VPN de sitio a sitio o Azure ExpressRoute.

**Azure Hub and Spoke** es una topolog칤a de red utilizada en Azure para gestionar y organizar el tr치fico de red. **El "hub" es un punto central que controla y enruta el tr치fico entre diferentes "spokes"**. El hub t칤picamente contiene servicios compartidos como appliances virtuales de red (NVAs), Azure VPN Gateway, Azure Firewall o Azure Bastion. Los **"spokes" son VNets que alojan cargas de trabajo y se conectan al hub usando VNet peering**, permiti칠ndoles aprovechar los servicios compartidos dentro del hub. Este modelo promueve un dise침o de red limpio, reduciendo la complejidad al centralizar servicios comunes que m칰ltiples cargas de trabajo a trav칠s de diferentes VNets pueden usar.

{% hint style="danger" %}
**El emparejamiento de VNET no es transitivo en Azure**, lo que significa que si el spoke 1 est치 conectado al spoke 2 y el spoke 2 est치 conectado al spoke 3, entonces el spoke 1 no puede comunicarse directamente con el spoke 3.
{% endhint %}

### Ejemplos

* Imagina una empresa con departamentos separados como Ventas, RRHH y Desarrollo, **cada uno con su propia VNet (los spokes)**. Estas VNets **requieren acceso a recursos compartidos** como una base de datos central, un firewall y una puerta de enlace a internet, que est치n todos ubicados en **otra VNet (el hub)**. Usando el modelo Hub and Spoke, cada departamento puede **conectarse de manera segura a los recursos compartidos a trav칠s de la VNet del hub sin exponer esos recursos a internet p칰blico** o crear una estructura de red compleja con numerosas conexiones.

### Enumeraci칩n

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Un Site-to-Site VPN en Azure te permite **conectar tu red local a tu Azure Virtual Network (VNet)**, permitiendo que recursos como VMs dentro de Azure aparezcan como si estuvieran en tu red local. Esta conexi칩n se establece a trav칠s de un **VPN gateway que cifra el tr치fico** entre las dos redes.

### **Ejemplo**

* Una empresa con su oficina principal ubicada en Nueva York tiene un centro de datos local que necesita conectarse de manera segura a su VNet en Azure, que aloja sus cargas de trabajo virtualizadas. Al configurar un **Site-to-Site VPN, la empresa puede asegurar la conectividad cifrada entre los servidores locales y las Azure VMs**, permitiendo que los recursos sean accesibles de manera segura en ambos entornos como si estuvieran en la misma red local.

### **Enumeraci칩n**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute es un servicio que proporciona una **conexi칩n privada, dedicada y de alta velocidad entre tu infraestructura local y los centros de datos de Azure**. Esta conexi칩n se realiza a trav칠s de un proveedor de conectividad, evitando la internet p칰blica y ofreciendo m치s fiabilidad, mayores velocidades, menores latencias y mayor seguridad que las conexiones t칤picas de internet.

### **Ejemplo**

* Una corporaci칩n multinacional requiere una **conexi칩n consistente y fiable a sus servicios de Azure debido al alto volumen de datos** y la necesidad de un alto rendimiento. La empresa opta por Azure ExpressRoute para conectar directamente su centro de datos local a Azure, facilitando transferencias de datos a gran escala, como copias de seguridad diarias y an치lisis de datos en tiempo real, con mayor privacidad y velocidad.

### **Enumeraci칩n**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

{% hint style="success" %}
Aprende y practica AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
