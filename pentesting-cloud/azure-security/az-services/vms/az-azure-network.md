# Az - Azure Network

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **HackTricks'e PR göndererek hacking ipuçlarını paylaşın** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına.

</details>
{% endhint %}

## Temel Bilgiler

Azure içindeki ağlar, çeşitli Azure hizmetleri ve kaynakları arasında **bağlantı ve iletişimi** sağlayarak bulut bilişim platformunun ayrılmaz bir parçası olarak işlev görür. Azure'daki ağ mimarisi, son derece ölçeklenebilir, güvenli ve özelleştirilebilir olacak şekilde tasarlanmıştır.

Azure, temelinde, kullanıcıların Azure bulutu içinde **izole edilmiş ağlar** oluşturmasına olanak tanıyan bir **sanal ağ (VNet)** sağlar. Bu VNets içinde, sanal makineler, uygulamalar ve veritabanları gibi kaynaklar güvenli bir şekilde barındırılabilir ve yönetilebilir. Azure'daki ağ, hem bulut içindeki iletişimi (Azure hizmetleri arasında) hem de dış ağlara ve internete bağlantıyı destekler.

**Güvenlik**, Azure ağının kritik bir yönüdür ve verileri korumak, erişimi yönetmek ve uyumluluğu sağlamak için çeşitli araçlar ve hizmetler mevcuttur. Bu güvenlik önlemleri arasında **güvenlik duvarları**, **ağ güvenlik grupları** ve **şifreleme** yetenekleri bulunur ve trafik ve erişim üzerinde yüksek düzeyde kontrol sağlar.

Genel olarak, Azure'un ağ yetenekleri, kullanıcıların belirli uygulama ve iş yükü ihtiyaçlarına uygun bir ağ ortamı oluşturmasına olanak tanırken, güvenlik ve güvenilirliğe güçlü bir vurgu yapar.

## Sanal Ağ (VNET) ve Alt Ağlar

Azure'daki bir VNet, buluttaki kendi ağınızın bir temsili olarak işlev görür. Bu, Azure bulutunun aboneliğinize özel **mantıksal izolasyonudur**. Bir VNet, Azure'da sanal özel ağlar (VPN'ler) sağlama ve yönetme olanağı tanır ve sanal makineler (VM'ler), veritabanları ve uygulama hizmetleri gibi **birden fazla türde Azure kaynağını barındırmak ve yönetmek** için kullanılabilir.

VNets, **IP adresi** aralıkları, alt ağ oluşturma, yönlendirme tabloları ve ağ geçitleri dahil olmak üzere **ağ ayarları üzerinde tam kontrol** sağlar.

Bir **alt ağ**, VNet'inizdeki **bir IP adresi aralığıdır**. Bir VNet'i organizasyon ve güvenlik için birden fazla alt ağa bölebilirsiniz. Bir VNet'teki her alt ağ, ağ ve uygulama mimarinize göre kaynakları izole etmek ve gruplamak için kullanılabilir.

Ayrıca, alt ağlar, VNet'inizi bir veya daha fazla alt ağa **bölmenize** olanak tanır ve kaynakların kullanabileceği bir IP adresi aralığı sağlar.

### **Örnek**

* `10.0.0.0/16` IP adresi aralığına sahip `MyVNet` adlı bir VNet'iniz olduğunu varsayalım. Bu VNet içinde, web sunucularınızı barındırmak için `10.0.0.0/24` IP adresi aralığına sahip `Subnet-1` adlı bir alt ağ oluşturabilirsiniz. Veritabanı sunucularınız için `10.0.1.0/24` aralığına sahip başka bir alt ağ olan `Subnet-2` kullanılabilir. Bu segmentasyon, ağ içinde verimli yönetim ve güvenlik kontrolleri sağlar.

### Enumeration

Bir Azure hesabındaki tüm VNet'leri ve alt ağları listelemek için Azure Komut Satırı Arayüzü (CLI) kullanabilirsiniz. İşte adımlar:
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Network Security Groups (NSG)

Azure'da, bir **Network Security Group (NSG)**, Azure Virtual Network (VNet) içindeki Azure kaynaklarına gelen ve giden ağ trafiğini filtreleme işlevini yerine getirir. Bu grup, ağ trafiğinin akışını titizlikle belirleyen bir dizi **güvenlik kuralı** barındırır.

NSG'nin temel özellikleri şunlardır:

* **Trafik Kontrolü**: Her NSG, çeşitli Azure kaynaklarıyla ilişkili gelen ve giden ağ trafiğini ya izin veren ya da engelleyen kurallar içerir.
* **Kural Bileşenleri**: NSG içindeki kurallar, kaynak/hedef IP adresi, port ve protokol gibi kriterlere dayalı olarak trafiği filtreleyerek son derece spesifiktir. Bu spesifiklik, ağ trafiğinin ayrıntılı yönetimine olanak tanır.
* **Güvenlik Artırımı**: Yalnızca yetkili trafiğin Azure kaynaklarınıza girip çıkmasını sağlayarak, NSG'ler ağ altyapınızın güvenlik duruşunu güçlendirmede önemli bir rol oynar.

### **Örnek**

* VNet'iniz içinde bir alt ağa veya belirli bir sanal makineye uygulanan `MyNSG` adlı bir NSG'ye sahip olduğunuzu hayal edin. Şu kuralları oluşturabilirsiniz:
* Web sunucularınıza herhangi bir kaynaktan HTTP trafiğine (port 80) izin veren bir gelen kural.
* Belirli bir hedef IP adresi aralığına yalnızca SQL trafiğine (port 1433) izin veren bir giden kural.

### Enumeration

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Azure Firewall, Azure Sanal Ağ kaynaklarınızı koruyan yönetilen, bulut tabanlı bir **ağ güvenlik hizmetidir**. Yüksek kullanılabilirlik ve ölçeklenebilirlik özelliklerine sahip tam durumsal bir hizmet olarak güvenlik duvarıdır.

Azure Firewall, **uygulama düzeyinde filtreleme**, ağ düzeyinde filtreleme, tehdit istihbaratına dayalı filtreleme ve günlük kaydı ve analiz için Azure Monitor ile entegrasyon gibi **NSG'lerden daha gelişmiş** özellikler sunar.\
Giden, gelen, spoke-to-spoke, VPN ve ExpressRoute trafiğini filtreleyebilir. **Güvenlik duvarı kuralları FQDN (Fully Qualified Domain Name), IP adresleri ve portlara göre oluşturulabilir**.

### Azure Firewall ve NSG'ler Arasındaki Farklar

1. **Kapsam:**
* **NSG:** Alt ağ veya ağ arayüzü düzeyinde çalışır. Ağ arayüzlerinden (NIC), VM'lerden veya alt ağlardan gelen ve giden trafiğin temel filtrelemesini sağlamak için tasarlanmıştır.
* **Azure Firewall:** VNet düzeyinde çalışır ve daha geniş bir koruma kapsamı sağlar. Sanal ağ kaynaklarınızı güvence altına almak ve VNet'e giren ve çıkan trafiği yönetmek için tasarlanmıştır.
2. **Yetenekler:**
* **NSG:** IP adresi, port ve protokole dayalı temel filtreleme yetenekleri sağlar. Uygulama düzeyinde inceleme veya tehdit istihbaratı gibi gelişmiş özellikleri desteklemez.
* **Azure Firewall:** Uygulama düzeyinde (Katman 7) trafik filtreleme, tehdit istihbaratına dayalı filtreleme, ağ trafiği filtreleme ve daha fazlası gibi gelişmiş özellikler sunar. Ayrıca birden fazla genel IP adresini destekler.
3. **Kullanım Durumları:**
* **NSG:** Temel ağ düzeyinde trafik filtreleme için idealdir.
* **Azure Firewall:** Uygulama düzeyinde kontrol, günlük kaydı ve tehdit istihbaratının gerektiği daha karmaşık filtreleme senaryoları için uygundur.
4. **Yönetim ve İzleme:**
* **NSG:** Temel günlük kaydı ve Azure Monitor ile entegrasyon sunar.
* **Azure Firewall:** Azure Monitor aracılığıyla gelişmiş günlük kaydı ve analiz yetenekleri sağlar, bu da trafiğin doğasını ve desenini anlamak için gereklidir.

### Enumeration

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Network Virtual Appliance (NVA)

Azure'da bir Network Virtual Appliance (**NVA**), sanal bir ağ içinde **ağ işlevlerini gerçekleştiren** sanal bir cihazdır. NVAlar genellikle Azure'da **doğal olarak mevcut olmayan** ağ işlevleri için veya daha fazla özelleştirme gerektiğinde kullanılır. Esasen, **ağ uygulamaları veya hizmetleri çalıştıran VMlerdir**, örneğin güvenlik duvarları, WAN optimizasyon cihazları veya yük dengeleyiciler.

NVAlar karmaşık yönlendirme, **güvenlik** ve **ağ trafiği yönetimi** görevleri için kullanılır. Azure **Marketplace**'ten dağıtılabilirler, burada birçok üçüncü taraf satıcı, cihazlarını Azure ortamlarına entegrasyon için hazır olarak sunar.

### **Örnek**

* Bir organizasyon, Azure'da **özel bir güvenlik duvarı çözümü** oluşturmak için bir NVA dağıtabilir. Bu NVA, gelişmiş özellikler sunan **üçüncü taraf bir güvenlik duvarı yazılımı** çalıştırabilir, örneğin izinsiz giriş tespiti, paket incelemesi veya VPN bağlantısı. NVA, üzerinden geçen trafiği incelemek ve filtrelemek için yapılandırılabilir, böylece organizasyonun politikalarına göre gelişmiş güvenlik önlemleri sağlanır.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Azure Route Tables & User Defined Routes (UDR)

**Azure Route Tables**, Microsoft Azure içinde, **Azure Virtual Networks (VNets) içindeki ağ trafiği yönlendirmesini kontrol etme** özelliğidir. Temelde, **paketlerin** VNets içindeki alt ağlar arasında, VNets arasında veya harici ağlara nasıl **yönlendirileceğini** tanımlarlar. Her yönlendirme tablosu, paketlerin hedef IP adreslerine göre nasıl yönlendirilmesi gerektiğini belirten bir dizi kural, yani yönlendirme içerir.

**User Defined Routes (UDR)**, Azure Route Tables içinde oluşturduğunuz **özel yönlendirmelerdir** ve **ağ trafiğinin akışını** Azure Virtual Networks (VNets) içinde ve arasında, ayrıca harici bağlantılara kontrol etmenizi sağlar. UDR'ler, Azure'un varsayılan yönlendirme kararlarını geçersiz kılarak, ağ trafiğini belirli gereksinimlerinize göre yönlendirme esnekliği sunar.

Bu yönlendirmeler, özellikle **ağ trafiğini sanal bir cihaz üzerinden yönlendirme**, güvenlik veya politika uyumu için belirli bir yol zorunluluğu getirme veya yerel ağlarla entegrasyon sağlama senaryolarında kullanışlıdır.

### **Örnek**

* Bir VNet içindeki alt ağlar arasında trafiği denetlemek için bir Network Virtual Appliance (NVA) dağıttığınızı varsayalım. Bir alt ağdan diğerine giden tüm trafiği NVA üzerinden yönlendiren bir UDR oluşturabilirsiniz. Bu UDR, trafiğin hedefine ulaşmadan önce güvenlik amacıyla NVA tarafından denetlendiğinden emin olur.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link, **Azure hizmetlerine özel erişim sağlayan** bir hizmettir ve **Azure sanal ağınız (VNet) ile hizmet arasındaki trafiğin tamamen Microsoft'un Azure omurga ağı içinde seyahat etmesini sağlar**. Bu, hizmeti VNet'inize getirir. Bu yapı, verilerin genel internete maruz kalmaması nedeniyle güvenliği artırır.

Private Link, Azure Storage, Azure SQL Database ve Private Link aracılığıyla paylaşılan özel hizmetler gibi çeşitli Azure hizmetleriyle kullanılabilir. Kendi VNet'inizden veya farklı Azure aboneliklerinden hizmetleri güvenli bir şekilde tüketmenin bir yolunu sağlar.

{% hint style="danger" %}
NSG'ler özel uç noktalara uygulanmaz, bu da Private Link içeren bir alt ağa NSG ilişkilendirmenin hiçbir etkisi olmayacağı anlamına gelir.
{% endhint %}

### **Örnek**

* **VNet'inizden güvenli bir şekilde erişmek istediğiniz bir Azure SQL Database** senaryosunu düşünün. Normalde, bu genel internet üzerinden geçişi içerebilir. Private Link ile, **VNet'inizde doğrudan Azure SQL Database hizmetine bağlanan özel bir uç nokta** oluşturabilirsiniz. Bu uç nokta, veritabanını kendi VNet'inizin bir parçasıymış gibi gösterir ve özel bir IP adresi aracılığıyla erişilebilir hale getirir, böylece güvenli ve özel erişim sağlar.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Azure Service Endpoints

Azure Service Endpoints, sanal ağınızın özel adres alanını ve VNet'inizin kimliğini doğrudan bağlantı üzerinden Azure hizmetlerine genişletir. Hizmet uç noktalarını etkinleştirerek, **VNet'inizdeki kaynaklar Azure'un omurga ağı üzerinden Azure hizmetlerine güvenli bir şekilde bağlanabilir**, örneğin Azure Storage ve Azure SQL Database. Bu, **VNet'ten Azure hizmetine giden trafiğin Azure ağı içinde kalmasını** sağlar ve daha güvenli ve güvenilir bir yol sunar.

### **Örnek**

* Örneğin, bir **Azure Storage** hesabı varsayılan olarak genel internet üzerinden erişilebilir. **VNet'iniz içinde Azure Storage için bir hizmet uç noktası etkinleştirerek**, yalnızca VNet'inizden gelen trafiğin depolama hesabına erişmesini sağlayabilirsiniz. Depolama hesabı güvenlik duvarı daha sonra yalnızca VNet'inizden gelen trafiği kabul edecek şekilde yapılandırılabilir.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Service Endpoints ve Private Links Arasındaki Farklar

Microsoft, [**docs**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints)'ta Private Links kullanmayı öneriyor:\\

<figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Service Endpoints:**

* VNet'inizden Azure hizmetine giden trafik, Microsoft Azure omurga ağı üzerinden geçer ve genel interneti atlar.
* Endpoint, Azure hizmetine doğrudan bir bağlantıdır ve VNet içinde hizmet için özel bir IP sağlamaz.
* Hizmetin kendisi, hizmet güvenlik duvarını bu tür trafiği engelleyecek şekilde yapılandırmadığınız sürece, VNet'iniz dışından genel endpoint üzerinden erişilebilir.
* Alt ağ ile Azure hizmeti arasında bire bir ilişki vardır.
* Private Links'ten daha ucuzdur.

**Private Links:**

* Private Link, Azure hizmetlerini VNet'inize özel bir endpoint aracılığıyla haritalar; bu, VNet'iniz içinde özel bir IP adresine sahip bir ağ arayüzüdür.
* Azure hizmetine bu özel IP adresi kullanılarak erişilir, bu da onu ağınızın bir parçasıymış gibi gösterir.
* Private Link aracılığıyla bağlanan hizmetlere yalnızca VNet'inizden veya bağlı ağlardan erişilebilir; hizmete genel internet erişimi yoktur.
* Azure hizmetlerine veya Azure'da barındırılan kendi hizmetlerinize güvenli bir bağlantı sağlar ve başkaları tarafından paylaşılan hizmetlere bağlantı sağlar.
* VNet'inizdeki özel bir endpoint aracılığıyla daha ayrıntılı erişim kontrolü sağlar, hizmet endpoint'leri ile alt ağ düzeyinde daha geniş erişim kontrolüne karşı.

Özetle, hem Service Endpoints hem de Private Links Azure hizmetlerine güvenli bağlantı sağlarken, **Private Links, hizmetlerin genel internete maruz kalmadan özel olarak erişilmesini sağlayarak daha yüksek düzeyde izolasyon ve güvenlik sunar**. Öte yandan, Service Endpoints, VNet'te özel bir IP'ye ihtiyaç duymadan Azure hizmetlerine basit ve güvenli erişim gereken genel durumlar için kurulumu daha kolaydır.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door**, küresel web uygulamalarınızın **hızlı teslimatı** için ölçeklenebilir ve güvenli bir giriş noktasıdır. **Küresel yük dengeleme, site hızlandırma, SSL offloading ve Web Application Firewall (WAF)** gibi çeşitli hizmetleri tek bir hizmette **birleştirir**. Azure Front Door, **kullanıcıya en yakın edge konumuna** dayalı akıllı yönlendirme sağlayarak optimal performans ve güvenilirlik sunar. Ayrıca, URL tabanlı yönlendirme, çoklu site barındırma, oturum bağlılığı ve uygulama katmanı güvenliği sunar.

**Azure Front Door WAF**, arka uç kodunda değişiklik yapmadan **web uygulamalarını web tabanlı saldırılardan korumak** için tasarlanmıştır. SQL enjeksiyonu, cross-site scripting ve diğer yaygın saldırılara karşı koruma sağlamak için özel kurallar ve yönetilen kural setleri içerir.

### **Örnek**

* Küresel olarak dağıtılmış ve dünya çapında kullanıcıları olan bir uygulamanız olduğunu hayal edin. Azure Front Door'u kullanarak kullanıcı isteklerini uygulamanızı barındıran en yakın bölgesel veri merkezine **yönlendirebilir**, böylece gecikmeyi azaltabilir, kullanıcı deneyimini iyileştirebilir ve **WAF yetenekleriyle web saldırılarından koruyabilirsiniz**. Belirli bir bölge kesinti yaşarsa, Azure Front Door trafiği otomatik olarak bir sonraki en iyi konuma yönlendirebilir ve yüksek kullanılabilirlik sağlar.

### Enumeration

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway ve Azure Application Gateway WAF

Azure Application Gateway, **web trafiği yük dengeleyicisi** olup, **web** uygulamalarınıza gelen trafiği yönetmenizi sağlar. **Katman 7 yük dengeleme, SSL sonlandırma ve web uygulama güvenlik duvarı (WAF) yetenekleri** sunar ve Application Delivery Controller (ADC) hizmeti olarak çalışır. Ana özellikler arasında URL tabanlı yönlendirme, çerez tabanlı oturum bağımlılığı ve güvenli soket katmanı (SSL) yük boşaltma bulunur. Bu özellikler, global yönlendirme ve yol tabanlı yönlendirme gibi karmaşık yük dengeleme yeteneklerine ihtiyaç duyan uygulamalar için kritiktir.

### Örnek

* Bir e-ticaret web siteniz olduğunu ve bu sitenin kullanıcı hesapları ve ödeme işlemleri gibi farklı işlevler için birden fazla alt alan adı içerdiğini düşünün. Azure Application Gateway, **URL yoluna göre trafiği uygun web sunucularına yönlendirebilir**. Örneğin, `example.com/accounts` adresine gelen trafik kullanıcı hesapları servisine, `example.com/pay` adresine gelen trafik ise ödeme işleme servisine yönlendirilebilir.\
Ve **WAF yeteneklerini kullanarak web sitenizi saldırılardan koruyabilirsiniz.**

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering**, Azure'da **farklı Virtual Networks (VNets) doğrudan ve sorunsuz bir şekilde bağlanmasını sağlayan** bir ağ özelliğidir. VNet peering aracılığıyla, bir VNet'teki kaynaklar, başka bir VNet'teki kaynaklarla özel IP adresleri kullanarak **aynı ağdaymış gibi iletişim kurabilir**.\
**VNet Peering, site-to-site VPN veya Azure ExpressRoute kurarak on-prem ağlarla da kullanılabilir**.

**Azure Hub and Spoke**, Azure'da ağ trafiğini yönetmek ve düzenlemek için kullanılan bir ağ topolojisidir. **"Hub", farklı "spokes" arasındaki trafiği kontrol eden ve yönlendiren merkezi bir noktadır**. Hub genellikle network virtual appliances (NVAs), Azure VPN Gateway, Azure Firewall veya Azure Bastion gibi paylaşılan hizmetleri içerir. **"Spokes", iş yüklerini barındıran ve VNet peering kullanarak hub'a bağlanan VNets'tir**, bu sayede hub içindeki paylaşılan hizmetlerden yararlanabilirler. Bu model, farklı VNets'teki birden fazla iş yükünün kullanabileceği ortak hizmetleri merkezileştirerek karmaşıklığı azaltan temiz bir ağ düzeni sağlar.

{% hint style="danger" %}
**VNET peering Azure'da geçişli değildir**, bu da demektir ki spoke 1 spoke 2'ye bağlıysa ve spoke 2 spoke 3'e bağlıysa spoke 1 doğrudan spoke 3 ile konuşamaz.
{% endhint %}

### Örnekler

* Satış, İK ve Geliştirme gibi ayrı departmanlara sahip bir şirketi hayal edin, **her biri kendi VNet'ine (spokes) sahip**. Bu VNets **merkezi bir veritabanı, bir firewall ve bir internet gateway gibi paylaşılan kaynaklara erişim gerektirir**, bunların hepsi **başka bir VNet'te (hub) bulunur**. Hub and Spoke modelini kullanarak, her departman **bu paylaşılan kaynaklara hub VNet üzerinden güvenli bir şekilde bağlanabilir, bu kaynakları genel internete maruz bırakmadan** veya çok sayıda bağlantı ile karmaşık bir ağ yapısı oluşturmadan.

### Enumeration

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Azure'da bir Site-to-Site VPN, **yerel ağınızı Azure Sanal Ağınıza (VNet) bağlamanızı** sağlar ve Azure içindeki VM'ler gibi kaynakların yerel ağınızdaymış gibi görünmesini sağlar. Bu bağlantı, **iki ağ arasındaki trafiği şifreleyen bir VPN ağ geçidi** aracılığıyla kurulur.

### **Örnek**

* New York'ta ana ofisi bulunan bir işletmenin, sanallaştırılmış iş yüklerini barındıran Azure'daki VNet'ine güvenli bir şekilde bağlanması gereken bir yerel veri merkezi vardır. **Site-to-Site VPN kurarak, şirket yerel sunucular ile Azure VM'leri arasında şifreli bağlantı sağlayabilir**, böylece kaynaklar her iki ortamda da aynı yerel ağdaymış gibi güvenli bir şekilde erişilebilir.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute, **şirket içi altyapınız ile Azure veri merkezleri arasında özel, ayrılmış, yüksek hızlı bir bağlantı sağlayan bir hizmettir**. Bu bağlantı, bir bağlantı sağlayıcısı aracılığıyla yapılır, genel interneti atlayarak daha fazla güvenilirlik, daha hızlı hızlar, daha düşük gecikmeler ve tipik internet bağlantılarından daha yüksek güvenlik sunar.

### **Örnek**

* Çok uluslu bir şirket, **yüksek veri hacmi ve yüksek verim ihtiyacı nedeniyle Azure hizmetlerine tutarlı ve güvenilir bir bağlantı gerektirir**. Şirket, şirket içi veri merkezini Azure'a doğrudan bağlamak için Azure ExpressRoute'u tercih eder, günlük yedeklemeler ve gerçek zamanlı veri analitiği gibi büyük ölçekli veri transferlerini geliştirilmiş gizlilik ve hız ile kolaylaştırır.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking öğrenin ve pratik yapın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına PR göndererek hacking ipuçlarını paylaşın.

</details>
{% endhint %}
