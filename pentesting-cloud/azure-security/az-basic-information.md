# Az - Basic Information

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Organizacija Hijerarhija

<figure><img src="../../.gitbook/assets/image (271).png" alt=""><figcaption></figcaption></figure>

### Management Groups

Ako va≈°a organizacija ima **mnogo Azure pretplata**, mo≈æda ƒáe vam trebati naƒçin da efikasno **upravljate pristupom**, politikama i usklaƒëeno≈°ƒáu za te **pretplate**. **Management groups** pru≈æaju **opseg upravljanja iznad pretplata**.

Napomena da **10,000 management groups** mo≈æe biti podr≈æano u jednom direktorijumu i stablo management groups mo≈æe podr≈æati **do ≈°est nivoa dubine**.

<figure><img src="../../.gitbook/assets/image (147).png" alt=""><figcaption></figcaption></figure>

[Iz dokumentacije](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview#root-management-group-for-each-directory): Svaki direktorijum dobija jednu **najvi≈°u management group nazvanu root** management group. Root management group je ugraƒëena u hijerarhiju da bi **sve management groups i pretplate bile povezane sa njom**. Ova root management group omoguƒáava da se **globalne politike i Azure uloge** primenjuju na nivou direktorijuma. [Azure AD **Global Administrator** treba da se podigne](https://learn.microsoft.com/en-us/azure/role-based-access-control/elevate-access-global-admin) na **User Access Administrator ulogu ove root grupe** inicijalno. Nakon podizanja pristupa, administrator mo≈æe **dodeliti bilo koju Azure ulogu drugim korisnicima ili grupama direktorijuma za upravljanje hijerarhijom**. Kao administrator, mo≈æete dodeliti **svoj nalog kao vlasnika root** management group.

Root management group **ne mo≈æe biti premje≈°tena ili obrisana**, za razliku od drugih management groups.

Management groups vam daju upravljanje na nivou preduzeƒáa bez obzira na vrstu pretplata koje imate. Meƒëutim, **sve pretplate unutar jedne management group** moraju verovati **istom Azure Active Directory (Azure AD) tenantu**.

<figure><img src="../../.gitbook/assets/image (157).png" alt=""><figcaption></figcaption></figure>

### Azure Subscriptions

U Azure-u, pretplata slu≈æi kao **logiƒçki kontejner** za svrhu **provisioning** poslovnih ili tehniƒçkih **resursa**. Ovaj kontejner odr≈æava **detalje resursa** kao ≈°to su virtuelne ma≈°ine (VMs), baze podataka, izmeƒëu ostalog. Prilikom kreiranja Azure resursa, kao ≈°to je VM, **pretplata povezana sa njim** je specificirana. Ova struktura olak≈°ava delegiranje pristupa, koristeƒái mehanizme kontrole pristupa zasnovane na ulogama.

### Resource Groups

[Iz dokumentacije:](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-python?tabs=macos#what-is-a-resource-group) Resource group je **kontejner** koji dr≈æi **povezane resurse** za Azure re≈°enje. Resource group mo≈æe ukljuƒçivati sve resurse za re≈°enje, ili samo one **resurse koje ≈æelite da upravljate kao grupu**. Generalno, dodajte **resurse** koji dele **isti ≈æivotni ciklus** u istu resource group kako biste ih lako mogli deploy, update i delete kao grupu.

Svi **resursi** moraju biti **unutar resource group** i mogu pripadati samo jednoj grupi, a ako se resource group obri≈°e, svi resursi unutar nje se takoƒëe bri≈°u.

### Administrative Units

[Iz dokumentacije:](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-manage) Administrative units vam omoguƒáavaju da **podelite** va≈°u organizaciju na **bilo koju jedinicu** koju ≈æelite, a zatim **dodelite specifiƒçne administratore** koji mogu **upravljati samo ƒçlanovima** te jedinice. Na primer, mo≈æete koristiti administrative units da delegirate dozvole administratorima svake ≈°kole na velikom univerzitetu, tako da mogu kontrolisati pristup, upravljati korisnicima i postavljati politike samo u School of Engineering.

Samo **korisnici**, **grupe** i **ureƒëaji** mogu biti **ƒçlanovi** administrative unit.

Dakle, **Administrative unit** ƒáe **sadr≈æati** neke **ƒçlanove** i drugi **principals** ƒáe biti **dodeljeni dozvolama nad tom** administrativnom **jedinicom** koje mogu koristiti za **upravljanje ƒçlanovima** administrativne jedinice.

## Azure vs Azure AD vs Azure AD Domain Services

Va≈æno je napomenuti da je **Azure AD** usluga **unutar** **Azure-a**. **Azure** je Microsoftova **cloud platforma**, dok je **Azure AD** enterprise **identity** **usluga** u Azure-u.\
≈†tavi≈°e, **Azure AD nije kao Windows Active Directory**, to je identitetska usluga koja radi na potpuno drugaƒçiji naƒçin. Ako ≈æelite da pokrenete **Domain Controller u Azure-u** za va≈°e Windows Active Directory okru≈æenje, morate koristiti **Azure AD Domain Services**.

## Principals

Azure podr≈æava razliƒçite tipove principals:

* **User**: Redovna **osoba** sa kredencijalima za pristup.
* **Group**: **Grupa principals** kojima se upravlja zajedno. **Dozvole** dodeljene grupama su **nasleƒëene** od strane njenih **ƒçlanova**.
* **Service Principal/Enterprise Applications**: To je **identitet** kreiran za **kori≈°ƒáenje** sa **aplikacijama**, hostovanim uslugama i automatizovanim alatima za pristup Azure resursima. Ovaj pristup je **ograniƒçen ulogama dodeljenim** service principal-u, dajuƒái vam kontrolu nad **kojim resursima mo≈æe pristupiti** i na kojem nivou. Iz sigurnosnih razloga, uvek se preporuƒçuje **koristiti service principals sa automatizovanim alatima** umesto da im se dozvoli prijava sa korisniƒçkim identitetom.

Kada kreirate **service principal** mo≈æete birati izmeƒëu **password authentication** ili **certificate authentication**.

* Ako izaberete **password** auth (podrazumevano), **saƒçuvajte generisanu lozinku** jer neƒáete moƒái ponovo da joj pristupite.
* Ako izaberete certificate authentication, uverite se da ƒáe **aplikacija imati pristup privatnom kljuƒçu**.
* **Managed Identity (Metadata Creds)**: Managed identities u Azure Active Directory nude re≈°enje za **automatsko upravljanje identitetom** aplikacija. Ovi identiteti se koriste od strane aplikacija za svrhu **povezivanja** sa **resursima** kompatibilnim sa Azure Active Directory (**Azure AD**) autentifikacijom. Kori≈°ƒáenjem managed identities, aplikacije mogu **osigurati Azure AD tokene** dok elimini≈°u potrebu za direktnim rukovanjem kredencijalima. Postoje dve vrste managed identities:
* **System-assigned**. Neke Azure usluge vam omoguƒáavaju da **omoguƒáite managed identity direktno na instance usluge**. Kada omoguƒáite system-assigned managed identity, identitet se kreira u Azure AD. Identitet je vezan za **≈æivotni ciklus te instance usluge**. Kada se **resurs** **obri≈°e**, Azure automatski **bri≈°e** **identitet** za vas. Po dizajnu, samo taj Azure resurs mo≈æe koristiti ovaj identitet za zahtev tokene od Azure AD.
* **User-assigned**. Takoƒëe mo≈æete kreirati managed identity kao samostalni Azure resurs. Mo≈æete [kreirati user-assigned managed identity](https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/how-to-manage-ua-identity-portal) i dodeliti ga jednoj ili **vi≈°e instanci** Azure usluge (vi≈°e resursa). Za user-assigned managed identities, **identitet se upravlja odvojeno od resursa koji ga koriste**.

## Roles & Permissions

**Roles** su **dodeljene** **principals** na **scope**: `principal -[HAS ROLE]->(scope)`

**Roles** dodeljene **grupama** su **nasleƒëene** od strane svih **ƒçlanova** grupe.

U zavisnosti od opsega na koji je uloga dodeljena, **uloga** mo≈æe biti **nasleƒëena** na **druge resurse** unutar opsega kontejnera. Na primer, ako korisnik A ima **ulogu na pretplati**, on ƒáe imati tu **ulogu na svim resource groups** unutar pretplate i na **svim resursima** unutar resource group.

### **Classic Roles**

| **Owner**                     | <ul><li>Potpun pristup svim resursima</li><li>Mo≈æe upravljati pristupom za druge korisnike</li></ul> | Sve vrste resursa |
| ----------------------------- | ---------------------------------------------------------------------------------------- | ------------------ |
| **Contributor**               | <ul><li>Potpun pristup svim resursima</li><li>Ne mo≈æe upravljati pristupom</li></ul>              | Sve vrste resursa |
| **Reader**                    | ‚Ä¢ Pregled svih resursa                                                                     | Sve vrste resursa |
| **User Access Administrator** | <ul><li>Pogled svih resursa</li><li>Mo≈æe upravljati pristupom za druge korisnike</li></ul>           | Sve vrste resursa |

### Built-In roles

[Iz dokumentacije: ](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)[Azure role-based access control (Azure RBAC)](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview) ima nekoliko Azure **built-in roles** koje mo≈æete **dodeliti** **korisnicima, grupama, service principals i managed identities**. Dodela uloga je naƒçin na koji kontroli≈°ete **pristup Azure resursima**. Ako built-in roles ne zadovoljavaju specifiƒçne potrebe va≈°e organizacije, mo≈æete kreirati svoje [**Azure custom roles**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)**.**

**Built-In** roles se primenjuju samo na **resurse** za koje su **namenjene**, na primer pogledajte ova 2 primera **Built-In roles za Compute** resurse:

| [Disk Backup Reader](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#disk-backup-reader)                 | Pru≈æa dozvolu backup vault-u da izvr≈°i disk backup.      | 3e5e47e6-65f7-47ef-90b5-e5dd4d455f24 |
| ----------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------------------------------ |
| [Virtual Machine User Login](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-user-login) | Pregled virtuelnih ma≈°ina u portalu i prijava kao redovan korisnik. | fb879df8-f326-4884-b1cf-06f3ad86be52 |

Ove uloge mogu **takoƒëe biti dodeljene logiƒçkim kontejnerima** (kao ≈°to su management groups, subscriptions i resource groups) i principals koji su pogoƒëeni ƒáe ih imati **nad resursima unutar tih kontejnera**.

* Pronaƒëite ovde listu sa [**svim Azure built-in roles**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles).
* Pronaƒëite ovde listu sa [**svim Azure AD built-in roles**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference).

### Custom Roles

Azure takoƒëe omoguƒáava kreiranje [**custom roles**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) sa dozvolama koje korisnik treba.

### Permission Denied

* Da bi **principal imao neki pristup nad resursom** potreban mu je eksplicitna uloga koja mu je dodeljena (na bilo koji naƒçin) **dodeljujuƒái mu tu dozvolu**.
* Eksplicitna **deny role assignment ima prednost** nad ulogom koja dodeljuje dozvolu.

<figure><img src="../../.gitbook/assets/image (191).png" alt=""><figcaption></figcaption></figure>

### Global Administrator

Korisnici sa Global Administrator ulogom imaju moguƒánost da '**podignu' na User Access Administrator Azure ulogu na root management group**. To znaƒçi da ƒáe Global Administrator moƒái da upravlja pristupom **svim Azure pretplatama i management groups.**\
Ovo podizanje mo≈æe biti izvr≈°eno na kraju stranice: [https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties](https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties)

<figure><img src="../../.gitbook/assets/image (162).png" alt=""><figcaption></figcaption></figure>

### Azure Policies

Azure policies su skup **pravila i propisa u Microsoft Azure-u**, cloud computing usluzi, koji poma≈æu u upravljanju i sprovoƒëenju organizacionih standarda i proceni usklaƒëenosti na velikoj skali. Ove politike nameƒáu razliƒçita pravila nad va≈°im **Azure resursima**, osiguravajuƒái da ti resursi ostanu usklaƒëeni sa korporativnim standardima i ugovorima o nivou usluge.

Azure policies su kljuƒçne za upravljanje cloud-om i sigurnost, poma≈æuƒái da se osigura da se resursi koriste pravilno i efikasno, i da su u skladu sa spoljnim propisima i internim politikama.\
Neki primeri:

1. **Osiguranje usklaƒëenosti sa specifiƒçnim Azure regionima**: Ova politika osigurava da se svi resursi deploy-uju u specifiƒçnim Azure regionima. Na primer, kompanija mo≈æe ≈æeleti da osigura da se svi njeni podaci ƒçuvaju u Evropi radi usklaƒëenosti sa GDPR-om.
2. **Sprovoƒëenje standarda imenovanja**: Politike mogu sprovesti konvencije imenovanja za Azure resurse. Ovo poma≈æe u organizaciji i lakom identifikovanju resursa na osnovu njihovih imena, ≈°to je korisno u velikim okru≈æenjima.
3. **Ograniƒçavanje odreƒëenih tipova resursa**: Ova politika mo≈æe ograniƒçiti kreiranje odreƒëenih tipova resursa. Na primer, politika mo≈æe biti postavljena da spreƒçi kreiranje skupih tipova resursa, kao ≈°to su odreƒëene veliƒçine VM-ova, radi kontrole tro≈°kova.
4. **Sprovoƒëenje politika oznaƒçavanja**: Tagovi su parovi kljuƒç-vrednost povezani sa Azure resursima koji se koriste za upravljanje resursima. Politike mogu sprovesti da odreƒëeni tagovi moraju biti prisutni, ili imati specifiƒçne vrednosti, za sve resurse. Ovo je korisno za praƒáenje tro≈°kova, vlasni≈°tvo ili kategorizaciju resursa.
5. **Ograniƒçavanje javnog pristupa resursima**: Politike mogu sprovesti da odreƒëeni resursi, kao ≈°to su storage accounts ili baze podataka, nemaju javne krajnje taƒçke, osiguravajuƒái da su dostupni samo unutar mre≈æe organizacije.
6. **Automatsko primenjivanje sigurnosnih postavki**: Politike se mogu koristiti za automatsko primenjivanje sigurnosnih postavki na resurse, kao ≈°to je primena specifiƒçne mre≈æne sigurnosne grupe na sve VM-ove ili osiguranje da svi storage accounts koriste enkripciju.

Napomena da se Azure Policies mogu prikaƒçiti na bilo koji nivo Azure hijerarhije, ali se **obiƒçno koriste u root management group** ili u drugim management groups.

### Permissions Scope

U Azure-u **dozvole se mogu dodeliti bilo kojem delu hijerarhije**. To ukljuƒçuje management groups, subscriptions, resource groups i pojedinaƒçne resurse. Dozvole su **nasleƒëene** od strane sadr≈æanih **resursa** entiteta gde su dodeljene.

Ova hijerarhijska struktura omoguƒáava efikasno i skalabilno upravljanje pristupnim dozvolama.

<figure><img src="../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

### Azure RBAC vs ABAC

**RBAC** (role-based access control) je ono ≈°to smo veƒá videli u prethodnim sekcijama: **Dodel
