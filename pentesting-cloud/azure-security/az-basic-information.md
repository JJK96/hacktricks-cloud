# Az - Temel Bilgiler

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking öğrenin ve pratik yapın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **Discord grubuna** 💬 [**katılın**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'ı takip edin.**
* **HackTricks'e** [**PR göndererek**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunarak **hacking ipuçlarını paylaşın.**

</details>
{% endhint %}

## Organizasyon Hiyerarşisi

<figure><img src="../../.gitbook/assets/image (271).png" alt=""><figcaption></figcaption></figure>

### Yönetim Grupları

Eğer organizasyonunuzun **birçok Azure aboneliği** varsa, bu **abonelikler** için erişimi, politikaları ve uyumluluğu verimli bir şekilde **yönetmenin** bir yoluna ihtiyacınız olabilir. **Yönetim grupları**, aboneliklerin **üzerinde bir yönetim kapsamı** sağlar.

Not: Tek bir dizinde **10.000 yönetim grubu** desteklenebilir ve bir yönetim grubu ağacı **altı seviyeye kadar derinlik** destekleyebilir.

<figure><img src="../../.gitbook/assets/image (147).png" alt=""><figcaption></figcaption></figure>

[Belgelerden](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview#root-management-group-for-each-directory): Her dizine tek bir **en üst düzey yönetim grubu olan kök** yönetim grubu verilir. Kök yönetim grubu, **tüm yönetim gruplarının ve aboneliklerin ona katlanması** için hiyerarşiye yerleştirilmiştir. Bu kök yönetim grubu, dizin düzeyinde **küresel politikaların ve Azure rol atamalarının** uygulanmasına olanak tanır. [Azure AD **Global Yöneticisi** kendini yükseltmelidir](https://learn.microsoft.com/en-us/azure/role-based-access-control/elevate-access-global-admin) bu kök grubun **Kullanıcı Erişim Yöneticisi rolüne** başlangıçta. Erişimi yükselttikten sonra, yönetici **hiyerarşiyi yönetmek için diğer dizin kullanıcılarına veya gruplarına herhangi bir Azure rolü atayabilir**. Yönetici olarak, **kendi hesabınızı kök yönetim grubunun sahibi olarak atayabilirsiniz**.

Kök yönetim grubu, diğer yönetim gruplarının aksine **taşınamaz veya silinemez**.

Yönetim grupları, sahip olabileceğiniz abonelik türü ne olursa olsun, kurumsal düzeyde yönetim sağlar. Ancak, **tek bir yönetim grubundaki tüm abonelikler** aynı **Azure Active Directory (Azure AD) kiracısına** güvenmelidir.

<figure><img src="../../.gitbook/assets/image (157).png" alt=""><figcaption></figcaption></figure>

### Azure Abonelikleri

Azure'da, bir abonelik, iş veya teknik **kaynakları sağlama** amacıyla **mantıksal bir konteyner** olarak hizmet eder. Bu konteyner, sanal makineler (VM'ler), veritabanları gibi **kaynakların detaylarını** tutar. Bir Azure kaynağı oluşturulduğunda, örneğin bir VM, **ilgili abonelik** belirtilir. Bu yapı, rol tabanlı erişim kontrol mekanizmalarını kullanarak erişim devrini kolaylaştırır.

### Kaynak Grupları

[Belgelerden:](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-python?tabs=macos#what-is-a-resource-group) Bir kaynak grubu, bir Azure çözümü için **ilgili kaynakları** tutan bir **konteynerdir**. Kaynak grubu, çözüm için tüm kaynakları veya yalnızca **bir grup olarak yönetmek istediğiniz kaynakları** içerebilir. Genellikle, **aynı yaşam döngüsünü paylaşan kaynakları** aynı kaynak grubuna ekleyin, böylece bunları bir grup olarak kolayca dağıtabilir, güncelleyebilir ve silebilirsiniz.

Tüm **kaynaklar** bir **kaynak grubunun içinde olmalıdır** ve yalnızca bir gruba ait olabilir ve bir kaynak grubu silinirse, içindeki tüm kaynaklar da silinir.

### Yönetim Birimleri

[Belgelerden:](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-manage) Yönetim birimleri, organizasyonunuzu **istediğiniz herhangi bir birime** bölmenize ve ardından **yalnızca o birimin üyelerini yönetebilecek belirli yöneticiler atamanıza** olanak tanır. Örneğin, büyük bir üniversitedeki her okulun yöneticilerine izinleri devretmek için yönetim birimlerini kullanabilirsiniz, böylece yalnızca Mühendislik Fakültesi'nde erişimi kontrol edebilir, kullanıcıları yönetebilir ve politikaları belirleyebilirler.

Yalnızca **kullanıcılar**, **gruplar** ve **cihazlar** bir **yönetim biriminin** **üyesi** olabilir.

Bu nedenle, bir **Yönetim birimi** bazı **üyeleri** içerecek ve diğer **prensipler** bu yönetim birimi **üzerinde izinler atanacak** ve bu izinleri yönetim biriminin üyelerini yönetmek için kullanabileceklerdir.

## Azure vs Azure AD vs Azure AD Domain Services

**Azure AD**'nin **Azure** içinde bir hizmet olduğunu not etmek önemlidir. **Azure**, Microsoft'un **bulut platformu** iken, **Azure AD** Azure'da kurumsal **kimlik** **hizmetidir**.\
Ayrıca, **Azure AD Windows Active Directory gibi değildir**, tamamen farklı bir şekilde çalışan bir kimlik hizmetidir. Windows Active Directory ortamınız için Azure'da bir **Domain Controller çalıştırmak** istiyorsanız, **Azure AD Domain Services** kullanmanız gerekir.

## Prensipler

Azure farklı türde prensipleri destekler:

* **Kullanıcı**: Erişim için kimlik bilgilerine sahip normal bir **kişi**.
* **Grup**: Birlikte yönetilen bir **prensipler grubu**. Gruplara verilen **izinler** üyeleri tarafından **miras alınır**.
*   **Service Principal/Enterprise Applications**: **Uygulamalar**, barındırılan hizmetler ve otomatik araçlar için Azure kaynaklarına erişim sağlamak amacıyla oluşturulmuş bir **kimlik**tir. Bu erişim, service principal'a atanan rollerle **sınırlıdır**, bu da **hangi kaynaklara erişilebileceğini** ve hangi düzeyde olduğunu kontrol etmenizi sağlar. Güvenlik nedenleriyle, **otomatik araçlarla service principal'ları kullanmak** her zaman önerilir, kullanıcı kimliği ile giriş yapmalarına izin vermek yerine.

Bir **service principal** oluştururken **şifre kimlik doğrulaması** veya **sertifika kimlik doğrulaması** arasında seçim yapabilirsiniz.

* Eğer **şifre** kimlik doğrulamasını seçerseniz (varsayılan olarak), **oluşturulan şifreyi kaydedin** çünkü tekrar erişemeyeceksiniz.
* Sertifika kimlik doğrulamasını seçerseniz, **uygulamanın özel anahtara erişimi olacağından** emin olun.
* **Managed Identity (Metadata Creds)**: Azure Active Directory'deki yönetilen kimlikler, uygulamaların kimliğini **otomatik olarak yönetmek** için bir çözüm sunar. Bu kimlikler, uygulamalar tarafından **Azure Active Directory (**Azure AD**) kimlik doğrulaması ile uyumlu kaynaklara bağlanmak** amacıyla kullanılır. Yönetilen kimlikleri kullanarak, uygulamalar **Azure AD belirteçlerini güvence altına alabilir** ve kimlik bilgilerini doğrudan yönetme ihtiyacını ortadan kaldırabilir. İki tür yönetilen kimlik vardır:
* **Sistem atamalı**. Bazı Azure hizmetleri, **bir hizmet örneğinde doğrudan bir yönetilen kimlik etkinleştirmenize** olanak tanır. Sistem atamalı bir yönetilen kimlik etkinleştirildiğinde, Azure AD'de bir kimlik oluşturulur. Kimlik, **o hizmet örneğinin yaşam döngüsüne** bağlıdır. **Kaynak** **silindiğinde**, Azure kimliği **otomatik olarak siler**. Tasarım gereği, yalnızca o Azure kaynağı bu kimliği kullanarak Azure AD'den belirteç talep edebilir.
* **Kullanıcı atamalı**. Ayrıca bağımsız bir Azure kaynağı olarak bir yönetilen kimlik oluşturabilirsiniz. [Kullanıcı atamalı bir yönetilen kimlik oluşturabilir](https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/how-to-manage-ua-identity-portal) ve bunu bir veya **birden fazla Azure hizmeti örneğine** (birden fazla kaynak) atayabilirsiniz. Kullanıcı atamalı yönetilen kimlikler için, **kimlik, onu kullanan kaynaklardan ayrı olarak yönetilir**.

## Roller ve İzinler

**Roller** **prensiplere** bir **kapsamda** **atanır**: `principal -[HAS ROLE]->(scope)`

**Gruplara atanan roller** grubun tüm **üyeleri tarafından miras alınır**.

Rolün atandığı kapsama bağlı olarak, **rol** **kapsam konteyneri içindeki diğer kaynaklara** **miras alınabilir**. Örneğin, bir kullanıcı A'nın **abonelik üzerinde bir rolü varsa**, bu **rolü abonelik içindeki tüm kaynak gruplarında** ve **kaynak grubundaki tüm kaynaklarda** sahip olacaktır.

### **Klasik Roller**

| **Sahip**                     | <ul><li>Tüm kaynaklara tam erişim</li><li>Diğer kullanıcılar için erişimi yönetebilir</li></ul> | Tüm kaynak türleri |
| ----------------------------- | --------------------------------------------------------------------------------------------- | ------------------ |
| **Katkıda Bulunan**           | <ul><li>Tüm kaynaklara tam erişim</li><li>Erişimi yönetemez</li></ul>                         | Tüm kaynak türleri |
| **Okuyucu**                   | • Tüm kaynakları görüntüleyebilir                                                             | Tüm kaynak türleri |
| **Kullanıcı Erişim Yöneticisi** | <ul><li>Tüm kaynakları görüntüleyebilir</li><li>Diğer kullanıcılar için erişimi yönetebilir</li></ul> | Tüm kaynak türleri |

### Yerleşik Roller

[Belgelerden: ](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)[Azure rol tabanlı erişim kontrolü (Azure RBAC)](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview) **kullanıcılara, gruplara, service principal'lara ve yönetilen kimliklere** atayabileceğiniz birkaç Azure **yerleşik rolü** vardır. Rol atamaları, **Azure kaynaklarına erişimi kontrol etmenin** yoludur. Yerleşik roller organizasyonunuzun özel ihtiyaçlarını karşılamıyorsa, kendi [**Azure özel rollerinizi**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) oluşturabilirsiniz.

**Yerleşik** roller yalnızca **amaçlandıkları kaynaklara** uygulanır, örneğin **Compute** kaynakları üzerindeki yerleşik rollerin 2 örneğini kontrol edin:

| [Disk Backup Reader](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#disk-backup-reader)                 | Disk yedeklemesi gerçekleştirmek için yedekleme kasasına izin sağlar.      | 3e5e47e6-65f7-47ef-90b5-e5dd4d455f24 |
| ----------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------- | ------------------------------------ |
| [Virtual Machine User Login](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-user-login) | Portalda Sanal Makineleri görüntüleyin ve normal bir kullanıcı olarak giriş yapın. | fb879df8-f326-4884-b1cf-06f3ad86be52 |

Bu roller **mantıksal konteynerler** (yönetim grupları, abonelikler ve kaynak grupları gibi) üzerinde de **atanabilir** ve etkilenen prensipler bu konteynerlerin **içindeki kaynaklar üzerinde** bu rollere sahip olacaktır.

* [**Tüm Azure yerleşik rollerinin**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles) listesini burada bulabilirsiniz.
* [**Tüm Azure AD yerleşik rollerinin**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference) listesini burada bulabilirsiniz.

### Özel Roller

Azure ayrıca [**özel roller**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) oluşturmanıza izin verir, kullanıcıların ihtiyaç duyduğu izinlerle.

### İzin Reddedildi

* Bir **prensibin bir kaynak üzerinde bazı erişimlere sahip olması** için, ona (herhangi bir şekilde) **o izni veren bir rolün açıkça atanması** gerekir.
* Açık bir **reddetme rol ataması, izni veren rolün önüne geçer**.

<figure><img src="../../.gitbook/assets/image (191).png" alt=""><figcaption></figcaption></figure>

### Global Yöneticisi

Global Yöneticisi rolüne sahip kullanıcılar, **kök yönetim grubuna User Access Administrator Azure rolüne 'yükseltme' yeteneğine sahiptir**. Bu, bir Global Yöneticisinin **tüm Azure aboneliklerini ve yönetim gruplarını yönetebileceği** anlamına gelir.\
Bu yükseltme şu sayfanın sonunda yapılabilir: [https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties](https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties)

<figure><img src="../../.gitbook/assets/image (162).png" alt=""><figcaption></figcaption></figure>

### Azure Politikaları

Azure politikaları, Microsoft Azure'da, bir bulut bilişim hizmetinde, kurumsal standartları yönetmeye ve uyumluluğu ölçeklendirmeye yardımcı olan bir dizi **kural ve düzenlemedir**. Bu politikalar, **Azure kaynaklarınız** üzerinde farklı kuralları zorlayarak, bu kaynakların kurumsal standartlara ve hizmet düzeyi anlaşmalarına uygun kalmasını sağlar.

Azure politikaları, bulut yönetimi ve güvenliği için kritik öneme sahiptir, kaynakların doğru ve verimli bir şekilde kullanılmasını ve dış düzenlemelere ve iç politikalara uygun olmasını sağlar.\
Bazı örnekler:

1. **Belirli Azure Bölgeleriyle Uyumluluğun Sağlanması**: Bu politika, tüm kaynakların belirli Azure bölgelerinde dağıtılmasını sağlar. Örneğin, bir şirket GDPR uyumluluğu için tüm verilerinin Avrupa'da saklanmasını isteyebilir.
2. **Adlandırma Standartlarının Zorlanması**: Politikalar, Azure kaynakları için adlandırma kurallarını zorlayabilir. Bu, büyük ortamlarda kaynakları organize etmek ve adlarına göre kolayca tanımlamak için yardımcı olur.
3. **Belirli Kaynak Türlerinin Kısıtlanması**: Bu politika, belirli türde kaynakların oluşturulmasını kısıtlayabilir. Örneğin, pahalı kaynak türlerinin, belirli VM boyutları gibi, oluşturulmasını engellemek için bir politika ayarlanabilir.
4. **Etiketleme Politikalarının Zorlanması**: Etiketler, Azure kaynaklarıyla ilişkili anahtar-değer çiftleridir ve kaynak yönetimi için kullanılır. Politikalar, belirli etiketlerin mevcut olmasını veya tüm kaynaklar için belirli değerlere sahip olmasını zorlayabilir. Bu, maliyet takibi, sahiplik veya kaynakların kategorize edilmesi için kullanışlıdır.
5. **Kaynaklara Genel Erişimin Sınırlandırılması**: Politikalar, depolama hesapları veya veritabanları gibi belirli kaynakların genel uç noktalarının olmamasını zorlayabilir, bu da yalnızca organizasyonun ağı içinde erişilebilir olmalarını sağlar.
6. **Güvenlik Ayarlarının Otomatik Olarak Uygulanması**: Politikalar, kaynaklara otomatik olarak güvenlik ayarları uygulamak için kullanılabilir, örneğin tüm VM'lere belirli bir ağ güvenlik grubunun uygulanması veya tüm depolama hesaplarının şifreleme kullanmasını sağlamak.

Azure Politikalarının Azure hiyerarşisinin herhangi bir seviyesine eklenebileceğini, ancak **genellikle kök yönetim grubunda** veya diğer yönetim gruplarında kullanıldığını unutmayın.

### İzinler Kapsamı

Azure'da **izinler hiyerarşinin herhangi bir kısmına atanabilir**. Bu, yönetim gruplarını, abonelikleri, kaynak gruplarını ve bireysel kaynakları içerir. İzinler, atandıkları varlığın **
