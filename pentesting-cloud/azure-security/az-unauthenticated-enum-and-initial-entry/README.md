# Az - рдЕрдЕрдереЗрдВрдЯрд┐рдХреЗрдЯреЗрдб рдПрдиреБрдо & рдЖрд░рдВрднрд┐рдХ рдкреНрд░рд╡реЗрд╢

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдФрд░ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
{% endhint %}

## рдПрдЬрд╝реНрдпреВрд░ рдЯреЗрдиреЗрдВрдЯ

### рдЯреЗрдиреЗрдВрдЯ рдПрдиреБрдорд░реЗрд╢рди

рдХреБрдЫ **рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдПрдЬрд╝реНрдпреВрд░ рдПрдкреАрдЖрдИ** рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЬрд╛рдирдХрд╛рд░ **рдЯреЗрдиреЗрдВрдЯ рдХреЗ рдбреЛрдореЗрди** рдХреЛ рдЬрд╛рдирддреЗ рд╣реБрдП рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдЗрдХрдЯреНрдард╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИред\
рдЖрдк рд╕реАрдзреЗ рдПрдкреАрдЖрдИ рдХреНрд╡реЗрд░реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ PowerShell рдкреБрд╕реНрддрдХрд╛рд▓рдп [**AADInternals**](https://github.com/Gerenios/AADInternals)** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:**

| рдПрдкреАрдЖрдИ                                                              | рдЬрд╛рдирдХрд╛рд░реА                                                                                                                                                                                                                                           | AADInternals рдлрд╝рдВрдХреНрд╢рди                             |
| -------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------- |
| login.microsoftonline.com/\<domain>/.well-known/openid-configuration | **рд▓реЙрдЧрд┐рди рдЬрд╛рдирдХрд╛рд░реА**, рдЯреЗрдиреЗрдВрдЯ рдЖрдИрдбреА рд╕рд╣рд┐рдд                                                                                                                                                                                                            | `Get-AADIntTenantID -Domain <domain>`             |
| autodiscover-s.outlook.com/autodiscover/autodiscover.svc             | рдЯреЗрдиреЗрдВрдЯ рдХреЗ **рд╕рднреА рдбреЛрдореЗрди**                                                                                                                                                                                                                         | `Get-AADIntTenantDomains -Domain <domain>`        |
| login.microsoftonline.com/GetUserRealm.srf?login=\<UserName>         | <p><strong>рдЯреЗрдиреЗрдВрдЯ рдХреА рд▓реЙрдЧрд┐рди рдЬрд╛рдирдХрд╛рд░реА</strong>, рдЯреЗрдиреЗрдВрдЯ рдирд╛рдо рдФрд░ рдбреЛрдореЗрди <strong>рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдХрд╛рд░</strong> рд╕рд╣рд┐рддред<br>рдпрджрд┐ <code>NameSpaceType</code> <strong><code>Managed</code></strong> рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ <strong>AzureAD</strong> рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛ рд░рд╣рд╛ рд╣реИред</p> | `Get-AADIntLoginInformation -UserName <UserName>` |
| login.microsoftonline.com/common/GetCredentialType                   | рд▓реЙрдЧрд┐рди рдЬрд╛рдирдХрд╛рд░реА, рд╕рд╣рд┐рдд **рдбреЗрд╕реНрдХрдЯреЙрдк SSO рдЬрд╛рдирдХрд╛рд░реА**                                                                                                                                                                                              | `Get-AADIntLoginInformation -UserName <UserName>` |

рдЖрдк **рдПрдХ рд╣реА рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рдПрдХ рдПрдЬрд╝реНрдпреВрд░ рдЯреЗрдиреЗрдВрдЯ рдХреА рд╕рднреА рдЬрд╛рдирдХрд╛рд░реА рдХреНрд╡реЗрд░реА** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ [**AADInternals**](https://github.com/Gerenios/AADInternals) **рдкреБрд╕реНрддрдХрд╛рд▓рдп** рдХрд╛:
```powershell
Invoke-AADIntReconAsOutsider -DomainName corp.onmicrosoft.com | Format-Table
```
рдПрдЬрд╝реНрдпреВрд░ рдЯреЗрдиреЗрдВрдЯ рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдЙрджрд╛рд╣рд░рдг:
```
Tenant brand:       Company Ltd
Tenant name:        company
Tenant id:          1937e3ab-38de-a735-a830-3075ea7e5b39
DesktopSSO enabled: True

Name                           DNS   MX    SPF  Type      STS
----                           ---   --    ---  ----      ---
company.com                   True  True  True  Federated sts.company.com
company.mail.onmicrosoft.com  True  True  True  Managed
company.onmicrosoft.com       True  True  True  Managed
int.company.com              False False False  Managed
```
рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреНрд░рдордг

рдЖрдкрдХреЛ рдЖрд╡рд╛рд╕реА рдХрд╛ рдирд╛рдо, рдЖрдИрдбреА, рдФрд░ "рдмреНрд░рд╛рдВрдб" рдирд╛рдо рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╡рд┐рд╡рд░рдг рджреЗрдЦрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдбреЗрд╕реНрдХрдЯреЙрдк рдПрдХрд▓ рд╕рд╛рдЗрди-рдСрди (SSO), рдЬрд┐рд╕реЗ [**рд╕реАрдорд▓реЗрд╕ SSO**](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-sso) рднреА рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдХреА рд╕реНрдерд┐рддрд┐ рднреА рдкреНрд░рджрд░реНрд╢рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИред рдЬрдм рдпрд╣ рд╕рдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рдирд┐рд╢реНрдЪрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ (рдХреНрд░рдордг) рдХреА рдирд┐рд░реНрдзрд╛рд░рдг рдореЗрдВ рд╕рд╣рд╛рдпрдХ рд╣реЛрддреА рд╣реИред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдЙрддреНрдХреГрд╖реНрдЯ рдЖрд╡рд╛рд╕реА рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕рднреА рд╕рддреНрдпрд╛рдкрд┐рдд рдбреЛрдореЗрдиреЛрдВ рдХреЗ рдирд╛рдо рдФрд░ рдЙрдирдХреЗ рд╕рдВрдмрдВрдзрд┐рдд рдкрд╣рдЪрд╛рди рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╕рдВрдШрдЯрд┐рдд рдбреЛрдореЗрдиреЛрдВ рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдкреНрд░рдпреЛрдЧ рдореЗрдВ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛ рдХрд╛ рдкреВрд░реНрдг рдпреЛрдЧреНрдп рдбреЛрдореЗрди рдирд╛рдо (FQDN), рд╕рд╛рдорд╛рдиреНрдпрдд: рдПрдХ ADFS рд╕рд░реНрд╡рд░, рднреА рдЦреБрд▓рд╛рд╕рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред "MX" рд╕реНрддрдВрдн рд╕реНрдкрд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдИрдореЗрд▓ Exchange Online рдореЗрдВ рдорд╛рд░реНрдЧреАрдХреГрдд рд╣реИрдВ, рдЬрдмрдХрд┐ "SPF" рд╕реНрддрдВрдн Exchange Online рдХреЛ рдИрдореЗрд▓ рднреЗрдЬрдиреЗ рд╡рд╛рд▓реЗ рдХреЗ рд░реВрдк рдореЗрдВ рд╕реВрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИред рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рд╡рд░реНрддрдорд╛рди рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдлрд╝рдВрдХреНрд╢рди SPF рд░рд┐рдХреЙрд░реНрдбреНрд╕ рдХреЗ "рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ" рд╡рдХреНрддрд╡реНрдпреЛрдВ рдХреЛ рд╡рд┐рд╢реНрд▓реЗрд╖рд┐рдд рдирд╣реАрдВ рдХрд░рддрд╛, рдЬрд┐рд╕рд╕реЗ рдЧрд▓рдд рдирдХрд╛рд░рд╛рддреНрдордХ рдкрд░рд┐рдгрд╛рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред
```
<email>#EXT#@<tenant name>.onmicrosoft.com
```
рдИрдореЗрд▓ рдЙрдкрдпреЛрдХреНрддрд╛ рдХрд╛ рдИрдореЗрд▓ рдкрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ "рдПрдЯ" рдХреЛ рдЕрдВрдбрд░рд╕реНрдХреЛрд░ "_" рд╕реЗ рдмрджрд▓ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

[**AADInternals**](https://github.com/Gerenios/AADInternals) рдХреЗ рд╕рд╛рде, рдЖрдк рдЖрд╕рд╛рдиреА рд╕реЗ рдпрд╣ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЙрдкрдпреЛрдХреНрддрд╛ рдореМрдЬреВрдж рд╣реИ рдпрд╛ рдирд╣реАрдВ:
```powershell
# Check does the user exist
Invoke-AADIntUserEnumerationAsOutsider -UserName "user@company.com"
```
## Az Unauthenticated Enumeration and Initial Entry

### Unauthenticated Enumeration

During the initial phase of a penetration test, it is crucial to gather as much information as possible without triggering any alarms. Unauthenticated enumeration involves collecting data from publicly available sources such as search engines, public repositories, and social media to build a profile of the target organization.

### Initial Entry

Once enough information has been gathered, the next step is to identify potential entry points into the target's environment. This could involve exploiting misconfigurations, weak credentials, or known vulnerabilities to gain unauthorized access to the system.

By combining unauthenticated enumeration with thorough reconnaissance and vulnerability analysis, a penetration tester can increase the chances of successfully breaching the target organization's defenses.
```
UserName         Exists
--------         ------
user@company.com True
```
рдЖрдк рдПрдХ рдкрдВрдХреНрддрд┐ рдкреНрд░рддрд┐ рдПрдХ рдИрдореЗрд▓ рдкрддрд╛ рд╡рд╛рд▓рд╛ рдПрдХ рдкрд╛рда рдлрд╝рд╛рдЗрд▓ рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
user@company.com
user2@company.com
admin@company.com
admin2@company.com
external.user_gmail.com#EXT#@company.onmicrosoft.com
external.user_outlook.com#EXT#@company.onmicrosoft.com
```

```powershell
# Invoke user enumeration
Get-Content .\users.txt | Invoke-AADIntUserEnumerationAsOutsider -Method Normal
```
There are **рддреАрди рд╡рд┐рднрд┐рдиреНрди рдЧрдгрдирд╛ рд╡рд┐рдзрд┐рдпрд╛рдБ** рдЪреБрдирдиреЗ рдХреЗ рд▓рд┐рдП:

| рд╡рд┐рдзрд┐      | рд╡рд┐рд╡рд░рдг                                                                                                                                                                                             |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| рд╕рд╛рдорд╛рдиреНрдп    | рдпрд╣ рдКрдкрд░ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд GetCredentialType API рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддрд╛ рд╣реИред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╡рд┐рдзрд┐ред                                                                                                                           |
| рд▓реЙрдЧрд┐рди     | <p>рдпрд╣ рд╡рд┐рдзрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреА рд╣реИред<br><strong>рдиреЛрдЯ:</strong> рдХреНрд╡реЗрд░реА рд╕рд╛рдЗрди-рдЗрдиреНрд╕ рд▓реЙрдЧ рдореЗрдВ рд▓реЙрдЧ рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗред</p>                                                                                       |
| рдСрдЯреЛрд▓реЙрдЧреЙрди | <p>рдпрд╣ рд╡рд┐рдзрд┐ рдСрдЯреЛрд▓реЙрдЧреЙрди рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреА рд╣реИред<br><strong>рдХреНрд╡реЗрд░реА рд╕рд╛рдЗрди-рдЗрдиреНрд╕ рд▓реЙрдЧ рдореЗрдВ рд▓реЙрдЧ рдирд╣реАрдВ рдХреА рдЬрд╛рддреА</strong> рд╣реИ! рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдпрд╣ рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдкреНрд░реЗ рдФрд░ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рд╣рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП рднреА рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░рддреА рд╣реИред</p> |

рд╡реИрдз рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреА рдЦреЛрдЬ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЖрдк **рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА** рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```powershell
Get-AADIntLoginInformation -UserName root@corp.onmicrosoft.com
```
рд╕реНрдХреНрд░рд┐рдкреНрдЯ [**o365creeper**](https://github.com/LMGsec/o365creeper) рдЖрдкрдХреЛ рдпрд╣ рднреА рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдХрд┐ **рдХреНрдпрд╛ рдИрдореЗрд▓ рдорд╛рдиреНрдп рд╣реИ**ред
```powershell
# Put in emails.txt emails such as:
# - root@corp.onmicrosoft.com
python.exe .\o365creeper\o365creeper.py -f .\emails.txt -o validemails.txt
```
**рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдЯреАрдореНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬрд╛рдВрдЪ**

рдПрдХ рдФрд░ рдЕрдЪреНрдЫрд╛ рд╕реНрд░реЛрдд рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдЯреАрдореНрд╕ рд╣реИред

рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдЯреАрдореНрд╕ рдХрд╛ рдПрдкреАрдЖрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЦреЛрдЬ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ "рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦреЛрдЬ" рдЕрдВрдд-рд╕реНрдерд╛рдирд┐рдХ **externalsearchv3** рдФрд░ **searchUsers** рдХрд╛ рдЙрдкрдпреЛрдЧ рдЯреАрдореНрд╕-рдирд╛рдорд╛рдВрдХрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдп рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдПрдкреАрдЖрдИ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЧреИрд░ рдореМрдЬреВрджрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдФрд░ рдореМрдЬреВрджрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдмреАрдЪ рднрд┐рдиреНрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рдирдХреЗ рдкрд╛рд╕ рдПрдХ рд╡реИрдз рдЯреАрдореНрд╕ рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рд╣реИред

рд╕реНрдХреНрд░рд┐рдкреНрдЯ [**TeamsEnum**](https://github.com/sse-secure-systems/TeamsEnum) рдХрд╛ рдЙрдкрдпреЛрдЧ рдЯреАрдореНрд╕ рдПрдкреАрдЖрдИ рдХреЗ рдЦрд┐рд▓рд╛рдл рджрд┐рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреА рдорд╛рдиреНрдпрддрд╛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
```bash
python3 TeamsEnum.py -a password -u <username> -f inputlist.txt -o teamsenum-output.json
```
## Unauthenticated Enumeration and Initial Entry

### Introduction

In this section, we will discuss how to perform unauthenticated enumeration and gain initial access in Azure environments.

### Unauthenticated Enumeration

To gather information about the target Azure environment without authentication, we can use various techniques such as:

- **DNS Enumeration**: Enumerating DNS records to discover subdomains and services.
- **Service Enumeration**: Identifying exposed services and their versions.
- **Storage Account Enumeration**: Discovering publicly accessible storage accounts.
- **Blob Enumeration**: Enumerating blobs within storage accounts for sensitive information.

### Initial Entry

After gathering information through unauthenticated enumeration, the next step is to find ways to gain initial access to the Azure environment. This can be achieved through techniques like:

- **Brute Forcing**: Guessing credentials or keys to access Azure resources.
- **Phishing Attacks**: Sending malicious emails to Azure users to obtain their credentials.
- **Exploiting Misconfigurations**: Taking advantage of misconfigured resources for unauthorized access.
- **Social Engineering**: Manipulating Azure users to divulge sensitive information.

By combining unauthenticated enumeration techniques with methods to gain initial entry, attackers can effectively compromise Azure environments.
```
[-] user1@domain - Target user not found. Either the user does not exist, is not Teams-enrolled or is configured to not appear in search results (personal accounts only)
[+] user2@domain - User2 | Company (Away, Mobile)
[+] user3@domain - User3 | Company (Available, Desktop)
```
рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдореМрдЬреВрджрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЙрдкрд▓рдмреНрдзрддрд╛ рд╕реВрдЪрдирд╛ рдХреА рдЬрд╛рдВрдЪ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ рдЬреИрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд:

- рдЙрдкрд▓рдмреНрдз
- рджреВрд░
- рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ
- рд╡реНрдпрд╕реНрдд
- рдСрдлрд▓рд╛рдЗрди

рдпрджрд┐ **рдЖрдЙрдЯ рдСрдл рдСрдлрд┐рд╕ рд╕рдВрджреЗрд╢** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ TeamsEnum рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рднреА рд╕рдВрднрд╡ рд╣реИред рдпрджрд┐ рдПрдХ рдЖрдЙрдЯрдкреБрдЯ рдлрд╝рд╛рдЗрд▓ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХреА рдЧрдИ рдереА, рддреЛ рдЖрдЙрдЯ рдСрдл рдСрдлрд┐рд╕ рд╕рдВрджреЗрд╢ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ JSON рдлрд╝рд╛рдЗрд▓ рдХреЗ рднреАрддрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ:
```
jq . teamsenum-output.json
```
## Unauthenticated Enumeration and Initial Entry

### Introduction

In this section, we will discuss how to perform unauthenticated enumeration and gain initial entry into an Azure environment.

### Unauthenticated Enumeration

To gather information about the target Azure environment without authentication, we can use various techniques such as:

- **DNS Enumeration**: Enumerating DNS records to discover subdomains and services.
- **Service Enumeration**: Identifying exposed services and their versions.
- **Storage Account Enumeration**: Discovering publicly accessible storage accounts.
- **Blob Enumeration**: Enumerating blobs within storage accounts.
- **Container Enumeration**: Identifying containers within storage accounts.

### Initial Entry

Once we have gathered sufficient information through unauthenticated enumeration, we can proceed to gain initial entry into the Azure environment. This may involve exploiting misconfigurations, weak credentials, or known vulnerabilities to access resources within the environment.

It is important to note that gaining unauthorized access to any Azure environment is illegal unless you have explicit permission to do so as part of a legitimate security assessment.
```json
{
"email": "user2@domain",
"exists": true,
"info": [
{
"tenantId": "[REDACTED]",
"isShortProfile": false,
"accountEnabled": true,
"featureSettings": {
"coExistenceMode": "TeamsOnly"
},
"userPrincipalName": "user2@domain",
"givenName": "user2@domain",
"surname": "",
"email": "user2@domain",
"tenantName": "Company",
"displayName": "User2",
"type": "Federated",
"mri": "8:orgid:[REDACTED]",
"objectId": "[REDACTED]"
}
],
"presence": [
{
"mri": "8:orgid:[REDACTED]",
"presence": {
"sourceNetwork": "Federated",
"calendarData": {
"outOfOfficeNote": {
"message": "Dear sender. I am out of the office until March 23rd with limited access to my email. I will respond after my return.Kind regards, User2",
"publishTime": "2023-03-15T21:44:42.0649385Z",
"expiry": "2023-04-05T14:00:00Z"
},
"isOutOfOffice": true
},
"capabilities": [
"Audio",
"Video"
],
"availability": "Away",
"activity": "Away",
"deviceType": "Mobile"
},
"etagMatch": false,
"etag": "[REDACTED]",
"status": 20000
}
]
}
```
## рдПрдЬрд╝реНрдпреВрд░ рд╕реЗрд╡рд╛рдПрдВ

рдЬрд╛рди рд▓реЗрдВ рдХрд┐ рд╣рдореЗрдВ рдкрддрд╛ рд╣реИ рдХрд┐ **рдПрдЬрд╝реНрдпреВрд░ рдХрд┐рд░рд╛рдпреЗрджрд╛рд░** рдХреМрди рд╕реА **рдбреЛрдореЗрдиреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ, рдЕрдм рд╕рдордп рд╣реИ рдХрд┐ рд╣рдо **рдПрдЬрд╝реНрдпреВрд░ рд╕реЗрд╡рд╛рдПрдВ рдЬреЛ рдЙрдЬрд╛рдЧрд░ рд╣реИрдВ** рдвреВрдВрдврдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред

рдЖрдк рдЗрд╕ рд▓рдХреНрд╖реНрдп рдХреЗ рд▓рд┐рдП [**MicroBust**](https://github.com/NetSPI/MicroBurst) рд╕реЗ рдПрдХ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдХрдИ **рдПрдЬрд╝реНрдпреВрд░ рд╕реЗрд╡рд╛ рдбреЛрдореЗрдиреЛрдВ** рдореЗрдВ рдмреЗрд╕ рдбреЛрдореЗрди рдирд╛рдо (рдФрд░ рдХреБрдЫ рдЕрд╡рдзрд╛рд░рдгрд╛рдПрдБ) рдЦреЛрдЬреЗрдЧрд╛:
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1 -Verbose
Invoke-EnumerateAzureSubDomains -Base corp -Verbose
```
## рдУрдкрди рд╕реНрдЯреЛрд░реЗрдЬ

рдЖрдк рдРрд╕реЗ рдЯреВрд▓ рдХреЗ рд╕рд╛рде рдУрдкрди рд╕реНрдЯреЛрд░реЗрдЬ рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ [**InvokeEnumerateAzureBlobs.ps1**](https://github.com/NetSPI/MicroBurst/blob/master/Misc/Invoke-EnumerateAzureBlobs.ps1) рдЬреЛ рдлрд╝рд╛рдЗрд▓ **`Microburst/Misc/permitations.txt`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ рдкрд░рд┐рдгрд╛рдо (рдмрд╣реБрдд рд╣реА рд╕рд░рд▓) рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдУрдкрди рд╕реНрдЯреЛрд░реЗрдЬ рдЦрд╛рддреЗ рдЦреЛрдЬрдиреЗ** рдХреЗ рд▓рд┐рдПред
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1
Invoke-EnumerateAzureBlobs -Base corp
[...]
https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
[...]

# Access https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
# Check: <Name>ssh_info.json</Name>
# Access then https://corpcommon.blob.core.windows.net/secrets/ssh_info.json
```
### SAS URLs

рдПрдХ _**рд╕рд╛рдЭрд╛ рдПрдХреНрд╕реЗрд╕ рд╕рд┐рдЧреНрдиреЗрдЪрд░**_ (SAS) URL рдПрдХ URL рд╣реИ рдЬреЛ рдХрд┐рд╕реА рд╕реНрдЯреЛрд░реЗрдЬ рдЕрдХрд╛рдЙрдВрдЯ рдХреЗ рдХрд┐рд╕реА рдЦрдВрдб (рдкреВрд░реЗ рдХрдВрдЯреЗрдирд░, рдПрдХ рдлрд╝рд╛рдЗрд▓...) рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреБрдЫ рд╡рд┐рд╢реЗрд╖ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реЛрддреА рд╣реИрдВ (рдкрдврд╝рдиреЗ, рд▓рд┐рдЦрдиреЗ...) рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдкрд░ред рдпрджрд┐ рдЖрдкрдХреЛ рдПрдХ рд▓реАрдХ рдорд┐рд▓ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдЖрдк рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рдпреЗ рдРрд╕реЗ рджрд┐рдЦрддреЗ рд╣реИрдВ (рдпрд╣ рдПрдХ рдХрдВрдЯреЗрдирд░ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ, рдЕрдЧрд░ рдпрд╣ рдХреЗрд╡рд▓ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдерд╛ рддреЛ URL рдХрд╛ рдкрде рднреА рдЙрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдЧрд╛):

`https://<storage_account_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`

[**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/) рдХрд╛ рдЙрдкрдпреЛрдЧ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВ

## рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдХрдордЬреЛрд░ рдХрд░рдирд╛

### рдлрд┐рд╢рд┐рдВрдЧ

* [**рд╕рд╛рдорд╛рдиреНрдп рдлрд┐рд╢рд┐рдВрдЧ**](https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology) (рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдпрд╛ OAuth рдРрдк -[рдЕрд╡реИрдз рд╕рд╣рдорддрд┐ рдЕрдиреБрджрд╛рди рд╣рдорд▓рд╛](az-illicit-consent-grant.md)-)
* [**рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛрдб рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдлрд┐рд╢рд┐рдВрдЧ](az-device-code-authentication-phishing.md)

### рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдкреНрд░реЗрдЗрдВрдЧ / рдмреНрд░реВрдЯ-рдлрд╝реЛрд░реНрд╕

{% content-ref url="az-password-spraying.md" %}
[az-password-spraying.md](az-password-spraying.md)
{% endcontent-ref %}

## рд╕рдВрджрд░реНрдн

* [https://aadinternals.com/post/just-looking/](https://aadinternals.com/post/just-looking/)
* [https://www.securesystems.de/blog/a-fresh-look-at-user-enumeration-in-microsoft-teams/](https://www.securesystems.de/blog/a-fresh-look-at-user-enumeration-in-microsoft-teams/)

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
{% endhint %}
