# Az - –ù–µ–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–µ –ø–µ—Ä–µ–ª—ñ—á–µ–Ω–Ω—è —Ç–∞ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –≤—Ö—ñ–¥

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**–®–∫–æ–ª–∞ —Ö–∞–∫—ñ–Ω–≥—É HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**–®–∫–æ–ª–∞ —Ö–∞–∫—ñ–Ω–≥—É HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫–µ—Ä—Å—å–∫—ñ —Ç—Ä—é–∫–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}

## Azure Tenant

### –ü–µ—Ä–µ–ª—ñ—á–µ–Ω–Ω—è –æ—Ä–µ–Ω–¥–∞—Ä—è

–Ü—Å–Ω—É—é—Ç—å **–ø—É–±–ª—ñ—á–Ω—ñ API Azure**, —è–∫—ñ, –∑–Ω–∞—é—á–∏ **–¥–æ–º–µ–Ω –æ—Ä–µ–Ω–¥–∞—Ä—è**, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –∑–∞–ø–∏—Ç–∞—Ç–∏, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –±—ñ–ª—å—à–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –Ω—å–æ–≥–æ.\
–í–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø–∏—Ç—É–≤–∞—Ç–∏ API –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É PowerShell [**AADInternals**](https://github.com/Gerenios)**:**

| API                                                                  | –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è                                                                                                                                                                                                                                           | –§—É–Ω–∫—Ü—ñ—è AADInternals                             |
| -------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------- |
| login.microsoftonline.com/\<domain>/.well-known/openid-configuration | **–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤—Ö—ñ–¥**, –≤–∫–ª—é—á–∞—é—á–∏ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –æ—Ä–µ–Ω–¥–∞—Ä—è                                                                                                                                                                                             | `Get-AADIntTenantID -Domain <domain>`             |
| autodiscover-s.outlook.com/autodiscover/autodiscover.svc             | **–£—Å—ñ –¥–æ–º–µ–Ω–∏** –æ—Ä–µ–Ω–¥–∞—Ä—è                                                                                                                                                                                                                             | `Get-AADIntTenantDomains -Domain <domain>`        |
| login.microsoftonline.com/GetUserRealm.srf?login=\<UserName>         | <p><strong>–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤—Ö—ñ–¥</strong> –æ—Ä–µ–Ω–¥–∞—Ä—è, –≤–∫–ª—é—á–∞—é—á–∏ –Ω–∞–∑–≤—É –æ—Ä–µ–Ω–¥–∞—Ä—è —Ç–∞ –¥–æ–º–µ–Ω <strong>—Ç–∏–ø –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó.</strong><br>–Ø–∫—â–æ <code>NameSpaceType</code> - <strong><code>Managed</code></strong>, —Ü–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è <strong>AzureAD</strong>.</p> | `Get-AADIntLoginInformation -UserName <UserName>` |
| login.microsoftonline.com/common/GetCredentialType                   | –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤—Ö—ñ–¥, –≤–∫–ª—é—á–∞—é—á–∏ **—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∏–π –≤—Ö—ñ–¥ –Ω–∞ —Ä–æ–±–æ—á–∏–π —Å—Ç—ñ–ª**                                                                                                                                                                    | `Get-AADIntLoginInformation -UserName <UserName>` |

–í–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø–∏—Ç–∞—Ç–∏ –≤—Å—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –æ—Ä–µ–Ω–¥–∞—Ä—è Azure –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **–ª–∏—à–µ –æ–¥–Ω—ñ—î—ó –∫–æ–º–∞–Ω–¥–∏ –∑** [**–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ AADInternals**](https://github.com/Gerenios):
```powershell
Invoke-AADIntReconAsOutsider -DomainName corp.onmicrosoft.com | Format-Table
```
–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–≤–æ–¥—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –æ—Ä–µ–Ω–¥–∞—Ä—è Azure:
```
Tenant brand:       Company Ltd
Tenant name:        company
Tenant id:          1937e3ab-38de-a735-a830-3075ea7e5b39
DesktopSSO enabled: True

Name                           DNS   MX    SPF  Type      STS
----                           ---   --    ---  ----      ---
company.com                   True  True  True  Federated sts.company.com
company.mail.onmicrosoft.com  True  True  True  Managed
company.onmicrosoft.com       True  True  True  Managed
int.company.com              False False False  Managed
```
–ú–æ–∂–ª–∏–≤–æ —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—Ç–∏ –¥–µ—Ç–∞–ª—ñ –ø—Ä–æ –Ω–∞–∑–≤—É –æ—Ä–µ–Ω–¥–∞—Ä—è, ID —Ç–∞ –Ω–∞–∑–≤—É "–±—Ä–µ–Ω–¥—É". –î–æ–¥–∞—Ç–∫–æ–≤–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–æ —Å—Ç–∞—Ç—É—Å –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–≥–æ –≤—Ö–æ–¥—É –Ω–∞ —Ä–æ–±–æ—á–∏–π —Å—Ç—ñ–ª (SSO), —Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º–∏–π —è–∫ [**Seamless SSO**](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-sso). –ü—Ä–∏ –≤–≤—ñ–º–∫–Ω–µ–Ω–Ω—ñ —Ü—ñ—î—ó —Ñ—É–Ω–∫—Ü—ñ—ó —Å–ø—Ä–æ—â—É—î—Ç—å—Å—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ (–ø–µ—Ä–µ–ª—ñ–∫—É) –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ —Ü—ñ–ª—å–æ–≤—ñ–π –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó.

–ö—Ä—ñ–º —Ç–æ–≥–æ, –≤–∏–≤–æ–¥—è—Ç—å—Å—è –Ω–∞–∑–≤–∏ –≤—Å—ñ—Ö –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∏—Ö –¥–æ–º–µ–Ω—ñ–≤, –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑ —Ü—ñ–ª—å–æ–≤–∏–º –æ—Ä–µ–Ω–¥–∞—Ä–µ–º, —Ä–∞–∑–æ–º —ñ–∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º–∏ —Ç–∏–ø–∞–º–∏ —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ. –£ –≤–∏–ø–∞–¥–∫—É —Ñ–µ–¥–µ—Ä–∞—Ç–∏–≤–Ω–∏—Ö –¥–æ–º–µ–Ω—ñ–≤ —Ç–∞–∫–æ–∂ —Ä–æ–∑–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –ü–æ–≤–Ω–µ –Ü–º'—è –î–æ–º–µ–Ω—É (FQDN) –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—á–∞ —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ, –∑–∞–∑–≤–∏—á–∞–π —Å–µ—Ä–≤–µ—Ä–∞ ADFS. –°—Ç–æ–≤–ø–µ—Ü—å "MX" –≤–∫–∞–∑—É—î, —á–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑—É—é—Ç—å—Å—è –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ñ –ª–∏—Å—Ç–∏ –¥–æ Exchange Online, —Ç–æ–¥—ñ —è–∫ —Å—Ç–æ–≤–ø–µ—Ü—å "SPF" –ø–æ–∑–Ω–∞—á–∞—î –ø–µ—Ä–µ–ª—ñ–∫ Exchange Online —è–∫ –≤—ñ–¥–ø—Ä–∞–≤–Ω–∏–∫–∞ –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ—ó –ø–æ—à—Ç–∏. –í–∞–∂–ª–∏–≤–æ –∑–∞—É–≤–∞–∂–∏—Ç–∏, —â–æ –ø–æ—Ç–æ—á–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è —Ä–æ–∑–≤—ñ–¥–∫–∏ –Ω–µ –∞–Ω–∞–ª—ñ–∑—É—î –∑–∞—è–≤–∏ "include" —É –∑–∞–ø–∏—Å–∞—Ö SPF, —â–æ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –ø–æ–º–∏–ª–∫–æ–≤–∏—Ö –≤—ñ–¥–º–æ–≤.

### –ü–µ—Ä–µ–ª—ñ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

–ú–æ–∂–ª–∏–≤–æ **–ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —ñ—Å–Ω—É—î —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** –≤ –º–µ–∂–∞—Ö –æ—Ä–µ–Ω–¥–∞—Ä—è. –¶–µ —Ç–∞–∫–æ–∂ —Å—Ç–æ—Å—É—î—Ç—å—Å—è **–≥–æ—Å—Ç–µ–≤–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤**, —ñ–º'—è —è–∫–∏—Ö –º–∞—î –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç:
```
<email>#EXT#@<tenant name>.onmicrosoft.com
```
–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞ - —Ü–µ –∞–¥—Ä–µ—Å–∞ –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ—ó –ø–æ—à—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –¥–µ —Å–∏–º–≤–æ–ª "@" –∑–∞–º—ñ–Ω–µ–Ω–æ –Ω–∞ –ø—ñ–¥–∫—Ä–µ—Å–ª–µ–Ω–Ω—è "\_".

–ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é [**AADInternals**](https://github.com/Gerenios/AADInternals) –≤–∏ –º–æ–∂–µ—Ç–µ –ª–µ–≥–∫–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —ñ—Å–Ω—É—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á:
```powershell
# Check does the user exist
Invoke-AADIntUserEnumerationAsOutsider -UserName "user@company.com"
```
## Unauthenticated Enumeration and Initial Entry

### Introduction

In this section, we will cover the techniques used to perform unauthenticated enumeration and gain initial access to Azure environments.

### Unauthenticated Enumeration

#### Public Information Gathering

- **Azure Resource Manager (ARM) Endpoints**: Enumerate Azure Resource Manager (ARM) endpoints to discover publicly accessible services and resources.

- **Azure Storage Accounts**: Identify publicly accessible Azure storage accounts to potentially discover sensitive data.

- **Azure Blob Storage**: Enumerate Azure Blob Storage containers to find exposed data that may contain sensitive information.

- **Azure App Services**: Discover Azure App Services that might be misconfigured and expose sensitive data.

### Initial Entry

#### Exploiting Misconfigurations

- **Weak Access Controls**: Exploit weak access controls on Azure services to gain unauthorized access.

- **Default Credentials**: Attempt to log in using default credentials for Azure services.

- **Insecure Configurations**: Identify insecure configurations in Azure services that can be exploited to gain initial access.

- **Vulnerabilities**: Exploit known vulnerabilities in Azure services to gain unauthorized access.

By leveraging the techniques mentioned above, an attacker can perform unauthenticated enumeration and gain initial access to Azure environments.
```
UserName         Exists
--------         ------
user@company.com True
```
–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª, —â–æ –º—ñ—Å—Ç–∏—Ç—å –æ–¥–Ω—É –∞–¥—Ä–µ—Å—É –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ—ó –ø–æ—à—Ç–∏ –Ω–∞ —Ä—è–¥–æ–∫:
```
user@company.com
user2@company.com
admin@company.com
admin2@company.com
external.user_gmail.com#EXT#@company.onmicrosoft.com
external.user_outlook.com#EXT#@company.onmicrosoft.com
```

```powershell
# Invoke user enumeration
Get-Content .\users.txt | Invoke-AADIntUserEnumerationAsOutsider -Method Normal
```
–Ñ **—Ç—Ä–∏ —Ä—ñ–∑–Ω—ñ –º–µ—Ç–æ–¥–∏ –ø–µ—Ä–µ–ª—ñ–∫—É** –¥–ª—è –≤–∏–±–æ—Ä—É:

| –ú–µ—Ç–æ–¥     | –û–ø–∏—Å                                                                                                                                                                                                   |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| –ó–≤–∏—á–∞–π–Ω–∏–π | –¶–µ —Å—Ç–æ—Å—É—î—Ç—å—Å—è API GetCredentialType, –∑–≥–∞–¥–∞–Ω–æ–≥–æ –≤–∏—â–µ. –ú–µ—Ç–æ–¥ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º.                                                                                                                            |
| –í—Ö—ñ–¥      | <p>–¶–µ–π –º–µ—Ç–æ–¥ –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è —É–≤—ñ–π—Ç–∏ —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á.<br><strong>–ü—Ä–∏–º—ñ—Ç–∫–∞:</strong> –∑–∞–ø–∏—Ç–∏ –±—É–¥—É—Ç—å –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ –≤ –∂—É—Ä–Ω–∞–ª—ñ –≤—Ö–æ–¥—ñ–≤.</p>                                                                         |
| –ê–≤—Ç–æ–≤—Ö—ñ–¥  | <p>–¶–µ–π –º–µ—Ç–æ–¥ –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è —É–≤—ñ–π—Ç–∏ —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —á–µ—Ä–µ–∑ –∫—ñ–Ω—Ü–µ–≤—É —Ç–æ—á–∫—É –∞–≤—Ç–æ–≤—Ö–æ–¥—É.<br><strong>–ó–∞–ø–∏—Ç–∏ –Ω–µ —Ä–µ—î—Å—Ç—Ä—É—é—Ç—å—Å—è</strong> –≤ –∂—É—Ä–Ω–∞–ª—ñ –≤—Ö–æ–¥—ñ–≤! –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –ø—Ä–∞—Ü—é—î –¥–æ–±—Ä–µ —Ç–∞–∫–æ–∂ –¥–ª—è –∞—Ç–∞–∫ –º–µ—Ç–æ–¥–æ–º "–ø–æ–ª–∏–≤ –ø–∞—Ä–æ–ª—è" —Ç–∞ "–≥—Ä—É–±–æ—ó —Å–∏–ª–∏".</p> |

–ü—ñ—Å–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –¥—ñ–π—Å–Ω–∏—Ö —ñ–º–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ **—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```powershell
Get-AADIntLoginInformation -UserName root@corp.onmicrosoft.com
```
–°–∫—Ä–∏–ø—Ç [**o365creeper**](https://github.com/LMGsec/o365creeper) —Ç–∞–∫–æ–∂ –¥–æ–∑–≤–æ–ª—è—î –≤–∞–º –≤–∏—è–≤–∏—Ç–∏, **—á–∏ —î –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞ –¥—ñ–π—Å–Ω–æ—é**.
```powershell
# Put in emails.txt emails such as:
# - root@corp.onmicrosoft.com
python.exe .\o365creeper\o365creeper.py -f .\emails.txt -o validemails.txt
```
**–ü–µ—Ä–µ–ª—ñ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —á–µ—Ä–µ–∑ Microsoft Teams**

–©–µ –æ–¥–Ω–∏–º –¥–∂–µ—Ä–µ–ª–æ–º —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —î Microsoft Teams.

API Microsoft Teams –¥–æ–∑–≤–æ–ª—è—î —à—É–∫–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤. –ó–æ–∫—Ä–µ–º–∞, —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø—É "–ø–æ—à—É–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞" **externalsearchv3** —Ç–∞ **searchUsers** –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∑–∞–≥–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫—ñ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ –≤ Teams.

–ó–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ API –º–æ–∂–ª–∏–≤–æ –≤—ñ–¥—Ä—ñ–∑–Ω–∏—Ç–∏ –Ω–µ—ñ—Å–Ω—É—é—á–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –≤—ñ–¥ —ñ—Å–Ω—É—é—á–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫—ñ –º–∞—é—Ç—å –¥—ñ–π—Å–Ω—É –ø—ñ–¥–ø–∏—Å–∫—É –Ω–∞ Teams.

–°—Ü–µ–Ω–∞—Ä—ñ–π [**TeamsEnum**](https://github.com/sse-secure-systems/TeamsEnum) –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∑–∞–¥–∞–Ω–æ–≥–æ –Ω–∞–±–æ—Ä—É —ñ–º–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É API Teams.
```bash
python3 TeamsEnum.py -a password -u <username> -f inputlist.txt -o teamsenum-output.json
```
## Unauthenticated Enumeration and Initial Entry

### Introduction

In this section, we will cover the techniques used to perform unauthenticated enumeration and gain initial access to Azure environments. Unauthenticated enumeration involves gathering information without the need for valid credentials, which can help identify potential entry points for further exploitation.

### Tools and Techniques

1. **Public Information Gathering**: Utilize search engines, public repositories, and other open sources to gather information about the target Azure environment.
   
2. **Subdomain Enumeration**: Use tools like `Sublist3r` or `Amass` to discover subdomains associated with the target Azure environment.
   
3. **Service Enumeration**: Identify exposed services and ports using tools like `Nmap` or `Masscan` to understand the attack surface.
   
4. **Vulnerability Scanning**: Conduct vulnerability scans using tools like `Nessus` or `OpenVAS` to identify potential security weaknesses.
   
5. **Exploitation**: Once vulnerabilities are identified, exploit them using appropriate tools and techniques to gain initial access.

### Recommendations

- Regularly monitor and secure public information related to your Azure environment to prevent unauthorized access.
- Conduct periodic vulnerability assessments to identify and address security issues proactively.
- Implement strong access controls and authentication mechanisms to protect against unauthorized entry.

By following these techniques and recommendations, you can enhance the security posture of your Azure environment and mitigate potential risks.
```
[-] user1@domain - Target user not found. Either the user does not exist, is not Teams-enrolled or is configured to not appear in search results (personal accounts only)
[+] user2@domain - User2 | Company (Away, Mobile)
[+] user3@domain - User3 | Company (Available, Desktop)
```
–ö—Ä—ñ–º —Ç–æ–≥–æ, –º–æ–∂–ª–∏–≤–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å —ñ—Å–Ω—É—é—á–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —Ç–∞–∫—É —è–∫ –Ω–∞—Å—Ç—É–ø–Ω–µ:

- –î–æ—Å—Ç—É–ø–Ω–∏–π
- –í—ñ–¥—Å—É—Ç–Ω—ñ–π
- –ù–µ —Ç—É—Ä–±—É–≤–∞—Ç–∏
- –ó–∞–π–Ω—è—Ç–∏–π
- –ù–µ –≤ –º–µ—Ä–µ–∂—ñ

–Ø–∫—â–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ **–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –≤ –æ—Ñ—ñ—Å—ñ**, —Ç–∞–∫–æ–∂ –º–æ–∂–ª–∏–≤–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ü–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é TeamsEnum. –Ø–∫—â–æ –±—É–≤ –≤–∫–∞–∑–∞–Ω–∏–π –≤–∏—Ö—ñ–¥–Ω–∏–π —Ñ–∞–π–ª, –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –≤ –æ—Ñ—ñ—Å—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É —Ñ–∞–π–ª—ñ JSON:
```
jq . teamsenum-output.json
```
## –ù–µ–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–µ –≤–∏–≤–µ–¥–µ–Ω–Ω—è —Ç–∞ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –≤—Ö—ñ–¥

–¶–µ–π —Å–∫—Ä–∏–ø—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –±–∞–∑–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ Azure, —Ç–∞–∫–æ—ó —è–∫ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø—ñ–¥–ø–∏—Å–∫—É, –≥—Ä—É–ø–∏ —Ä–µ—Å—É—Ä—Å—ñ–≤, —Ä–µ—Å—É—Ä—Å–∏ —Ç–∞ —ñ–Ω—à—ñ –¥–∞–Ω—ñ, –±–µ–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó. –¶–µ –º–æ–∂–µ –±—É—Ç–∏ –∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É –∞—Ç–∞–∫–∏ –∞–±–æ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤–∏—Ö—ñ–¥–Ω–æ—ó —Ç–æ—á–∫–∏ –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è.
```json
{
"email": "user2@domain",
"exists": true,
"info": [
{
"tenantId": "[REDACTED]",
"isShortProfile": false,
"accountEnabled": true,
"featureSettings": {
"coExistenceMode": "TeamsOnly"
},
"userPrincipalName": "user2@domain",
"givenName": "user2@domain",
"surname": "",
"email": "user2@domain",
"tenantName": "Company",
"displayName": "User2",
"type": "Federated",
"mri": "8:orgid:[REDACTED]",
"objectId": "[REDACTED]"
}
],
"presence": [
{
"mri": "8:orgid:[REDACTED]",
"presence": {
"sourceNetwork": "Federated",
"calendarData": {
"outOfOfficeNote": {
"message": "Dear sender. I am out of the office until March 23rd with limited access to my email. I will respond after my return.Kind regards, User2",
"publishTime": "2023-03-15T21:44:42.0649385Z",
"expiry": "2023-04-05T14:00:00Z"
},
"isOutOfOffice": true
},
"capabilities": [
"Audio",
"Video"
],
"availability": "Away",
"activity": "Away",
"deviceType": "Mobile"
},
"etagMatch": false,
"etag": "[REDACTED]",
"status": 20000
}
]
}
```
## Azure –°–µ—Ä–≤—ñ—Å–∏

–ó–Ω–∞—é—á–∏ **–¥–æ–º–µ–Ω–∏ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞ Azure**, –Ω–∞ —è–∫—ñ –≤—ñ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î, —á–∞—Å —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–Ω–∞–π—Ç–∏ **–≤—ñ–¥–∫—Ä–∏—Ç—ñ Azure —Å–µ—Ä–≤—ñ—Å–∏**.

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –º–µ—Ç–æ–¥ –∑ [**MicroBust**](https://github.com/NetSPI/MicroBurst) –¥–ª—è –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è —Ü—ñ—î—ó –º–µ—Ç–∏. –¶—è —Ñ—É–Ω–∫—Ü—ñ—è –±—É–¥–µ —à—É–∫–∞—Ç–∏ –±–∞–∑–æ–≤–µ —ñ–º'—è –¥–æ–º–µ–Ω—É (—ñ –∫—ñ–ª—å–∫–∞ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ–∫) –≤ –∫—ñ–ª—å–∫–æ—Ö **–¥–æ–º–µ–Ω–∞—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ Azure:**
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1 -Verbose
Invoke-EnumerateAzureSubDomains -Base corp -Verbose
```
## –í—ñ–¥–∫—Ä–∏—Ç–µ —Å—Ö–æ–≤–∏—â–µ

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏—è–≤–∏—Ç–∏ –≤—ñ–¥–∫—Ä–∏—Ç–µ —Å—Ö–æ–≤–∏—â–µ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ç–∞–∫–æ–≥–æ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É, —è–∫ [**InvokeEnumerateAzureBlobs.ps1**](https://github.com/NetSPI/MicroBurst/blob/master/Misc/Invoke-EnumerateAzureBlobs.ps1), —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ñ–∞–π–ª **`Microburst/Misc/permitations.txt`** –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ–∫ (–¥—É–∂–µ –ø—Ä–æ—Å—Ç–æ) –¥–ª—è —Å–ø—Ä–æ–±–∏ **–∑–Ω–∞–π—Ç–∏ –≤—ñ–¥–∫—Ä–∏—Ç—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ —Å—Ö–æ–≤–∏—â**.
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1
Invoke-EnumerateAzureBlobs -Base corp
[...]
https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
[...]

# Access https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
# Check: <Name>ssh_info.json</Name>
# Access then https://corpcommon.blob.core.windows.net/secrets/ssh_info.json
```
### SAS URLs

_**URL —Å–ø—ñ–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É**_ (SAS) - —Ü–µ URL, —è–∫–∏–π **–Ω–∞–¥–∞—î –¥–æ—Å—Ç—É–ø** –¥–æ –ø–µ–≤–Ω–æ—ó —á–∞—Å—Ç–∏–Ω–∏ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å—Ö–æ–≤–∏—â–∞ (–º–æ–∂–µ –±—É—Ç–∏ –ø–æ–≤–Ω–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º, —Ñ–∞–π–ª–æ–º...) –∑ –ø–µ–≤–Ω–∏–º–∏ —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏–º–∏ –¥–æ–∑–≤–æ–ª–∞–º–∏ (—á–∏—Ç–∞–Ω–Ω—è, –∑–∞–ø–∏—Å...) –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤. –Ø–∫—â–æ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ –≤–∏—Ç—ñ–∫, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó, –≤–æ–Ω–∏ –≤–∏–≥–ª—è–¥–∞—é—Ç—å —Ç–∞–∫ (—Ü–µ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, —è–∫—â–æ —Ü–µ –±—É–ª–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–¥–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Ñ–∞–π–ª—É, —à–ª—è—Ö URL —Ç–∞–∫–æ–∂ –±—É–¥–µ –º—ñ—Å—Ç–∏—Ç–∏ —Ü–µ–π —Ñ–∞–π–ª):

`https://<storage_account_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ [**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/) –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö

## –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—è –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö

### –†–∏–±–∞–ª—å—Å—Ç–≤–æ

* [**–ó–∞–≥–∞–ª—å–Ω–µ —Ä–∏–±–∞–ª—å—Å—Ç–≤–æ**](https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology) (–æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –∞–±–æ OAuth App -[–ê—Ç–∞–∫–∞ –Ω–∞ –Ω–µ–∑–∞–∫–æ–Ω–Ω–µ –Ω–∞–¥–∞–Ω–Ω—è –∑–≥–æ–¥–∏](az-illicit-consent-grant.md)-)
* [**–†–∏–±–∞–ª—å—Å—Ç–≤–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∑–∞ –∫–æ–¥–æ–º –ø—Ä–∏—Å—Ç—Ä–æ—é**](az-device-code-authentication-phishing.md)

### –ü–∞—Ä–æ–ª—å–Ω–µ —Ä–æ–∑–ø–∏–ª–µ–Ω–Ω—è / –ë—Ä—É—Ç—Ñ–æ—Ä—Å

{% content-ref url="az-password-spraying.md" %}
[az-password-spraying.md](az-password-spraying.md)
{% endcontent-ref %}

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://aadinternals.com/post/just-looking/](https://aadinternals.com/post/just-looking/)
* [https://www.securesystems.de/blog/a-fresh-look-at-user-enumeration-in-microsoft-teams/](https://www.securesystems.de/blog/a-fresh-look-at-user-enumeration-in-microsoft-teams/)

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–ª–æ–º AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è AWS Red Team Expert (ARTE) –≤—ñ–¥ HackTricks**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–ª–æ–º GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è GCP Red Team Expert (GRTE) –≤—ñ–¥ HackTricks**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫–µ—Ä—Å—å–∫—ñ —Ç—Ä—é–∫–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}
