# Az AD Connect - Identit√† Ibrida

{% hint style="success" %}
Impara e pratica l'Hacking su AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Impara e pratica l'Hacking su GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>
{% endhint %}

## Informazioni di Base

L'integrazione tra **Active Directory (AD) in locale** e **Azure AD** √® facilitata da **Azure AD Connect**, offrendo vari metodi che supportano il **Single Sign-on (SSO)**. Ogni metodo, sebbene utile, presenta potenziali vulnerabilit√† di sicurezza che potrebbero essere sfruttate per compromettere ambienti cloud o in locale:

* **Autenticazione Pass-Through (PTA)**:
- Possibile compromissione dell'agente sull'AD in locale, consentendo la convalida delle password degli utenti per le connessioni ad Azure (da locale a Cloud).
- Possibilit√† di registrare un nuovo agente per convalidare autenticazioni in una nuova posizione (da Cloud a locale).

{% content-ref url="pta-pass-through-authentication.md" %}
[pta-pass-through-authentication.md](pta-pass-through-authentication.md)
{% endcontent-ref %}

* **Sincronizzazione dell'Hash delle Password (PHS)**:
- Possibile estrazione delle password in chiaro degli utenti privilegiati dall'AD, inclusa le credenziali di un utente AzureAD auto-generato ad alto privilegio.

{% content-ref url="phs-password-hash-sync.md" %}
[phs-password-hash-sync.md](phs-password-hash-sync.md)
{% endcontent-ref %}

* **Federazione**:
- Furto della chiave privata utilizzata per la firma SAML, consentendo l'impersonificazione delle identit√† in locale e cloud.

{% content-ref url="federation.md" %}
[federation.md](federation.md)
{% endcontent-ref %}

* **SSO Continuo:**
- Furto della password dell'utente `AZUREADSSOACC`, utilizzata per firmare i biglietti Kerberos silver, consentendo l'impersonificazione di qualsiasi utente cloud.

{% content-ref url="seamless-sso.md" %}
[seamless-sso.md](seamless-sso.md)
{% endcontent-ref %}

* **Trust Kerberos Cloud**:
- Possibilit√† di scalare da Global Admin a Domain Admin in locale manipolando i nomi utente e gli SIDs degli utenti AzureAD e richiedendo TGT da AzureAD.

{% content-ref url="az-cloud-kerberos-trust.md" %}
[az-cloud-kerberos-trust.md](az-cloud-kerberos-trust.md)
{% endcontent-ref %}

* **Applicazioni Predefinite**:
- Compromettere un account Amministratore dell'Applicazione o l'account di Sincronizzazione in locale consente la modifica delle impostazioni della directory, l'appartenenza ai gruppi, gli account utente, i siti SharePoint e i file di OneDrive.

{% content-ref url="az-default-applications.md" %}
[az-default-applications.md](az-default-applications.md)
{% endcontent-ref %}

Per ciascun metodo di integrazione, la sincronizzazione degli utenti viene effettuata e viene creato un account `MSOL_<installationidentifier>` nell'AD in locale. In particolare, sia i metodi **PHS** che **PTA** facilitano il **SSO Continuo**, consentendo l'accesso automatico per i computer Azure AD connessi al dominio in locale.

Per verificare l'installazione di **Azure AD Connect**, √® possibile utilizzare il seguente comando PowerShell, utilizzando il modulo **AzureADConnectHealthSync** (installato per impostazione predefinita con Azure AD Connect):
```powershell
Get-ADSyncConnector
```
{% hint style="success" %}
Impara e pratica l'hacking su AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Impara e pratica l'hacking su GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Sostieni HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repository di Github.

</details>
{% endhint %}
