# Az - 쿠키 전달

{% hint style="success" %}
AWS 해킹 학습 및 실습:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP 해킹 학습 및 실습: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks 지원</summary>

* [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* 💬 [**디스코드 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **가입**하거나 **트위터** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**를 팔로우**하세요.
* **HackTricks** 및 **HackTricks Cloud** 깃허브 저장소에 PR을 제출하여 해킹 트릭을 공유하세요.

</details>
{% endhint %}

## 왜 쿠키를 사용하는가?

브라우저 **쿠키**는 **인증 및 MFA 우회**에 효과적인 메커니즘입니다. 사용자가 이미 응용 프로그램에서 인증했기 때문에 세션 **쿠키**를 사용하여 다시 인증할 필요 없이 해당 사용자로 데이터에 **액세스**할 수 있습니다.

**브라우저 쿠키가 위치한 곳**을 확인할 수 있습니다:

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/specific-software-file-type-tricks/browser-artifacts?q=browse#google-chrome" %}

## 공격

도전적인 부분은 이러한 **쿠키가 Microsoft Data Protection API (DPAPI)**를 통해 **사용자**를 위해 암호화된다는 것입니다. 이는 해당 사용자에 속한 쿠키에 연결된 암호화 [키로 암호화됩니다](https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dpapi-extracting-passwords). 이에 대한 자세한 정보는 다음에서 확인할 수 있습니다:

{% embed url="https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dpapi-extracting-passwords" %}

Mimikatz를 사용하면 이 명령을 사용하여 **사용자의 쿠키를 추출**할 수 있습니다.
```bash
mimikatz.exe privilege::debug log "dpapi::chrome /in:%localappdata%\google\chrome\USERDA~1\default\cookies /unprotect" exit
```
Azure에서는 사용자가 최근 Azure에서 활동했기 때문에 **`ESTSAUTH`**, **`ESTSAUTHPERSISTENT`**, **`ESTSAUTHLIGHT`**와 같은 인증 쿠키가 중요합니다.

단순히 login.microsoftonline.com으로 이동하고 **`ESTSAUTHPERSISTENT`** 쿠키(“Stay Signed In” 옵션으로 생성) 또는 **`ESTSAUTH`** 쿠키를 추가하면 인증됩니다.

## 참고 자료

* [https://stealthbits.com/blog/bypassing-mfa-with-pass-the-cookie/](https://stealthbits.com/blog/bypassing-mfa-with-pass-the-cookie/)
