# Az - Sertifikayı Geçir

{% hint style="success" %}
AWS Hacking'i öğrenin ve uygulayın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitimi AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitimi GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking püf noktalarını paylaşarak PR'ler göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
{% endhint %}

## Sertifikayı Geçir (Azure)

Azure'a katılan makinelerde, **NegoEx** kimlik doğrulama mekanizmasını destekleyen her iki makineden birinden diğerine sertifikalar kullanılarak kimlik doğrulaması yapmak mümkündür. Bu sertifikalar, gereken kullanıcı için Azure AD CA tarafından verilmelidir (konu olarak).

Süper basitleştirilmiş terimlerle:

* Bağlantı başlatan makine (istemci) **kullanıcı için Azure AD'den bir sertifikaya ihtiyaç duyar**.
* İstemci, PRT ve diğer detayları içeren bir JSON Web Token (JWT) başlığı oluşturur, bunu Türetilmiş anahtarı kullanarak (oturum anahtarı ve güvenlik bağlamını kullanarak) imzalar ve **Azure AD'ye gönderir**.
* Azure AD, istemci oturum anahtarı ve güvenlik bağlamını kullanarak JWT imzasını doğrular, PRT'nin geçerliliğini kontrol eder ve **sertifika ile yanıt verir**.

Bu senaryoda ve [**PRT'yi Geçir**](pass-the-prt.md) saldırısı için gerekli tüm bilgileri topladıktan sonra:

* Kullanıcı adı
* Kiracı Kimliği
* PRT
* Güvenlik bağlamı
* Türetilmiş Anahtar

Kullanıcı için **P2P sertifikası talep etmek** mümkündür [**PrtToCert**](https://github.com/morRubin/PrtToCert)** aracıyla:**

{% code overflow="wrap" %}
```bash
RequestCert.py [-h] --tenantId TENANTID --prt PRT --userName USERNAME --hexCtx HEXCTX --hexDerivedKey HEXDERIVEDKEY [--passPhrase PASSPHRASE]
```
{% endcode %}

Sertifikalar, PRT ile aynı süreyle geçerli olacaktır. Sertifikayı kullanmak için [**AzureADJoinedMachinePTC**](https://github.com/morRubin/AzureADJoinedMachinePTC) adlı python aracını kullanabilirsiniz, bu araç uzak makineye **kimlik doğrulaması yapacak**, **PSEXEC** çalıştıracak ve **kurban makinede bir CMD açacaktır**. Bu, bize Mimikatz'ı tekrar kullanma imkanı verecektir ve başka bir kullanıcının PRT'sini alabileceğiz.
```bash
Main.py [-h] --usercert USERCERT --certpass CERTPASS --remoteip REMOTEIP
```
## Referanslar

* Pass the Certificate'nasıl çalıştığını daha detaylı öğrenmek için orijinal yazıya göz atın [https://medium.com/@mor2464/azure-ad-pass-the-certificate-d0c5de624597](https://medium.com/@mor2464/azure-ad-pass-the-certificate-d0c5de624597)

{% hint style="success" %}
AWS Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* Hacking püf noktalarını paylaşarak PR'ler göndererek **HackTricks** ve **HackTricks Cloud** github depolarına katkıda bulunun.

</details>
{% endhint %}
