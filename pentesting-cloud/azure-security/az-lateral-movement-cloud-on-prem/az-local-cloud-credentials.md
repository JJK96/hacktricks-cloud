# Az - Credenciales locales de la nube

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Entrenamiento HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Entrenamiento HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripción**](https://github.com/sponsors/carlospolop)!
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **síguenos** en **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Almacenamiento local de tokens y consideraciones de seguridad

### Azure CLI (Interfaz de línea de comandos)

Los tokens y datos sensibles se almacenan localmente en Azure CLI, lo que plantea preocupaciones de seguridad:

1. **Tokens de acceso**: Se almacenan en texto plano en `accessTokens.json` ubicado en `C:\Users\<nombredeusuario>\.Azure`.
2. **Información de suscripción**: `azureProfile.json`, en el mismo directorio, contiene detalles de la suscripción.
3. **Archivos de registro**: La carpeta `ErrorRecords` dentro de `.azure` podría contener registros con credenciales expuestas, como:
- Comandos ejecutados con credenciales incrustadas.
- URLs accedidas utilizando tokens, revelando potencialmente información sensible.

### Azure PowerShell

Azure PowerShell también almacena tokens y datos sensibles, que pueden ser accedidos localmente:

1. **Tokens de acceso**: `TokenCache.dat`, ubicado en `C:\Users\<nombredeusuario>\.Azure`, almacena tokens de acceso en texto plano.
2. **Secretos de Principales de Servicio**: Estos se almacenan sin cifrar en `AzureRmContext.json`.
3. **Función de Guardado de Token**: Los usuarios tienen la capacidad de persistir tokens utilizando el comando `Save-AzContext`, el cual debe ser utilizado con precaución para prevenir accesos no autorizados.

## Herramientas automáticas para encontrarlos

* [**Winpeas**](https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS/winPEASexe)
* [**Get-AzurePasswords.ps1**](https://github.com/NetSPI/MicroBurst/blob/master/AzureRM/Get-AzurePasswords.ps1)

## Recomendaciones de seguridad

Considerando el almacenamiento de datos sensibles en texto plano, es crucial asegurar estos archivos y directorios mediante:
- Limitar los derechos de acceso a estos archivos.
- Monitorear y auditar regularmente estos directorios en busca de accesos no autorizados o cambios inesperados.
- Emplear cifrado para archivos sensibles cuando sea posible.
- Educar a los usuarios sobre los riesgos y las mejores prácticas para manejar esta información sensible.


{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Entrenamiento HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Entrenamiento HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripción**](https://github.com/sponsors/carlospolop)!
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **síguenos** en **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
