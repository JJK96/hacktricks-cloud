# Az - Πλευρική Κίνηση (Σύννεφο - Εντός Εταιρείας)

## Az - Πλευρική Κίνηση (Σύννεφο - Εντός Εταιρείας)

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 στην [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ υποβάλλοντας PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

### Μηχανές Εντός Εταιρείας συνδεδεμένες στο Σύννεφο

Υπάρχουν διαφορετικοί τρόποι με τους οποίους μια μηχανή μπορεί να συνδεθεί στο σύννεφο:

#### Συμμετοχή στο Azure AD

<figure><img src="../../../.gitbook/assets/image (259).png" alt=""><figcaption></figcaption></figure>

#### Συμμετοχή στο Workplace

<figure><img src="../../../.gitbook/assets/image (222).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### Συμμετοχή σε Υβριδικό Περιβάλλον

<figure><img src="../../../.gitbook/assets/image (178).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### Συμμετοχή στο Workplace στο AADJ ή σε Υβριδικό Περιβάλλον

<figure><img src="../../../.gitbook/assets/image (252).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large</a></p></figcaption></figure>

### Διακριτικά και Περιορισμοί <a href="#tokens-and-limitations" id="tokens-and-limitations"></a>

Στο Azure AD, υπάρχουν διαφορετικοί τύποι διακριτικών με συγκεκριμένους περιορισμούς:

* **Διακριτικά Πρόσβασης**: Χρησιμοποιούνται για την πρόσβαση σε APIs και πόρους όπως το Microsoft Graph. Είναι συνδεδεμένα με ένα συγκεκριμένο πελάτη και πόρο.
* **Διακριτικά Ανανέωσης**: Εκδίδονται σε εφαρμογές για την απόκτηση νέων διακριτικών πρόσβασης. Μπορούν να χρησιμοποιηθούν μόνο από την εφαρμογή στην οποία εκδόθηκαν ή από μια ομάδα εφαρμογών.
* **Πρωτεύοντα Διακριτικά Ανανέωσης (PRT)**: Χρησιμοποιούνται για Ενιαία Σύνδεση στο Azure AD σε συσκευές που έχουν συμμετάσχει, εγγεγραμμένες ή σε υβριδικό περιβάλλον. Μπορούν να χρησιμοποιηθούν σε ροές σύνδεσης μέσω προγράμματος περιήγησης και για σύνδεση σε κινητές και επιφανειακές εφαρμογές στη συσκευή.
* **Κλειδιά Windows Hello for Business (WHFB)**: Χρησιμοποιούνται για αυθεντικοποίηση χωρίς κωδικό. Χρησιμοποιούνται για την απόκτηση Πρωτεύοντων Διακριτικών Ανανέωσης.

Ο πιο ενδιαφέρων τύπος διακριτικού είναι το Πρωτεύον Διακριτικό Ανανέωσης (PRT).

{% content-ref url="az-primary-refresh-token-prt.md" %}
[az-primary-refresh-token-prt.md](az-primary-refresh-token-prt.md)
{% endcontent-ref %}

### Τεχνικές Ανακατεύθυνσης

Από τη **συμβιβασμένη μηχανή προς το σύννεφο**:

* [**Περάστε το Cookie**](az-pass-the-cookie.md): Κλέψτε τα cookies του Azure από τον περιηγητή και χρησιμοποιήστε τα για σύνδεση
* **Απορρίψτε τα διακριτικά πρόσβασης των διεργασιών**: Όπως εξηγείται σε [**αυτό το βίντεο**](https://www.youtube.com/watch?v=OHKZkXC4Duw), ορισμένο λογισμικό της Microsoft που συγχρονίζεται με το σύννεφο (Excel, Teams...) μπορεί να αποθηκεύει διακριτικά πρόσβασης σε κείμενο στη μνήμη. Έτσι, απλά απορρίπτοντας τη μνήμη της διεργασίας και αναζητώντας για JWT διακριτικά μπορεί να σας παραχωρήσει πρόσβαση σε πολλούς πόρους του θύματος στο σύννεφο παρακάμπτοντας το MFA.
* [**Ψάρεμα Πρωτεύοντος Διακριτικού Ανανέωσης**](az-phishing-primary-refresh-token-microsoft-entra.md)**:** Ψαρέψτε το PRT για κατάχρηση
* [**Περάστε το PRT**](pass-the-prt.md): Κλέψτε το PRT της συσκευής για πρόσβαση στο Azure παριστάνοντάς το.
* [**Περάστε το Πιστοποιητικό**](az-pass-the-certificate.md)**:** Δημιουργήστε ένα πιστοποιητικό βασισμένο στο PRT για σύνδεση από μια μηχανή σε μια άλλη

Από τη συμβιβασμένη **AD** προς το συμβιβασμένο **Σύννεφο** και από το συμβιβασμένο **Σύννεφο** προς το συμβιβασμένο **AD**:

* [**Σύνδεση Azure AD**](azure-ad-connect-hybrid-identity/)
* **Ένας άλλος τρόπος ανακατεύθυνσης από το σύννεφο στο Εντός Εταιρείας είναι** [**η κατάχρηση του Intune**](../az-services/intune.md)

#### [Roadtx](https://github.com/dirkjanm/ROADtools)

Αυτό το εργαλείο επιτρέπει την εκτέλεση διαφόρων ενεργειών όπως εγγραφή μιας μηχανής στο Azure AD για την απόκτηση ενός PRT και τη χρήση PRTs (νόμιμα ή κλεμμένα) για την πρόσβαση σε πόρους με διαφορετικούς τρόπους. Δεν πρόκειται για άμεσες επιθέσεις, αλλά διευκολύνει τη χρήση των PRTs για την πρόσβαση σε πόρους με διαφορετικούς τρόπους. Βρείτε περισσότερες πληροφορίες στο [https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/](https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/)

## Αναφορές

* [https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/](https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/)

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 στην [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ υποβάλλοντας PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
