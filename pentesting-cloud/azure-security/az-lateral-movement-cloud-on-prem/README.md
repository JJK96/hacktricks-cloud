# Az - Lateral Movement (Cloud - On-Prem)

## Az - Lateral Movement (Cloud - On-Prem)

{% hint style="success" %}
Jifunze na kufanya mazoezi ya AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze na kufanya mazoezi ya GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mipango ya usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### Mashine za On-Prem zilizounganishwa na wingu

Kuna njia tofauti ambazo mashine inaweza kuunganishwa na wingu:

#### Azure AD joined

<figure><img src="../../../.gitbook/assets/image (259).png" alt=""><figcaption></figcaption></figure>

#### Workplace joined

<figure><img src="../../../.gitbook/assets/image (222).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### Hybrid joined

<figure><img src="../../../.gitbook/assets/image (178).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### Workplace joined on AADJ or Hybrid

<figure><img src="../../../.gitbook/assets/image (252).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large</a></p></figcaption></figure>

### Tokens na vikwazo <a href="#tokens-and-limitations" id="tokens-and-limitations"></a>

Katika Azure AD, kuna aina tofauti za tokens zenye vikwazo maalum:

* **Access tokens**: Zinatumika kufikia APIs na rasilimali kama Microsoft Graph. Zimefungwa kwa mteja maalum na rasilimali.
* **Refresh tokens**: Zinapeanwa kwa programu kupata access tokens mpya. Zinaweza kutumiwa tu na programu zilizopewa au kundi la programu.
* **Primary Refresh Tokens (PRT)**: Zinatumika kwa Single Sign-On kwenye vifaa vilivyounganishwa na Azure AD, vilivyosajiliwa, au vilivyounganishwa kwa hybrid. Zinaweza kutumiwa katika mtiririko wa kuingia kwenye kivinjari na kwa kuingia kwenye programu za simu na desktop kwenye kifaa.

Aina ya token inayovutia zaidi ni Primary Refresh Token (PRT).

{% content-ref url="az-primary-refresh-token-prt.md" %}
[az-primary-refresh-token-prt.md](az-primary-refresh-token-prt.md)
{% endcontent-ref %}

### Mbinu za Pivoting

Kutoka **mashine iliyodukuliwa hadi wingu**:

* [**Pass the Cookie**](az-pass-the-cookie.md): Kuiba cookies za Azure kutoka kwenye kivinjari na kuzitumia kuingia
* [**Phishing Primary Refresh Token**](az-phishing-primary-refresh-token-microsoft-entra.md)**:** Kudanganya PRT ili kuitumia vibaya
* [**Pass the PRT**](pass-the-prt.md): Kuiba PRT ya kifaa ili kufikia Azure kwa kujifanya
* [**Pass the Certificate**](az-pass-the-certificate.md)**:** Kutengeneza cheti kulingana na PRT ili kuingia kutoka mashine moja hadi nyingine

Kutoka kudukua **AD** hadi kudukua **Cloud** na kutoka kudukua **Cloud** hadi kudukua **AD**:

* [**Azure AD Connect**](azure-ad-connect-hybrid-identity/)
* **Njia nyingine ya pivot kutoka wingu hadi On-Prem ni** [**kutumia Intune**](../az-services/intune.md)

#### [Roadtx](https://github.com/dirkjanm/ROADtools)

Chombo hiki kinakuwezesha kufanya vitendo kadhaa kama kusajili mashine kwenye Azure AD kupata PRT, na kutumia PRTs (halali au zilizoibiwa) kufikia rasilimali kwa njia tofauti. Hizi si mashambulizi ya moja kwa moja, lakini inarahisisha matumizi ya PRTs kufikia rasilimali kwa njia tofauti. Pata maelezo zaidi kwenye [https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/](https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/)

## Marejeleo

* [https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/](https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/)

{% hint style="success" %}
Jifunze na kufanya mazoezi ya AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze na kufanya mazoezi ya GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mipango ya usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
