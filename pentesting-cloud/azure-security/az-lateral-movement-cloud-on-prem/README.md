# Az - Harakati za Upande (Mawingu - Kwenye-Prem)

## Az - Harakati za Upande (Mawingu - Kwenye-Prem)

{% hint style="success" %}
Jifunze na zoezi la Kuvamia AWS:<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">[**Mafunzo ya HackTricks AWS Timu Nyekundu Mtaalam (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze na zoezi la Kuvamia GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**Mafunzo ya HackTricks GCP Timu Nyekundu Mtaalam (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>unga mkono HackTricks</summary>

* Angalia [**mpango wa usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za kuvamia kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
{% endhint %}

### Mashine za Kwenye-Prem zilizounganishwa na mawingu

Kuna njia tofauti ambazo mashine inaweza kuunganishwa na mawingu:

#### Kujiunga na Azure AD

<figure><img src="../../../.gitbook/assets/image (259).png" alt=""><figcaption></figcaption></figure>

#### Kujiunga na Mahali pa Kazi

<figure><img src="../../../.gitbook/assets/image (222).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### Kujiunga kwa Njia ya Kihybrid

<figure><img src="../../../.gitbook/assets/image (178).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### Kujiunga na Mahali pa Kazi kwenye AADJ au Kihybrid

<figure><img src="../../../.gitbook/assets/image (252).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large</a></p></figcaption></figure>

### Vyeti na Vizuizi <a href="#tokens-and-limitations" id="tokens-and-limitations"></a>

Katika Azure AD, kuna aina tofauti za vifaa vya kipekee na vizuizi maalum:

* **Vyeti vya Upatikanaji**: Hutumiwa kupata APIs na rasilimali kama Microsoft Graph. Vinahusishwa na mteja na rasilimali maalum.
* **Vyeti vya Kufufua**: Hutolewa kwa programu ili kupata vyeti vipya vya upatikanaji. Vinaweza kutumiwa tu na programu ambayo ilipewa au kikundi cha programu.
* **Vyeti vya Kufufua vya Msingi (PRT)**: Hutumiwa kwa Kuingia Mara Moja kwenye vifaa vilivyojiunga na Azure AD, vilivyosajiliwa, au vilivyohybrid. Vinaweza kutumika katika mifumo ya kuingia kwa kivinjari na kwa kuingia kwenye programu za simu na desktop kwenye kifaa.
* **Vyeti vya Windows Hello kwa Biashara (WHFB)**: Hutumiwa kwa uthibitisho usio na nywila. Hutumiwa kupata Vyeti vya Kufufua vya Msingi.

Aina ya kuvutia zaidi ya cheti ni Cheti cha Kufufua cha Msingi (PRT).

{% content-ref url="az-primary-refresh-token-prt.md" %}
[az-primary-refresh-token-prt.md](az-primary-refresh-token-prt.md)
{% endcontent-ref %}

### Mbinu za Kubadilisha Mwelekeo

Kutoka kwa **mashine iliyovamiwa kwenda kwenye mawingu**:

* [**Pitisha Kuki**](az-pass-the-cookie.md): Pora vidakuzi vya Azure kutoka kivinjari na utumie kuingia
* **Dump mchakato wa vyeti vya upatikanaji**: Kama ilivyoelezwa katika [**video hii**](https://www.youtube.com/watch?v=OHKZkXC4Duw), baadhi ya programu za Microsoft zilizosawazishwa na mawingu (Excel, Teams...) zinaweza kuhifadhi vyeti vya upatikanaji kwa wazi katika kumbukumbu. Kwa hivyo, tu kudondosha kumbukumbu ya mchakato na kutafuta JWT vyeti kunaweza kukupatia upatikanaji wa rasilimali kadhaa za muathiriwa kwenye mawingu kwa kuzidi MFA.
* [**Uvutaji wa Cheti cha Kufufua cha Msingi**](az-phishing-primary-refresh-token-microsoft-entra.md)**:** Uvute PRT ili kuabudu
* [**Pitisha PRT**](pass-the-prt.md): Pora PRT ya kifaa ili kupata Azure kwa kujifanya kuwa ni hicho.
* [**Pitisha Cheti**](az-pass-the-certificate.md)**:** Unda cheti kulingana na PRT ili kuingia kutoka kwenye mashine moja kwenda nyingine

Kutoka kwa kuvamia **AD** hadi kuvamia **Mawingu** na kutoka kwa kuvamia **Mawingu** hadi kuvamia **AD**:

* [**Unganisho wa Azure AD**](azure-ad-connect-hybrid-identity/)
* **Njia nyingine ya kubadilisha kutoka mawingu kwenda Kwenye-Prem ni** [**kutumia Intune vibaya**](../az-services/intune.md)

#### [Roadtx](https://github.com/dirkjanm/ROADtools)

Chombo hiki kuruhusu kufanya vitendo kadhaa kama kusajili mashine katika Azure AD ili kupata PRT, na kutumia PRTs (halali au zilizoporwa) kupata rasilimali kwa njia tofauti. Hizi si mashambulizi moja kwa moja, lakini inarahisisha matumizi ya PRTs kupata rasilimali kwa njia tofauti. Pata maelezo zaidi katika [https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/](https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/)

## Marejeo

* [https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/](https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/)
