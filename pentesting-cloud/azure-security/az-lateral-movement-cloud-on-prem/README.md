# Az - Laterale Beweging (Wolk - On-Prem)

## Az - Laterale Beweging (Wolk - On-Prem)

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### On-Prem masjiene gekoppel aan wolk

Daar is verskillende maniere waarop 'n masjien aan die wolk gekoppel kan wees:

#### Azure AD aangesluit

<figure><img src="../../../.gitbook/assets/image (259).png" alt=""><figcaption></figcaption></figure>

#### Workplace aangesluit

<figure><img src="../../../.gitbook/assets/image (222).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### Hibriede aangesluit

<figure><img src="../../../.gitbook/assets/image (178).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### Workplace aangesluit op AADJ of Hibriede

<figure><img src="../../../.gitbook/assets/image (252).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large</a></p></figcaption></figure>

### Tokens en beperkings <a href="#tokens-and-limitations" id="tokens-and-limitations"></a>

In Azure AD, is daar verskillende tipes tokens met spesifieke beperkings:

* **Toegangstokens**: Gebruik om APIs en hulpbronne soos die Microsoft Graph te bekom. Hulle is gekoppel aan 'n spesifieke kli√´nt en hulpbron.
* **Herlaaitokens**: Uitgereik aan toepassings om nuwe toegangstokens te bekom. Hulle kan slegs gebruik word deur die toepassing waaraan hulle uitgereik is of 'n groep toepassings.
* **Prim√™re Herlaaitokens (PRT)**: Gebruik vir Enkel Aanmelding op Azure AD aangeslote, geregistreerde, of hibriede aangeslote toestelle. Hulle kan gebruik word in blaaier aanmeldingsvloei en vir aanmelding by mobiele en lessenaar toepassings op die toestel.

Die interessantste tipe token is die Prim√™re Herlaaitoken (PRT).

{% content-ref url="az-primary-refresh-token-prt.md" %}
[az-primary-refresh-token-prt.md](az-primary-refresh-token-prt.md)
{% endcontent-ref %}

### Pivoteringstegnieke

Van die **gekompromitteerde masjien na die wolk**:

* [**Pass the Cookie**](az-pass-the-cookie.md): Steel Azure koekies van die blaaier en gebruik hulle om aan te meld
* [**Phishing Primary Refresh Token**](az-phishing-primary-refresh-token-microsoft-entra.md)**:** Phish die PRT om dit te misbruik
* [**Pass the PRT**](pass-the-prt.md): Steel die toestel PRT om toegang tot Azure te kry deur dit te verpersoonlik.
* [**Pass the Certificate**](az-pass-the-certificate.md)**:** Genereer 'n sertifikaat gebaseer op die PRT om aan te meld van een masjien na 'n ander

Van kompromittering van **AD** na kompromittering van die **Wolk** en van kompromittering van die **Wolk na** kompromittering van **AD**:

* [**Azure AD Connect**](azure-ad-connect-hybrid-identity/)
* **Nog 'n manier om te pivot van wolk na On-Prem is** [**misbruik van Intune**](../az-services/intune.md)

#### [Roadtx](https://github.com/dirkjanm/ROADtools)

Hierdie hulpmiddel laat toe om verskeie aksies uit te voer soos om 'n masjien in Azure AD te registreer om 'n PRT te bekom, en PRTs (legitiem of gesteel) te gebruik om toegang tot hulpbronne op verskeie maniere te kry. Dit is nie direkte aanvalle nie, maar dit fasiliteer die gebruik van PRTs om toegang tot hulpbronne op verskillende maniere te kry. Vind meer inligting by [https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/](https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/)

## Verwysings

* [https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/](https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/)

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
