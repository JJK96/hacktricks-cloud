# Az - AzureAD (AAD)

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο Hacking του AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Εκπαίδευση HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο Hacking του GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Εκπαίδευση HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε** 💬 [**στην ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα χάκερ κάνοντας υποβολή PRs** στα [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
{% endhint %}

## Βασικές Πληροφορίες

Το Azure Active Directory (Azure AD) λειτουργεί ως υπηρεσία βασισμένη στο cloud της Microsoft για τη διαχείριση ταυτότητας και πρόσβασης. Είναι ουσιώδες για τη δυνατότητα στους υπαλλήλους να συνδεθούν και να αποκτήσουν πρόσβαση σε πόρους, τόσο εντός όσο και εκτός του οργανισμού, περιλαμβάνοντας το Microsoft 365, το Azure portal και μια πληθώρα άλλων εφαρμογών SaaS. Ο σχεδιασμός του Azure AD επικεντρώνεται στην παροχή βασικών υπηρεσιών ταυτότητας, συμπεριλαμβανομένων κυρίως της **πιστοποίησης, της εξουσιοδότησης και της διαχείρισης χρηστών**.

Οι βασικές λειτουργίες του Azure AD περιλαμβάνουν τη **πολυπαραγορευτική πιστοποίηση** και τη **συνθήκη πρόσβασης**, σε συνδυασμό με την άψογη ενσωμάτωση με άλλες υπηρεσίες ασφαλείας της Microsoft. Αυτές οι λειτουργίες αναβαθμίζουν σημαντικά την ασφάλεια των ταυτοτήτων των χρηστών και επιτρέπουν στις οργανώσεις να εφαρμόσουν και να επιβάλουν αποτελεσματικά τις πολιτικές πρόσβασής τους. Ως θεμελιώδης συστατικό του οικοσυστήματος υπηρεσιών cloud της Microsoft, το Azure AD είναι κρίσιμο για την cloud-based διαχείριση των ταυτοτήτων των χρηστών.

## Οντότητες

### Απαρίθμηση

Για αυτήν την απαρίθμηση μπορείτε να χρησιμοποιήσετε το [**εργαλείο az cli**](https://docs.microsoft.com/en-us/cli/azure/install-azure-cli)**,** το **PowerShell module** [**AzureAD**](https://www.powershellgallery.com/packages/AzureAD/) (ή [**AzureAD Preview**](https://www.powershellgallery.com/packages/AzureADPreview)) και το [**Az PowerShell**](https://learn.microsoft.com/en-us/powershell/azure/install-az-ps) module.

{% hint style="success" %}
Στο linux θα χρειαστεί να εγκαταστήσετε το PowerShell Core:
```bash
sudo apt-get update
sudo apt-get install -y wget apt-transport-https software-properties-common

# Ubuntu 20.04
wget -q https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb

# Update repos
sudo apt-get update
sudo add-apt-repository universe

# Install & start powershell
sudo apt-get install -y powershell
pwsh

# Az cli
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```
{% endhint %}

#### **Διαφορές Ενοτήτων**

* **AzureAD** είναι ένα PowerShell module από τη Microsoft για τη διαχείριση του Azure AD. Δεν εμφανίζει όλες τις ιδιότητες των αντικειμένων του Azure AD και δεν μπορεί να χρησιμοποιηθεί για την πρόσβαση σε πληροφορίες πόρων Azure.
* **Az PowerShell** είναι ένα module για τη διαχείριση των πόρων Azure από τη γραμμή εντολών PowerShell.

### **Σύνδεση**

{% tabs %}
{% tab title="az cli" %}
```bash
az login #This will open the browser
az login -u <username> -p <password> #Specify user and password
az login --identity #Use the current machine managed identity (metadata)
az login --identity -u /subscriptions/<subscriptionId>/resourcegroups/myRG/providers/Microsoft.ManagedIdentity/userAssignedIdentities/myID #Login with user managed identity
# Login as service principal
az login --service-principal -u http://azure-cli-2016-08-05-14-31-15 -p VerySecret --tenant contoso.onmicrosoft.com #With password
az login --service-principal -u http://azure-cli-2016-08-05-14-31-15 -p ~/mycertfile.pem --tenant contoso.onmicrosoft.com #With cert

# Request access token (ARM)
az account get-access-token
# Request access token for different resource. Supported tokens: aad-graph, arm, batch, data-lake, media, ms-graph, oss-rdbms
az account get-access-token --resource-type aad-graph

# If you want to configure some defaults
az configure

# Get user logged-in already
az ad signed-in-user show

# Help
az find "vm" # Find vm commands
az vm -h # Get subdomains
az ad user list --query-examples # Get examples
```
{% endtab %}

{% tab title="Azure AD" %}
{% code overflow="wrap" %}
```powershell
Connect-AzureAD #Open browser
# Using credentials
$passwd = ConvertTo-SecureString "Welcome2022!" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential ("test@corp.onmicrosoft.com", $passwd)
Connect-AzureAD -Credential $creds

# Using tokens
## AzureAD cannot request tokens, but can use AADGraph and MSGraph tokens to connect
Connect-AzureAD -AccountId test@corp.onmicrosoft.com -AadAccessToken $token
```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
```powershell
Connect-AzAccount #Open browser
# Using credentials
$passwd = ConvertTo-SecureString "Welcome2022!" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential("test@corp.onmicrosoft.com", $passwd)
Connect-AzAccount -Credential $creds

# Get Access Token
(Get-AzAccessToken).Token
# Request access token to other endpoints: AadGraph, AnalysisServices, Arm, Attestation, Batch, DataLake, KeyVault, MSGraph, OperationalInsights, ResourceManager, Storage, Synapse
Get-AzAccessToken -ResourceTypeName MSGraph
(Get-AzAccessToken -Resource "https://graph.microsoft.com").Token

# Conenct with access token
Connect-AzAccount -AccountId test@corp.onmicrosoft.com -AccessToken $token
Connect-AzAccount -AccessToken $token -GraphAccessToken $graphaccesstoken -AccountId <ACCOUNT-ID>
## The -AccessToken is from management.azure.com

# Connect with Service principal/enterprise app secret
$password = ConvertTo-SecureString 'KWEFNOIRFIPMWL.--DWPNVFI._EDWWEF_ADF~SODNFBWRBIF' -AsPlainText -Force
$creds = New-Object
System.Management.Automation.PSCredential('2923847f-fca2-a420-df10-a01928bec653', $password)
Connect-AzAccount -ServicePrincipal -Credential $creds -Tenant 29sd87e56-a192-a934-bca3-0398471ab4e7d

#All the Azure AD cmdlets have the format *-AzAD*
Get-Command *azad*
#Cmdlets for other Azure resources have the format *Az*
Get-Command *az*
```
{% endtab %}

{% tab title="Ακατέργαστο PS" %}
{% code overflow="wrap" %}
```powershell
#Using management
$Token = 'eyJ0eXAi..'
# List subscriptions
$URI = 'https://management.azure.com/subscriptions?api-version=2020-01-01'
$RequestParams = @{
Method  = 'GET'
Uri     = $URI
Headers = @{
'Authorization' = "Bearer $Token"
}
}
(Invoke-RestMethod @RequestParams).value

# Using graph
Invoke-WebRequest -Uri "https://graph.windows.net/myorganization/users?api-version=1.6" -Headers @{Authorization="Bearer {0}" -f $Token}
```
{% endcode %}
{% endtab %}

{% tab title="Ακατέργαστο Λειτουργικό Σύστημα" %}
{% code overflow="wrap" %}
```bash
# Request tokens to access endpoints
# ARM
curl "$IDENTITY_ENDPOINT?resource=https://management.azure.com&api-version=2017-09-01" -H secret:$IDENTITY_HEADER

# Vault
curl "$IDENTITY_ENDPOINT?resource=https://vault.azure.net&api-version=2017-09-01" -H secret:$IDENTITY_HEADER
```
{% endcode %}
{% endtab %}
{% endtabs %}

Όταν **συνδεθείτε** μέσω **CLI** στο Azure με οποιοδήποτε πρόγραμμα, χρησιμοποιείτε μια **Εφαρμογή Azure** από ένα **διακομιστή** που ανήκει στη **Microsoft**. Αυτές οι Εφαρμογές, όπως αυτές που μπορείτε να δημιουργήσετε στον λογαριασμό σας, **έχουν ένα αναγνωριστικό πελάτη**. Δεν **θα μπορείτε να τις δείτε όλες** στις **λίστες επιτρεπόμενων εφαρμογών** που βλέπετε στην κονσόλα, **αλλά είναι επιτρεπόμενες από προεπιλογή**.

Για παράδειγμα, ένα **σενάριο powershell** που **πιστοποιείται** χρησιμοποιεί μια εφαρμογή με αναγνωριστικό πελάτη **`1950a258-227b-4e31-a9cf-717495945fc2`**. Ακόμα κι αν η εφαρμογή δεν εμφανίζεται στην κονσόλα, ένας συστημικός διαχειριστής μπορεί να **φράξει αυτήν την εφαρμογή** ώστε οι χρήστες να μην μπορούν να συνδεθούν χρησιμοποιώντας εργαλεία που συνδέονται μέσω αυτής της Εφαρμογής.

Ωστόσο, υπάρχουν **άλλα αναγνωριστικά πελατών** εφαρμογών που **θα σας επιτρέψουν να συνδεθείτε στο Azure**:
```powershell
# The important part is the ClientId, which identifies the application to login inside Azure

$token = Invoke-Authorize -Credential $credential `
-ClientId '1dfb5f98-f363-4b0f-b63a-8d20ada1e62d' `
-Scope 'Files.Read.All openid profile Sites.Read.All User.Read email' `
-Redirect_Uri "https://graphtryit-staging.azurewebsites.net/" `
-Verbose -Debug `
-InformationAction Continue

$token = Invoke-Authorize -Credential $credential `
-ClientId '65611c08-af8c-46fc-ad20-1888eb1b70d9' `
-Scope 'openid profile Sites.Read.All User.Read email' `
-Redirect_Uri "chrome-extension://imjekgehfljppdblckcmjggcoboemlah" `
-Verbose -Debug `
-InformationAction Continue

$token = Invoke-Authorize -Credential $credential `
-ClientId 'd3ce4cf8-6810-442d-b42e-375e14710095' `
-Scope 'openid' `
-Redirect_Uri "https://graphexplorer.azurewebsites.net/" `
-Verbose -Debug `
-InformationAction Continue
```
### Χρήστες

{% tabs %}
{% tab title="az cli" %}
```bash
# Enumerate users
az ad user list --output table
az ad user list --query "[].userPrincipalName"
# Get info of 1 user
az ad user show --id "test@corp.onmicrosoft.com"
# Search "admin" users
az ad user list --query "[].displayName" | findstr /i "admin"
az ad user list --query "[?contains(displayName,'admin')].displayName"
# Search attributes containing the word "password"
az ad user list | findstr /i "password" | findstr /v "null,"
# All users from AzureAD
az ad user list --query "[].{osi:onPremisesSecurityIdentifier,upn:userPrincipalName}[?osi==null]"
az ad user list --query "[?onPremisesSecurityIdentifier==null].displayName"
# All users synced from on-prem
az ad user list --query "[].{osi:onPremisesSecurityIdentifier,upn:userPrincipalName}[?osi!=null]"
az ad user list --query "[?onPremisesSecurityIdentifier!=null].displayName"
# Get groups where the user is a member
az ad user get-member-groups --id <email>
# Get roles assigned to the user
az role assignment list --include-groups --include-classic-administrators true --assignee <email>
```
{% endtab %}

{% tab title="Azure AD" %}

Η επίθεση password spraying είναι μια τεχνική επίθεσης που στοχεύει στη δοκιμή μιας λίστας από κοινά passwords εναντίον πολλαπλών λογαριασμών χρηστών, προσπαθώντας να αποφύγει τον ανίχνευση από τα μέτρα ασφαλείας. Αυτή η τεχνική είναι αποτελεσματική επειδή πολλοί χρήστες εξακολουθούν να χρησιμοποιούν αδύναμα passwords. Είναι σημαντικό να εφαρμόζονται ισχυροί κανόνες πολιτικής κωδικού πρόσβασης και να εκπαιδεύονται οι χρήστες για τη χρήση μοναδικών και ασφαλών κωδικών. 

{% endtab %}
```powershell
# Enumerate Users
Get-AzureADUser -All $true
Get-AzureADUser -All $true | select UserPrincipalName
# Get info of 1 user
Get-AzureADUser -ObjectId test@corp.onmicrosoft.com | fl
# Search "admin" users
Get-AzureADUser -SearchString "admin" #Search admin at the begining of DisplayName or userPrincipalName
Get-AzureADUser -All $true |?{$_.Displayname -match "admin"} #Search "admin" word in DisplayName
# Get all attributes of a user
Get-AzureADUser -ObjectId test@defcorphq.onmicrosoft.com|%{$_.PSObject.Properties.Name}
# Search attributes containing the word "password"
Get-AzureADUser -All $true |%{$Properties = $_;$Properties.PSObject.Properties.Name | % {if ($Properties.$_ -match 'password') {"$($Properties.UserPrincipalName) - $_ - $($Properties.$_)"}}}
# All users from AzureAD# All users from AzureAD
Get-AzureADUser -All $true | ?{$_.OnPremisesSecurityIdentifier -eq $null}
# All users synced from on-prem
Get-AzureADUser -All $true | ?{$_.OnPremisesSecurityIdentifier -ne $null}
# Objects created by a/any user
Get-AzureADUser [-ObjectId <email>] | Get-AzureADUserCreatedObject
# Devices owned by a user
Get-AzureADUserOwnedDevice -ObjectId test@corp.onmicrosoft.com
# Objects owned by a specific user
Get-AzureADUserOwnedObject -ObjectId test@corp.onmicrosoft.com
# Get groups & roles where the user is a member
Get-AzureADUserMembership -ObjectId 'test@corp.onmicrosoft.com'
# Get devices owned by a user
Get-AzureADUserOwnedDevice -ObjectId test@corp.onmicrosoft.com
# Get devices registered by a user
Get-AzureADUserRegisteredDevice -ObjectId test@defcorphq.onmicrosoft.com
# Apps where a user has a role (role not shown)
Get-AzureADUser -ObjectId roygcain@defcorphq.onmicrosoft.com | Get-AzureADUserAppRoleAssignment | fl *
# Get Administrative Units of a user
$userObj = Get-AzureADUser -Filter "UserPrincipalName eq 'bill@example.com'"
Get-AzureADMSAdministrativeUnit | where { Get-AzureADMSAdministrativeUnitMember -Id $_.Id | where { $_.Id -eq $userObj.ObjectId } }
```
{% endtab %}

{% tab title="Az PowerShell" %} 
### Εντολές PowerShell Az

Οι εντολές PowerShell Az είναι ένα σύνολο εντολών PowerShell που χρησιμοποιούνται για τη διαχείριση των υπηρεσιών Azure μέσω του Azure PowerShell module. Μπορούν να χρησιμοποιηθούν για τη δημιουργία, τη διαμόρφωση και τη διαχείριση πόρων στο Azure Active Directory (Azure AD) και σε άλλες υπηρεσίες του Azure.
```powershell
# Enumerate users
Get-AzADUser
# Get details of a user
Get-AzADUser -UserPrincipalName test@defcorphq.onmicrosoft.com
# Search user by string
Get-AzADUser -SearchString "admin" #Search at the beginnig of DisplayName
Get-AzADUser | ?{$_.Displayname -match "admin"}
# Get roles assigned to a user
Get-AzRoleAssignment -SignInName test@corp.onmicrosoft.com
```
{% endtab %}
{% endtabs %}

#### Αλλαγή κωδικού πρόσβασης χρήστη
```powershell
$password = "ThisIsTheNewPassword.!123" | ConvertTo- SecureString -AsPlainText –Force

(Get-AzureADUser -All $true | ?{$_.UserPrincipalName -eq "victim@corp.onmicrosoft.com"}).ObjectId | Set- AzureADUserPassword -Password $password –Verbose
```
{% endcode %}

### MFA & Πολιτικές Συνθηκών Πρόσβασης

Συνιστάται ανεπιφύλακτα η προσθήκη MFA σε κάθε χρήστη, ωστόσο, μερικές εταιρείες ενδέχεται να μην το ρυθμίσουν ή ενδέχεται να το ρυθμίσουν με μια Πολιτική Συνθηκών Πρόσβασης: Ο χρήστης θα **απαιτείται MFA αν** συνδεθεί από μια συγκεκριμένη τοποθεσία, πρόγραμμα περιήγησης ή **κάποια συνθήκη**. Αυτές οι πολιτικές, αν δεν ρυθμιστούν σωστά, ενδέχεται να είναι επιρρεπείς σε **παρακάμψεις**. Ελέγξτε:

{% content-ref url="az-conditional-access-policies-mfa-bypass.md" %}
[az-conditional-access-policies-mfa-bypass.md](az-conditional-access-policies-mfa-bypass.md)
{% endcontent-ref %}

### Ομάδες

{% tabs %}
{% tab title="az cli" %}
```powershell
# Enumerate groups
az ad group list
az ad group list --query "[].[displayName]" -o table
# Get info of 1 group
az ad group show --group <group>
# Get "admin" groups
az ad group list --query "[].displayName" | findstr /i "admin"
az ad group list --query "[?contains(displayName,'admin')].displayName"
# All groups from AzureAD
az ad group list --query "[].{osi:onPremisesSecurityIdentifier,displayName:displayName,description:description}[?osi==null]"
az ad group list --query "[?onPremisesSecurityIdentifier==null].displayName"
# All groups synced from on-prem
az ad group list --query "[].{osi:onPremisesSecurityIdentifier,displayName:displayName,description:description}[?osi!=null]"
az ad group list --query "[?onPremisesSecurityIdentifier!=null].displayName"
# Get members of group
az ad group member list --group <group> --query "[].userPrincipalName" -o table
# Check if member of group
az ad group member check --group "VM Admins" --member-id <id>
# Get which groups a group is member of
az ad group get-member-groups -g "VM Admins"
# Get Apps where a group has a role (role not shown)
Get-AzureADGroup -ObjectId <id> | Get-AzureADGroupAppRoleAssignment | fl *
```
{% endtab %}

{% tab title="Azure AD" %}

Η επίθεση εξαγωγής δεδομένων χρησιμοποιεί την ευπάθεια του Microsoft Graph API που επιτρέπει σε εξωτερικές εφαρμογές να ανακτούν δεδομένα χρηστών από το Azure AD. Οι επιτιθέμενοι μποροών να χρησιμοποιήσουν αυτήν την ευπάθεια για να ανακτήσουν ευαίσθητες πληροφορίες όπως email, τηλέφωνα, και άλλα προσωπικά δεδομένα χρηστών. Είναι σημαντικό να προστατεύσετε το Azure AD σας από αυτού του είδους τις επιθέσεις με την εφαρμογή σκληρϿών μέτρων ασφαλείας και την παρακολούθηση των δραστηριοτήτων για τυχόν ανωμαλίες. 

{% endtab %}
```powershell
# Enumerate Groups
Get-AzureADGroup -All $true
# Get info of 1 group
Get-AzADGroup -DisplayName <resource_group_name> | fl
# Get "admin" groups
Get-AzureADGroup -SearchString "admin" | fl #Groups starting by "admin"
Get-AzureADGroup -All $true |?{$_.Displayname -match "admin"} #Groups with the word "admin"
# Get groups allowing dynamic membership
Get-AzureADMSGroup | ?{$_.GroupTypes -eq 'DynamicMembership'}
# All groups that are from Azure AD
Get-AzureADGroup -All $true | ?{$_.OnPremisesSecurityIdentifier -eq $null}
# All groups that are synced from on-prem (note that security groups are not synced)
Get-AzureADGroup -All $true | ?{$_.OnPremisesSecurityIdentifier -ne $null}
# Get members of a group
Get-AzureADGroupMember -ObjectId <group_id>
# Get roles of group
Get-AzureADMSGroup -SearchString "Contoso_Helpdesk_Administrators" #Get group id
Get-AzureADMSRoleAssignment -Filter "principalId eq '69584002-b4d1-4055-9c94-320542efd653'"
# Get Administrative Units of a group
$groupObj = Get-AzureADGroup -Filter "displayname eq 'TestGroup'"
Get-AzureADMSAdministrativeUnit | where { Get-AzureADMSAdministrativeUnitMember -Id $_.Id | where {$_.Id -eq $groupObj.ObjectId} }
```
{% endtab %}

{% tab title="Az PowerShell" %} 

## Επικεφαλίδα

Το AzureAD PowerShell Module παρέχει εντολές PowerShell για τη διαχείριση του Azure Active Directory. Μπορείτε να χρησιμοποιήσετε αυτό το module για να διαχειριστείτε χρήστες, ομάδες, εφαρμογές και άλλα αντικείμενα στο Azure AD.

### Εγκατάσταση

Για να εγκαταστήσετε το AzureAD PowerShell Module, μπορείτε να χρησιμοποιήσετε την εντολή `Install-Module -Name AzureAD`.

### Σύνδεση

Μετά την εγκατάσταση, μπορείτε να συνδεθείτε στο Azure AD χρησιμοποιύντας την εντολή `Connect-AzureAD`.

### Παραδείγματα Χρήσης

Μερικά παραδείγματα χρήσης του AzureAD PowerShell Module είναι η δημιουργία νέου χρήστη, η προσθήκη ενός μέλους σε μια ομάδα και η ενημέρωση των ρυθμίσεων ενός ρόλου.

{% endtab %}
```powershell
# Get all groups
Get-AzADGroup
# Get details of a group
Get-AzADGroup -ObjectId <id>
# Search group by string
Get-AzADGroup -SearchString "admin" | fl * #Search at the beginnig of DisplayName
Get-AzADGroup |?{$_.Displayname -match "admin"}
# Get members of group
Get-AzADGroupMember -GroupDisplayName <resource_group_name>
# Get roles of group
Get-AzRoleAssignment -ResourceGroupName <resource_group_name>
```
{% endtab %}
{% endtabs %}

#### Προσθήκη χρήστη σε ομάδα

Οι ιδιοκτήτες της ομάδας μπορούν να προσθέσουν νέους χρήστες στην ομάδα
```powershell
Add-AzureADGroupMember -ObjectId <group_id> -RefObjectId <user_id> -Verbose
```
{% endcode %}

{% hint style="warning" %}
Οι ομάδες μπορούν να είναι δυναμικές, πράγμα που σημαίνει βασικά ότι **αν ένας χρήστης πληροί συγκεκριμένες συνθήκες, θα προστεθεί σε μια ομάδα**. Φυσικά, αν οι συνθήκες βασίζονται σε **χαρακτηριστικά** που ένας **χρήστης** μπορεί **να ελέγξει**, μπορεί να εκμεταλλευτεί αυτό το χαρακτηριστικό για να **μπει σε άλλες ομάδες**.\
Ελέγξτε πώς μπορείτε να εκμεταλλευτείτε τις δυναμικές ομάδες στην ακόλουθη σελίδα:
{% endhint %}

{% content-ref url="dynamic-groups.md" %}
[dynamic-groups.md](dynamic-groups.md)
{% endcontent-ref %}

### Υπηρεσιών Πρωταγωνιστών / Επιχειρηματικές Εφαρμογές

{% hint style="info" %}
Σημειώστε ότι ο **Υπηρεσιών Πρωταγωνιστής** στον όρολο PowerShell **ονομάζεται** **Επιχειρηματικές Εφαρμογές** στο Azure portal (web).
{% endhint %}

{% tabs %}
{% tab title="az cli" %}
```bash
# Get Service Principals
az ad sp list --all
az ad sp list --all --query "[].[displayName]" -o table
# Get details of one SP
az ad sp show --id 00000000-0000-0000-0000-000000000000
# Search SP by string
az ad sp list --all --query "[?contains(displayName,'app')].displayName"
# Get owner of service principal
az ad sp owner list --id <id> --query "[].[displayName]" -o table
# Get service principals owned by the current user
az ad sp list --show-mine
# List apps that have password credentials
az ad sp list --all --query "[?passwordCredentials != null].displayName"
# List apps that have key credentials (use of certificate authentication)
az ad sp list -all --query "[?keyCredentials != null].displayName"
```
{% endtab %}

{% tab title="Azure AD" %}

Η επίθεση εκμετάλλευσης ευκαιριών είναι μια τεχνική επίθεσης που χρησιμοποιείται για την εκμετάλλευση των αδυναμιών σε ένα σύστημα πληροφοριών, εφαρμογής λογισμικού ή δικτύου. Ο στόχος είναι να αξιοποιηθούν αυτές οι αδυναμίες προκειμένου να κερδίσει ο εισβολέας πρόσβαση, έλεγχο ή πληροφορίες που δεν θα έπρεπε να έχει. 

Οι επιθέσεις εκμετάλλευσης ευκαιριών μπορούν να πραγματοποιηθούν μέσω διαφόρων μεθόδων, όπως εκμετάλλευση γνωστών αδυναμιών λογισμικού, ψαρέματος (phishing), εκμετάλλευσης ανεπιθύμητων λειτουργιών (zero-day exploits) κ.α. 

Είναι σημαντικό για τους επαγγελματίες ασφάλειας να κατανοοώνται τις τεχνικές επίθεσης εκμετάλλευσης ευκαιριύν και να λαμβάνουν μέτρα για την προστασία των συστημάτων και των δεδομένων. 

{% endtab %}
```powershell
# Get Service Principals
Get-AzureADServicePrincipal -All $true
# Get details about a SP
Get-AzureADServicePrincipal -ObjectId <id> | fl *
# Get SP by string name or Id
Get-AzureADServicePrincipal -All $true | ?{$_.DisplayName -match "app"} | fl
Get-AzureADServicePrincipal -All $true | ?{$_.AppId -match "103947652-1234-5834-103846517389"}
# Get owner of SP
Get-AzureADServicePrincipal -ObjectId <id> | Get-AzureADServicePrincipalOwner |fl *
# Get objects owned by a SP
Get-AzureADServicePrincipal -ObjectId <id> | Get-AzureADServicePrincipalOwnedObject
# Get objects created by a SP
Get-AzureADServicePrincipal -ObjectId <id> | Get-AzureADServicePrincipalCreatedObject
# Get groups where the SP is a member
Get-AzureADServicePrincipal | Get-AzureADServicePrincipalMembership
Get-AzureADServicePrincipal -ObjectId <id> | Get-AzureADServicePrincipalMembership |fl *
```
{% endtab %}

{% tab title="Az PowerShell" %} 

## Επίθεση εξουθένωσης Azure AD

Η επίθεση εξουθένωσης Azure AD είναι μια επίθεση που στοχεύει στην ανάκτηση εγγραφών χρηστών από το Azure AD χρησιμοποιϿώντας λίστες κωδικών πρόσβασης. Μπορεί να εκτελεστεί μέσω του Azure PowerShell χρησιμοποιώντας τον κώδικα PowerShell που παρέχεται στο αποθετήριο. 

Για να προστατεύσετε το Azure AD σας από αυτού του είδους επιθέσεις, είναι σημαντικό να εφαρμόσετε ισχυρούς κανόνες πολιτικής κωδικών πρόσβασης, να ενισχύσετε την πολιτική κλειδώματος λογαριασμών και να εφαρμόσετε πολιτικές ασφαλείας που περιορίζουν τον αριθμό των αποτυχημένων προσπαθειών σύνδεσης. 

Επιπλέον, είναι σημαντικό να εκπαιδεύσετε τους χρήστες σας για την αναγνώριση απάτης και να προωθήσετε την χρήση πολυπαραγόντων μεθόδων ελέγχου ταυτότητας, όπως οι κωδικοί πρόσβασης με δεύτερο παράγοντα επαλήθευσης. 

Αυτές οι προληπτικές μέτρησεις μπορούν να βοηθήσουν στην προστασία του Azure AD σας από επιθέσεις εξουθένωσης και να διατηρήσουν τα δεδομένα των χρηστών σας ασφαλή. 

{% endtab %}
```powershell
# Get SPs
Get-AzADServicePrincipal
# Get info of 1 SP
Get-AzADServicePrincipal -ObjectId <id>
# Search SP by string
Get-AzADServicePrincipal | ?{$_.DisplayName -match "app"}
# Get roles of a SP
Get-AzRoleAssignment -ServicePrincipalName <String>
```
{% endtab %}

{% tab title="Ακατέργαστο" %}
```powershell
$Token = 'eyJ0eX..'
$URI = 'https://graph.microsoft.com/v1.0/applications'
$RequestParams = @{
Method  = 'GET'
Uri     = $URI
Headers = @{
'Authorization' = "Bearer $Token"
}
}
(Invoke-RestMethod @RequestParams).value
```
{% endtab %}
{% endtabs %}

{% hint style="warning" %}
Ο Κάτοχος ενός Κύριου Υπηρεσίας μπορεί να αλλάξει τον κωδικό πρόσβασής του.
{% endhint %}

<details>

<summary>Λίστα και προσπάθεια προσθήκης ενός μυστικού πελάτη σε κάθε Επιχειρησιακή Εφαρμογή</summary>
```powershell
# Just call Add-AzADAppSecret
Function Add-AzADAppSecret
{
<#
.SYNOPSIS
Add client secret to the applications.

.PARAMETER GraphToken
Pass the Graph API Token

.EXAMPLE
PS C:\> Add-AzADAppSecret -GraphToken 'eyJ0eX..'

.LINK
https://docs.microsoft.com/en-us/graph/api/application-list?view=graph-rest-1.0&tabs=http
https://docs.microsoft.com/en-us/graph/api/application-addpassword?view=graph-rest-1.0&tabs=http
#>

[CmdletBinding()]
param(
[Parameter(Mandatory=$True)]
[String]
$GraphToken = $null
)

$AppList = $null
$AppPassword = $null

# List All the Applications

$Params = @{
"URI"     = "https://graph.microsoft.com/v1.0/applications"
"Method"  = "GET"
"Headers" = @{
"Content-Type"  = "application/json"
"Authorization" = "Bearer $GraphToken"
}
}

try
{
$AppList = Invoke-RestMethod @Params -UseBasicParsing
}
catch
{
}

# Add Password in the Application

if($AppList -ne $null)
{
[System.Collections.ArrayList]$Details = @()

foreach($App in $AppList.value)
{
$ID = $App.ID
$psobj = New-Object PSObject

$Params = @{
"URI"     = "https://graph.microsoft.com/v1.0/applications/$ID/addPassword"
"Method"  = "POST"
"Headers" = @{
"Content-Type"  = "application/json"
"Authorization" = "Bearer $GraphToken"
}
}

$Body = @{
"passwordCredential"= @{
"displayName" = "Password"
}
}

try
{
$AppPassword = Invoke-RestMethod @Params -UseBasicParsing -Body ($Body | ConvertTo-Json)
Add-Member -InputObject $psobj -NotePropertyName "Object ID" -NotePropertyValue $ID
Add-Member -InputObject $psobj -NotePropertyName "App ID" -NotePropertyValue $App.appId
Add-Member -InputObject $psobj -NotePropertyName "App Name" -NotePropertyValue $App.displayName
Add-Member -InputObject $psobj -NotePropertyName "Key ID" -NotePropertyValue $AppPassword.keyId
Add-Member -InputObject $psobj -NotePropertyName "Secret" -NotePropertyValue $AppPassword.secretText
$Details.Add($psobj) | Out-Null
}
catch
{
Write-Output "Failed to add new client secret to '$($App.displayName)' Application."
}
}
if($Details -ne $null)
{
Write-Output ""
Write-Output "Client secret added to : "
Write-Output $Details | fl *
}
}
else
{
Write-Output "Failed to Enumerate the Applications."
}
}
```
</details>

### Ρόλοι

{% tabs %}
{% tab title="az cli" %}
```bash
# Get roles
az role definition list
# Get assigned roles
az role assignment list --all --query "[].roleDefinitionName"
az role assignment list --all | jq '.[] | .roleDefinitionName,.scope'
# Get info of 1 role
az role definition list --name "AzureML Registry User"
# Get only custom roles
az role definition list --custom-role-only
# Get only roles assigned to the resource group indicated
az role definition list --resource-group <resource_group>
# Get only roles assigned to the indicated scope
az role definition list --scope <scope>
# Get all the principals a role is assigned to
az role assignment list --all --query "[].{principalName:principalName,principalType:principalType,resourceGroup:resourceGroup,roleDefinitionName:roleDefinitionName}[?roleDefinitionName=='<ROLE_NAME>']"
```
{% endtab %}

{% tab title="Azure AD" %}

Η επίθεση password spraying είναι μια τεχνική επίθεσης όπου ο εισβολέας δοκιμάζει λίστα με κοινά passwords εναντίον πολλαπλών χρηστών ταυτόχρονα, αντί να δοκιμάζει πολλά passwords για έναν συγκεκριμένο χρήστη. Αυτό μειώνει τον κίνδυνο ανίχνευσης από τα μέτρα ασφαλείας, καθώς οι επιθέσεις με ελάχιστες προσπάθειες ανάγουν τον κίνδυνο ανίχνευσης. 

Για να προστατεύσετε το Azure AD από επιθέσεις password spraying, μπορείτε να εφαρμόσετε πολιτικές περιορισμού πρόσβασης, να ενισχύσετε την πολυπαραγοντική ταυτοποίηση και να χρησιμοποιήσετε λογισμικό ανίχνευσης απειλών για την παρακολούθηση ανομαλιών στην χρήση των διαπιστευτηρίων. 

Επιπλέον, είναι σημαντικό να εκπαιδεύσετε τους χρήστες σας για τη δημιουργία ισχυρών κωδικών πρόσβασης και να εφαρμόζετε τακτικά αξιολογήσεις ασφαλείας για το Azure AD σας. 

{% endtab %}
```powershell
# Get all available role templates
Get-AzureADDirectoryroleTemplate
# Get enabled roles (Assigned roles)
Get-AzureADDirectoryRole
Get-AzureADDirectoryRole -ObjectId <roleID> #Get info about the role
# Get custom roles - use AzureAdPreview
Get-AzureADMSRoleDefinition | ?{$_.IsBuiltin -eq $False} | select DisplayName
# Users assigned a role (Global Administrator)
Get-AzureADDirectoryRole -Filter "DisplayName eq 'Global Administrator'" | Get-AzureADDirectoryRoleMember
Get-AzureADDirectoryRole -ObjectId <id> | fl
# Roles of the Administrative Unit (who has permissions over the administrative unit and its members)
Get-AzureADMSScopedRoleMembership -Id <id> | fl *
```
{% endtab %}

{% tab title="Az PowerShell" %} 
### Επιλογές επίθεσης

Για να εκτελέσετε επιθέσεις στο Azure AD με το Az PowerShell, μπορείτε να χρησιμοποιήσετε τις παρακάτω εντολές:

1. **Δημιουργία νέου χρήστη:**
```plaintext
New-AzureADUser -DisplayName <DisplayName> -UserPrincipalName <UserPrincipalName> -AccountEnabled $true
```

2. **Διαγραφή χρήστη:**
```plaintext
Remove-AzureADUser -ObjectId <ObjectId>
```

3. **Λίστα χρηστών:**
```plaintext
Get-AzureADUser
```

4. **Ενημέρωση χρήστη:**
```plaintext
Set-AzureADUser -ObjectId <ObjectId> -DisplayName <NewDisplayName>
```

5. **Δημιουργία νέου group:**
```plaintext
New-AzureADGroup -DisplayName <DisplayName> -MailEnabled $false -SecurityEnabled $true
```
{% endtab %}
```powershell
# Get role assignments on the subscription
Get-AzRoleDefinition
# Get Role definition
Get-AzRoleDefinition -Name "Virtual Machine Command Executor"
# Get roles of a user or resource
Get-AzRoleAssignment -SignInName test@corp.onmicrosoft.com
Get-AzRoleAssignment -Scope /subscriptions/<subscription-id>/resourceGroups/<res_group_name>/providers/Microsoft.Compute/virtualMachines/<vm_name>
```
{% endtab %}

{% tab title="Μεταφράστηκε" %}
```powershell
# Get permissions over a resource using ARM directly
$Token = (Get-AzAccessToken).Token
$URI = 'https://management.azure.com/subscriptions/b413826f-108d-4049-8c11-d52d5d388768/resourceGroups/Research/providers/Microsoft.Compute/virtualMachines/infradminsrv/providers/Microsoft.Authorization/permissions?api-version=2015-07-01'
$RequestParams = @{
Method = 'GET'
Uri = $URI
Headers = @{
'Authorization' = "Bearer $Token"
}
}
(Invoke-RestMethod @RequestParams).value
```
### Συσκευές

{% tabs %}
{% tab title="az cli" %}
```bash
# If you know how to do this send a PR!
```
{% endtab %}

{% tab title="Azure AD" %}

## Επίθεση εκτέλεσης κώδικα στον Azure AD

Η επίθεση εκτέλεσης κώδικα στον Azure AD είναι μια σοβαρή απειλή για την ασφάλεια του συστήματος. Οι επιτιθέμενοι μποροϿν να εκμεταλλευτούν τυχόν ευπάθειες στον κώδικα για να αποκτήσουν πρόσβαση σε ευαίσθητα δεδομένα ή να προκαλέσουν ζημιά στο σύστημα. Για την προστασία του Azure AD, είναι σημαντικό να εφαρμόζονται βέλτιστες πρακτικές ασφαλείας κύριας σημασίας. 

Μερικά μέτρα που μπορούν να ληφθούν για την προστασία από επιθέσεις εκτέλεσης κύριας σημασίας στον Azure AD περιλαμβάνουν την εφαρμογή πολιτικών ελέγχου πρόσβασης, την ενημέρωση του λογισμικού σε τακτική βάση, τον έλεγχο των δικαιωμάτων πρόσβασης και την εκπαίδευση των χρηστών για την αναγνώριση και αντιμετώπιση των κινδύνων. 

Επιπλέον, η παρακολούθηση των δραστηριοτήτων στον Azure AD μπορεί να βοηθήσει στην έγκαιρη ανίχνευση ενδεχόμενων επιθέσεων και στη λήώση τους πριν προκαλέσουν σοβαρές ζημιές. 

Τέλος, η συνεχής εκπαίδευση και ενημέρωση σχετικά με τις νέες τεχνικές επίθεσης και τις εξελίξεις στον τομέα της κυβερνοασφάλειας είναι ουσιώδης για τη διατήρηση της ασφάλειας του Azure AD. 

{% endtab %}
```powershell
# Enumerate Devices
Get-AzureADDevice -All $true | fl *
# List all the active devices (and not the stale devices)
Get-AzureADDevice -All $true | ?{$_.ApproximateLastLogonTimeStamp -ne $null}
# Get owners of all devices
Get-AzureADDevice -All $true | Get-AzureADDeviceRegisteredOwner
Get-AzureADDevice -All $true | %{if($user=Get-AzureADDeviceRegisteredOwner -ObjectId $_.ObjectID){$_;$user.UserPrincipalName;"`n"}}
# Registred users of all the devices
Get-AzureADDevice -All $true | Get-AzureADDeviceRegisteredUser
Get-AzureADDevice -All $true | %{if($user=Get-AzureADDeviceRegisteredUser -ObjectId $_.ObjectID){$_;$user.UserPrincipalName;"`n"}}
# Get dives managed using Intune
Get-AzureADDevice -All $true | ?{$_.IsCompliant -eq "True"}
# Get devices owned by a user
Get-AzureADUserOwnedDevice -ObjectId test@corp.onmicrosoft.com
# Get Administrative Units of a device
Get-AzureADMSAdministrativeUnit | where { Get-AzureADMSAdministrativeUnitMember -ObjectId $_.ObjectId | where {$_.ObjectId -eq $deviceObjId} }
```
{% endtab %}
{% endtabs %}

{% hint style="warning" %}
Εάν μια συσκευή (VM) είναι συνδεδεμένη στο **AzureAD**, οι χρήστες από το AzureAD θα μπορούν να **συνδεθούν**.\
Επιπλέον, εάν ο συνδεδεμένος χρήστης είναι **Κάτοχος** της συσκευής, τότε θα είναι **τοπικός διαχειριστής**.
{% endhint %}

### Εφαρμογές

{% hint style="info" %}
**Οι εφαρμογές** είναι **Εγγραφές Εφαρμογών** στο portal (όχι Επιχειρησιακές Εφαρμογές).\
Κάθε Εγγραφή Εφαρμογής θα δημιουργήσει μια **Επιχειρησιακή Εφαρμογή** (**Υπηρεσιακό Πρωτεύον**) με το ίδιο όνομα.\
Επιπλέον, εάν η Εφαρμογή είναι **πολυ-ενοικιακή Εφαρμογή**, θα δημιουργηθεί μια **άλλη** Επιχειρησιακή Εφαρμογή (**Υπηρεσιακό Πρωτεύον**) σε **εκείνο τον ενοικιαστή** με το ίδιο όνομα.
{% endhint %}

Όταν μια Εφαρμογή δημιουργείται, δίνονται 2 τύποι δικαιωμάτων:

* **Δικαιώματα** που δίνονται στο **Υπηρεσιακό Πρωτεύον**
* **Δικαιώματα** που μπορεί να έχει και να χρησιμοποιεί η **εφαρμογή** εκ μέρους του **χρήστη**.
```bash
# List Apps
az ad app list
az ad app list --query "[].[displayName]" -o table
# Get info of 1 App
az ad app show --id 00000000-0000-0000-0000-000000000000
# Search App by string
az ad app list --query "[?contains(displayName,'app')].displayName"
# Get the owner of an application
az ad app owner list --id <id> --query "[].[displayName]" -o table
# List all the apps with an application password
az ad app list --query "[?passwordCredentials != null].displayName"
# List apps that have key credentials (use of certificate authentication)
az ad app list --query "[?keyCredentials != null].displayName"
```
{% endtab %}

{% tab title="Azure AD" %}

Η επίθεση password spraying είναι μια τεχνική επίθεσης όπου ο εισβολέας δοκιμάζει λίστα με συνηθισμένους κωδικούς πρόσβασης εναντίον πολλών λογαριασμών χρησιμοποιώντας έναν καθορισμένο χρήστη. Αυτό μειώνει τον κίνδυνο ανίχνευσης από τα μέτρα ασφαλείας που είναι σχετικά με τον αριθμό των αποτυχημένων προσπαθειών σύνδεσης ανά χρήστη. Η επίθεση αυτή μπορεί να είναι αποτελεσματική εάν οι χρήστες χρησιμοποιούν αδύναμους κωδικούς πρόσβασης. 

{% endtab %}
```powershell
# List all registered applications
Get-AzureADApplication -All $true
# Get details of an application
Get-AzureADApplication -ObjectId <id>  | fl *
# List all the apps with an application password
Get-AzureADApplication -All $true | %{if(Get-AzureADApplicationPasswordCredential -ObjectID $_.ObjectID){$_}}
# Get owner of an application
Get-AzureADApplication -ObjectId <id> | Get-AzureADApplicationOwner |fl *
```
{% endtab %}

{% tab title="Az PowerShell" %}  
### Επίθεση εξουθένωσης Azure AD

Η επίθεση εξουθένωσης στο Azure AD μπορεί να πραγματοποιηθεί χρησιμοποιϿώντας το εργαλείο `Az PowerShell`. Μπορείτε να χρησιμοποιήσετε το εργαλείο αυτό για να εκτελέσετε επιθέσεις εξουθένωσης Ͽστο Azure AD, όπως προσπάθειες σύνδεσης με λίστες κωδικών ή αναζήτηση ονομάτων χρηστών.  
{% endtab %}
```powershell
# Get Apps
Get-AzADApplication
# Get details of one App
Get-AzADApplication -ObjectId <id>
# Get App searching by string
Get-AzADApplication | ?{$_.DisplayName -match "app"}
# Get Apps with password
Get-AzADAppCredential
```
{% endtab %}
{% endtabs %}

{% hint style="warning" %}
Μια εφαρμογή με την άδεια **`AppRoleAssignment.ReadWrite`** μπορεί **να εξελιχθεί σε Γενικό Διαχειριστή** δίνοντας στον εαυτό της τον ρόλο.\
Για περισσότερες πληροφορίες [**ελέγξτε αυτό**](https://posts.specterops.io/azure-privilege-escalation-via-azure-api-permissions-abuse-74aee1006f48).
{% endhint %}

{% hint style="info" %}
Ένα μυστικό string που η εφαρμογή χρησιμοποιεί για να αποδείξει την ταυτότητά της κατά την αίτηση ενός τόκεν είναι ο κωδικός της εφαρμογής.\
Έτσι, αν βρείτε αυτόν τον **κωδικό** μπορείτε να έχετε πρόσβαση ως **υπηρεσιακός προσωπικός** **μέσα** στο **διακομιστή**.\
Σημειώστε ότι αυτός ο κωδικός είναι ορατός μόνο κατά τη δημιουργία του (μπορείτε να τον αλλάξετε αλλά δεν μπορείτε να τον πάρετε ξανά).\
Ο **κάτοχος** της **εφαρμογής** μπορεί **να προσθέσει έναν κωδικό** σε αυτήν (ώστε να μπορεί να την υποκαταστήσει).\
Οι συνδέσεις ως αυτοί οι υπηρεσιακοί προσωπικοί **δεν θεωρούνται επικίνδυνες** και **δεν θα έχουν διπλή ταυτοποίηση.**
{% endhint %}

### Διαφορά Εφαρμογών & (Επιχειρησιακές Εφαρμογές ή Υπηρεσιακοί Πρωταγωνιστές)

Διαφορά μεταξύ μιας εφαρμογής και ενός Υπηρεσιακού Πρωταγωνιστή στο Azure:

* **Εφαρμογή/Εγγραφές Εφαρμογών**: Είναι εφαρμογές που υπάρχουν στο Azure AD σας
* `(Get-AzureADApplication -filter "DisplayName eq 'testapp'")`
* **Υπηρεσιακός Πρωταγωνιστής/Επιχειρησιακές Εφαρμογές**: Αντικείμενα ασφαλείας στο Azure AD σας που μπορούν να έχουν **προνόμια** στον Κατάλογο Azure και συνδέονται είτε με την εφαρμογή σας είτε με μια εφαρμογή τρίτου μέρους
* `Get-AzureADServicePrincipal -filter "DisplayName eq 'testapp'")`
* Ένας διαχειριστής μπορεί να χρειαστεί να εγκρίνει τα δεδομένα δικαιώματα αν είναι πολύ ευαίσθητα.

Μια εφαρμογή μπορεί να τρέχει σε έναν **Τρίτο διακομιστή** και μόλις αρχίσετε να τη χρησιμοποιείτε και της δώσετε πρόσβαση, μια **Επιχειρησιακή Εφαρμογή/Υπηρεσιακός Πρωταγωνιστής δημιουργείται στον διακομιστή σας** για να της δώσει πρόσβαση στις πληροφορίες που χρειάζεται:

### Διοικητικές Μονάδες

Χρησιμοποιούνται για καλύτερη διαχείριση των χρηστών.

Οι διοικητικές μονάδες **περιορίζουν τα δικαιώματα σε έναν ρόλο σε οποιοδήποτε τμήμα του οργανισμού σας** που ορίζετε. Για παράδειγμα, μπορείτε να χρησιμοποιήσετε διοικητικές μονάδες για να αναθέσετε τον ρόλο [Διαχειριστής Εξυπηρέτησης Πελατών](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference#helpdesk-administrator) σε περιφερειακούς ειδικούς υποστήριξης, έτσι ώστε να μπορούν να διαχειρίζονται χρήστες μόνο στην περιοχή που υποστηρίζουν.

Συνεπώς, μπορείτε να αναθέσετε ρόλους στη μονάδα διαχείρισης και τα μέλη της θα έχουν αυτούς τους ρόλους.
```
```
{% endtab %}

{% tab title="AzureAD" %}

Η επίθεση εξαγωγής δεδομένων είναι μια τεχνική που χρησιμοποιείται για την ανάκτηση ευαίσθητων πληροφοριών από το Azure Active Directory. Οι επιθέσεις εξαγωγής δεδομένων μπορεί να οδηγήσουν στη διαρροή ευαίσθητων πληροφοριών και να θέσουν σε κίνδυνο την ασφάλεια του συστήματος. Είναι σημαντικό να λαμβάνονται μέτρα προστασίας για να αποτραπεί η επιτυχία αυτών των επιθέσεων.

{% endtab %}
```powershell
# Get Administrative Units
Get-AzureADMSAdministrativeUnit
Get-AzureADMSAdministrativeUnit -Id <id>
# Get ID of admin unit by string
$adminUnitObj = Get-AzureADMSAdministrativeUnit -Filter "displayname eq 'Test administrative unit 2'"
# List the users, groups, and devices affected by the administrative unit
Get-AzureADMSAdministrativeUnitMember -Id <id>
# Get the roles users have over the members of the AU
Get-AzureADMSScopedRoleMembership -Id <id> | fl #Get role ID and role members
```
{% endtab %}
{% endtabs %}

## Προστασία Ταυτότητας Azure AD (AIP) <a href="#title-text" id="title-text"></a>

Η Προστασία Ταυτότητας Azure AD (AIP) είναι ένα υπηρεσία ασφαλείας που χρησιμοποιεί **αυτόματη ανίχνευση και αντιμετώπιση για να προστατεύσει τις ταυτότητες χρηστών στο Azure Active Directory από πιθανές παραβιάσεις**. Η AIP παρακολουθεί συνεχώς και αξιολογεί τον κίνδυνο των συνδέσεων χρηστών και των ρυθμίσεων ταυτότητας, **εφαρμόζοντας αυτόματα κατάλληλα μέτρα ασφαλείας**, όπως η απαίτηση πολυπαραμετρικής πιστοποίησης ή η αποκλεισμός πιθανά επικίνδυνων δραστηριοτήτων. Αυτό βοηθά τις οργανώσεις να αποτρέψουν παραβιάσεις ασφάλειας που βασίζονται στην ταυτότητα.

Ροή:

1. Η Προστασία Ταυτότητας Azure AD **παρακολουθεί τις δραστηριότητες των χρηστών** και συλλέγει δεδομένα για τις **συνδέσεις χρηστών, γεγονότα πιστοποίησης** και άλλες σχετικές δραστηριότητες.
2. Η υπηρεσία χρησιμοποιεί **αλγόριθμους μηχανικής μάθησης** για να αναλύσει αυτά τα δεδομένα και να ανιχνεύσει πιθανές απειλές ασφαλείας.
3. Η Προστασία Ταυτότητας Azure AD **αναθέτει ένα επίπεδο κινδύνου στην απειλή** (π.χ. σύνδεση) και δημιουργεί μια ειδοποίηση αν χρειαστεί να εκτελεστεί κάποια αυτόματη ενέργεια.

## Προστασία Κωδικού Πρόσβασης Azure AD (APP)

Η Προστασία Κωδικού Πρόσβασης Azure AD (APP) είναι μια λειτουργία ασφαλείας που **βοηθά στην πρόληψη αδύναμων κωδικών πρόσβασης στο Azure Active Directory επιβάλλοντας αυστηρές πολιτικές κωδικών πρόσβασης**. Το APP αποκλείει **συχνά χρησιμοποιούμενους αδύναμους κωδικούς πρόσβασης** και τις παραλλαγές τους, μειώνοντας τον κίνδυνο παραβιάσεων που σχετίζονται με κωδικούς πρόσβασης. Μπορεί να εφαρμοστεί τόσο στο επίπεδο του cloud όσο και στο εσωτερικό Active Directory, βελτιώντας τη συνολική ασφάλεια κωδικών πρόσβασης σε ολόκληρο τον οργανισμό.

### Αναφορές

* [https://learn.microsoft.com/en-us/azure/active-directory/roles/administrative-units](https://learn.microsoft.com/en-us/azure/active-directory/roles/administrative-units)
