# Az - AzureAD (AAD)

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–ª–æ–º AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**–®–∫–æ–ª–∞ HackTricks –¥–ª—è –µ–∫—Å–ø–µ—Ä—Ç—ñ–≤ —á–µ—Ä–≤–æ–Ω–æ—ó –∫–æ–º–∞–Ω–¥–∏ AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–ª–æ–º GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**–®–∫–æ–ª–∞ HackTricks –¥–ª—è –µ–∫—Å–ø–µ—Ä—Ç—ñ–≤ —á–µ—Ä–≤–æ–Ω–æ—ó –∫–æ–º–∞–Ω–¥–∏ GCP (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫–µ—Ä—Å—å–∫—ñ —Ç—Ä—é–∫–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ GitHub.

</details>
{% endhint %}

## –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

Azure Active Directory (Azure AD) —Å–ª—É–∂–∏—Ç—å —Ö–º–∞—Ä–Ω–∏–º —Å–µ—Ä–≤—ñ—Å–æ–º Microsoft –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —ñ–¥–µ–Ω—Ç–∏—á–Ω—ñ—Å—Ç—é —Ç–∞ –¥–æ—Å—Ç—É–ø–æ–º. –í—ñ–Ω —î –∫–ª—é—á–æ–≤–∏–º –¥–ª—è —Ç–æ–≥–æ, —â–æ–± —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏ –º–æ–≥–ª–∏ —É–≤—ñ–π—Ç–∏ —Ç–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤ —è–∫ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ, —Ç–∞–∫ —ñ –ø–æ–∑–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—î—é, –æ—Ö–æ–ø–ª—é—é—á–∏ Microsoft 365, –ø–æ—Ä—Ç–∞–ª Azure —Ç–∞ –±–µ–∑–ª—ñ—á —ñ–Ω—à–∏—Ö –ø—Ä–æ–≥—Ä–∞–º SaaS. –î–∏–∑–∞–π–Ω Azure AD —Å–ø—Ä—è–º–æ–≤–∞–Ω–∏–π –Ω–∞ –Ω–∞–¥–∞–Ω–Ω—è –æ—Å–Ω–æ–≤–Ω–∏—Ö —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ–π–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤, –≤–∫–ª—é—á–∞—é—á–∏ **–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é —Ç–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏**.

–ö–ª—é—á–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó Azure AD –≤–∫–ª—é—á–∞—é—Ç—å **–±–∞–≥–∞—Ç–æ—Ñ–∞–∫—Ç–æ—Ä–Ω—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é** —Ç–∞ **—É–º–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø**, —Ä–∞–∑–æ–º –∑ –±–µ–∑—à–æ–≤–Ω–æ—é —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—î—é –∑ —ñ–Ω—à–∏–º–∏ —Å–ª—É–∂–±–∞–º–∏ –±–µ–∑–ø–µ–∫–∏ Microsoft. –¶—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –∑–Ω–∞—á–Ω–æ –ø—ñ–¥–≤–∏—â—É—é—Ç—å –±–µ–∑–ø–µ–∫—É —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–µ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è–º –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –≤–ø—Ä–æ–≤–∞–¥–∂—É–≤–∞—Ç–∏ —Ç–∞ –∑–¥—ñ–π—Å–Ω—é–≤–∞—Ç–∏ —Å–≤–æ—ó –ø–æ–ª—ñ—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø—É. –Ø–∫ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –µ–∫–æ—Å–∏—Å—Ç–µ–º–∏ —Ö–º–∞—Ä–Ω–∏—Ö –ø–æ—Å–ª—É–≥ Microsoft, Azure AD —î –∫–ª—é—á–æ–≤–∏–º –¥–ª—è —Ö–º–∞—Ä–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—è–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.

## –°—É—Ç–Ω–æ—Å—Ç—ñ

### –ü–µ—Ä–µ–ª—ñ–∫

–î–ª—è —Ü—å–æ–≥–æ –ø–µ—Ä–µ–ª—ñ–∫—É –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ [**—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞ az**](https://docs.microsoft.com/en-us/cli/azure/install-azure-cli)**,** –º–æ–¥—É–ª—å **PowerShell** [**AzureAD**](https://www.powershellgallery.com/packages/AzureAD/) (–∞–±–æ [**AzureAD Preview**](https://www.powershellgallery.com/packages/AzureADPreview)) —Ç–∞ –º–æ–¥—É–ª—å [**Az PowerShell**](https://learn.microsoft.com/en-us/powershell/azure/install-az-ps).

{% hint style="success" %}
–£ Linux –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ PowerShell Core:
```bash
sudo apt-get update
sudo apt-get install -y wget apt-transport-https software-properties-common

# Ubuntu 20.04
wget -q https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb

# Update repos
sudo apt-get update
sudo add-apt-repository universe

# Install & start powershell
sudo apt-get install -y powershell
pwsh

# Az cli
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```
{% endhint %}

#### **–†—ñ–∑–Ω–∏—Ü—è –º–æ–¥—É–ª—ñ–≤**

* **AzureAD** - —Ü–µ –º–æ–¥—É–ª—å PowerShell –≤—ñ–¥ Microsoft –¥–ª—è **—É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è Azure AD. –í—ñ–Ω –Ω–µ –ø–æ–∫–∞–∑—É—î –≤—Å—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –æ–±'—î–∫—Ç—ñ–≤ Azure AD —ñ –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ä–µ—Å—É—Ä—Å–∏ Azure**.
* **Az PowerShell** - —Ü–µ –º–æ–¥—É–ª—å –¥–ª—è **—É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å–∞–º–∏ Azure** –∑ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞ PowerShell.

### **–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è**

{% tabs %}
{% tab title="az cli" %}
```bash
az login #This will open the browser
az login -u <username> -p <password> #Specify user and password
az login --identity #Use the current machine managed identity (metadata)
az login --identity -u /subscriptions/<subscriptionId>/resourcegroups/myRG/providers/Microsoft.ManagedIdentity/userAssignedIdentities/myID #Login with user managed identity
# Login as service principal
az login --service-principal -u http://azure-cli-2016-08-05-14-31-15 -p VerySecret --tenant contoso.onmicrosoft.com #With password
az login --service-principal -u http://azure-cli-2016-08-05-14-31-15 -p ~/mycertfile.pem --tenant contoso.onmicrosoft.com #With cert

# Request access token (ARM)
az account get-access-token
# Request access token for different resource. Supported tokens: aad-graph, arm, batch, data-lake, media, ms-graph, oss-rdbms
az account get-access-token --resource-type aad-graph

# If you want to configure some defaults
az configure

# Get user logged-in already
az ad signed-in-user show

# Help
az find "vm" # Find vm commands
az vm -h # Get subdomains
az ad user list --query-examples # Get examples
```
{% endtab %}

{% tab title="Azure AD" %}
{% code overflow="wrap" %}
```powershell
Connect-AzureAD #Open browser
# Using credentials
$passwd = ConvertTo-SecureString "Welcome2022!" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential ("test@corp.onmicrosoft.com", $passwd)
Connect-AzureAD -Credential $creds

# Using tokens
## AzureAD cannot request tokens, but can use AADGraph and MSGraph tokens to connect
Connect-AzureAD -AccountId test@corp.onmicrosoft.com -AadAccessToken $token
```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
```powershell
Connect-AzAccount #Open browser
# Using credentials
$passwd = ConvertTo-SecureString "Welcome2022!" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential("test@corp.onmicrosoft.com", $passwd)
Connect-AzAccount -Credential $creds

# Get Access Token
(Get-AzAccessToken).Token
# Request access token to other endpoints: AadGraph, AnalysisServices, Arm, Attestation, Batch, DataLake, KeyVault, MSGraph, OperationalInsights, ResourceManager, Storage, Synapse
Get-AzAccessToken -ResourceTypeName MSGraph
(Get-AzAccessToken -Resource "https://graph.microsoft.com").Token

# Conenct with access token
Connect-AzAccount -AccountId test@corp.onmicrosoft.com -AccessToken $token
Connect-AzAccount -AccessToken $token -GraphAccessToken $graphaccesstoken -AccountId <ACCOUNT-ID>
## The -AccessToken is from management.azure.com

# Connect with Service principal/enterprise app secret
$password = ConvertTo-SecureString 'KWEFNOIRFIPMWL.--DWPNVFI._EDWWEF_ADF~SODNFBWRBIF' -AsPlainText -Force
$creds = New-Object
System.Management.Automation.PSCredential('2923847f-fca2-a420-df10-a01928bec653', $password)
Connect-AzAccount -ServicePrincipal -Credential $creds -Tenant 29sd87e56-a192-a934-bca3-0398471ab4e7d

#All the Azure AD cmdlets have the format *-AzAD*
Get-Command *azad*
#Cmdlets for other Azure resources have the format *Az*
Get-Command *az*
```
{% endtab %}

{% tab title="Raw PS" %}
{% code overflow="wrap" %}
```powershell
#Using management
$Token = 'eyJ0eXAi..'
# List subscriptions
$URI = 'https://management.azure.com/subscriptions?api-version=2020-01-01'
$RequestParams = @{
Method  = 'GET'
Uri     = $URI
Headers = @{
'Authorization' = "Bearer $Token"
}
}
(Invoke-RestMethod @RequestParams).value

# Using graph
Invoke-WebRequest -Uri "https://graph.windows.net/myorganization/users?api-version=1.6" -Headers @{Authorization="Bearer {0}" -f $Token}
```
{% endcode %}
{% endtab %}

{% tab title="–°–∏—Ä–æ–≤–∞ –û–°" %}
{% code overflow="wrap" %}
```bash
# Request tokens to access endpoints
# ARM
curl "$IDENTITY_ENDPOINT?resource=https://management.azure.com&api-version=2017-09-01" -H secret:$IDENTITY_HEADER

# Vault
curl "$IDENTITY_ENDPOINT?resource=https://vault.azure.net&api-version=2017-09-01" -H secret:$IDENTITY_HEADER
```
{% endcode %}
{% endtab %}
{% endtabs %}

–ö–æ–ª–∏ –≤–∏ **—É–≤—ñ–π–¥–µ—Ç–µ** —á–µ—Ä–µ–∑ **CLI** –≤ Azure –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –±—É–¥—å-—è–∫–æ—ó –ø—Ä–æ–≥—Ä–∞–º–∏, –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ **Azure Application** –∑ **—Ç–µ–Ω–∞–Ω—Ç–æ–º**, —è–∫–∏–π –Ω–∞–ª–µ–∂–∏—Ç—å **Microsoft**. –¶—ñ –¥–æ–¥–∞—Ç–∫–∏, —Ç–∞–∫—ñ —è–∫ —Ç—ñ, —è–∫—ñ –≤–∏ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —É —Å–≤–æ—î–º—É –æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—ñ, **–º–∞—é—Ç—å —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–ª—ñ—î–Ω—Ç–∞**. –í–∏ **–Ω–µ –∑–º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤—Å—ñ –∑ –Ω–∏—Ö** —É **—Å–ø–∏—Å–∫–∞—Ö –¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö –¥–æ–¥–∞—Ç–∫—ñ–≤**, —è–∫—ñ –≤–∏ –±–∞—á–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—ñ, **–∞–ª–µ –≤–æ–Ω–∏ –¥–æ–∑–≤–æ–ª–µ–Ω—ñ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º**.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, **—Å–∫—Ä–∏–ø—Ç powershell**, —è–∫–∏–π **–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫—É—î—Ç—å—Å—è**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –¥–æ–¥–∞—Ç–æ–∫ –∑ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–æ–º –∫–ª—ñ—î–Ω—Ç–∞ **`1950a258-227b-4e31-a9cf-717495945fc2`**. –ù–∞–≤—ñ—Ç—å —è–∫—â–æ –¥–æ–¥–∞—Ç–æ–∫ –Ω–µ –∑'—è–≤–ª—è—î—Ç—å—Å—è –≤ –∫–æ–Ω—Å–æ–ª—ñ, —Å–∏—Å—Ç–µ–º–Ω–∏–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ **–∑–∞–±–ª–æ–∫—É–≤–∞—Ç–∏ —Ü–µ–π –¥–æ–¥–∞—Ç–æ–∫**, —â–æ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –Ω–µ –º–æ–≥–ª–∏ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤, —è–∫—ñ –ø—ñ–¥–∫–ª—é—á–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ —Ü–µ–π –¥–æ–¥–∞—Ç–æ–∫.

–û–¥–Ω–∞–∫ —î **—ñ–Ω—à—ñ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –∫–ª—ñ—î–Ω—Ç—ñ–≤** –¥–æ–¥–∞—Ç–∫—ñ–≤, —è–∫—ñ **–¥–æ–∑–≤–æ–ª—è—Ç—å –≤–∞–º –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ Azure**:
```powershell
# The important part is the ClientId, which identifies the application to login inside Azure

$token = Invoke-Authorize -Credential $credential `
-ClientId '1dfb5f98-f363-4b0f-b63a-8d20ada1e62d' `
-Scope 'Files.Read.All openid profile Sites.Read.All User.Read email' `
-Redirect_Uri "https://graphtryit-staging.azurewebsites.net/" `
-Verbose -Debug `
-InformationAction Continue

$token = Invoke-Authorize -Credential $credential `
-ClientId '65611c08-af8c-46fc-ad20-1888eb1b70d9' `
-Scope 'openid profile Sites.Read.All User.Read email' `
-Redirect_Uri "chrome-extension://imjekgehfljppdblckcmjggcoboemlah" `
-Verbose -Debug `
-InformationAction Continue

$token = Invoke-Authorize -Credential $credential `
-ClientId 'd3ce4cf8-6810-442d-b42e-375e14710095' `
-Scope 'openid' `
-Redirect_Uri "https://graphexplorer.azurewebsites.net/" `
-Verbose -Debug `
-InformationAction Continue
```
### –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ

{% tabs %}
{% tab title="az cli" %}
```bash
# Enumerate users
az ad user list --output table
az ad user list --query "[].userPrincipalName"
# Get info of 1 user
az ad user show --id "test@corp.onmicrosoft.com"
# Search "admin" users
az ad user list --query "[].displayName" | findstr /i "admin"
az ad user list --query "[?contains(displayName,'admin')].displayName"
# Search attributes containing the word "password"
az ad user list | findstr /i "password" | findstr /v "null,"
# All users from AzureAD
az ad user list --query "[].{osi:onPremisesSecurityIdentifier,upn:userPrincipalName}[?osi==null]"
az ad user list --query "[?onPremisesSecurityIdentifier==null].displayName"
# All users synced from on-prem
az ad user list --query "[].{osi:onPremisesSecurityIdentifier,upn:userPrincipalName}[?osi!=null]"
az ad user list --query "[?onPremisesSecurityIdentifier!=null].displayName"
# Get groups where the user is a member
az ad user get-member-groups --id <email>
# Get roles assigned to the user
az role assignment list --include-groups --include-classic-administrators true --assignee <email>
```
{% endtab %}

{% tab title="Azure AD" %}–£ Azure AD —î –∫—ñ–ª—å–∫–∞ –≤–∞–∂–ª–∏–≤–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –±–µ–∑–ø–µ–∫–∏, —è–∫—ñ —Å–ª—ñ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—ñ–¥ —á–∞—Å –∞—É–¥–∏—Ç—É –±–µ–∑–ø–µ–∫–∏. –ù–∏–∂—á–µ –Ω–∞–≤–µ–¥–µ–Ω–æ –∫—ñ–ª—å–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π:

1. **–ú—É–ª—å—Ç–∏—Ñ–∞–∫—Ç–æ—Ä–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è (MFA)**: –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ MFA —É–≤—ñ–º–∫–Ω–µ–Ω–æ –¥–ª—è –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –æ—Å–æ–±–ª–∏–≤–æ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤.

2. **–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ä–æ–ª—è–º–∏**: –ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–π—Ç–µ —Ä–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –≤ Azure AD, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –Ω–∞–¥–º—ñ—Ä–Ω–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤.

3. **–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–æ—Å—Ç—É–ø–æ–º**: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–æ–¥–∞—Ç–∫—ñ–≤ —Ç–∞ —Å–µ—Ä–≤—ñ—Å—ñ–≤ —É Azure AD, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –Ω–µ–ø–æ—Ç—Ä—ñ–±–Ω–∏—Ö –¥–æ–∑–≤–æ–ª—ñ–≤.

4. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –≤—Ö–æ–¥—ñ–≤**: –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –∂—É—Ä–Ω–∞–ª—é–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø—ñ–¥–æ–∑—Ä—ñ–ª–∏—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π.

5. **–û–Ω–æ–≤–ª–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏**: –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤—Å—ñ —Å–∏—Å—Ç–µ–º–∏ —Ç–∞ –¥–æ–¥–∞—Ç–∫–∏ –≤ Azure AD –º–∞—é—Ç—å –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏.

6. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤**: –í–∏–º–∞–≥–∞–π—Ç–µ —Å–∫–ª–∞–¥–Ω–∏—Ö –ø–∞—Ä–æ–ª—ñ–≤ —Ç–∞ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—É –∑–º—ñ–Ω—É –ø–∞—Ä–æ–ª—ñ–≤ –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤.

7. **–®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≤ Azure AD.

–¶—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–æ–ø–æ–º–æ–∂—É—Ç—å –ø—ñ–¥–≤–∏—â–∏—Ç–∏ —Ä—ñ–≤–µ–Ω—å –±–µ–∑–ø–µ–∫–∏ –≤ Azure AD —Ç–∞ –∑–∞–ø–æ–±—ñ–≥—Ç–∏ –º–æ–∂–ª–∏–≤–∏–º –∑–∞–≥—Ä–æ–∑–∞–º –±–µ–∑–ø–µ–∫–∏.{% endtab %}
```powershell
# Enumerate Users
Get-AzureADUser -All $true
Get-AzureADUser -All $true | select UserPrincipalName
# Get info of 1 user
Get-AzureADUser -ObjectId test@corp.onmicrosoft.com | fl
# Search "admin" users
Get-AzureADUser -SearchString "admin" #Search admin at the begining of DisplayName or userPrincipalName
Get-AzureADUser -All $true |?{$_.Displayname -match "admin"} #Search "admin" word in DisplayName
# Get all attributes of a user
Get-AzureADUser -ObjectId test@defcorphq.onmicrosoft.com|%{$_.PSObject.Properties.Name}
# Search attributes containing the word "password"
Get-AzureADUser -All $true |%{$Properties = $_;$Properties.PSObject.Properties.Name | % {if ($Properties.$_ -match 'password') {"$($Properties.UserPrincipalName) - $_ - $($Properties.$_)"}}}
# All users from AzureAD# All users from AzureAD
Get-AzureADUser -All $true | ?{$_.OnPremisesSecurityIdentifier -eq $null}
# All users synced from on-prem
Get-AzureADUser -All $true | ?{$_.OnPremisesSecurityIdentifier -ne $null}
# Objects created by a/any user
Get-AzureADUser [-ObjectId <email>] | Get-AzureADUserCreatedObject
# Devices owned by a user
Get-AzureADUserOwnedDevice -ObjectId test@corp.onmicrosoft.com
# Objects owned by a specific user
Get-AzureADUserOwnedObject -ObjectId test@corp.onmicrosoft.com
# Get groups & roles where the user is a member
Get-AzureADUserMembership -ObjectId 'test@corp.onmicrosoft.com'
# Get devices owned by a user
Get-AzureADUserOwnedDevice -ObjectId test@corp.onmicrosoft.com
# Get devices registered by a user
Get-AzureADUserRegisteredDevice -ObjectId test@defcorphq.onmicrosoft.com
# Apps where a user has a role (role not shown)
Get-AzureADUser -ObjectId roygcain@defcorphq.onmicrosoft.com | Get-AzureADUserAppRoleAssignment | fl *
# Get Administrative Units of a user
$userObj = Get-AzureADUser -Filter "UserPrincipalName eq 'bill@example.com'"
Get-AzureADMSAdministrativeUnit | where { Get-AzureADMSAdministrativeUnitMember -Id $_.Id | where { $_.Id -eq $userObj.ObjectId } }
```
{% endtab %}

{% tab title="Az PowerShell" %} 

### –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Azure AD –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Az PowerShell

1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –º–æ–¥—É–ª—å Az PowerShell, —è–∫—â–æ –≤—ñ–Ω —â–µ –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π:

```bash
Install-Module -Name Az -AllowClobber -Scope CurrentUser
```

2. –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ Azure AD –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å–≤–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É:

```bash
Connect-AzAccount
```

3. –ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ü—ñ—î—ó –∫–æ–º–∞–Ω–¥–∏ –≤–∞—Å –±—É–¥–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤—Ö–æ–¥—É Azure AD —É –≤–∞—à–æ–º—É –≤–µ–±-–±—Ä–∞—É–∑–µ—Ä—ñ. –£–≤—ñ–π–¥—ñ—Ç—å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å–≤–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Ç–∞ –Ω–∞–¥–∞–π—Ç–µ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥–æ–∑–≤–æ–ª–∏.

4. –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –≤—Ö–æ–¥—É –≤–∏ –±—É–¥–µ—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω—ñ –¥–æ —Å–≤–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É Azure AD —á–µ—Ä–µ–∑ Az PowerShell.

```bash
Get-AzContext
```

–¶—è –∫–æ–º–∞–Ω–¥–∞ –≤–∏–≤–µ–¥–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –≤–∞—à –ø–æ—Ç–æ—á–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç Azure AD.

{% endtab %}
```powershell
# Enumerate users
Get-AzADUser
# Get details of a user
Get-AzADUser -UserPrincipalName test@defcorphq.onmicrosoft.com
# Search user by string
Get-AzADUser -SearchString "admin" #Search at the beginnig of DisplayName
Get-AzADUser | ?{$_.Displayname -match "admin"}
# Get roles assigned to a user
Get-AzRoleAssignment -SignInName test@corp.onmicrosoft.com
```
{% endtab %}
{% endtabs %}

#### –ó–º—ñ–Ω–∞ –ø–∞—Ä–æ–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

{% code overflow="wrap" %}
```powershell
$password = "ThisIsTheNewPassword.!123" | ConvertTo- SecureString -AsPlainText ‚ÄìForce

(Get-AzureADUser -All $true | ?{$_.UserPrincipalName -eq "victim@corp.onmicrosoft.com"}).ObjectId | Set- AzureADUserPassword -Password $password ‚ÄìVerbose
```
{% endcode %}

### MFA & –£–º–æ–≤–Ω—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø—É

–í–∏—Å–æ–∫–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –¥–æ–¥–∞—Ç–∏ MFA –¥–æ –∫–æ–∂–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –æ–¥–Ω–∞–∫ –¥–µ—è–∫—ñ –∫–æ–º–ø–∞–Ω—ñ—ó –º–æ–∂—É—Ç—å –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –π–æ–≥–æ –∞–±–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –∑ –£–º–æ–≤–Ω–∏–º –¥–æ—Å—Ç—É–ø–æ–º: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –±—É–¥–µ **–ø–æ—Ç—Ä—ñ–±–Ω–æ MFA**, —è–∫—â–æ –≤—ñ–Ω —É–≤—ñ–π–¥–µ –∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º—ñ—Å—Ü—è, –±—Ä–∞—É–∑–µ—Ä–∞ –∞–±–æ **—è–∫–æ—ó—Å—å —É–º–æ–≤–∏**. –¶—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏, —è–∫—â–æ –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –º–æ–∂—É—Ç—å –±—É—Ç–∏ —Å—Ö–∏–ª—å–Ω—ñ –¥–æ **–æ–±—Ö—ñ–¥—É**. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ:

{% content-ref url="az-conditional-access-policies-mfa-bypass.md" %}
[az-conditional-access-policies-mfa-bypass.md](az-conditional-access-policies-mfa-bypass.md)
{% endcontent-ref %}

### –ì—Ä—É–ø–∏

{% tabs %}
{% tab title="az cli" %}
```powershell
# Enumerate groups
az ad group list
az ad group list --query "[].[displayName]" -o table
# Get info of 1 group
az ad group show --group <group>
# Get "admin" groups
az ad group list --query "[].displayName" | findstr /i "admin"
az ad group list --query "[?contains(displayName,'admin')].displayName"
# All groups from AzureAD
az ad group list --query "[].{osi:onPremisesSecurityIdentifier,displayName:displayName,description:description}[?osi==null]"
az ad group list --query "[?onPremisesSecurityIdentifier==null].displayName"
# All groups synced from on-prem
az ad group list --query "[].{osi:onPremisesSecurityIdentifier,displayName:displayName,description:description}[?osi!=null]"
az ad group list --query "[?onPremisesSecurityIdentifier!=null].displayName"
# Get members of group
az ad group member list --group <group> --query "[].userPrincipalName" -o table
# Check if member of group
az ad group member check --group "VM Admins" --member-id <id>
# Get which groups a group is member of
az ad group get-member-groups -g "VM Admins"
# Get Apps where a group has a role (role not shown)
Get-AzureADGroup -ObjectId <id> | Get-AzureADGroupAppRoleAssignment | fl *
```
{% endtab %}

{% tab title="Azure AD" %}–£ Azure AD —î –∫—ñ–ª—å–∫–∞ –≤–∞–∂–ª–∏–≤–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –±–µ–∑–ø–µ–∫–∏, —è–∫—ñ —Å–ª—ñ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—ñ–¥ —á–∞—Å –∞—É–¥–∏—Ç—É –±–µ–∑–ø–µ–∫–∏. –û—Å—å –∫—ñ–ª—å–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π:

1. **–ú—ñ—Ü–Ω—ñ –ø–∞—Ä–æ–ª—ñ**: –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–∏–º–∞–≥–∞—é—Ç—å—Å—è –º—ñ—Ü–Ω—ñ –ø–∞—Ä–æ–ª—ñ –¥–ª—è –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.

2. **–ë–∞–≥–∞—Ç–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è (MFA)**: –£–≤—ñ–º–∫–Ω—ñ—Ç—å MFA –¥–ª—è –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –æ—Å–æ–±–ª–∏–≤–æ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤.

3. **–û–±–º–µ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É**: –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ Azure AD –ª–∏—à–µ –∑ –¥–æ–≤—ñ—Ä–µ–Ω–∏—Ö IP-–∞–¥—Ä–µ—Å.

4. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –≤—Ö–æ–¥—ñ–≤**: –í–∫–ª—é—á—ñ—Ç—å –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –≤—Ö–æ–¥—ñ–≤ –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø—ñ–¥–æ–∑—Ä—ñ–ª–∏—Ö –¥—ñ–π.

5. **–ê—É–¥–∏—Ç –±–µ–∑–ø–µ–∫–∏**: –†–µ–≥—É–ª—è—Ä–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –∂—É—Ä–Ω–∞–ª–∏ –∞—É–¥–∏—Ç—É –±–µ–∑–ø–µ–∫–∏ –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –º–æ–∂–ª–∏–≤–∏—Ö –∑–∞–≥—Ä–æ–∑.

6. **–û–Ω–æ–≤–ª–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏**: –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤—Å—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ —Ç–∞ –∞–∫—Ç–∏–≤–Ω—ñ. {% endtab %}
```powershell
# Enumerate Groups
Get-AzureADGroup -All $true
# Get info of 1 group
Get-AzADGroup -DisplayName <resource_group_name> | fl
# Get "admin" groups
Get-AzureADGroup -SearchString "admin" | fl #Groups starting by "admin"
Get-AzureADGroup -All $true |?{$_.Displayname -match "admin"} #Groups with the word "admin"
# Get groups allowing dynamic membership
Get-AzureADMSGroup | ?{$_.GroupTypes -eq 'DynamicMembership'}
# All groups that are from Azure AD
Get-AzureADGroup -All $true | ?{$_.OnPremisesSecurityIdentifier -eq $null}
# All groups that are synced from on-prem (note that security groups are not synced)
Get-AzureADGroup -All $true | ?{$_.OnPremisesSecurityIdentifier -ne $null}
# Get members of a group
Get-AzureADGroupMember -ObjectId <group_id>
# Get roles of group
Get-AzureADMSGroup -SearchString "Contoso_Helpdesk_Administrators" #Get group id
Get-AzureADMSRoleAssignment -Filter "principalId eq '69584002-b4d1-4055-9c94-320542efd653'"
# Get Administrative Units of a group
$groupObj = Get-AzureADGroup -Filter "displayname eq 'TestGroup'"
Get-AzureADMSAdministrativeUnit | where { Get-AzureADMSAdministrativeUnitMember -Id $_.Id | where {$_.Id -eq $groupObj.ObjectId} }
```
{% endtab %}

{% tab title="Az PowerShell" %}**–ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è**

1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –º–æ–¥—É–ª—å Az —Ç–∞ –º–æ–¥—É–ª—å AzureAD:

```plaintext
Install-Module -Name Az -AllowClobber -Scope CurrentUser
Install-Module -Name AzureAD -AllowClobber -Scope CurrentUser
```

2. –£–≤—ñ–π–¥—ñ—Ç—å –≤ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å Azure:

```plaintext
Connect-AzAccount
```

3. –£–≤—ñ–π–¥—ñ—Ç—å –≤ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å Azure AD:

```plaintext
Connect-AzureAD
```

4. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `Get-AzContext` –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É.
```powershell
# Get all groups
Get-AzADGroup
# Get details of a group
Get-AzADGroup -ObjectId <id>
# Search group by string
Get-AzADGroup -SearchString "admin" | fl * #Search at the beginnig of DisplayName
Get-AzADGroup |?{$_.Displayname -match "admin"}
# Get members of group
Get-AzADGroupMember -GroupDisplayName <resource_group_name>
# Get roles of group
Get-AzRoleAssignment -ResourceGroupName <resource_group_name>
```
{% endtab %}
{% endtabs %}

#### –î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–æ –≥—Ä—É–ø–∏

–í–ª–∞—Å–Ω–∏–∫–∏ –≥—Ä—É–ø–∏ –º–æ–∂—É—Ç—å –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–æ –≥—Ä—É–ø–∏

{% code overflow="wrap" %}
```powershell
Add-AzureADGroupMember -ObjectId <group_id> -RefObjectId <user_id> -Verbose
```
{% endcode %}

{% hint style="warning" %}
–ì—Ä—É–ø–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–º–∏, —â–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É –æ–∑–Ω–∞—á–∞—î, —â–æ **—è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –ø–µ–≤–Ω–∏–º —É–º–æ–≤–∞–º, –≤—ñ–Ω –±—É–¥–µ –¥–æ–¥–∞–Ω–∏–π –¥–æ –≥—Ä—É–ø–∏**. –ó–≤—ñ—Å–Ω–æ, —è–∫—â–æ —É–º–æ–≤–∏ –±–∞–∑—É—é—Ç—å—Å—è –Ω–∞ **–∞—Ç—Ä–∏–±—É—Ç–∞—Ö**, —è–∫—ñ **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏**, –≤—ñ–Ω –º–æ–∂–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ —Ü—ñ—î—é —Ñ—É–Ω–∫—Ü—ñ—î—é, —â–æ–± **–ø–æ—Ç—Ä–∞–ø–∏—Ç–∏ –≤ —ñ–Ω—à—ñ –≥—Ä—É–ø–∏**.\
–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —è–∫ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–º–∏ –≥—Ä—É–ø–∞–º–∏ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ:
{% endhint %}

{% content-ref url="dynamic-groups.md" %}
[dynamic-groups.md](dynamic-groups.md)
{% endcontent-ref %}

### –°–µ—Ä–≤—ñ—Å–Ω—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª–∏ / –ü—ñ–¥–ø—Ä–∏—î–º–Ω–∏—Ü—å–∫—ñ –¥–æ–¥–∞—Ç–∫–∏

{% hint style="info" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ **–°–µ—Ä–≤—ñ—Å–Ω–∏–π –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª** –≤ —Ç–µ—Ä–º—ñ–Ω–æ–ª–æ–≥—ñ—ó PowerShell **–Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è** **–ü—ñ–¥–ø—Ä–∏—î–º–Ω–∏—Ü—å–∫—ñ –¥–æ–¥–∞—Ç–∫–∏** –≤ –ø–æ—Ä—Ç–∞–ª—ñ Azure (–≤–µ–±-–≤–µ—Ä—Å—ñ—è).
{% endhint %}

{% tabs %}
{% tab title="az cli" %}
```bash
# Get Service Principals
az ad sp list --all
az ad sp list --all --query "[].[displayName]" -o table
# Get details of one SP
az ad sp show --id 00000000-0000-0000-0000-000000000000
# Search SP by string
az ad sp list --all --query "[?contains(displayName,'app')].displayName"
# Get owner of service principal
az ad sp owner list --id <id> --query "[].[displayName]" -o table
# Get service principals owned by the current user
az ad sp list --show-mine
# List apps that have password credentials
az ad sp list --all --query "[?passwordCredentials != null].displayName"
# List apps that have key credentials (use of certificate authentication)
az ad sp list -all --query "[?keyCredentials != null].displayName"
```
{% endtab %}

{% tab title="Azure AD" %}–£ Azure AD —î –∫—ñ–ª—å–∫–∞ –≤–∞–∂–ª–∏–≤–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –±–µ–∑–ø–µ–∫–∏, —è–∫—ñ —Å–ª—ñ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—ñ–¥ —á–∞—Å —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ–Ω–∏–∫–Ω–µ–Ω–Ω—è:

1. **–ú—ñ—Ü–Ω—ñ –ø–∞—Ä–æ–ª—ñ**: –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–∏–º–æ–≥–∏ –¥–æ –ø–∞—Ä–æ–ª—ñ–≤ –Ω–∞–ª–µ–∂–Ω–∏–º —á–∏–Ω–æ–º –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ —ñ –≤–∏–º–∞–≥–∞—é—Ç—å —Å–∫–ª–∞–¥–Ω–∏—Ö –ø–∞—Ä–æ–ª—ñ–≤.

2. **–ë–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è**: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –≤–≤—ñ–º–∫–Ω–µ–Ω–∞ –±–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –¥–ª—è —É—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.

3. **–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–æ—Å—Ç—É–ø–æ–º**: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ä–æ–ª–µ–π —Ç–∞ –¥–æ–∑–≤–æ–ª—ñ–≤ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –≥—Ä—É–ø.

4. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –∂—É—Ä–Ω–∞–ª—é–≤–∞–Ω–Ω—è**: –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–≤—ñ–º–∫–Ω–µ–Ω—ñ —Ç–∞ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –∂—É—Ä–Ω–∞–ª–∏ –ø–æ–¥—ñ–π –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø—ñ–¥–æ–∑—Ä—ñ–ª–∏—Ö –¥—ñ–π.

5. **–û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –ø–∞—Ç—á—ñ**: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –≤—Å—ñ —Å–∏—Å—Ç–µ–º–∏ –º–∞—é—Ç—å –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –ø–∞—Ç—á—ñ –¥–ª—è —É—Å—É–Ω–µ–Ω–Ω—è –≤—ñ–¥–æ–º–∏—Ö —É—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π.

6. **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ —ñ–Ω—à–∏–º–∏ —Å–µ—Ä–≤—ñ—Å–∞–º–∏**: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó Azure AD –∑ —ñ–Ω—à–∏–º–∏ —Å–µ—Ä–≤—ñ—Å–∞–º–∏ —Ç–∞ –¥–æ–¥–∞—Ç–∫–∞–º–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –º–æ–∂–ª–∏–≤–∏—Ö —É—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π.

7. **–†–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Ç–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è**: –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Ç–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏ —Ç–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó. {% endtab %}
```powershell
# Get Service Principals
Get-AzureADServicePrincipal -All $true
# Get details about a SP
Get-AzureADServicePrincipal -ObjectId <id> | fl *
# Get SP by string name or Id
Get-AzureADServicePrincipal -All $true | ?{$_.DisplayName -match "app"} | fl
Get-AzureADServicePrincipal -All $true | ?{$_.AppId -match "103947652-1234-5834-103846517389"}
# Get owner of SP
Get-AzureADServicePrincipal -ObjectId <id> | Get-AzureADServicePrincipalOwner |fl *
# Get objects owned by a SP
Get-AzureADServicePrincipal -ObjectId <id> | Get-AzureADServicePrincipalOwnedObject
# Get objects created by a SP
Get-AzureADServicePrincipal -ObjectId <id> | Get-AzureADServicePrincipalCreatedObject
# Get groups where the SP is a member
Get-AzureADServicePrincipal | Get-AzureADServicePrincipalMembership
Get-AzureADServicePrincipal -ObjectId <id> | Get-AzureADServicePrincipalMembership |fl *
```
{% endtab %}

{% tab title="Az PowerShell" %} 

### –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Azure AD

1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –º–æ–¥—É–ª—å Azure AD:

```bash
Install-Module -Name Az -AllowClobber -Scope CurrentUser
```

2. –£–≤—ñ–π–¥—ñ—Ç—å –≤ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å Azure:

```bash
Connect-AzAccount
```

3. –í–∏–±–µ—Ä—ñ—Ç—å –ø—ñ–¥–ø–∏—Å–∫—É, —è–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:

```bash
Select-AzSubscription -SubscriptionName "SubscriptionName"
```

4. –û—Ç—Ä–∏–º–∞–π—Ç–µ –¥–∞–Ω—ñ –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ Azure AD:

```bash
Get-AzureADUser
```

{% endtab %}
```powershell
# Get SPs
Get-AzADServicePrincipal
# Get info of 1 SP
Get-AzADServicePrincipal -ObjectId <id>
# Search SP by string
Get-AzADServicePrincipal | ?{$_.DisplayName -match "app"}
# Get roles of a SP
Get-AzRoleAssignment -ServicePrincipalName <String>
```
{% endtab %}

{% tab title="–û—Ä–∏–≥—ñ–Ω–∞–ª" %}The Azure AD application registration process is a critical step in integrating your application with Azure AD. During a penetration test, it is important to review the permissions granted to the application to ensure they are not overly permissive and do not expose sensitive data. Additionally, verifying the redirect URIs configured for the application can help prevent unauthorized access to authentication tokens. Finally, monitoring the application registration portal for any unauthorized changes is crucial for maintaining the security of your Azure AD environment.{% endtab %}
```powershell
$Token = 'eyJ0eX..'
$URI = 'https://graph.microsoft.com/v1.0/applications'
$RequestParams = @{
Method  = 'GET'
Uri     = $URI
Headers = @{
'Authorization' = "Bearer $Token"
}
}
(Invoke-RestMethod @RequestParams).value
```
{% endtab %}
{% endtabs %}

{% hint style="warning" %}
–í–ª–∞—Å–Ω–∏–∫ —Å–ª—É–∂–±–æ–≤–æ–≥–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª—É –º–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏ –π–æ–≥–æ –ø–∞—Ä–æ–ª—å.
{% endhint %}

<details>

<summary>–ü–µ—Ä–µ–ª—ñ–∫ —Ç–∞ —Å–ø—Ä–æ–±–∞ –¥–æ–¥–∞—Ç–∏ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∏–π —Å–µ–∫—Ä–µ—Ç –¥–æ –∫–æ–∂–Ω–æ–≥–æ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É</summary>
```powershell
# Just call Add-AzADAppSecret
Function Add-AzADAppSecret
{
<#
.SYNOPSIS
Add client secret to the applications.

.PARAMETER GraphToken
Pass the Graph API Token

.EXAMPLE
PS C:\> Add-AzADAppSecret -GraphToken 'eyJ0eX..'

.LINK
https://docs.microsoft.com/en-us/graph/api/application-list?view=graph-rest-1.0&tabs=http
https://docs.microsoft.com/en-us/graph/api/application-addpassword?view=graph-rest-1.0&tabs=http
#>

[CmdletBinding()]
param(
[Parameter(Mandatory=$True)]
[String]
$GraphToken = $null
)

$AppList = $null
$AppPassword = $null

# List All the Applications

$Params = @{
"URI"     = "https://graph.microsoft.com/v1.0/applications"
"Method"  = "GET"
"Headers" = @{
"Content-Type"  = "application/json"
"Authorization" = "Bearer $GraphToken"
}
}

try
{
$AppList = Invoke-RestMethod @Params -UseBasicParsing
}
catch
{
}

# Add Password in the Application

if($AppList -ne $null)
{
[System.Collections.ArrayList]$Details = @()

foreach($App in $AppList.value)
{
$ID = $App.ID
$psobj = New-Object PSObject

$Params = @{
"URI"     = "https://graph.microsoft.com/v1.0/applications/$ID/addPassword"
"Method"  = "POST"
"Headers" = @{
"Content-Type"  = "application/json"
"Authorization" = "Bearer $GraphToken"
}
}

$Body = @{
"passwordCredential"= @{
"displayName" = "Password"
}
}

try
{
$AppPassword = Invoke-RestMethod @Params -UseBasicParsing -Body ($Body | ConvertTo-Json)
Add-Member -InputObject $psobj -NotePropertyName "Object ID" -NotePropertyValue $ID
Add-Member -InputObject $psobj -NotePropertyName "App ID" -NotePropertyValue $App.appId
Add-Member -InputObject $psobj -NotePropertyName "App Name" -NotePropertyValue $App.displayName
Add-Member -InputObject $psobj -NotePropertyName "Key ID" -NotePropertyValue $AppPassword.keyId
Add-Member -InputObject $psobj -NotePropertyName "Secret" -NotePropertyValue $AppPassword.secretText
$Details.Add($psobj) | Out-Null
}
catch
{
Write-Output "Failed to add new client secret to '$($App.displayName)' Application."
}
}
if($Details -ne $null)
{
Write-Output ""
Write-Output "Client secret added to : "
Write-Output $Details | fl *
}
}
else
{
Write-Output "Failed to Enumerate the Applications."
}
}
```
</details>

### –†–æ–ª—ñ

{% tabs %}
{% tab title="az cli" %}
```bash
# Get roles
az role definition list
# Get assigned roles
az role assignment list --all --query "[].roleDefinitionName"
az role assignment list --all | jq '.[] | .roleDefinitionName,.scope'
# Get info of 1 role
az role definition list --name "AzureML Registry User"
# Get only custom roles
az role definition list --custom-role-only
# Get only roles assigned to the resource group indicated
az role definition list --resource-group <resource_group>
# Get only roles assigned to the indicated scope
az role definition list --scope <scope>
# Get all the principals a role is assigned to
az role assignment list --all --query "[].{principalName:principalName,principalType:principalType,resourceGroup:resourceGroup,roleDefinitionName:roleDefinitionName}[?roleDefinitionName=='<ROLE_NAME>']"
```
{% endtab %}

{% tab title="Azure AD" %}

### –ê—Ç–∞–∫–∏ –Ω–∞ Azure AD

1. **–§—ñ—à–∏–Ω–≥ –∞—Ç–∞–∫–∏**: –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è —à–∞—Ö—Ä–∞–π—Å—å–∫–∏—Ö –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∏—Ö –ª–∏—Å—Ç—ñ–≤ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.
2. **–ê—Ç–∞–∫–∏ –Ω–∞ –ø–∞—Ä–æ–ª—ñ**: –°–ø—Ä–æ–±–∏ –≤–≥–∞–¥–∞—Ç–∏ –∞–±–æ –≤–∏–∫—Ä–∞—Å—Ç–∏ –ø–∞—Ä–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–ª—è –Ω–µ–∑–∞–∫–æ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É.
3. **–ê—Ç–∞–∫–∏ –Ω–∞ –º–Ω–æ–∂–∏–Ω–Ω—ñ —Ñ–∞–∫—Ç–æ—Ä–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó (MFA)**: –°–ø—Ä–æ–±–∏ –æ–±—ñ–π—Ç–∏ –∞–±–æ –≤–∏–º–∫–Ω—É—Ç–∏ MFA –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤.
4. **–ê—Ç–∞–∫–∏ –Ω–∞ —Ç–æ–∫–µ–Ω–∏ –¥–æ—Å—Ç—É–ø—É**: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤–∏–∫—Ä–∞–¥–µ–Ω–∏—Ö –∞–±–æ –ø—ñ–¥—Ä–æ–±–ª–µ–Ω–∏—Ö —Ç–æ–∫–µ–Ω—ñ–≤ –¥–æ—Å—Ç—É–ø—É –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤ Azure AD.
5. **–ê—Ç–∞–∫–∏ –Ω–∞ —Å–ª—É–∂–±—É Azure AD Connect**: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π –≤ Azure AD Connect –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ Azure AD.

{% endtab %}
```powershell
# Get all available role templates
Get-AzureADDirectoryroleTemplate
# Get enabled roles (Assigned roles)
Get-AzureADDirectoryRole
Get-AzureADDirectoryRole -ObjectId <roleID> #Get info about the role
# Get custom roles - use AzureAdPreview
Get-AzureADMSRoleDefinition | ?{$_.IsBuiltin -eq $False} | select DisplayName
# Users assigned a role (Global Administrator)
Get-AzureADDirectoryRole -Filter "DisplayName eq 'Global Administrator'" | Get-AzureADDirectoryRoleMember
Get-AzureADDirectoryRole -ObjectId <id> | fl
# Roles of the Administrative Unit (who has permissions over the administrative unit and its members)
Get-AzureADMSScopedRoleMembership -Id <id> | fl *
```
{% endtab %}

{% tab title="Az PowerShell" %} 

### –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Azure AD –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Az PowerShell

1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –º–æ–¥—É–ª—å Az PowerShell, —è–∫—â–æ –≤—ñ–Ω —â–µ –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π:

```bash
Install-Module -Name Az -AllowClobber -Scope CurrentUser
```

2. –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ Azure AD –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å–≤–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É:

```bash
Connect-AzAccount
```

3. –ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ü—ñ—î—ó –∫–æ–º–∞–Ω–¥–∏ –≤–∞—Å –±—É–¥–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω–∫—É –¥–ª—è –≤—Ö–æ–¥—É. –£–≤—ñ–π–¥—ñ—Ç—å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å–≤–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É Azure AD.

4. –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –≤—Ö–æ–¥—É –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—à–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Azure AD.

```bash
Account          SubscriptionName TenantId                             Environment
-------          ---------------- --------                             -----------
example@example.com Example Subscription 00000000-0000-0000-0000-000000000000 AzureCloud
```

5. –¢–µ–ø–µ—Ä –≤–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω—ñ –¥–æ Azure AD —ñ –≥–æ—Ç–æ–≤—ñ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ –¥—ñ—ó –∑ –æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –∑–∞–ø–∏—Å–∞–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –≥—Ä—É–ø–∞–º–∏ —Ç–æ—â–æ.

{% endtab %}
```powershell
# Get role assignments on the subscription
Get-AzRoleDefinition
# Get Role definition
Get-AzRoleDefinition -Name "Virtual Machine Command Executor"
# Get roles of a user or resource
Get-AzRoleAssignment -SignInName test@corp.onmicrosoft.com
Get-AzRoleAssignment -Scope /subscriptions/<subscription-id>/resourceGroups/<res_group_name>/providers/Microsoft.Compute/virtualMachines/<vm_name>
```
{% endtab %}

{% tab title="–û—Ä–∏–≥—ñ–Ω–∞–ª" %}–¶–µ–π –º–æ–¥—É–ª—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ Azure AD. –í—ñ–Ω –¥–æ–∑–≤–æ–ª—è—î –≤–∞–º –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –¥—ñ—ó, —Ç–∞–∫—ñ —è–∫ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è, –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –≥—Ä—É–ø, –∞ —Ç–∞–∫–æ–∂ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–∞–º–∏ —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏ Azure AD. –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ–π –º–æ–¥—É–ª—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó –∑–∞–≤–¥–∞–Ω—å —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è Azure AD —É —Å–≤–æ—ó—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—è—Ö —Å–∫—Ä–∏–ø—Ç—ñ–≤ –∞–±–æ –≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏ –∑ Azure AD –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä—É—á–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å.{% endtab %}
```powershell
# Get permissions over a resource using ARM directly
$Token = (Get-AzAccessToken).Token
$URI = 'https://management.azure.com/subscriptions/b413826f-108d-4049-8c11-d52d5d388768/resourceGroups/Research/providers/Microsoft.Compute/virtualMachines/infradminsrv/providers/Microsoft.Authorization/permissions?api-version=2015-07-01'
$RequestParams = @{
Method = 'GET'
Uri = $URI
Headers = @{
'Authorization' = "Bearer $Token"
}
}
(Invoke-RestMethod @RequestParams).value
```
### –ü—Ä–∏—Å—Ç—Ä–æ—ó

{% tabs %}
{% tab title="az cli" %}
```bash
# If you know how to do this send a PR!
```
{% endtab %}

{% tab title="Azure AD" %}–£ Azure AD —î –∫—ñ–ª—å–∫–∞ –∫–æ—Ä–∏—Å–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π –±–µ–∑–ø–µ–∫–∏, —è–∫—ñ –º–æ–∂–Ω–∞ —Å–∫–æ–Ω—Ñ—ñ–≥—É—Ä—É–≤–∞—Ç–∏ –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è —Ä—ñ–≤–Ω—è –±–µ–∑–ø–µ–∫–∏ –≤–∞—à–æ—ó –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó. –ù–∏–∂—á–µ –Ω–∞–≤–µ–¥–µ–Ω–æ –∫—ñ–ª—å–∫–∞ –ø–æ—Ä–∞–¥ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏ Azure AD:

1. **–£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è –±–∞–≥–∞—Ç–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–æ—ó –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó (MFA)**: –í–∏–º–∞–≥–∞–π—Ç–µ –≤–≤–µ–¥–µ–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤, —â–æ –¥–æ–ø–æ–º–∞–≥–∞—î —É–Ω–∏–∫–Ω—É—Ç–∏ –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É.

2. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —É–≤—ñ–π–¥—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤**: –°–ª—ñ–¥–∫—É–π—Ç–µ –∑–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –≤—á–∞—Å–Ω–æ —Ä–µ–∞–≥—É–π—Ç–µ –Ω–∞ –±—É–¥—å-—è–∫—ñ –ø—ñ–¥–æ–∑—Ä—ñ–ª—ñ –¥—ñ—ó.

3. **–û–±–º–µ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö**: –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö —Ç–∞–∫–∏–º —á–∏–Ω–æ–º, —â–æ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–∞–ª–∏ –¥–æ—Å—Ç—É–ø –ª–∏—à–µ –¥–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó.

4. **–ê—É–¥–∏—Ç –±–µ–∑–ø–µ–∫–∏**: –ü—Ä–æ–≤–æ–¥—å—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ñ –∞—É–¥–∏—Ç–∏ –±–µ–∑–ø–µ–∫–∏ –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –º–æ–∂–ª–∏–≤–∏—Ö –ø–æ—Ä—É—à–µ–Ω—å —Ç–∞ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π.

5. **–û–Ω–æ–≤–ª–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏**: –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤—Å—ñ —Å–∏—Å—Ç–µ–º–∏ —Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–Ω–µ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω—ñ –¥–æ –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –≤–µ—Ä—Å—ñ–π –∑ —É—Å—É–Ω–µ–Ω–Ω—è–º –≤—ñ–¥–æ–º–∏—Ö —É—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π. {% endtab %}
```powershell
# Enumerate Devices
Get-AzureADDevice -All $true | fl *
# List all the active devices (and not the stale devices)
Get-AzureADDevice -All $true | ?{$_.ApproximateLastLogonTimeStamp -ne $null}
# Get owners of all devices
Get-AzureADDevice -All $true | Get-AzureADDeviceRegisteredOwner
Get-AzureADDevice -All $true | %{if($user=Get-AzureADDeviceRegisteredOwner -ObjectId $_.ObjectID){$_;$user.UserPrincipalName;"`n"}}
# Registred users of all the devices
Get-AzureADDevice -All $true | Get-AzureADDeviceRegisteredUser
Get-AzureADDevice -All $true | %{if($user=Get-AzureADDeviceRegisteredUser -ObjectId $_.ObjectID){$_;$user.UserPrincipalName;"`n"}}
# Get dives managed using Intune
Get-AzureADDevice -All $true | ?{$_.IsCompliant -eq "True"}
# Get devices owned by a user
Get-AzureADUserOwnedDevice -ObjectId test@corp.onmicrosoft.com
# Get Administrative Units of a device
Get-AzureADMSAdministrativeUnit | where { Get-AzureADMSAdministrativeUnitMember -ObjectId $_.ObjectId | where {$_.ObjectId -eq $deviceObjId} }
```
{% endtab %}
{% endtabs %}

{% hint style="warning" %}
–Ø–∫—â–æ –ø—Ä–∏—Å—Ç—Ä—ñ–π (VM) **–ø—Ä–∏—î–¥–Ω–∞–Ω–∏–π –¥–æ AzureAD**, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑ AzureAD –∑–º–æ–∂—É—Ç—å **—É–≤—ñ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É**.\
–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —è–∫—â–æ —É–≤—ñ–π—à–æ–≤—à–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —î **–≤–ª–∞—Å–Ω–∏–∫–æ–º** –ø—Ä–∏—Å—Ç—Ä–æ—é, –≤—ñ–Ω –±—É–¥–µ **–ª–æ–∫–∞–ª—å–Ω–∏–º –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º**.
{% endhint %}

### –î–æ–¥–∞—Ç–∫–∏

{% hint style="info" %}
**–î–æ–¥–∞—Ç–∫–∏** - —Ü–µ **–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –¥–æ–¥–∞—Ç–∫—ñ–≤** –≤ –ø–æ—Ä—Ç–∞–ª—ñ (–Ω–µ –ü—ñ–¥–ø—Ä–∏—î–º–Ω–∏—Ü—å–∫—ñ –¥–æ–¥–∞—Ç–∫–∏).\
–ê–ª–µ –∫–æ–∂–Ω–∞ –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –¥–æ–¥–∞—Ç–∫—É —Å—Ç–≤–æ—Ä–∏—Ç—å **–ü—ñ–¥–ø—Ä–∏—î–º–Ω–∏—Ü—å–∫–∏–π –¥–æ–¥–∞—Ç–æ–∫** (**–°–ª—É–∂–±–æ–≤–∏–π –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª**) –∑ —Ç–∞–∫–æ—é –∂ –Ω–∞–∑–≤–æ—é.\
–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —è–∫—â–æ –î–æ–¥–∞—Ç–æ–∫ —î **–±–∞–≥–∞—Ç–æ–∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–∏–º –î–æ–¥–∞—Ç–∫–æ–º**, –±—É–¥–µ —Å—Ç–≤–æ—Ä–µ–Ω–æ **—ñ–Ω—à–∏–π** –ü—ñ–¥–ø—Ä–∏—î–º–Ω–∏—Ü—å–∫–∏–π –¥–æ–¥–∞—Ç–æ–∫ (**–°–ª—É–∂–±–æ–≤–∏–π –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª**) —É **—Ü—å–æ–º—É –∞—Ä–µ–Ω–¥–∞—Ä—ñ** –∑ —Ç–∞–∫–æ—é –∂ –Ω–∞–∑–≤–æ—é.
{% endhint %}

–ü—ñ–¥ —á–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –î–æ–¥–∞—Ç–∫—É –Ω–∞–¥–∞—é—Ç—å—Å—è 2 —Ç–∏–ø–∏ –¥–æ–∑–≤–æ–ª—ñ–≤:

* **–î–æ–∑–≤–æ–ª–∏**, –Ω–∞–¥–∞–Ω—ñ **–°–ª—É–∂–±–æ–≤–æ–º—É –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª—É**
* **–î–æ–∑–≤–æ–ª–∏**, —è–∫—ñ –º–æ–∂–µ –º–∞—Ç–∏ —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **–¥–æ–¥–∞—Ç–æ–∫ –≤—ñ–¥ —ñ–º–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**.
```bash
# List Apps
az ad app list
az ad app list --query "[].[displayName]" -o table
# Get info of 1 App
az ad app show --id 00000000-0000-0000-0000-000000000000
# Search App by string
az ad app list --query "[?contains(displayName,'app')].displayName"
# Get the owner of an application
az ad app owner list --id <id> --query "[].[displayName]" -o table
# List all the apps with an application password
az ad app list --query "[?passwordCredentials != null].displayName"
# List apps that have key credentials (use of certificate authentication)
az ad app list --query "[?keyCredentials != null].displayName"
```
{% endtab %}

{% tab title="Azure AD" %}–ó–∞—Ö–∏—Å—Ç Azure AD

–ü—ñ–¥ —á–∞—Å —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ –ø—Ä–æ–Ω–∏–∫–Ω–µ–Ω–Ω—è Azure AD –≤–∞–∂–ª–∏–≤–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—ñ –ø—É–Ω–∫—Ç–∏:

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ–ª—ñ—Ç–∏–∫ –ø–∞—Ä–æ–ª—ñ–≤ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–æ—§ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó.
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–æ–¥–∞—Ç–∫—ñ–≤ —Ç–∞ –ø—Ä–∏–≤—ñ–ª–µ—ó–≤.
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Ç–∞ –∂—É—Ä–Ω–∞–ª—é–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π.
5. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ –≤–∏—Ç–æ–∫—É –¥–∞–Ω–∏—Ö.
6. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ –ø—ñ—Å–ª—è –ø–µ–≤–Ω–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –Ω–µ–≤–¥–∞–ª–∏—Ö —Å–ø—Ä–æ–± –≤—Ö–æ–¥—É.
7. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ Azure AD –∑ –Ω–µ–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–∏—Ö –º–µ—Ä–µ–∂ –∞–±–æ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤.
```powershell
# List all registered applications
Get-AzureADApplication -All $true
# Get details of an application
Get-AzureADApplication -ObjectId <id>  | fl *
# List all the apps with an application password
Get-AzureADApplication -All $true | %{if(Get-AzureADApplicationPasswordCredential -ObjectID $_.ObjectID){$_}}
# Get owner of an application
Get-AzureADApplication -ObjectId <id> | Get-AzureADApplicationOwner |fl *
```
{% endtab %}

{% tab title="Az PowerShell" %} {% endtab %}
```powershell
# Get Apps
Get-AzADApplication
# Get details of one App
Get-AzADApplication -ObjectId <id>
# Get App searching by string
Get-AzADApplication | ?{$_.DisplayName -match "app"}
# Get Apps with password
Get-AzADAppCredential
```
{% endtab %}
{% endtabs %}

{% hint style="warning" %}
–î–æ–¥–∞—Ç–æ–∫ –∑ –¥–æ–∑–≤–æ–ª–æ–º **`AppRoleAssignment.ReadWrite`** –º–æ–∂–µ **–ø—ñ–¥–≤–∏—â–∏—Ç–∏ —Ä—ñ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø—É –¥–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞**, –Ω–∞–¥–∞—é—á–∏ —Å–æ–±—ñ —Ü—é —Ä–æ–ª—å.\
–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó [**–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ü–µ**](https://posts.specterops.io/azure-privilege-escalation-via-azure-api-permissions-abuse-74aee1006f48).
{% endhint %}

{% hint style="info" %}
–°–µ–∫—Ä–µ—Ç–Ω–∏–π —Ä—è–¥–æ–∫, —è–∫–∏–π –¥–æ–¥–∞—Ç–æ–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —Å–≤–æ—î—ó —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ –ø—Ä–∏ –∑–∞–ø–∏—Ç—ñ —Ç–æ–∫–µ–Ω–∞, - —Ü–µ –ø–∞—Ä–æ–ª—å –¥–æ–¥–∞—Ç–∫–∞.\
–¢–∞–∫–∏–º —á–∏–Ω–æ–º, —è–∫—â–æ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ —Ü–µ–π **–ø–∞—Ä–æ–ª—å**, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø —è–∫ **—Å–ª—É–∂–±–æ–≤–∏–π –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª** **–≤—Å–µ—Ä–µ–¥–∏–Ω—ñ** **–æ—Ä–µ–Ω–¥–∞—Ä—è**.\
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ü–µ–π –ø–∞—Ä–æ–ª—å –≤–∏–¥–Ω–æ –ª–∏—à–µ –ø—Ä–∏ –π–æ–≥–æ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó (–≤–∏ –º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ –π–æ–≥–æ, –∞–ª–µ –Ω–µ –∑–º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –π–æ–≥–æ –∑–Ω–æ–≤—É).\
**–í–ª–∞—Å–Ω–∏–∫** **–¥–æ–¥–∞—Ç–∫–∞** –º–æ–∂–µ **–¥–æ–¥–∞—Ç–∏ –¥–æ –Ω—å–æ–≥–æ –ø–∞—Ä–æ–ª—å** (—â–æ–± –≤—ñ–Ω –º—ñ–≥ –≤–∏–¥–∞–∞–≤–∞—Ç–∏ —Å–µ–±–µ).\
–£–≤—ñ—Ö–æ–¥–∏ –≤ —è–∫–æ—Å—Ç—ñ —Ü–∏—Ö —Å–ª—É–∂–±–æ–≤–∏—Ö –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª—ñ–≤ **–Ω–µ –ø–æ–∑–Ω–∞—á–∞—é—Ç—å—Å—è —è–∫ —Ä–∏–∑–∏–∫–æ–≤–∞–Ω—ñ** —ñ **–Ω–µ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –±–∞–≥–∞—Ç–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–æ—ó –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó.**
{% endhint %}

### –í—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å –º—ñ–∂ –î–æ–¥–∞—Ç–∫–∞–º–∏ —Ç–∞ (–ü—ñ–¥–ø—Ä–∏—î–º–Ω–∏—Ü—å–∫–∏–º–∏ –î–æ–¥–∞—Ç–∫–∞–º–∏ –∞–±–æ –°–ª—É–∂–±–æ–≤–∏–º–∏ –ü—Ä–∏–Ω—Ü–∏–ø–∞–ª–∞–º–∏)

–í—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å –º—ñ–∂ –¥–æ–¥–∞—Ç–∫–æ–º —Ç–∞ —Å–ª—É–∂–±–æ–≤–∏–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª–æ–º –≤ Azure:

* **–î–æ–¥–∞—Ç–æ–∫/–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –¥–æ–¥–∞—Ç–∫—ñ–≤**: –¶–µ –¥–æ–¥–∞—Ç–∫–∏, —è–∫—ñ —ñ—Å–Ω—É—é—Ç—å —É –≤–∞—à–æ–º—É Azure AD
* `(Get-AzureADApplication -filter "DisplayName eq 'testapp'")`
* **–°–ª—É–∂–±–æ–≤–∏–π –ü—Ä–∏–Ω—Ü–∏–ø–∞–ª/–ü—ñ–¥–ø—Ä–∏—î–º–Ω–∏—Ü—å–∫—ñ –î–æ–¥–∞—Ç–∫–∏**: –û–±'—î–∫—Ç–∏ –±–µ–∑–ø–µ–∫–∏ —É –≤–∞—à–æ–º—É Azure AD, —è–∫—ñ –º–æ–∂—É—Ç—å –º–∞—Ç–∏ **–ø—Ä–∏–≤—ñ–ª–µ—ó** –≤ Azure Directory —Ç–∞ –ø–æ–≤'—è–∑–∞–Ω—ñ –∞–±–æ –∑ –≤–∞—à–∏–º –¥–æ–¥–∞—Ç–∫–æ–º, –∞–±–æ –∑ –¥–æ–¥–∞—Ç–∫–æ–º —Å—Ç–æ—Ä–æ–Ω–Ω—å–æ—ó —Å—Ç–æ—Ä–æ–Ω–∏
* `Get-AzureADServicePrincipal -filter "DisplayName eq 'testapp'")`
* –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ –∑–∞—Ç–≤–µ—Ä–¥–∏—Ç–∏ –Ω–∞–¥–∞–Ω—ñ –¥–æ–∑–≤–æ–ª–∏, —è–∫—â–æ –≤–æ–Ω–∏ —î –¥—É–∂–µ —á—É—Ç–ª–∏–≤–∏–º–∏.

–î–æ–¥–∞—Ç–æ–∫ –º–æ–∂–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –≤ **–æ—Ä–µ–Ω–¥–∞—Ä—ñ —Å—Ç–æ—Ä–æ–Ω–Ω—å–æ—ó —Å—Ç–æ—Ä–æ–Ω–∏**, —ñ —è–∫ —Ç—ñ–ª—å–∫–∏ –≤–∏ –ø–æ—á–∏–Ω–∞—î—Ç–µ –π–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç–∞ –Ω–∞–¥–∞—î—Ç–µ –π–æ–º—É –¥–æ—Å—Ç—É–ø, –≤ **–≤–∞—à–æ–º—É –æ—Ä–µ–Ω–¥–∞—Ä—ñ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –ü—ñ–¥–ø—Ä–∏—î–º–Ω–∏—Ü—å–∫–∏–π –î–æ–¥–∞—Ç–æ–∫/–°–ª—É–∂–±–æ–≤–∏–π –ü—Ä–∏–Ω—Ü–∏–ø–∞–ª**, —â–æ–± –Ω–∞–¥–∞—Ç–∏ –π–æ–º—É –¥–æ—Å—Ç—É–ø –¥–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó:

### –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ñ –û–¥–∏–Ω–∏—Ü—ñ

–í–æ–Ω–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è –∫—Ä–∞—â–æ–≥–æ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏.

–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ñ –æ–¥–∏–Ω–∏—Ü—ñ **–æ–±–º–µ–∂—É—é—Ç—å –¥–æ–∑–≤–æ–ª–∏ –≤ —Ä–æ–ª—ñ –Ω–∞ –±—É–¥—å-—è–∫—É —á–∞—Å—Ç–∏–Ω—É –≤–∞—à–æ—ó –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó**, —è–∫—É –≤–∏ –≤–∏–∑–Ω–∞—á–∞—î—Ç–µ. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ñ –æ–¥–∏–Ω–∏—Ü—ñ –¥–ª—è –¥–µ–ª–µ–≥—É–≤–∞–Ω–Ω—è —Ä–æ–ª—ñ [–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –î–æ–≤—ñ–¥–∫–æ–≤–æ—ó —Å–ª—É–∂–±–∏](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference#helpdesk-administrator) —Ä–µ–≥—ñ–æ–Ω–∞–ª—å–Ω–∏–º —Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç–∞–º –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏, —â–æ–± –≤–æ–Ω–∏ –º–æ–≥–ª–∏ –∫–µ—Ä—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏ –ª–∏—à–µ –≤ —Ä–µ–≥—ñ–æ–Ω—ñ, —è–∫–∏–π –≤–æ–Ω–∏ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å.

–û—Ç–∂–µ, –≤–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–∏–∑–Ω–∞—á–∞—Ç–∏ —Ä–æ–ª—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ–¥–∏–Ω–∏—Ü—ñ, —ñ —á–ª–µ–Ω–∏ —Ü—ñ—î—ó –æ–¥–∏–Ω–∏—Ü—ñ –º–∞—Ç–∏–º—É—Ç—å —Ü—ñ —Ä–æ–ª—ñ.
```
```
{% endtab %}

{% tab title="AzureAD" %}

### –ê—Ç–∞–∫–∏ –Ω–∞ Azure AD

#### –ü–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è —Å–µ–∞–Ω—Å—É

–ê—Ç–∞–∫—É–≤–∞–ª—å–Ω–∏–∫ –º–æ–∂–µ –ø–µ—Ä–µ—Ö–æ–ø–∏—Ç–∏ —Å–µ–∞–Ω—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –º–µ—Ç–æ–¥–∏, —Ç–∞–∫—ñ —è–∫ –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è –∫—É–∫—ñ—Å—ñ–≤ –∞–±–æ –∞—Ç–∞–∫—É –ª—é–¥–∏–Ω–∏ –ø–æ—Å–µ—Ä–µ–¥–Ω–∏–∫–∞ (MITM). –¶–µ –º–æ–∂–µ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –∞—Ç–∞–∫—É–≤–∞–ª—å–Ω–∏–∫—É –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –¥—ñ—ó –≤—ñ–¥ –π–æ–≥–æ —ñ–º–µ–Ω—ñ.

#### –ê—Ç–∞–∫–∏ –Ω–∞ –ø–∞—Ä–æ–ª—ñ

–ê—Ç–∞–∫—É–≤–∞–ª—å–Ω–∏–∫–∏ –º–æ–∂—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ –º–µ—Ç–æ–¥–∏ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —Ç–∞–∫—ñ —è–∫ –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤ –ø—ñ–¥ —á–∞—Å –≤–≤–µ–¥–µ–Ω–Ω—è, —Ñ—ñ—à–∏–Ω–≥–æ–≤—ñ –∞—Ç–∞–∫–∏ –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å–ª–∞–±–∫–∏—Ö –ø–∞—Ä–æ–ª—ñ–≤. –ü—ñ—Å–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è –∞—Ç–∞–∫—É–≤–∞–ª—å–Ω–∏–∫ –º–æ–∂–µ –º–∞—Ç–∏ –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

#### –ê—Ç–∞–∫–∏ –Ω–∞ –º–Ω–æ–∂–∏–Ω–Ω—ñ —Ñ–∞–∫—Ç–æ—Ä–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó

–Ø–∫—â–æ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ –º–Ω–æ–∂–∏–Ω–Ω–æ–≥–æ —Ñ–∞–∫—Ç–æ—Ä–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–æ –∞–±–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –Ω–µ–Ω–∞–¥—ñ–π–Ω—ñ –º–µ—Ç–æ–¥–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è, –∞—Ç–∞–∫—É–≤–∞–ª—å–Ω–∏–∫–∏ –º–æ–∂—É—Ç—å –∑–Ω–∞–π—Ç–∏ —Å–ø–æ—Å–æ–± –æ–±—ñ–π—Ç–∏ —Ü—ñ –∑–∞—Ö–æ–¥–∏ –±–µ–∑–ø–µ–∫–∏ —Ç–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö.

{% endtab %}
```powershell
# Get Administrative Units
Get-AzureADMSAdministrativeUnit
Get-AzureADMSAdministrativeUnit -Id <id>
# Get ID of admin unit by string
$adminUnitObj = Get-AzureADMSAdministrativeUnit -Filter "displayname eq 'Test administrative unit 2'"
# List the users, groups, and devices affected by the administrative unit
Get-AzureADMSAdministrativeUnitMember -Id <id>
# Get the roles users have over the members of the AU
Get-AzureADMSScopedRoleMembership -Id <id> | fl #Get role ID and role members
```
{% endtab %}
{% endtabs %}

## –ó–∞—Ö–∏—Å—Ç —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ Azure AD (AIP) <a href="#title-text" id="title-text"></a>

–ó–∞—Ö–∏—Å—Ç —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ Azure AD (AIP) - —Ü–µ —Å–ª—É–∂–±–∞ –±–µ–∑–ø–µ–∫–∏, —è–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **–∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è —Ç–∞ —É—Å—É–Ω–µ–Ω–Ω—è, —â–æ–± –∑–∞—Ö–∏—Å—Ç–∏—Ç–∏ —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –≤ Azure Active Directory –≤—ñ–¥ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—ó**. AIP –ø–æ—Å—Ç—ñ–π–Ω–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏—Ç—å —Ç–∞ –æ—Ü—ñ–Ω—é—î —Ä–∏–∑–∏–∫–∏ —É–≤—ñ—Ö–æ–¥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ, **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—á–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –∑–∞—Ö–æ–¥–∏ –±–µ–∑–ø–µ–∫–∏**, —Ç–∞–∫—ñ —è–∫ –≤–∏–º–æ–≥–∞ –±–∞–≥–∞—Ç–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–æ—ó –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∞–±–æ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏—Ö –¥—ñ–π. –¶–µ –¥–æ–ø–æ–º–∞–≥–∞—î –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è–º –∑–∞–ø–æ–±—ñ–≥–∞—Ç–∏ –ø–æ—Ä—É—à–µ–Ω–Ω—è–º –±–µ–∑–ø–µ–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ.

–ü–æ—Ç—ñ–∫:

1. –ó–∞—Ö–∏—Å—Ç —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ Azure AD **–º–æ–Ω—ñ—Ç–æ—Ä–∏—Ç—å –¥—ñ—è–ª—å–Ω—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** —Ç–∞ –∑–±–∏—Ä–∞—î –¥–∞–Ω—ñ –ø—Ä–æ **—É–≤—ñ—Ö–æ–¥–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –ø–æ–¥—ñ—ó –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó** —Ç–∞ —ñ–Ω—à—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –¥—ñ—ó.
2. –°–ª—É–∂–±–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **–∞–ª–≥–æ—Ä–∏—Ç–º–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è** –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É —Ü–∏—Ö –¥–∞–Ω–∏—Ö —Ç–∞ –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏—Ö –∑–∞–≥—Ä–æ–∑ –±–µ–∑–ø–µ—Ü—ñ.
3. –ó–∞—Ö–∏—Å—Ç —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ Azure AD **–ø—Ä–∏–∑–Ω–∞—á–∞—î —Ä—ñ–≤–µ–Ω—å —Ä–∏–∑–∏–∫—É –∑–∞–≥—Ä–æ–∑–∏** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —É–≤—ñ—Ö—ñ–¥) —Ç–∞ –≥–µ–Ω–µ—Ä—É—î —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è —É —Ä–∞–∑—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —è–∫–æ—ó-–Ω–µ–±—É–¥—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó –¥—ñ—ó.

## –ó–∞—Ö–∏—Å—Ç –ø–∞—Ä–æ–ª—è Azure AD (APP)

–ó–∞—Ö–∏—Å—Ç –ø–∞—Ä–æ–ª—è Azure AD (APP) - —Ü–µ —Ñ—É–Ω–∫—Ü—ñ—è –±–µ–∑–ø–µ–∫–∏, —è–∫–∞ **–¥–æ–ø–æ–º–∞–≥–∞—î –∑–∞–ø–æ–±—ñ–≥—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—é —Å–ª–∞–±–∫–∏—Ö –ø–∞—Ä–æ–ª—ñ–≤ –≤ Azure Active Directory, –∑–º—ñ—Ü–Ω—é—é—á–∏ –ø–æ–ª—ñ—Ç–∏–∫—É —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤**. APP –±–ª–æ–∫—É—î **—á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω—ñ —Å–ª–∞–±–∫—ñ –ø–∞—Ä–æ–ª—ñ** —Ç–∞ —ó—Ö –≤–∞—Ä—ñ–∞–Ω—Ç–∏, –∑–º–µ–Ω—à—É—é—á–∏ —Ä–∏–∑–∏–∫ –ø–æ—Ä—É—à–µ–Ω—å, –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑ –ø–∞—Ä–æ–ª—è–º–∏. –¶–µ –º–æ–∂–µ –±—É—Ç–∏ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ —è–∫ –Ω–∞ —Ä—ñ–≤–Ω—ñ —Ö–º–∞—Ä–∏, —Ç–∞–∫ —ñ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º—É –∫–∞—Ç–∞–ª–æ–∑—ñ Active Directory, –ø—ñ–¥–≤–∏—â—É—é—á–∏ –∑–∞–≥–∞–ª—å–Ω—É –±–µ–∑–ø–µ–∫—É –ø–∞—Ä–æ–ª—ñ–≤ –≤ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó.

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://learn.microsoft.com/en-us/azure/active-directory/roles/administrative-units](https://learn.microsoft.com/en-us/azure/active-directory/roles/administrative-units)
