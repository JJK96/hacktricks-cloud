# Az - Dynamic Groups Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Podstawowe Informacje

**Dynamic groups** to grupy, kt√≥re majƒÖ skonfigurowany zestaw **regu≈Ç** i wszyscy **u≈ºytkownicy lub urzƒÖdzenia**, kt√≥re spe≈ÇniajƒÖ te regu≈Çy, sƒÖ dodawani do grupy. Za ka≈ºdym razem, gdy **atrybut** u≈ºytkownika lub urzƒÖdzenia jest **zmieniany**, dynamiczne regu≈Çy sƒÖ **ponownie sprawdzane**. A gdy **nowa regu≈Ça** jest **tworzona**, wszystkie urzƒÖdzenia i u≈ºytkownicy sƒÖ **sprawdzane**.

Dynamic groups mogƒÖ mieƒá **przypisane role Azure RBAC**, ale **nie jest mo≈ºliwe** dodanie **r√≥l AzureAD** do dynamic groups.

Ta funkcja wymaga licencji Azure AD premium P1.

## Privesc

Nale≈ºy zauwa≈ºyƒá, ≈ºe domy≈õlnie ka≈ºdy u≈ºytkownik mo≈ºe zapraszaƒá go≈õci w Azure AD, wiƒôc je≈õli regu≈Ça dynamic group **przyznaje uprawnienia** u≈ºytkownikom na podstawie **atrybut√≥w**, kt√≥re mogƒÖ byƒá **ustawione** w nowym **go≈õciu**, mo≈ºliwe jest **utworzenie go≈õcia** z tymi atrybutami i **eskalacja uprawnie≈Ñ**. Go≈õƒá mo≈ºe r√≥wnie≈º zarzƒÖdzaƒá swoim profilem i zmieniaƒá te atrybuty.

Pobierz grupy, kt√≥re pozwalajƒÖ na Dynamic membership: `Get-AzureADMSGroup | ?{$_.GroupTypes -eq 'DynamicMembership'}`

### Przyk≈Çad

* **Przyk≈Çad regu≈Çy**: `(user.otherMails -any (_ -contains "tester")) -and (user.userType -eq "guest")`
* **Opis regu≈Çy**: Ka≈ºdy u≈ºytkownik go≈õƒá z dodatkowym e-mailem zawierajƒÖcym ciƒÖg 'tester' zostanie dodany do grupy

1. Przejd≈∫ do **Azure Active Directory** -> **Users** i **kliknij** na `Want to switch back to the legacy users list experience? Click here to leave the preview`
2. Kliknij na **`New guest user`** i **zapro≈õ** e-mail
3. **Profil u≈ºytkownika** zostanie **dodany** do Azure AD, gdy tylko zaproszenie zostanie wys≈Çane. Otw√≥rz profil u≈ºytkownika i **kliknij na (manage) under Invitation accepted**.
* ![](<../../../.gitbook/assets/image (281).png>)
4. Zmie≈Ñ **`Resend invite?`** na **Yes** i otrzymasz URL zaproszenia:
* ![](<../../../.gitbook/assets/image (205).png>)
5. Skopiuj **URL** i **otw√≥rz** go, **zaloguj siƒô** jako zaproszony u≈ºytkownik i **zaakceptuj** zaproszenie
6. **Zaloguj siƒô** w cli jako u≈ºytkownik i ustaw dodatkowy e-mail

{% code overflow="wrap" %}
```powershell
# Login
$password = ConvertTo-SecureString 'password' - AsPlainText -Force
$creds = New-Object
System.Management.Automation.PSCredential('externaltester@somedomain.onmicrosoft.com', $Password)
Connect-AzureAD -Credential $creds -TenantId <tenant_id_of_attacked_domain>

# Chnage OtherMails setting
Set-AzureADUser -ObjectId <OBJECT-ID> -OtherMails <Username>@<TENANT_NAME>.onmicrosoft.com -Verbose
```
{% endcode %}

## Referencje

* [https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/](https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
