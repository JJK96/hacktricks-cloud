# Az - Dynamic Groups Privesc

{% hint style="success" %}
Jifunze na kufanya mazoezi ya AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze na kufanya mazoezi ya GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mipango ya usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Taarifa za Msingi

**Dynamic groups** ni vikundi ambavyo vina seti ya **kanuni** zilizosanidiwa na watumiaji au vifaa vyote vinavyolingana na kanuni hizo huongezwa kwenye kikundi. Kila wakati sifa ya mtumiaji au kifaa inapobadilishwa, kanuni za dynamic zinakaguliwa tena. Na wakati kanuni mpya inaundwa, vifaa na watumiaji wote hukaguliwa.

Dynamic groups zinaweza kuwa na **Azure RBAC roles assigned** kwao, lakini haiwezekani kuongeza **AzureAD roles** kwa dynamic groups.

Kipengele hiki kinahitaji leseni ya Azure AD premium P1.

## Privesc

Kumbuka kuwa kwa default mtumiaji yeyote anaweza kualika wageni katika Azure AD, kwa hivyo, ikiwa kanuni ya dynamic group inatoa ruhusa kwa watumiaji kulingana na sifa ambazo zinaweza kuwekwa kwa mgeni mpya, inawezekana kuunda mgeni mwenye sifa hizi na kupandisha hadhi. Pia inawezekana kwa mgeni kusimamia wasifu wake mwenyewe na kubadilisha sifa hizi.

Pata vikundi vinavyoruhusu Uanachama wa Dynamic: `Get-AzureADMSGroup | ?{$_.GroupTypes -eq 'DynamicMembership'}`

### Mfano

* **Mfano wa Kanuni**: `(user.otherMails -any (_ -contains "tester")) -and (user.userType -eq "guest")`
* **Maelezo ya Kanuni**: Mtumiaji yeyote Mgeni mwenye barua pepe ya pili yenye neno 'tester' ataongezwa kwenye kikundi

1. Nenda kwenye **Azure Active Directory** -> **Users** na **bonyeza** `Want to switch back to the legacy users list experience? Click here to leave the preview`
2. Bonyeza **`New guest user`** na **alika** barua pepe
3. **Wasifu wa mtumiaji** utaongezwa kwenye Azure AD mara tu mwaliko utakapopelekwa. Fungua wasifu wa mtumiaji na **bonyeza (manage) chini ya Invitation accepted**.
* ![](<../../../.gitbook/assets/image (281).png>)
4. Badilisha **`Resend invite?`** kuwa **Yes** na utapata URL ya mwaliko:
* ![](<../../../.gitbook/assets/image (205).png>)
5. Nakili **URL** na **fungua**, **ingia** kama mtumiaji aliyealikwa na **kubali** mwaliko
6. **Ingia** kwenye cli kama mtumiaji na weka barua pepe ya pili

{% code overflow="wrap" %}
```powershell
# Login
$password = ConvertTo-SecureString 'password' - AsPlainText -Force
$creds = New-Object
System.Management.Automation.PSCredential('externaltester@somedomain.onmicrosoft.com', $Password)
Connect-AzureAD -Credential $creds -TenantId <tenant_id_of_attacked_domain>

# Chnage OtherMails setting
Set-AzureADUser -ObjectId <OBJECT-ID> -OtherMails <Username>@<TENANT_NAME>.onmicrosoft.com -Verbose
```
{% endcode %}

## Marejeo

* [https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/](https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/)

{% hint style="success" %}
Jifunze na kufanya mazoezi ya AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze na kufanya mazoezi ya GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mipango ya usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
