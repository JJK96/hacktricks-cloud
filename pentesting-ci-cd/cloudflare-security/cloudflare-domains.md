# Cloudflare ドメイン

<details>

{% hint style="success" %}
AWSハッキングの学習と実践:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPハッキングの学習と実践: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポート</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
* **ハッキングトリックを共有するために** [**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) のGitHubリポジトリにPRを提出してください。

</details>
{% endhint %}

Cloudflareに構成された各TLDには、構成できる**一般設定とサービス**があります。このページでは、各セクションの**セキュリティ関連設定**を分析します。

<figure><img src="../../.gitbook/assets/image (101).png" alt=""><figcaption></figcaption></figure>

## 概要

* [ ] アカウントのサービスの**使用状況**を把握する
* [ ] **ゾーンID**と**アカウントID**も見つける

## アナリティクス

* [ ] **`セキュリティ`**で**レート制限**があるか確認する

## DNS

* [ ] DNSの**レコード**に**興味深い**（機密性の高い？）データがないか確認する
* [ ] 名前に基づいて**機密情報**を含む可能性がある**サブドメイン**をチェックする（例：admin173865324.domin.com）
* [ ] **プロキシされていない**ウェブページをチェックする
* [ ] **プロキシされたウェブページ**がCNAMEやIPアドレスで**直接アクセスできる**か確認する
* [ ] **DNSSEC**が**有効**であることを確認する
* [ ] すべてのCNAMEで**CNAMEフラットニング**が**使用**されていることを確認する
* これは**サブドメイン乗っ取りの脆弱性を隠す**のに役立ち、読み込み時間を改善する可能性があります
* [ ] ドメインが[**スプーフィングに脆弱でない**](https://book.hacktricks.xyz/network-services-pentesting/pentesting-smtp#mail-spoofing)ことを確認する

## **Email**

TODO

## Spectrum

TODO

## SSL/TLS

### **概要**

* [ ] **SSL/TLS暗号化**は**完全**または**完全（厳密）**である必要があります。それ以外の場合、ある時点で**クリアテキストトラフィック**が送信されます。
* [ ] **SSL/TLS推奨者**が有効になっていることを確認する

### エッジ証明書

* [ ] **常にHTTPSを使用**する必要があります
* [ ] **HTTP Strict Transport Security (HSTS)**が**有効**であることを確認する
* [ ] **最小TLSバージョン**は1.2である必要があります
* [ ] **TLS 1.3**が有効である必要があります
* [ ] **自動HTTPSリライト**が**有効**であることを確認する
* [ ] **証明書透明性モニタリング**が**有効**であることを確認する

## **セキュリティ**

* [ ] **`WAF`**セクションでは、**ファイアウォール**と**レート制限ルール**が悪用を防ぐために使用されていることを確認する
* **`バイパス`**アクションはリクエストのために**Cloudflareセキュリティ機能を無効**にします。使用しないでください。
* [ ] **`ページシールド`**セクションでは、使用されている場合は**有効**であることを推奨します
* [ ] **`APIシールド`**セクションでは、使用されている場合は**有効**であることを推奨します
* [ ] **`DDoS`**セクションでは、**DDoS保護**を有効にすることを推奨します
* [ ] **`設定`**セクションでは：
* [ ] **`セキュリティレベル`**が**中程度**以上であることを確認する
* [ ] **`チャレンジパス`**が最大1時間であることを確認する
* [ ] **`ブラウザインテグリティチェック`**が**有効**であることを確認する
* [ ] **`プライバシーパスサポート`**が**有効**であることを確認する

### **CloudFlare DDoS保護**

* 可能であれば、**Bot Fight Mode**または**Super Bot Fight Mode**を有効にします。例えば、JSフロントエンドページからプログラム的にアクセスされるAPIを保護している場合、このアクセスを壊さずにこれを有効にすることができないかもしれません。
* **WAF**：**URLパスごとのレート制限**や**検証済みボット**（レート制限ルール）を作成したり、IP、Cookie、リファラに基づいてアクセスを**ブロック**したりすることができます。したがって、Webページから来ないリクエストやCookieを持たないリクエストをブロックできます。
* 攻撃が**検証済みボット**からの場合、少なくともボットに**レート制限**を追加します。
* 攻撃が**特定のパス**に対して行われる場合、予防機構としてこのパスに**レート制限**を追加します。
* **ツール**のWAFからIPアドレス、IP範囲、国、ASNを**ホワイトリスト**に登録できます。
* **管理されたルール**が脆弱性の悪用を防ぐのに役立つかどうかを確認できます。
* **ツール**セクションでは、特定のIPアドレスやユーザーエージェントに対して**ブロック**または**チャレンジ**を与えることができます。
* DDoSでは、いくつかのルールを**より制限的**にするために一部のルールを**オーバーライド**することができます。
* **設定**：**セキュリティレベル**を**高**に設定し、攻撃を受けている場合は**攻撃中**に設定し、**ブラウザインテグリティチェックが有効**であることを確認します。
* Cloudflareドメイン -> アナリティクス -> セキュリティ -> **レート制限**が有効になっているか確認します
* Cloudflareドメイン -> セキュリティ -> イベント -> **検出された悪意のあるイベント**を確認します

## アクセス

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## 速度

_セキュリティに関連するオプションは見つかりませんでした_

## キャッシュ

* [ ] **`構成`**セクションで**CSAMスキャンツール**を有効にすることを検討してください

## **ワーカールート**

_すでに_ [_cloudflare workers_](./#workers) _をチェックしているはずです_

## ルール

TODO

## ネットワーク

* [ ] **`HTTP/2`**が**有効**になっている場合、**`HTTP/2 to Origin`**も**有効**にする必要があります
* [ ] **`HTTP/3（QUIC付き）`**が**有効**である必要があります
* ユーザーの**プライバシー**が重要な場合は、**`Onion Routing`**が**有効**であることを確認してください

## **トラフィック**

TODO

## カスタムページ

* [ ] セキュリティに関連するエラーが発生した場合（ブロック、レート制限、攻撃中モードなど）、カスタムページを構成することがオプションです
## Apps

TODO

## Scrape Shield

* [ ] チェック **Email Address Obfuscation** が **有効** であること
* [ ] チェック **Server-side Excludes** が **有効** であること

## **Zaraz**

TODO

## **Web3**

TODO

<details>

{% hint style="success" %}
AWSハッキングの学習と実践:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPハッキングの学習と実践: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksのサポート</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f) に参加するか、[**telegramグループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** をフォローする。**
* **HackTricks** と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) のgithubリポジトリにPRを提出してハッキングトリックを共有する。

</details>
{% endhint %}
