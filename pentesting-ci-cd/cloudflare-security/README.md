# Cloudflare Security

{% hint style="success" %}
Naučite i vežbajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Naučite i vežbajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Delite hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

U Cloudflare nalogu postoje neka **opšta podešavanja i usluge** koje se mogu konfigurisati. Na ovoj stranici ćemo **analizirati bezbednosna podešavanja svake sekcije:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

Pregledajte svaku sa:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Domain Registration

* [ ] U **`Transfer Domains`** proverite da li je moguće preneti bilo koji domen.

Pregledajte svaku sa:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analytics

_Nisam mogao pronaći ništa za proveru bezbednosne konfiguracije._

## Pages

Na svakoj Cloudflare stranici:

* [ ] Proverite **osetljive informacije** u **`Build log`**.
* [ ] Proverite **osetljive informacije** u **Github repozitorijumu** dodeljenom stranicama.
* [ ] Proverite potencijalni kompromis github repozitorijuma putem **workflow command injection** ili `pull_request_target` kompromisa. Više informacija na [**Github Security stranici**](../github-security/).
* [ ] Proverite **ranjive funkcije** u `/fuctions` direktorijumu (ako ih ima), proverite **preusmeravanja** u `_redirects` fajlu (ako ih ima) i **pogrešno konfigurisane zaglavlja** u `_headers` fajlu (ako ih ima).
* [ ] Proverite **ranjivosti** na **web stranici** putem **blackbox** ili **whitebox** ako možete **pristupiti kodu**.
* [ ] U detaljima svake stranice `/<page_id>/pages/view/blocklist/settings/functions`. Proverite **osetljive informacije** u **`Environment variables`**.
* [ ] U detaljima stranice proverite i **build command** i **root directory** za **potencijalne injekcije** za kompromitovanje stranice.

## **Workers**

Na svakom Cloudflare worker-u proverite:

* [ ] Trigere: Šta pokreće worker? Može li **korisnik poslati podatke** koje će worker **koristiti**?
* [ ] U **`Settings`**, proverite **`Variables`** koje sadrže **osetljive informacije**.
* [ ] Proverite **kod worker-a** i tražite **ranjivosti** (posebno na mestima gde korisnik može upravljati unosom).
* Proverite SSRF-ove koji vraćaju naznačenu stranicu koju možete kontrolisati.
* Proverite XSS-ove koji izvršavaju JS unutar svg slike.
* Moguće je da worker komunicira sa drugim internim uslugama. Na primer, worker može komunicirati sa R2 bucket-om i skladištiti informacije dobijene iz unosa. U tom slučaju, potrebno je proveriti koje mogućnosti worker ima nad R2 bucket-om i kako bi se to moglo zloupotrebiti iz korisničkog unosa.

{% hint style="warning" %}
Napomena da po default-u **Worker dobija URL** kao što je `<worker-name>.<account>.workers.dev`. Korisnik može postaviti na **subdomen** ali uvek možete pristupiti sa tim **originalnim URL-om** ako ga znate.
{% endhint %}

## R2

Na svakom R2 bucket-u proverite:

* [ ] Konfigurišite **CORS Policy**.

## Stream

TODO

## Images

TODO

## Security Center

* [ ] Ako je moguće, pokrenite **`Security Insights`** **skeniranje** i **`Infrastructure`** **skeniranje**, jer će **istaknuti** zanimljive informacije **u vezi sa bezbednošću**.
* [ ] Samo **proverite ove informacije** za bezbednosne pogrešne konfiguracije i zanimljive informacije.

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Bulk Redirects

{% hint style="info" %}
Za razliku od [Dynamic Redirects](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Bulk Redirects**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) su u suštini statični — ne podržavaju nikakve operacije zamene stringova ili regularne izraze. Međutim, možete konfigurisati URL parametre preusmeravanja koji utiču na njihovo ponašanje pri usklađivanju URL-ova i njihovo ponašanje u runtime-u.
{% endhint %}

* [ ] Proverite da li **izrazi** i **zahtevi** za preusmeravanja **imaju smisla**.
* [ ] Takođe proverite **osetljive skrivene krajnje tačke** koje sadrže zanimljive informacije.

## Notifications

* [ ] Proverite **notifikacije**. Ove notifikacije se preporučuju za bezbednost:
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] Proverite sve **destinacije**, jer može biti **osetljivih informacija** (osnovna http autentifikacija) u webhook URL-ovima. Takođe se uverite da webhook URL-ovi koriste **HTTPS**.
* [ ] Kao dodatnu proveru, možete pokušati da **imitirate cloudflare notifikaciju** trećoj strani, možda možete nekako **ubaciti nešto opasno**.

## Manage Account

* [ ] Moguće je videti **poslednje 4 cifre kreditne kartice**, **vreme isteka** i **adresu za naplatu** u **`Billing` -> `Payment info`**.
* [ ] Moguće je videti **tip plana** koji se koristi na nalogu u **`Billing` -> `Subscriptions`**.
* [ ] U **`Members`** moguće je videti sve članove naloga i njihove **uloge**. Napomena da ako tip plana nije Enterprise, postoje samo 2 uloge: Administrator i Super Administrator. Ali ako je korišćeni **plan Enterprise**, [**više uloga**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) može se koristiti za praćenje principa najmanjih privilegija.
* Stoga, kad god je moguće, **preporučuje se** korišćenje **Enterprise plana**.
* [ ] U Members moguće je proveriti koji **članovi** imaju **2FA omogućeno**. **Svaki** korisnik bi trebao imati omogućeno.

{% hint style="info" %}
Napomena da na sreću uloga **`Administrator`** ne daje dozvole za upravljanje članstvima (**ne može eskalirati privilegije ili pozvati** nove članove).
{% endhint %}

## DDoS Investigation

[Proverite ovaj deo](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
Naučite i vežbajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Naučite i vežbajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Delite hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
