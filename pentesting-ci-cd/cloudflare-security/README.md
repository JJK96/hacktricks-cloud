# Cloudflare Security

{% hint style="success" %}
Impara e pratica AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Impara e pratica GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai repo github di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

In un account Cloudflare ci sono alcune **impostazioni e servizi generali** che possono essere configurati. In questa pagina andremo ad **analizzare le impostazioni di sicurezza di ogni sezione:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

Rivedi ciascuno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Domain Registration

* [ ] In **`Transfer Domains`** verifica che non sia possibile trasferire alcun dominio.

Rivedi ciascuno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analytics

_Non ho trovato nulla da controllare per una revisione della sicurezza della configurazione._

## Pages

Su ogni pagina di Cloudflare:

* [ ] Controlla la **presenza di informazioni sensibili** nel **`Build log`**.
* [ ] Controlla la **presenza di informazioni sensibili** nel **repository Github** assegnato alle pagine.
* [ ] Controlla il potenziale compromesso del repository github tramite **workflow command injection** o compromesso `pull_request_target`. Maggiori informazioni nella [**pagina di sicurezza di Github**](../github-security/).
* [ ] Controlla la **presenza di funzioni vulnerabili** nella directory `/fuctions` (se presente), controlla i **redirect** nel file `_redirects` (se presente) e **intestazioni mal configurate** nel file `_headers` (se presente).
* [ ] Controlla la **presenza di vulnerabilit√†** nella **pagina web** tramite **blackbox** o **whitebox** se puoi **accedere al codice**.
* [ ] Nei dettagli di ogni pagina `/<page_id>/pages/view/blocklist/settings/functions`. Controlla la **presenza di informazioni sensibili** nelle **`Environment variables`**.
* [ ] Nei dettagli della pagina controlla anche il **comando di build** e la **directory root** per **potenziali iniezioni** per compromettere la pagina.

## **Workers**

Su ogni worker di Cloudflare controlla:

* [ ] I trigger: Cosa fa scattare il worker? Un **utente pu√≤ inviare dati** che verranno **utilizzati** dal worker?
* [ ] Nelle **`Settings`**, controlla la **presenza di `Variables`** contenenti **informazioni sensibili**.
* [ ] Controlla il **codice del worker** e cerca **vulnerabilit√†** (specialmente nei punti in cui l'utente pu√≤ gestire l'input).
* Controlla SSRFs che restituiscono la pagina indicata che puoi controllare.
* Controlla XSSs eseguendo JS all'interno di un'immagine svg.
* √à possibile che il worker interagisca con altri servizi interni. Ad esempio, un worker potrebbe interagire con un bucket R2 memorizzando informazioni ottenute dall'input. In tal caso, sarebbe necessario controllare quali capacit√† ha il worker sul bucket R2 e come potrebbe essere abusato dall'input dell'utente.

{% hint style="warning" %}
Nota che per impostazione predefinita a un **Worker viene assegnato un URL** come `<worker-name>.<account>.workers.dev`. L'utente pu√≤ impostarlo su un **sottodominio** ma puoi sempre accedervi con quell'**URL originale** se lo conosci.
{% endhint %}

## R2

Su ogni bucket R2 controlla:

* [ ] Configura la **CORS Policy**.

## Stream

TODO

## Images

TODO

## Security Center

* [ ] Se possibile, esegui una **scansione `Security Insights`** e una **scansione `Infrastructure`**, poich√© evidenzieranno informazioni interessanti dal punto di vista della **sicurezza**.
* [ ] Controlla semplicemente queste informazioni per configurazioni di sicurezza errate e informazioni interessanti.

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Bulk Redirects

{% hint style="info" %}
A differenza dei [Dynamic Redirects](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), i [**Bulk Redirects**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) sono essenzialmente statici ‚Äî non supportano operazioni di sostituzione di stringhe o espressioni regolari. Tuttavia, puoi configurare parametri di reindirizzamento URL che influenzano il loro comportamento di corrispondenza URL e il loro comportamento di runtime.
{% endhint %}

* [ ] Controlla che le **espressioni** e i **requisiti** per i reindirizzamenti **abbiano senso**.
* [ ] Controlla anche la **presenza di endpoint nascosti sensibili** che contengono informazioni interessanti.

## Notifications

* [ ] Controlla le **notifiche**. Queste notifiche sono raccomandate per la sicurezza:
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] Controlla tutte le **destinazioni**, poich√© potrebbero esserci **informazioni sensibili** (autenticazione http di base) negli URL webhook. Assicurati anche che gli URL webhook utilizzino **HTTPS**.
* [ ] Come controllo extra, potresti provare a **impersonare una notifica cloudflare** a una terza parte, magari puoi in qualche modo **iniettare qualcosa di pericoloso**.

## Manage Account

* [ ] √à possibile vedere le **ultime 4 cifre della carta di credito**, il **tempo di scadenza** e l'**indirizzo di fatturazione** in **`Billing` -> `Payment info`**.
* [ ] √à possibile vedere il **tipo di piano** utilizzato nell'account in **`Billing` -> `Subscriptions`**.
* [ ] In **`Members`** √® possibile vedere tutti i membri dell'account e il loro **ruolo**. Nota che se il tipo di piano non √® Enterprise, esistono solo 2 ruoli: Amministratore e Super Amministratore. Ma se il **piano utilizzato √® Enterprise**, [**pi√π ruoli**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) possono essere utilizzati per seguire il principio del minimo privilegio.
* Pertanto, ogni volta che √® possibile √® **consigliato** utilizzare il **piano Enterprise**.
* [ ] In Members √® possibile controllare quali **membri** hanno **2FA abilitato**. **Ogni** utente dovrebbe averlo abilitato.

{% hint style="info" %}
Nota che fortunatamente il ruolo **`Administrator`** non d√† permessi per gestire i membri (**non pu√≤ scalare i privilegi o invitare** nuovi membri).
{% endhint %}

## DDoS Investigation

[Controlla questa parte](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
Impara e pratica AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Impara e pratica GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai repo github di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
