# Usalama wa Cloudflare

<details>

<summary><strong>Jifunze AWS hacking kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa kipekee wa [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

Katika akaunti ya Cloudflare kuna **vipimo vya jumla na huduma** ambavyo vinaweza kusanidiwa. Katika ukurasa huu tutachunguza **vipimo vinavyohusiana na usalama wa kila sehemu:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Tovuti

Pitia kila moja na:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Usajili wa Kikoa

* [ ] Katika **`Hama Vikoas`** hakikisha haiwezekani kuhama kikoa chochote.

Pitia kila moja na:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Takwimu

_Singeweza kupata chochote cha kuangalia kwa ukaguzi wa usalama wa mpangilio._

## Kurasa

Kwenye kila ukurasa wa Cloudflare:

* [ ] Angalia kwa **habari nyeti** kwenye **`Logi ya Kujenga`**.
* [ ] Angalia kwa **habari nyeti** kwenye **repo ya Github** iliyoainishwa kwa kurasa.
* [ ] Angalia kwa uwezekano wa kudukuliwa kwa repo ya github kupitia **mchakato wa amri wa kazi** au kudukuliwa kwa `pull_request_target`. Taarifa zaidi kwenye [**Ukurasa wa Usalama wa Github**](../github-security/).
* [ ] Angalia kwa **kazi zenye udhaifu** kwenye saraka ya `/fuctions` (ikiwapo zipo), angalia **urejeleaji** kwenye faili ya `_redirects` (ikiwapo zipo) na **vipimo vilivyopangwa vibaya** kwenye faili ya `_headers` (ikiwapo zipo).
* [ ] Angalia kwa **udhaifu** kwenye **ukurasa wa wavuti** kupitia **blackbox** au **whitebox** ikiwa unaweza **kufikia nambari**
* [ ] Katika maelezo ya kila ukurasa `/<page_id>/pages/view/blocklist/settings/functions`. Angalia kwa **habari nyeti** kwenye **`Mazingira ya Mazingira`**.
* [ ] Kwenye ukurasa wa maelezo angalia pia **amri ya kujenga** na **saraka kuu** kwa **kuingilia uwezekano** wa kudukua ukurasa.

## **Wafanyikazi**

Kwenye kila wafanyikazi wa Cloudflare angalia:

* [ ] Vichocheo: Nini husababisha wafanyikazi kuchochewa? Je, **mtumiaji anaweza kutuma data** ambayo itatumika na mfanyikazi?
* [ ] Katika **`Vipimo`**, angalia **`Vipengele`** vinavyo **habari nyeti**
* Angalia nambari ya mfanyikazi na utafute **udhaifu** (haswa mahali ambapo mtumiaji anaweza kusimamia kuingia)
* Angalia SSRFs kurudi kwenye ukurasa ulioonyeshwa ambao unaweza kudhibiti
* Angalia XSSs kutekeleza JS ndani ya picha ya svg
* Inawezekana kwamba mfanyikazi anashirikiana na huduma zingine za ndani. Kwa mfano, mfanyikazi anaweza kushirikiana na r2 bucket kuhifadhi habari iliyopatikana kutoka kwa kuingia. Katika kesi hiyo, itakuwa muhimu kuangalia uwezo gani mfanyikazi ana juu ya r2 bucket na jinsi inavyoweza kutumiwa vibaya kutoka kwa kuingia ya mtumiaji.

{% hint style="warning" %}
Tambua kwamba kwa chaguo-msingi **Mfanyikazi hupewa URL** kama `<jina-la-mfanyikazi>.<akaunti>.workers.dev`. Mtumiaji anaweza kuweka kama **subdomain** lakini unaweza kila wakati kufikia kwa kutumia **URL ya awali** ikiwa unajua.
{% endhint %}

## R2

Kwenye kila r2 bucket angalia:

* [ ] Sanidi **Sera ya CORS**.

## Mtiririko

TODO

## Picha

TODO

## Kituo cha Usalama

* [ ] Ikiwezekana, endesha **`Uchunguzi wa Usalama`** na **`Uchunguzi wa Miundombinu`**, kwani itaonyesha habari ya kuvutia kiusalama.
* [ ] Tu **angalia habari hii** kwa makosa ya usalama na habari ya kuvutia

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Uelekezaji wa Wingi

{% hint style="info" %}
Tofauti na [Uelekezaji wa Kudumu](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Uelekezaji wa Wingi**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) kimsingi ni tuli - hauungi mkono operesheni yoyote ya kubadilisha herufi au mizizi ya kawaida. Walakini, unaweza kusanidi vigezo vya uelekezaji wa URL ambavyo vinaweza kuathiri tabia yao ya kupatana na URL na tabia yao ya wakati wa mazoezi.
{% endhint %}

* [ ] Hakikisha **maelezo** na **mahitaji** ya uelekezaji **yanafanya maana**.
* [ ] Angalia pia kwa **vituo vya siri vilivyofichwa** ambavyo vinaweza kuwa na habari ya kuvutia.

## Arifa

* [ ] Angalia **arifa.** Arifa hizi zinapendekezwa kwa usalama:
* `Bilingwa Inayotegemea Matumizi`
* `Onyo la Shambulio la DDoS la HTTP`
* `Onyo la Shambulio la DDoS la Tabaka 3/4`
* `Onyo la Shambulio la DDoS la HTTP la Juu`
* `Onyo la Shambulio la Tabaka 3/4 la Juu`
* `Ufuatiliaji wa Misingi: Shambulio la Kiasi`
* `Onyo la Uchunguzi wa Njia ya Uelekezaji`
* `Onyo la Muda wa Cheti cha mTLS kumalizika`
* `Onyo la Kukaribisha SSL kwa Majina ya Desturi ya SaaS`
* `Onyo la SSL la Universal`
* `Onyo la Ufuatiliaji wa Mabadiliko ya Kanuni Mpya ya Kanuni`
* `Onyo la Ufuatiliaji wa Kikoa Kipya`
* `Onyo la Ufuatiliaji wa Kikoa Kipya cha Kudhuru`
* `Onyo la Ufuatiliaji wa URL Mpya ya Kudhuru`
* `Onyo la Ufuatiliaji wa Kanuni Mpya ya Kudhuru`
* `Onyo la Ufuatiliaji wa URL Mpya ya Kudhuru Inazidi Urefu wa URL Mrefu`
* `Onyo la Matukio ya Usalama ya Juu`
* `Onyo la Matukio ya Usalama`
* [ ] Angalia **vituo vyote**, kwani kunaweza kuwa na **habari nyeti** (msingi wa http wa msingi) kwenye URL za webhook. Hakikisha pia URL za webhook zinatumia **HTTPS**
* [ ] Kama ukaguzi wa ziada, unaweza kujaribu **kujifanya kuwa arifa ya cloudflare** kwa mtu wa tatu, labda unaweza kwa njia fulani **kuingiza kitu hatari**

## Simamia Akaunti

* [ ] Inawezekana kuona **nambari nne za mwisho za kadi ya mkopo**, **muda wa kumalizika** na **anwani ya malipo** katika **`Bilingwa` -> `Maelezo ya Malipo`**.
* [ ] Inawezekana kuona **aina ya mpango** inayotumiwa kwenye akaunti katika **`Bilingwa` -> `Vipindi vya Usajili`**.
* [ ] Katika **`Wanachama`** inawezekana kuona wanachama wote wa akaunti na **jukumu** zao. Kumbuka kwamba ikiwa aina ya mpango sio Enterprise, kuna majukumu 2 tu: Msimamizi na Msimamizi Mkuu. Lakini ikiwa **mpango uliotumiwa ni Enterprise**, [**majukumu zaidi**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) yanaweza kutumika kufuata kanuni ya kima cha chini cha mamlaka.
* Kwa hivyo, kadri inavyowezekana ni **inashauriwa** kutumia **mpango wa Enterprise**.
* [ ] Katika Wanachama inawezekana kuangalia ni **wanachama gani** wana **2FA imewezeshwa**. **Kila** mtumiaji anapaswa kuwa nayo imewezeshwa.

{% hint style="info" %}
Tambua kwamba kwa bahati nzuri jukumu la **`Msimamizi`** halipatii ruhusa ya kusimamia wanachama (**hawezi kuongeza mamlaka au kuwaalika** wanachama wapya)
{% endhint %}
## Uchunguzi wa DDoS

[Angalia sehemu hii](cloudflare-domains.md#cloudflare-ddos-protection).

<details>

<summary><strong>Jifunze AWS hacking kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
