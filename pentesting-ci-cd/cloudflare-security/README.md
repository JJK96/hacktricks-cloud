# Bezpieczeństwo Cloudflare

<details>

<summary><strong>Dowiedz się, jak hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

W koncie Cloudflare można skonfigurować pewne **ogólne ustawienia i usługi**. Na tej stronie zamierzamy **analizować ustawienia związane z bezpieczeństwem w każdej sekcji:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Strony internetowe

Przejrzyj każdą z:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Rejestracja domen

* [ ] W **`Transfer Domains`** sprawdź, czy nie można przenieść żadnej domeny.

Przejrzyj każdą z:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analizy

_Nie znalazłem niczego, co można by sprawdzić pod kątem przeglądu bezpieczeństwa konfiguracji._

## Strony

Na każdej stronie Cloudflare:

* [ ] Sprawdź, czy nie ma **informacji poufnych** w **`Build log`**.
* [ ] Sprawdź, czy nie ma **informacji poufnych** w repozytorium **Github** przypisanym do stron.
* [ ] Sprawdź, czy nie ma potencjalnego naruszenia repozytorium Github poprzez **wstrzyknięcie poleceń do workflow** lub naruszenie `pull_request_target`. Więcej informacji na stronie [**Bezpieczeństwo Githuba**](../github-security/).
* [ ] Sprawdź, czy nie ma **podatnych funkcji** w katalogu `/fuctions` (jeśli istnieją), sprawdź **przekierowania** w pliku `_redirects` (jeśli istnieją) i **źle skonfigurowane nagłówki** w pliku `_headers` (jeśli istnieją).
* [ ] Sprawdź **podatności** na **stronie internetowej** za pomocą **blackbox** lub **whitebox**, jeśli masz **dostęp do kodu**
* [ ] W szczegółach każdej strony `/<page_id>/pages/view/blocklist/settings/functions`. Sprawdź, czy nie ma **informacji poufnych** w **`Zmiennych środowiskowych`**.
* [ ] Na stronie szczegółów sprawdź również **polecenie budowy** i **katalog główny** pod kątem **potencjalnych wstrzyknięć** w celu naruszenia strony.

## **Workers**

Na każdym workerze Cloudflare sprawdź:

* [ ] Wyzwalacze: Co powoduje uruchomienie workera? Czy **użytkownik może przesłać dane**, które zostaną **użyte** przez workera?
* [ ] W **`Ustawieniach`**, sprawdź **`Zmienne`** zawierające **informacje poufne**
* [ ] Sprawdź kod workera i poszukaj **podatności** (szczególnie w miejscach, gdzie użytkownik może zarządzać wejściem)
* Sprawdź SSRF zwracające wskazaną stronę, którą możesz kontrolować
* Sprawdź XSS wykonujące JS wewnątrz obrazu svg
* Być może worker współdziała z innymi usługami wewnętrznymi. Na przykład worker może współdziałać z kubełkiem R2 przechowującym w nim uzyskane z wejścia informacje. W takim przypadku konieczne jest sprawdzenie, jakie uprawnienia ma worker w kubełku R2 i w jaki sposób można je wykorzystać z wejścia użytkownika.

{% hint style="warning" %}
Zauważ, że domyślnie **Workerowi przypisany jest adres URL** taki jak `<nazwa-workera>.<konto>.workers.dev`. Użytkownik może ustawić go na **subdomenę**, ale zawsze można uzyskać do niego dostęp za pomocą tego **oryginalnego adresu URL**, jeśli go znasz.
{% endhint %}

## R2

Na każdym kubełku R2 sprawdź:

* [ ] Skonfiguruj **Politykę CORS**.

## Strumień

TODO

## Obrazy

TODO

## Centrum bezpieczeństwa

* [ ] Jeśli to możliwe, uruchom **`Skanowanie Security Insights`** i **`Infrastruktura`**, ponieważ ujawnią ciekawe informacje związane z bezpieczeństwem.
* [ ] Po prostu **sprawdź te informacje** pod kątem błędów konfiguracji bezpieczeństwa i ciekawych informacji

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Przekierowania masowe

{% hint style="info" %}
W przeciwieństwie do [Przekierowań dynamicznych](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Przekierowania masowe**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) są w zasadzie statyczne — nie obsługują żadnych operacji zastępowania ciągów ani wyrażeń regularnych. Możesz jednak skonfigurować parametry przekierowania URL, które wpływają na ich zachowanie podczas dopasowywania adresów URL i ich działania w czasie wykonania.
{% endhint %}

* [ ] Sprawdź, czy **wyrażenia** i **wymagania** dla przekierowań **są sensowne**.
* [ ] Sprawdź również, czy nie ma **ukrytych punktów końcowych**, które zawierają interesujące informacje.

## Powiadomienia

* [ ] Sprawdź **powiadomienia**. Te powiadomienia są zalecane ze względów bezpieczeństwa:
* `Fakturowanie oparte na użyciu`
* `Alert ataku DDoS HTTP`
* `Alert ataku DDoS warstwy 3/4`
* `Zaawansowany alert ataku DDoS HTTP`
* `Zaawansowany alert ataku DDoS warstwy 3/4`
* `Monitorowanie oparte na przepływie: Atak objętościowy`
* `Alert wykrywania wycieku trasy`
* `Alert wygaśnięcia certyfikatu mTLS dostępu`
* `Alert niestandardowych nazw hostów SSL dla SaaS`
* `Alert uniwersalnego SSL`
* `Alert wykrywania nowej zmiany kodu monitora skryptów`
* `Alert wykrywania nowej domeny monitora skryptów`
* `Alert wykrywania nowej złośliwej domeny monitora skryptów`
* `Alert wykrywania nowego złośliwego skryptu monitora skryptów`
* `Alert wykrywania nowego złośliwego adresu URL monitora skryptów`
* `Alert wykrywania nowych skryptów monitora skryptów`
* `Alert wykrywania nowego skryptu monitora skryptów przekraczającego maksymalną długość adresu URL`
* `Zaawansowane zdarzenia bezpieczeństwa`
* `Alerty zdarzeń bezpieczeństwa`
* [ ] Sprawdź wszystkie **destynacje**, ponieważ mogą zawierać **informacje poufne** (podstawowa autoryzacja http) w adresach URL webhooków. Upewnij się również, że adresy URL webhooków używają **protokołu HTTPS**
* [ ] Dodatkowo, można spróbować **podrobić powiadomienie Cloudflare** do strony trzeciej, być może można w jakiś sposób **wstrzyknąć coś niebezpiecznego**

## Zarządzaj kontem

* [ ] Można zobaczyć **ostatnie 4 cyfry karty kredytowej**, **termin ważności** i **adres rozliczeniowy** w **`Rozliczenie` -> `Informacje o płatności`**.
* [ ] Można zobaczyć **typ planu** używanego w koncie w **`Rozliczenie` -> `Subskrypcje`**.
* [ ] W **`Członkowie`** można zobaczyć wszystkich członków konta i ich **rolę**. Zauważ, że jeśli typ planu nie jest Enterprise, istnieją tylko 2 role: Administrator i Super Administrator. Ale jeśli używany jest **plan Enterprise**, [**można użyć więcej ról**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) zgodnie z zasadą najmniejszych uprawnień.
* Dlatego zaleca się **korzystanie z planu Enterprise** zawsze, gdy to możliwe.
* [ ] W Członkach można sprawdzić, którzy **członkowie** mają włączone **2FA**. **Każdy** użytkownik powinien mieć to włączone.

{% hint style="info" %}
Zauważ, że rola **`Administrator`** domyślnie nie daje uprawnień do zarządzania członkostwem (**nie może eskalować uprawnień ani zapraszać** nowych członków)
{% endhint %}
## Śledztwo w sprawie ataku DDoS

[Sprawdź tę część](cloudflare-domains.md#cloudflare-ddos-protection).

<details>

<summary><strong>Zacznij od zera i stań się ekspertem od hakowania AWS dzięki</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Kup [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>
