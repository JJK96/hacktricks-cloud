# Cloudflare Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

Em uma conta Cloudflare, existem algumas **configura√ß√µes e servi√ßos gerais** que podem ser configurados. Nesta p√°gina, vamos **analisar as configura√ß√µes relacionadas √† seguran√ßa de cada se√ß√£o:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

Revise cada um com:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Domain Registration

* [ ] Em **`Transfer Domains`** verifique se n√£o √© poss√≠vel transferir nenhum dom√≠nio.

Revise cada um com:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analytics

_N√£o consegui encontrar nada para verificar em uma revis√£o de seguran√ßa de configura√ß√£o._

## Pages

Em cada p√°gina do Cloudflare:

* [ ] Verifique por **informa√ß√µes sens√≠veis** no **`Build log`**.
* [ ] Verifique por **informa√ß√µes sens√≠veis** no **reposit√≥rio Github** atribu√≠do √†s p√°ginas.
* [ ] Verifique por potencial comprometimento do reposit√≥rio github via **inje√ß√£o de comando de workflow** ou comprometimento de `pull_request_target`. Mais informa√ß√µes na [**p√°gina de Seguran√ßa do Github**](../github-security/).
* [ ] Verifique por **fun√ß√µes vulner√°veis** no diret√≥rio `/fuctions` (se houver), verifique os **redirecionamentos** no arquivo `_redirects` (se houver) e **cabe√ßalhos mal configurados** no arquivo `_headers` (se houver).
* [ ] Verifique por **vulnerabilidades** na **p√°gina web** via **blackbox** ou **whitebox** se voc√™ puder **acessar o c√≥digo**.
* [ ] Nos detalhes de cada p√°gina `/<page_id>/pages/view/blocklist/settings/functions`. Verifique por **informa√ß√µes sens√≠veis** nas **`Environment variables`**.
* [ ] Na p√°gina de detalhes, verifique tamb√©m o **comando de build** e o **diret√≥rio raiz** para **potenciais inje√ß√µes** para comprometer a p√°gina.

## **Workers**

Em cada worker do Cloudflare, verifique:

* [ ] Os gatilhos: O que faz o worker ser acionado? Um **usu√°rio pode enviar dados** que ser√£o **usados** pelo worker?
* [ ] Nas **`Settings`**, verifique por **`Variables`** contendo **informa√ß√µes sens√≠veis**.
* [ ] Verifique o **c√≥digo do worker** e procure por **vulnerabilidades** (especialmente em lugares onde o usu√°rio pode gerenciar a entrada).
* Verifique SSRFs retornando a p√°gina indicada que voc√™ pode controlar.
* Verifique XSSs executando JS dentro de uma imagem svg.
* √â poss√≠vel que o worker interaja com outros servi√ßos internos. Por exemplo, um worker pode interagir com um bucket R2 armazenando informa√ß√µes nele obtidas da entrada. Nesse caso, seria necess√°rio verificar quais capacidades o worker tem sobre o bucket R2 e como isso poderia ser abusado a partir da entrada do usu√°rio.

{% hint style="warning" %}
Note que por padr√£o um **Worker recebe uma URL** como `<worker-name>.<account>.workers.dev`. O usu√°rio pode configur√°-lo para um **subdom√≠nio**, mas voc√™ sempre pode acess√°-lo com essa **URL original** se souber.
{% endhint %}

## R2

Em cada bucket R2, verifique:

* [ ] Configure a **Pol√≠tica de CORS**.

## Stream

TODO

## Images

TODO

## Security Center

* [ ] Se poss√≠vel, execute uma **`Security Insights`** **scan** e uma **`Infrastructure`** **scan**, pois elas **destacar√£o** informa√ß√µes interessantes **relacionadas √† seguran√ßa**.
* [ ] Apenas **verifique essas informa√ß√µes** para configura√ß√µes de seguran√ßa incorretas e informa√ß√µes interessantes.

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Bulk Redirects

{% hint style="info" %}
Ao contr√°rio dos [Dynamic Redirects](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), os [**Bulk Redirects**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) s√£o essencialmente est√°ticos ‚Äî eles **n√£o suportam opera√ß√µes de substitui√ß√£o de string** ou express√µes regulares. No entanto, voc√™ pode configurar par√¢metros de redirecionamento de URL que afetam seu comportamento de correspond√™ncia de URL e seu comportamento em tempo de execu√ß√£o.
{% endhint %}

* [ ] Verifique se as **express√µes** e **requisitos** para redirecionamentos **fazem sentido**.
* [ ] Verifique tamb√©m por **endpoints ocultos sens√≠veis** que contenham informa√ß√µes interessantes.

## Notifications

* [ ] Verifique as **notifica√ß√µes**. Essas notifica√ß√µes s√£o recomendadas para seguran√ßa:
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] Verifique todos os **destinos**, pois pode haver **informa√ß√µes sens√≠veis** (autentica√ß√£o b√°sica http) em URLs de webhook. Certifique-se tamb√©m de que as URLs de webhook usem **HTTPS**.
* [ ] Como verifica√ß√£o extra, voc√™ pode tentar **personificar uma notifica√ß√£o do Cloudflare** para um terceiro, talvez voc√™ possa de alguma forma **injetar algo perigoso**.

## Manage Account

* [ ] √â poss√≠vel ver os **√∫ltimos 4 d√≠gitos do cart√£o de cr√©dito**, **tempo de expira√ß√£o** e **endere√ßo de cobran√ßa** em **`Billing` -> `Payment info`**.
* [ ] √â poss√≠vel ver o **tipo de plano** usado na conta em **`Billing` -> `Subscriptions`**.
* [ ] Em **`Members`** √© poss√≠vel ver todos os membros da conta e seu **papel**. Note que se o tipo de plano n√£o for Enterprise, existem apenas 2 pap√©is: Administrador e Super Administrador. Mas se o **plano usado for Enterprise**, [**mais pap√©is**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) podem ser usados para seguir o princ√≠pio do menor privil√©gio.
* Portanto, sempre que poss√≠vel, √© **recomendado** usar o **plano Enterprise**.
* [ ] Em Members √© poss√≠vel verificar quais **membros** t√™m **2FA habilitado**. **Todo** usu√°rio deve ter isso habilitado.

{% hint style="info" %}
Note que, felizmente, o papel **`Administrator`** n√£o d√° permiss√µes para gerenciar membros (**n√£o pode escalar privil√©gios ou convidar** novos membros).
{% endhint %}

## DDoS Investigation

[Verifique esta parte](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
