# Cloudflare Security

{% hint style="success" %}
Μάθετε και εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε και εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Γίνετε μέλος της** 💬 [**ομάδας Discord**](https://discord.gg/hRep4RUj7f) ή της [**ομάδας telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}

Σε έναν λογαριασμό Cloudflare υπάρχουν κάποιες **γενικές ρυθμίσεις και υπηρεσίες** που μπορούν να διαμορφωθούν. Σε αυτή τη σελίδα θα **αναλύσουμε τις ρυθμίσεις ασφαλείας κάθε ενότητας:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

Ελέγξτε κάθε ένα με:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Domain Registration

* [ ] Στην **`Μεταφορά Domains`** ελέγξτε ότι δεν είναι δυνατή η μεταφορά οποιουδήποτε domain.

Ελέγξτε κάθε ένα με:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analytics

_Δεν μπόρεσα να βρω κάτι για έλεγχο ασφάλειας ρυθμίσεων._

## Pages

Σε κάθε σελίδα του Cloudflare:

* [ ] Ελέγξτε για **ευαίσθητες πληροφορίες** στο **`Build log`**.
* [ ] Ελέγξτε για **ευαίσθητες πληροφορίες** στο **Github repository** που έχει ανατεθεί στις σελίδες.
* [ ] Ελέγξτε για πιθανή παραβίαση του github repo μέσω **workflow command injection** ή παραβίαση `pull_request_target`. Περισσότερες πληροφορίες στη [**σελίδα ασφαλείας του Github**](../github-security/).
* [ ] Ελέγξτε για **ευάλωτες λειτουργίες** στον κατάλογο `/fuctions` (αν υπάρχουν), ελέγξτε τις **ανακατευθύνσεις** στο αρχείο `_redirects` (αν υπάρχουν) και **εσφαλμένες ρυθμίσεις κεφαλίδων** στο αρχείο `_headers` (αν υπάρχουν).
* [ ] Ελέγξτε για **ευπάθειες** στη **σελίδα web** μέσω **blackbox** ή **whitebox** αν μπορείτε να **πρόσβαση στον κώδικα**
* [ ] Στις λεπτομέρειες κάθε σελίδας `/<page_id>/pages/view/blocklist/settings/functions`. Ελέγξτε για **ευαίσθητες πληροφορίες** στις **`Μεταβλητές περιβάλλοντος`**.
* [ ] Στη σελίδα λεπτομερειών ελέγξτε επίσης την **εντολή build** και τον **ριζικό κατάλογο** για **πιθανές ενέσεις** για να παραβιάσετε τη σελίδα.

## **Workers**

Σε κάθε worker του Cloudflare ελέγξτε:

* [ ] Τα triggers: Τι προκαλεί την ενεργοποίηση του worker; Μπορεί ένας **χρήστης να στείλει δεδομένα** που θα **χρησιμοποιηθούν** από τον worker;
* [ ] Στις **`Ρυθμίσεις`**, ελέγξτε για **`Μεταβλητές`** που περιέχουν **ευαίσθητες πληροφορίες**
* [ ] Ελέγξτε τον **κώδικα του worker** και αναζητήστε **ευπάθειες** (ειδικά σε σημεία όπου ο χρήστης μπορεί να διαχειριστεί την είσοδο)
* Ελέγξτε για SSRFs που επιστρέφουν την υποδεικνυόμενη σελίδα που μπορείτε να ελέγξετε
* Ελέγξτε XSSs που εκτελούν JS μέσα σε μια εικόνα svg
* Είναι πιθανό ο worker να αλληλεπιδρά με άλλες εσωτερικές υπηρεσίες. Για παράδειγμα, ένας worker μπορεί να αλληλεπιδρά με έναν R2 bucket αποθηκεύοντας πληροφορίες σε αυτόν που λαμβάνονται από την είσοδο. Σε αυτή την περίπτωση, θα ήταν απαραίτητο να ελέγξετε ποιες δυνατότητες έχει ο worker πάνω στον R2 bucket και πώς θα μπορούσε να καταχραστεί από την είσοδο του χρήστη.

{% hint style="warning" %}
Σημειώστε ότι από προεπιλογή ένας **Worker λαμβάνει μια URL** όπως `<worker-name>.<account>.workers.dev`. Ο χρήστης μπορεί να το ορίσει σε ένα **υποτομέα** αλλά μπορείτε πάντα να το προσπελάσετε με αυτή την **αρχική URL** αν την γνωρίζετε.
{% endhint %}

## R2

Σε κάθε R2 bucket ελέγξτε:

* [ ] Διαμορφώστε την **Πολιτική CORS**.

## Stream

TODO

## Images

TODO

## Security Center

* [ ] Αν είναι δυνατόν, εκτελέστε μια **`Σάρωση Security Insights`** και μια **`Σάρωση Υποδομής`**, καθώς θα **επισημάνουν** ενδιαφέρουσες πληροφορίες **ασφαλείας**.
* [ ] Απλά **ελέγξτε αυτές τις πληροφορίες** για εσφαλμένες ρυθμίσεις ασφαλείας και ενδιαφέρουσες πληροφορίες

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Bulk Redirects

{% hint style="info" %}
Σε αντίθεση με [Dynamic Redirects](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Bulk Redirects**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) είναι ουσιαστικά στατικές — δεν υποστηρίζουν καμία λειτουργία αντικατάστασης συμβολοσειράς ή κανονικές εκφράσεις. Ωστόσο, μπορείτε να διαμορφώσετε παραμέτρους ανακατεύθυνσης URL που επηρεάζουν τη συμπεριφορά αντιστοίχισης URL και τη συμπεριφορά εκτέλεσης.
{% endhint %}

* [ ] Ελέγξτε ότι οι **εκφράσεις** και οι **απαιτήσεις** για ανακατευθύνσεις **έχουν νόημα**.
* [ ] Ελέγξτε επίσης για **ευαίσθητα κρυφά endpoints** που περιέχουν ενδιαφέρουσες πληροφορίες.

## Notifications

* [ ] Ελέγξτε τις **ειδοποιήσεις.** Αυτές οι ειδοποιήσεις συνιστώνται για την ασφάλεια:
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] Ελέγξτε όλους τους **προορισμούς**, καθώς μπορεί να υπάρχουν **ευαίσθητες πληροφορίες** (βασική http auth) σε webhook urls. Βεβαιωθείτε επίσης ότι οι webhook urls χρησιμοποιούν **HTTPS**
* [ ] Ως επιπλέον έλεγχο, θα μπορούσατε να προσπαθήσετε να **προσποιηθείτε μια ειδοποίηση cloudflare** σε τρίτο μέρος, ίσως μπορείτε με κάποιο τρόπο να **εισάγετε κάτι επικίνδυνο**

## Manage Account

* [ ] Είναι δυνατό να δείτε τα **τελευταία 4 ψηφία της πιστωτικής κάρτας**, τον **χρόνο λήξης** και τη **διεύθυνση χρέωσης** στο **`Billing` -> `Payment info`**.
* [ ] Είναι δυνατό να δείτε τον **τύπο του σχεδίου** που χρησιμοποιείται στον λογαριασμό στο **`Billing` -> `Subscriptions`**.
* [ ] Στο **`Members`** είναι δυνατό να δείτε όλα τα μέλη του λογαριασμού και τον **ρόλο** τους. Σημειώστε ότι αν ο τύπος του σχεδίου δεν είναι Enterprise, υπάρχουν μόνο 2 ρόλοι: Administrator και Super Administrator. Αλλά αν το **σχέδιο που χρησιμοποιείται είναι Enterprise**, [**περισσότεροι ρόλοι**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) μπορούν να χρησιμοποιηθούν για να ακολουθηθεί η αρχή του ελάχιστου προνομίου.
* Επομένως, όποτε είναι δυνατόν, **συνιστάται** να χρησιμοποιείτε το **σχέδιο Enterprise**.
* [ ] Στο Members είναι δυνατό να ελέγξετε ποια **μέλη** έχουν **ενεργοποιημένο το 2FA**. **Κάθε** χρήστης θα πρέπει να το έχει ενεργοποιημένο.

{% hint style="info" %}
Σημειώστε ότι ευτυχώς ο ρόλος **`Administrator`** δεν δίνει δικαιώματα για διαχείριση μελών (**δεν μπορεί να κλιμακώσει προνόμια ή να προσκαλέσει** νέα μέλη)
{% endhint %}

## DDoS Investigation

[Ελέγξτε αυτό το μέρος](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
Μάθετε και εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε και εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Γίνετε μέλος της** 💬 [**ομάδας Discord**](https://discord.gg/hRep4RUj7f) ή της [**ομάδας telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}
