# Usalama wa Cloudflare

{% hint style="success" %}
Jifunze na fanya mazoezi ya AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze na fanya mazoezi ya GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mipango ya usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

Katika akaunti ya Cloudflare kuna **mipangilio na huduma za jumla** ambazo zinaweza kusanidiwa. Katika ukurasa huu tuta **chambua mipangilio inayohusiana na usalama ya kila sehemu:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

Kagua kila moja na:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Usajili wa Domain

* [ ] Katika **`Transfer Domains`** hakikisha kuwa haiwezekani kuhamisha domain yoyote.

Kagua kila moja na:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analytics

_Sikuweza kupata chochote cha kukagua kwa ukaguzi wa usalama wa mipangilio._

## Pages

Kwenye kila ukurasa wa Cloudflare:

* [ ] Angalia **taarifa nyeti** katika **`Build log`**.
* [ ] Angalia **taarifa nyeti** katika **Github repository** iliyotengwa kwa kurasa.
* [ ] Angalia uwezekano wa kuathiriwa kwa github repo kupitia **workflow command injection** au `pull_request_target` compromise. Maelezo zaidi katika [**Github Security page**](../github-security/).
* [ ] Angalia **functions zilizo hatarini** katika saraka ya `/fuctions` (ikiwa ipo), angalia **redirects** katika faili la `_redirects` (ikiwa ipo) na **vichwa vya habari vilivyosanidiwa vibaya** katika faili la `_headers` (ikiwa ipo).
* [ ] Angalia **madhara** katika **ukurasa wa wavuti** kupitia **blackbox** au **whitebox** ikiwa unaweza **kupata msimbo**
* [ ] Katika maelezo ya kila ukurasa `/<page_id>/pages/view/blocklist/settings/functions`. Angalia **taarifa nyeti** katika **`Environment variables`**.
* [ ] Katika ukurasa wa maelezo angalia pia **amri ya kujenga** na **saraka kuu** kwa **uwezekano wa sindano** ili kuathiri ukurasa.

## **Workers**

Kwenye kila worker ya Cloudflare angalia:

* [ ] Vichochezi: Nini hufanya worker ichochee? Je, **mtumiaji anaweza kutuma data** ambayo itatumika na worker?
* [ ] Katika **`Settings`**, angalia **`Variables`** zenye **taarifa nyeti**
* [ ] Angalia **msimbo wa worker** na tafuta **madhara** (hasa katika sehemu ambapo mtumiaji anaweza kudhibiti pembejeo)
* Angalia SSRFs zinazorejesha ukurasa ulioonyeshwa ambao unaweza kudhibiti
* Angalia XSSs zinazotekeleza JS ndani ya picha ya svg
* Inawezekana kuwa worker inashirikiana na huduma zingine za ndani. Kwa mfano, worker inaweza kushirikiana na ndoo ya R2 kuhifadhi taarifa ndani yake iliyopatikana kutoka kwa pembejeo. Katika hali hiyo, itakuwa muhimu kuangalia uwezo wa worker juu ya ndoo ya R2 na jinsi inaweza kutumiwa vibaya kutoka kwa pembejeo ya mtumiaji.

{% hint style="warning" %}
Kumbuka kuwa kwa default **Worker inapewa URL** kama `<worker-name>.<account>.workers.dev`. Mtumiaji anaweza kuiweka kwenye **subdomain** lakini unaweza kuipata kila wakati kwa **URL ya awali** ikiwa unajua.
{% endhint %}

## R2

Kwenye kila ndoo ya R2 angalia:

* [ ] Sanidi **Sera ya CORS**.

## Stream

TODO

## Images

TODO

## Security Center

* [ ] Ikiwezekana, endesha **`Security Insights`** **scan** na **`Infrastructure`** **scan**, kwani zitaonyesha taarifa muhimu **kiusalama**.
* [ ] Angalia tu **taarifa hii** kwa mipangilio ya usalama isiyo sahihi na taarifa muhimu

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Bulk Redirects

{% hint style="info" %}
Tofauti na [Dynamic Redirects](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Bulk Redirects**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) kimsingi ni static ‚Äî hazina **masharti yoyote ya kubadilisha mfululizo** au expressions za kawaida. Hata hivyo, unaweza kusanidi vigezo vya URL redirect vinavyoathiri tabia yao ya kulinganisha URL na tabia yao ya wakati wa kukimbia.
{% endhint %}

* [ ] Angalia kuwa **expressions** na **mahitaji** ya redirects **yana maana**.
* [ ] Angalia pia kwa **endpoints nyeti zilizofichwa** ambazo zina taarifa muhimu.

## Notifications

* [ ] Angalia **notifications.** Hizi notifications zinapendekezwa kwa usalama:
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] Angalia **vituo vyote**, kwani kunaweza kuwa na **taarifa nyeti** (basic http auth) katika webhook urls. Hakikisha pia webhook urls zinatumia **HTTPS**
* [ ] Kama ukaguzi wa ziada, unaweza kujaribu **kuiga notification ya cloudflare** kwa mtu wa tatu, labda unaweza kwa namna fulani **kuingiza kitu hatari**

## Manage Account

* [ ] Inawezekana kuona **nambari 4 za mwisho za kadi ya mkopo**, **muda wa kumalizika** na **anwani ya bili** katika **`Billing` -> `Payment info`**.
* [ ] Inawezekana kuona **aina ya mpango** unaotumiwa katika akaunti katika **`Billing` -> `Subscriptions`**.
* [ ] Katika **`Members`** inawezekana kuona wanachama wote wa akaunti na **jukumu** lao. Kumbuka kuwa ikiwa aina ya mpango sio Enterprise, kuna majukumu 2 tu: Administrator na Super Administrator. Lakini ikiwa **mpango unaotumiwa ni Enterprise**, [**majina zaidi**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) yanaweza kutumiwa kufuata kanuni ya upendeleo mdogo.
* Kwa hivyo, inapowezekana **inapendekezwa** kutumia **mpango wa Enterprise**.
* [ ] Katika Members inawezekana kuangalia ni **wanachama gani** wana **2FA imewezeshwa**. **Kila** mtumiaji anapaswa kuwa na hiyo imewezeshwa.

{% hint style="info" %}
Kumbuka kuwa kwa bahati nzuri jukumu la **`Administrator`** halitoi ruhusa za kudhibiti uanachama (**haiwezi kuongeza privs au kualika** wanachama wapya)
{% endhint %}

## DDoS Investigation

[Angalia sehemu hii](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
Jifunze na fanya mazoezi ya AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze na fanya mazoezi ya GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mipango ya usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
