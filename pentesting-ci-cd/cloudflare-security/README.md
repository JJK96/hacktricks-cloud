# Cloudflare Security

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking öğrenin ve pratik yapın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **Katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) ya da **Twitter'da** bizi takip edin 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **HackTricks'e** [**PR göndererek**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **hacking ipuçlarını paylaşın**.

</details>
{% endhint %}

Bir Cloudflare hesabında yapılandırılabilecek bazı **genel ayarlar ve hizmetler** vardır. Bu sayfada her bölümün **güvenlikle ilgili ayarlarını analiz edeceğiz:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

Her birini gözden geçirin:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Domain Registration

* [ ] **`Transfer Domains`** bölümünde herhangi bir domainin transfer edilemediğini kontrol edin.

Her birini gözden geçirin:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analytics

_Konfigürasyon güvenlik incelemesi için kontrol edilecek bir şey bulamadım._

## Pages

Her Cloudflare sayfasında:

* [ ] **`Build log`** içinde **hassas bilgi** kontrol edin.
* [ ] Sayfalara atanan **Github deposunda** **hassas bilgi** kontrol edin.
* [ ] **workflow command injection** veya `pull_request_target` zafiyeti yoluyla potansiyel github repo ele geçirilmesini kontrol edin. Daha fazla bilgi için [**Github Security sayfasına**](../github-security/) bakın.
* [ ] `/fuctions` dizininde (varsa) **zafiyetli fonksiyonları**, `_redirects` dosyasındaki (varsa) **yönlendirmeleri** ve `_headers` dosyasındaki (varsa) **yanlış yapılandırılmış başlıkları** kontrol edin.
* [ ] **Kodu erişebiliyorsanız** **blackbox** veya **whitebox** ile **web sayfasındaki** **zafiyetleri** kontrol edin.
* [ ] Her sayfanın `/<page_id>/pages/view/blocklist/settings/functions` detaylarında **`Environment variables`** içinde **hassas bilgi** kontrol edin.
* [ ] Detay sayfasında ayrıca **build command** ve **root directory** içinde **potansiyel enjeksiyonları** kontrol edin.

## **Workers**

Her Cloudflare worker'ında kontrol edin:

* [ ] Tetikleyiciler: Worker'ı ne tetikliyor? Bir **kullanıcı veri gönderebilir mi** ve bu veri worker tarafından **kullanılabilir mi**?
* [ ] **`Settings`** içinde **hassas bilgi** içeren **`Variables`** kontrol edin.
* [ ] **Worker kodunu** kontrol edin ve **zafiyetleri** arayın (özellikle kullanıcının girişi yönetebileceği yerlerde)
* Kontrol edebileceğiniz sayfayı döndüren SSRF'leri kontrol edin.
* Bir svg görüntüsü içinde JS çalıştıran XSS'leri kontrol edin.
* Worker'ın diğer iç hizmetlerle etkileşime girmesi mümkündür. Örneğin, bir worker bir R2 bucket ile etkileşime girip, girişten elde edilen bilgileri orada depolayabilir. Bu durumda, worker'ın R2 bucket üzerindeki yeteneklerini ve kullanıcı girişinden nasıl kötüye kullanılabileceğini kontrol etmek gerekecektir.

{% hint style="warning" %}
Varsayılan olarak bir **Worker'a bir URL** verildiğini unutmayın, örneğin `<worker-name>.<account>.workers.dev`. Kullanıcı bunu bir **alt alan adı** olarak ayarlayabilir, ancak bu **orijinal URL** ile her zaman erişebilirsiniz.
{% endhint %}

## R2

Her R2 bucket'ında kontrol edin:

* [ ] **CORS Policy** yapılandırın.

## Stream

TODO

## Images

TODO

## Security Center

* [ ] Mümkünse, bir **`Security Insights`** **tarama** ve bir **`Infrastructure`** **tarama** çalıştırın, çünkü bunlar **güvenlik** açısından ilginç bilgileri **vurgulayacaktır**.
* [ ] Bu bilgileri güvenlik yanlış yapılandırmaları ve ilginç bilgiler için **kontrol edin**.

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Bulk Redirects

{% hint style="info" %}
[Dynamic Redirects](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/) aksine, [**Bulk Redirects**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) esasen statiktir — **herhangi bir dize değiştirme** işlemi veya düzenli ifadeleri desteklemezler. Ancak, URL eşleştirme davranışlarını ve çalışma zamanındaki davranışlarını etkileyen URL yönlendirme parametrelerini yapılandırabilirsiniz.
{% endhint %}

* [ ] Yönlendirmeler için **ifadelerin** ve **gereksinimlerin** **mantıklı** olup olmadığını kontrol edin.
* [ ] Ayrıca **ilginç bilgi içeren hassas gizli uç noktaları** kontrol edin.

## Notifications

* [ ] **Bildirimleri** kontrol edin. Bu bildirimler güvenlik için önerilir:
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] Tüm **hedefleri** kontrol edin, çünkü webhook url'lerinde **hassas bilgi** (temel http auth) olabilir. Ayrıca webhook url'lerinin **HTTPS** kullandığından emin olun.
* [ ] Ekstra kontrol olarak, bir **cloudflare bildirimini** üçüncü bir tarafa **taklit etmeyi** deneyebilirsiniz, belki bir şekilde **tehlikeli bir şey enjekte edebilirsiniz**.

## Manage Account

* [ ] **`Billing` -> `Payment info`** bölümünde kredi kartının **son 4 hanesini**, **son kullanma** tarihini ve **fatura adresini** görmek mümkündür.
* [ ] **`Billing` -> `Subscriptions`** bölümünde hesapta kullanılan **plan türünü** görmek mümkündür.
* [ ] **`Members`** bölümünde hesabın tüm üyelerini ve **rollerini** görmek mümkündür. Plan türü Enterprise değilse, yalnızca 2 rol vardır: Administrator ve Super Administrator. Ancak kullanılan **plan Enterprise ise**, [**daha fazla rol**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) en az ayrıcalık ilkesine uymak için kullanılabilir.
* Bu nedenle, mümkün olduğunda **Enterprise planı** kullanılması **önerilir**.
* [ ] Members bölümünde hangi **üyelerin** **2FA etkinleştirdiğini** kontrol etmek mümkündür. **Her** kullanıcının bunu etkinleştirmesi gerekmektedir.

{% hint style="info" %}
Neyse ki **`Administrator`** rolünün üyelikleri yönetme yetkisi vermediğini (**yetkileri yükseltemez veya yeni üyeler davet edemez**) unutmayın.
{% endhint %}

## DDoS Investigation

[Bu bölümü kontrol edin](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking öğrenin ve pratik yapın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **Katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) ya da **Twitter'da** bizi takip edin 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **HackTricks'e** [**PR göndererek**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **hacking ipuçlarını paylaşın**.

</details>
{% endhint %}
