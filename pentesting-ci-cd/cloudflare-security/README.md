# Cloudflare Security

{% hint style="success" %}
Apprenez et pratiquez AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

Dans un compte Cloudflare, il y a des **param√®tres et services g√©n√©raux** qui peuvent √™tre configur√©s. Sur cette page, nous allons **analyser les param√®tres de s√©curit√© de chaque section :**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

Revoir chaque √©l√©ment avec :

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Domain Registration

* [ ] Dans **`Transfer Domains`** v√©rifier qu'il n'est pas possible de transf√©rer un domaine.

Revoir chaque √©l√©ment avec :

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analytics

_Je n'ai rien trouv√© √† v√©rifier pour une revue de s√©curit√© de la configuration._

## Pages

Sur chaque page de Cloudflare :

* [ ] V√©rifiez les **informations sensibles** dans le **`Build log`**.
* [ ] V√©rifiez les **informations sensibles** dans le **d√©p√¥t Github** assign√© aux pages.
* [ ] V√©rifiez le potentiel compromis du d√©p√¥t github via **workflow command injection** ou compromis `pull_request_target`. Plus d'infos dans la [**page de s√©curit√© Github**](../github-security/).
* [ ] V√©rifiez les **fonctions vuln√©rables** dans le r√©pertoire `/fuctions` (le cas √©ch√©ant), v√©rifiez les **redirections** dans le fichier `_redirects` (le cas √©ch√©ant) et les **en-t√™tes mal configur√©s** dans le fichier `_headers` (le cas √©ch√©ant).
* [ ] V√©rifiez les **vuln√©rabilit√©s** dans la **page web** via **blackbox** ou **whitebox** si vous pouvez **acc√©der au code**
* [ ] Dans les d√©tails de chaque page `/<page_id>/pages/view/blocklist/settings/functions`. V√©rifiez les **informations sensibles** dans les **`Variables d'environnement`**.
* [ ] Dans la page de d√©tails, v√©rifiez √©galement la **commande de build** et le **r√©pertoire racine** pour des **injections potentielles** afin de compromettre la page.

## **Workers**

Sur chaque worker de Cloudflare, v√©rifiez :

* [ ] Les d√©clencheurs : Qu'est-ce qui d√©clenche le worker ? Un **utilisateur peut-il envoyer des donn√©es** qui seront **utilis√©es** par le worker ?
* [ ] Dans les **`Settings`**, v√©rifiez les **`Variables`** contenant des **informations sensibles**
* [ ] V√©rifiez le **code du worker** et recherchez des **vuln√©rabilit√©s** (surtout dans les endroits o√π l'utilisateur peut g√©rer l'entr√©e)
* V√©rifiez les SSRFs retournant la page indiqu√©e que vous pouvez contr√¥ler
* V√©rifiez les XSSs ex√©cutant du JS √† l'int√©rieur d'une image svg
* Il est possible que le worker interagisse avec d'autres services internes. Par exemple, un worker peut interagir avec un bucket R2 en y stockant des informations obtenues √† partir de l'entr√©e. Dans ce cas, il serait n√©cessaire de v√©rifier quelles capacit√©s le worker a sur le bucket R2 et comment cela pourrait √™tre abus√© √† partir de l'entr√©e utilisateur.

{% hint style="warning" %}
Notez que par d√©faut un **Worker re√ßoit une URL** telle que `<worker-name>.<account>.workers.dev`. L'utilisateur peut le d√©finir sur un **sous-domaine** mais vous pouvez toujours y acc√©der avec cette **URL originale** si vous la connaissez.
{% endhint %}

## R2

Sur chaque bucket R2, v√©rifiez :

* [ ] Configurez la **politique CORS**.

## Stream

√Ä FAIRE

## Images

√Ä FAIRE

## Security Center

* [ ] Si possible, ex√©cutez un **scan `Security Insights`** et un **scan `Infrastructure`**, car ils mettront en √©vidence des informations int√©ressantes en mati√®re de **s√©curit√©**.
* [ ] V√©rifiez simplement ces informations pour des mauvaises configurations de s√©curit√© et des informations int√©ressantes

## Turnstile

√Ä FAIRE

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Bulk Redirects

{% hint style="info" %}
Contrairement aux [Dynamic Redirects](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), les [**Bulk Redirects**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) sont essentiellement statiques ‚Äî ils ne supportent **aucune op√©ration de remplacement de cha√Æne** ou expressions r√©guli√®res. Cependant, vous pouvez configurer des param√®tres de redirection d'URL qui affectent leur comportement de correspondance d'URL et leur comportement d'ex√©cution.
{% endhint %}

* [ ] V√©rifiez que les **expressions** et **exigences** pour les redirections **ont du sens**.
* [ ] V√©rifiez √©galement les **endpoints sensibles cach√©s** qui contiennent des informations int√©ressantes.

## Notifications

* [ ] V√©rifiez les **notifications.** Ces notifications sont recommand√©es pour la s√©curit√© :
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] V√©rifiez toutes les **destinations**, car il pourrait y avoir des **informations sensibles** (authentification http de base) dans les urls de webhook. Assurez-vous √©galement que les urls de webhook utilisent **HTTPS**
* [ ] En v√©rification suppl√©mentaire, vous pourriez essayer de **usurper une notification cloudflare** √† un tiers, peut-√™tre pouvez-vous **injecter quelque chose de dangereux**

## Manage Account

* [ ] Il est possible de voir les **4 derniers chiffres de la carte de cr√©dit**, le **temps d'expiration** et l'**adresse de facturation** dans **`Billing` -> `Payment info`**.
* [ ] Il est possible de voir le **type de plan** utilis√© dans le compte dans **`Billing` -> `Subscriptions`**.
* [ ] Dans **`Members`** il est possible de voir tous les membres du compte et leur **r√¥le**. Notez que si le type de plan n'est pas Enterprise, seuls 2 r√¥les existent : Administrateur et Super Administrateur. Mais si le **plan utilis√© est Enterprise**, [**plus de r√¥les**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) peuvent √™tre utilis√©s pour suivre le principe du moindre privil√®ge.
* Par cons√©quent, chaque fois que possible, il est **recommand√©** d'utiliser le **plan Enterprise**.
* [ ] Dans Members, il est possible de v√©rifier quels **membres** ont **2FA activ√©**. **Chaque** utilisateur devrait l'avoir activ√©.

{% hint style="info" %}
Notez que heureusement le r√¥le **`Administrator`** ne donne pas de permissions pour g√©rer les adh√©sions (**ne peut pas escalader les privil√®ges ou inviter** de nouveaux membres)
{% endhint %}

## DDoS Investigation

[Consultez cette partie](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
Apprenez et pratiquez AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
