# Seguran√ßa do Cloudflare

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

Em uma conta do Cloudflare, existem algumas **configura√ß√µes gerais e servi√ßos** que podem ser configurados. Nesta p√°gina, vamos **analisar as configura√ß√µes relacionadas √† seguran√ßa de cada se√ß√£o:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

Revise cada um com:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Registro de Dom√≠nio

* [ ] Em **`Transferir Dom√≠nios`** verifique se n√£o √© poss√≠vel transferir nenhum dom√≠nio.

Revise cada um com:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## An√°lises

_N√£o encontrei nada para verificar em uma revis√£o de seguran√ßa de configura√ß√£o._

## P√°ginas

Em cada p√°gina do Cloudflare:

* [ ] Verifique se h√° **informa√ß√µes sens√≠veis** no **`Log de compila√ß√£o`**.
* [ ] Verifique se h√° **informa√ß√µes sens√≠veis** no **reposit√≥rio do Github** atribu√≠do √†s p√°ginas.
* [ ] Verifique a possibilidade de comprometimento do reposit√≥rio do Github via **inje√ß√£o de comandos de fluxo de trabalho** ou comprometimento de `pull_request_target`. Mais informa√ß√µes na [**p√°gina de Seguran√ßa do Github**](../github-security/).
* [ ] Verifique se h√° **fun√ß√µes vulner√°veis** no diret√≥rio `/fun√ß√µes` (se houver), verifique os **redirecionamentos** no arquivo `_redirects` (se houver) e **cabe√ßalhos mal configurados** no arquivo `_headers` (se houver).
* [ ] Verifique as **vulnerabilidades** na **p√°gina da web** via **blackbox** ou **whitebox** se voc√™ puder **acessar o c√≥digo**
* [ ] Nos detalhes de cada p√°gina `/<page_id>/pages/view/blocklist/settings/functions`. Verifique se h√° **informa√ß√µes sens√≠veis** nas **`Vari√°veis de ambiente`**.
* [ ] Na p√°gina de detalhes, verifique tamb√©m o **comando de compila√ß√£o** e o **diret√≥rio raiz** para **inje√ß√µes potenciais** para comprometer a p√°gina.

## **Workers**

Em cada worker do Cloudflare, verifique:

* [ ] Os gatilhos: O que faz o worker disparar? Um **usu√°rio pode enviar dados** que ser√£o **usados** pelo worker?
* [ ] Nas **`Configura√ß√µes`**, verifique as **`Vari√°veis`** contendo **informa√ß√µes sens√≠veis**
* [ ] Verifique o **c√≥digo do worker** e procure por **vulnerabilidades** (especialmente em locais onde o usu√°rio pode gerenciar a entrada)
* Verifique SSRFs retornando a p√°gina indicada que voc√™ pode controlar
* Verifique XSSs executando JS dentro de uma imagem svg
* √â poss√≠vel que o worker interaja com outros servi√ßos internos. Por exemplo, um worker pode interagir com um bucket R2 armazenando informa√ß√µes nele obtidas a partir da entrada. Nesse caso, seria necess√°rio verificar quais capacidades o worker tem sobre o bucket R2 e como poderia ser abusado a partir da entrada do usu√°rio.

{% hint style="warning" %}
Observe que por padr√£o um **Worker recebe uma URL** como `<nome-do-worker>.<conta>.workers.dev`. O usu√°rio pode definir um **subdom√≠nio**, mas voc√™ sempre pode acess√°-lo com aquela **URL original** se souber.
{% endhint %}

## R2

Em cada bucket R2, verifique:

* [ ] Configure a **Pol√≠tica CORS**.

## Stream

A FAZER

## Imagens

A FAZER

## Centro de Seguran√ßa

* [ ] Se poss√≠vel, execute uma **verifica√ß√£o de** **`Seguran√ßa Insights`** e uma **verifica√ß√£o de** **`Infraestrutura`**, pois eles ir√£o **destacar** informa√ß√µes interessantes relacionadas √† **seguran√ßa**.
* [ ] Apenas **verifique estas informa√ß√µes** por configura√ß√µes de seguran√ßa incorretas e informa√ß√µes interessantes

## Turnstile

A FAZER

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Redirecionamentos em Massa

{% hint style="info" %}
Ao contr√°rio dos [Redirecionamentos Din√¢micos](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Redirecionamentos em Massa**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) s√£o essencialmente est√°ticos ‚Äî eles **n√£o suportam opera√ß√µes de substitui√ß√£o de strings** ou express√µes regulares. No entanto, voc√™ pode configurar par√¢metros de redirecionamento de URL que afetam seu comportamento de correspond√™ncia de URL e seu comportamento em tempo de execu√ß√£o.
{% endhint %}

* [ ] Verifique se as **express√µes** e **requisitos** para redirecionamentos **fazem sentido**.
* [ ] Verifique tamb√©m os **pontos de extremidade ocultos sens√≠veis** que contenham informa√ß√µes interessantes.

## Notifica√ß√µes

* [ ] Verifique as **notifica√ß√µes**. Essas notifica√ß√µes s√£o recomendadas para seguran√ßa:
* `Faturamento Baseado no Uso`
* `Alerta de Ataque DDoS HTTP`
* `Alerta de Ataque DDoS de Camada 3/4`
* `Alerta de Ataque DDoS HTTP Avan√ßado`
* `Alerta de Ataque DDoS de Camada 3/4 Avan√ßado`
* `Monitoramento Baseado em Fluxo: Ataque Volum√©trico`
* `Alerta de Detec√ß√£o de Vazamento de Rota`
* `Alerta de Expira√ß√£o de Certificado mTLS de Acesso`
* `Alerta de Hostnames Personalizados SSL para SaaS`
* `Alerta SSL Universal`
* `Alerta de Detec√ß√£o de Nova Altera√ß√£o de C√≥digo do Monitor de Script`
* `Alerta de Novo Dom√≠nio do Monitor de Script`
* `Alerta de Novo Dom√≠nio Malicioso do Monitor de Script`
* `Alerta de Novo Script Malicioso do Monitor de Script`
* `Alerta de Novo URL Malicioso do Monitor de Script`
* `Alerta de Novos Scripts do Monitor de Script`
* `Alerta de Novo Script do Monitor de Script Excede o Comprimento M√°ximo de URL`
* `Alerta de Eventos de Seguran√ßa Avan√ßados`
* `Alerta de Eventos de Seguran√ßa`
* [ ] Verifique todos os **destinos**, pois pode haver **informa√ß√µes sens√≠veis** (autentica√ß√£o b√°sica http) nos urls de webhook. Certifique-se tamb√©m de que os urls de webhook usem **HTTPS**
* [ ] Como verifica√ß√£o adicional, voc√™ poderia tentar **falsificar uma notifica√ß√£o do Cloudflare** para um terceiro, talvez voc√™ possa de alguma forma **injetar algo perigoso**

## Gerenciar Conta

* [ ] √â poss√≠vel ver os **√∫ltimos 4 d√≠gitos do cart√£o de cr√©dito**, **data de validade** e **endere√ßo de cobran√ßa** em **`Faturamento` -> `Informa√ß√µes de Pagamento`**.
* [ ] √â poss√≠vel ver o **tipo de plano** usado na conta em **`Faturamento` -> `Assinaturas`**.
* [ ] Em **`Membros`** √© poss√≠vel ver todos os membros da conta e seu **cargo**. Note que se o tipo de plano n√£o for Enterprise, existem apenas 2 cargos: Administrador e Super Administrador. Mas se o **plano usado for Enterprise**, [**mais cargos**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) podem ser usados para seguir o princ√≠pio do menor privil√©gio.
* Portanto, sempre que poss√≠vel √© **recomendado** usar o **plano Enterprise**.
* [ ] Em Membros √© poss√≠vel verificar quais **membros** t√™m **2FA ativado**. **Todo** usu√°rio deve t√™-lo ativado.

{% hint style="info" %}
Observe que felizmente o cargo de **`Administrador`** n√£o concede permiss√µes para gerenciar membros (**n√£o pode escalar privil√©gios ou convidar** novos membros)
{% endhint %}
## Investiga√ß√£o de DDoS

[Verifique esta parte](cloudflare-domains.md#cloudflare-ddos-protection).

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
