# Cloudflare Sicherheit

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks in PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>

In einem Cloudflare-Konto gibt es einige **allgemeine Einstellungen und Dienste**, die konfiguriert werden k√∂nnen. Auf dieser Seite werden wir **die sicherheitsrelevanten Einstellungen jeder Sektion analysieren:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

√úberpr√ºfen Sie jede mit:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Domain-Registrierung

* [ ] In **`Transfer Domains`** √ºberpr√ºfen, dass es nicht m√∂glich ist, eine Domain zu √ºbertragen.

√úberpr√ºfen Sie jede mit:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analytik

_Ich konnte nichts finden, um eine Sicherheits√ºberpr√ºfung der Konfiguration durchzuf√ºhren._

## Seiten

Auf jeder Cloudflare-Seite:

* [ ] √úberpr√ºfen Sie auf **sensible Informationen** im **`Build-Protokoll`**.
* [ ] √úberpr√ºfen Sie auf **sensible Informationen** im **Github-Repository**, das den Seiten zugewiesen ist.
* [ ] √úberpr√ºfen Sie auf potenzielle GitHub-Repo-Kompromittierung durch **Workflow-Befehlsinjektion** oder `pull_request_target`-Kompromittierung. Weitere Informationen auf der [**GitHub-Sicherheitsseite**](../github-security/).
* [ ] √úberpr√ºfen Sie auf **anf√§llige Funktionen** im `/fuctions`-Verzeichnis (falls vorhanden), √ºberpr√ºfen Sie die **Weiterleitungen** in der Datei `_redirects` (falls vorhanden) und **falsch konfigurierte Header** in der Datei `_headers` (falls vorhanden).
* [ ] √úberpr√ºfen Sie auf **Schwachstellen** auf der **Webseite** √ºber **Blackbox** oder **Whitebox**, wenn Sie auf den **Code zugreifen k√∂nnen**
* [ ] In den Details jeder Seite `/<page_id>/pages/view/blocklist/settings/functions`. √úberpr√ºfen Sie auf **sensible Informationen** in den **`Umgebungsvariablen`**.
* [ ] √úberpr√ºfen Sie auf der Detailseite auch den **Build-Befehl** und das **Stammverzeichnis** auf **potenzielle Injektionen**, um die Seite zu kompromittieren.

## **Worker**

Auf jedem Cloudflare-Worker √ºberpr√ºfen Sie:

* [ ] Die Ausl√∂ser: Was l√∂st den Worker aus? Kann ein **Benutzer Daten senden**, die vom Worker **verwendet** werden?
* [ ] In den **`Einstellungen`** √ºberpr√ºfen, ob **`Variablen`** mit **sensiblen Informationen** enthalten sind
* [ ] √úberpr√ºfen Sie den **Code des Workers** und suchen Sie nach **Schwachstellen** (insbesondere an Stellen, an denen der Benutzer die Eingabe verwalten kann)
* √úberpr√ºfen Sie auf SSRFs, die die angegebene Seite zur√ºckgeben, die Sie steuern k√∂nnen
* √úberpr√ºfen Sie XSSs, die JS in einem SVG-Bild ausf√ºhren
* Es ist m√∂glich, dass der Worker mit anderen internen Diensten interagiert. Zum Beispiel kann ein Worker mit einem R2-Bucket interagieren, der darin gespeicherte Informationen aus der Eingabe erh√§lt. In diesem Fall w√§re es notwendig zu √ºberpr√ºfen, welche F√§higkeiten der Worker √ºber den R2-Bucket verf√ºgt und wie er missbraucht werden k√∂nnte.

{% hint style="warning" %}
Beachten Sie, dass einem **Worker standardm√§√üig eine URL** wie `<worker-name>.<account>.workers.dev` zugewiesen wird. Der Benutzer kann es auf einen **Subdomain** setzen, aber Sie k√∂nnen immer noch darauf zugreifen mit dieser **urspr√ºnglichen URL**, wenn Sie sie kennen.
{% endhint %}

## R2

Auf jedem R2-Bucket √ºberpr√ºfen Sie:

* [ ] Konfigurieren Sie die **CORS-Richtlinie**.

## Stream

TODO

## Bilder

TODO

## Sicherheitscenter

* [ ] F√ºhren Sie falls m√∂glich einen **`Security Insights`** **Scan** und einen **`Infrastruktur`** **Scan** durch, da sie interessante Informationen im Hinblick auf die **Sicherheit** hervorheben werden.
* [ ] √úberpr√ºfen Sie diese Informationen nur auf Sicherheitsfehler und interessante Informationen

## Drehkreuz

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Massenweiterleitungen

{% hint style="info" %}
Im Gegensatz zu [Dynamische Weiterleitungen](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Massenweiterleitungen**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) sind im Wesentlichen statisch ‚Äî sie unterst√ºtzen **keine Zeichenkettenersetzung** oder regul√§re Ausdr√ºcke. Sie k√∂nnen jedoch URL-Weiterleitungsparameter konfigurieren, die ihr URL-Matching-Verhalten und ihr Laufzeitverhalten beeinflussen.
{% endhint %}

* [ ] √úberpr√ºfen Sie, ob die **Ausdr√ºcke** und **Anforderungen** f√ºr Weiterleitungen **sinnvoll sind**.
* [ ] √úberpr√ºfen Sie auch auf **sensible versteckte Endpunkte**, die interessante Informationen enthalten.

## Benachrichtigungen

* [ ] √úberpr√ºfen Sie die **Benachrichtigungen**. Diese Benachrichtigungen werden aus Sicherheitsgr√ºnden empfohlen:
* `Verbrauchsabh√§ngige Abrechnung`
* `HTTP DDoS-Angriffsalarm`
* `Layer 3/4 DDoS-Angriffsalarm`
* `Erweiterter HTTP DDoS-Angriffsalarm`
* `Erweiterter Layer 3/4 DDoS-Angriffsalarm`
* `Flussbasierte √úberwachung: Volumetrischer Angriff`
* `Routen-Leck-Erkennungsalarm`
* `Zugriff mTLS-Zertifikatablaufalarm`
* `SSL f√ºr SaaS-Benutzerdefinierte Hostnamenalarm`
* `Universeller SSL-Alarm`
* `Skript√ºberwachung Neuer Code√§nderungserkennungsalarm`
* `Skript√ºberwachung Neuer Domainalarm`
* `Skript√ºberwachung Neue b√∂sartige Domainalarm`
* `Skript√ºberwachung Neue b√∂sartige Skriptalarm`
* `Skript√ºberwachung Neue b√∂sartige URL-Alarm`
* `Skript√ºberwachung Neue Skripte-Alarm`
* `Skript√ºberwachung Neues Skript √ºberschreitet maximale URL-L√§nge-Alarm`
* `Erweiterte Sicherheitsereignisse-Alarm`
* `Sicherheitsereignisse-Alarm`
* [ ] √úberpr√ºfen Sie alle **Ziele**, da dort **sensible Informationen** (Grundlegende HTTP-Authentifizierung) in Webhook-URLs enthalten sein k√∂nnten. Stellen Sie au√üerdem sicher, dass Webhook-URLs **HTTPS** verwenden
* [ ] Als zus√§tzliche √úberpr√ºfung k√∂nnten Sie versuchen, eine **Cloudflare-Benachrichtigung zu impersonieren** an einen Dritten, vielleicht k√∂nnen Sie irgendwie **etwas Gef√§hrliches einschleusen**

## Kontoverwaltung

* [ ] Es ist m√∂glich, die **letzten 4 Ziffern der Kreditkarte**, das **Ablaufdatum** und die **Rechnungsadresse** in **`Abrechnung` -> `Zahlungsinformationen`** zu sehen.
* [ ] Es ist m√∂glich, den **Plan-Typ** im Konto in **`Abrechnung` -> `Abonnements`** zu sehen.
* [ ] In **`Mitglieder`** ist es m√∂glich, alle Mitglieder des Kontos und ihre **Rolle** zu sehen. Beachten Sie, dass bei einem nicht-Enterprise-Plan nur 2 Rollen existieren: Administrator und Superadministrator. Wenn jedoch der verwendete **Plan Enterprise ist**, k√∂nnen [**mehr Rollen**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) verwendet werden, um dem Prinzip des geringsten Privilegs zu folgen.
* Daher wird immer empfohlen, wenn m√∂glich den **Enterprise-Plan** zu verwenden.
* [ ] In Mitglieder k√∂nnen Sie √ºberpr√ºfen, welche **Mitglieder** die **2FA aktiviert** haben. **Jeder** Benutzer sollte es aktiviert haben.

{% hint style="info" %}
Beachten Sie, dass die Rolle **`Administrator`** gl√ºcklicherweise keine Berechtigungen zur Verwaltung von Mitgliedschaften gibt (**kann keine Berechtigungen eskalieren oder neue Mitglieder einladen**)
{% endhint %}
## DDoS-Untersuchung

[√úberpr√ºfen Sie diesen Abschnitt](cloudflare-domains.md#cloudflare-ddos-protection).

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
