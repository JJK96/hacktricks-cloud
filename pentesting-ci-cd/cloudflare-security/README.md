# Cloudflare Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Sprawdź [**plany subskrypcji**](https://github.com/sponsors/carlospolop)!
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel się trikami hakerskimi, przesyłając PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriów na githubie.

</details>
{% endhint %}

W koncie Cloudflare istnieją pewne **ogólne ustawienia i usługi**, które można skonfigurować. Na tej stronie będziemy **analizować ustawienia związane z bezpieczeństwem w każdej sekcji:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

Przejrzyj każdy z:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Domain Registration

* [ ] W **`Transfer Domains`** sprawdź, czy nie jest możliwe przeniesienie żadnej domeny.

Przejrzyj każdy z:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analytics

_Nie znalazłem niczego do sprawdzenia pod kątem przeglądu bezpieczeństwa konfiguracji._

## Pages

Na każdej stronie Cloudflare:

* [ ] Sprawdź **wrażliwe informacje** w **`Build log`**.
* [ ] Sprawdź **wrażliwe informacje** w **repozytorium Github** przypisanym do stron.
* [ ] Sprawdź potencjalne przejęcie repozytorium github poprzez **workflow command injection** lub kompromitację `pull_request_target`. Więcej informacji na [**stronie bezpieczeństwa Github**](../github-security/).
* [ ] Sprawdź **podatne funkcje** w katalogu `/fuctions` (jeśli istnieją), sprawdź **przekierowania** w pliku `_redirects` (jeśli istnieją) i **nieprawidłowo skonfigurowane nagłówki** w pliku `_headers` (jeśli istnieją).
* [ ] Sprawdź **podatności** na **stronie internetowej** poprzez **blackbox** lub **whitebox**, jeśli masz **dostęp do kodu**.
* [ ] W szczegółach każdej strony `/<page_id>/pages/view/blocklist/settings/functions`. Sprawdź **wrażliwe informacje** w **`Environment variables`**.
* [ ] W szczegółach strony sprawdź również **komendę build** i **katalog główny** pod kątem **potencjalnych wstrzyknięć** w celu przejęcia strony.

## **Workers**

Na każdym workerze Cloudflare sprawdź:

* [ ] Triggery: Co powoduje uruchomienie workera? Czy **użytkownik może wysłać dane**, które będą **używane** przez workera?
* [ ] W **`Settings`**, sprawdź **`Variables`** zawierające **wrażliwe informacje**
* [ ] Sprawdź **kod workera** i poszukaj **podatności** (szczególnie w miejscach, gdzie użytkownik może zarządzać wejściem)
* Sprawdź SSRFs zwracające wskazaną stronę, którą możesz kontrolować
* Sprawdź XSSs wykonujące JS wewnątrz obrazu svg
* Możliwe, że worker współpracuje z innymi wewnętrznymi usługami. Na przykład, worker może współpracować z R2 bucket, przechowując w nim informacje uzyskane z wejścia. W takim przypadku konieczne będzie sprawdzenie, jakie możliwości ma worker w stosunku do R2 bucket i jak można je wykorzystać z wejścia użytkownika.

{% hint style="warning" %}
Zauważ, że domyślnie **Worker otrzymuje URL** taki jak `<worker-name>.<account>.workers.dev`. Użytkownik może ustawić go na **subdomenę**, ale zawsze możesz uzyskać do niego dostęp za pomocą tego **oryginalnego URL**, jeśli go znasz.
{% endhint %}

## R2

Na każdym R2 bucket sprawdź:

* [ ] Skonfiguruj **CORS Policy**.

## Stream

TODO

## Images

TODO

## Security Center

* [ ] Jeśli to możliwe, uruchom **`Security Insights`** **scan** i **`Infrastructure`** **scan**, ponieważ **podkreślą** one interesujące informacje **związane z bezpieczeństwem**.
* [ ] Po prostu **sprawdź te informacje** pod kątem nieprawidłowych konfiguracji bezpieczeństwa i interesujących informacji

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Bulk Redirects

{% hint style="info" %}
W przeciwieństwie do [Dynamic Redirects](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Bulk Redirects**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) są zasadniczo statyczne — nie obsługują **żadnych operacji zamiany ciągów** ani wyrażeń regularnych. Możesz jednak skonfigurować parametry przekierowania URL, które wpływają na ich zachowanie podczas dopasowywania URL i ich zachowanie w czasie wykonywania.
{% endhint %}

* [ ] Sprawdź, czy **wyrażenia** i **wymagania** dotyczące przekierowań **mają sens**.
* [ ] Sprawdź również **wrażliwe ukryte punkty końcowe**, które zawierają interesujące informacje.

## Notifications

* [ ] Sprawdź **powiadomienia**. Te powiadomienia są zalecane dla bezpieczeństwa:
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] Sprawdź wszystkie **destynacje**, ponieważ mogą tam być **wrażliwe informacje** (podstawowe uwierzytelnianie http) w URL webhooków. Upewnij się również, że URL webhooków używają **HTTPS**
* [ ] Jako dodatkowe sprawdzenie, możesz spróbować **podszyć się pod powiadomienie cloudflare** do strony trzeciej, może uda ci się jakoś **wstrzyknąć coś niebezpiecznego**

## Manage Account

* [ ] Można zobaczyć **ostatnie 4 cyfry karty kredytowej**, **czas wygaśnięcia** i **adres rozliczeniowy** w **`Billing` -> `Payment info`**.
* [ ] Można zobaczyć **typ planu** używany na koncie w **`Billing` -> `Subscriptions`**.
* [ ] W **`Members`** można zobaczyć wszystkich członków konta i ich **rolę**. Zauważ, że jeśli typ planu nie jest Enterprise, istnieją tylko 2 role: Administrator i Super Administrator. Ale jeśli używany **plan to Enterprise**, [**więcej ról**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) może być używanych zgodnie z zasadą najmniejszych uprawnień.
* Dlatego, jeśli to możliwe, **zaleca się** używanie **planu Enterprise**.
* [ ] W Members można sprawdzić, którzy **członkowie** mają **włączone 2FA**. **Każdy** użytkownik powinien mieć to włączone.

{% hint style="info" %}
Zauważ, że na szczęście rola **`Administrator`** nie daje uprawnień do zarządzania członkostwami (**nie może eskalować uprawnień ani zapraszać** nowych członków)
{% endhint %}

## DDoS Investigation

[Sprawdź tę część](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Sprawdź [**plany subskrypcji**](https://github.com/sponsors/carlospolop)!
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel się trikami hakerskimi, przesyłając PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriów na githubie.

</details>
{% endhint %}
