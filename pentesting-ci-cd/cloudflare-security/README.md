# Cloudflare Security

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

In einem Cloudflare-Konto gibt es einige **allgemeine Einstellungen und Dienste**, die konfiguriert werden k√∂nnen. Auf dieser Seite werden wir die sicherheitsrelevanten Einstellungen jedes Abschnitts **analysieren:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

√úberpr√ºfe jeden mit:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Domain Registration

* [ ] In **`Transfer Domains`** √ºberpr√ºfen, dass es nicht m√∂glich ist, eine Domain zu √ºbertragen.

√úberpr√ºfe jeden mit:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analytics

_Ich konnte nichts finden, was f√ºr eine Sicherheits√ºberpr√ºfung der Konfiguration zu √ºberpr√ºfen w√§re._

## Pages

Auf jeder Cloudflare-Seite:

* [ ] √úberpr√ºfe auf **sensible Informationen** im **`Build log`**.
* [ ] √úberpr√ºfe auf **sensible Informationen** im **Github-Repository**, das den Seiten zugewiesen ist.
* [ ] √úberpr√ºfe auf potenziellen Github-Repo-Kompromiss durch **Workflow-Befehlsinjektion** oder `pull_request_target`-Kompromiss. Mehr Infos auf der [**Github Security Seite**](../github-security/).
* [ ] √úberpr√ºfe auf **verwundbare Funktionen** im `/fuctions`-Verzeichnis (falls vorhanden), √ºberpr√ºfe die **Weiterleitungen** in der `_redirects`-Datei (falls vorhanden) und **fehlkonfigurierte Header** in der `_headers`-Datei (falls vorhanden).
* [ ] √úberpr√ºfe auf **Schwachstellen** in der **Webseite** durch **Blackbox** oder **Whitebox**, wenn du **Zugriff auf den Code** hast.
* [ ] In den Details jeder Seite `/<page_id>/pages/view/blocklist/settings/functions`. √úberpr√ºfe auf **sensible Informationen** in den **`Environment variables`**.
* [ ] In der Detailseite √ºberpr√ºfe auch den **Build-Befehl** und das **Root-Verzeichnis** auf **potenzielle Injektionen**, um die Seite zu kompromittieren.

## **Workers**

√úberpr√ºfe bei jedem Cloudflare-Worker:

* [ ] Die Trigger: Was l√∂st den Worker aus? Kann ein **Benutzer Daten senden**, die vom Worker **verwendet** werden?
* [ ] In den **`Settings`**, √ºberpr√ºfe auf **`Variables`**, die **sensible Informationen** enthalten.
* [ ] √úberpr√ºfe den **Code des Workers** und suche nach **Schwachstellen** (insbesondere an Stellen, an denen der Benutzer die Eingabe verwalten kann).
* √úberpr√ºfe auf SSRFs, die die angegebene Seite zur√ºckgeben, die du kontrollieren kannst.
* √úberpr√ºfe auf XSSs, die JS in einem SVG-Bild ausf√ºhren.
* Es ist m√∂glich, dass der Worker mit anderen internen Diensten interagiert. Zum Beispiel kann ein Worker mit einem R2-Bucket interagieren, der Informationen speichert, die aus der Eingabe gewonnen wurden. In diesem Fall w√§re es notwendig zu √ºberpr√ºfen, welche F√§higkeiten der Worker √ºber den R2-Bucket hat und wie diese aus der Benutzereingabe missbraucht werden k√∂nnten.

{% hint style="warning" %}
Beachte, dass ein **Worker standardm√§√üig eine URL** wie `<worker-name>.<account>.workers.dev` erh√§lt. Der Benutzer kann es auf eine **Subdomain** setzen, aber du kannst immer mit dieser **urspr√ºnglichen URL** darauf zugreifen, wenn du sie kennst.
{% endhint %}

## R2

√úberpr√ºfe bei jedem R2-Bucket:

* [ ] Konfiguriere die **CORS-Policy**.

## Stream

TODO

## Images

TODO

## Security Center

* [ ] Wenn m√∂glich, f√ºhre einen **`Security Insights`** **Scan** und einen **`Infrastructure`** **Scan** durch, da sie sicherheitsrelevante Informationen **hervorheben**.
* [ ] √úberpr√ºfe diese Informationen auf Sicherheitsfehlkonfigurationen und interessante Infos.

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Bulk Redirects

{% hint style="info" %}
Im Gegensatz zu [Dynamic Redirects](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/) sind [**Bulk Redirects**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) im Wesentlichen statisch ‚Äî sie unterst√ºtzen **keine String-Ersatz**-Operationen oder regul√§re Ausdr√ºcke. Du kannst jedoch URL-Weiterleitungsparameter konfigurieren, die ihr URL-Matching-Verhalten und ihr Laufzeitverhalten beeinflussen.
{% endhint %}

* [ ] √úberpr√ºfe, dass die **Ausdr√ºcke** und **Anforderungen** f√ºr Weiterleitungen **Sinn machen**.
* [ ] √úberpr√ºfe auch auf **sensible versteckte Endpunkte**, die interessante Infos enthalten.

## Notifications

* [ ] √úberpr√ºfe die **Benachrichtigungen**. Diese Benachrichtigungen werden f√ºr die Sicherheit empfohlen:
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] √úberpr√ºfe alle **Ziele**, da es **sensible Informationen** (Basic HTTP Auth) in Webhook-URLs geben k√∂nnte. Stelle auch sicher, dass Webhook-URLs **HTTPS** verwenden.
* [ ] Als zus√§tzlichen Check k√∂nntest du versuchen, eine **Cloudflare-Benachrichtigung** an eine dritte Partei zu **imitieren**, vielleicht kannst du irgendwie **etwas Gef√§hrliches injizieren**.

## Manage Account

* [ ] Es ist m√∂glich, die **letzten 4 Ziffern der Kreditkarte**, die **Ablaufzeit** und die **Rechnungsadresse** in **`Billing` -> `Payment info`** zu sehen.
* [ ] Es ist m√∂glich, den **Plan-Typ** zu sehen, der im Konto verwendet wird, in **`Billing` -> `Subscriptions`**.
* [ ] In **`Members`** ist es m√∂glich, alle Mitglieder des Kontos und ihre **Rolle** zu sehen. Beachte, dass, wenn der Plan-Typ nicht Enterprise ist, nur 2 Rollen existieren: Administrator und Super Administrator. Aber wenn der verwendete **Plan Enterprise** ist, k√∂nnen [**mehr Rollen**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) verwendet werden, um dem Prinzip der minimalen Rechte zu folgen.
* Daher wird, wann immer m√∂glich, empfohlen, den **Enterprise-Plan** zu verwenden.
* [ ] In Members ist es m√∂glich zu √ºberpr√ºfen, welche **Mitglieder** **2FA aktiviert** haben. **Jeder** Benutzer sollte es aktiviert haben.

{% hint style="info" %}
Beachte, dass die Rolle **`Administrator`** gl√ºcklicherweise keine Berechtigungen zum Verwalten von Mitgliedschaften gibt (**kann keine Privilegien eskalieren oder neue Mitglieder einladen**).
{% endhint %}

## DDoS Investigation

[√úberpr√ºfe diesen Teil](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
