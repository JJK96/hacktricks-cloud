# TravisCI Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Co to jest TravisCI

**Travis CI** to **hostowana** lub **lokalna** usługa **ciągłej integracji** używana do budowania i testowania projektów oprogramowania hostowanych na kilku **różnych platformach git**.

{% content-ref url="basic-travisci-information.md" %}
[basic-travisci-information.md](basic-travisci-information.md)
{% endcontent-ref %}

## Ataki

### Wyzwalacze

Aby przeprowadzić atak, najpierw musisz wiedzieć, jak wyzwolić build. Domyślnie TravisCI **wyzwala build przy pushach i pull requestach**:

![](<../../.gitbook/assets/image (145).png>)

#### Cron Jobs

Jeśli masz dostęp do aplikacji webowej, możesz **ustawić crony do uruchamiania builda**, co może być przydatne dla utrzymania dostępu lub wyzwalania builda:

![](<../../.gitbook/assets/image (243).png>)

{% hint style="info" %}
Wygląda na to, że nie można ustawić cronów wewnątrz `.travis.yml` zgodnie z [tym](https://github.com/travis-ci/travis-ci/issues/9162).
{% endhint %}

### Third Party PR

TravisCI domyślnie wyłącza udostępnianie zmiennych środowiskowych dla PR-ów pochodzących od osób trzecich, ale ktoś może to włączyć, a wtedy możesz tworzyć PR-y do repozytorium i eksfiltrować sekrety:

![](<../../.gitbook/assets/image (208).png>)

### Dumping Secrets

Jak wyjaśniono na stronie [**basic information**](basic-travisci-information.md), istnieją 2 rodzaje sekretów. **Sekrety zmiennych środowiskowych** (które są wymienione na stronie internetowej) i **niestandardowe zaszyfrowane sekrety**, które są przechowywane w pliku `.travis.yml` jako base64 (zauważ, że oba przechowywane zaszyfrowane będą kończyć jako zmienne środowiskowe na końcowych maszynach).

* Aby **wyenumerować sekrety** skonfigurowane jako **zmienne środowiskowe**, przejdź do **ustawień** **projektu** i sprawdź listę. Należy jednak pamiętać, że wszystkie zmienne środowiskowe projektu ustawione tutaj pojawią się podczas wyzwalania builda.
* Aby wyenumerować **niestandardowe zaszyfrowane sekrety**, najlepiej jest **sprawdzić plik `.travis.yml`**.
* Aby wyenumerować **zaszyfrowane pliki**, możesz sprawdzić **pliki `.enc`** w repozytorium, linie podobne do `openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d` w pliku konfiguracyjnym lub **zaszyfrowane iv i klucze** w **zmiennych środowiskowych**, takich jak:

![](<../../.gitbook/assets/image (81).png>)

### TODO:

* Przykładowy build z reverse shell uruchomionym na Windows/Mac/Linux
* Przykładowy build wyciekający zmienne środowiskowe zakodowane w base64 w logach

### TravisCI Enterprise

Jeśli atakujący znajdzie się w środowisku, które używa **TravisCI enterprise** (więcej informacji na ten temat w [**basic information**](basic-travisci-information.md#travisci-enterprise)), będzie mógł **wyzwalać buildy w Workerze.** Oznacza to, że atakujący będzie mógł poruszać się lateralnie do tego serwera, z którego może być w stanie:

* uciec do hosta?
* skompromitować kubernetes?
* skompromitować inne maszyny działające w tej samej sieci?
* skompromitować nowe poświadczenia chmurowe?

## Referencje

* [https://docs.travis-ci.com/user/encrypting-files/](https://docs.travis-ci.com/user/encrypting-files/)
* [https://docs.travis-ci.com/user/best-practices-security](https://docs.travis-ci.com/user/best-practices-security)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
