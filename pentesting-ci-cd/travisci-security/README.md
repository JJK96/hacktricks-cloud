# TravisCI Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)をフォローする。
* **ハッキングトリックを共有するには、** [**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出。

</details>
{% endhint %}

## What is TravisCI

**Travis CI**は、**ホスト型**または**オンプレミス型**の**継続的インテグレーション**サービスで、複数の**異なるgitプラットフォーム**にホストされているソフトウェアプロジェクトをビルドおよびテストするために使用されます。

{% content-ref url="basic-travisci-information.md" %}
[basic-travisci-information.md](basic-travisci-information.md)
{% endcontent-ref %}

## Attacks

### Triggers

攻撃を開始するには、まずビルドをトリガーする方法を知る必要があります。デフォルトでは、TravisCIは**プッシュおよびプルリクエストでビルドをトリガー**します：

![](<../../.gitbook/assets/image (145).png>)

#### Cron Jobs

Webアプリケーションにアクセスできる場合、**ビルドを実行するためのcronを設定**できます。これは持続性のためやビルドをトリガーするために役立ちます：

![](<../../.gitbook/assets/image (243).png>)

{% hint style="info" %}
[こちら](https://github.com/travis-ci/travis-ci/issues/9162)によると、`.travis.yml`内にcronを設定することはできないようです。
{% endhint %}

### Third Party PR

TravisCIはデフォルトでサードパーティからのPRと環境変数の共有を無効にしていますが、誰かがそれを有効にすると、リポジトリにPRを作成して秘密情報を流出させることができます：

![](<../../.gitbook/assets/image (208).png>)

### Dumping Secrets

[**基本情報**](basic-travisci-information.md)ページで説明されているように、秘密情報には2種類あります。**環境変数の秘密情報**（Webページにリストされている）と**カスタム暗号化された秘密情報**で、これらは`.travis.yml`ファイル内にbase64形式で保存されます（どちらも暗号化されて保存され、最終的なマシンでは環境変数として終了します）。

* **環境変数として設定された秘密情報を列挙する**には、**プロジェクトの設定**に移動してリストを確認します。ただし、ここで設定されたすべてのプロジェクト環境変数はビルドをトリガーすると表示されます。
* **カスタム暗号化された秘密情報を列挙する**には、**`.travis.yml`ファイルを確認**するのが最善です。
* **暗号化されたファイルを列挙する**には、リポジトリ内の**`.enc`ファイル**、設定ファイル内の`openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d`に類似した行、または**環境変数**内の**暗号化されたivとキー**を確認します：

![](<../../.gitbook/assets/image (81).png>)

### TODO:

* Windows/Mac/Linuxでリバースシェルを実行するビルドの例
* ログにbase64エンコードされた環境変数を漏洩させるビルドの例

### TravisCI Enterprise

攻撃者が**TravisCI enterprise**を使用している環境に侵入した場合（詳細は[**基本情報**](basic-travisci-information.md#travisci-enterprise)を参照）、**Workerでビルドをトリガー**することができます。これは、攻撃者がそのサーバーに横移動できることを意味し、そこから以下のことが可能になるかもしれません：

* ホストにエスケープ？
* Kubernetesを侵害？
* 同じネットワーク内で実行されている他のマシンを侵害？
* 新しいクラウド認証情報を侵害？

## References

* [https://docs.travis-ci.com/user/encrypting-files/](https://docs.travis-ci.com/user/encrypting-files/)
* [https://docs.travis-ci.com/user/best-practices-security](https://docs.travis-ci.com/user/best-practices-security)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)をフォローする。
* **ハッキングトリックを共有するには、** [**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出。

</details>
{% endhint %}
