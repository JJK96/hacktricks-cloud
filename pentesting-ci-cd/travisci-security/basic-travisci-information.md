# Basic TravisCI Information

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)をフォローしてください。
* **PRを提出してハッキングトリックを共有する** [**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリに。

</details>
{% endhint %}

## Access

TravisCIは、Github、Bitbucket、Assembla、Gitlabなどの異なるgitプラットフォームと直接統合します。ユーザーにTravisCIにアクセス許可を与えて、TravisCIと統合したいリポジトリにアクセスさせるように求めます。

例えば、Githubでは以下の権限を求めます：

* `user:email` (読み取り専用)
* `read:org` (読み取り専用)
* `repo`: 公開および非公開のリポジトリと組織のコード、コミットステータス、コラボレーター、デプロイメントステータスへの読み取りおよび書き込みアクセスを許可します。

## Encrypted Secrets

### Environment Variables

TravisCIでは、他のCIプラットフォームと同様に、**リポジトリレベルのシークレットを保存**することが可能で、これらは暗号化されて保存され、ビルドを実行するマシンの環境変数に**復号化されてプッシュ**されます。

![](<../../.gitbook/assets/image (203).png>)

**シークレットが利用可能なブランチ**（デフォルトではすべて）を指定することが可能で、またTravisCIが**ログに表示された場合にその値を隠す**かどうか（デフォルトでは隠す）も指定できます。

### Custom Encrypted Secrets

**各リポジトリ**に対してTravisCIは**RSAキーペア**を生成し、**秘密鍵**を保持し、リポジトリに**アクセス**できる人に**公開鍵**を提供します。

以下のコマンドでリポジトリの公開鍵にアクセスできます：
```
travis pubkey -r <owner>/<repo_name>
travis pubkey -r carlospolop/t-ci-test
```
次に、このセットアップを使用して**秘密情報を暗号化し、それらを `.travis.yaml` に追加**できます。ビルドが実行されると**秘密情報は復号化され**、**環境変数**でアクセス可能になります。

![](<../../.gitbook/assets/image (139).png>)

この方法で暗号化された秘密情報は、設定の環境変数リストには表示されないことに注意してください。

### Custom Encrypted Files

前述の方法と同様に、TravisCI では**ファイルを暗号化し、ビルド中にそれらを復号化**することもできます:
```
travis encrypt-file super_secret.txt -r carlospolop/t-ci-test

encrypting super_secret.txt for carlospolop/t-ci-test
storing result as super_secret.txt.enc
storing secure env variables for decryption

Please add the following to your build script (before_install stage in your .travis.yml, for instance):

openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d

Pro Tip: You can add it automatically by running with --add.

Make sure to add super_secret.txt.enc to the git repository.
Make sure not to add super_secret.txt to the git repository.
Commit all changes to your .travis.yml.
```
ファイルを暗号化する際に、2つのEnv Variablesがリポジトリ内に設定されることに注意してください:

![](<../../.gitbook/assets/image (170).png>)

## TravisCI Enterprise

Travis CI Enterpriseは、**Travis CIのオンプレミスバージョン**であり、**自分のインフラストラクチャにデプロイ**できます。Travis CIの「サーバー」バージョンと考えてください。Travis CIを使用すると、環境内で使いやすいContinuous Integration/Continuous Deployment (CI/CD)システムを有効にすることができ、自由に設定およびセキュリティを確保できます。

**Travis CI Enterpriseは2つの主要な部分で構成されています:**

1. TCI **サービス**（またはTCIコアサービス）、バージョン管理システムとの統合、ビルドの認証、ビルドジョブのスケジューリングなどを担当。
2. TCI **Worker**およびビルド環境イメージ（OSイメージとも呼ばれる）。

**TCIコアサービスには以下が必要です:**

1. **PostgreSQL11**（またはそれ以降）のデータベース。
2. Kubernetesクラスターをデプロイするためのインフラストラクチャ。必要に応じてサーバークラスターまたは単一のマシンにデプロイ可能。
3. セットアップに応じて、RabbitMQなどのコンポーネントを自分でデプロイおよび設定することを検討するかもしれません。詳細は[Setting up Travis CI Enterprise](https://docs.travis-ci.com/user/enterprise/tcie-3.x-setting-up-travis-ci-enterprise/)を参照してください。

**TCI Workerには以下が必要です:**

1. **Workerとリンクされたビルドイメージを含むdockerイメージをデプロイできるインフラストラクチャ**。
2. 特定のTravis CIコアサービスコンポーネントへの接続性 - 詳細は[Setting Up Worker](https://docs.travis-ci.com/user/enterprise/setting-up-worker/)を参照してください。

デプロイされたTCI Workerおよびビルド環境OSイメージの量が、インフラストラクチャ内のTravis CI Enterpriseデプロイメントの総同時実行容量を決定します。

![](<../../.gitbook/assets/image (199).png>)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)をフォローしてください。
* **PRを提出してハッキングトリックを共有** [**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリに。

</details>
{% endhint %}
