# Gitea Security

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## Was ist Gitea

**Gitea** ist eine **selbstgehostete, community-gemanagte, leichtgewichtige Code-Hosting**-L√∂sung, die in Go geschrieben ist.

![](<../../.gitbook/assets/image (160).png>)

### Grundlegende Informationen

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Labor

Um eine Gitea-Instanz lokal auszuf√ºhren, kannst du einfach einen Docker-Container starten:
```bash
docker run -p 3000:3000 gitea/gitea
```
Verbinden Sie sich mit Port 3000, um auf die Webseite zuzugreifen.

Sie k√∂nnten es auch mit Kubernetes ausf√ºhren:
```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```
## Unauthenticated Enumeration

* √ñffentliche Repos: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Registrierte Benutzer: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Registrierte Organisationen: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

Beachten Sie, dass **Gitea standardm√§√üig neuen Benutzern die Registrierung erlaubt**. Dies gibt den neuen Benutzern keinen besonders interessanten Zugriff auf die Repos anderer Organisationen/Benutzer, aber ein **eingeloggter Benutzer** k√∂nnte in der Lage sein, **mehr Repos oder Organisationen zu visualisieren**.

## Internal Exploitation

F√ºr dieses Szenario nehmen wir an, dass Sie Zugang zu einem github-Konto erhalten haben.

### Mit Benutzeranmeldedaten/Web-Cookie

Wenn Sie irgendwie bereits Anmeldedaten f√ºr einen Benutzer innerhalb einer Organisation haben (oder Sie haben ein Sitzungscookie gestohlen), k√∂nnen Sie sich **einfach einloggen** und √ºberpr√ºfen, welche **Berechtigungen Sie haben** √ºber welche **Repos,** in **welchen Teams** Sie sind, **andere Benutzer auflisten**, und **wie die Repos gesch√ºtzt sind.**

Beachten Sie, dass **2FA verwendet werden kann**, sodass Sie nur auf diese Informationen zugreifen k√∂nnen, wenn Sie auch **diese √úberpr√ºfung bestehen**.

{% hint style="info" %}
Beachten Sie, dass wenn Sie es **schaffen, das `i_like_gitea`-Cookie zu stehlen** (derzeit mit SameSite: Lax konfiguriert), k√∂nnen Sie den **Benutzer vollst√§ndig imitieren**, ohne Anmeldedaten oder 2FA zu ben√∂tigen.
{% endhint %}

### Mit Benutzer-SSH-Schl√ºssel

Gitea erlaubt **Benutzern**, **SSH-Schl√ºssel** zu setzen, die als **Authentifizierungsmethode verwendet werden, um Code in ihrem Namen zu deployen** (es wird keine 2FA angewendet).

Mit diesem Schl√ºssel k√∂nnen Sie **√Ñnderungen in Repositories vornehmen, in denen der Benutzer einige Privilegien hat**, jedoch k√∂nnen Sie ihn nicht verwenden, um auf die gitea-API zuzugreifen, um die Umgebung zu enumerieren. Sie k√∂nnen jedoch **lokale Einstellungen enumerieren**, um Informationen √ºber die Repos und Benutzer zu erhalten, auf die Sie Zugriff haben:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Wenn der Benutzer seinen Benutzernamen als seinen gitea-Benutzernamen konfiguriert hat, k√∂nnen Sie auf die **√∂ffentlichen Schl√ºssel, die er in seinem Konto gesetzt hat**, unter _https://github.com/\<gitea\_username>.keys_ zugreifen. Sie k√∂nnten dies √ºberpr√ºfen, um zu best√§tigen, dass der gefundene private Schl√ºssel verwendet werden kann.

**SSH-Schl√ºssel** k√∂nnen auch in Repositories als **Deploy-Schl√ºssel** gesetzt werden. Jeder, der Zugriff auf diesen Schl√ºssel hat, kann **Projekte aus einem Repository starten**. Normalerweise gibt die lokale Datei **`~/.ssh/config`** auf einem Server mit verschiedenen Deploy-Schl√ºsseln Informationen dar√ºber, welcher Schl√ºssel zugeordnet ist.

#### GPG-Schl√ºssel

Wie [**hier**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/gitea-security/broken-reference/README.md) erkl√§rt, ist es manchmal notwendig, die Commits zu signieren, oder Sie k√∂nnten entdeckt werden.

√úberpr√ºfen Sie lokal, ob der aktuelle Benutzer einen Schl√ºssel hat mit:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Mit Benutzer-Token

F√ºr eine Einf√ºhrung zu [**Benutzer-Token, siehe die grundlegenden Informationen**](basic-gitea-information.md#personal-access-tokens).

Ein Benutzer-Token kann **anstelle eines Passworts** verwendet werden, um sich **gegen den Gitea-Server zu authentifizieren** [**via API**](https://try.gitea.io/api/swagger#/). Es hat **vollst√§ndigen Zugriff** auf den Benutzer.

### Mit Oauth-Anwendung

F√ºr eine Einf√ºhrung zu [**Gitea Oauth-Anwendungen, siehe die grundlegenden Informationen**](./#with-oauth-application).

Ein Angreifer k√∂nnte eine **b√∂sartige Oauth-Anwendung** erstellen, um auf privilegierte Daten/Aktionen der Benutzer zuzugreifen, die sie wahrscheinlich im Rahmen einer Phishing-Kampagne akzeptieren.

Wie in den grundlegenden Informationen erkl√§rt, hat die Anwendung **vollst√§ndigen Zugriff auf das Benutzerkonto**.

### Branch-Schutz-Umgehung

In Github haben wir **github actions**, die standardm√§√üig ein **Token mit Schreibzugriff** auf das Repository erhalten, das verwendet werden kann, um **Branch-Schutzma√ünahmen zu umgehen**. In diesem Fall **existiert das nicht**, daher sind die Umgehungen begrenzter. Aber schauen wir uns an, was getan werden kann:

* **Push aktivieren**: Wenn jemand mit Schreibzugriff auf den Branch pushen kann, einfach pushen.
* **Whitelist-Eingeschr√§nkter Push**: Ebenso, wenn Sie Teil dieser Liste sind, pushen Sie auf den Branch.
* **Merge-Whitelist aktivieren**: Wenn es eine Merge-Whitelist gibt, m√ºssen Sie darin sein.
* **Erforderliche Genehmigungen gr√∂√üer als 0**: Dann... m√ºssen Sie einen anderen Benutzer kompromittieren.
* **Genehmigungen auf Whitelist beschr√§nken**: Wenn nur Benutzer auf der Whitelist genehmigen k√∂nnen... m√ºssen Sie einen anderen Benutzer kompromittieren, der auf dieser Liste steht.
* **Veraltete Genehmigungen aufheben**: Wenn Genehmigungen bei neuen Commits nicht entfernt werden, k√∂nnten Sie eine bereits genehmigte PR kapern, um Ihren Code einzuschleusen und die PR zu mergen.

Beachten Sie, dass **wenn Sie ein Org/Repo-Admin sind**, k√∂nnen Sie die Schutzma√ünahmen umgehen.

### Webhooks auflisten

**Webhooks** k√∂nnen **spezifische Gitea-Informationen an bestimmte Orte senden**. Sie k√∂nnten in der Lage sein, **diese Kommunikation auszunutzen**.\
Normalerweise wird jedoch ein **Geheimnis** gesetzt, das Sie **nicht abrufen** k√∂nnen, um externe Benutzer, die die URL des Webhooks kennen, aber nicht das Geheimnis, daran zu hindern, **diesen Webhook auszunutzen**.\
Aber in einigen F√§llen setzen Leute das **Geheimnis** nicht an die richtige Stelle, sondern **in die URL** als Parameter, sodass **das √úberpr√ºfen der URLs** Ihnen erm√∂glichen k√∂nnte, **Geheimnisse** und andere Orte zu finden, die Sie weiter ausnutzen k√∂nnten.

Webhooks k√∂nnen auf **Repo- und Org-Ebene** gesetzt werden.

## Post-Exploitation

### Innerhalb des Servers

Wenn Sie es irgendwie geschafft haben, in den Server zu gelangen, auf dem Gitea l√§uft, sollten Sie nach der Gitea-Konfigurationsdatei suchen. Standardm√§√üig befindet sie sich in `/data/gitea/conf/app.ini`.

In dieser Datei k√∂nnen Sie **Schl√ºssel** und **Passw√∂rter** finden.

Im Gitea-Pfad (standardm√§√üig: /data/gitea) k√∂nnen Sie auch interessante Informationen finden wie:

* Die **sqlite** DB: Wenn Gitea keine externe DB verwendet, wird es eine sqlite DB verwenden.
* Die **Sitzungen** im Sitzungsordner: Durch Ausf√ºhren von `cat sessions/*/*/*` k√∂nnen Sie die Benutzernamen der angemeldeten Benutzer sehen (Gitea k√∂nnte die Sitzungen auch in der DB speichern).
* Der **jwt private key** im jwt-Ordner.
* Weitere **sensible Informationen** k√∂nnten in diesem Ordner gefunden werden.

Wenn Sie sich auf dem Server befinden, k√∂nnen Sie auch **das `gitea`-Binary** verwenden, um auf Informationen zuzugreifen/Informationen zu √§ndern:

* `gitea dump` wird Gitea dumpen und eine .zip-Datei erstellen.
* `gitea generate secret INTERNAL_TOKEN/JWT_SECRET/SECRET_KEY/LFS_JWT_SECRET` wird ein Token des angegebenen Typs generieren (Persistenz).
* `gitea admin user change-password --username admin --password newpassword` √Ñndert das Passwort.
* `gitea admin user create --username newuser --password superpassword --email user@user.user --admin --access-token` Erstellt einen neuen Admin-Benutzer und erh√§lt ein Zugriffstoken.

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichen.

</details>
{% endhint %}
