# Gitea Security

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Wat is Gitea

**Gitea** is 'n **self-gasheer gemeenskapsbestuurde liggewig kode hosting** oplossing geskryf in Go.

![](<../../.gitbook/assets/image (160).png>)

### Basiese Inligting

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Laboratorium

Om 'n Gitea-instansie plaaslik te laat loop, kan jy net 'n docker-houer laat loop:
```bash
docker run -p 3000:3000 gitea/gitea
```
Koppel aan poort 3000 om toegang tot die webblad te kry.

Jy kan dit ook met kubernetes laat loop:
```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```
## Onauthentiseerde Enumerasie

* Publieke repos: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Geregistreerde gebruikers: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Geregistreerde Organisasies: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

Let daarop dat **Gitea standaard nuwe gebruikers toelaat om te registreer**. Dit sal nie spesiaal interessante toegang aan die nuwe gebruikers oor ander organisasies/gebruikers se repos gee nie, maar 'n **aangemelde gebruiker** mag dalk in staat wees om **meer repos of organisasies te visualiseer**.

## Interne Eksploitasie

Vir hierdie scenario gaan ons veronderstel dat jy toegang tot 'n github-rekening verkry het.

### Met Gebruiker Kredensiale/Webkoekie

As jy op een of ander manier reeds kredensiale het vir 'n gebruiker binne 'n organisasie (of jy het 'n sessiekoekie gesteel) kan jy **net aanmeld** en kyk watter **toestemmings jy het** oor watter **repos,** in **watter spanne** jy is, **ander gebruikers lys**, en **hoe die repos beskerm is.**

Let daarop dat **2FA gebruik mag word** so jy sal slegs toegang tot hierdie inligting h√™ as jy ook daardie **kontrole kan slaag**.

{% hint style="info" %}
Let daarop dat as jy **die `i_like_gitea` koekie kan steel** (tans gekonfigureer met SameSite: Lax) jy die **gebruiker heeltemal kan naboots** sonder om kredensiale of 2FA nodig te h√™.
{% endhint %}

### Met Gebruiker SSH Sleutel

Gitea laat **gebruikers** toe om **SSH sleutels** te stel wat gebruik sal word as **verifikasie metode om kode te ontplooi** namens hulle (geen 2FA word toegepas nie).

Met hierdie sleutel kan jy **veranderings aanbring in repositories waar die gebruiker sekere voorregte het**, maar jy kan dit nie gebruik om toegang tot gitea api te kry om die omgewing te enumerate nie. Jy kan egter **lokale instellings enumerate** om inligting oor die repos en gebruiker waartoe jy toegang het, te kry:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
As die gebruiker sy gebruikersnaam as sy gitea gebruikersnaam gekonfigureer het, kan jy toegang kry tot die **publieke sleutels wat hy ingestel het** in sy rekening by _https://github.com/\<gitea\_username>.keys_, jy kan dit nagaan om te bevestig dat die privaat sleutel wat jy gevind het gebruik kan word.

**SSH sleutels** kan ook in bewaarplekke ingestel word as **ontplooi sleutels**. Enigeen met toegang tot hierdie sleutel sal in staat wees om **projekte van 'n bewaarplek te loods**. Gewoonlik in 'n bediener met verskillende ontplooi sleutels sal die plaaslike l√™er **`~/.ssh/config`** jou inligting gee oor watter sleutel verwant is.

#### GPG Sleutels

Soos verduidelik [**hier**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/gitea-security/broken-reference/README.md) is dit soms nodig om die commits te teken anders mag jy ontdek word.

Kyk plaaslik of die huidige gebruiker enige sleutel het met:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Met Gebruikerstoken

Vir 'n inleiding oor [**Gebruikerstokens, kyk die basiese inligting**](basic-gitea-information.md#personal-access-tokens).

'n Gebruikerstoken kan gebruik word **in plaas van 'n wagwoord** om **te verifieer** teen die Gitea-bediener [**via API**](https://try.gitea.io/api/swagger#/). Dit sal **volledige toegang** oor die gebruiker h√™.

### Met Oauth-toepassing

Vir 'n inleiding oor [**Gitea Oauth-toepassings, kyk die basiese inligting**](./#with-oauth-application).

'n Aanvaller kan 'n **kwaadwillige Oauth-toepassing** skep om bevoorregte data/aksies van die gebruikers wat dit aanvaar, waarskynlik as deel van 'n phishing-veldtog, te bekom.

Soos verduidelik in die basiese inligting, sal die toepassing **volle toegang oor die gebruikersrekening** h√™.

### Takbeskerming Omseil

In Github het ons **github actions** wat standaard 'n **token met skryftoegang** oor die repo kry wat gebruik kan word om **takbeskermings te omseil**. In hierdie geval bestaan dit **nie**, so die omseilings is meer beperk. Maar kom ons kyk wat gedoen kan word:

* **Aktiveer Push**: As enigiemand met skryftoegang na die tak kan stoot, stoot net daarna.
* **Witlys Beperkte Push**: Op dieselfde manier, as jy deel is van hierdie lys, stoot na die tak.
* **Aktiveer Merge Witlys**: As daar 'n merge witlys is, moet jy binne dit wees.
* **Vereis goedkeurings is groter as 0**: Dan... moet jy 'n ander gebruiker kompromitteer.
* **Beperk goedkeurings tot witlys**: As slegs witlysgebruikers kan goedkeur... moet jy 'n ander gebruiker kompromitteer wat binne daardie lys is.
* **Verwerp verouderde goedkeurings**: As goedkeurings nie verwyder word met nuwe commits nie, kan jy 'n reeds goedgekeurde PR kaap om jou kode in te voeg en die PR te merge.

Let daarop dat **as jy 'n org/repo admin is** jy die beskermings kan omseil.

### Webhooks Opnoem

**Webhooks** kan **spesifieke gitea-inligting na sommige plekke stuur**. Jy mag in staat wees om daardie kommunikasie te **eksploiteer**.\
Maar gewoonlik is 'n **geheim** wat jy **nie kan herwin nie** ingestel in die **webhook** wat **voorkom** dat eksterne gebruikers wat die URL van die webhook ken maar nie die geheim nie, daardie **webhook kan eksploiteer**.\
Maar in sommige gevalle, in plaas daarvan om die **geheim** op sy plek te stel, stel mense dit **in die URL** as 'n parameter, so **deur die URL's na te gaan** kan jy **geheime** en ander plekke vind wat jy verder kan eksploiteer.

Webhooks kan ingestel word op **repo- en org-vlak**.

## Na-eksploitasie

### Binne die bediener

As jy op een of ander manier binne die bediener gekom het waar gitea loop, moet jy soek na die gitea-konfigurasiel√™er. Standaard is dit gele√´ in `/data/gitea/conf/app.ini`

In hierdie l√™er kan jy **sleutels** en **wagwoorde** vind.

In die gitea-pad (standaard: /data/gitea) kan jy ook interessante inligting vind soos:

* Die **sqlite** DB: As gitea nie 'n eksterne db gebruik nie, sal dit 'n sqlite db gebruik.
* Die **sessies** binne die sessies-l√™ergids: Deur `cat sessions/*/*/*` te hardloop, kan jy die gebruikersname van die aangemelde gebruikers sien (gitea kan ook die sessies binne die DB stoor).
* Die **jwt private sleutel** binne die jwt-l√™ergids.
* Meer **sensitiewe inligting** kan in hierdie l√™ergids gevind word.

As jy binne die bediener is, kan jy ook die **`gitea`-binary gebruik** om toegang tot inligting te kry of dit te wysig:

* `gitea dump` sal gitea dump en 'n .zip-l√™er genereer.
* `gitea generate secret INTERNAL_TOKEN/JWT_SECRET/SECRET_KEY/LFS_JWT_SECRET` sal 'n token van die aangeduide tipe genereer (volharding).
* `gitea admin user change-password --username admin --password newpassword` Verander die wagwoord.
* `gitea admin user create --username newuser --password superpassword --email user@user.user --admin --access-token` Skep 'n nuwe admin gebruiker en kry 'n toegangstoken.

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repo's.

</details>
{% endhint %}
