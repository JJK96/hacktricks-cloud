# Gitea Security

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking öğrenin ve pratik yapın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'ı takip edin.**
* **HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına PR göndererek hacking ipuçlarını paylaşın.

</details>
{% endhint %}

## Gitea Nedir

**Gitea**, Go ile yazılmış **topluluk tarafından yönetilen hafif bir kod barındırma** çözümüdür.

![](<../../.gitbook/assets/image (160).png>)

### Temel Bilgiler

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Lab

Yerel olarak bir Gitea örneği çalıştırmak için sadece bir docker konteyneri çalıştırabilirsiniz:
```bash
docker run -p 3000:3000 gitea/gitea
```
Port 3000'e bağlanarak web sayfasına erişebilirsiniz.

Ayrıca bunu kubernetes ile de çalıştırabilirsiniz:
```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```
## Kimlik Doğrulaması Olmadan Numaralandırma

* Public repos: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Registered users: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Registered Organizations: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

**Gitea'nın varsayılan olarak yeni kullanıcıların kayıt olmasına izin verdiğini** unutmayın. Bu, yeni kullanıcılara diğer organizasyonlar/kullanıcılar üzerindeki repolara özel bir erişim sağlamaz, ancak **giriş yapmış bir kullanıcı** **daha fazla repo veya organizasyonu** görebilir.

## Dahili Sömürü

Bu senaryoda bir github hesabına bir şekilde erişim sağladığınızı varsayacağız.

### Kullanıcı Kimlik Bilgileri/Web Çerezi ile

Bir organizasyon içindeki bir kullanıcı için kimlik bilgilerine (veya bir oturum çerezini çaldıysanız) sahipseniz, **sadece giriş yapabilir** ve **hangi izinlere sahip olduğunuzu**, **hangi repolarda**, **hangi takımlarda** olduğunuzu, **diğer kullanıcıları listeleyebilir** ve **repolar nasıl korunuyor** kontrol edebilirsiniz.

**2FA kullanılabilir** olduğunu unutmayın, bu nedenle bu bilgilere yalnızca bu kontrolü de geçebilirseniz erişebilirsiniz.

{% hint style="info" %}
**`i_like_gitea` çerezini çalmayı başarırsanız** (şu anda SameSite: Lax ile yapılandırılmış) **kullanıcıyı tamamen taklit edebilir** ve kimlik bilgilerine veya 2FA'ya ihtiyaç duymadan giriş yapabilirsiniz.
{% endhint %}

### Kullanıcı SSH Anahtarı ile

Gitea, **kullanıcıların** **SSH anahtarları** ayarlamasına izin verir, bu anahtarlar **kod dağıtımı için kimlik doğrulama yöntemi** olarak kullanılır (2FA uygulanmaz).

Bu anahtar ile **kullanıcının bazı ayrıcalıklara sahip olduğu repolarda değişiklikler yapabilirsiniz**, ancak gitea api'ye erişmek için kullanamazsınız. Ancak, **erişiminiz olan repolar ve kullanıcı hakkında bilgi almak için yerel ayarları numaralandırabilirsiniz**:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Eğer kullanıcı, kullanıcı adını gitea kullanıcı adı olarak yapılandırdıysa, hesabında ayarladığı **açık anahtarlara** _https://github.com/\<gitea\_username>.keys_ adresinden erişebilirsiniz, bulduğunuz özel anahtarın kullanılabilir olduğunu doğrulamak için bunu kontrol edebilirsiniz.

**SSH anahtarları** ayrıca depolarda **deploy keys** olarak da ayarlanabilir. Bu anahtara erişimi olan herkes bir depodan **projeleri başlatabilir**. Genellikle farklı deploy keys olan bir sunucuda yerel dosya **`~/.ssh/config`** size hangi anahtarın ilgili olduğu hakkında bilgi verecektir.

#### GPG Keys

[**Burada**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/gitea-security/broken-reference/README.md) açıklandığı gibi bazen commit'leri imzalamak gerekebilir veya keşfedilebilirsiniz.

Mevcut kullanıcının herhangi bir anahtarı olup olmadığını yerel olarak kontrol edin:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Kullanıcı Tokeni ile

[**Kullanıcı Tokenleri hakkında temel bilgileri**](basic-gitea-information.md#personal-access-tokens) inceleyin.

Bir kullanıcı tokeni, Gitea sunucusuna [**API üzerinden**](https://try.gitea.io/api/swagger#/) **kimlik doğrulama** yapmak için **şifre yerine** kullanılabilir. Bu, kullanıcı üzerinde **tam erişim** sağlar.

### Oauth Uygulaması ile

[**Gitea Oauth Uygulamaları hakkında temel bilgileri**](./#with-oauth-application) inceleyin.

Bir saldırgan, kullanıcıların kabul ettiği **kötü niyetli bir Oauth Uygulaması** oluşturabilir ve bu uygulama muhtemelen bir phishing kampanyasının parçası olarak ayrıcalıklı verilere/eylemlere erişebilir.

Temel bilgilerde açıklandığı gibi, uygulama **kullanıcı hesabı üzerinde tam erişime** sahip olacaktır.

### Branch Koruma Atlatma

Github'da, varsayılan olarak repo üzerinde **yazma erişimi olan bir token** alan **github actions** vardır ve bu, **branch korumalarını atlatmak** için kullanılabilir. Bu durumda bu **mevcut değil**, bu yüzden atlatmalar daha sınırlıdır. Ama neler yapılabileceğine bir göz atalım:

* **Push Etkinleştir**: Yazma erişimi olan biri branch'e push yapabiliyorsa, sadece push yapın.
* **Whitelist Kısıtlı Push**: Aynı şekilde, bu listenin bir parçasıysanız branch'e push yapın.
* **Merge Whitelist Etkinleştir**: Bir merge whitelist varsa, içinde olmanız gerekir.
* **Onay gereksinimi 0'dan büyükse**: O zaman... başka bir kullanıcıyı ele geçirmeniz gerekir.
* **Onayları whitelist ile kısıtla**: Sadece whitelist kullanıcıları onaylayabiliyorsa... bu listenin içinde olan başka bir kullanıcıyı ele geçirmeniz gerekir.
* **Eski onayları reddet**: Onaylar yeni commitlerle kaldırılmıyorsa, zaten onaylanmış bir PR'ı ele geçirip kodunuzu enjekte edebilir ve PR'ı birleştirebilirsiniz.

**Eğer bir org/repo yöneticisiyseniz** korumaları atlatabileceğinizi unutmayın.

### Webhookları Numaralandırma

**Webhooklar**, **belirli gitea bilgilerini bazı yerlere gönderebilir**. Bu iletişimi **istismar edebilirsiniz**.\
Ancak, genellikle **geri alınamayan bir gizli anahtar** webhookta ayarlanır ve bu, URL'yi bilen ancak gizli anahtarı bilmeyen dış kullanıcıların **webhooku istismar etmesini** engeller.\
Ama bazı durumlarda, insanlar **gizli anahtarı** yerine **URL'ye** bir parametre olarak ayarlarlar, bu yüzden **URL'leri kontrol etmek** size **gizli anahtarları** ve daha fazla istismar edebileceğiniz yerleri bulmanızı sağlayabilir.

Webhooklar **repo ve org seviyesinde** ayarlanabilir.

## İstismar Sonrası

### Sunucunun İçinde

Eğer bir şekilde gitea'nın çalıştığı sunucunun içine girmeyi başardıysanız, gitea yapılandırma dosyasını aramalısınız. Varsayılan olarak `/data/gitea/conf/app.ini` konumundadır.

Bu dosyada **anahtarlar** ve **şifreler** bulabilirsiniz.

Gitea yolunda (varsayılan: /data/gitea) ayrıca ilginç bilgiler bulabilirsiniz, örneğin:

* **sqlite** DB: Eğer gitea harici bir db kullanmıyorsa, bir sqlite db kullanacaktır.
* Oturum klasörünün içindeki **oturumlar**: `cat sessions/*/*/*` komutunu çalıştırarak oturum açmış kullanıcıların kullanıcı adlarını görebilirsiniz (gitea oturumları DB içinde de saklayabilir).
* jwt klasörünün içindeki **jwt özel anahtarı**
* Bu klasörde daha fazla **hassas bilgi** bulunabilir.

Sunucunun içindeyseniz, ayrıca **`gitea` binary'sini** kullanarak bilgiye erişebilir/değiştirebilirsiniz:

* `gitea dump` gitea'yı döker ve bir .zip dosyası oluşturur.
* `gitea generate secret INTERNAL_TOKEN/JWT_SECRET/SECRET_KEY/LFS_JWT_SECRET` belirtilen türde bir token oluşturur (kalıcılık).
* `gitea admin user change-password --username admin --password newpassword` Şifreyi değiştirir.
* `gitea admin user create --username newuser --password superpassword --email user@user.user --admin --access-token` Yeni bir admin kullanıcı oluşturur ve bir erişim tokeni alır.

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking öğrenin ve pratik yapın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'ı takip edin.**
* **HackTricks'e PR göndererek hacking ipuçlarını paylaşın** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına.

</details>
{% endhint %}
