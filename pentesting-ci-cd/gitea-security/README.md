# Gitea Security

{% hint style="success" %}
Μάθετε και εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε και εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Δείτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Γίνετε μέλος της** 💬 [**ομάδας Discord**](https://discord.gg/hRep4RUj7f) ή της [**ομάδας telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}

## Τι είναι το Gitea

Το **Gitea** είναι μια **ελαφριά λύση φιλοξενίας κώδικα που διαχειρίζεται η κοινότητα και φιλοξενείται τοπικά**, γραμμένη σε Go.

![](<../../.gitbook/assets/image (160).png>)

### Βασικές Πληροφορίες

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Εργαστήριο

Για να τρέξετε μια τοπική εγκατάσταση του Gitea, μπορείτε απλά να τρέξετε ένα docker container:
```bash
docker run -p 3000:3000 gitea/gitea
```
Συνδεθείτε στη θύρα 3000 για να αποκτήσετε πρόσβαση στη σελίδα web.

Μπορείτε επίσης να το εκτελέσετε με kubernetes:
```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```
## Μη Αυθεντικοποιημένη Καταμέτρηση

* Δημόσια repos: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Εγγεγραμμένοι χρήστες: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Εγγεγραμμένες Οργανώσεις: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

Σημειώστε ότι από **προεπιλογή το Gitea επιτρέπει την εγγραφή νέων χρηστών**. Αυτό δεν θα δώσει ιδιαίτερα ενδιαφέρουσα πρόσβαση στους νέους χρήστες σε repos άλλων οργανώσεων/χρηστών, αλλά ένας **συνδεδεμένος χρήστης** μπορεί να είναι σε θέση να **δει περισσότερα repos ή οργανώσεις**.

## Εσωτερική Εκμετάλλευση

Για αυτό το σενάριο θα υποθέσουμε ότι έχετε αποκτήσει κάποια πρόσβαση σε έναν λογαριασμό github.

### Με Διαπιστευτήρια Χρήστη/Web Cookie

Αν με κάποιο τρόπο έχετε ήδη διαπιστευτήρια για έναν χρήστη μέσα σε μια οργάνωση (ή κλέψατε ένα session cookie) μπορείτε **απλά να συνδεθείτε** και να ελέγξετε ποιες **άδειες έχετε** σε ποια **repos**, σε ποιες **ομάδες** είστε, **να καταγράψετε άλλους χρήστες**, και **πώς προστατεύονται τα repos.**

Σημειώστε ότι μπορεί να χρησιμοποιείται **2FA** οπότε θα μπορείτε να έχετε πρόσβαση σε αυτές τις πληροφορίες μόνο αν μπορείτε επίσης να **περάσετε αυτόν τον έλεγχο**.

{% hint style="info" %}
Σημειώστε ότι αν **καταφέρετε να κλέψετε το `i_like_gitea` cookie** (επί του παρόντος διαμορφωμένο με SameSite: Lax) μπορείτε **να υποδυθείτε πλήρως τον χρήστη** χωρίς να χρειάζεστε διαπιστευτήρια ή 2FA.
{% endhint %}

### Με SSH Key Χρήστη

Το Gitea επιτρέπει στους **χρήστες** να ορίσουν **SSH keys** που θα χρησιμοποιούνται ως **μέθοδος αυθεντικοποίησης για την ανάπτυξη κώδικα** εκ μέρους τους (δεν εφαρμόζεται 2FA).

Με αυτό το κλειδί μπορείτε να κάνετε **αλλαγές σε repositories όπου ο χρήστης έχει κάποια προνόμια**, ωστόσο δεν μπορείτε να το χρησιμοποιήσετε για πρόσβαση στο gitea api για να καταμετρήσετε το περιβάλλον. Ωστόσο, μπορείτε να **καταμετρήσετε τοπικές ρυθμίσεις** για να λάβετε πληροφορίες σχετικά με τα repos και τον χρήστη που έχετε πρόσβαση:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Αν ο χρήστης έχει ρυθμίσει το όνομα χρήστη του ως το όνομα χρήστη του gitea, μπορείτε να αποκτήσετε πρόσβαση στα **δημόσια κλειδιά που έχει ορίσει** στον λογαριασμό του στο _https://github.com/\<gitea\_username>.keys_, μπορείτε να το ελέγξετε αυτό για να επιβεβαιώσετε ότι το ιδιωτικό κλειδί που βρήκατε μπορεί να χρησιμοποιηθεί.

Τα **κλειδιά SSH** μπορούν επίσης να οριστούν σε αποθετήρια ως **deploy keys**. Οποιοσδήποτε έχει πρόσβαση σε αυτό το κλειδί θα μπορεί να **εκκινήσει έργα από ένα αποθετήριο**. Συνήθως σε έναν διακομιστή με διαφορετικά deploy keys το τοπικό αρχείο **`~/.ssh/config`** θα σας δώσει πληροφορίες σχετικά με το ποιο κλειδί σχετίζεται.

#### GPG Keys

Όπως εξηγείται [**εδώ**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/gitea-security/broken-reference/README.md) μερικές φορές είναι απαραίτητο να υπογράψετε τις δεσμεύσεις ή μπορεί να ανακαλυφθείτε.

Ελέγξτε τοπικά αν ο τρέχων χρήστης έχει κάποιο κλειδί με:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Με User Token

Για μια εισαγωγή σχετικά με τα [**User Tokens ελέγξτε τις βασικές πληροφορίες**](basic-gitea-information.md#personal-access-tokens).

Ένα user token μπορεί να χρησιμοποιηθεί **αντί για κωδικό πρόσβασης** για να **αυθεντικοποιηθεί** στον Gitea server [**μέσω API**](https://try.gitea.io/api/swagger#/). Θα έχει **πλήρη πρόσβαση** στον χρήστη.

### Με Oauth Application

Για μια εισαγωγή σχετικά με τα [**Gitea Oauth Applications ελέγξτε τις βασικές πληροφορίες**](./#with-oauth-application).

Ένας επιτιθέμενος μπορεί να δημιουργήσει μια **κακόβουλη Oauth Application** για να αποκτήσει πρόσβαση σε προνομιούχα δεδομένα/ενέργειες των χρηστών που τα αποδέχονται, πιθανώς ως μέρος μιας phishing καμπάνιας.

Όπως εξηγείται στις βασικές πληροφορίες, η εφαρμογή θα έχει **πλήρη πρόσβαση στον λογαριασμό του χρήστη**.

### Παράκαμψη Προστασίας Κλάδου

Στο Github έχουμε **github actions** που από προεπιλογή λαμβάνουν ένα **token με δικαιώματα εγγραφής** στο repo που μπορεί να χρησιμοποιηθεί για να **παρακάμψει τις προστασίες κλάδου**. Σε αυτή την περίπτωση αυτό **δεν υπάρχει**, οπότε οι παρακάμψεις είναι πιο περιορισμένες. Αλλά ας δούμε τι μπορεί να γίνει:

* **Enable Push**: Αν κάποιος με δικαιώματα εγγραφής μπορεί να κάνει push στον κλάδο, απλά κάντε push σε αυτόν.
* **Whitelist Restricted Push**: Με τον ίδιο τρόπο, αν είστε μέρος αυτής της λίστας κάντε push στον κλάδο.
* **Enable Merge Whitelist**: Αν υπάρχει λίστα συγχώνευσης, πρέπει να είστε μέσα σε αυτήν.
* **Require approvals is bigger than 0**: Τότε... πρέπει να παραβιάσετε έναν άλλο χρήστη.
* **Restrict approvals to whitelisted**: Αν μόνο οι χρήστες της λίστας μπορούν να εγκρίνουν... πρέπει να παραβιάσετε έναν άλλο χρήστη που είναι μέσα σε αυτήν τη λίστα.
* **Dismiss stale approvals**: Αν οι εγκρίσεις δεν αφαιρούνται με νέες δεσμεύσεις, μπορείτε να καταλάβετε ένα ήδη εγκεκριμένο PR για να εισάγετε τον κώδικά σας και να συγχωνεύσετε το PR.

Σημειώστε ότι **αν είστε διαχειριστής org/repo** μπορείτε να παρακάμψετε τις προστασίες.

### Καταμέτρηση Webhooks

Τα **Webhooks** μπορούν να **στέλνουν συγκεκριμένες πληροφορίες gitea σε ορισμένα μέρη**. Μπορείτε να **εκμεταλλευτείτε αυτήν την επικοινωνία**.\
Ωστόσο, συνήθως ένα **μυστικό** που δεν μπορείτε να **ανακτήσετε** έχει οριστεί στο **webhook** που θα **αποτρέψει** εξωτερικούς χρήστες που γνωρίζουν το URL του webhook αλλά όχι το μυστικό να **εκμεταλλευτούν αυτό το webhook**.\
Αλλά σε ορισμένες περιπτώσεις, οι άνθρωποι αντί να ορίσουν το **μυστικό** στη θέση του, το **ορίζουν στο URL** ως παράμετρο, οπότε **ελέγχοντας τα URLs** θα μπορούσατε να **βρείτε μυστικά** και άλλα μέρη που θα μπορούσατε να εκμεταλλευτείτε περαιτέρω.

Τα Webhooks μπορούν να οριστούν σε **repo και σε επίπεδο org**.

## Μετά την Εκμετάλλευση

### Μέσα στον server

Αν με κάποιο τρόπο καταφέρατε να μπείτε στον server όπου τρέχει το gitea, θα πρέπει να αναζητήσετε το αρχείο ρυθμίσεων του gitea. Από προεπιλογή βρίσκεται στο `/data/gitea/conf/app.ini`

Σε αυτό το αρχείο μπορείτε να βρείτε **κλειδιά** και **κωδικούς πρόσβασης**.

Στο μονοπάτι του gitea (από προεπιλογή: /data/gitea) μπορείτε επίσης να βρείτε ενδιαφέρουσες πληροφορίες όπως:

* Η **sqlite** DB: Αν το gitea δεν χρησιμοποιεί εξωτερική db, θα χρησιμοποιήσει μια sqlite db.
* Οι **συνεδρίες** μέσα στον φάκελο συνεδριών: Εκτελώντας `cat sessions/*/*/*` μπορείτε να δείτε τα ονόματα χρηστών των συνδεδεμένων χρηστών (το gitea θα μπορούσε επίσης να αποθηκεύσει τις συνεδρίες μέσα στη DB).
* Το **ιδιωτικό κλειδί jwt** μέσα στον φάκελο jwt.
* Περισσότερες **ευαίσθητες πληροφορίες** θα μπορούσαν να βρεθούν σε αυτόν τον φάκελο.

Αν είστε μέσα στον server, μπορείτε επίσης να **χρησιμοποιήσετε το `gitea` binary** για να αποκτήσετε/τροποποιήσετε πληροφορίες:

* `gitea dump` θα αποθηκεύσει το gitea και θα δημιουργήσει ένα .zip αρχείο.
* `gitea generate secret INTERNAL_TOKEN/JWT_SECRET/SECRET_KEY/LFS_JWT_SECRET` θα δημιουργήσει ένα token του υποδεικνυόμενου τύπου (επιμονή).
* `gitea admin user change-password --username admin --password newpassword` Αλλάξτε τον κωδικό πρόσβασης.
* `gitea admin user create --username newuser --password superpassword --email user@user.user --admin --access-token` Δημιουργήστε νέο διαχειριστή χρήστη και λάβετε ένα access token.

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
