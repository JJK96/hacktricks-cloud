# Gitea Security

{% hint style="success" %}
Naučite i vežbajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Naučite i vežbajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Pogledajte [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Delite hacking trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Šta je Gitea

**Gitea** je **self-hosted community managed lightweight code hosting** rešenje napisano u Go.

![](<../../.gitbook/assets/image (160).png>)

### Osnovne Informacije

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Lab

Da biste pokrenuli Gitea instancu lokalno, možete jednostavno pokrenuti docker container:
```bash
docker run -p 3000:3000 gitea/gitea
```
Povežite se na port 3000 da biste pristupili veb stranici.

Takođe možete pokrenuti sa kubernetes:
```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```
## Neautentifikovano Enumerisanje

* Javni repozitorijumi: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Registrovani korisnici: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Registrovane organizacije: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

Napomena da **Gitea po defaultu omogućava novim korisnicima da se registruju**. Ovo neće dati posebno interesantan pristup novim korisnicima nad repozitorijumima drugih organizacija/korisnika, ali **ulogovani korisnik** može biti u mogućnosti da **vizualizuje više repozitorijuma ili organizacija**.

## Interna Eksploatacija

Za ovaj scenario pretpostavljamo da ste dobili neki pristup github nalogu.

### Sa Korisničkim Kredencijalima/Web Kolačićem

Ako nekako već imate kredencijale za korisnika unutar organizacije (ili ste ukrali sesijski kolačić) možete se **samo prijaviti** i proveriti koje **dozvole imate** nad kojim **repozitorijumima**, u **kojim timovima** ste, **listati druge korisnike**, i **kako su repozitorijumi zaštićeni.**

Napomena da se može koristiti **2FA** tako da ćete moći pristupiti ovim informacijama samo ako možete **proći tu proveru**.

{% hint style="info" %}
Napomena da ako **uspešno ukradete `i_like_gitea` kolačić** (trenutno konfigurisan sa SameSite: Lax) možete **potpuno imitirati korisnika** bez potrebe za kredencijalima ili 2FA.
{% endhint %}

### Sa Korisničkim SSH Ključem

Gitea omogućava **korisnicima** da postave **SSH ključeve** koji će se koristiti kao **metod autentifikacije za deploy koda** u njihovo ime (2FA se ne primenjuje).

Sa ovim ključem možete vršiti **promene u repozitorijumima gde korisnik ima neke privilegije**, međutim ne možete ga koristiti za pristup gitea api-ju za enumerisanje okruženja. Ipak, možete **enumerisati lokalna podešavanja** da biste dobili informacije o repozitorijumima i korisniku kojem imate pristup:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Ako je korisnik konfigurisao svoje korisničko ime kao svoje gitea korisničko ime, možete pristupiti **javnim ključevima koje je postavio** na svom nalogu na _https://github.com/\<gitea\_username>.keys_, možete ovo proveriti da potvrdite da privatni ključ koji ste pronašli može biti korišćen.

**SSH ključevi** takođe mogu biti postavljeni u repozitorijume kao **deploy keys**. Svako ko ima pristup ovom ključu moći će da **pokrene projekte iz repozitorijuma**. Obično na serveru sa različitim deploy keys lokalni fajl **`~/.ssh/config`** će vam dati informacije o tome koji ključ je povezan.

#### GPG Keys

Kao što je objašnjeno [**ovde**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/gitea-security/broken-reference/README.md) ponekad je potrebno potpisati commit-ove ili možete biti otkriveni.

Proverite lokalno da li trenutni korisnik ima neki ključ sa:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Sa korisničkim tokenom

Za uvod o [**korisničkim tokenima pogledajte osnovne informacije**](basic-gitea-information.md#personal-access-tokens).

Korisnički token može se koristiti **umesto lozinke** za **autentifikaciju** na Gitea server [**preko API-ja**](https://try.gitea.io/api/swagger#/). Imaće **potpun pristup** korisniku.

### Sa Oauth aplikacijom

Za uvod o [**Gitea Oauth aplikacijama pogledajte osnovne informacije**](./#with-oauth-application).

Napadač može kreirati **zlonamernu Oauth aplikaciju** kako bi pristupio privilegovanim podacima/akcijama korisnika koji ih prihvate, verovatno kao deo phishing kampanje.

Kao što je objašnjeno u osnovnim informacijama, aplikacija će imati **potpun pristup korisničkom nalogu**.

### Zaobilaženje zaštite grana

Na Github-u imamo **github actions** koji po defaultu dobijaju **token sa pravom pisanja** nad repo-om koji se može koristiti za **zaobilaženje zaštite grana**. U ovom slučaju to **ne postoji**, pa su zaobilaženja ograničenija. Ali hajde da pogledamo šta se može uraditi:

* **Omogući Push**: Ako bilo ko sa pravom pisanja može da push-uje na granu, samo push-ujte na nju.
* **Whitelist ograničenog Push-a**: Na isti način, ako ste deo ove liste, push-ujte na granu.
* **Omogući Merge Whitelist**: Ako postoji merge whitelist, morate biti unutar nje.
* **Zahtevaj odobrenja veća od 0**: Onda... morate kompromitovati drugog korisnika.
* **Ograniči odobrenja na whitelistovane**: Ako samo whitelistovani korisnici mogu odobriti... morate kompromitovati drugog korisnika koji je na toj listi.
* **Odbaci zastarela odobrenja**: Ako odobrenja nisu uklonjena sa novim commit-ovima, možete preuzeti već odobren PR da ubacite svoj kod i spojite PR.

Napomena da **ako ste org/repo admin** možete zaobići zaštite.

### Enumeracija Webhook-ova

**Webhook-ovi** mogu **slati specifične gitea informacije na neka mesta**. Možda ćete moći da **iskoristite tu komunikaciju**.\
Međutim, obično je postavljen **tajni ključ** koji **ne možete preuzeti** u **webhook-u** koji će **sprečiti** spoljne korisnike koji znaju URL webhook-a, ali ne i tajni ključ, da **iskoriste taj webhook**.\
Ali u nekim slučajevima, ljudi umesto da postave **tajni ključ** na svoje mesto, oni ga **postavljaju u URL** kao parametar, pa **proveravanje URL-ova** može vam omogućiti da **pronađete tajne ključeve** i druga mesta koja možete dalje iskoristiti.

Webhook-ovi mogu biti postavljeni na **repo i na org nivou**.

## Post Eksploatacija

### Unutar servera

Ako ste nekako uspeli da uđete u server na kojem radi gitea, trebali biste potražiti gitea konfiguracioni fajl. Po defaultu se nalazi u `/data/gitea/conf/app.ini`

U ovom fajlu možete pronaći **ključeve** i **lozinke**.

U gitea putanji (po defaultu: /data/gitea) možete pronaći i zanimljive informacije kao što su:

* **sqlite** DB: Ako gitea ne koristi eksterni db, koristiće sqlite db
* **sesije** unutar foldera sesija: Pokretanjem `cat sessions/*/*/*` možete videti korisnička imena prijavljenih korisnika (gitea može takođe čuvati sesije unutar DB-a).
* **jwt privatni ključ** unutar jwt foldera
* Više **osetljivih informacija** može se pronaći u ovom folderu

Ako ste unutar servera, možete takođe **koristiti `gitea` binarni fajl** za pristup/modifikaciju informacija:

* `gitea dump` će dump-ovati gitea i generisati .zip fajl
* `gitea generate secret INTERNAL_TOKEN/JWT_SECRET/SECRET_KEY/LFS_JWT_SECRET` će generisati token navedenog tipa (perzistencija)
* `gitea admin user change-password --username admin --password newpassword` Promeni lozinku
* `gitea admin user create --username newuser --password superpassword --email user@user.user --admin --access-token` Kreiraj novog admin korisnika i dobij pristupni token

{% hint style="success" %}
Naučite i vežbajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Naučite i vežbajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Pogledajte [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitter-u** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Delite hakovanje trikove podnošenjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
