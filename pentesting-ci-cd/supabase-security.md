# Supabase Security

{% hint style="success" %}
Μάθετε και εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε και εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Γίνετε μέλος της** 💬 [**ομάδας Discord**](https://discord.gg/hRep4RUj7f) ή της [**ομάδας telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}

## Βασικές Πληροφορίες

Σύμφωνα με την [**αρχική σελίδα**](https://supabase.com/): Το Supabase είναι μια ανοιχτού κώδικα εναλλακτική λύση του Firebase. Ξεκινήστε το έργο σας με μια βάση δεδομένων Postgres, Authentication, instant APIs, Edge Functions, Realtime subscriptions, Storage, και Vector embeddings.

### Υποτομέας

Βασικά, όταν δημιουργείται ένα έργο, ο χρήστης θα λάβει έναν υποτομέα supabase.co όπως: **`jnanozjdybtpqgcwhdiz.supabase.co`**

## **Ρύθμιση Βάσης Δεδομένων**

{% hint style="success" %}
**Αυτά τα δεδομένα μπορούν να προσπελαστούν από έναν σύνδεσμο όπως `https://supabase.com/dashboard/project/<project-id>/settings/database`**
{% endhint %}

Αυτή η **βάση δεδομένων** θα αναπτυχθεί σε κάποια περιοχή AWS, και για να συνδεθείτε σε αυτήν θα είναι δυνατό να το κάνετε συνδεόμενοι σε: `postgres://postgres.jnanozjdybtpqgcwhdiz:[YOUR-PASSWORD]@aws-0-us-west-1.pooler.supabase.com:5432/postgres` (αυτό δημιουργήθηκε στο us-west-1).\
Ο κωδικός πρόσβασης είναι ένας **κωδικός που έθεσε ο χρήστης** προηγουμένως.

Επομένως, καθώς ο υποτομέας είναι γνωστός και χρησιμοποιείται ως όνομα χρήστη και οι περιοχές AWS είναι περιορισμένες, μπορεί να είναι δυνατό να προσπαθήσετε να **brute force τον κωδικό πρόσβασης**.

Αυτή η ενότητα περιέχει επίσης επιλογές για:

* Επαναφορά του κωδικού πρόσβασης της βάσης δεδομένων
* Ρύθμιση σύνδεσης pooling
* Ρύθμιση SSL: Απόρριψη συνδέσεων απλού κειμένου (από προεπιλογή είναι ενεργοποιημένες)
* Ρύθμιση μεγέθους δίσκου
* Εφαρμογή περιορισμών και απαγορεύσεων δικτύου

## Ρύθμιση API

{% hint style="success" %}
**Αυτά τα δεδομένα μπορούν να προσπελαστούν από έναν σύνδεσμο όπως `https://supabase.com/dashboard/project/<project-id>/settings/api`**
{% endhint %}

Η διεύθυνση URL για πρόσβαση στο supabase API στο έργο σας θα είναι όπως: `https://jnanozjdybtpqgcwhdiz.supabase.co`.

### anon api keys

Θα δημιουργήσει επίσης ένα **anon API key** (`role: "anon"`), όπως: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk` που η εφαρμογή θα χρειαστεί να χρησιμοποιήσει για να επικοινωνήσει με το API key που εκτίθεται στο παράδειγμά μας.

Είναι δυνατό να βρείτε το API REST για να επικοινωνήσετε με αυτό το API στα [**docs**](https://supabase.com/docs/reference/self-hosting-auth/returns-the-configuration-settings-for-the-gotrue-server), αλλά τα πιο ενδιαφέροντα endpoints θα ήταν:

<details>

<summary>Signup (/auth/v1/signup)</summary>
```
POST /auth/v1/signup HTTP/2
Host: id.io.net
Content-Length: 90
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

<details>

<summary>Login (/auth/v1/token?grant_type=password)</summary>
```
POST /auth/v1/token?grant_type=password HTTP/2
Host: hypzbtgspjkludjcnjxl.supabase.co
Content-Length: 80
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

Όποτε ανακαλύπτετε έναν πελάτη που χρησιμοποιεί supabase με το υποτομέα που του έχει δοθεί (είναι πιθανό ότι ένας υποτομέας της εταιρείας έχει ένα CNAME πάνω από τον υποτομέα του supabase), μπορείτε να προσπαθήσετε να **δημιουργήσετε έναν νέο λογαριασμό στην πλατφόρμα χρησιμοποιώντας το supabase API**.

### secret / service\_role api keys

Ένα μυστικό API key θα δημιουργηθεί επίσης με **`role: "service_role"`**. Αυτό το API key πρέπει να είναι μυστικό γιατί θα μπορεί να παρακάμψει το **Row Level Security**.

Το API key μοιάζει με αυτό: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcxNDk5MjcxOSwiZXhwIjoyMDMwNTY4NzE5fQ.0a8fHGp3N_GiPq0y0dwfs06ywd-zhTwsm486Tha7354`

### JWT Secret

Ένα **JWT Secret** θα δημιουργηθεί επίσης ώστε η εφαρμογή να μπορεί να **δημιουργεί και να υπογράφει προσαρμοσμένα JWT tokens**.

## Authentication

### Signups

{% hint style="success" %}
Από **προεπιλογή** το supabase θα επιτρέπει **νέους χρήστες να δημιουργούν λογαριασμούς** στο έργο σας χρησιμοποιώντας τα προαναφερθέντα API endpoints.
{% endhint %}

Ωστόσο, αυτοί οι νέοι λογαριασμοί, από προεπιλογή, **θα χρειαστεί να επιβεβαιώσουν τη διεύθυνση email τους** για να μπορέσουν να συνδεθούν στον λογαριασμό. Είναι δυνατό να ενεργοποιήσετε την επιλογή **"Allow anonymous sign-ins"** για να επιτρέψετε στους ανθρώπους να συνδεθούν χωρίς να επαληθεύσουν τη διεύθυνση email τους. Αυτό θα μπορούσε να δώσει πρόσβαση σε **απροσδόκητα δεδομένα** (λαμβάνουν τους ρόλους `public` και `authenticated`).\
Αυτή είναι μια πολύ κακή ιδέα γιατί το supabase χρεώνει ανά ενεργό χρήστη, οπότε οι άνθρωποι θα μπορούσαν να δημιουργήσουν χρήστες και να συνδεθούν και το supabase θα χρεώσει για αυτούς:

<figure><img src="../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

### Passwords & sessions

Είναι δυνατό να υποδείξετε το ελάχιστο μήκος κωδικού πρόσβασης (από προεπιλογή), τις απαιτήσεις (όχι από προεπιλογή) και να απαγορεύσετε τη χρήση leaked κωδικών πρόσβασης.\
Συνιστάται να **βελτιώσετε τις απαιτήσεις καθώς οι προεπιλεγμένες είναι αδύναμες**.

* User Sessions: Είναι δυνατό να ρυθμίσετε πώς λειτουργούν οι συνεδρίες χρηστών (timeouts, 1 συνεδρία ανά χρήστη...)
* Bot and Abuse Protection: Είναι δυνατό να ενεργοποιήσετε το Captcha.

### SMTP Settings

Είναι δυνατό να ρυθμίσετε ένα SMTP για την αποστολή email.

### Advanced Settings

* Ορίστε χρόνο λήξης για τα access tokens (3600 από προεπιλογή)
* Ορίστε να ανιχνεύει και να ανακαλεί πιθανώς συμβιβασμένα refresh tokens και timeout
* MFA: Υποδείξτε πόσους παράγοντες MFA μπορούν να εγγραφούν ταυτόχρονα ανά χρήστη (10 από προεπιλογή)
* Max Direct Database Connections: Μέγιστος αριθμός συνδέσεων που χρησιμοποιούνται για auth (10 από προεπιλογή)
* Max Request Duration: Μέγιστος χρόνος που επιτρέπεται για να διαρκέσει ένα αίτημα Auth (10s από προεπιλογή)

## Storage

{% hint style="success" %}
Το Supabase επιτρέπει **την αποθήκευση αρχείων** και την πρόσβασή τους μέσω URL (χρησιμοποιεί S3 buckets).
{% endhint %}

* Ορίστε το όριο μεγέθους αρχείου μεταφόρτωσης (το προεπιλεγμένο είναι 50MB)
* Η σύνδεση S3 δίνεται με ένα URL όπως: `https://jnanozjdybtpqgcwhdiz.supabase.co/storage/v1/s3`
* Είναι δυνατό να **ζητήσετε S3 access key** που αποτελούνται από ένα `access key ID` (π.χ. `a37d96544d82ba90057e0e06131d0a7b`) και ένα `secret access key` (π.χ. `58420818223133077c2cec6712a4f909aec93b4daeedae205aa8e30d5a860628`)

## Edge Functions

Είναι δυνατό να **αποθηκεύσετε μυστικά** στο supabase τα οποία θα είναι **προσβάσιμα από edge functions** (μπορούν να δημιουργηθούν και να διαγραφούν από τον ιστό, αλλά δεν είναι δυνατό να αποκτήσετε πρόσβαση στην αξία τους άμεσα).

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Ελέγξτε τα [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
