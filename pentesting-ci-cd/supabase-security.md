# Bezpieczeństwo Supabase

<details>

<summary><strong>Zacznij od zera i stań się ekspertem od hakowania AWS dzięki</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) albo **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>

## Podstawowe informacje

Zgodnie z ich [**stroną główną**](https://supabase.com/): Supabase to otwarta alternatywa dla Firebase. Rozpocznij swój projekt z bazą danych Postgres, uwierzytelnianiem, natywnymi interfejsami API, funkcjami Edge, subskrypcjami w czasie rzeczywistym, przechowywaniem i osadzaniem wektorów.

### Subdomena

W zasadzie po utworzeniu projektu użytkownik otrzyma subdomenę supabase.co, np.: **`jnanozjdybtpqgcwhdiz.supabase.co`**

## **Konfiguracja bazy danych**

{% hint style="success" %}
**Te dane można uzyskać z linku w stylu `https://supabase.com/dashboard/project/<project-id>/settings/database`**
{% endhint %}

Ta **baza danych** zostanie wdrożona w pewnym regionie AWS, a aby się do niej połączyć, można to zrobić łącząc się z: `postgres://postgres.jnanozjdybtpqgcwhdiz:[TWOJE-HASŁO]@aws-0-us-west-1.pooler.supabase.com:5432/postgres` (to zostało utworzone w us-west-1).\
Hasło to **hasło, które użytkownik wcześniej ustawił**.

Dlatego, ponieważ subdomena jest znana i jest używana jako nazwa użytkownika, a regiony AWS są ograniczone, możliwe byłoby próbowanie **siłowego przełamywania hasła**.

Ta sekcja zawiera również opcje:

* Zresetuj hasło do bazy danych
* Skonfiguruj buforowanie połączeń
* Skonfiguruj SSL: Odrzuć połączenia w tekście jawnym (domyślnie są włączone)
* Skonfiguruj rozmiar dysku
* Zastosuj ograniczenia sieciowe i blokady

## Konfiguracja API

{% hint style="success" %}
**Te dane można uzyskać z linku w stylu `https://supabase.com/dashboard/project/<project-id>/settings/api`**
{% endhint %}

Adres URL do dostępu do API Supabase w twoim projekcie będzie wyglądał tak: `https://jnanozjdybtpqgcwhdiz.supabase.co`.

### Klucze API anon

Wygeneruje również **klucz API anon** (`role: "anon"`), np.: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk`, który będzie musiał być użyty przez aplikację do kontaktowania się z kluczem API, który został ujawniony w naszym przykładzie w&#x20;

Możliwe jest znalezienie API REST do kontaktowania się z tym API w [**dokumentacji**](https://supabase.com/docs/reference/self-hosting-auth/returns-the-configuration-settings-for-the-gotrue-server), ale najbardziej interesujące punkty końcowe to:

<details>

<summary>Rejestracja (/auth/v1/signup)</summary>
```
POST /auth/v1/signup HTTP/2
Host: id.io.net
Content-Length: 90
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

<details>

<summary>Logowanie (/auth/v1/token?grant_type=password)</summary>
```
POST /auth/v1/token?grant_type=password HTTP/2
Host: hypzbtgspjkludjcnjxl.supabase.co
Content-Length: 80
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

Więc, kiedy odkryjesz klienta korzystającego z supabase z poddomeną, którą otrzymali (możliwe, że poddomena firmy ma CNAME nad ich poddomeną supabase), możesz spróbować **utworzyć nowe konto na platformie, korzystając z API supabase**.

### Klucze API secret / service\_role

Zostanie również wygenerowany tajny klucz API z **`role: "service_role"`**. Ten klucz API powinien być tajny, ponieważ będzie mógł ominąć **Row Level Security**.

Klucz API wygląda tak: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcxNDk5MjcxOSwiZXhwIjoyMDMwNTY4NzE5fQ.0a8fHGp3N_GiPq0y0dwfs06ywd-zhTwsm486Tha7354`

### Tajny klucz JWT

Zostanie również wygenerowany **tajny klucz JWT**, dzięki któremu aplikacja będzie mogła **tworzyć i podpisywać niestandardowe tokeny JWT**.

## Autentykacja

### Rejestracje

{% hint style="success" %}
Domyślnie supabase pozwoli **nowym użytkownikom tworzyć konta** w twoim projekcie, korzystając z wcześniej wspomnianych punktów końcowych API.
{% endhint %}

Jednak te nowe konta, domyślnie, **będą musiały zweryfikować swój adres e-mail**, aby móc zalogować się na konto. Możliwe jest włączenie opcji **"Zezwalaj na anonimowe logowania"**, aby umożliwić ludziom logowanie bez weryfikacji adresu e-mail. Może to dać dostęp do **nieoczekiwanych danych** (uzyskają role `public` i `authenticated`).\
To bardzo zły pomysł, ponieważ supabase pobiera opłaty za aktywnego użytkownika, więc ludzie mogą tworzyć konta, logować się, a supabase będzie pobierał opłaty za te działania:

<figure><img src="../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

### Hasła i sesje

Możliwe jest określenie minimalnej długości hasła (domyślnie), wymagań (brak domyślnie) i zakazu używania wyciekłych haseł.\
Zaleca się **poprawienie wymagań, ponieważ domyślne są słabe**.

* Sesje użytkownika: Możliwe jest skonfigurowanie sposobu działania sesji użytkownika (czas oczekiwania, 1 sesja na użytkownika...)
* Ochrona przed botami i nadużyciami: Możliwe jest włączenie Captcha.

### Ustawienia SMTP

Możliwe jest skonfigurowanie SMTP do wysyłania e-maili.

### Zaawansowane ustawienia

* Ustaw czas wygaśnięcia tokenów dostępu (domyślnie 3600)
* Ustaw wykrywanie i unieważnianie potencjalnie skompromitowanych tokenów odświeżania oraz czas oczekiwania
* MFA: Wskaż, ile czynników MFA może być zapisanych jednocześnie na użytkownika (domyślnie 10)
* Maksymalna liczba bezpośrednich połączeń z bazą danych: Maksymalna liczba połączeń używanych do uwierzytelniania (domyślnie 10)
* Maksymalny czas trwania żądania: Maksymalny czas trwania żądania uwierzytelniania (domyślnie 10s)

## Przechowywanie

{% hint style="success" %}
Supabase pozwala **przechowywać pliki** i udostępniać je za pomocą adresu URL (korzysta z kubełków S3).
{% endhint %}

* Ustaw limit rozmiaru pliku do przesyłania (domyślnie 50 MB)
* Połączenie S3 jest udostępnione za pomocą adresu URL: `https://jnanozjdybtpqgcwhdiz.supabase.co/storage/v1/s3`
* Możliwe jest **żądanie klucza dostępu S3**, który składa się z `ID klucza dostępu` (np. `a37d96544d82ba90057e0e06131d0a7b`) i `tajnego klucza dostępu` (np. `58420818223133077c2cec6712a4f909aec93b4daeedae205aa8e30d5a860628`)

## Funkcje Edge

Możliwe jest również **przechowywanie tajnych informacji** w supabase, które będą **dostępne dla funkcji Edge** (można je tworzyć i usuwać z sieci, ale nie można bezpośrednio uzyskać do ich wartości).
