# Seguran√ßa do Supabase

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

- Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
- Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
- Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
- **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
- **Compartilhe seus truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

## Informa√ß√µes B√°sicas

Conforme a [**p√°gina inicial**](https://supabase.com/): Supabase √© uma alternativa de c√≥digo aberto ao Firebase. Inicie seu projeto com um banco de dados Postgres, Autentica√ß√£o, APIs instant√¢neas, Fun√ß√µes de Borda, Inscri√ß√µes em tempo real, Armazenamento e Incorpora√ß√µes de Vetores.

### Subdom√≠nio

Basicamente, quando um projeto √© criado, o usu√°rio receber√° um subdom√≠nio supabase.co como: **`jnanozjdybtpqgcwhdiz.supabase.co`**

## **Configura√ß√£o do Banco de Dados**

{% hint style="success" %}
**Esses dados podem ser acessados a partir de um link como `https://supabase.com/dashboard/project/<project-id>/settings/database`**
{% endhint %}

Este **banco de dados** ser√° implantado em alguma regi√£o da AWS e, para se conectar a ele, seria poss√≠vel faz√™-lo conectando-se a: `postgres://postgres.jnanozjdybtpqgcwhdiz:[SUA-SENHA]@aws-0-us-west-1.pooler.supabase.com:5432/postgres` (isso foi criado em us-west-1).\
A senha √© uma **senha que o usu√°rio inseriu** anteriormente.

Portanto, como o subdom√≠nio √© conhecido e √© usado como nome de usu√°rio e as regi√µes da AWS s√£o limitadas, pode ser poss√≠vel tentar **for√ßar a senha**.

Esta se√ß√£o tamb√©m cont√©m op√ß√µes para:

- Redefinir a senha do banco de dados
- Configurar o agrupamento de conex√µes
- Configurar SSL: Rejeitar conex√µes de texto simples (por padr√£o, elas est√£o habilitadas)
- Configurar o tamanho do disco
- Aplicar restri√ß√µes e proibi√ß√µes de rede

## Configura√ß√£o da API

{% hint style="success" %}
**Esses dados podem ser acessados a partir de um link como `https://supabase.com/dashboard/project/<project-id>/settings/api`**
{% endhint %}

A URL para acessar a API do Supabase em seu projeto ser√° como: `https://jnanozjdybtpqgcwhdiz.supabase.co`.

### chaves de API an√¥nimas

Tamb√©m ir√° gerar uma **chave de API an√¥nima** (`role: "anon"`), como: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk` que a aplica√ß√£o precisar√° usar para entrar em contato com a chave de API exposta em nosso exemplo em&#x20;

√â poss√≠vel encontrar a API REST para contatar esta API na [**documenta√ß√£o**](https://supabase.com/docs/reference/self-hosting-auth/returns-the-configuration-settings-for-the-gotrue-server), mas os endpoints mais interessantes seriam:

<details>

<summary>Signup (/auth/v1/signup)</summary>
```
POST /auth/v1/signup HTTP/2
Host: id.io.net
Content-Length: 90
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

<details>

<summary>Entrar (/auth/v1/token?grant_type=password)</summary>
```
POST /auth/v1/token?grant_type=password HTTP/2
Host: hypzbtgspjkludjcnjxl.supabase.co
Content-Length: 80
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

Portanto, sempre que voc√™ descobrir um cliente usando supabase com o subdom√≠nio que lhes foi concedido (√© poss√≠vel que um subdom√≠nio da empresa tenha um CNAME sobre seu subdom√≠nio supabase), voc√™ pode tentar **criar uma nova conta na plataforma usando a API do supabase**.

### Chaves secretas / api de fun√ß√£o de servi√ßo

Uma chave de API secreta tamb√©m ser√° gerada com **`role: "service_role"`**. Esta chave de API deve ser mantida em segredo, pois ela poder√° contornar a **Seguran√ßa em N√≠vel de Linha**.

A chave de API se parece com isso: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcxNDk5MjcxOSwiZXhwIjoyMDMwNTY4NzE5fQ.0a8fHGp3N_GiPq0y0dwfs06ywd-zhTwsm486Tha7354`

### Segredo JWT

Um **Segredo JWT** tamb√©m ser√° gerado para que a aplica√ß√£o possa **criar e assinar tokens JWT personalizados**.

## Autentica√ß√£o

### Cadastros

{% hint style="success" %}
Por **padr√£o**, o supabase permitir√° que **novos usu√°rios criem contas** em seu projeto usando os endpoints da API mencionados anteriormente.
{% endhint %}

No entanto, essas novas contas, por padr√£o, **precisar√£o validar seu endere√ßo de e-mail** para poder fazer login na conta. √â poss√≠vel habilitar **"Permitir logins an√¥nimos"** para permitir que as pessoas fa√ßam login sem verificar seu endere√ßo de e-mail. Isso poderia conceder acesso a **dados inesperados** (eles recebem os pap√©is `public` e `authenticated`).\
Isso √© uma ideia muito ruim porque o supabase cobra por usu√°rio ativo, ent√£o as pessoas poderiam criar usu√°rios e fazer login e o supabase cobraria por eles:

<figure><img src="../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

### Senhas e sess√µes

√â poss√≠vel indicar o comprimento m√≠nimo da senha (por padr√£o), requisitos (n√£o por padr√£o) e impedir o uso de senhas vazadas.\
√â recomend√°vel **melhorar os requisitos, pois os padr√µes s√£o fracos**.

* Sess√µes de Usu√°rio: √â poss√≠vel configurar como as sess√µes de usu√°rio funcionam (tempo limite, 1 sess√£o por usu√°rio...)
* Prote√ß√£o contra Bots e Abusos: √â poss√≠vel habilitar o Captcha.

### Configura√ß√µes SMTP

√â poss√≠vel configurar um SMTP para enviar e-mails.

### Configura√ß√µes Avan√ßadas

* Definir tempo de expira√ß√£o para tokens de acesso (3600 por padr√£o)
* Definir para detectar e revogar tokens de atualiza√ß√£o potencialmente comprometidos e tempo limite
* MFA: Indicar quantos fatores MFA podem ser inscritos de uma vez por usu√°rio (10 por padr√£o)
* M√°ximo de Conex√µes Diretas ao Banco de Dados: N√∫mero m√°ximo de conex√µes usadas para autentica√ß√£o (10 por padr√£o)
* Dura√ß√£o M√°xima da Solicita√ß√£o: Tempo m√°ximo permitido para uma solicita√ß√£o de Autentica√ß√£o durar (10s por padr√£o)

## Armazenamento

{% hint style="success" %}
O Supabase permite **armazenar arquivos** e torn√°-los acess√≠veis por meio de um URL (ele usa buckets S3).
{% endhint %}

* Definir o limite de tamanho de upload de arquivo (o padr√£o √© 50MB)
* A conex√£o S3 √© fornecida com um URL como: `https://jnanozjdybtpqgcwhdiz.supabase.co/storage/v1/s3`
* √â poss√≠vel **solicitar chaves de acesso S3** que s√£o formadas por um `ID de chave de acesso` (por exemplo, `a37d96544d82ba90057e0e06131d0a7b`) e uma `chave de acesso secreta` (por exemplo, `58420818223133077c2cec6712a4f909aec93b4daeedae205aa8e30d5a860628`)

## Fun√ß√µes de Borda

√â poss√≠vel **armazenar segredos** no supabase tamb√©m, que ser√£o **acess√≠veis por fun√ß√µes de borda** (elas podem ser criadas e exclu√≠das pela web, mas n√£o √© poss√≠vel acessar seu valor diretamente).
