# Github Security

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking öğrenin ve pratik yapın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 Discord grubuna** [**katılın**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live) **bizi takip edin.**
* **HackTricks'e PR göndererek hacking ipuçlarını paylaşın** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına.

</details>
{% endhint %}

## Github Nedir

([buradan](https://kinsta.com/knowledgebase/what-is-github/)) Yüksek seviyede, **GitHub, geliştiricilerin kodlarını saklamalarına ve yönetmelerine, ayrıca kodlarındaki değişiklikleri izlemelerine ve kontrol etmelerine yardımcı olan bir web sitesi ve bulut tabanlı bir hizmettir**.

### Temel Bilgiler

{% content-ref url="basic-github-information.md" %}
[basic-github-information.md](basic-github-information.md)
{% endcontent-ref %}

## Dış Keşif

Github depoları, genel, özel ve dahili olarak yapılandırılabilir.

* **Özel** demek, **sadece** **kuruluşun** insanlarının erişebileceği anlamına gelir
* **Dahili** demek, **sadece** **şirketin** (bir şirketin birkaç kuruluşu olabilir) erişebileceği anlamına gelir
* **Genel** demek, **tüm internetin** erişebileceği anlamına gelir.

**Hedeflemek istediğiniz kullanıcı, depo veya kuruluşu** biliyorsanız, **github dorks** kullanarak hassas bilgileri bulabilir veya **her depoda** **hassas bilgi sızıntılarını** arayabilirsiniz.

### Github Dorks

Github, **bir kullanıcı, depo veya kuruluşu belirterek bir şey aramaya izin verir**. Bu nedenle, hassas bilgilere yakın olacak dizeler listesi ile hedefinizdeki **potansiyel hassas bilgileri kolayca arayabilirsiniz**.

Araçlar (her araç kendi dorks listesini içerir):

* [https://github.com/obheda12/GitDorker](https://github.com/obheda12/GitDorker) ([Dorks listesi](https://github.com/obheda12/GitDorker/tree/master/Dorks))
* [https://github.com/techgaun/github-dorks](https://github.com/techgaun/github-dorks) ([Dorks listesi](https://github.com/techgaun/github-dorks/blob/master/github-dorks.txt))
* [https://github.com/hisxo/gitGraber](https://github.com/hisxo/gitGraber) ([Dorks listesi](https://github.com/hisxo/gitGraber/tree/master/wordlists))

### Github Leaks

Lütfen, github dorks'un github arama seçeneklerini kullanarak sızıntıları aramak için de tasarlandığını unutmayın. Bu bölüm, her depoyu indirip içlerinde hassas bilgileri arayacak (hatta belirli bir derinlikteki commit'leri kontrol eden) araçlara ayrılmıştır.

Araçlar (her araç kendi regex listesini içerir):

* [https://github.com/zricethezav/gitleaks](https://github.com/zricethezav/gitleaks)
* [https://github.com/trufflesecurity/truffleHog](https://github.com/trufflesecurity/truffleHog)
* [https://github.com/eth0izzle/shhgit](https://github.com/eth0izzle/shhgit)
* [https://github.com/michenriksen/gitrob](https://github.com/michenriksen/gitrob)
* [https://github.com/anshumanbh/git-all-secrets](https://github.com/anshumanbh/git-all-secrets)
* [https://github.com/kootenpv/gittyleaks](https://github.com/kootenpv/gittyleaks)
* [https://github.com/awslabs/git-secrets](https://github.com/awslabs/git-secrets)

{% hint style="warning" %}
Bir depoda sızıntı ararken ve `git log -p` gibi bir şey çalıştırırken, **başka commit'ler içeren diğer dallar** olabileceğini unutmayın!
{% endhint %}

### Dış Forklar

**Pull request'leri kötüye kullanarak depoları ele geçirmek mümkündür**. Bir deponun savunmasız olup olmadığını bilmek için genellikle Github Actions yaml yapılandırmalarını okumanız gerekir. [**Aşağıda bu konuda daha fazla bilgi**](./#execution-from-a-external-fork).

## Organizasyon Güçlendirme

### Üye Ayrıcalıkları

**Üyelere** atanabilecek bazı **varsayılan ayrıcalıklar** vardır. Bu ayrıcalıklar `https://github.com/organizations/<org_name>/settings/member_privileges` sayfasından veya [**Organizations API**](https://docs.github.com/en/rest/orgs/orgs) üzerinden kontrol edilebilir.

* **Temel izinler**: Üyeler, org depoları üzerinde None/Read/write/Admin iznine sahip olacaklardır. Önerilen **None** veya **Read**'dir.
* **Depo forking**: Gerekli değilse, üyelerin organizasyon depolarını fork etmesine **izin vermemek** daha iyidir.
* **Sayfa oluşturma**: Gerekli değilse, üyelerin org depolarından sayfa yayınlamasına **izin vermemek** daha iyidir. Gerekliyse, genel veya özel sayfalar oluşturulmasına izin verebilirsiniz.
* **Entegrasyon erişim istekleri**: Bu etkinleştirildiğinde, dış işbirlikçilerin bu organizasyona ve kaynaklarına erişmek için GitHub veya OAuth uygulamaları için erişim talep etmelerine izin verilecektir. Genellikle gereklidir, ancak değilse, devre dışı bırakmak daha iyidir.
* _Bu bilgiyi API yanıtında bulamadım, bulursanız paylaşın_
* **Depo görünürlüğü değişikliği**: Etkinleştirildiğinde, **depo** için **admin** izinlerine sahip **üyeler** **görünürlüğünü değiştirebilecektir**. Devre dışı bırakıldığında, yalnızca organizasyon sahipleri depo görünürlüklerini değiştirebilir. İnsanların **şeyleri halka açık hale getirmesini istemiyorsanız**, bunun **devre dışı** olduğundan emin olun.
* _Bu bilgiyi API yanıtında bulamadım, bulursanız paylaşın_
* **Depo silme ve transfer**: Etkinleştirildiğinde, depo için **admin** izinlerine sahip üyeler, **genel ve özel depoları** **silebilecek** veya **transfer edebilecektir**.
* _Bu bilgiyi API yanıtında bulamadım, bulursanız paylaşın_
* **Üyelerin takım oluşturmasına izin ver**: Etkinleştirildiğinde, organizasyonun herhangi bir **üyesi** yeni **takımlar** oluşturabilecektir. Devre dışı bırakıldığında, yalnızca organizasyon sahipleri yeni takımlar oluşturabilir. Bunu devre dışı bırakmak daha iyidir.
* _Bu bilgiyi API yanıtında bulamadım, bulursanız paylaşın_
* **Bu sayfada daha fazla şey yapılandırılabilir** ancak önceki olanlar güvenlikle daha ilgili olanlardır.

### Actions Ayarları

`https://github.com/organizations/<org_name>/settings/actions` sayfasından actions için çeşitli güvenlikle ilgili ayarlar yapılandırılabilir.

{% hint style="info" %}
Tüm bu yapılandırmaların her depo için bağımsız olarak da ayarlanabileceğini unutmayın
{% endhint %}

* **Github actions politikaları**: Hangi depoların iş akışlarını çalıştırabileceğini ve hangi iş akışlarının izin verileceğini belirtmenize olanak tanır. **Hangi depoların** izin verileceğini belirtmek ve tüm actions'ların çalışmasına izin vermemek önerilir.
* [**API-1**](https://docs.github.com/en/rest/actions/permissions#get-allowed-actions-and-reusable-workflows-for-an-organization)**,** [**API-2**](https://docs.github.com/en/rest/actions/permissions#list-selected-repositories-enabled-for-github-actions-in-an-organization)
* **Dış işbirlikçilerden fork pull request iş akışları**: Tüm dış işbirlikçiler için **onay gerektirilmesi** önerilir.
* _Bu bilgiyi içeren bir API bulamadım, bulursanız paylaşın_
* **Fork pull request'lerden iş akışlarını çalıştır**: Fork kaynağının sahiplerine kaynak deposunda okuma izinlerine sahip token'ları kullanma yeteneği verileceğinden, pull request'lerden iş akışlarını çalıştırmak **şiddetle tavsiye edilmez**.
* _Bu bilgiyi içeren bir API bulamadım, bulursanız paylaşın_
* **İş akışı izinleri**: **Yalnızca okuma depo izinleri vermek** şiddetle tavsiye edilir. Çalışan iş akışlarına verilen GITHUB\_TOKEN'ın kötüye kullanılmasını önlemek için yazma ve pull request oluşturma/onaylama izinleri vermek önerilmez.
* [**API**](https://docs.github.com/en/rest/actions/permissions#get-default-workflow-permissions-for-an-organization)

### Entegrasyonlar

_Bu bilgiye erişmek için API uç noktasını biliyorsanız bana bildirin!_

* **Üçüncü taraf uygulama erişim politikası**: Her uygulamaya erişimi kısıtlamak ve yalnızca gerekli olanlara (inceledikten sonra) izin vermek önerilir.
* **Yüklü GitHub Uygulamaları**: Yalnızca gerekli olanlara (inceledikten sonra) izin vermek önerilir.

## Kimlik Bilgilerini Kötüye Kullanarak Keşif ve Saldırılar

Bu senaryo için bir github hesabına erişim sağladığınızı varsayacağız.

### Kullanıcı Kimlik Bilgileri ile

Bir şekilde bir organizasyon içindeki bir kullanıcı için kimlik bilgilerine sahipseniz, **sadece giriş yapabilir** ve hangi **şirket ve organizasyon rollerine sahip olduğunuzu** kontrol edebilir, ham üye iseniz, **ham üyelerin hangi izinlere sahip olduğunu**, hangi **gruplarda** olduğunuzu, hangi **depolar üzerinde hangi izinlere sahip olduğunuzu** ve **depolar nasıl korunduğunu** kontrol edebilirsiniz.

**2FA kullanılabilir** olduğunu unutmayın, bu nedenle bu bilgilere yalnızca bu kontrolü de geçebiliyorsanız erişebilirsiniz.

{% hint style="info" %}
**`user_session` çerezini çalmayı başarırsanız** (şu anda SameSite: Lax olarak yapılandırılmıştır) **kullanıcıyı tamamen taklit edebilirsiniz** ve kimlik bilgilerine veya 2FA'ya ihtiyacınız olmaz.
{% endhint %}

Aşağıdaki [**dal koruma atlatmaları**](./#branch-protection-bypass) bölümünü kontrol edin, işinize yarayabilir.

### Kullanıcı SSH Anahtarı ile

Github, **kullanıcıların** **adlarına kod dağıtımı için kimlik doğrulama yöntemi olarak** kullanılacak **SSH anahtarları** ayarlamasına izin verir (2FA uygulanmaz).

Bu anahtarla, **kullanıcının bazı ayrıcalıklara sahip olduğu depolarda değişiklikler yapabilirsiniz**, ancak github api'ye erişip ortamı listeleyemezsiniz. Ancak, **erişiminiz olan depolar ve kullanıcı hakkında bilgi almak için** **yerel ayarları listeleyebilirsiniz**:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Eğer kullanıcı github kullanıcı adı olarak kullanıcı adını yapılandırdıysa, hesabında ayarladığı **açık anahtarlara** _https://github.com/\<github\_username>.keys_ adresinden erişebilirsiniz, bulduğunuz özel anahtarın kullanılabilir olduğunu doğrulamak için bunu kontrol edebilirsiniz.

**SSH anahtarları** ayrıca **deploy keys** olarak depolarda ayarlanabilir. Bu anahtara erişimi olan herkes bir depodan **projeleri başlatabilir**. Genellikle farklı deploy keys ile bir sunucuda, yerel dosya **`~/.ssh/config`** hangi anahtarın ilgili olduğu hakkında bilgi verir.

#### GPG Keys

[**Burada**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/github-security/broken-reference/README.md) açıklandığı gibi bazen commit'leri imzalamak gerekebilir veya keşfedilebilirsiniz.

Mevcut kullanıcının herhangi bir anahtarı olup olmadığını yerel olarak kontrol edin:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Kullanıcı Tokeni ile

[**Kullanıcı Tokenleri hakkında temel bilgileri**](basic-github-information.md#personal-access-tokens) için bir giriş.

Bir kullanıcı tokeni, Git üzerinden HTTPS için **şifre yerine** kullanılabilir veya [**API'ye Temel Kimlik Doğrulama üzerinden kimlik doğrulamak**](https://docs.github.com/v3/auth/#basic-authentication) için kullanılabilir. Buna bağlı olarak, ekli ayrıcalıklara göre farklı işlemler gerçekleştirebilirsiniz.

Bir Kullanıcı tokeni şu şekilde görünür: `ghp_EfHnQFcFHX6fGIu5mpduvRiYR584kK0dX123`

### Oauth Uygulaması ile

[**Github Oauth Uygulamaları hakkında temel bilgileri**](basic-github-information.md#oauth-applications) için bir giriş.

Bir saldırgan, kullanıcıların kabul ettiği **kötü niyetli bir Oauth Uygulaması** oluşturabilir ve muhtemelen bir phishing kampanyasının parçası olarak ayrıcalıklı verilere/işlemlere erişebilir.

Bunlar, [bir Oauth uygulamasının isteyebileceği kapsamlar](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps). Kabul etmeden önce her zaman istenen kapsamları kontrol etmelisiniz.

Ayrıca, temel bilgilerde açıklandığı gibi, **kuruluşlar üçüncü taraf uygulamalara** kuruluşla ilgili bilgi/depo/işlemlere erişim izni verebilir veya reddedebilir.

### Github Uygulaması ile

[**Github Uygulamaları hakkında temel bilgileri**](basic-github-information.md#github-applications) için bir giriş.

Bir saldırgan, kullanıcıların kabul ettiği **kötü niyetli bir Github Uygulaması** oluşturabilir ve muhtemelen bir phishing kampanyasının parçası olarak ayrıcalıklı verilere/işlemlere erişebilir.

Ayrıca, temel bilgilerde açıklandığı gibi, **kuruluşlar üçüncü taraf uygulamalara** kuruluşla ilgili bilgi/depo/işlemlere erişim izni verebilir veya reddedebilir.

## Github Action'ı Ele Geçirme ve Kötüye Kullanma

Bir Github Action'ı ele geçirmek ve kötüye kullanmak için çeşitli teknikler vardır, buradan kontrol edin:

{% content-ref url="abusing-github-actions/" %}
[abusing-github-actions](abusing-github-actions/)
{% endcontent-ref %}

## Dal Koruma Atlatma

* **Onay sayısı gerektir**: Birkaç hesabı ele geçirdiyseniz, diğer hesaplardan PR'larınızı kabul edebilirsiniz. PR'ı oluşturduğunuz hesaba sahipseniz, kendi PR'ınızı kabul edemezsiniz. Ancak, depo içinde bir **Github Action** ortamına erişiminiz varsa, **GITHUB\_TOKEN** kullanarak **PR'ınızı onaylayabilir** ve bu şekilde 1 onay alabilirsiniz.
* _Bu ve Kod Sahipleri kısıtlaması için not: Genellikle bir kullanıcı kendi PR'larını onaylayamaz, ancak eğer yapabiliyorsanız, PR'larınızı kabul etmek için bunu kötüye kullanabilirsiniz._
* **Yeni commitler gönderildiğinde onayları iptal et**: Bu ayar etkin değilse, yasal kodu gönderebilir, birinin onaylamasını bekleyebilir ve ardından kötü niyetli kodu ekleyip korunan dala birleştirebilirsiniz.
* **Kod Sahiplerinden inceleme gerektir**: Bu etkinleştirilmişse ve siz bir Kod Sahibi iseniz, **Github Action'ı PR'ınızı oluşturmak ve ardından kendiniz onaylamak** için kullanabilirsiniz.
* **CODEOWNER dosyası yanlış yapılandırıldığında** Github şikayet etmez ama kullanmaz. Bu nedenle, yanlış yapılandırılmışsa **Kod Sahipleri koruması uygulanmaz.**
* **Belirtilen aktörlerin pull request gereksinimlerini atlamasına izin ver**: Bu aktörlerden biriyseniz, pull request korumalarını atlayabilirsiniz.
* **Yöneticileri dahil et**: Bu ayar etkin değilse ve depo yöneticisiyseniz, bu dal korumalarını atlayabilirsiniz.
* **PR Kaçırma**: Başkasının PR'ını **değiştirip kötü niyetli kod ekleyebilir**, sonucu kendiniz onaylayabilir ve her şeyi birleştirebilirsiniz.
* **Dal Korumalarını Kaldırma**: Depo yöneticisiyseniz, **korumaları devre dışı bırakabilir**, PR'ınızı birleştirebilir ve korumaları yeniden ayarlayabilirsiniz.
* **Push korumalarını atlatma**: Bir depo **sadece belirli kullanıcıların** dallara push (kod birleştirme) yapmasına izin veriyorsa (dal koruması tüm dalları `*` joker karakteri ile koruyabilir).
* Depo üzerinde **yazma erişiminiz varsa ama dal koruması nedeniyle kod push yapmanıza izin verilmiyorsa**, yine de **yeni bir dal oluşturabilir** ve içinde **kod push edildiğinde tetiklenen bir github action oluşturabilirsiniz**. **Dal koruması dal oluşturulana kadar dalı korumayacağından**, bu ilk kod push'u **github action'ı tetikleyecektir**.

## Ortam Korumasını Atlatma

[**Github Ortamı hakkında temel bilgileri**](basic-github-information.md#git-environments) için bir giriş.

Bir ortam **tüm dallardan erişilebiliyorsa**, **korunmamış** demektir ve ortam içindeki sırları kolayca erişebilirsiniz. **Tüm dalların korunduğu** (isimleri belirterek veya `*` kullanarak) depolar bulabilirsiniz, bu durumda, **kod push yapabileceğiniz bir dal bulun** ve yeni bir github action oluşturarak (veya birini değiştirerek) sırları **dışarı çıkarabilirsiniz**.

Not, **tüm dalların korunduğu** (joker karakter `*` ile) ve **dallara kod push yapabilecek kişilerin belirtildiği** (_dal korumasında belirtebilirsiniz_) ve **kullanıcınızın izinli olmadığı** bir uç durumla karşılaşabilirsiniz. Yine de özel bir github action çalıştırabilirsiniz çünkü bir dal oluşturabilir ve push tetikleyicisini kendisi üzerinde kullanabilirsiniz. **Dal koruması yeni bir dala push yapılmasına izin verir, böylece github action tetiklenir**.
```yaml
push: # Run it when a push is made to a branch
branches:
- current_branch_name #Use '**' to run when a push is made to any branch
```
Dikkat edin ki **dal oluşturulduktan sonra** **dal koruması yeni dala uygulanacak** ve onu değiştiremeyeceksiniz, ancak o zamana kadar sırları zaten dökmüş olacaksınız.

## Kalıcılık

* **Kullanıcı tokenı** oluşturun
* **Sırlar**dan **github tokenlarını** çalın
* İş akışı **sonuçlarını** ve **dalları** **silin**
* Tüm orga **daha fazla izin verin**
* Bilgi sızdırmak için **webhooklar** oluşturun
* **Dış işbirlikçileri** davet edin
* **SIEM** tarafından kullanılan **webhookları** **kaldırın**
* **Backdoor** ile **Github Action** oluşturun/değiştirin
* **Gizli** değer değişikliği yoluyla **komut enjeksiyonuna açık Github Action** bulun

### Sahte Commits - Repo commitleri üzerinden backdoor

Github'da bir **fork'tan bir repo'ya PR oluşturmak** mümkündür. PR **kabul edilmese bile**, kodun fork versiyonu için orijinal repo içinde bir **commit** id'si oluşturulacaktır. Bu nedenle, bir saldırgan **repo sahibinin oluşturmadığı görünüşte yasal bir repodan belirli bir commit kullanmak için pin yapabilir**.

[**Bu**](https://github.com/actions/checkout/commit/c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e) gibi:
```yaml
name: example
on: [push]
jobs:
commit:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e
- shell: bash
run: |
echo 'hello world!'
```
Daha fazla bilgi için [https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd](https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd) adresine bakın.

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking öğrenin ve pratik yapın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **PR göndererek hacking ipuçlarını paylaşın:** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına.

</details>
{% endhint %}
