# Github Security

{% hint style="success" %}
Naučite i vežbajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Naučite i vežbajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Delite hakovanje trikove podnošenjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Šta je Github

(Sa [ovde](https://kinsta.com/knowledgebase/what-is-github/)) Na visokom nivou, **GitHub je vebsajt i cloud-bazirana usluga koja pomaže programerima da skladište i upravljaju svojim kodom, kao i da prate i kontrolišu promene u svom kodu**.

### Osnovne Informacije

{% content-ref url="basic-github-information.md" %}
[basic-github-information.md](basic-github-information.md)
{% endcontent-ref %}

## Eksterni Rekon

Github repozitorijumi mogu biti konfigurisani kao javni, privatni i interni.

* **Privatni** znači da će **samo** ljudi iz **organizacije** moći da im pristupe
* **Interni** znači da će **samo** ljudi iz **preduzeća** (preduzeće može imati nekoliko organizacija) moći da im pristupe
* **Javni** znači da će **ceo internet** moći da im pristupi.

U slučaju da znate **korisnika, repo ili organizaciju koju želite da ciljate** možete koristiti **github dorks** da pronađete osetljive informacije ili pretražujete **curenje osetljivih informacija** **u svakom repo-u**.

### Github Dorks

Github omogućava **pretragu nečega specificirajući kao opseg korisnika, repo ili organizaciju**. Dakle, sa listom stringova koji će se pojaviti blizu osetljivih informacija možete lako **pretražiti potencijalne osetljive informacije u vašoj meti**.

Alati (svaki alat sadrži svoju listu dorkova):

* [https://github.com/obheda12/GitDorker](https://github.com/obheda12/GitDorker) ([Lista dorkova](https://github.com/obheda12/GitDorker/tree/master/Dorks))
* [https://github.com/techgaun/github-dorks](https://github.com/techgaun/github-dorks) ([Lista dorkova](https://github.com/techgaun/github-dorks/blob/master/github-dorks.txt))
* [https://github.com/hisxo/gitGraber](https://github.com/hisxo/gitGraber) ([Lista dorkova](https://github.com/hisxo/gitGraber/tree/master/wordlists))

### Github Leaks

Napomena, github dorks su takođe namenjeni za pretragu curenja koristeći github opcije pretrage. Ovaj deo je posvećen alatima koji će **preuzeti svaki repo i pretražiti osetljive informacije u njima** (čak proveravajući određenu dubinu commit-ova).

Alati (svaki alat sadrži svoju listu regex-a):

* [https://github.com/zricethezav/gitleaks](https://github.com/zricethezav/gitleaks)
* [https://github.com/trufflesecurity/truffleHog](https://github.com/trufflesecurity/truffleHog)
* [https://github.com/eth0izzle/shhgit](https://github.com/eth0izzle/shhgit)
* [https://github.com/michenriksen/gitrob](https://github.com/michenriksen/gitrob)
* [https://github.com/anshumanbh/git-all-secrets](https://github.com/anshumanbh/git-all-secrets)
* [https://github.com/kootenpv/gittyleaks](https://github.com/kootenpv/gittyleaks)
* [https://github.com/awslabs/git-secrets](https://github.com/awslabs/git-secrets)

{% hint style="warning" %}
Kada tražite curenje u repo-u i pokrenete nešto poput `git log -p` ne zaboravite da mogu postojati **druge grane sa drugim commit-ovima** koji sadrže tajne!
{% endhint %}

### Eksterni Forkovi

Moguće je **kompromitovati repo-e zloupotrebom pull request-ova**. Da biste znali da li je repo ranjiv uglavnom treba da pročitate Github Actions yaml konfiguracije. [**Više informacija o ovome ispod**](./#execution-from-a-external-fork).

## Ojačavanje Organizacije

### Privilegije Članova

Postoje neke **podrazumevane privilegije** koje mogu biti dodeljene **članovima** organizacije. Ove se mogu kontrolisati sa stranice `https://github.com/organizations/<org_name>/settings/member_privileges` ili sa [**Organizations API**](https://docs.github.com/en/rest/orgs/orgs).

* **Osnovne dozvole**: Članovi će imati dozvolu None/Read/write/Admin nad org repozitorijumima. Preporučeno je **None** ili **Read**.
* **Forkovanje repozitorijuma**: Ako nije neophodno, bolje je **ne dozvoliti** članovima da fork-uju organizacione repozitorijume.
* **Kreiranje stranica**: Ako nije neophodno, bolje je **ne dozvoliti** članovima da objavljuju stranice iz org repo-a. Ako je neophodno možete dozvoliti kreiranje javnih ili privatnih stranica.
* **Zahtevi za pristup integracijama**: Sa ovim omogućeno, spoljašnji saradnici će moći da zatraže pristup za GitHub ili OAuth aplikacije da pristupe ovoj organizaciji i njenim resursima. Obično je potrebno, ali ako nije, bolje je onemogućiti.
* _Nisam mogao pronaći ovu informaciju u API odgovorima, podelite ako nađete_
* **Promena vidljivosti repozitorijuma**: Ako je omogućeno, **članovi** sa **admin** dozvolama za **repozitorijum** će moći da **promene njegovu vidljivost**. Ako je onemogućeno, samo vlasnici organizacije mogu menjati vidljivost repozitorijuma. Ako **ne želite** da ljudi prave stvari **javnim**, uverite se da je ovo **onemogućeno**.
* _Nisam mogao pronaći ovu informaciju u API odgovorima, podelite ako nađete_
* **Brisanje i prenos repozitorijuma**: Ako je omogućeno, članovi sa **admin** dozvolama za repozitorijum će moći da **brišu** ili **prenose** javne i privatne **repozitorijume.**
* _Nisam mogao pronaći ovu informaciju u API odgovorima, podelite ako nađete_
* **Dozvola članovima da kreiraju timove**: Ako je omogućeno, bilo koji **član** organizacije će moći da **kreira** nove **timove**. Ako je onemogućeno, samo vlasnici organizacije mogu kreirati nove timove. Bolje je imati ovo onemogućeno.
* _Nisam mogao pronaći ovu informaciju u API odgovorima, podelite ako nađete_
* **Više stvari može biti konfigurisano** na ovoj stranici ali prethodne su one koje su više vezane za sigurnost.

### Podešavanja Akcija

Nekoliko podešavanja vezanih za sigurnost može biti konfigurisano za akcije sa stranice `https://github.com/organizations/<org_name>/settings/actions`.

{% hint style="info" %}
Napomena da se sva ova podešavanja mogu takođe postaviti na svakom repozitorijumu nezavisno
{% endhint %}

* **Github akcione politike**: Omogućava vam da naznačite koji repozitorijumi mogu pokretati workflow-ove i koji workflow-ovi treba da budu dozvoljeni. Preporučuje se **specifikovati koji repozitorijumi** treba da budu dozvoljeni i ne dozvoliti svim akcijama da se pokreću.
* [**API-1**](https://docs.github.com/en/rest/actions/permissions#get-allowed-actions-and-reusable-workflows-for-an-organization)**,** [**API-2**](https://docs.github.com/en/rest/actions/permissions#list-selected-repositories-enabled-for-github-actions-in-an-organization)
* **Fork pull request workflow-ovi od spoljašnjih saradnika**: Preporučuje se **zahtevati odobrenje za sve** spoljašnje saradnike.
* _Nisam mogao pronaći API sa ovom informacijom, podelite ako nađete_
* **Pokretanje workflow-ova iz fork pull request-ova**: Visoko je **nepreporučljivo pokretati workflow-ove iz pull request-ova** jer će održavaoci porekla fork-a dobiti mogućnost da koriste tokene sa read dozvolama na izvornom repozitorijumu.
* _Nisam mogao pronaći API sa ovom informacijom, podelite ako nađete_
* **Dozvole za workflow-ove**: Visoko se preporučuje **dati samo read dozvole za repozitorijum**. Nepreporučuje se davanje write i create/approve pull request dozvola kako bi se izbegla zloupotreba GITHUB\_TOKEN-a datog za pokretanje workflow-ova.
* [**API**](https://docs.github.com/en/rest/actions/permissions#get-default-workflow-permissions-for-an-organization)

### Integracije

_Javite mi ako znate API endpoint za pristup ovoj informaciji!_

* **Politika pristupa aplikacijama trećih strana**: Preporučuje se ograničiti pristup svakoj aplikaciji i dozvoliti samo potrebne (nakon pregleda).
* **Instalirane GitHub aplikacije**: Preporučuje se dozvoliti samo potrebne (nakon pregleda).

## Rekon & Napadi zloupotrebom kredencijala

Za ovaj scenario pretpostavićemo da ste dobili neki pristup github nalogu.

### Sa Korisničkim Kredencijalima

Ako nekako već imate kredencijale za korisnika unutar organizacije možete se **samo prijaviti** i proveriti koje **uloge u preduzeću i organizaciji imate**, ako ste običan član, proverite koje **dozvole obični članovi imaju**, u kojim **grupama** ste, koje **dozvole imate** nad kojim **repozitorijumima,** i **kako su repo-i zaštićeni.**

Napomena da **2FA može biti korišćen** tako da ćete moći pristupiti ovim informacijama samo ako možete takođe **proći tu proveru**.

{% hint style="info" %}
Napomena da ako **uspešno ukradete `user_session` kolačić** (trenutno konfigurisano sa SameSite: Lax) možete **potpuno imitirati korisnika** bez potrebe za kredencijalima ili 2FA.
{% endhint %}

Proverite deo ispod o [**zaobilaženju zaštite grana**](./#branch-protection-bypass) u slučaju da vam bude koristan.

### Sa Korisničkim SSH Ključem

Github omogućava **korisnicima** da postave **SSH ključeve** koji će biti korišćeni kao **metod autentifikacije za deploy koda** u njihovo ime (2FA se ne primenjuje).

Sa ovim ključem možete izvršiti **promene u repozitorijumima gde korisnik ima neke privilegije**, međutim ne možete ga koristiti za pristup github api-ju da biste enumerisali okruženje. Međutim, možete **enumerisati lokalna podešavanja** da biste dobili informacije o repo-ima i korisniku kojem imate pristup:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Ako je korisnik konfigurirao svoje korisničko ime kao svoje github korisničko ime, možete pristupiti **javnim ključevima koje je postavio** na svom nalogu na _https://github.com/\<github\_username>.keys_, možete ovo proveriti da potvrdite da privatni ključ koji ste pronašli može biti korišćen.

**SSH ključevi** takođe mogu biti postavljeni u repozitorijume kao **deploy keys**. Svako ko ima pristup ovom ključu moći će da **pokrene projekte iz repozitorijuma**. Obično na serveru sa različitim deploy keys, lokalni fajl **`~/.ssh/config`** će vam dati informacije o tome koji ključ je povezan.

#### GPG Ključevi

Kao što je objašnjeno [**ovde**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/github-security/broken-reference/README.md) ponekad je potrebno potpisati commit-ove ili možete biti otkriveni.

Proverite lokalno da li trenutni korisnik ima neki ključ sa:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Sa Korisničkim Tokenom

Za uvod o [**Korisničkim Tokenima pogledajte osnovne informacije**](basic-github-information.md#personal-access-tokens).

Korisnički token može se koristiti **umesto lozinke** za Git preko HTTPS-a, ili se može koristiti za [**autentifikaciju na API preko Osnovne Autentifikacije**](https://docs.github.com/v3/auth/#basic-authentication). U zavisnosti od privilegija koje su mu dodeljene, možete biti u mogućnosti da izvršite različite akcije.

Korisnički token izgleda ovako: `ghp_EfHnQFcFHX6fGIu5mpduvRiYR584kK0dX123`

### Sa Oauth Aplikacijom

Za uvod o [**Github Oauth Aplikacijama pogledajte osnovne informacije**](basic-github-information.md#oauth-applications).

Napadač može kreirati **zlonamernu Oauth Aplikaciju** kako bi pristupio privilegovanim podacima/akcijama korisnika koji ih prihvate, verovatno kao deo phishing kampanje.

Ovo su [opsegovi koje Oauth aplikacija može zatražiti](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps). Uvek treba proveriti zatražene opsege pre nego što ih prihvatite.

Štaviše, kao što je objašnjeno u osnovnim informacijama, **organizacije mogu dati/odbiti pristup trećim aplikacijama** informacijama/repozitorijumima/akcijama vezanim za organizaciju.

### Sa Github Aplikacijom

Za uvod o [**Github Aplikacijama pogledajte osnovne informacije**](basic-github-information.md#github-applications).

Napadač može kreirati **zlonamernu Github Aplikaciju** kako bi pristupio privilegovanim podacima/akcijama korisnika koji ih prihvate, verovatno kao deo phishing kampanje.

Štaviše, kao što je objašnjeno u osnovnim informacijama, **organizacije mogu dati/odbiti pristup trećim aplikacijama** informacijama/repozitorijumima/akcijama vezanim za organizaciju.

## Kompromitovanje i Zloupotreba Github Akcije

Postoji nekoliko tehnika za kompromitovanje i zloupotrebu Github Akcije, pogledajte ih ovde:

{% content-ref url="abusing-github-actions/" %}
[abusing-github-actions](abusing-github-actions/)
{% endcontent-ref %}

## Zaobilaženje Zaštite Grana

* **Zahtevaj broj odobrenja**: Ako ste kompromitovali nekoliko naloga, možete prihvatiti svoje PR-ove sa drugih naloga. Ako imate samo nalog sa kojeg ste kreirali PR, ne možete prihvatiti svoj PR. Međutim, ako imate pristup **Github Action** okruženju unutar repozitorijuma, koristeći **GITHUB\_TOKEN** možete **odobriti svoj PR** i dobiti jedno odobrenje na taj način.
* _Napomena za ovo i za ograničenje Code Owners da obično korisnik neće moći da odobri svoje PR-ove, ali ako može, može to zloupotrebiti da prihvati svoje PR-ove._
* **Odbaci odobrenja kada se dodaju novi commit-ovi**: Ako ovo nije postavljeno, možete poslati legitiman kod, sačekati da ga neko odobri, a zatim dodati zlonamerni kod i spojiti ga u zaštićenu granu.
* **Zahtevaj recenzije od Code Owners**: Ako je ovo aktivirano i vi ste Code Owner, možete napraviti **Github Action koji kreira vaš PR i zatim ga sami odobriti**.
* Kada je **CODEOWNER datoteka pogrešno konfigurisana** Github ne prijavljuje grešku, ali je ne koristi. Dakle, ako je pogrešno konfigurisana, **zaštita Code Owners se ne primenjuje.**
* **Dozvoli određenim akterima da zaobiđu zahteve za pull request**: Ako ste jedan od tih aktera, možete zaobići zaštitu pull request-a.
* **Uključi administratore**: Ako ovo nije postavljeno, a vi ste administrator repozitorijuma, možete zaobići ovu zaštitu grane.
* **Otmica PR-a**: Možete **modifikovati PR nekog drugog** dodajući zlonamerni kod, odobriti rezultujući PR sami i spojiti sve.
* **Uklanjanje zaštite grana**: Ako ste **administrator repozitorijuma, možete onemogućiti zaštitu**, spojiti svoj PR i ponovo postaviti zaštitu.
* **Zaobilaženje zaštite push-a**: Ako repozitorijum **dozvoljava samo određenim korisnicima** da šalju push (spajaju kod) u grane (zaštita grane može štititi sve grane specificirajući zvezdicu `*`).
* Ako imate **pristup pisanju u repozitorijum, ali vam nije dozvoljeno da šaljete kod** zbog zaštite grane, i dalje možete **kreirati novu granu** i unutar nje kreirati **github action koji se pokreće kada se kod pošalje**. Kako **zaštita grane neće štititi granu dok nije kreirana**, ovo prvo slanje koda u granu će **pokrenuti github action**.

## Zaobilaženje Zaštite Okruženja

Za uvod o [**Github Okruženju pogledajte osnovne informacije**](basic-github-information.md#git-environments).

U slučaju da se okruženju može **pristupiti sa svih grana**, ono **nije zaštićeno** i lako možete pristupiti tajnama unutar okruženja. Imajte na umu da možete pronaći repozitorijume gde su **sve grane zaštićene** (specificiranjem njihovih imena ili korišćenjem `*`) u tom scenariju, **pronađite granu gde možete poslati kod** i možete **izvući** tajne kreiranjem nove github akcije (ili modifikovanjem jedne).

Napomena, možete naići na slučaj gde su **sve grane zaštićene** (preko zvezdice `*`) i specificirano je **ko može slati kod u grane** (_možete to specificirati u zaštiti grane_) i **vašem korisniku nije dozvoljeno**. I dalje možete pokrenuti prilagođenu github akciju jer možete kreirati granu i koristiti push okidač preko nje same. **Zaštita grane dozvoljava push u novu granu tako da će github akcija biti pokrenuta**.
```yaml
push: # Run it when a push is made to a branch
branches:
- current_branch_name #Use '**' to run when a push is made to any branch
```
Imajte na umu da **nakon kreiranja** grane **zaštita grane će se primeniti na novu granu** i nećete moći da je modifikujete, ali do tada ćete već izvući tajne.

## Postojanost

* Generišite **korisnički token**
* Ukradite **github tokene** iz **tajni**
* **Brisanje** rezultata **workflow-a** i **grana**
* Dajte **više dozvola celoj organizaciji**
* Kreirajte **webhook-ove** za eksfiltraciju informacija
* Pozovite **spoljne saradnike**
* **Uklonite** **webhook-ove** koje koristi **SIEM**
* Kreirajte/modifikujte **Github Action** sa **backdoor-om**
* Pronađite **ranjiv Github Action za command injection** putem modifikacije vrednosti **tajne**

### Lažni Commit-ovi - Backdoor putem commit-ova u repou

Na Github-u je moguće **kreirati PR za repo iz forka**. Čak i ako PR **nije prihvaćen**, biće kreiran **commit** id unutar originalnog repoa za fork verziju koda. Dakle, napadač **može koristiti specifičan commit iz naizgled legitimnog repoa koji nije kreirao vlasnik repoa**.

Kao [**ovde**](https://github.com/actions/checkout/commit/c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e):
```yaml
name: example
on: [push]
jobs:
commit:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e
- shell: bash
run: |
echo 'hello world!'
```
For more info check [https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd](https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd)

{% hint style="success" %}
Naučite i vežbajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Naučite i vežbajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Pogledajte [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Delite hacking trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
