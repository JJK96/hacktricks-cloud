# Github Security

{% hint style="success" %}
Jifunze na fanya mazoezi ya AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze na fanya mazoezi ya GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) au [**telegram group**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Github ni nini

(Kutoka [hapa](https://kinsta.com/knowledgebase/what-is-github/)) Kwa kiwango cha juu, **GitHub ni tovuti na huduma inayotegemea wingu ambayo husaidia watengenezaji kuhifadhi na kusimamia msimbo wao, pamoja na kufuatilia na kudhibiti mabadiliko ya msimbo wao**.

### Taarifa za Msingi

{% content-ref url="basic-github-information.md" %}
[basic-github-information.md](basic-github-information.md)
{% endcontent-ref %}

## Upelelezi wa Nje

Github repositories zinaweza kusanidiwa kama public, private na internal.

* **Private** inamaanisha kwamba **watu wa shirika pekee** ndio wataweza kufikia
* **Internal** inamaanisha kwamba **watu wa kampuni pekee** (kampuni inaweza kuwa na mashirika kadhaa) wataweza kufikia
* **Public** inamaanisha kwamba **watu wote wa mtandao** wataweza kufikia.

Iwapo unajua **mtumiaji, repo au shirika unalotaka kulenga** unaweza kutumia **github dorks** kupata taarifa nyeti au kutafuta **kuvuja kwa taarifa nyeti** **kwenye kila repo**.

### Github Dorks

Github inaruhusu **kutafuta kitu kwa kubainisha kama wigo mtumiaji, repo au shirika**. Kwa hivyo, kwa orodha ya maneno ambayo yatatokea karibu na taarifa nyeti unaweza kwa urahisi **kutafuta taarifa nyeti kwenye lengo lako**.

Zana (kila zana ina orodha yake ya dorks):

* [https://github.com/obheda12/GitDorker](https://github.com/obheda12/GitDorker) ([Orodha ya Dorks](https://github.com/obheda12/GitDorker/tree/master/Dorks))
* [https://github.com/techgaun/github-dorks](https://github.com/techgaun/github-dorks) ([Orodha ya Dorks](https://github.com/techgaun/github-dorks/blob/master/github-dorks.txt))
* [https://github.com/hisxo/gitGraber](https://github.com/hisxo/gitGraber) ([Orodha ya Dorks](https://github.com/hisxo/gitGraber/tree/master/wordlists))

### Github Leaks

Tafadhali, kumbuka kwamba github dorks pia zinalenga kutafuta leaks kwa kutumia chaguo za utafutaji za github. Sehemu hii imejitolea kwa zana ambazo zita **pakua kila repo na kutafuta taarifa nyeti ndani yake** (hata kuangalia kina fulani cha commits).

Zana (kila zana ina orodha yake ya regexes):

* [https://github.com/zricethezav/gitleaks](https://github.com/zricethezav/gitleaks)
* [https://github.com/trufflesecurity/truffleHog](https://github.com/trufflesecurity/truffleHog)
* [https://github.com/eth0izzle/shhgit](https://github.com/eth0izzle/shhgit)
* [https://github.com/michenriksen/gitrob](https://github.com/michenriksen/gitrob)
* [https://github.com/anshumanbh/git-all-secrets](https://github.com/anshumanbh/git-all-secrets)
* [https://github.com/kootenpv/gittyleaks](https://github.com/kootenpv/gittyleaks)
* [https://github.com/awslabs/git-secrets](https://github.com/awslabs/git-secrets)

{% hint style="warning" %}
Unapotafuta leaks kwenye repo na kuendesha kitu kama `git log -p` usisahau kunaweza kuwa na **matawi mengine yenye commits nyingine** zenye siri!
{% endhint %}

### External Forks

Inawezekana **kuhujumu repos kwa kutumia pull requests**. Kujua kama repo ni hatarishi unahitaji kusoma zaidi configs za Github Actions yaml. [**Maelezo zaidi kuhusu hili hapa chini**](./#execution-from-a-external-fork).

## Uimarishaji wa Shirika

### Haki za Wanachama

Kuna **haki za msingi** ambazo zinaweza kupewa **wanachama** wa shirika. Hizi zinaweza kudhibitiwa kutoka ukurasa `https://github.com/organizations/<org_name>/settings/member_privileges` au kutoka [**Organizations API**](https://docs.github.com/en/rest/orgs/orgs).

* **Base permissions**: Wanachama watakuwa na ruhusa ya None/Read/write/Admin juu ya repos za shirika. Inapendekezwa ni **None** au **Read**.
* **Repository forking**: Ikiwa si lazima, ni bora **kutoruhusu** wanachama kufork repos za shirika.
* **Pages creation**: Ikiwa si lazima, ni bora **kutoruhusu** wanachama kuchapisha kurasa kutoka repos za shirika. Ikiwa ni lazima unaweza kuruhusu kuunda kurasa za public au private.
* **Integration access requests**: Ukiwa na hii imewezeshwa washirika wa nje wataweza kuomba ruhusa kwa programu za GitHub au OAuth kufikia shirika hili na rasilimali zake. Kwa kawaida inahitajika, lakini ikiwa si lazima, ni bora kuizima.
* _Sikuweza kupata taarifa hii katika majibu ya API, shiriki ikiwa unayo_
* **Repository visibility change**: Ikiwa imewezeshwa, **wanachama** wenye **ruhusa za admin** kwa **repo** wataweza **kubadilisha mwonekano wake**. Ikiwa imezimwa, ni wamiliki wa shirika pekee wanaweza kubadilisha mwonekano wa repo. Ikiwa **hutaki** watu kufanya mambo **public**, hakikisha hii **imezimwa**.
* _Sikuweza kupata taarifa hii katika majibu ya API, shiriki ikiwa unayo_
* **Repository deletion and transfer**: Ikiwa imewezeshwa, wanachama wenye **ruhusa za admin** kwa repo wataweza **kufuta** au **kuhamisha** repos za public na private.
* _Sikuweza kupata taarifa hii katika majibu ya API, shiriki ikiwa unayo_
* **Allow members to create teams**: Ikiwa imewezeshwa, **mwanachama yeyote** wa shirika ataweza **kuunda** **tim mpya**. Ikiwa imezimwa, ni wamiliki wa shirika pekee wanaweza kuunda timu mpya. Ni bora kuwa na hii imezimwa.
* _Sikuweza kupata taarifa hii katika majibu ya API, shiriki ikiwa unayo_
* **Mambo zaidi yanaweza kusanidiwa** kwenye ukurasa huu lakini yaliyotangulia ndio yanayohusiana zaidi na usalama.

### Actions Settings

Mipangilio kadhaa inayohusiana na usalama inaweza kusanidiwa kwa actions kutoka ukurasa `https://github.com/organizations/<org_name>/settings/actions`.

{% hint style="info" %}
Kumbuka kwamba mipangilio hii yote pia inaweza kuwekwa kwenye kila repo kwa kujitegemea
{% endhint %}

* **Github actions policies**: Inakuruhusu kubainisha ni repos zipi zinaweza kuendesha workflows na ni workflows zipi zinapaswa kuruhusiwa. Inapendekezwa **kubainisha ni repos zipi** zinapaswa kuruhusiwa na sio kuruhusu actions zote kuendesha.
* [**API-1**](https://docs.github.com/en/rest/actions/permissions#get-allowed-actions-and-reusable-workflows-for-an-organization)**,** [**API-2**](https://docs.github.com/en/rest/actions/permissions#list-selected-repositories-enabled-for-github-actions-in-an-organization)
* **Fork pull request workflows from outside collaborators**: Inapendekezwa **kuhitaji idhini kwa wote** washirika wa nje.
* _Sikuweza kupata API yenye taarifa hii, shiriki ikiwa unayo_
* **Run workflows from fork pull requests**: Inashauriwa sana **kutoendesha workflows kutoka pull requests** kwani waangalizi wa asili ya fork watapewa uwezo wa kutumia tokens zenye ruhusa za kusoma kwenye repo ya chanzo.
* _Sikuweza kupata API yenye taarifa hii, shiriki ikiwa unayo_
* **Workflow permissions**: Inapendekezwa sana **kutoa ruhusa za kusoma repo pekee**. Inashauriwa kutopeana ruhusa za kuandika na kuunda/kuidhinisha pull requests ili kuepuka matumizi mabaya ya GITHUB\_TOKEN inayotolewa kwa workflows zinazoendesha.
* [**API**](https://docs.github.com/en/rest/actions/permissions#get-default-workflow-permissions-for-an-organization)

### Integrations

_Nijulishe ikiwa unajua endpoint ya API ya kufikia taarifa hii!_

* **Third-party application access policy**: Inapendekezwa kuzuia ufikiaji kwa kila programu na kuruhusu zile tu zinazohitajika (baada ya kuzichunguza).
* **Installed GitHub Apps**: Inapendekezwa kuruhusu zile tu zinazohitajika (baada ya kuzichunguza).

## Upelelezi na Mashambulizi kwa kutumia credentials

Kwa hali hii tutadhani kwamba umepata ufikiaji wa akaunti ya github.

### Kwa Credentials za Mtumiaji

Ikiwa kwa namna fulani tayari una credentials za mtumiaji ndani ya shirika unaweza **kuingia tu** na kuangalia ni **nafasi gani za kampuni na shirika unazo**, ikiwa wewe ni mwanachama wa kawaida, angalia ni **haki gani wanachama wa kawaida wanazo**, uko kwenye **vikundi gani**, una **haki gani** juu ya **repos gani**, na **jinsi gani repos zinalindwa**.

Kumbuka kwamba **2FA inaweza kutumika** kwa hivyo utaweza kufikia taarifa hii tu ikiwa unaweza pia **kupita ukaguzi huo**.

{% hint style="info" %}
Kumbuka kwamba ikiwa **utafanikiwa kuiba `user_session` cookie** (kwa sasa imewekwa na SameSite: Lax) unaweza **kumuiga mtumiaji kabisa** bila kuhitaji credentials au 2FA.
{% endhint %}

Angalia sehemu hapa chini kuhusu [**mbinu za kupita ulinzi wa matawi**](./#branch-protection-bypass) ikiwa ni muhimu.

### Kwa User SSH Key

Github inaruhusu **watumiaji** kuweka **funguo za SSH** ambazo zitatumika kama **njia ya uthibitisho wa kupeleka msimbo** kwa niaba yao (hakuna 2FA inayotumika).

Kwa ufunguo huu unaweza kufanya **mabadiliko kwenye repos ambapo mtumiaji ana haki fulani**, hata hivyo huwezi kuitumia kufikia github api ili kuorodhesha mazingira. Hata hivyo, unaweza kupata **kuorodhesha mipangilio ya ndani** kupata taarifa kuhusu repos na mtumiaji unayefikia:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Ikiwa mtumiaji ameweka jina lake la mtumiaji kama jina lake la github unaweza kufikia **funguo za umma alizoweka** kwenye akaunti yake katika _https://github.com/\<github\_username>.keys_, unaweza kuangalia hii kuthibitisha kuwa ufunguo wa faragha uliopata unaweza kutumika.

**Funguo za SSH** pia zinaweza kuwekwa kwenye hazina kama **funguo za kupeleka**. Mtu yeyote aliye na ufunguo huu ataweza **kuanzisha miradi kutoka kwenye hazina**. Kawaida kwenye seva yenye funguo tofauti za kupeleka faili la ndani **`~/.ssh/config`** litakupa taarifa kuhusu ufunguo unaohusiana.

#### Funguo za GPG

Kama ilivyoelezwa [**hapa**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/github-security/broken-reference/README.md) wakati mwingine inahitajika kusaini commits au unaweza kugunduliwa.

Angalia ndani ya nchi kama mtumiaji wa sasa ana ufunguo wowote na:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Kwa Token ya Mtumiaji

Kwa utangulizi kuhusu [**User Tokens angalia taarifa za msingi**](basic-github-information.md#personal-access-tokens).

Token ya mtumiaji inaweza kutumika **badala ya nenosiri** kwa Git juu ya HTTPS, au inaweza kutumika [**kuthibitisha kwa API juu ya Basic Authentication**](https://docs.github.com/v3/auth/#basic-authentication). Kulingana na ruhusa zilizoambatanishwa nayo unaweza kufanya vitendo tofauti.

Token ya Mtumiaji inaonekana kama hii: `ghp_EfHnQFcFHX6fGIu5mpduvRiYR584kK0dX123`

### Kwa Oauth Application

Kwa utangulizi kuhusu [**Github Oauth Applications angalia taarifa za msingi**](basic-github-information.md#oauth-applications).

Mshambuliaji anaweza kuunda **Oauth Application mbaya** ili kupata data/hatua za watumiaji waliokubali, labda kama sehemu ya kampeni ya udukuzi.

Hizi ni [scopes ambazo Oauth application inaweza kuomba](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps). Unapaswa kila mara kuangalia scopes zilizoombwa kabla ya kuzikubali.

Zaidi ya hayo, kama ilivyoelezwa katika taarifa za msingi, **mashirika yanaweza kutoa/kukataa ufikiaji wa programu za wahusika wa tatu** kwa taarifa/repos/hatua zinazohusiana na shirika.

### Kwa Github Application

Kwa utangulizi kuhusu [**Github Applications angalia taarifa za msingi**](basic-github-information.md#github-applications).

Mshambuliaji anaweza kuunda **Github Application mbaya** ili kupata data/hatua za watumiaji waliokubali, labda kama sehemu ya kampeni ya udukuzi.

Zaidi ya hayo, kama ilivyoelezwa katika taarifa za msingi, **mashirika yanaweza kutoa/kukataa ufikiaji wa programu za wahusika wa tatu** kwa taarifa/repos/hatua zinazohusiana na shirika.

## Kuvunja & Kudhalilisha Github Action

Kuna mbinu kadhaa za kuvunja na kudhalilisha Github Action, angalia hapa:

{% content-ref url="abusing-github-actions/" %}
[abusing-github-actions](abusing-github-actions/)
{% endcontent-ref %}

## Kuepuka Ulinzi wa Tawi

* **Kuhitaji idadi ya idhini**: Ikiwa umevunja akaunti kadhaa unaweza tu kukubali PR zako kutoka akaunti zingine. Ikiwa una akaunti moja tu ambayo ulitengeneza PR huwezi kukubali PR yako mwenyewe. Hata hivyo, ikiwa una ufikiaji wa mazingira ya **Github Action** ndani ya repo, kwa kutumia **GITHUB\_TOKEN** unaweza **kukubali PR yako** na kupata idhini 1 kwa njia hii.
* _Kumbuka kwa hili na kwa kizuizi cha Code Owners kwamba kawaida mtumiaji hawezi kukubali PR zake mwenyewe, lakini ikiwa unaweza, unaweza kuitumia kukubali PR zako._
* **Kufuta idhini wakati commits mpya zinapowekwa**: Ikiwa hii haijawekwa, unaweza kuwasilisha msimbo halali, kusubiri hadi mtu aidhinishe, na kuweka msimbo mbaya na kuunganisha kwenye tawi lililolindwa.
* **Kuhitaji mapitio kutoka kwa Code Owners**: Ikiwa hii imewezeshwa na wewe ni Code Owner, unaweza kufanya **Github Action kuunda PR yako na kisha kuikubali mwenyewe**.
* Wakati **CODEOWNER file imekosewa** Github hailalamiki lakini haitumii. Kwa hivyo, ikiwa imekosewa **ulinzi wa Code Owners hautatumika.**
* **Kuruhusu wahusika maalum kupitisha mahitaji ya pull request**: Ikiwa wewe ni mmoja wa wahusika hawa unaweza kupitisha ulinzi wa pull request.
* **Kujumuisha wasimamizi**: Ikiwa hii haijawekwa na wewe ni msimamizi wa repo, unaweza kupitisha ulinzi huu wa tawi.
* **PR Hijacking**: Unaweza **kubadilisha PR ya mtu mwingine** kwa kuongeza msimbo mbaya, kuidhinisha PR inayotokana na kuunganisha kila kitu.
* **Kuondoa Ulinzi wa Tawi**: Ikiwa wewe ni **msimamizi wa repo unaweza kuzima ulinzi**, kuunganisha PR yako na kuweka ulinzi tena.
* **Kupitisha ulinzi wa push**: Ikiwa repo **inaruhusu watumiaji fulani tu** kutuma push (kuunganisha msimbo) kwenye matawi (ulinzi wa tawi unaweza kulinda matawi yote kwa kubainisha wildcard `*`).
* Ikiwa una **ufikiaji wa kuandika kwenye repo lakini huruhusiwi kusukuma msimbo** kwa sababu ya ulinzi wa tawi, bado unaweza **kuunda tawi jipya** na ndani yake kuunda **github action ambayo inachochewa wakati msimbo unasukumwa**. Kwa kuwa **ulinzi wa tawi hautalinda tawi hadi litakapoundwa**, msukumo huu wa kwanza wa msimbo kwenye tawi uta **tekeleza github action**.

## Kuepuka Ulinzi wa Mazingira

Kwa utangulizi kuhusu [**Github Environment angalia taarifa za msingi**](basic-github-information.md#git-environments).

Iwapo mazingira yanaweza **kupatikana kutoka kwenye matawi yote**, **hayalindwi** na unaweza kwa urahisi kupata siri ndani ya mazingira. Kumbuka kwamba unaweza kupata repos ambapo **matawi yote yanalindwa** (kwa kubainisha majina yake au kwa kutumia `*`) katika hali hiyo, **tafuta tawi ambapo unaweza kusukuma msimbo** na unaweza **kutoa siri** kwa kuunda github action mpya (au kubadilisha moja).

Kumbuka, unaweza kupata hali ya kipekee ambapo **matawi yote yanalindwa** (kupitia wildcard `*`) imebainishwa **nani anaweza kusukuma msimbo kwenye matawi** (_unaweza kubainisha hilo katika ulinzi wa tawi_) na **mtumiaji wako haruhusiwi**. Bado unaweza kuendesha github action maalum kwa sababu unaweza kuunda tawi na kutumia kichocheo cha push juu yake. **Ulinzi wa tawi unaruhusu msukumo kwenye tawi jipya hivyo github action itachochewa**.
```yaml
push: # Run it when a push is made to a branch
branches:
- current_branch_name #Use '**' to run when a push is made to any branch
```
Kumbuka kwamba **baada ya kuunda** tawi **ulinzi wa tawi utatumika kwa tawi jipya** na hutaweza kulibadilisha, lakini kwa wakati huo utakuwa tayari umeshatoa siri.

## Uendelevu

* Tengeneza **token ya mtumiaji**
* Iba **github tokens** kutoka kwa **secrets**
* **Futa** matokeo ya **workflow** na **matawi**
* Toa **ruhusa zaidi kwa shirika lote**
* Tengeneza **webhooks** ili kutoa taarifa
* Alika **watu wa nje kama washirika**
* **Ondoa** **webhooks** zinazotumiwa na **SIEM**
* Tengeneza/badilisha **Github Action** na **backdoor**
* Tafuta **Github Action yenye udhaifu wa command injection** kupitia mabadiliko ya thamani ya **secret**

### Imposter Commits - Backdoor kupitia repo commits

Katika Github inawezekana **kuunda PR kwa repo kutoka kwa fork**. Hata kama PR **haikubaliki**, id ya **commit** ndani ya repo asili itaundwa kwa toleo la fork la msimbo. Kwa hivyo, mshambulizi **anaweza kutumia commit maalum kutoka kwa repo inayoonekana kuwa halali ambayo haikuundwa na mmiliki wa repo**.

Kama [**hii**](https://github.com/actions/checkout/commit/c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e):
```yaml
name: example
on: [push]
jobs:
commit:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e
- shell: bash
run: |
echo 'hello world!'
```
Kwa maelezo zaidi angalia [https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd](https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd)

{% hint style="success" %}
Jifunze na fanya mazoezi ya AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Jifunze na fanya mazoezi ya GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mipango ya usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
