# Github Sekuriteit

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Wat is Github

(Van [hier](https://kinsta.com/knowledgebase/what-is-github/)) Op 'n ho√´ vlak, **GitHub is 'n webwerf en wolk-gebaseerde diens wat ontwikkelaars help om hul kode te stoor en te bestuur, sowel as om veranderinge aan hul kode op te spoor en te beheer**.

### Basiese Inligting

{% content-ref url="basic-github-information.md" %}
[basic-github-information.md](basic-github-information.md)
{% endcontent-ref %}

## Eksterne Verkenning

Github repositories kan as publiek, privaat en intern gekonfigureer word.

* **Privaat** beteken dat **slegs** mense van die **organisasie** toegang daartoe sal h√™
* **Intern** beteken dat **slegs** mense van die **onderneming** (‚Äôn onderneming kan verskeie organisasies h√™) toegang daartoe sal h√™
* **Publiek** beteken dat **die hele internet** toegang daartoe sal h√™.

In geval jy die **gebruiker, repo of organisasie wat jy wil teiken** ken, kan jy **github dorks** gebruik om sensitiewe inligting te vind of te soek na **sensitiewe inligting lekke** **op elke repo**.

### Github Dorks

Github laat toe om **iets te soek deur as omvang 'n gebruiker, 'n repo of 'n organisasie te spesifiseer**. Daarom, met 'n lys van stringe wat naby sensitiewe inligting gaan verskyn, kan jy maklik **soek na potensi√´le sensitiewe inligting in jou teiken**.

Gereedskap (elke gereedskap bevat sy lys van dorks):

* [https://github.com/obheda12/GitDorker](https://github.com/obheda12/GitDorker) ([Dorks lys](https://github.com/obheda12/GitDorker/tree/master/Dorks))
* [https://github.com/techgaun/github-dorks](https://github.com/techgaun/github-dorks) ([Dorks lys](https://github.com/techgaun/github-dorks/blob/master/github-dorks.txt))
* [https://github.com/hisxo/gitGraber](https://github.com/hisxo/gitGraber) ([Dorks lys](https://github.com/hisxo/gitGraber/tree/master/wordlists))

### Github Lekke

Let asseblief daarop dat die github dorks ook bedoel is om te soek na lekke deur github soek opsies te gebruik. Hierdie afdeling is gewy aan daardie gereedskap wat elke repo sal **aflaai en soek na sensitiewe inligting daarin** (selfs sekere diepte van commits nagaan).

Gereedskap (elke gereedskap bevat sy lys van regexes):

* [https://github.com/zricethezav/gitleaks](https://github.com/zricethezav/gitleaks)
* [https://github.com/trufflesecurity/truffleHog](https://github.com/trufflesecurity/truffleHog)
* [https://github.com/eth0izzle/shhgit](https://github.com/eth0izzle/shhgit)
* [https://github.com/michenriksen/gitrob](https://github.com/michenriksen/gitrob)
* [https://github.com/anshumanbh/git-all-secrets](https://github.com/anshumanbh/git-all-secrets)
* [https://github.com/kootenpv/gittyleaks](https://github.com/kootenpv/gittyleaks)
* [https://github.com/awslabs/git-secrets](https://github.com/awslabs/git-secrets)

{% hint style="warning" %}
Wanneer jy soek na lekke in 'n repo en iets soos `git log -p` uitvoer, moenie vergeet daar mag **ander takke met ander commits** wees wat geheime bevat nie!
{% endhint %}

### Eksterne Forks

Dit is moontlik om **repos te kompromitteer deur pull requests te misbruik**. Om te weet of 'n repo kwesbaar is, moet jy meestal die Github Actions yaml konfigurasies lees. [**Meer inligting hieroor hieronder**](./#execution-from-a-external-fork).

## Organisasie Verharding

### Lid Privileges

Daar is 'n paar **standaard voorregte** wat aan **lede** van die organisasie toegeken kan word. Hierdie kan beheer word vanaf die bladsy `https://github.com/organizations/<org_name>/settings/member_privileges` of vanaf die [**Organizations API**](https://docs.github.com/en/rest/orgs/orgs).

* **Basis toestemmings**: Lede sal die toestemming Geen/Lees/skryf/Admin oor die org repositories h√™. Aanbeveel is **Geen** of **Lees**.
* **Repository forking**: As dit nie nodig is nie, is dit beter om **nie toe te laat** dat lede organisasie repositories fork nie.
* **Bladsye skepping**: As dit nie nodig is nie, is dit beter om **nie toe te laat** dat lede bladsye publiseer vanaf die org repos nie. As dit nodig is, kan jy toelaat om publieke of private bladsye te skep.
* **Integrasie toegang versoeke**: Met hierdie geaktiveer sal buite medewerkers in staat wees om toegang te versoek vir GitHub of OAuth apps om toegang te kry tot hierdie organisasie en sy hulpbronne. Dit is gewoonlik nodig, maar as dit nie is nie, is dit beter om dit te deaktiveer.
* _Ek kon nie hierdie inligting in die API's reaksie vind nie, deel as jy dit doen_
* **Repository sigbaarheid verandering**: As geaktiveer, sal **lede** met **admin** toestemmings vir die **repository** in staat wees om **sy sigbaarheid te verander**. As gedeaktiveer, kan slegs organisasie eienaars repository sigbaarhede verander. As jy **nie** wil h√™ mense moet dinge **publiek** maak nie, maak seker dit is **gedeaktiveer**.
* _Ek kon nie hierdie inligting in die API's reaksie vind nie, deel as jy dit doen_
* **Repository verwydering en oordrag**: As geaktiveer, sal lede met **admin** toestemmings vir die repository in staat wees om **publieke en private repositories te verwyder of oor te dra.**
* _Ek kon nie hierdie inligting in die API's reaksie vind nie, deel as jy dit doen_
* **Laat lede toe om spanne te skep**: As geaktiveer, sal enige **lid** van die organisasie in staat wees om **nuwe spanne te skep**. As gedeaktiveer, kan slegs organisasie eienaars nuwe spanne skep. Dit is beter om dit gedeaktiveer te hou.
* _Ek kon nie hierdie inligting in die API's reaksie vind nie, deel as jy dit doen_
* **Meer dinge kan gekonfigureer word** op hierdie bladsy, maar die vorige is diegene wat meer sekuriteit verwant is.

### Aksies Instellings

Verskeie sekuriteit verwante instellings kan gekonfigureer word vir aksies vanaf die bladsy `https://github.com/organizations/<org_name>/settings/actions`.

{% hint style="info" %}
Let daarop dat al hierdie konfigurasies ook op elke repository onafhanklik gestel kan word
{% endhint %}

* **Github aksies beleide**: Dit laat jou toe om aan te dui watter repositories workflows kan uitvoer en watter workflows toegelaat moet word. Dit word aanbeveel om **spesifiseer watter repositories** toegelaat moet word en nie alle aksies toe te laat om te loop nie.
* [**API-1**](https://docs.github.com/en/rest/actions/permissions#get-allowed-actions-and-reusable-workflows-for-an-organization)**,** [**API-2**](https://docs.github.com/en/rest/actions/permissions#list-selected-repositories-enabled-for-github-actions-in-an-organization)
* **Fork pull request workflows van buite medewerkers**: Dit word aanbeveel om **goedkeuring te vereis vir alle** buite medewerkers.
* _Ek kon nie 'n API met hierdie inligting vind nie, deel as jy dit doen_
* **Run workflows van fork pull requests**: Dit word sterk **afgeraai om workflows van pull requests te laat loop** aangesien instandhouders van die fork oorsprong die vermo√´ gegee sal word om tokens met lees toestemmings op die bron repository te gebruik.
* _Ek kon nie 'n API met hierdie inligting vind nie, deel as jy dit doen_
* **Workflow toestemmings**: Dit word sterk aanbeveel om **slegs lees repository toestemmings te gee**. Dit word ontmoedig om skryf en skep/goedkeur pull requests toestemmings te gee om die misbruik van die GITHUB\_TOKEN wat aan lopende workflows gegee word, te vermy.
* [**API**](https://docs.github.com/en/rest/actions/permissions#get-default-workflow-permissions-for-an-organization)

### Integrasies

_Laat weet my as jy die API eindpunt ken om hierdie inligting te bekom!_

* **Derdeparty toepassings toegang beleid**: Dit word aanbeveel om die toegang tot elke toepassing te beperk en slegs die nodige toe te laat (na beoordeling daarvan).
* **Ge√Ønstalleerde GitHub Apps**: Dit word aanbeveel om slegs die nodige toe te laat (na beoordeling daarvan).

## Verkenning & Aanvalle wat geloofsbriewe misbruik

Vir hierdie scenario gaan ons veronderstel dat jy toegang tot 'n github rekening verkry het.

### Met Gebruiker Geloofsbriewe

As jy op een of ander manier reeds geloofsbriewe vir 'n gebruiker binne 'n organisasie het, kan jy **net aanmeld** en kyk watter **onderneming en organisasie rolle jy het**, as jy 'n gewone lid is, kyk watter **toestemmings gewone lede het**, in watter **groepe** jy is, watter **toestemmings jy het** oor watter **repos,** en **hoe die repos beskerm is.**

Let daarop dat **2FA gebruik mag word** so jy sal slegs toegang tot hierdie inligting h√™ as jy ook **daardie tjek kan slaag**.

{% hint style="info" %}
Let daarop dat as jy **die `user_session` koekie kan steel** (tans gekonfigureer met SameSite: Lax) jy die gebruiker **heeltemal kan naboots** sonder om geloofsbriewe of 2FA nodig te h√™.
{% endhint %}

Kyk na die afdeling hieronder oor [**tak beskermings omseilings**](./#branch-protection-bypass) in geval dit nuttig is.

### Met Gebruiker SSH Sleutel

Github laat **gebruikers** toe om **SSH sleutels** te stel wat as **verifikasie metode gebruik sal word om kode namens hulle te ontplooi** (geen 2FA word toegepas nie).

Met hierdie sleutel kan jy **veranderings aanbring in repositories waar die gebruiker sommige voorregte het**, maar jy kan dit nie gebruik om github api te toegang om die omgewing te lys nie. Jy kan egter **lokale instellings lys** om inligting oor die repos en gebruiker te kry waartoe jy toegang het:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
As die gebruiker sy gebruikersnaam as sy github-gebruikersnaam gekonfigureer het, kan jy toegang kry tot die **publieke sleutels wat hy ingestel het** in sy rekening by _https://github.com/\<github\_username>.keys_, jy kan dit nagaan om te bevestig dat die privaat sleutel wat jy gevind het gebruik kan word.

**SSH sleutels** kan ook in repositories ingestel word as **deploy sleutels**. Enigiemand met toegang tot hierdie sleutel sal in staat wees om **projekte vanaf 'n repository te loods**. Gewoonlik in 'n bediener met verskillende deploy sleutels sal die plaaslike l√™er **`~/.ssh/config`** jou inligting gee oor watter sleutel verwant is.

#### GPG Sleutels

Soos verduidelik [**hier**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/github-security/broken-reference/README.md) is dit soms nodig om die commits te teken of jy mag ontdek word.

Kyk plaaslik of die huidige gebruiker enige sleutel het met:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Met Gebruikerstoken

Vir 'n inleiding oor [**Gebruikerstokens kyk na die basiese inligting**](basic-github-information.md#personal-access-tokens).

'n Gebruikerstoken kan gebruik word **in plaas van 'n wagwoord** vir Git oor HTTPS, of kan gebruik word om [**by die API oor Basiese Verifikasie aan te meld**](https://docs.github.com/v3/auth/#basic-authentication). Afhangende van die voorregte wat daaraan gekoppel is, kan jy verskillende aksies uitvoer.

'n Gebruikerstoken lyk so: `ghp_EfHnQFcFHX6fGIu5mpduvRiYR584kK0dX123`

### Met Oauth-toepassing

Vir 'n inleiding oor [**Github Oauth-toepassings kyk na die basiese inligting**](basic-github-information.md#oauth-applications).

'n Aanvaller kan 'n **kwaadwillige Oauth-toepassing** skep om bevoorregte data/aksies van die gebruikers wat dit aanvaar, waarskynlik as deel van 'n phishing-veldtog, te bekom.

Hier is die [toestemmings wat 'n Oauth-toepassing kan versoek](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps). 'n Mens moet altyd die versoekte toestemmings nagaan voordat dit aanvaar word.

Verder, soos verduidelik in die basiese inligting, kan **organisasies toegang tot derdeparty-toepassings gee/ontken** tot inligting/repos/aksies wat met die organisasie verband hou.

### Met Github-toepassing

Vir 'n inleiding oor [**Github-toepassings kyk na die basiese inligting**](basic-github-information.md#github-applications).

'n Aanvaller kan 'n **kwaadwillige Github-toepassing** skep om bevoorregte data/aksies van die gebruikers wat dit aanvaar, waarskynlik as deel van 'n phishing-veldtog, te bekom.

Verder, soos verduidelik in die basiese inligting, kan **organisasies toegang tot derdeparty-toepassings gee/ontken** tot inligting/repos/aksies wat met die organisasie verband hou.

## Kompromitteer & Misbruik Github Action

Daar is verskeie tegnieke om 'n Github Action te kompromitteer en te misbruik, kyk hier:

{% content-ref url="abusing-github-actions/" %}
[abusing-github-actions](abusing-github-actions/)
{% endcontent-ref %}

## Takbeskerming Omseil

* **Vereis 'n aantal goedkeurings**: As jy verskeie rekeninge gekompromitteer het, kan jy dalk jou PR's van ander rekeninge aanvaar. As jy net die rekening het van waar jy die PR geskep het, kan jy nie jou eie PR aanvaar nie. As jy egter toegang het tot 'n **Github Action**-omgewing binne die repo, kan jy met die **GITHUB\_TOKEN** dalk jou PR **goedkeur** en op hierdie manier 1 goedkeuring kry.
* _Let daarop dat vir hierdie en vir die Kode-eienaarsbeperking 'n gebruiker gewoonlik nie sy eie PR's sal kan goedkeur nie, maar as jy kan, kan jy dit misbruik om jou PR's te aanvaar._
* **Verwerp goedkeurings wanneer nuwe commits ingestuur word**: As dit nie ingestel is nie, kan jy wettige kode indien, wag totdat iemand dit goedkeur, en dan kwaadwillige kode byvoeg en dit in die beskermde tak saamsmelt.
* **Vereis hersienings van Kode-eienaars**: As dit geaktiveer is en jy 'n Kode-eienaar is, kan jy 'n **Github Action jou PR laat skep en dit dan self goedkeur**.
* Wanneer 'n **CODEOWNER-l√™er verkeerd gekonfigureer is**, kla Github nie, maar gebruik dit ook nie. Daarom, as dit verkeerd gekonfigureer is, word **Kode-eienaarsbeskerming nie toegepas nie.**
* **Laat gespesifiseerde akteurs toe om vereistes vir pull request te omseil**: As jy een van hierdie akteurs is, kan jy pull request-beskermings omseil.
* **Sluit administrateurs in**: As dit nie ingestel is nie en jy is 'n admin van die repo, kan jy hierdie takbeskermings omseil.
* **PR-kaping**: Jy kan dalk **iemand anders se PR wysig** deur kwaadwillige kode by te voeg, die resulterende PR self goed te keur en alles saam te smelt.
* **Verwydering van takbeskermings**: As jy 'n **admin van die repo is, kan jy die beskermings deaktiveer**, jou PR saamsmelt en die beskermings weer instel.
* **Omseil van drukbeskermings**: As 'n repo **slegs sekere gebruikers toelaat** om druk (saamvoeging van kode) in takke te stuur (die takbeskerming kan alle takke beskerm deur die wildcard `*` te spesifiseer).
* As jy **skryftoegang oor die repo het, maar nie toegelaat word om kode te druk nie** as gevolg van die takbeskerming, kan jy steeds **'n nuwe tak skep** en daarin 'n **github action skep wat geaktiveer word wanneer kode gedruk word**. Aangesien die **takbeskerming nie die tak sal beskerm totdat dit geskep is nie**, sal hierdie eerste kode druk na die tak die **github action uitvoer**.

## Omseil Omgewingsbeskermings

Vir 'n inleiding oor [**Github-omgewing kyk na die basiese inligting**](basic-github-information.md#git-environments).

In die geval dat 'n omgewing **vanuit alle takke toegang verkry kan word**, is dit **nie beskerm nie** en kan jy maklik toegang tot die geheime binne die omgewing kry. Let daarop dat jy dalk repo's sal vind waar **alle takke beskerm is** (deur hul name te spesifiseer of deur `*` te gebruik). In daardie scenario, **vind 'n tak waar jy kode kan druk** en jy kan die geheime **eksfiltreer** deur 'n nuwe github action te skep (of een te wysig).

Let daarop dat jy dalk die randgeval sal vind waar **alle takke beskerm is** (via wildcard `*`), dit gespesifiseer is **wie kode na die takke kan druk** (_jy kan dit in die takbeskerming spesifiseer_) en **jou gebruiker nie toegelaat word nie**. Jy kan steeds 'n pasgemaakte github action uitvoer omdat jy 'n tak kan skep en die druk sneller oor homself kan gebruik. Die **takbeskerming laat die druk na 'n nuwe tak toe, so die github action sal geaktiveer word**.
```yaml
push: # Run it when a push is made to a branch
branches:
- current_branch_name #Use '**' to run when a push is made to any branch
```
Let wel dat **na die skepping** van die tak die **takbeskerming op die nuwe tak van toepassing sal wees** en jy sal dit nie kan wysig nie, maar teen daardie tyd sal jy reeds die geheime gedump het.

## Volharding

* Genereer **gebruikers-token**
* Steel **github tokens** van **geheime**
* **Verwydering** van werkvloeistuk **resultate** en **takke**
* Gee **meer regte aan die hele organisasie**
* Skep **webhooks** om inligting te eksfiltreer
* Nooi **buitestaanders as medewerkers**
* **Verwyder** **webhooks** wat deur die **SIEM** gebruik word
* Skep/wysig **Github Action** met 'n **agterdeur**
* Vind **kwesbare Github Action vir opdraginspuiting** via **geheime** waarde wysiging

### Bedrie√´r-commits - Agterdeur via repo-commits

In Github is dit moontlik om **'n PR na 'n repo vanaf 'n fork te skep**. Selfs al word die PR **nie aanvaar nie**, sal 'n **commit**-id binne die oorspronklike repo geskep word vir die fork-weergawe van die kode. Daarom kan 'n aanvaller **'n spesifieke commit van 'n skynbaar wettige repo gebruik wat nie deur die eienaar van die repo geskep is nie**.

Soos [**hierdie**](https://github.com/actions/checkout/commit/c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e):
```yaml
name: example
on: [push]
jobs:
commit:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e
- shell: bash
run: |
echo 'hello world!'
```
Vir meer inligting, kyk [https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd](https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd)

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
