# Github Security

{% hint style="success" %}
Μάθετε και εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε και εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Γίνετε μέλος της** 💬 [**ομάδας Discord**](https://discord.gg/hRep4RUj7f) ή της [**ομάδας telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}

## Τι είναι το Github

(Από [εδώ](https://kinsta.com/knowledgebase/what-is-github/)) Σε υψηλό επίπεδο, **το GitHub είναι ένας ιστότοπος και μια υπηρεσία βασισμένη στο cloud που βοηθά τους προγραμματιστές να αποθηκεύουν και να διαχειρίζονται τον κώδικά τους, καθώς και να παρακολουθούν και να ελέγχουν τις αλλαγές στον κώδικά τους**.

### Βασικές Πληροφορίες

{% content-ref url="basic-github-information.md" %}
[basic-github-information.md](basic-github-information.md)
{% endcontent-ref %}

## Εξωτερική Αναγνώριση

Τα αποθετήρια του Github μπορούν να ρυθμιστούν ως δημόσια, ιδιωτικά και εσωτερικά.

* **Ιδιωτικό** σημαίνει ότι **μόνο** τα άτομα της **οργάνωσης** θα μπορούν να έχουν πρόσβαση σε αυτά
* **Εσωτερικό** σημαίνει ότι **μόνο** τα άτομα της **επιχείρησης** (μια επιχείρηση μπορεί να έχει πολλές οργανώσεις) θα μπορούν να έχουν πρόσβαση σε αυτό
* **Δημόσιο** σημαίνει ότι **όλο το διαδίκτυο** θα μπορεί να έχει πρόσβαση σε αυτό.

Σε περίπτωση που γνωρίζετε τον **χρήστη, το αποθετήριο ή την οργάνωση που θέλετε να στοχεύσετε** μπορείτε να χρησιμοποιήσετε **github dorks** για να βρείτε ευαίσθητες πληροφορίες ή να αναζητήσετε **διαρροές ευαίσθητων πληροφοριών** **σε κάθε αποθετήριο**.

### Github Dorks

Το Github επιτρέπει να **αναζητήσετε κάτι καθορίζοντας ως πεδίο έναν χρήστη, ένα αποθετήριο ή μια οργάνωση**. Επομένως, με μια λίστα από strings που θα εμφανιστούν κοντά σε ευαίσθητες πληροφορίες μπορείτε εύκολα να **αναζητήσετε πιθανές ευαίσθητες πληροφορίες στον στόχο σας**.

Εργαλεία (κάθε εργαλείο περιέχει τη λίστα των dorks):

* [https://github.com/obheda12/GitDorker](https://github.com/obheda12/GitDorker) ([Λίστα Dorks](https://github.com/obheda12/GitDorker/tree/master/Dorks))
* [https://github.com/techgaun/github-dorks](https://github.com/techgaun/github-dorks) ([Λίστα Dorks](https://github.com/techgaun/github-dorks/blob/master/github-dorks.txt))
* [https://github.com/hisxo/gitGraber](https://github.com/hisxo/gitGraber) ([Λίστα Dorks](https://github.com/hisxo/gitGraber/tree/master/wordlists))

### Github Leaks

Παρακαλώ, σημειώστε ότι τα github dorks προορίζονται επίσης για την αναζήτηση διαρροών χρησιμοποιώντας τις επιλογές αναζήτησης του github. Αυτή η ενότητα είναι αφιερωμένη σε εκείνα τα εργαλεία που θα **κατεβάσουν κάθε αποθετήριο και θα αναζητήσουν ευαίσθητες πληροφορίες σε αυτά** (ακόμη και ελέγχοντας ορισμένο βάθος των commits).

Εργαλεία (κάθε εργαλείο περιέχει τη λίστα των regexes):

* [https://github.com/zricethezav/gitleaks](https://github.com/zricethezav/gitleaks)
* [https://github.com/trufflesecurity/truffleHog](https://github.com/trufflesecurity/truffleHog)
* [https://github.com/eth0izzle/shhgit](https://github.com/eth0izzle/shhgit)
* [https://github.com/michenriksen/gitrob](https://github.com/michenriksen/gitrob)
* [https://github.com/anshumanbh/git-all-secrets](https://github.com/anshumanbh/git-all-secrets)
* [https://github.com/kootenpv/gittyleaks](https://github.com/kootenpv/gittyleaks)
* [https://github.com/awslabs/git-secrets](https://github.com/awslabs/git-secrets)

{% hint style="warning" %}
Όταν αναζητάτε διαρροές σε ένα αποθετήριο και εκτελείτε κάτι σαν `git log -p` μην ξεχνάτε ότι μπορεί να υπάρχουν **άλλοι κλάδοι με άλλα commits** που περιέχουν μυστικά!
{% endhint %}

### Εξωτερικά Forks

Είναι δυνατό να **παραβιάσετε αποθετήρια καταχρώμενοι τα pull requests**. Για να ξέρετε αν ένα αποθετήριο είναι ευάλωτο, κυρίως πρέπει να διαβάσετε τις ρυθμίσεις yaml του Github Actions. [**Περισσότερες πληροφορίες παρακάτω**](./#execution-from-a-external-fork).

## Ενίσχυση Οργάνωσης

### Προνόμια Μελών

Υπάρχουν κάποια **προεπιλεγμένα προνόμια** που μπορούν να ανατεθούν στα **μέλη** της οργάνωσης. Αυτά μπορούν να ελεγχθούν από τη σελίδα `https://github.com/organizations/<org_name>/settings/member_privileges` ή από το [**Organizations API**](https://docs.github.com/en/rest/orgs/orgs).

* **Βασικά δικαιώματα**: Τα μέλη θα έχουν δικαιώματα None/Read/write/Admin στα αποθετήρια της οργάνωσης. Συνιστάται **None** ή **Read**.
* **Δημιουργία forks αποθετηρίων**: Αν δεν είναι απαραίτητο, είναι καλύτερο να **μην επιτρέπεται** στα μέλη να κάνουν fork τα αποθετήρια της οργάνωσης.
* **Δημιουργία σελίδων**: Αν δεν είναι απαραίτητο, είναι καλύτερο να **μην επιτρέπεται** στα μέλη να δημοσιεύουν σελίδες από τα αποθετήρια της οργάνωσης. Αν είναι απαραίτητο, μπορείτε να επιτρέψετε τη δημιουργία δημόσιων ή ιδιωτικών σελίδων.
* **Αιτήσεις πρόσβασης σε ενσωματώσεις**: Με αυτή την επιλογή ενεργοποιημένη, εξωτερικοί συνεργάτες θα μπορούν να ζητούν πρόσβαση για εφαρμογές GitHub ή OAuth για να έχουν πρόσβαση σε αυτήν την οργάνωση και τους πόρους της. Συνήθως είναι απαραίτητο, αλλά αν όχι, είναι καλύτερο να το απενεργοποιήσετε.
* _Δεν μπόρεσα να βρω αυτές τις πληροφορίες στην απόκριση των APIs, μοιραστείτε αν το κάνετε_
* **Αλλαγή ορατότητας αποθετηρίου**: Αν είναι ενεργοποιημένο, τα **μέλη** με **admin** δικαιώματα για το **αποθετήριο** θα μπορούν να **αλλάξουν την ορατότητά του**. Αν είναι απενεργοποιημένο, μόνο οι ιδιοκτήτες της οργάνωσης μπορούν να αλλάξουν την ορατότητα των αποθετηρίων. Αν **δεν** θέλετε οι άνθρωποι να κάνουν πράγματα **δημόσια**, βεβαιωθείτε ότι αυτό είναι **απενεργοποιημένο**.
* _Δεν μπόρεσα να βρω αυτές τις πληροφορίες στην απόκριση των APIs, μοιραστείτε αν το κάνετε_
* **Διαγραφή και μεταφορά αποθετηρίου**: Αν είναι ενεργοποιημένο, τα μέλη με **admin** δικαιώματα για το αποθετήριο θα μπορούν να **διαγράψουν** ή να **μεταφέρουν** δημόσια και ιδιωτικά **αποθετήρια.**
* _Δεν μπόρεσα να βρω αυτές τις πληροφορίες στην απόκριση των APIs, μοιραστείτε αν το κάνετε_
* **Επιτρέψτε στα μέλη να δημιουργούν ομάδες**: Αν είναι ενεργοποιημένο, οποιοδήποτε **μέλος** της οργάνωσης θα μπορεί να **δημιουργεί** νέες **ομάδες**. Αν είναι απενεργοποιημένο, μόνο οι ιδιοκτήτες της οργάνωσης μπορούν να δημιουργούν νέες ομάδες. Είναι καλύτερο να είναι απενεργοποιημένο.
* _Δεν μπόρεσα να βρω αυτές τις πληροφορίες στην απόκριση των APIs, μοιραστείτε αν το κάνετε_
* **Περισσότερα πράγματα μπορούν να ρυθμιστούν** σε αυτή τη σελίδα, αλλά τα προηγούμενα είναι τα πιο σχετικά με την ασφάλεια.

### Ρυθμίσεις Actions

Διάφορες ρυθμίσεις σχετικές με την ασφάλεια μπορούν να ρυθμιστούν για τις actions από τη σελίδα `https://github.com/organizations/<org_name>/settings/actions`.

{% hint style="info" %}
Σημειώστε ότι όλες αυτές οι ρυθμίσεις μπορούν επίσης να οριστούν ανεξάρτητα σε κάθε αποθετήριο
{% endhint %}

* **Πολιτικές github actions**: Σας επιτρέπει να υποδείξετε ποια αποθετήρια μπορούν να εκτελούν workflows και ποια workflows πρέπει να επιτρέπονται. Συνιστάται να **καθορίσετε ποια αποθετήρια** πρέπει να επιτρέπονται και να μην επιτρέπετε όλες τις actions να εκτελούνται.
* [**API-1**](https://docs.github.com/en/rest/actions/permissions#get-allowed-actions-and-reusable-workflows-for-an-organization)**,** [**API-2**](https://docs.github.com/en/rest/actions/permissions#list-selected-repositories-enabled-for-github-actions-in-an-organization)
* **Fork pull request workflows από εξωτερικούς συνεργάτες**: Συνιστάται να **απαιτείται έγκριση για όλους** τους εξωτερικούς συνεργάτες.
* _Δεν μπόρεσα να βρω ένα API με αυτές τις πληροφορίες, μοιραστείτε αν το κάνετε_
* **Εκτέλεση workflows από fork pull requests**: Είναι εξαιρετικά **αποθαρρυντικό να εκτελούνται workflows από pull requests** καθώς οι διαχειριστές της προέλευσης του fork θα έχουν τη δυνατότητα να χρησιμοποιούν tokens με δικαιώματα ανάγνωσης στο αποθετήριο προέλευσης.
* _Δεν μπόρεσα να βρω ένα API με αυτές τις πληροφορίες, μοιραστείτε αν το κάνετε_
* **Δικαιώματα workflow**: Συνιστάται έντονα να **δίνονται μόνο δικαιώματα ανάγνωσης αποθετηρίου**. Αποθαρρύνεται να δίνονται δικαιώματα εγγραφής και δημιουργίας/έγκρισης pull requests για να αποφευχθεί η κατάχρηση του GITHUB\_TOKEN που δίνεται στα εκτελούμενα workflows.
* [**API**](https://docs.github.com/en/rest/actions/permissions#get-default-workflow-permissions-for-an-organization)

### Ενσωματώσεις

_Ενημερώστε με αν γνωρίζετε το API endpoint για πρόσβαση σε αυτές τις πληροφορίες!_

* **Πολιτική πρόσβασης τρίτων εφαρμογών**: Συνιστάται να περιορίζεται η πρόσβαση σε κάθε εφαρμογή και να επιτρέπονται μόνο οι απαραίτητες (μετά από έλεγχο).
* **Εγκατεστημένες εφαρμογές GitHub**: Συνιστάται να επιτρέπονται μόνο οι απαραίτητες (μετά από έλεγχο).

## Αναγνώριση & Επιθέσεις καταχρώμενες διαπιστευτήρια

Για αυτό το σενάριο θα υποθέσουμε ότι έχετε αποκτήσει κάποια πρόσβαση σε έναν λογαριασμό github.

### Με Διαπιστευτήρια Χρήστη

Αν με κάποιο τρόπο έχετε ήδη διαπιστευτήρια για έναν χρήστη μέσα σε μια οργάνωση μπορείτε **απλά να συνδεθείτε** και να ελέγξετε ποιοι **ρόλοι επιχείρησης και οργάνωσης έχετε**, αν είστε απλό μέλος, ελέγξτε ποια **δικαιώματα έχουν τα απλά μέλη**, σε ποιες **ομάδες** είστε, ποια **δικαιώματα έχετε** σε ποια **αποθετήρια,** και **πώς προστατεύονται τα αποθετήρια.**

Σημειώστε ότι μπορεί να χρησιμοποιείται **2FA** οπότε θα μπορείτε να έχετε πρόσβαση σε αυτές τις πληροφορίες μόνο αν μπορείτε επίσης να **περάσετε αυτόν τον έλεγχο**.

{% hint style="info" %}
Σημειώστε ότι αν **καταφέρετε να κλέψετε το `user_session` cookie** (επί του παρόντος ρυθμισμένο με SameSite: Lax) μπορείτε **να υποδυθείτε πλήρως τον χρήστη** χωρίς να χρειάζεστε διαπιστευτήρια ή 2FA.
{% endhint %}

Ελέγξτε την ενότητα παρακάτω σχετικά με [**παρακάμψεις προστασίας κλάδων**](./#branch-protection-bypass) σε περίπτωση που είναι χρήσιμη.

### Με SSH Key Χρήστη

Το Github επιτρέπει στους **χρήστες** να ορίζουν **SSH keys** που θα χρησιμοποιούνται ως **μέθοδος αυθεντικοποίησης για την ανάπτυξη κώδικα** εκ μέρους τους (δεν εφαρμόζεται 2FA).

Με αυτό το κλειδί μπορείτε να κάνετε **αλλαγές σε αποθετήρια όπου ο χρήστης έχει κάποια δικαιώματα**, ωστόσο δεν μπορείτε να το χρησιμοποιήσετε για πρόσβαση στο github api για να καταγράψετε το περιβάλλον. Ωστόσο, μπορείτε να **καταγράψετε τοπικές ρυθμίσεις** για να λάβετε πληροφορίες σχετικά με τα αποθετήρια και τον χρήστη που έχετε πρόσβαση:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Αν ο χρήστης έχει ρυθμίσει το όνομα χρήστη του ως το github όνομα χρήστη του, μπορείτε να αποκτήσετε πρόσβαση στα **δημόσια κλειδιά που έχει ορίσει** στον λογαριασμό του στο _https://github.com/\<github\_username>.keys_, μπορείτε να το ελέγξετε αυτό για να επιβεβαιώσετε ότι το ιδιωτικό κλειδί που βρήκατε μπορεί να χρησιμοποιηθεί.

Τα **κλειδιά SSH** μπορούν επίσης να οριστούν σε αποθετήρια ως **deploy keys**. Οποιοσδήποτε έχει πρόσβαση σε αυτό το κλειδί θα μπορεί να **εκκινήσει έργα από ένα αποθετήριο**. Συνήθως σε έναν διακομιστή με διαφορετικά deploy keys, το τοπικό αρχείο **`~/.ssh/config`** θα σας δώσει πληροφορίες σχετικά με το ποιο κλειδί σχετίζεται.

#### GPG Keys

Όπως εξηγείται [**εδώ**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/github-security/broken-reference/README.md) μερικές φορές είναι απαραίτητο να υπογράψετε τις δεσμεύσεις ή μπορεί να ανακαλυφθείτε.

Ελέγξτε τοπικά αν ο τρέχων χρήστης έχει κάποιο κλειδί με:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Με User Token

Για μια εισαγωγή σχετικά με [**User Tokens ελέγξτε τις βασικές πληροφορίες**](basic-github-information.md#personal-access-tokens).

Ένα user token μπορεί να χρησιμοποιηθεί **αντί για κωδικό πρόσβασης** για Git μέσω HTTPS, ή μπορεί να χρησιμοποιηθεί για να [**αυθεντικοποιηθείτε στο API μέσω Basic Authentication**](https://docs.github.com/v3/auth/#basic-authentication). Ανάλογα με τα προνόμια που συνδέονται με αυτό, μπορεί να είστε σε θέση να εκτελέσετε διάφορες ενέργειες.

Ένα User token μοιάζει με αυτό: `ghp_EfHnQFcFHX6fGIu5mpduvRiYR584kK0dX123`

### Με Oauth Application

Για μια εισαγωγή σχετικά με [**Github Oauth Applications ελέγξτε τις βασικές πληροφορίες**](basic-github-information.md#oauth-applications).

Ένας επιτιθέμενος μπορεί να δημιουργήσει μια **κακόβουλη Oauth Application** για να αποκτήσει πρόσβαση σε προνομιούχα δεδομένα/ενέργειες των χρηστών που την αποδέχονται, πιθανώς ως μέρος μιας phishing καμπάνιας.

Αυτές είναι οι [scopes που μπορεί να ζητήσει μια Oauth application](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps). Πρέπει πάντα να ελέγχετε τις scopes που ζητούνται πριν τις αποδεχτείτε.

Επιπλέον, όπως εξηγείται στις βασικές πληροφορίες, **οι οργανισμοί μπορούν να δώσουν/αρνηθούν πρόσβαση σε τρίτες εφαρμογές** σε πληροφορίες/αποθετήρια/ενέργειες που σχετίζονται με τον οργανισμό.

### Με Github Application

Για μια εισαγωγή σχετικά με [**Github Applications ελέγξτε τις βασικές πληροφορίες**](basic-github-information.md#github-applications).

Ένας επιτιθέμενος μπορεί να δημιουργήσει μια **κακόβουλη Github Application** για να αποκτήσει πρόσβαση σε προνομιούχα δεδομένα/ενέργειες των χρηστών που την αποδέχονται, πιθανώς ως μέρος μιας phishing καμπάνιας.

Επιπλέον, όπως εξηγείται στις βασικές πληροφορίες, **οι οργανισμοί μπορούν να δώσουν/αρνηθούν πρόσβαση σε τρίτες εφαρμογές** σε πληροφορίες/αποθετήρια/ενέργειες που σχετίζονται με τον οργανισμό.

## Compromise & Abuse Github Action

Υπάρχουν διάφορες τεχνικές για να παραβιάσετε και να καταχραστείτε μια Github Action, ελέγξτε τις εδώ:

{% content-ref url="abusing-github-actions/" %}
[abusing-github-actions](abusing-github-actions/)
{% endcontent-ref %}

## Παράκαμψη Προστασίας Κλάδων

* **Απαιτήστε έναν αριθμό εγκρίσεων**: Αν έχετε παραβιάσει πολλούς λογαριασμούς, μπορείτε να αποδεχτείτε τα PRs σας από άλλους λογαριασμούς. Αν έχετε μόνο τον λογαριασμό από τον οποίο δημιουργήσατε το PR, δεν μπορείτε να αποδεχτείτε το δικό σας PR. Ωστόσο, αν έχετε πρόσβαση σε ένα **Github Action** περιβάλλον μέσα στο αποθετήριο, χρησιμοποιώντας το **GITHUB\_TOKEN** μπορεί να είστε σε θέση να **εγκρίνετε το PR σας** και να λάβετε 1 έγκριση με αυτόν τον τρόπο.
* _Σημείωση για αυτό και για τον περιορισμό των Code Owners ότι συνήθως ένας χρήστης δεν θα μπορεί να εγκρίνει τα δικά του PRs, αλλά αν μπορεί, μπορεί να το καταχραστεί για να αποδεχτεί τα PRs του._
* **Απορρίψτε εγκρίσεις όταν προωθούνται νέες δεσμεύσεις**: Αν αυτό δεν είναι ρυθμισμένο, μπορείτε να υποβάλετε νόμιμο κώδικα, να περιμένετε μέχρι κάποιος να τον εγκρίνει, και να βάλετε κακόβουλο κώδικα και να τον συγχωνεύσετε στον προστατευμένο κλάδο.
* **Απαιτήστε αναθεωρήσεις από Code Owners**: Αν αυτό είναι ενεργοποιημένο και είστε Code Owner, μπορείτε να κάνετε μια **Github Action να δημιουργήσει το PR σας και στη συνέχεια να το εγκρίνετε μόνοι σας**.
* Όταν ένα **CODEOWNER αρχείο είναι λανθασμένα διαμορφωμένο** το Github δεν παραπονιέται αλλά δεν το χρησιμοποιεί. Επομένως, αν είναι λανθασμένα διαμορφωμένο, η **προστασία των Code Owners δεν εφαρμόζεται.**
* **Επιτρέψτε σε συγκεκριμένους ηθοποιούς να παρακάμψουν τις απαιτήσεις pull request**: Αν είστε ένας από αυτούς τους ηθοποιούς, μπορείτε να παρακάμψετε τις προστασίες pull request.
* **Συμπεριλάβετε διαχειριστές**: Αν αυτό δεν είναι ρυθμισμένο και είστε διαχειριστής του αποθετηρίου, μπορείτε να παρακάμψετε αυτές τις προστασίες κλάδων.
* **PR Hijacking**: Μπορείτε να **τροποποιήσετε το PR κάποιου άλλου** προσθέτοντας κακόβουλο κώδικα, εγκρίνοντας το αποτέλεσμα PR μόνοι σας και συγχωνεύοντας τα πάντα.
* **Αφαίρεση Προστασιών Κλάδων**: Αν είστε **διαχειριστής του αποθετηρίου μπορείτε να απενεργοποιήσετε τις προστασίες**, να συγχωνεύσετε το PR σας και να επαναφέρετε τις προστασίες.
* **Παράκαμψη προστασιών push**: Αν ένα αποθετήριο **επιτρέπει μόνο σε ορισμένους χρήστες** να στέλνουν push (συγχώνευση κώδικα) σε κλάδους (η προστασία κλάδων μπορεί να προστατεύει όλους τους κλάδους καθορίζοντας το wildcard `*`).
* Αν έχετε **δικαιώματα εγγραφής στο αποθετήριο αλλά δεν επιτρέπεται να στείλετε κώδικα** λόγω της προστασίας κλάδων, μπορείτε ακόμα να **δημιουργήσετε έναν νέο κλάδο** και μέσα σε αυτόν να δημιουργήσετε μια **github action που ενεργοποιείται όταν στέλνεται κώδικας**. Καθώς η **προστασία κλάδων δεν θα προστατεύει τον κλάδο μέχρι να δημιουργηθεί**, αυτή η πρώτη αποστολή κώδικα στον κλάδο θα **εκτελέσει τη github action**.

## Παράκαμψη Προστασιών Περιβάλλοντος

Για μια εισαγωγή σχετικά με [**Github Environment ελέγξτε τις βασικές πληροφορίες**](basic-github-information.md#git-environments).

Σε περίπτωση που ένα περιβάλλον μπορεί να **προσπελαστεί από όλους τους κλάδους**, **δεν είναι προστατευμένο** και μπορείτε εύκολα να αποκτήσετε πρόσβαση στα μυστικά μέσα στο περιβάλλον. Σημειώστε ότι μπορεί να βρείτε αποθετήρια όπου **όλοι οι κλάδοι είναι προστατευμένοι** (καθορίζοντας τα ονόματά τους ή χρησιμοποιώντας `*`) σε αυτό το σενάριο, **βρείτε έναν κλάδο όπου μπορείτε να στείλετε κώδικα** και μπορείτε να **εξάγετε** τα μυστικά δημιουργώντας μια νέα github action (ή τροποποιώντας μία).

Σημειώστε ότι μπορεί να βρείτε την ακραία περίπτωση όπου **όλοι οι κλάδοι είναι προστατευμένοι** (μέσω wildcard `*`) και καθορίζεται **ποιος μπορεί να στείλει κώδικα στους κλάδους** (_μπορείτε να το καθορίσετε στην προστασία κλάδων_) και **ο χρήστης σας δεν επιτρέπεται**. Μπορείτε ακόμα να εκτελέσετε μια προσαρμοσμένη github action επειδή μπορείτε να δημιουργήσετε έναν κλάδο και να χρησιμοποιήσετε το push trigger πάνω του. Η **προστασία κλάδων επιτρέπει την αποστολή σε έναν νέο κλάδο, οπότε η github action θα ενεργοποιηθεί**.
```yaml
push: # Run it when a push is made to a branch
branches:
- current_branch_name #Use '**' to run when a push is made to any branch
```
Σημειώστε ότι **μετά τη δημιουργία** του κλάδου η **προστασία κλάδου θα εφαρμοστεί στον νέο κλάδο** και δεν θα μπορείτε να τον τροποποιήσετε, αλλά μέχρι τότε θα έχετε ήδη απορρίψει τα μυστικά.

## Εμμονή

* Δημιουργία **user token**
* Κλοπή **github tokens** από **secrets**
* **Διαγραφή** των **αποτελεσμάτων** και των **κλάδων** του workflow
* Παροχή **περισσότερων δικαιωμάτων σε όλη την οργάνωση**
* Δημιουργία **webhooks** για εξαγωγή πληροφοριών
* Πρόσκληση **εξωτερικών συνεργατών**
* **Αφαίρεση** των **webhooks** που χρησιμοποιούνται από το **SIEM**
* Δημιουργία/τροποποίηση **Github Action** με **backdoor**
* Εύρεση **ευάλωτου Github Action για command injection** μέσω τροποποίησης της τιμής του **secret**

### Imposter Commits - Backdoor μέσω commits του αποθετηρίου

Στο Github είναι δυνατόν να **δημιουργηθεί ένα PR σε ένα αποθετήριο από ένα fork**. Ακόμα και αν το PR **δεν γίνει αποδεκτό**, θα δημιουργηθεί ένα **commit** id μέσα στο αρχικό αποθετήριο για την έκδοση του κώδικα από το fork. Επομένως, ένας επιτιθέμενος **θα μπορούσε να χρησιμοποιήσει ένα συγκεκριμένο commit από ένα φαινομενικά νόμιμο αποθετήριο που δεν δημιουργήθηκε από τον ιδιοκτήτη του αποθετηρίου**.

Όπως [**αυτό**](https://github.com/actions/checkout/commit/c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e):
```yaml
name: example
on: [push]
jobs:
commit:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e
- shell: bash
run: |
echo 'hello world!'
```
Για περισσότερες πληροφορίες ελέγξτε [https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd](https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd)

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Γίνετε μέλος της** 💬 [**ομάδας Discord**](https://discord.gg/hRep4RUj7f) ή της [**ομάδας telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
