# Okta Hardening

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## Verzeichnis

### Personen

Aus der Perspektive eines Angreifers ist dies sehr interessant, da du **alle registrierten Benutzer**, ihre **E-Mail-Adressen**, die **Gruppen**, denen sie angeh√∂ren, **Profile** und sogar **Ger√§te** (Mobiltelefone zusammen mit ihren Betriebssystemen) sehen kannst.

F√ºr eine Whitebox-√úberpr√ºfung √ºberpr√ºfe, dass es nicht mehrere "**Ausstehende Benutzeraktionen**" und "**Passwortzur√ºcksetzungen**" gibt.

### Gruppen

Hier findest du alle in Okta erstellten Gruppen. Es ist interessant, die verschiedenen Gruppen (S√§tze von **Berechtigungen**) zu verstehen, die **Benutzern** gew√§hrt werden k√∂nnten.\
Es ist m√∂glich, die **Personen in den Gruppen** und die **Apps, die jeder Gruppe zugewiesen sind**, zu sehen.

Nat√ºrlich ist jede Gruppe mit dem Namen **admin** interessant, besonders die Gruppe **Global Administrators**. √úberpr√ºfe die Mitglieder, um herauszufinden, wer die privilegiertesten Mitglieder sind.

Aus einer Whitebox-√úberpr√ºfung sollten es **nicht mehr als 5 globale Admins** sein (besser, wenn es nur 2 oder 3 sind).

### Ger√§te

Finde hier eine **Liste aller Ger√§te** aller Benutzer. Du kannst auch sehen, ob sie **aktiv verwaltet** werden oder nicht.

### Profil-Editor

Hier ist es m√∂glich zu beobachten, wie wichtige Informationen wie Vornamen, Nachnamen, E-Mails, Benutzernamen... zwischen Okta und anderen Anwendungen geteilt werden. Dies ist interessant, weil, wenn ein Benutzer ein **Feld in Okta √§ndern kann** (wie seinen Namen oder seine E-Mail), das dann von einer **externen Anwendung** verwendet wird, um den Benutzer zu **identifizieren**, ein Insider versuchen k√∂nnte, **andere Konten zu √ºbernehmen**.

Au√üerdem kannst du im Profil **`User (default)`** von Okta sehen, **welche Felder** jeder **Benutzer** hat und welche von Benutzern **beschreibbar** sind. Wenn du das Admin-Panel nicht sehen kannst, gehe einfach zu **deinem Profil aktualisieren** und du wirst sehen, welche Felder du aktualisieren kannst (beachte, dass du zum Aktualisieren einer E-Mail-Adresse diese verifizieren musst).

### Verzeichnis-Integrationen

Verzeichnisse erm√∂glichen es dir, Personen aus bestehenden Quellen zu importieren. Ich vermute, hier wirst du die aus anderen Verzeichnissen importierten Benutzer sehen.

Ich habe es nicht gesehen, aber ich vermute, es ist interessant herauszufinden, **welche anderen Verzeichnisse Okta verwendet, um Benutzer zu importieren**, sodass du, wenn du **dieses Verzeichnis kompromittierst**, einige Attributwerte in den in Okta erstellten Benutzern festlegen und **vielleicht die Okta-Umgebung kompromittieren** k√∂nntest.

### Profilquellen

Eine Profilquelle ist eine **Anwendung, die als Quelle der Wahrheit** f√ºr Benutzerprofilattribute fungiert. Ein Benutzer kann nur von einer einzigen Anwendung oder einem Verzeichnis gleichzeitig bezogen werden.

Ich habe es nicht gesehen, daher sind alle Informationen √ºber Sicherheit und Hacking in Bezug auf diese Option willkommen.

## Anpassungen

### Marken

√úberpr√ºfe im **Domains**-Tab dieses Abschnitts die E-Mail-Adressen, die zum Senden von E-Mails verwendet werden, und die benutzerdefinierte Domain innerhalb von Okta des Unternehmens (die du wahrscheinlich bereits kennst).

Au√üerdem kannst du im **Einstellungen**-Tab, wenn du Admin bist, eine "**Benutzerdefinierte Abmeldeseite verwenden**" und eine benutzerdefinierte URL festlegen.

### SMS

Nichts Interessantes hier.

### Endbenutzer-Dashboard

Hier kannst du konfigurierte Anwendungen finden, aber wir werden die Details dazu sp√§ter in einem anderen Abschnitt sehen.

### Sonstiges

Interessante Einstellung, aber nichts super Interessantes aus Sicherheitssicht.

## Anwendungen

### Anwendungen

Hier findest du alle **konfigurierten Anwendungen** und deren Details: Wer hat Zugriff auf sie, wie ist sie konfiguriert (SAML, OpenID), URL zum Einloggen, die Zuordnungen zwischen Okta und der Anwendung...

Im **`Sign On`**-Tab gibt es auch ein Feld namens **`Password reveal`**, das einem Benutzer erlauben w√ºrde, **sein Passwort anzuzeigen**, wenn er die Anwendungseinstellungen √ºberpr√ºft. Um die Einstellungen einer Anwendung aus dem Benutzer-Panel zu √ºberpr√ºfen, klicke auf die 3 Punkte:

<figure><img src="../../.gitbook/assets/image (283).png" alt=""><figcaption></figcaption></figure>

Und du k√∂nntest einige weitere Details √ºber die App sehen (wie die Passwortanzeigefunktion, wenn sie aktiviert ist):

<figure><img src="../../.gitbook/assets/image (220).png" alt=""><figcaption></figcaption></figure>

## Identity Governance

### Zugriffszertifizierungen

Verwende Zugriffszertifizierungen, um Audit-Kampagnen zu erstellen, um den Zugriff deiner Benutzer auf Ressourcen regelm√§√üig zu √ºberpr√ºfen und den Zugriff bei Bedarf automatisch zu genehmigen oder zu widerrufen.

Ich habe es nicht verwendet, aber ich vermute, dass es aus defensiver Sicht eine nette Funktion ist.

## Sicherheit

### Allgemein

* **Sicherheitsbenachrichtigungs-E-Mails**: Alle sollten aktiviert sein.
* **CAPTCHA-Integration**: Es wird empfohlen, mindestens das unsichtbare reCaptcha zu setzen.
* **Organisationssicherheit**: Alles kann aktiviert werden und Aktivierungs-E-Mails sollten nicht lange dauern (7 Tage sind ok).
* **Benutzeraufz√§hlungspr√§vention**: Beide sollten aktiviert sein.
* Beachte, dass die Benutzeraufz√§hlungspr√§vention nicht wirksam ist, wenn eine der folgenden Bedingungen erlaubt ist (siehe [Benutzerverwaltung](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) f√ºr weitere Informationen):
* Selbstregistrierung
* JIT-Flows mit E-Mail-Authentifizierung
* **Okta ThreatInsight-Einstellungen**: Protokolliere und erzwinge Sicherheit basierend auf der Bedrohungsstufe.

### HealthInsight

Hier ist es m√∂glich, korrekt und **gef√§hrlich** konfigurierte **Einstellungen** zu finden.

### Authentifikatoren

Hier findest du alle Authentifizierungsmethoden, die ein Benutzer verwenden k√∂nnte: Passwort, Telefon, E-Mail, Code, WebAuthn... Wenn du auf den Passwort-Authentifikator klickst, kannst du die **Passwortrichtlinie** sehen. √úberpr√ºfe, dass sie stark ist.

Im **Enrollment**-Tab kannst du sehen, welche erforderlich oder optional sind:

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

Es wird empfohlen, Telefon zu deaktivieren. Die st√§rksten sind wahrscheinlich eine Kombination aus Passwort, E-Mail und WebAuthn.

### Authentifizierungsrichtlinien

Jede App hat eine Authentifizierungsrichtlinie. Die Authentifizierungsrichtlinie √ºberpr√ºft, ob Benutzer, die versuchen, sich bei der App anzumelden, bestimmte Bedingungen erf√ºllen, und erzwingt Faktorenanforderungen basierend auf diesen Bedingungen.

Hier findest du die **Anforderungen f√ºr den Zugriff auf jede Anwendung**. Es wird empfohlen, mindestens Passwort und eine weitere Methode f√ºr jede Anwendung zu verlangen. Aber wenn du als Angreifer etwas Schw√§cheres findest, k√∂nntest du es m√∂glicherweise angreifen.

### Globale Sitzungsrichtlinie

Hier findest du die Sitzungsrichtlinien, die verschiedenen Gruppen zugewiesen sind. Zum Beispiel:

<figure><img src="../../.gitbook/assets/image (245).png" alt=""><figcaption></figcaption></figure>

Es wird empfohlen, MFA zu verlangen, die Sitzungsdauer auf einige Stunden zu begrenzen, Sitzungscookies nicht √ºber Browsererweiterungen hinweg zu speichern und den Standort und den Identit√§tsanbieter zu begrenzen (wenn dies m√∂glich ist). Zum Beispiel, wenn jeder Benutzer sich aus einem Land anmelden sollte, k√∂nntest du nur diesen Standort zulassen.

### Identit√§tsanbieter

Identit√§tsanbieter (IdPs) sind Dienste, die **Benutzerkonten verwalten**. Das Hinzuf√ºgen von IdPs in Okta erm√∂glicht es deinen Endbenutzern, sich **selbst bei deinen benutzerdefinierten Anwendungen zu registrieren**, indem sie sich zuerst mit einem sozialen Konto oder einer Smartcard authentifizieren.

Auf der Seite Identit√§tsanbieter kannst du soziale Logins (IdPs) hinzuf√ºgen und Okta als Dienstanbieter (SP) konfigurieren, indem du eingehendes SAML hinzuf√ºgst. Nachdem du IdPs hinzugef√ºgt hast, kannst du Routingregeln einrichten, um Benutzer basierend auf dem Kontext, wie dem Standort des Benutzers, dem Ger√§t oder der E-Mail-Domain, zu einem IdP zu leiten.

**Wenn ein Identit√§tsanbieter konfiguriert ist**, √ºberpr√ºfe aus der Perspektive eines Angreifers und Verteidigers diese Konfiguration und **ob die Quelle wirklich vertrauensw√ºrdig ist**, da ein Angreifer, der sie kompromittiert, auch Zugriff auf die Okta-Umgebung erhalten k√∂nnte.

### Delegierte Authentifizierung

Die delegierte Authentifizierung erm√∂glicht es Benutzern, sich bei Okta anzumelden, indem sie Anmeldeinformationen f√ºr den **Active Directory (AD) oder LDAP**-Server ihrer Organisation eingeben.

√úberpr√ºfe dies erneut, da ein Angreifer, der das AD einer Organisation kompromittiert, dank dieser Einstellung m√∂glicherweise zu Okta pivotieren k√∂nnte.

### Netzwerk

Eine Netzwerkzone ist eine konfigurierbare Grenze, die du verwenden kannst, um **den Zugriff auf Computer und Ger√§te** in deiner Organisation basierend auf der **IP-Adresse**, die den Zugriff anfordert, zu gew√§hren oder einzuschr√§nken. Du kannst eine Netzwerkzone definieren, indem du eine oder mehrere einzelne IP-Adressen, Bereiche von IP-Adressen oder geografische Standorte angibst.

Nachdem du eine oder mehrere Netzwerkzonen definiert hast, kannst du **sie in globalen Sitzungsrichtlinien**, **Authentifizierungsrichtlinien**, VPN-Benachrichtigungen und **Routingregeln** verwenden.

Aus der Perspektive eines Angreifers ist es interessant zu wissen, welche IPs erlaubt sind (und zu √ºberpr√ºfen, ob **einige IPs privilegierter** sind als andere). Aus der Perspektive eines Angreifers, wenn die Benutzer von einer bestimmten IP-Adresse oder Region aus zugreifen sollten, √ºberpr√ºfe, ob diese Funktion ordnungsgem√§√ü verwendet wird.

### Ger√§te-Integrationen

* **Endpoint Management**: Endpoint Management ist eine Bedingung, die in einer Authentifizierungsrichtlinie angewendet werden kann, um sicherzustellen, dass verwaltete Ger√§te Zugriff auf eine Anwendung haben.
* Ich habe dies noch nicht verwendet. TODO
* **Benachrichtigungsdienste**: Ich habe dies noch nicht verwendet. TODO

### API

Du kannst auf dieser Seite Okta API-Tokens erstellen und die erstellten Tokens, deren **Berechtigungen**, **Ablaufzeiten** und **Ursprungs-URLs** sehen. Beachte, dass API-Tokens mit den Berechtigungen des Benutzers generiert werden, der das Token erstellt hat, und nur g√ºltig sind, wenn der **Benutzer**, der sie erstellt hat, **aktiv** ist.

Die **Vertrauensw√ºrdigen Urspr√ºnge** gew√§hren Zugriff auf Websites, die du kontrollierst und denen du vertraust, um auf deine Okta-Organisation √ºber die Okta API zuzugreifen.

Es sollte nicht viele API-Tokens geben, da ein Angreifer versuchen k√∂nnte, auf sie zuzugreifen und sie zu verwenden.

## Workflow

### Automatisierungen

Automatisierungen erm√∂glichen es dir, automatisierte Aktionen zu erstellen, die basierend auf einer Reihe von Ausl√∂sebedingungen ausgef√ºhrt werden, die w√§hrend des Lebenszyklus der Endbenutzer auftreten.

Zum Beispiel k√∂nnte eine Bedingung "Benutzerinaktivit√§t in Okta" oder "Benutzerpasswortablauf in Okta" sein und die Aktion k√∂nnte "E-Mail an den Benutzer senden" oder "Benutzerlebenszyklusstatus in Okta √§ndern" sein.

## Berichte

### Berichte

Lade Protokolle herunter. Sie werden **an die **E-Mail-Adresse** des aktuellen Kontos **gesendet**.

### Systemprotokoll

Hier findest du die **Protokolle der von Benutzern durchgef√ºhrten Aktionen** mit vielen Details wie Anmeldungen in Okta oder in Anwendungen √ºber Okta.

### Import√ºberwachung

Dies kann **Protokolle von anderen Plattformen importieren**, die mit Okta zugegriffen werden.

### Ratenlimits

√úberpr√ºfe die erreichten API-Ratenlimits.

## Einstellungen

### Konto

Hier findest du **allgemeine Informationen** √ºber die Okta-Umgebung, wie den Firmennamen, die Adresse, **E-Mail-Abrechnungs-Kontakt**, **E-Mail-Technischer-Kontakt** und auch, wer Okta-Updates erhalten soll und welche Art von Okta-Updates.

### Downloads

Hier kannst du Okta-Agenten herunterladen, um Okta mit anderen Technologien zu synchronisieren.

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
