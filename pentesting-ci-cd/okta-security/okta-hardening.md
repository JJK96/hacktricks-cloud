# Okta Hardening

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Directory

### People

Sa perspektive napadača, ovo je veoma interesantno jer možete videti **sve registrovane korisnike**, njihove **email** adrese, **grupe** kojima pripadaju, **profile** pa čak i **uređaje** (mobilne telefone zajedno sa njihovim operativnim sistemima).

Za whitebox pregled proverite da nema nekoliko "**Pending user action**" i "**Password reset**".

### Groups

Ovde možete pronaći sve kreirane grupe u Okta. Interesantno je razumeti različite grupe (set **dozvola**) koje mogu biti dodeljene **korisnicima**.\
Moguće je videti **ljude uključene u grupe** i **aplikacije dodeljene** svakoj grupi.

Naravno, svaka grupa sa imenom **admin** je interesantna, posebno grupa **Global Administrators,** proverite članove da biste saznali ko su najprivilegovaniji članovi.

Za whitebox pregled, ne bi trebalo da bude više od 5 globalnih admina (bolje ako ih ima samo 2 ili 3).

### Devices

Ovde pronađite **listu svih uređaja** svih korisnika. Takođe možete videti da li se **aktivno upravlja** ili ne.

### Profile Editor

Ovde je moguće posmatrati kako se ključne informacije kao što su imena, prezimena, emailovi, korisnička imena... dele između Okta i drugih aplikacija. Ovo je interesantno jer ako korisnik može **modifikovati polje u Okta** (kao što je njegovo ime ili email) koje se zatim koristi od strane **eksterne aplikacije** za **identifikaciju** korisnika, insajder bi mogao pokušati da **preuzme druge naloge**.

Štaviše, u profilu **`User (default)`** iz Okta možete videti **koja polja** svaki **korisnik** ima i koja su **pisljiva** od strane korisnika. Ako ne možete videti admin panel, samo idite na **ažuriranje vašeg profila** i videćete koja polja možete ažurirati (imajte na umu da za ažuriranje email adrese morate je verifikovati).

### Directory Integrations

Direktorijumi vam omogućavaju da uvezete ljude iz postojećih izvora. Pretpostavljam da ovde možete videti korisnike uvezene iz drugih direktorijuma.

Nisam to video, ali pretpostavljam da je interesantno saznati **druge direktorijume koje Okta koristi za uvoz korisnika** pa ako **kompromitujete taj direktorijum** mogli biste postaviti vrednosti atributa u korisnicima kreiranim u Okta i **možda kompromitovati Okta okruženje**.

### Profile Sources

Izvor profila je **aplikacija koja deluje kao izvor istine** za atribute korisničkog profila. Korisnik može biti izvor samo jedne aplikacije ili direktorijuma u jednom trenutku.

Nisam to video, pa su sve informacije o sigurnosti i hakovanju u vezi sa ovom opcijom dobrodošle.

## Customizations

### Brands

Proverite u kartici **Domains** ovog odeljka email adrese koje se koriste za slanje emailova i prilagođeni domen unutar Okta kompanije (koji verovatno već znate).

Štaviše, u kartici **Setting**, ako ste admin, možete "**Use a custom sign-out page**" i postaviti prilagođeni URL.

### SMS

Ništa interesantno ovde.

### End-User Dashboard

Ovde možete pronaći konfigurirane aplikacije, ali detalje ćemo videti kasnije u drugom odeljku.

### Other

Interesantna postavka, ali ništa super interesantno sa sigurnosne tačke gledišta.

## Applications

### Applications

Ovde možete pronaći sve **konfigurisane aplikacije** i njihove detalje: Ko ima pristup njima, kako je konfigurisano (SAML, OPenID), URL za prijavu, mapiranja između Okta i aplikacije...

U kartici **`Sign On`** postoji i polje pod nazivom **`Password reveal`** koje bi omogućilo korisniku da **otkrije svoju lozinku** kada proverava postavke aplikacije. Da biste proverili postavke aplikacije iz korisničkog panela, kliknite na 3 tačke:

<figure><img src="../../.gitbook/assets/image (283).png" alt=""><figcaption></figcaption></figure>

I mogli biste videti još neke detalje o aplikaciji (kao što je funkcija otkrivanja lozinke, ako je omogućena):

<figure><img src="../../.gitbook/assets/image (220).png" alt=""><figcaption></figcaption></figure>

## Identity Governance

### Access Certifications

Koristite Access Certifications za kreiranje kampanja za reviziju kako biste periodično pregledali pristup korisnika resursima i automatski odobrili ili opozvali pristup kada je to potrebno.

Nisam video da se koristi, ali pretpostavljam da je sa defanzivne tačke gledišta to lepa funkcija.

## Security

### General

* **Security notification emails**: Sve bi trebalo da budu omogućene.
* **CAPTCHA integration**: Preporučuje se postavljanje barem nevidljivog reCaptcha
* **Organization Security**: Sve može biti omogućeno i emailovi za aktivaciju ne bi trebalo da traju dugo (7 dana je ok)
* **User enumeration prevention**: Obe bi trebalo da budu omogućene
* Imajte na umu da User Enumeration Prevention ne stupa na snagu ako je bilo koji od sledećih uslova dozvoljen (Pogledajte [User management](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) za više informacija):
* Self-Service Registration
* JIT flows with email authentication
* **Okta ThreatInsight settings**: Beleži i sprovodi sigurnost na osnovu nivoa pretnje

### HealthInsight

Ovde je moguće pronaći pravilno i **opasno** konfigurisane **postavke**.

### Authenticators

Ovde možete pronaći sve metode autentifikacije koje korisnik može koristiti: Lozinka, telefon, email, kod, WebAuthn... Klikom na autentifikator lozinke možete videti **politiku lozinki**. Proverite da li je jaka.

U kartici **Enrollment** možete videti koje su obavezne ili opcionalne:

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

Preporučuje se onemogućavanje telefona. Najjače su verovatno kombinacija lozinke, emaila i WebAuthn.

### Authentication policies

Svaka aplikacija ima politiku autentifikacije. Politika autentifikacije proverava da li korisnici koji pokušavaju da se prijave u aplikaciju ispunjavaju određene uslove i sprovodi zahteve za faktore na osnovu tih uslova.

Ovde možete pronaći **zahteve za pristup svakoj aplikaciji**. Preporučuje se zahtevati barem lozinku i još jednu metodu za svaku aplikaciju. Ali ako kao napadač pronađete nešto slabije, mogli biste to napasti.

### Global Session Policy

Ovde možete pronaći politike sesija dodeljene različitim grupama. Na primer:

<figure><img src="../../.gitbook/assets/image (245).png" alt=""><figcaption></figcaption></figure>

Preporučuje se zahtevati MFA, ograničiti trajanje sesije na nekoliko sati, ne čuvati kolačiće sesije preko ekstenzija pretraživača i ograničiti lokaciju i Identity Provider (ako je to moguće). Na primer, ako bi svaki korisnik trebalo da se prijavi iz određene zemlje, mogli biste dozvoliti samo tu lokaciju.

### Identity Providers

Identity Providers (IdPs) su usluge koje **upravljaju korisničkim nalozima**. Dodavanje IdPs u Okta omogućava vašim krajnjim korisnicima da se **sami registruju** sa vašim prilagođenim aplikacijama prvo se autentifikujući sa društvenim nalogom ili pametnom karticom.

Na stranici Identity Providers, možete dodati društvene prijave (IdPs) i konfigurisati Okta kao pružaoca usluga (SP) dodavanjem dolaznog SAML-a. Nakon što dodate IdPs, možete postaviti pravila usmeravanja da usmerite korisnike na IdP na osnovu konteksta, kao što su lokacija korisnika, uređaj ili email domen.

**Ako je bilo koji identity provider konfigurisano** sa perspektive napadača i branioca proverite tu konfiguraciju i **da li je izvor zaista pouzdan** jer napadač koji ga kompromituje mogao bi takođe dobiti pristup Okta okruženju.

### Delegated Authentication

Delegated authentication omogućava korisnicima da se prijave u Okta unosom kredencijala za **Active Directory (AD) ili LDAP** server svoje organizacije.

Opet, ponovo proverite ovo, jer napadač koji kompromituje AD organizacije mogao bi zahvaljujući ovoj postavci pivotirati na Okta.

### Network

Mrežna zona je konfigurisana granica koju možete koristiti za **dodeljivanje ili ograničavanje pristupa računarima i uređajima** u vašoj organizaciji na osnovu **IP adrese** koja zahteva pristup. Možete definisati mrežnu zonu specificiranjem jedne ili više pojedinačnih IP adresa, opsega IP adresa ili geografskih lokacija.

Nakon što definišete jednu ili više mrežnih zona, možete ih **koristiti u Global Session Policies**, **authentication policies**, VPN obaveštenjima i **pravilima usmeravanja**.

Sa perspektive napadača interesantno je znati koje IP adrese su dozvoljene (i proveriti da li su neke **IP adrese privilegovanije** od drugih). Sa perspektive napadača, ako bi korisnici trebalo da pristupaju sa određene IP adrese ili regiona, proverite da li se ova funkcija pravilno koristi.

### Device Integrations

* **Endpoint Management**: Upravljanje krajnjim tačkama je uslov koji se može primeniti u politici autentifikacije kako bi se osiguralo da upravljani uređaji imaju pristup aplikaciji.
* Nisam video da se ovo koristi. TODO
* **Notification services**: Nisam video da se ovo koristi. TODO

### API

Možete kreirati Okta API tokene na ovoj stranici i videti one koji su **kreirani**, njihove **privilegije**, **vreme isteka** i **Origin URLs**. Imajte na umu da se API tokeni generišu sa dozvolama korisnika koji je kreirao token i važe samo ako je **korisnik** koji ih je kreirao **aktivan**.

**Trusted Origins** omogućavaju pristup web sajtovima koje kontrolišete i kojima verujete da pristupe vašoj Okta organizaciji putem Okta API-ja.

Ne bi trebalo da bude mnogo API tokena, jer ako ih ima, napadač bi mogao pokušati da im pristupi i koristi ih.

## Workflow

### Automations

Automations vam omogućavaju da kreirate automatizovane akcije koje se pokreću na osnovu skupa uslova okidača koji se javljaju tokom životnog ciklusa krajnjih korisnika.

Na primer, uslov može biti "User inactivity in Okta" ili "User password expiration in Okta" a akcija može biti "Send email to the user" ili "Change user lifecycle state in Okta".

## Reports

### Reports

Preuzmite logove. Oni se **šalju** na **email adresu** trenutnog naloga.

### System Log

Ovde možete pronaći **logove akcija koje su izvršili korisnici** sa puno detalja kao što su prijava u Okta ili u aplikacije putem Okta.

### Import Monitoring

Ovo može **uvoziti logove sa drugih platformi** kojima se pristupa putem Okta.

### Rate limits

Proverite dostignute API rate limits.

## Settings

### Account

Ovde možete pronaći **generičke informacije** o Okta okruženju, kao što su ime kompanije, adresa, **email za naplatu**, **email za tehnički kontakt** i takođe ko bi trebalo da prima Okta ažuriranja i koja vrsta Okta ažuriranja.

### Downloads

Ovde možete preuzeti Okta agente za sinhronizaciju Okta sa drugim tehnologijama.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
