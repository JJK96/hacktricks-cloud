# Okta Hardening

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Directory

### People

Z perspektywy atakującego jest to bardzo interesujące, ponieważ będziesz mógł zobaczyć **wszystkich zarejestrowanych użytkowników**, ich **adresy email**, **grupy**, do których należą, **profile**, a nawet **urządzenia** (telefony komórkowe wraz z ich systemami operacyjnymi).

Dla przeglądu whitebox sprawdź, czy nie ma kilku "**Pending user action**" i "**Password reset**".

### Groups

Tutaj znajdziesz wszystkie utworzone grupy w Okta. Jest to interesujące, aby zrozumieć różne grupy (zestaw **uprawnień**), które mogą być przyznane **użytkownikom**.\
Można zobaczyć **osoby wchodzące w skład grup** i **aplikacje przypisane** do każdej grupy.

Oczywiście, każda grupa z nazwą **admin** jest interesująca, szczególnie grupa **Global Administrators**, sprawdź członków, aby dowiedzieć się, kto ma najwyższe uprawnienia.

Z perspektywy whitebox, **nie powinno być więcej niż 5 globalnych administratorów** (lepiej, jeśli jest tylko 2 lub 3).

### Devices

Znajdź tutaj **listę wszystkich urządzeń** wszystkich użytkowników. Możesz również zobaczyć, czy są **aktywnie zarządzane**, czy nie.

### Profile Editor

Tutaj można obserwować, jak kluczowe informacje, takie jak imiona, nazwiska, adresy email, nazwy użytkowników... są udostępniane między Okta a innymi aplikacjami. Jest to interesujące, ponieważ jeśli użytkownik może **zmodyfikować w Okta pole** (takie jak jego imię lub email), które jest następnie używane przez **zewnętrzną aplikację** do **identyfikacji** użytkownika, osoba wewnętrzna może próbować **przejąć inne konta**.

Ponadto, w profilu **`User (default)`** z Okta można zobaczyć **które pola** ma każdy **użytkownik** i które są **zapisywalne** przez użytkowników. Jeśli nie możesz zobaczyć panelu administracyjnego, po prostu przejdź do **aktualizacji swojego profilu** i zobaczysz, które pola możesz zaktualizować (zauważ, że aby zaktualizować adres email, będziesz musiał go zweryfikować).

### Directory Integrations

Katalogi pozwalają na importowanie osób z istniejących źródeł. Przypuszczam, że tutaj zobaczysz użytkowników importowanych z innych katalogów.

Nie widziałem tego, ale przypuszczam, że jest to interesujące, aby dowiedzieć się **innych katalogów, które Okta używa do importowania użytkowników**, więc jeśli **skompromitujesz ten katalog**, możesz ustawić wartości atrybutów w użytkownikach utworzonych w Okta i **może skompromitować środowisko Okta**.

### Profile Sources

Źródło profilu to **aplikacja, która działa jako źródło prawdy** dla atrybutów profilu użytkownika. Użytkownik może być źródłem tylko jednej aplikacji lub katalogu na raz.

Nie widziałem tego, więc każda informacja na temat bezpieczeństwa i hackingu dotycząca tej opcji jest mile widziana.

## Customizations

### Brands

Sprawdź w zakładce **Domains** tej sekcji adresy email używane do wysyłania emaili oraz niestandardową domenę wewnątrz Okta firmy (którą prawdopodobnie już znasz).

Ponadto, w zakładce **Setting**, jeśli jesteś administratorem, możesz "**Use a custom sign-out page**" i ustawić niestandardowy URL.

### SMS

Nic interesującego tutaj.

### End-User Dashboard

Tutaj możesz znaleźć skonfigurowane aplikacje, ale szczegóły tych zobaczymy później w innej sekcji.

### Other

Interesujące ustawienia, ale nic super interesującego z punktu widzenia bezpieczeństwa.

## Applications

### Applications

Tutaj możesz znaleźć wszystkie **skonfigurowane aplikacje** i ich szczegóły: Kto ma do nich dostęp, jak są skonfigurowane (SAML, OpenID), URL do logowania, mapowania między Okta a aplikacją...

W zakładce **`Sign On`** znajduje się również pole o nazwie **`Password reveal`**, które pozwala użytkownikowi **ujawnić swoje hasło** podczas sprawdzania ustawień aplikacji. Aby sprawdzić ustawienia aplikacji z Panelu Użytkownika, kliknij 3 kropki:

<figure><img src="../../.gitbook/assets/image (283).png" alt=""><figcaption></figcaption></figure>

I możesz zobaczyć więcej szczegółów na temat aplikacji (jak funkcja ujawniania hasła, jeśli jest włączona):

<figure><img src="../../.gitbook/assets/image (220).png" alt=""><figcaption></figcaption></figure>

## Identity Governance

### Access Certifications

Użyj Access Certifications, aby tworzyć kampanie audytowe do okresowego przeglądu dostępu użytkowników do zasobów i automatycznego zatwierdzania lub odwoływania dostępu, gdy jest to wymagane.

Nie widziałem tego używanego, ale przypuszczam, że z defensywnego punktu widzenia jest to fajna funkcja.

## Security

### General

* **Security notification emails**: Wszystkie powinny być włączone.
* **CAPTCHA integration**: Zaleca się ustawienie przynajmniej niewidocznego reCaptcha
* **Organization Security**: Wszystko może być włączone, a emaile aktywacyjne nie powinny trwać długo (7 dni jest ok)
* **User enumeration prevention**: Oba powinny być włączone
* Zauważ, że User Enumeration Prevention nie działa, jeśli którakolwiek z poniższych warunków jest dozwolona (Zobacz [User management](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) po więcej informacji):
* Self-Service Registration
* JIT flows with email authentication
* **Okta ThreatInsight settings**: Loguj i egzekwuj bezpieczeństwo w oparciu o poziom zagrożenia

### HealthInsight

Tutaj można znaleźć poprawnie i **niebezpiecznie** skonfigurowane **ustawienia**.

### Authenticators

Tutaj możesz znaleźć wszystkie metody uwierzytelniania, które użytkownik może używać: Hasło, telefon, email, kod, WebAuthn... Klikając w uwierzytelnianie hasłem, możesz zobaczyć **politykę haseł**. Sprawdź, czy jest silna.

W zakładce **Enrollment** możesz zobaczyć, które są wymagane lub opcjonalne:

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

Zaleca się wyłączenie telefonu. Najsilniejsze są prawdopodobnie kombinacja hasła, emaila i WebAuthn.

### Authentication policies

Każda aplikacja ma politykę uwierzytelniania. Polityka uwierzytelniania weryfikuje, czy użytkownicy próbujący zalogować się do aplikacji spełniają określone warunki i egzekwuje wymagania dotyczące czynników na podstawie tych warunków.

Tutaj możesz znaleźć **wymagania dotyczące dostępu do każdej aplikacji**. Zaleca się żądanie przynajmniej hasła i innej metody dla każdej aplikacji. Ale jeśli jako atakujący znajdziesz coś słabszego, możesz spróbować to zaatakować.

### Global Session Policy

Tutaj możesz znaleźć polityki sesji przypisane do różnych grup. Na przykład:

<figure><img src="../../.gitbook/assets/image (245).png" alt=""><figcaption></figcaption></figure>

Zaleca się żądanie MFA, ograniczenie czasu trwania sesji do kilku godzin, nie przechowywanie ciasteczek sesji w rozszerzeniach przeglądarki i ograniczenie lokalizacji oraz dostawcy tożsamości (jeśli to możliwe). Na przykład, jeśli każdy użytkownik powinien logować się z określonego kraju, możesz zezwolić tylko na tę lokalizację.

### Identity Providers

Identity Providers (IdPs) to usługi, które **zarządzają kontami użytkowników**. Dodanie IdPs w Okta umożliwia użytkownikom końcowym **samodzielną rejestrację** w twoich niestandardowych aplikacjach poprzez najpierw uwierzytelnienie się za pomocą konta społecznościowego lub karty inteligentnej.

Na stronie Identity Providers możesz dodać logowania społecznościowe (IdPs) i skonfigurować Okta jako dostawcę usług (SP) poprzez dodanie przychodzącego SAML. Po dodaniu IdPs, możesz ustawić zasady routingu, aby skierować użytkowników do IdP na podstawie kontekstu, takiego jak lokalizacja użytkownika, urządzenie lub domena email.

**Jeśli jakikolwiek dostawca tożsamości jest skonfigurowany**, z punktu widzenia atakującego i obrońcy sprawdź tę konfigurację i **czy źródło jest naprawdę godne zaufania**, ponieważ atakujący, który skompromituje to źródło, może również uzyskać dostęp do środowiska Okta.

### Delegated Authentication

Delegated authentication pozwala użytkownikom logować się do Okta, wprowadzając dane uwierzytelniające do **Active Directory (AD) lub serwera LDAP** swojej organizacji.

Ponownie, sprawdź to, ponieważ atakujący, który skompromituje AD organizacji, może być w stanie przeskoczyć do Okta dzięki temu ustawieniu.

### Network

Strefa sieciowa to konfigurowalna granica, której możesz użyć do **przyznawania lub ograniczania dostępu do komputerów i urządzeń** w twojej organizacji na podstawie **adresu IP**, który żąda dostępu. Możesz zdefiniować strefę sieciową, określając jeden lub więcej indywidualnych adresów IP, zakresy adresów IP lub lokalizacje geograficzne.

Po zdefiniowaniu jednej lub więcej stref sieciowych, możesz **używać ich w Global Session Policies**, **politykach uwierzytelniania**, powiadomieniach VPN i **zasadach routingu**.

Z perspektywy atakującego interesujące jest wiedzieć, które IP są dozwolone (i sprawdzić, czy jakieś **IP są bardziej uprzywilejowane** niż inne). Z perspektywy atakującego, jeśli użytkownicy powinni uzyskiwać dostęp z określonego adresu IP lub regionu, sprawdź, czy ta funkcja jest używana prawidłowo.

### Device Integrations

* **Endpoint Management**: Zarządzanie punktami końcowymi to warunek, który można zastosować w polityce uwierzytelniania, aby zapewnić, że zarządzane urządzenia mają dostęp do aplikacji.
* Nie widziałem tego jeszcze używanego. TODO
* **Notification services**: Nie widziałem tego jeszcze używanego. TODO

### API

Możesz tworzyć tokeny API Okta na tej stronie i zobaczyć te, które zostały **utworzone**, ich **uprawnienia**, **czas wygaśnięcia** i **URL pochodzenia**. Zauważ, że tokeny API są generowane z uprawnieniami użytkownika, który utworzył token i są ważne tylko wtedy, gdy **użytkownik**, który je utworzył, jest **aktywny**.

**Trusted Origins** przyznają dostęp do stron internetowych, które kontrolujesz i którym ufasz, aby uzyskać dostęp do twojej organizacji Okta przez API Okta.

Nie powinno być dużo tokenów API, ponieważ jeśli są, atakujący może próbować uzyskać do nich dostęp i je wykorzystać.

## Workflow

### Automations

Automations pozwalają na tworzenie zautomatyzowanych działań, które uruchamiają się na podstawie zestawu warunków wyzwalających, które występują podczas cyklu życia użytkowników końcowych.

Na przykład warunkiem może być "User inactivity in Okta" lub "User password expiration in Okta", a działaniem może być "Send email to the user" lub "Change user lifecycle state in Okta".

## Reports

### Reports

Pobierz logi. Są **wysyłane** na **adres email** bieżącego konta.

### System Log

Tutaj możesz znaleźć **logi działań wykonywanych przez użytkowników** z wieloma szczegółami, takimi jak logowanie do Okta lub do aplikacji przez Okta.

### Import Monitoring

To może **importować logi z innych platform** uzyskiwanych przez Okta.

### Rate limits

Sprawdź osiągnięte limity API.

## Settings

### Account

Tutaj możesz znaleźć **ogólne informacje** o środowisku Okta, takie jak nazwa firmy, adres, **kontakt email do rozliczeń**, **kontakt email do spraw technicznych** oraz kto powinien otrzymywać aktualizacje Okta i jakie rodzaje aktualizacji Okta.

### Downloads

Tutaj możesz pobrać agentów Okta do synchronizacji Okta z innymi technologiami.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
