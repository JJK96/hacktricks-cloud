# Okta Hardening

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Directory

### People

Desde la perspectiva de un atacante, esto es muy interesante ya que podr치s ver **todos los usuarios registrados**, sus **direcciones de correo electr칩nico**, los **grupos** a los que pertenecen, **perfiles** e incluso **dispositivos** (m칩viles junto con sus sistemas operativos).

Para una revisi칩n de caja blanca, verifica que no haya varios "**Pending user action**" y "**Password reset**".

### Groups

Aqu칤 es donde encuentras todos los grupos creados en Okta. Es interesante entender los diferentes grupos (conjunto de **permisos**) que podr칤an otorgarse a los **usuarios**.\
Es posible ver las **personas incluidas dentro de los grupos** y las **aplicaciones asignadas** a cada grupo.

Por supuesto, cualquier grupo con el nombre de **admin** es interesante, especialmente el grupo **Global Administrators**, verifica los miembros para saber qui칠nes son los miembros m치s privilegiados.

Desde una revisi칩n de caja blanca, **no deber칤a haber m치s de 5 administradores globales** (mejor si solo hay 2 o 3).

### Devices

Encuentra aqu칤 una **lista de todos los dispositivos** de todos los usuarios. Tambi칠n puedes ver si est치 siendo **gestionado activamente** o no.

### Profile Editor

Aqu칤 es posible observar c칩mo se comparte informaci칩n clave como nombres, apellidos, correos electr칩nicos, nombres de usuario... entre Okta y otras aplicaciones. Esto es interesante porque si un usuario puede **modificar en Okta un campo** (como su nombre o correo electr칩nico) que luego es utilizado por una **aplicaci칩n externa** para **identificar** al usuario, un insider podr칤a intentar **tomar el control de otras cuentas**.

Adem치s, en el perfil **`User (default)`** de Okta puedes ver **qu칠 campos** tiene cada **usuario** y cu치les son **escribibles** por los usuarios. Si no puedes ver el panel de administraci칩n, solo ve a **actualizar tu informaci칩n de perfil** y ver치s qu칠 campos puedes actualizar (ten en cuenta que para actualizar una direcci칩n de correo electr칩nico necesitar치s verificarla).

### Directory Integrations

Los directorios te permiten importar personas de fuentes existentes. Supongo que aqu칤 ver치s a los usuarios importados de otros directorios.

No lo he visto, pero supongo que esto es interesante para descubrir **otros directorios que Okta est치 utilizando para importar usuarios** para que si **comprometes ese directorio** puedas establecer algunos valores de atributos en los usuarios creados en Okta y **tal vez comprometer el entorno de Okta**.

### Profile Sources

Una fuente de perfil es una **aplicaci칩n que act칰a como fuente de verdad** para los atributos del perfil del usuario. Un usuario solo puede ser originado por una sola aplicaci칩n o directorio a la vez.

No lo he visto, as칤 que se agradece cualquier informaci칩n sobre seguridad y hacking respecto a esta opci칩n.

## Customizations

### Brands

Verifica en la pesta침a **Domains** de esta secci칩n las direcciones de correo electr칩nico utilizadas para enviar correos y el dominio personalizado dentro de Okta de la empresa (que probablemente ya conoces).

Adem치s, en la pesta침a **Setting**, si eres administrador, puedes "**Use a custom sign-out page**" y establecer una URL personalizada.

### SMS

Nada interesante aqu칤.

### End-User Dashboard

Aqu칤 puedes encontrar aplicaciones configuradas, pero veremos los detalles de esas m치s adelante en una secci칩n diferente.

### Other

Configuraci칩n interesante, pero nada s칰per interesante desde un punto de vista de seguridad.

## Applications

### Applications

Aqu칤 puedes encontrar todas las **aplicaciones configuradas** y sus detalles: Qui칠n tiene acceso a ellas, c칩mo est치 configurada (SAML, OpenID), URL para iniciar sesi칩n, los mapeos entre Okta y la aplicaci칩n...

En la pesta침a **`Sign On`** tambi칠n hay un campo llamado **`Password reveal`** que permitir칤a a un usuario **revelar su contrase침a** al verificar la configuraci칩n de la aplicaci칩n. Para verificar la configuraci칩n de una aplicaci칩n desde el Panel de Usuario, haz clic en los 3 puntos:

<figure><img src="../../.gitbook/assets/image (283).png" alt=""><figcaption></figcaption></figure>

Y podr칤as ver algunos detalles m치s sobre la aplicaci칩n (como la funci칩n de revelaci칩n de contrase침a, si est치 habilitada):

<figure><img src="../../.gitbook/assets/image (220).png" alt=""><figcaption></figcaption></figure>

## Identity Governance

### Access Certifications

Usa Access Certifications para crear campa침as de auditor칤a para revisar peri칩dicamente el acceso de tus usuarios a los recursos y aprobar o revocar el acceso autom치ticamente cuando sea necesario.

No lo he visto usado, pero supongo que desde un punto de vista defensivo es una buena caracter칤stica.

## Security

### General

* **Security notification emails**: Todos deber칤an estar habilitados.
* **CAPTCHA integration**: Se recomienda configurar al menos el reCaptcha invisible.
* **Organization Security**: Todo puede estar habilitado y los correos de activaci칩n no deber칤an durar mucho (7 d칤as est치 bien).
* **User enumeration prevention**: Ambos deber칤an estar habilitados.
* Ten en cuenta que la Prevenci칩n de Enumeraci칩n de Usuarios no tiene efecto si se permiten cualquiera de las siguientes condiciones (ver [User management](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) para m치s informaci칩n):
* Self-Service Registration
* JIT flows with email authentication
* **Okta ThreatInsight settings**: Registrar y aplicar seguridad basada en el nivel de amenaza.

### HealthInsight

Aqu칤 es posible encontrar configuraciones **correctas** y **peligrosas**.

### Authenticators

Aqu칤 puedes encontrar todos los m칠todos de autenticaci칩n que un usuario podr칤a usar: Contrase침a, tel칠fono, correo electr칩nico, c칩digo, WebAuthn... Al hacer clic en el autenticador de Contrase침a, puedes ver la **pol칤tica de contrase침as**. Verifica que sea fuerte.

En la pesta침a **Enrollment** puedes ver cu치les son obligatorios u opcionales:

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

Es recomendable deshabilitar el Tel칠fono. Los m치s fuertes probablemente sean una combinaci칩n de contrase침a, correo electr칩nico y WebAuthn.

### Authentication policies

Cada aplicaci칩n tiene una pol칤tica de autenticaci칩n. La pol칤tica de autenticaci칩n verifica que los usuarios que intentan iniciar sesi칩n en la aplicaci칩n cumplan con condiciones espec칤ficas y aplica requisitos de factores basados en esas condiciones.

Aqu칤 puedes encontrar los **requisitos para acceder a cada aplicaci칩n**. Se recomienda solicitar al menos contrase침a y otro m칠todo para cada aplicaci칩n. Pero si como atacante encuentras algo m치s d칠bil, podr칤as atacarlo.

### Global Session Policy

Aqu칤 puedes encontrar las pol칤ticas de sesi칩n asignadas a diferentes grupos. Por ejemplo:

<figure><img src="../../.gitbook/assets/image (245).png" alt=""><figcaption></figcaption></figure>

Se recomienda solicitar MFA, limitar la duraci칩n de la sesi칩n a algunas horas, no persistir las cookies de sesi칩n a trav칠s de extensiones del navegador y limitar la ubicaci칩n y el Proveedor de Identidad (si esto es posible). Por ejemplo, si cada usuario deber칤a iniciar sesi칩n desde un pa칤s, podr칤as permitir solo esta ubicaci칩n.

### Identity Providers

Los Proveedores de Identidad (IdPs) son servicios que **gestionan cuentas de usuario**. Agregar IdPs en Okta permite a tus usuarios finales **auto-registrarse** con tus aplicaciones personalizadas autentic치ndose primero con una cuenta social o una tarjeta inteligente.

En la p치gina de Proveedores de Identidad, puedes agregar inicios de sesi칩n sociales (IdPs) y configurar Okta como un proveedor de servicios (SP) agregando SAML entrante. Despu칠s de agregar IdPs, puedes configurar reglas de enrutamiento para dirigir a los usuarios a un IdP basado en el contexto, como la ubicaci칩n del usuario, el dispositivo o el dominio de correo electr칩nico.

**Si alg칰n proveedor de identidad est치 configurado**, desde el punto de vista de un atacante y defensor, verifica esa configuraci칩n y **si la fuente es realmente confiable**, ya que un atacante que lo comprometa tambi칠n podr칤a obtener acceso al entorno de Okta.

### Delegated Authentication

La autenticaci칩n delegada permite a los usuarios iniciar sesi칩n en Okta ingresando credenciales para el **Active Directory (AD) o LDAP** de su organizaci칩n.

Nuevamente, revisa esto, ya que un atacante que comprometa el AD de una organizaci칩n podr칤a pivotar a Okta gracias a esta configuraci칩n.

### Network

Una zona de red es un l칤mite configurable que puedes usar para **otorgar o restringir el acceso a computadoras y dispositivos** en tu organizaci칩n basado en la **direcci칩n IP** que solicita acceso. Puedes definir una zona de red especificando una o m치s direcciones IP individuales, rangos de direcciones IP o ubicaciones geogr치ficas.

Despu칠s de definir una o m치s zonas de red, puedes **usarlas en Pol칤ticas de Sesi칩n Global**, **pol칤ticas de autenticaci칩n**, notificaciones de VPN y **reglas de enrutamiento**.

Desde la perspectiva de un atacante, es interesante saber qu칠 IPs est치n permitidas (y verificar si alguna **IP es m치s privilegiada** que otras). Desde la perspectiva de un atacante, si los usuarios deber칤an estar accediendo desde una direcci칩n IP o regi칩n espec칤fica, verifica que esta funci칩n se use correctamente.

### Device Integrations

* **Endpoint Management**: La gesti칩n de endpoints es una condici칩n que se puede aplicar en una pol칤tica de autenticaci칩n para asegurar que los dispositivos gestionados tengan acceso a una aplicaci칩n.
* No he visto esto usado a칰n. TODO
* **Notification services**: No he visto esto usado a칰n. TODO

### API

Puedes crear tokens de API de Okta en esta p치gina y ver los que han sido **creados**, sus **privilegios**, tiempo de **expiraci칩n** y **URLs de Origen**. Ten en cuenta que los tokens de API se generan con los permisos del usuario que cre칩 el token y son v치lidos solo si el **usuario** que los cre칩 est치 **activo**.

Los **Trusted Origins** otorgan acceso a sitios web que controlas y en los que conf칤as para acceder a tu organizaci칩n Okta a trav칠s de la API de Okta.

No deber칤a haber muchos tokens de API, ya que si los hay, un atacante podr칤a intentar acceder a ellos y usarlos.

## Workflow

### Automations

Las automatizaciones te permiten crear acciones automatizadas que se ejecutan en base a un conjunto de condiciones de activaci칩n que ocurren durante el ciclo de vida de los usuarios finales.

Por ejemplo, una condici칩n podr칤a ser "Inactividad del usuario en Okta" o "Expiraci칩n de la contrase침a del usuario en Okta" y la acci칩n podr칤a ser "Enviar correo electr칩nico al usuario" o "Cambiar el estado del ciclo de vida del usuario en Okta".

## Reports

### Reports

Descargar logs. Se **env칤an** a la **direcci칩n de correo electr칩nico** de la cuenta actual.

### System Log

Aqu칤 puedes encontrar los **logs de las acciones realizadas por los usuarios** con muchos detalles como iniciar sesi칩n en Okta o en aplicaciones a trav칠s de Okta.

### Import Monitoring

Esto puede **importar logs de otras plataformas** accedidas con Okta.

### Rate limits

Verifica los l칤mites de tasa de la API alcanzados.

## Settings

### Account

Aqu칤 puedes encontrar **informaci칩n gen칠rica** sobre el entorno de Okta, como el nombre de la empresa, direcci칩n, **contacto de facturaci칩n por correo electr칩nico**, **contacto t칠cnico por correo electr칩nico** y tambi칠n qui칠n deber칤a recibir actualizaciones de Okta y qu칠 tipo de actualizaciones de Okta.

### Downloads

Aqu칤 puedes descargar agentes de Okta para sincronizar Okta con otras tecnolog칤as.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
