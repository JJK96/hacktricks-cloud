# Fortalecimento do Okta

{% hint style="success" %}
Aprenda e pratique AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprenda e pratique GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo no Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo no telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Diret√≥rio

### Pessoas

Do ponto de vista de um atacante, isso √© super interessante, pois voc√™ poder√° ver **todos os usu√°rios registrados**, seus **endere√ßos de email**, os **grupos** dos quais fazem parte, **perfis** e at√© **dispositivos** (m√≥veis junto com seus sistemas operacionais).

Para uma revis√£o whitebox, verifique se n√£o h√° v√°rios "**A√ß√£o pendente do usu√°rio**" e "**Redefini√ß√£o de senha**".

### Grupos

Aqui voc√™ encontra todos os grupos criados no Okta. √â interessante entender os diferentes grupos (conjunto de **permiss√µes**) que podem ser concedidos aos **usu√°rios**.\
√â poss√≠vel ver as **pessoas inclu√≠das nos grupos** e os **aplicativos atribu√≠dos** a cada grupo.

Claro, qualquer grupo com o nome de **admin** √© interessante, especialmente o grupo **Global Administrators**, verifique os membros para saber quem s√£o os membros mais privilegiados.

Em uma revis√£o whitebox, **n√£o deve haver mais de 5 administradores globais** (melhor se houver apenas 2 ou 3).

### Dispositivos

Encontre aqui uma **lista de todos os dispositivos** de todos os usu√°rios. Voc√™ tamb√©m pode ver se est√° sendo **gerenciado ativamente** ou n√£o.

### Editor de Perfil

Aqui √© poss√≠vel observar como informa√ß√µes chave, como nomes, sobrenomes, emails, nomes de usu√°rio... s√£o compartilhadas entre Okta e outras aplica√ß√µes. Isso √© interessante porque se um usu√°rio pode **modificar um campo no Okta** (como seu nome ou email) que √© usado por uma **aplica√ß√£o externa** para **identificar** o usu√°rio, um insider poderia tentar **assumir outras contas**.

Al√©m disso, no perfil **`User (default)`** do Okta, voc√™ pode ver **quais campos** cada **usu√°rio** possui e quais s√£o **edit√°veis** pelos usu√°rios. Se voc√™ n√£o puder ver o painel de administra√ß√£o, basta ir para **atualizar suas informa√ß√µes de perfil** e voc√™ ver√° quais campos pode atualizar (observe que para atualizar um endere√ßo de email, voc√™ precisar√° verific√°-lo).

### Integra√ß√µes de Diret√≥rio

Os diret√≥rios permitem importar pessoas de fontes existentes. Acho que aqui voc√™ ver√° os usu√°rios importados de outros diret√≥rios.

Eu n√£o vi isso, mas acho que √© interessante descobrir **outros diret√≥rios que o Okta est√° usando para importar usu√°rios**, ent√£o se voc√™ **comprometer esse diret√≥rio**, poder√° definir alguns valores de atributos nos usu√°rios criados no Okta e **talvez comprometer o ambiente Okta**.

### Fontes de Perfil

Uma fonte de perfil √© uma **aplica√ß√£o que atua como uma fonte de verdade** para atributos de perfil de usu√°rio. Um usu√°rio s√≥ pode ser originado por uma √∫nica aplica√ß√£o ou diret√≥rio por vez.

Eu n√£o vi isso, ent√£o qualquer informa√ß√£o sobre seguran√ßa e hacking em rela√ß√£o a essa op√ß√£o √© apreciada.

## Personaliza√ß√µes

### Marcas

Verifique na aba **Dom√≠nios** desta se√ß√£o os endere√ßos de email usados para enviar emails e o dom√≠nio personalizado dentro do Okta da empresa (que voc√™ provavelmente j√° conhece).

Al√©m disso, na aba **Configura√ß√µes**, se voc√™ for administrador, pode "**Usar uma p√°gina de logout personalizada**" e definir uma URL personalizada.

### SMS

Nada interessante aqui.

### Painel do Usu√°rio Final

Voc√™ pode encontrar aqui aplicativos configurados, mas veremos os detalhes deles mais tarde em uma se√ß√£o diferente.

### Outros

Configura√ß√£o interessante, mas nada super interessante do ponto de vista de seguran√ßa.

## Aplica√ß√µes

### Aplica√ß√µes

Aqui voc√™ pode encontrar todas as **aplica√ß√µes configuradas** e seus detalhes: Quem tem acesso a elas, como est√° configurado (SAML, OpenID), URL para login, os mapeamentos entre Okta e a aplica√ß√£o...

Na aba **`Sign On`** h√° tamb√©m um campo chamado **`Password reveal`** que permitiria a um usu√°rio **revelar sua senha** ao verificar as configura√ß√µes da aplica√ß√£o. Para verificar as configura√ß√µes de uma aplica√ß√£o no Painel do Usu√°rio, clique nos 3 pontos:

<figure><img src="../../.gitbook/assets/image (283).png" alt=""><figcaption></figcaption></figure>

E voc√™ poder√° ver mais alguns detalhes sobre o aplicativo (como o recurso de revela√ß√£o de senha, se estiver habilitado):

<figure><img src="../../.gitbook/assets/image (220).png" alt=""><figcaption></figcaption></figure>

## Governan√ßa de Identidade

### Certifica√ß√µes de Acesso

Use Certifica√ß√µes de Acesso para criar campanhas de auditoria para revisar periodicamente o acesso dos seus usu√°rios aos recursos e aprovar ou revogar o acesso automaticamente quando necess√°rio.

Eu n√£o vi isso sendo usado, mas acho que do ponto de vista defensivo √© um recurso interessante.

## Seguran√ßa

### Geral

* **Emails de notifica√ß√£o de seguran√ßa**: Todos devem estar habilitados.
* **Integra√ß√£o CAPTCHA**: √â recomend√°vel configurar pelo menos o reCaptcha invis√≠vel.
* **Seguran√ßa da Organiza√ß√£o**: Tudo pode ser habilitado e os emails de ativa√ß√£o n√£o devem durar muito (7 dias est√° ok).
* **Preven√ß√£o de enumera√ß√£o de usu√°rios**: Ambos devem estar habilitados.
* Observe que a Preven√ß√£o de Enumera√ß√£o de Usu√°rios n√£o entra em vigor se qualquer uma das seguintes condi√ß√µes for permitida (Veja [Gerenciamento de usu√°rios](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) para mais informa√ß√µes):
* Registro de Autoatendimento
* Fluxos JIT com autentica√ß√£o por email
* **Configura√ß√µes do Okta ThreatInsight**: Registrar e aplicar seguran√ßa com base no n√≠vel de amea√ßa.

### HealthInsight

Aqui √© poss√≠vel encontrar **configura√ß√µes** corretamente e **perigosamente** configuradas.

### Autenticadores

Aqui voc√™ pode encontrar todos os m√©todos de autentica√ß√£o que um usu√°rio poderia usar: Senha, telefone, email, c√≥digo, WebAuthn... Clicando no autenticador de Senha, voc√™ pode ver a **pol√≠tica de senha**. Verifique se √© forte.

Na aba **Enrollment**, voc√™ pode ver quais s√£o obrigat√≥rios ou opcionais:

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

√â recomend√°vel desativar o Telefone. Os mais fortes s√£o provavelmente uma combina√ß√£o de senha, email e WebAuthn.

### Pol√≠ticas de Autentica√ß√£o

Cada aplicativo tem uma pol√≠tica de autentica√ß√£o. A pol√≠tica de autentica√ß√£o verifica se os usu√°rios que tentam fazer login no aplicativo atendem a condi√ß√µes espec√≠ficas e aplica requisitos de fator com base nessas condi√ß√µes.

Aqui voc√™ pode encontrar os **requisitos para acessar cada aplica√ß√£o**. √â recomend√°vel solicitar pelo menos senha e outro m√©todo para cada aplica√ß√£o. Mas se como atacante voc√™ encontrar algo mais fraco, poder√° atac√°-lo.

### Pol√≠tica de Sess√£o Global

Aqui voc√™ pode encontrar as pol√≠ticas de sess√£o atribu√≠das a diferentes grupos. Por exemplo:

<figure><img src="../../.gitbook/assets/image (245).png" alt=""><figcaption></figcaption></figure>

√â recomend√°vel solicitar MFA, limitar o tempo de vida da sess√£o a algumas horas, n√£o persistir cookies de sess√£o em extens√µes de navegador e limitar a localiza√ß√£o e o Provedor de Identidade (se isso for poss√≠vel). Por exemplo, se todos os usu√°rios devem fazer login de um pa√≠s, voc√™ poderia permitir apenas essa localiza√ß√£o.

### Provedores de Identidade

Provedores de Identidade (IdPs) s√£o servi√ßos que **gerenciam contas de usu√°rios**. Adicionar IdPs no Okta permite que seus usu√°rios finais **se registrem** em suas aplica√ß√µes personalizadas, autenticando-se primeiro com uma conta social ou um cart√£o inteligente.

Na p√°gina de Provedores de Identidade, voc√™ pode adicionar logins sociais (IdPs) e configurar o Okta como um provedor de servi√ßos (SP) adicionando SAML de entrada. Depois de adicionar IdPs, voc√™ pode configurar regras de roteamento para direcionar usu√°rios a um IdP com base no contexto, como a localiza√ß√£o do usu√°rio, dispositivo ou dom√≠nio de email.

**Se algum provedor de identidade estiver configurado**, do ponto de vista de atacantes e defensores, verifique essa configura√ß√£o e **se a fonte √© realmente confi√°vel**, pois um atacante comprometendo-a tamb√©m poderia obter acesso ao ambiente Okta.

### Autentica√ß√£o Delegada

A autentica√ß√£o delegada permite que os usu√°rios fa√ßam login no Okta inserindo credenciais do **Active Directory (AD) ou servidor LDAP** de sua organiza√ß√£o.

Novamente, verifique isso, pois um atacante comprometendo o AD de uma organiza√ß√£o poderia ser capaz de pivotar para o Okta gra√ßas a essa configura√ß√£o.

### Rede

Uma zona de rede √© um limite configur√°vel que voc√™ pode usar para **conceder ou restringir o acesso a computadores e dispositivos** em sua organiza√ß√£o com base no **endere√ßo IP** que est√° solicitando acesso. Voc√™ pode definir uma zona de rede especificando um ou mais endere√ßos IP individuais, intervalos de endere√ßos IP ou locais geogr√°ficos.

Depois de definir uma ou mais zonas de rede, voc√™ pode **us√°-las em Pol√≠ticas de Sess√£o Global**, **pol√≠ticas de autentica√ß√£o**, notifica√ß√µes de VPN e **regras de roteamento**.

Do ponto de vista de um atacante, √© interessante saber quais IPs s√£o permitidos (e verificar se algum **IP √© mais privilegiado** do que outros). Do ponto de vista de um atacante, se os usu√°rios devem acessar de um endere√ßo IP ou regi√£o espec√≠fica, verifique se esse recurso est√° sendo usado corretamente.

### Integra√ß√µes de Dispositivos

* **Gerenciamento de Endpoint**: O gerenciamento de endpoint √© uma condi√ß√£o que pode ser aplicada em uma pol√≠tica de autentica√ß√£o para garantir que dispositivos gerenciados tenham acesso a uma aplica√ß√£o.
* Eu ainda n√£o vi isso sendo usado. TODO
* **Servi√ßos de notifica√ß√£o**: Eu ainda n√£o vi isso sendo usado. TODO

### API

Voc√™ pode criar tokens de API do Okta nesta p√°gina e ver os que foram **criados**, seus **privil√©gios**, tempo de **expira√ß√£o** e **URLs de Origem**. Observe que os tokens de API s√£o gerados com as permiss√µes do usu√°rio que criou o token e s√£o v√°lidos apenas se o **usu√°rio** que os criou estiver **ativo**.

As **Origens Confi√°veis** concedem acesso a sites que voc√™ controla e confia para acessar sua organiza√ß√£o Okta atrav√©s da API Okta.

N√£o deve haver muitos tokens de API, pois se houver, um atacante poderia tentar acess√°-los e us√°-los.

## Workflow

### Automa√ß√µes

As automa√ß√µes permitem criar a√ß√µes automatizadas que s√£o executadas com base em um conjunto de condi√ß√µes de gatilho que ocorrem durante o ciclo de vida dos usu√°rios finais.

Por exemplo, uma condi√ß√£o poderia ser "Inatividade do usu√°rio no Okta" ou "Expira√ß√£o da senha do usu√°rio no Okta" e a a√ß√£o poderia ser "Enviar email para o usu√°rio" ou "Alterar o estado do ciclo de vida do usu√°rio no Okta".

## Relat√≥rios

### Relat√≥rios

Baixe logs. Eles s√£o **enviados** para o **endere√ßo de email** da conta atual.

### Log do Sistema

Aqui voc√™ pode encontrar os **logs das a√ß√µes realizadas pelos usu√°rios** com muitos detalhes, como login no Okta ou em aplica√ß√µes atrav√©s do Okta.

### Monitoramento de Importa√ß√£o

Isso pode **importar logs de outras plataformas** acessadas com o Okta.

### Limites de Taxa

Verifique os limites de taxa da API atingidos.

## Configura√ß√µes

### Conta

Aqui voc√™ pode encontrar **informa√ß√µes gen√©ricas** sobre o ambiente Okta, como o nome da empresa, endere√ßo, **contato de faturamento por email**, **contato t√©cnico por email** e tamb√©m quem deve receber atualiza√ß√µes do Okta e que tipo de atualiza√ß√µes do Okta.

### Downloads

Aqui voc√™ pode baixar agentes do Okta para sincronizar o Okta com outras tecnologias.

{% hint style="success" %}
Aprenda e pratique AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprenda e pratique GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo no Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo no telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
