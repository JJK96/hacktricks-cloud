# Okta Hardening

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Γίνετε μέλος της** 💬 [**ομάδας Discord**](https://discord.gg/hRep4RUj7f) ή της [**ομάδας telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}

## Κατάλογος

### Άτομα

Από την οπτική γωνία ενός επιτιθέμενου, αυτό είναι πολύ ενδιαφέρον καθώς θα μπορείτε να δείτε **όλους τους εγγεγραμμένους χρήστες**, τις **διευθύνσεις email** τους, τις **ομάδες** στις οποίες ανήκουν, τα **προφίλ** και ακόμη και τις **συσκευές** (κινητά μαζί με τα λειτουργικά τους συστήματα).

Για έναν έλεγχο whitebox, ελέγξτε ότι δεν υπάρχουν πολλές "**Εκκρεμείς ενέργειες χρήστη**" και "**Επαναφορά κωδικού πρόσβασης**".

### Ομάδες

Εδώ βρίσκονται όλες οι δημιουργημένες ομάδες στο Okta. Είναι ενδιαφέρον να κατανοήσετε τις διάφορες ομάδες (σύνολο **δικαιωμάτων**) που θα μπορούσαν να χορηγηθούν σε **χρήστες**.\
Είναι δυνατό να δείτε τα **άτομα που περιλαμβάνονται στις ομάδες** και τις **εφαρμογές που έχουν ανατεθεί** σε κάθε ομάδα.

Φυσικά, οποιαδήποτε ομάδα με το όνομα **admin** είναι ενδιαφέρουσα, ειδικά η ομάδα **Global Administrators**, ελέγξτε τα μέλη για να μάθετε ποιοι είναι τα πιο προνομιούχα μέλη.

Από έναν έλεγχο whitebox, δεν **πρέπει να υπάρχουν περισσότερα από 5 global admins** (καλύτερα αν υπάρχουν μόνο 2 ή 3).

### Συσκευές

Βρείτε εδώ μια **λίστα με όλες τις συσκευές** όλων των χρηστών. Μπορείτε επίσης να δείτε αν είναι **ενεργά διαχειριζόμενες** ή όχι.

### Επεξεργαστής Προφίλ

Εδώ είναι δυνατό να παρατηρήσετε πώς βασικές πληροφορίες όπως ονόματα, επώνυμα, emails, usernames... μοιράζονται μεταξύ του Okta και άλλων εφαρμογών. Αυτό είναι ενδιαφέρον γιατί αν ένας χρήστης μπορεί να **τροποποιήσει στο Okta ένα πεδίο** (όπως το όνομά του ή το email του) που στη συνέχεια χρησιμοποιείται από μια **εξωτερική εφαρμογή** για να **ταυτοποιήσει** τον χρήστη, ένας εσωτερικός χρήστης θα μπορούσε να προσπαθήσει να **καταλάβει άλλους λογαριασμούς**.

Επιπλέον, στο προφίλ **`User (default)`** από το Okta μπορείτε να δείτε **ποια πεδία** έχει κάθε **χρήστης** και ποια είναι **εγγράψιμα** από τους χρήστες. Αν δεν μπορείτε να δείτε τον πίνακα διαχείρισης, απλά πηγαίνετε να **ενημερώσετε τις πληροφορίες του προφίλ σας** και θα δείτε ποια πεδία μπορείτε να ενημερώσετε (σημειώστε ότι για να ενημερώσετε μια διεύθυνση email θα χρειαστεί να την επαληθεύσετε).

### Ενσωματώσεις Καταλόγου

Οι κατάλογοι σας επιτρέπουν να εισάγετε άτομα από υπάρχουσες πηγές. Υποθέτω ότι εδώ θα δείτε τους χρήστες που εισάγονται από άλλους καταλόγους.

Δεν το έχω δει, αλλά υποθέτω ότι είναι ενδιαφέρον να βρείτε **άλλους καταλόγους που χρησιμοποιεί το Okta για να εισάγει χρήστες** ώστε αν **παραβιάσετε αυτόν τον κατάλογο** να μπορέσετε να ορίσετε κάποιες τιμές χαρακτηριστικών στους χρήστες που δημιουργούνται στο Okta και **ίσως να παραβιάσετε το περιβάλλον του Okta**.

### Πηγές Προφίλ

Μια πηγή προφίλ είναι μια **εφαρμογή που λειτουργεί ως πηγή αλήθειας** για τα χαρακτηριστικά του προφίλ χρήστη. Ένας χρήστης μπορεί να προέρχεται μόνο από μια εφαρμογή ή κατάλογο κάθε φορά.

Δεν το έχω δει, οπότε οποιαδήποτε πληροφορία σχετικά με την ασφάλεια και το hacking αυτής της επιλογής είναι ευπρόσδεκτη.

## Προσαρμογές

### Μάρκες

Ελέγξτε στην καρτέλα **Domains** αυτής της ενότητας τις διευθύνσεις email που χρησιμοποιούνται για την αποστολή emails και το προσαρμοσμένο domain μέσα στο Okta της εταιρείας (το οποίο πιθανώς ήδη γνωρίζετε).

Επιπλέον, στην καρτέλα **Setting**, αν είστε διαχειριστής, μπορείτε να "**Χρησιμοποιήσετε μια προσαρμοσμένη σελίδα αποσύνδεσης**" και να ορίσετε μια προσαρμοσμένη URL.

### SMS

Τίποτα ενδιαφέρον εδώ.

### Πίνακας Ελέγχου Τελικού Χρήστη

Εδώ μπορείτε να βρείτε τις εφαρμογές που έχουν ρυθμιστεί, αλλά θα δούμε τις λεπτομέρειες αυτών αργότερα σε μια διαφορετική ενότητα.

### Άλλα

Ενδιαφέρουσα ρύθμιση, αλλά τίποτα εξαιρετικά ενδιαφέρον από την άποψη της ασφάλειας.

## Εφαρμογές

### Εφαρμογές

Εδώ μπορείτε να βρείτε όλες τις **ρυθμισμένες εφαρμογές** και τις λεπτομέρειές τους: Ποιος έχει πρόσβαση σε αυτές, πώς είναι ρυθμισμένες (SAML, OpenID), URL για σύνδεση, οι αντιστοιχίσεις μεταξύ του Okta και της εφαρμογής...

Στην καρτέλα **`Sign On`** υπάρχει επίσης ένα πεδίο που ονομάζεται **`Password reveal`** που θα επιτρέψει σε έναν χρήστη να **αποκαλύψει τον κωδικό πρόσβασής του** όταν ελέγχει τις ρυθμίσεις της εφαρμογής. Για να ελέγξετε τις ρυθμίσεις μιας εφαρμογής από τον Πίνακα Χρήστη, κάντε κλικ στις 3 τελείες:

<figure><img src="../../.gitbook/assets/image (283).png" alt=""><figcaption></figcaption></figure>

Και θα μπορούσατε να δείτε μερικές περισσότερες λεπτομέρειες για την εφαρμογή (όπως τη δυνατότητα αποκάλυψης κωδικού πρόσβασης, αν είναι ενεργοποιημένη):

<figure><img src="../../.gitbook/assets/image (220).png" alt=""><figcaption></figcaption></figure>

## Διακυβέρνηση Ταυτότητας

### Πιστοποιήσεις Πρόσβασης

Χρησιμοποιήστε τις Πιστοποιήσεις Πρόσβασης για να δημιουργήσετε εκστρατείες ελέγχου για να αναθεωρείτε περιοδικά την πρόσβαση των χρηστών σας σε πόρους και να εγκρίνετε ή να ανακαλείτε την πρόσβαση αυτόματα όταν απαιτείται.

Δεν το έχω δει να χρησιμοποιείται, αλλά υποθέτω ότι από την αμυντική άποψη είναι μια καλή δυνατότητα.

## Ασφάλεια

### Γενικά

* **Emails ειδοποίησης ασφαλείας**: Όλα πρέπει να είναι ενεργοποιημένα.
* **Ενσωμάτωση CAPTCHA**: Συνιστάται να ορίσετε τουλάχιστον το αόρατο reCaptcha
* **Ασφάλεια Οργανισμού**: Όλα μπορούν να είναι ενεργοποιημένα και τα emails ενεργοποίησης δεν πρέπει να διαρκούν πολύ (7 ημέρες είναι εντάξει)
* **Πρόληψη καταχώρησης χρηστών**: Και τα δύο πρέπει να είναι ενεργοποιημένα
* Σημειώστε ότι η Πρόληψη Καταχώρησης Χρηστών δεν ισχύει αν επιτρέπονται οι παρακάτω συνθήκες (Δείτε [Διαχείριση χρηστών](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) για περισσότερες πληροφορίες):
* Εγγραφή αυτοεξυπηρέτησης
* Ροές JIT με έλεγχο ταυτότητας μέσω email
* **Ρυθμίσεις Okta ThreatInsight**: Καταγραφή και επιβολή ασφάλειας βάσει επιπέδου απειλής

### HealthInsight

Εδώ είναι δυνατό να βρείτε σωστά και **επικίνδυνα** ρυθμισμένες **ρυθμίσεις**.

### Αυθεντικοποιητές

Εδώ μπορείτε να βρείτε όλες τις μεθόδους αυθεντικοποίησης που θα μπορούσε να χρησιμοποιήσει ένας χρήστης: Κωδικός πρόσβασης, τηλέφωνο, email, κωδικός, WebAuthn... Κάνοντας κλικ στον αυθεντικοποιητή Κωδικού πρόσβασης μπορείτε να δείτε την **πολιτική κωδικού πρόσβασης**. Ελέγξτε ότι είναι ισχυρή.

Στην καρτέλα **Enrollment** μπορείτε να δείτε ποιες είναι υποχρεωτικές ή προαιρετικές:

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

Συνιστάται να απενεργοποιήσετε το Τηλέφωνο. Οι πιο ισχυρές είναι πιθανώς ένας συνδυασμός κωδικού πρόσβασης, email και WebAuthn.

### Πολιτικές Αυθεντικοποίησης

Κάθε εφαρμογή έχει μια πολιτική αυθεντικοποίησης. Η πολιτική αυθεντικοποίησης επαληθεύει ότι οι χρήστες που προσπαθούν να συνδεθούν στην εφαρμογή πληρούν συγκεκριμένες συνθήκες και επιβάλλει απαιτήσεις παραγόντων βάσει αυτών των συνθηκών.

Εδώ μπορείτε να βρείτε τις **απαιτήσεις για πρόσβαση σε κάθε εφαρμογή**. Συνιστάται να ζητάτε τουλάχιστον κωδικό πρόσβασης και μια άλλη μέθοδο για κάθε εφαρμογή. Αλλά αν ως επιτιθέμενος βρείτε κάτι πιο αδύναμο, μπορεί να μπορέσετε να το επιτεθείτε.

### Πολιτική Παγκόσμιας Συνεδρίας

Εδώ μπορείτε να βρείτε τις πολιτικές συνεδρίας που έχουν ανατεθεί σε διάφορες ομάδες. Για παράδειγμα:

<figure><img src="../../.gitbook/assets/image (245).png" alt=""><figcaption></figcaption></figure>

Συνιστάται να ζητάτε MFA, να περιορίζετε τη διάρκεια της συνεδρίας σε μερικές ώρες, να μην επιμένετε στα cookies συνεδρίας σε επεκτάσεις προγράμματος περιήγησης και να περιορίζετε την τοποθεσία και τον Παροχέα Ταυτότητας (αν αυτό είναι δυνατό). Για παράδειγμα, αν κάθε χρήστης πρέπει να συνδέεται από μια χώρα, θα μπορούσατε να επιτρέψετε μόνο αυτήν την τοποθεσία.

### Παροχείς Ταυτότητας

Οι Παροχείς Ταυτότητας (IdPs) είναι υπηρεσίες που **διαχειρίζονται λογαριασμούς χρηστών**. Η προσθήκη IdPs στο Okta επιτρέπει στους τελικούς χρήστες σας να **εγγράφονται μόνοι τους** στις προσαρμοσμένες εφαρμογές σας πρώτα αυθεντικοποιώντας με έναν κοινωνικό λογαριασμό ή μια έξυπνη κάρτα.

Στη σελίδα Παροχείς Ταυτότητας, μπορείτε να προσθέσετε κοινωνικές συνδέσεις (IdPs) και να ρυθμίσετε το Okta ως πάροχο υπηρεσιών (SP) προσθέτοντας εισερχόμενο SAML. Αφού προσθέσετε IdPs, μπορείτε να ρυθμίσετε κανόνες δρομολόγησης για να κατευθύνετε τους χρήστες σε έναν IdP βάσει του πλαισίου, όπως η τοποθεσία του χρήστη, η συσκευή ή το domain email.

**Αν έχει ρυθμιστεί κάποιος παροχέας ταυτότητας**, από την οπτική γωνία ενός επιτιθέμενου και ενός αμυντικού, ελέγξτε αυτήν τη ρύθμιση και **αν η πηγή είναι πραγματικά αξιόπιστη**, καθώς ένας επιτιθέμενος που θα την παραβιάσει θα μπορούσε επίσης να αποκτήσει πρόσβαση στο περιβάλλον του Okta.

### Εξουσιοδοτημένη Αυθεντικοποίηση

Η εξουσιοδοτημένη αυθεντικοποίηση επιτρέπει στους χρήστες να συνδέονται στο Okta εισάγοντας διαπιστευτήρια για τον **Active Directory (AD) ή τον LDAP** διακομιστή του οργανισμού τους.

Ξαναελέγξτε αυτό, καθώς ένας επιτιθέμενος που θα παραβιάσει τον AD του οργανισμού θα μπορούσε να μπορέσει να μεταβεί στο Okta χάρη σε αυτήν τη ρύθμιση.

### Δίκτυο

Μια ζώνη δικτύου είναι ένα διαμορφώσιμο όριο που μπορείτε να χρησιμοποιήσετε για να **χορηγήσετε ή να περιορίσετε την πρόσβαση σε υπολογιστές και συσκευές** στον οργανισμό σας βάσει της **διεύθυνσης IP** που ζητάει πρόσβαση. Μπορείτε να ορίσετε μια ζώνη δικτύου καθορίζοντας μία ή περισσότερες μεμονωμένες διευθύνσεις IP, εύρη διευθύνσεων IP ή γεωγραφικές τοποθεσίες.

Αφού ορίσετε μία ή περισσότερες ζώνες δικτύου, μπορείτε να τις **χρησιμοποιήσετε στις Πολιτικές Παγκόσμιας Συνεδρίας**, **πολιτικές αυθεντικοποίησης**, ειδοποιήσεις VPN και **κανόνες δρομολόγησης**.

Από την οπτική γωνία ενός επιτιθέμενου, είναι ενδιαφέρον να γνωρίζετε ποιες IPs επιτρέπονται (και να ελέγξετε αν κάποιες **IPs είναι πιο προνομιούχες** από άλλες). Από την οπτική γωνία ενός επιτιθέμενου, αν οι χρήστες πρέπει να έχουν πρόσβαση από μια συγκεκριμένη διεύθυνση IP ή περιοχή, ελέγξτε ότι αυτή η δυνατότητα χρησιμοποιείται σωστά.

### Ενσωματώσεις Συσκευών

* **Διαχείριση Τερματικών**: Η διαχείριση τερματικών είναι μια συνθήκη που μπορεί να εφαρμοστεί σε μια πολιτική αυθεντικοποίησης για να διασφαλιστεί ότι οι διαχειριζόμενες συσκευές έχουν πρόσβαση σε μια εφαρμογή.
* Δεν το έχω δει να χρησιμοποιείται ακόμα. TODO
* **Υπηρεσίες ειδοποίησης**: Δεν το έχω δει να χρησιμοποιείται ακόμα. TODO

### API

Μπορείτε να δημιουργήσετε Okta API tokens σε αυτήν τη σελίδα και να δείτε αυτά που έχουν **δημιουργηθεί**, τα **δικαιώματά** τους, τον **χρόνο λήξης** και τις **Origin URLs**. Σημειώστε ότι τα API tokens δημιουργούνται με τα δικαιώματα του χρήστη που δημιούργησε το token και είναι έγκυρα μόνο αν ο **χρήστης** που τα δημιούργησε είναι **ενεργός**.

Οι **Trusted Origins** χορηγούν πρόσβαση σε ιστότοπους που ελέγχετε και εμπιστεύεστε για να έχουν πρόσβαση στον οργανισμό σας στο Okta μέσω του Okta API.

Δεν πρέπει να υπάρχουν πολλά API tokens, καθώς αν υπάρχουν, ένας επιτιθέμενος θα μπορούσε να προσπαθήσει να τα αποκτήσει και να τα χρησιμοποιήσει.

## Ροή Εργασίας

### Αυτοματισμοί

Οι αυτοματισμοί σας επιτρέπουν να δημιουργείτε αυτοματοποιημένες ενέργειες που εκτελούνται βάσει ενός συνόλου συνθηκών ενεργοποίησης που συμβαίνουν κατά τη διάρκεια του κύκλου ζωής των τελικών χρηστών.

Για παράδειγμα, μια συνθήκη θα μπορούσε να είναι "Αδράνεια χρήστη στο
