# Okta Hardening

{% hint style="success" %}
Apprenez et pratiquez AWS Hacking :<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez GCP Hacking : <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## R√©pertoire

### Personnes

Du point de vue d'un attaquant, c'est tr√®s int√©ressant car vous pourrez voir **tous les utilisateurs enregistr√©s**, leurs **adresses email**, les **groupes** auxquels ils appartiennent, les **profils** et m√™me les **appareils** (mobiles avec leurs OS).

Pour une revue en bo√Æte blanche, v√©rifiez qu'il n'y a pas plusieurs "**Action utilisateur en attente**" et "**R√©initialisation de mot de passe**".

### Groupes

C'est ici que vous trouvez tous les groupes cr√©√©s dans Okta. Il est int√©ressant de comprendre les diff√©rents groupes (ensemble de **permissions**) qui pourraient √™tre accord√©s aux **utilisateurs**.\
Il est possible de voir les **personnes incluses dans les groupes** et les **applications assign√©es** √† chaque groupe.

Bien s√ªr, tout groupe avec le nom **admin** est int√©ressant, en particulier le groupe **Administrateurs globaux**, v√©rifiez les membres pour savoir qui sont les membres les plus privil√©gi√©s.

Pour une revue en bo√Æte blanche, il **ne devrait pas y avoir plus de 5 administrateurs globaux** (mieux s'il n'y en a que 2 ou 3).

### Appareils

Trouvez ici une **liste de tous les appareils** de tous les utilisateurs. Vous pouvez √©galement voir s'ils sont **activement g√©r√©s** ou non.

### √âditeur de profil

Ici, il est possible d'observer comment des informations cl√©s telles que les pr√©noms, noms de famille, emails, noms d'utilisateur... sont partag√©es entre Okta et d'autres applications. C'est int√©ressant car si un utilisateur peut **modifier un champ dans Okta** (comme son nom ou son email) qui est ensuite utilis√© par une **application externe** pour **identifier** l'utilisateur, un initi√© pourrait essayer de **prendre le contr√¥le d'autres comptes**.

De plus, dans le profil **`Utilisateur (par d√©faut)`** d'Okta, vous pouvez voir **quels champs** chaque **utilisateur** poss√®de et lesquels sont **modifiables** par les utilisateurs. Si vous ne pouvez pas voir le panneau d'administration, allez simplement √† **mettre √† jour vos informations de profil** et vous verrez quels champs vous pouvez mettre √† jour (notez que pour mettre √† jour une adresse email, vous devrez la v√©rifier).

### Int√©grations de r√©pertoire

Les r√©pertoires vous permettent d'importer des personnes √† partir de sources existantes. Je suppose qu'ici vous verrez les utilisateurs import√©s d'autres r√©pertoires.

Je ne l'ai pas vu, mais je suppose que c'est int√©ressant de d√©couvrir **d'autres r√©pertoires qu'Okta utilise pour importer des utilisateurs** donc si vous **compromettez ce r√©pertoire**, vous pourriez d√©finir certaines valeurs d'attributs dans les utilisateurs cr√©√©s dans Okta et **peut-√™tre compromettre l'environnement Okta**.

### Sources de profil

Une source de profil est une **application qui agit comme source de v√©rit√©** pour les attributs de profil utilisateur. Un utilisateur ne peut √™tre sourc√© que par une seule application ou r√©pertoire √† la fois.

Je ne l'ai pas vu, donc toute information sur la s√©curit√© et le hacking concernant cette option est appr√©ci√©e.

## Personnalisations

### Marques

V√©rifiez dans l'onglet **Domaines** de cette section les adresses email utilis√©es pour envoyer des emails et le domaine personnalis√© √† l'int√©rieur d'Okta de l'entreprise (que vous connaissez probablement d√©j√†).

De plus, dans l'onglet **Param√®tres**, si vous √™tes administrateur, vous pouvez "**Utiliser une page de d√©connexion personnalis√©e**" et d√©finir une URL personnalis√©e.

### SMS

Rien d'int√©ressant ici.

### Tableau de bord de l'utilisateur final

Vous pouvez trouver ici les applications configur√©es, mais nous verrons les d√©tails de celles-ci plus tard dans une section diff√©rente.

### Autre

Param√®tre int√©ressant, mais rien de super int√©ressant du point de vue de la s√©curit√©.

## Applications

### Applications

Ici, vous pouvez trouver toutes les **applications configur√©es** et leurs d√©tails : Qui y a acc√®s, comment elles sont configur√©es (SAML, OpenID), URL pour se connecter, les mappages entre Okta et l'application...

Dans l'onglet **`Connexion`**, il y a aussi un champ appel√© **`R√©v√©lation de mot de passe`** qui permettrait √† un utilisateur de **r√©v√©ler son mot de passe** en v√©rifiant les param√®tres de l'application. Pour v√©rifier les param√®tres d'une application depuis le panneau utilisateur, cliquez sur les 3 points :

<figure><img src="../../.gitbook/assets/image (283).png" alt=""><figcaption></figcaption></figure>

Et vous pourriez voir quelques d√©tails suppl√©mentaires sur l'application (comme la fonctionnalit√© de r√©v√©lation de mot de passe, si elle est activ√©e) :

<figure><img src="../../.gitbook/assets/image (220).png" alt=""><figcaption></figcaption></figure>

## Gouvernance de l'identit√©

### Certifications d'acc√®s

Utilisez les certifications d'acc√®s pour cr√©er des campagnes d'audit afin de revoir p√©riodiquement l'acc√®s de vos utilisateurs aux ressources et approuver ou r√©voquer automatiquement l'acc√®s lorsque cela est n√©cessaire.

Je ne l'ai pas vu utilis√©, mais je suppose que du point de vue d√©fensif, c'est une fonctionnalit√© int√©ressante.

## S√©curit√©

### G√©n√©ral

* **Emails de notification de s√©curit√©** : Tous devraient √™tre activ√©s.
* **Int√©gration CAPTCHA** : Il est recommand√© de d√©finir au moins le reCaptcha invisible
* **S√©curit√© de l'organisation** : Tout peut √™tre activ√© et les emails d'activation ne devraient pas durer longtemps (7 jours, c'est correct)
* **Pr√©vention de l'√©num√©ration des utilisateurs** : Les deux devraient √™tre activ√©s
* Notez que la pr√©vention de l'√©num√©ration des utilisateurs ne prend pas effet si l'une des conditions suivantes est autoris√©e (voir [Gestion des utilisateurs](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) pour plus d'informations) :
* Inscription en libre-service
* Flux JIT avec authentification par email
* **Param√®tres Okta ThreatInsight** : Enregistrer et appliquer la s√©curit√© en fonction du niveau de menace

### HealthInsight

Ici, il est possible de trouver des **param√®tres** correctement et **dangereusement** configur√©s.

### Authentificateurs

Ici, vous pouvez trouver toutes les m√©thodes d'authentification qu'un utilisateur pourrait utiliser : Mot de passe, t√©l√©phone, email, code, WebAuthn... En cliquant sur l'authentificateur de mot de passe, vous pouvez voir la **politique de mot de passe**. V√©rifiez qu'elle est forte.

Dans l'onglet **Inscription**, vous pouvez voir celles qui sont requises ou optionnelles :

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

Il est recommand√© de d√©sactiver le t√©l√©phone. Les plus fortes sont probablement une combinaison de mot de passe, email et WebAuthn.

### Politiques d'authentification

Chaque application a une politique d'authentification. La politique d'authentification v√©rifie que les utilisateurs qui essaient de se connecter √† l'application r√©pondent √† des conditions sp√©cifiques et elle impose des exigences de facteur en fonction de ces conditions.

Ici, vous pouvez trouver les **exigences pour acc√©der √† chaque application**. Il est recommand√© de demander au moins un mot de passe et une autre m√©thode pour chaque application. Mais si en tant qu'attaquant vous trouvez quelque chose de plus faible, vous pourriez √™tre en mesure de l'attaquer.

### Politique de session globale

Ici, vous pouvez trouver les politiques de session assign√©es √† diff√©rents groupes. Par exemple :

<figure><img src="../../.gitbook/assets/image (245).png" alt=""><figcaption></figcaption></figure>

Il est recommand√© de demander une MFA, de limiter la dur√©e de la session √† quelques heures, de ne pas persister les cookies de session √† travers les extensions de navigateur et de limiter l'emplacement et le fournisseur d'identit√© (si cela est possible). Par exemple, si chaque utilisateur doit se connecter depuis un pays, vous pourriez n'autoriser que cet emplacement.

### Fournisseurs d'identit√©

Les fournisseurs d'identit√© (IdP) sont des services qui **g√®rent les comptes utilisateurs**. Ajouter des IdP dans Okta permet √† vos utilisateurs finaux de **s'auto-enregistrer** avec vos applications personnalis√©es en s'authentifiant d'abord avec un compte social ou une carte √† puce.

Sur la page des fournisseurs d'identit√©, vous pouvez ajouter des connexions sociales (IdP) et configurer Okta en tant que fournisseur de services (SP) en ajoutant du SAML entrant. Apr√®s avoir ajout√© des IdP, vous pouvez configurer des r√®gles de routage pour diriger les utilisateurs vers un IdP en fonction du contexte, tel que l'emplacement de l'utilisateur, l'appareil ou le domaine de l'email.

**Si un fournisseur d'identit√© est configur√©**, du point de vue des attaquants et des d√©fenseurs, v√©rifiez cette configuration et **si la source est vraiment fiable** car un attaquant la compromettant pourrait √©galement acc√©der √† l'environnement Okta.

### Authentification d√©l√©gu√©e

L'authentification d√©l√©gu√©e permet aux utilisateurs de se connecter √† Okta en entrant les identifiants de leur **Active Directory (AD) ou serveur LDAP** de l'organisation.

Encore une fois, rev√©rifiez cela, car un attaquant compromettant l'AD d'une organisation pourrait √™tre en mesure de pivoter vers Okta gr√¢ce √† ce param√®tre.

### R√©seau

Une zone r√©seau est une fronti√®re configurable que vous pouvez utiliser pour **accorder ou restreindre l'acc√®s aux ordinateurs et appareils** de votre organisation en fonction de l'**adresse IP** qui demande l'acc√®s. Vous pouvez d√©finir une zone r√©seau en sp√©cifiant une ou plusieurs adresses IP individuelles, des plages d'adresses IP ou des emplacements g√©ographiques.

Apr√®s avoir d√©fini une ou plusieurs zones r√©seau, vous pouvez **les utiliser dans les politiques de session globales**, les **politiques d'authentification**, les notifications VPN et les **r√®gles de routage**.

Du point de vue des attaquants, il est int√©ressant de savoir quelles IP sont autoris√©es (et v√©rifier si certaines **IP sont plus privil√©gi√©es** que d'autres). Du point de vue des attaquants, si les utilisateurs doivent acc√©der depuis une adresse IP ou une r√©gion sp√©cifique, v√©rifiez que cette fonctionnalit√© est utilis√©e correctement.

### Int√©grations d'appareils

* **Gestion des points de terminaison** : La gestion des points de terminaison est une condition qui peut √™tre appliqu√©e dans une politique d'authentification pour s'assurer que les appareils g√©r√©s ont acc√®s √† une application.
* Je ne l'ai pas encore vu utilis√©. TODO
* **Services de notification** : Je ne l'ai pas encore vu utilis√©. TODO

### API

Vous pouvez cr√©er des jetons API Okta sur cette page et voir ceux qui ont √©t√© **cr√©√©s**, leurs **privil√®ges**, le **temps d'expiration** et les **URLs d'origine**. Notez qu'un jeton API est g√©n√©r√© avec les permissions de l'utilisateur qui a cr√©√© le jeton et est valide uniquement si l'**utilisateur** qui l'a cr√©√© est **actif**.

Les **origines de confiance** accordent l'acc√®s aux sites web que vous contr√¥lez et en qui vous avez confiance pour acc√©der √† votre organisation Okta via l'API Okta.

Il ne devrait pas y avoir beaucoup de jetons API, car s'il y en a, un attaquant pourrait essayer d'y acc√©der et de les utiliser.

## Workflow

### Automatisations

Les automatisations vous permettent de cr√©er des actions automatis√©es qui s'ex√©cutent en fonction d'un ensemble de conditions de d√©clenchement qui se produisent pendant le cycle de vie des utilisateurs finaux.

Par exemple, une condition pourrait √™tre "Inactivit√© de l'utilisateur dans Okta" ou "Expiration du mot de passe de l'utilisateur dans Okta" et l'action pourrait √™tre "Envoyer un email √† l'utilisateur" ou "Changer l'√©tat du cycle de vie de l'utilisateur dans Okta".

## Rapports

### Rapports

T√©l√©chargez les journaux. Ils sont **envoy√©s** √† l'**adresse email** du compte actuel.

### Journal syst√®me

Ici, vous pouvez trouver les **journaux des actions effectu√©es par les utilisateurs** avec beaucoup de d√©tails comme la connexion √† Okta ou aux applications via Okta.

### Surveillance des importations

Cela peut **importer des journaux des autres plateformes** accessibles avec Okta.

### Limites de taux

V√©rifiez les limites de taux de l'API atteintes.

## Param√®tres

### Compte

Ici, vous pouvez trouver des **informations g√©n√©rales** sur l'environnement Okta, telles que le nom de l'entreprise, l'adresse, le **contact de facturation par email**, le **contact technique par email** et √©galement qui devrait recevoir les mises √† jour Okta et quel type de mises √† jour Okta.

### T√©l√©chargements

Ici, vous pouvez t√©l√©charger des agents Okta pour synchroniser Okta avec d'autres technologies.

{% hint style="success" %}
Apprenez et pratiquez AWS Hacking :<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez GCP Hacking : <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
