# Okta Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basiese Inligting

[Okta, Inc.](https://www.okta.com/) word erken in die identiteit- en toegangsbestuurssektor vir sy wolkgebaseerde sagteware-oplossings. Hierdie oplossings is ontwerp om gebruikersverifikasie oor verskeie moderne toepassings te vereenvoudig en te beveilig. Hulle bedien nie net maatskappye wat hul sensitiewe data wil beskerm nie, maar ook ontwikkelaars wat belangstel om identiteitsbeheer in toepassings, webdienste en toestelle te integreer.

Die vlagskipaanbod van Okta is die **Okta Identity Cloud**. Hierdie platform omvat 'n reeks produkte, insluitend maar nie beperk tot:

* **Single Sign-On (SSO)**: Vereenvoudig gebruikers toegang deur een stel aanmeldbewyse oor verskeie toepassings toe te laat.
* **Multi-Factor Authentication (MFA)**: Verhoog sekuriteit deur verskeie vorme van verifikasie te vereis.
* **Lifecycle Management**: Outomatiseer gebruikersrekening skepping, opdatering en deaktivering prosesse.
* **Universal Directory**: Maak gesentraliseerde bestuur van gebruikers, groepe en toestelle moontlik.
* **API Access Management**: Beveilig en bestuur toegang tot APIs.

Hierdie dienste saam poog om databeskerming te versterk en gebruikers toegang te vereenvoudig, wat beide sekuriteit en gerief verbeter. Die veelsydigheid van Okta se oplossings maak hulle 'n gewilde keuse oor verskeie industrie√´, voordelig vir groot ondernemings, klein maatskappye en individuele ontwikkelaars. Vanaf die laaste opdatering in September 2021, word Okta erken as 'n prominente entiteit in die Identiteit- en Toegangsbestuurs (IAM) arena.

{% hint style="danger" %}
Die hoofdoel van Okta is om toegang tot verskillende gebruikers en groepe tot eksterne toepassings te konfigureer. As jy daarin slaag om **administrateur voorregte in 'n Okta omgewing te kompromitteer**, sal jy waarskynlik in staat wees om **al die ander platforms wat die maatskappy gebruik te kompromitteer**.
{% endhint %}

{% hint style="success" %}
Om 'n sekuriteitsoorsig van 'n Okta omgewing uit te voer, moet jy vra vir **administrateur lees-alleen toegang**.
{% endhint %}

### Opsomming

Daar is **gebruikers** (wat in **Okta gestoor kan word**, aangemeld vanaf gekonfigureerde **Identity Providers** of geverifieer via **Active Directory** of LDAP).\
Hierdie gebruikers kan binne **groepe** wees.\
Daar is ook **verifikators**: verskillende opsies om te verifieer soos wagwoord, en verskeie 2FA soos WebAuthn, e-pos, telefoon, okta verifieer (hulle kan geaktiveer of gedeaktiveer wees)...

Dan is daar **toepassings** gesinchroniseer met Okta. Elke toepassing sal 'n **kartering met Okta** h√™ om inligting te deel (soos e-posadresse, voorname...). Verder moet elke toepassing binne 'n **Verifikasiebeleid** wees, wat die **nodige verifikators** aandui vir 'n gebruiker om toegang tot die toepassing te kry.

{% hint style="danger" %}
Die mees kragtige rol is **Super Administrateur**.

As 'n aanvaller Okta met Administrateur toegang kompromitteer, sal al die **toepassings wat Okta vertrou** waarskynlik **gekompromitteer** word.
{% endhint %}

## Aanvalle

### Opspoor van Okta Portaal

Gewoonlik sal die portaal van 'n maatskappy gele√´ wees in **companyname.okta.com**. Indien nie, probeer eenvoudige **variasies** van **companyname.** As jy dit nie kan vind nie, is dit ook moontlik dat die organisasie 'n **CNAME** rekord soos **`okta.companyname.com`** het wat na die **Okta portaal** wys.

### Aanmelding in Okta via Kerberos

As **`companyname.kerberos.okta.com`** aktief is, word **Kerberos gebruik vir Okta toegang**, tipies om **MFA** vir **Windows** gebruikers te omseil. Om Kerberos-geverifieerde Okta gebruikers in AD te vind, voer **`getST.py`** met **gepaste parameters** uit. Na die verkryging van 'n **AD gebruiker kaartjie**, **inspuit** dit in 'n beheerde gasheer met behulp van gereedskap soos Rubeus of Mimikatz, en verseker dat **`clientname.kerberos.okta.com` in die Internet Opsies "Intranet" sone is**. Toegang tot 'n spesifieke URL moet 'n JSON "OK" reaksie teruggee, wat aandui dat die Kerberos kaartjie aanvaar is, en toegang tot die Okta paneelbord verleen.

Die kompromittering van die **Okta diensrekening met die delegasie SPN stel 'n Silver Ticket aanval in staat.** Maar, Okta se gebruik van **AES** vir kaartjie enkripsie vereis die besit van die AES sleutel of gewone teks wagwoord. Gebruik **`ticketer.py` om 'n kaartjie vir die slagoffer gebruiker te genereer** en lewer dit via die blaaier om met Okta te verifieer.

**Kyk na die aanval in** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

### Kaap Okta AD Agent

Hierdie tegniek behels **toegang tot die Okta AD Agent op 'n bediener**, wat **gebruikers sinchroniseer en verifikasie hanteer**. Deur konfigurasies in **`OktaAgentService.exe.config`** te ondersoek en te dekripteer, veral die AgentToken met behulp van **DPAPI**, kan 'n aanvaller potensieel **verifikasie data onderskep en manipuleer**. Dit laat nie net **monitering** en **vaslegging van gebruikersbewyse** in gewone teks tydens die Okta verifikasieproses toe nie, maar ook **reageer op verifikasie pogings**, wat ongemagtigde toegang moontlik maak of universele verifikasie deur Okta verskaf (soortgelyk aan 'n 'skeleton key').

**Kyk na die aanval in** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

### Kaap AD As 'n Admin

Hierdie tegniek behels die kaap van 'n Okta AD Agent deur eers 'n OAuth Kode te verkry, dan 'n API token aan te vra. Die token word geassosieer met 'n AD domein, en 'n **connector word genoem om 'n vals AD agent te vestig**. Inisialisering laat die agent toe om **verifikasie pogings te verwerk**, wat geloofsbriewe via die Okta API vasvang. Outomatiseringsgereedskap is beskikbaar om hierdie proses te stroomlyn, wat 'n naatlose metode bied om verifikasie data binne die Okta omgewing te onderskep en te hanteer.

**Kyk na die aanval in** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

### Okta Vals SAML Verskaffer

**Kyk na die aanval in** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

Die tegniek behels die **ontplooiing van 'n vals SAML verskaffer**. Deur 'n eksterne Identiteitsverskaffer (IdP) binne Okta se raamwerk te integreer met behulp van 'n bevoorregte rekening, kan aanvallers **die IdP beheer, en enige verifikasie versoek na willekeur goedkeur**. Die proses behels die opstel van 'n SAML 2.0 IdP in Okta, die manipulasie van die IdP Single Sign-On URL vir herleiding via plaaslike hosts l√™er, die generering van 'n self-ondertekende sertifikaat, en die konfigurasie van Okta instellings om te pas teen die gebruikersnaam of e-pos. Die suksesvolle uitvoering van hierdie stappe laat verifikasie as enige Okta gebruiker toe, wat die behoefte aan individuele gebruikersbewyse omseil, en toegangbeheer aansienlik verhoog op 'n potensieel onopgemerkte wyse.

### Phishing Okta Portaal met Evilgnix

In [**hierdie blogpos**](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23) word verduidelik hoe om 'n phishing veldtog teen 'n Okta portaal voor te berei.

### Kollega Nabootsing Aanval

Die **kenmerke wat elke gebruiker kan h√™ en verander** (soos e-pos of voornaam) kan in Okta gekonfigureer word. As 'n **toepassing** as ID 'n **kenmerk** vertrou wat die gebruiker kan **verander**, sal hy in staat wees om **ander gebruikers in daardie platform na te boots**.

Daarom, as die app die veld **`userName`** vertrou, sal jy waarskynlik nie in staat wees om dit te verander nie (omdat jy gewoonlik nie daardie veld kan verander nie), maar as dit byvoorbeeld **`primaryEmail`** vertrou, mag jy dit **verander na 'n kollega se e-posadres** en dit naboots (jy sal toegang tot die e-pos moet h√™ en die verandering aanvaar).

Let daarop dat hierdie nabootsing afhang van hoe elke toepassing gekonfigureer is. Slegs diegene wat die veld wat jy verander het vertrou en opdaterings aanvaar, sal gekompromitteer word.\
Daarom moet die app hierdie veld geaktiveer h√™ as dit bestaan:

<figure><img src="../../.gitbook/assets/image (175).png" alt=""><figcaption></figcaption></figure>

Ek het ook ander toepassings gesien wat kwesbaar was, maar nie daardie veld in die Okta instellings gehad het nie (uiteindelik word verskillende toepassings verskillend gekonfigureer).

Die beste manier om uit te vind of jy iemand op elke toepassing kan naboots, is om dit te probeer!

## Ontduiking van gedragsopsporingsbeleide <a href="#id-9fde" id="id-9fde"></a>

Gedragsopsporingsbeleide in Okta mag onbekend wees totdat dit te√´gekom word, maar **omseiling** daarvan kan bereik word deur **Okta toepassings direk te teiken**, en die hoof Okta paneelbord te vermy. Met 'n **Okta toegangstoken**, herhaal die token by die **toepassing-spesifieke Okta URL** in plaas van die hoof aanmeldbladsy.

Belangrike aanbevelings sluit in:

* **Vermy die gebruik van** gewilde anonymizer proxies en VPN dienste wanneer vasgevangde toegangstokens herhaal word.
* Verseker **konsekwente gebruiker-agent stringe** tussen die kli√´nt en herhaalde toegangstokens.
* **Weerhou van die herhaling** van tokens van verskillende gebruikers vanaf dieselfde IP-adres.
* Wees versigtig wanneer tokens teen die Okta paneelbord herhaal word.
* As jy bewus is van die slagoffer maatskappy se IP-adresse, **beperk verkeer** tot daardie IP's of hul reeks, en blokkeer alle ander verkeer.

## Okta Verharding

Okta het baie moontlike konfigurasies, op hierdie bladsy sal jy vind hoe om hulle te hersien sodat hulle so veilig as moontlik is:

{% content-ref url="okta-hardening.md" %}
[okta-hardening.md](okta-hardening.md)
{% endcontent-ref %}

## Verwysings

* [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers)
* [https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
