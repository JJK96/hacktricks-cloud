# Okta Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Osnovne Informacije

[Okta, Inc.](https://www.okta.com/) je prepoznata u sektoru za upravljanje identitetom i pristupom po svojim softverskim rešenjima zasnovanim na oblaku. Ova rešenja su dizajnirana da pojednostave i osiguraju autentifikaciju korisnika preko različitih modernih aplikacija. Namenjena su ne samo kompanijama koje žele da zaštite svoje osetljive podatke, već i programerima zainteresovanim za integraciju kontrola identiteta u aplikacije, web servise i uređaje.

Glavna ponuda Okta-e je **Okta Identity Cloud**. Ova platforma obuhvata niz proizvoda, uključujući, ali ne ograničavajući se na:

* **Single Sign-On (SSO)**: Pojednostavljuje pristup korisnika omogućavajući jedan set kredencijala za prijavu preko više aplikacija.
* **Multi-Factor Authentication (MFA)**: Povećava sigurnost zahtevajući više oblika verifikacije.
* **Lifecycle Management**: Automatizuje procese kreiranja, ažuriranja i deaktivacije korisničkih naloga.
* **Universal Directory**: Omogućava centralizovano upravljanje korisnicima, grupama i uređajima.
* **API Access Management**: Osigurava i upravlja pristupom API-jima.

Ove usluge kolektivno imaju za cilj da ojačaju zaštitu podataka i pojednostave pristup korisnika, poboljšavajući i sigurnost i praktičnost. Svestranost Okta-inih rešenja čini ih popularnim izborom u različitim industrijama, korisnim za velike korporacije, male kompanije i individualne programere. Od poslednjeg ažuriranja u septembru 2021, Okta je priznata kao istaknuti entitet u oblasti upravljanja identitetom i pristupom (IAM).

{% hint style="danger" %}
Glavni cilj Okta-e je da konfiguriše pristup različitim korisnicima i grupama za eksterne aplikacije. Ako uspete da **kompromitujete administratorske privilegije u Okta** okruženju, vrlo verovatno ćete moći da **kompromitujete sve druge platforme koje kompanija koristi**.
{% endhint %}

{% hint style="success" %}
Da biste izvršili bezbednosnu proveru Okta okruženja, trebali biste zatražiti **administrator pristup samo za čitanje**.
{% endhint %}

### Rezime

Postoje **korisnici** (koji mogu biti **skladišteni u Okta-i,** prijavljeni iz konfigurisanih **Identity Providers** ili autentifikovani putem **Active Directory** ili LDAP-a).\
Ovi korisnici mogu biti unutar **grupa**.\
Takođe postoje **autentifikatori**: različite opcije za autentifikaciju kao što su lozinka, i nekoliko 2FA kao što su WebAuthn, email, telefon, okta verify (mogu biti omogućeni ili onemogućeni)...

Zatim, tu su **aplikacije** sinhronizovane sa Okta-om. Svaka aplikacija će imati neku **mapu sa Okta-om** za deljenje informacija (kao što su email adrese, imena...). Pored toga, svaka aplikacija mora biti unutar **Authentication Policy**, koja označava **potrebne autentifikatore** za korisnika da **pristupi** aplikaciji.

{% hint style="danger" %}
Najmoćnija uloga je **Super Administrator**.

Ako napadač kompromituje Okta sa administratorskim pristupom, sve **aplikacije koje veruju Okta-i** će vrlo verovatno biti **kompromitovane**.
{% endhint %}

## Napadi

### Pronalaženje Okta Portala

Obično će portal kompanije biti lociran na **companyname.okta.com**. Ako nije, pokušajte jednostavne **varijacije** **companyname.** Ako ga ne možete pronaći, moguće je da organizacija ima **CNAME** zapis kao **`okta.companyname.com`** koji pokazuje na **Okta portal**.

### Prijava u Okta preko Kerberos-a

Ako je **`companyname.kerberos.okta.com`** aktivan, **Kerberos se koristi za pristup Okta-i**, obično zaobilaženje **MFA** za **Windows** korisnike. Da biste pronašli Kerberos-autentifikovane Okta korisnike u AD, pokrenite **`getST.py`** sa **odgovarajućim parametrima**. Nakon dobijanja **AD korisničkog tiketa**, **ubacite** ga u kontrolisani host koristeći alate kao što su Rubeus ili Mimikatz, osiguravajući da je **`clientname.kerberos.okta.com` u Internet Options "Intranet" zoni**. Pristup specifičnom URL-u treba da vrati JSON "OK" odgovor, što ukazuje na prihvatanje Kerberos tiketa i omogućava pristup Okta kontrolnoj tabli.

Kompromitovanje **Okta servisnog naloga sa delegacijom SPN omogućava Silver Ticket napad.** Međutim, Okta-ino korišćenje **AES** za enkripciju tiketa zahteva posedovanje AES ključa ili obične lozinke. Koristite **`ticketer.py` za generisanje tiketa za žrtvinog korisnika** i dostavite ga putem pretraživača za autentifikaciju sa Okta-om.

**Proverite napad na** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

### Preotimanje Okta AD Agenta

Ova tehnika uključuje **pristup Okta AD Agentu na serveru**, koji **sinhronizuje korisnike i rukuje autentifikacijom**. Ispitivanjem i dešifrovanjem konfiguracija u **`OktaAgentService.exe.config`**, posebno AgentToken koristeći **DPAPI**, napadač može potencijalno **presresti i manipulisati podacima o autentifikaciji**. Ovo omogućava ne samo **praćenje** i **hvatanje korisničkih kredencijala** u običnom tekstu tokom Okta procesa autentifikacije, već i **odgovaranje na pokušaje autentifikacije**, čime se omogućava neovlašćeni pristup ili pružanje univerzalne autentifikacije kroz Okta (slično 'skeleton key').

**Proverite napad na** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

### Preotimanje AD kao Admin

Ova tehnika uključuje preotimanje Okta AD Agenta prvo dobijanjem OAuth koda, zatim zahtevom za API token. Token je povezan sa AD domenom, i **konektor je imenovan za uspostavljanje lažnog AD agenta**. Inicijalizacija omogućava agentu da **obrađuje pokušaje autentifikacije**, hvatajući kredencijale putem Okta API-ja. Dostupni su alati za automatizaciju koji pojednostavljuju ovaj proces, nudeći besprekornu metodu za presretanje i rukovanje podacima o autentifikaciji unutar Okta okruženja.

**Proverite napad na** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

### Okta Lažni SAML Provajder

**Proverite napad na** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

Tehnika uključuje **postavljanje lažnog SAML provajdera**. Integracijom eksternog Identity Provider (IdP) unutar Okta okvira koristeći privilegovani nalog, napadači mogu **kontrolisati IdP, odobravajući bilo koji zahtev za autentifikaciju po volji**. Proces uključuje postavljanje SAML 2.0 IdP u Okta, manipulaciju IdP Single Sign-On URL-a za preusmeravanje putem lokalnog hosts fajla, generisanje samopotpisanog sertifikata i konfiguraciju Okta postavki da se podudara sa korisničkim imenom ili email-om. Uspešno izvršavanje ovih koraka omogućava autentifikaciju kao bilo koji Okta korisnik, zaobilazeći potrebu za pojedinačnim korisničkim kredencijalima, značajno povećavajući kontrolu pristupa na potencijalno neprimećen način.

### Phishing Okta Portala sa Evilgnix

U [**ovom blog postu**](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23) je objašnjeno kako pripremiti phishing kampanju protiv Okta portala.

### Napad Imitacije Kolege

**Atributi koje svaki korisnik može imati i modifikovati** (kao što su email ili ime) mogu biti konfigurisani u Okta. Ako neka **aplikacija** **veruje** kao ID nekom **atributu** koji korisnik može **modifikovati**, on će moći da **imitira druge korisnike na toj platformi**.

Dakle, ako aplikacija veruje polju **`userName`**, verovatno nećete moći da ga promenite (jer obično ne možete promeniti to polje), ali ako veruje na primer **`primaryEmail`** možda ćete moći da **promenite ga u email adresu kolege** i imitirate ga (moraćete da imate pristup email-u i prihvatite promenu).

Napomena da ova imitacija zavisi od toga kako je svaka aplikacija konfigurisana. Samo one koje veruju polju koje ste modifikovali i prihvataju ažuriranja će biti kompromitovane.\
Dakle, aplikacija bi trebala imati ovo polje omogućeno ako postoji:

<figure><img src="../../.gitbook/assets/image (175).png" alt=""><figcaption></figcaption></figure>

Takođe sam video druge aplikacije koje su bile ranjive ali nisu imale to polje u Okta postavkama (na kraju različite aplikacije su konfigurisane različito).

Najbolji način da saznate da li možete imitirati nekoga na svakoj aplikaciji bi bio da to probate!

## Izbegavanje politika detekcije ponašanja <a href="#id-9fde" id="id-9fde"></a>

Politike detekcije ponašanja u Okta mogu biti nepoznate dok se ne susretnu, ali **zaobilaženje** njih može se postići **ciljanjem Okta aplikacija direktno**, izbegavajući glavnu Okta kontrolnu tablu. Sa **Okta pristupnim tokenom**, ponovite token na **URL specifičan za aplikaciju Okta** umesto na glavnoj stranici za prijavu.

Ključne preporuke uključuju:

* **Izbegavajte korišćenje** popularnih proxy servera za anonimnost i VPN usluga kada ponavljate uhvaćene pristupne tokene.
* Osigurajte **dosledne stringove korisničkog agenta** između klijenta i ponovljenih pristupnih tokena.
* **Suzdržite se od ponavljanja** tokena različitih korisnika sa iste IP adrese.
* Budite oprezni kada ponavljate tokene protiv Okta kontrolne table.
* Ako ste svesni IP adresa žrtvine kompanije, **ograničite saobraćaj** na te IP adrese ili njihov opseg, blokirajući sav ostali saobraćaj.

## Okta Ojačavanje

Okta ima mnogo mogućih konfiguracija, na ovoj stranici ćete pronaći kako da ih pregledate kako bi bile što sigurnije:

{% content-ref url="okta-hardening.md" %}
[okta-hardening.md](okta-hardening.md)
{% endcontent-ref %}

## Reference

* [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers)
* [https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
