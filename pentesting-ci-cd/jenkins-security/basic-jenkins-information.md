# Basic Jenkins Information

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## アクセス

### ユーザー名 + パスワード

Jenkinsにログインする最も一般的な方法は、ユーザー名またはパスワードを使用することです。

### クッキー

**認証済みのクッキーが盗まれた場合**、そのクッキーを使用してユーザーのセッションにアクセスすることができます。クッキーは通常 `JSESSIONID.*` と呼ばれます。（ユーザーはすべてのセッションを終了することができますが、まずクッキーが盗まれたことを知る必要があります）。

### SSO/プラグイン

Jenkinsはプラグインを使用して**サードパーティのSSOを介してアクセス可能**に構成することができます。

### トークン

**ユーザーはトークンを生成**して、CLIやREST APIを介してアプリケーションに自分を偽装させることができます。

### SSHキー

このコンポーネントは、Jenkins用の組み込みSSHサーバーを提供します。これは[Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/)の代替インターフェースであり、任意のSSHクライアントを使用してコマンドを呼び出すことができます。（[ドキュメント](https://plugins.jenkins.io/sshd)より）

## 認可

`/configureSecurity` では、**Jenkinsの認可方法を構成**することができます。いくつかのオプションがあります：

* **誰でも何でもできる**：匿名アクセスでもサーバーを管理できます。
* **レガシーモード**：Jenkins <1.164と同じです。**"admin"ロール**を持っている場合、システムに対する**完全な制御**が与えられ、それ以外の場合（**匿名ユーザー**を含む）は**読み取り**アクセスのみが与えられます。
* **ログインユーザーは何でもできる**：このモードでは、**ログインしているすべてのユーザーがJenkinsの完全な制御**を持ちます。唯一完全な制御を持たないのは**匿名ユーザー**で、**読み取りアクセス**のみが与えられます。
* **マトリックスベースのセキュリティ**：テーブルで**誰が何をできるか**を構成できます。各**列**は**権限**を表し、各**行**は**ユーザーまたはグループ/ロール**を表します。これには、**匿名ユーザー**を表す特別なユーザー '**anonymous**' と、**認証済みユーザー**を表す '**authenticated**' が含まれます。

![](<../../.gitbook/assets/image (149).png>)

* **プロジェクトベースのマトリックス認可戦略**：このモードは、各プロジェクトごとに追加のACLマトリックスを**個別に定義できる** "**マトリックスベースのセキュリティ**" の**拡張**です。
* **ロールベースの戦略**：**ロールベースの戦略**を使用して認可を定義できるようにします。`/role-strategy` でロールを管理します。

## **セキュリティ領域**

`/configureSecurity` では、**セキュリティ領域を構成**することができます。デフォルトでJenkinsはいくつかの異なるセキュリティ領域をサポートしています：

* **サーブレットコンテナに委任**：Jenkinsコントローラーを実行しているサーブレットコンテナ（[Jetty](https://www.eclipse.org/jetty/)など）に認証を**委任**します。
* **Jenkins独自のユーザーデータベース**：外部システムに委任する代わりに、**Jenkinsの組み込みユーザーデータストア**を使用して認証を行います。これはデフォルトで有効です。
* **LDAP**：設定されたLDAPサーバーにすべての認証を委任し、ユーザーとグループの両方を含みます。
* **Unixユーザー/グループデータベース**：Jenkinsコントローラー上の**基盤となるUnix OSレベルのユーザーデータベースに認証を委任**します。このモードでは、認可のためにUnixグループを再利用することもできます。

プラグインは、既存のアイデンティティシステムにJenkinsを組み込むために役立つ追加のセキュリティ領域を提供することができます。例えば：

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub Authentication](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Jenkinsノード、エージェント、およびエグゼキュータ

[ドキュメント](https://www.jenkins.io/doc/book/managing/nodes/)からの定義：

**ノード**は、ビルド**エージェントが実行される**マシンです。Jenkinsは、ディスクスペース、空きテンポラリスペース、空きスワップ、クロック時間/同期、および応答時間を監視します。これらの値が設定されたしきい値を超えると、ノードはオフラインになります。

**エージェント**は、**エグゼキュータを使用して**Jenkinsコントローラーの**タスク実行を管理**します。エージェントはJavaをサポートする任意のオペレーティングシステムを使用できます。ビルドおよびテストに必要なツールは、エージェントが実行されるノードにインストールされます。これらは**直接インストールするか、コンテナ（DockerまたはKubernetes）にインストールすることができます**。各**エージェントはホストマシン上の独自のPIDを持つプロセス**です。

**エグゼキュータ**は**タスクの実行スロット**であり、実質的には**エージェント内のスレッド**です。ノード上の**エグゼキュータの数**は、そのノードで一度に実行できる**同時タスクの数**を定義します。言い換えれば、これはそのノードで一度に実行できる**同時パイプライン`ステージ`の数**を決定します。

## Jenkinsシークレット

### シークレットと資格情報の暗号化

[ドキュメント](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)からの定義：Jenkinsは**AESを使用してシークレット**、資格情報、およびそれらの暗号化キーを保護します。これらの暗号化キーは、マスターキーと共に `$JENKINS_HOME/secrets/` に保存されます。このディレクトリは、Jenkinsコントローラーが実行されているオペレーティングシステムユーザーのみが読み取りおよび書き込みアクセスを持つように構成する必要があります（つまり、`chmod`値を`0700`に設定するか、適切なファイル属性を使用します）。**マスターキー**（暗号用語で「キー暗号化キー」と呼ばれることもあります）は、**`$JENKINS_HOME/secrets/master.key`** に**暗号化されずに**Jenkinsコントローラーのファイルシステムに保存されており、そのファイルに直接アクセスできる攻撃者に対して保護されていません。ほとんどのユーザーおよび開発者は、[Secret](https://javadoc.jenkins.io/byShortName/Secret) APIを介して一般的なシークレットデータを暗号化するか、資格情報APIを介してこれらの暗号化キーを間接的に使用します。暗号に興味がある方のために、JenkinsはPKCS#5パディングとランダムIVを使用してAESを暗号ブロック連鎖（CBC）モードで使用し、[CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey)のインスタンスを暗号化します。これらは `$JENKINS_HOME/secrets/` にその `CryptoConfidentialKey` IDに対応するファイル名で保存されます。一般的なキーIDには以下が含まれます：

* `hudson.util.Secret`: 一般的なシークレットに使用されます。
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`: 一部の資格情報タイプに使用されます。
* `jenkins.model.Jenkins.crumbSalt`: [CSRF保護メカニズム](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)で使用されます。

### 資格情報アクセス

資格情報は、任意のプロジェクトがアクセスできる**グローバルプロバイダー**（`/credentials/`）にスコープされるか、特定のプロジェクト（`/job/<project-name>/configure`）にスコープされ、その特定のプロジェクトからのみアクセス可能です。

[**ドキュメント**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)によると：スコープ内の資格情報は、制限なしにパイプラインに提供されます。**ビルドログでの偶発的な露出を防ぐために**、資格情報は通常の出力から**マスク**されます。そのため、`env`（Linux）や`set`（Windows）の呼び出し、または環境やパラメータを出力するプログラムは、資格情報にアクセスできないユーザーに対してビルドログにそれらを**表示しません**。

**そのため、攻撃者が資格情報を流出させるためには、例えばbase64エンコードする必要があります。**

## 参考文献

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
