# Βασικές Πληροφορίες για το Jenkins

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}

## Πρόσβαση

### Όνομα Χρήστη + Κωδικός

Ο πιο κοινός τρόπος σύνδεσης στο Jenkins είναι με όνομα χρήστη ή κωδικό.

### Cookie

Αν ένα **εξουσιοδοτημένο cookie κλαπεί**, μπορεί να χρησιμοποιηθεί για πρόσβαση στη συνεδρία του χρήστη. Το cookie συνήθως ονομάζεται `JSESSIONID.*`. (Ένας χρήστης μπορεί να τερματίσει όλες τις συνεδρίες του, αλλά πρέπει πρώτα να ανακαλύψει ότι ένα cookie κλάπηκε).

### SSO/Plugins

Το Jenkins μπορεί να ρυθμιστεί χρησιμοποιώντας plugins για να είναι **προσβάσιμο μέσω τρίτων SSO**.

### Tokens

**Οι χρήστες μπορούν να δημιουργήσουν tokens** για να δώσουν πρόσβαση σε εφαρμογές να τους υποδυθούν μέσω CLI ή REST API.

### SSH Keys

Αυτό το στοιχείο παρέχει έναν ενσωματωμένο SSH server για το Jenkins. Είναι μια εναλλακτική διεπαφή για το [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), και οι εντολές μπορούν να εκτελεστούν με αυτόν τον τρόπο χρησιμοποιώντας οποιονδήποτε SSH client. (Από τα [docs](https://plugins.jenkins.io/sshd/))

## Εξουσιοδότηση

Στο `/configureSecurity` είναι δυνατό να **ρυθμίσετε τη μέθοδο εξουσιοδότησης του Jenkins**. Υπάρχουν αρκετές επιλογές:

* **Οποιοσδήποτε μπορεί να κάνει οτιδήποτε**: Ακόμα και η ανώνυμη πρόσβαση μπορεί να διαχειριστεί τον server.
* **Legacy mode**: Ίδιο με το Jenkins <1.164. Αν έχετε το **"admin" ρόλο**, θα έχετε **πλήρη έλεγχο** του συστήματος, και **διαφορετικά** (συμπεριλαμβανομένων των **ανώνυμων** χρηστών) θα έχετε **πρόσβαση ανάγνωσης**.
* **Οι συνδεδεμένοι χρήστες μπορούν να κάνουν οτιδήποτε**: Σε αυτή τη λειτουργία, κάθε **συνδεδεμένος χρήστης έχει πλήρη έλεγχο** του Jenkins. Ο μόνος χρήστης που δεν θα έχει πλήρη έλεγχο είναι ο **ανώνυμος χρήστης**, που έχει μόνο **πρόσβαση ανάγνωσης**.
* **Matrix-based security**: Μπορείτε να ρυθμίσετε **ποιος μπορεί να κάνει τι** σε έναν πίνακα. Κάθε **στήλη** αντιπροσωπεύει μια **άδεια**. Κάθε **γραμμή** **αντιπροσωπεύει** έναν **χρήστη ή μια ομάδα/ρόλο**. Αυτό περιλαμβάνει έναν ειδικό χρήστη '**anonymous**', που αντιπροσωπεύει **μη αυθεντικοποιημένους χρήστες**, καθώς και '**authenticated**', που αντιπροσωπεύει **όλους τους αυθεντικοποιημένους χρήστες**.

![](<../../.gitbook/assets/image (149).png>)

* **Project-based Matrix Authorization Strategy:** Αυτή η λειτουργία είναι μια **επέκταση** της "**Matrix-based security**" που επιτρέπει την πρόσθετη ACL matrix να **ορίζεται ξεχωριστά για κάθε έργο.**
* **Role-Based Strategy:** Επιτρέπει τον ορισμό εξουσιοδοτήσεων χρησιμοποιώντας μια **στρατηγική βασισμένη σε ρόλους**. Διαχειριστείτε τους ρόλους στο `/role-strategy`.

## **Security Realm**

Στο `/configureSecurity` είναι δυνατό να **ρυθμίσετε το security realm.** Από προεπιλογή, το Jenkins περιλαμβάνει υποστήριξη για μερικά διαφορετικά Security Realms:

* **Delegate to servlet container**: Για **ανάθεση αυθεντικοποίησης σε ένα servlet container που εκτελεί τον Jenkins controller**, όπως το [Jetty](https://www.eclipse.org/jetty/).
* **Jenkins’ own user database:** Χρησιμοποιήστε **την ενσωματωμένη βάση δεδομένων χρηστών του Jenkins** για αυθεντικοποίηση αντί να αναθέσετε σε ένα εξωτερικό σύστημα. Αυτό είναι ενεργοποιημένο από προεπιλογή.
* **LDAP**: Αναθέστε όλη την αυθεντικοποίηση σε έναν διαμορφωμένο LDAP server, συμπεριλαμβανομένων των χρηστών και των ομάδων.
* **Unix user/group database**: **Αναθέτει την αυθεντικοποίηση στην υποκείμενη Unix** βάση δεδομένων χρηστών σε επίπεδο OS στον Jenkins controller. Αυτή η λειτουργία θα επιτρέψει επίσης την επαναχρησιμοποίηση των ομάδων Unix για εξουσιοδότηση.

Τα plugins μπορούν να παρέχουν πρόσθετα security realms που μπορεί να είναι χρήσιμα για την ενσωμάτωση του Jenkins σε υπάρχοντα συστήματα ταυτότητας, όπως:

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub Authentication](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Jenkins Nodes, Agents & Executors

Ορισμοί από τα [docs](https://www.jenkins.io/doc/book/managing/nodes/):

**Nodes** είναι οι **μηχανές** στις οποίες εκτελούνται οι **agents**. Το Jenkins παρακολουθεί κάθε συνδεδεμένο node για χώρο στο δίσκο, ελεύθερο χώρο temp, ελεύθερη μνήμη swap, χρόνο/συγχρονισμό ρολογιού και χρόνο απόκρισης. Ένα node τίθεται εκτός σύνδεσης αν κάποια από αυτές τις τιμές υπερβεί το καθορισμένο όριο.

**Agents** **διαχειρίζονται** την **εκτέλεση εργασιών** εκ μέρους του Jenkins controller χρησιμοποιώντας **executors**. Ένας agent μπορεί να χρησιμοποιεί οποιοδήποτε λειτουργικό σύστημα που υποστηρίζει Java. Τα εργαλεία που απαιτούνται για builds και tests εγκαθίστανται στο node όπου εκτελείται ο agent. Μπορούν **να εγκατασταθούν απευθείας ή σε container** (Docker ή Kubernetes). Κάθε **agent είναι ουσιαστικά μια διαδικασία με το δικό της PID** στη μηχανή υποδοχής.

Ένας **executor** είναι μια **υποδοχή για την εκτέλεση εργασιών**. Ουσιαστικά, είναι **ένα νήμα στον agent**. Ο **αριθμός των executors** σε ένα node καθορίζει τον αριθμό των **ταυτόχρονων εργασιών** που μπορούν να εκτελεστούν σε αυτό το node ταυτόχρονα. Με άλλα λόγια, αυτό καθορίζει τον **αριθμό των ταυτόχρονων Pipeline `stages`** που μπορούν να εκτελεστούν σε αυτό το node ταυτόχρονα.

## Jenkins Secrets

### Κρυπτογράφηση Μυστικών και Διαπιστευτηρίων

Ορισμός από τα [docs](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials): Το Jenkins χρησιμοποιεί **AES για την κρυπτογράφηση και προστασία μυστικών**, διαπιστευτηρίων και των αντίστοιχων κλειδιών κρυπτογράφησης. Αυτά τα κλειδιά κρυπτογράφησης αποθηκεύονται στο `$JENKINS_HOME/secrets/` μαζί με το κύριο κλειδί που χρησιμοποιείται για την προστασία αυτών των κλειδιών. Αυτός ο κατάλογος πρέπει να ρυθμιστεί έτσι ώστε μόνο ο χρήστης του λειτουργικού συστήματος που εκτελεί τον Jenkins controller να έχει δικαιώματα ανάγνωσης και εγγραφής σε αυτόν τον κατάλογο (δηλαδή, μια τιμή `chmod` 0700 ή χρησιμοποιώντας κατάλληλα χαρακτηριστικά αρχείων). Το **κύριο κλειδί** (μερικές φορές αναφέρεται ως "key encryption key" στην κρυπτογραφική ορολογία) **αποθηκεύεται \_μη κρυπτογραφημένο\_** στο σύστημα αρχείων του Jenkins controller στο **`$JENKINS_HOME/secrets/master.key`** που δεν προστατεύει από επιτιθέμενους με άμεση πρόσβαση σε αυτό το αρχείο. Οι περισσότεροι χρήστες και προγραμματιστές θα χρησιμοποιήσουν αυτά τα κλειδιά κρυπτογράφησης έμμεσα μέσω είτε του [Secret](https://javadoc.jenkins.io/byShortName/Secret) API για την κρυπτογράφηση γενικών μυστικών δεδομένων είτε μέσω του credentials API. Για τους κρυπτογραφικά περίεργους, το Jenkins χρησιμοποιεί AES σε λειτουργία cipher block chaining (CBC) με padding PKCS#5 και τυχαία IVs για την κρυπτογράφηση των instances του [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) που αποθηκεύονται στο `$JENKINS_HOME/secrets/` με ένα όνομα αρχείου που αντιστοιχεί στο id του `CryptoConfidentialKey`. Κοινά ids κλειδιών περιλαμβάνουν:

* `hudson.util.Secret`: χρησιμοποιείται για γενικά μυστικά;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`: χρησιμοποιείται για ορισμένους τύπους διαπιστευτηρίων;
* `jenkins.model.Jenkins.crumbSalt`: χρησιμοποιείται από τον [μηχανισμό προστασίας CSRF](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery); και

### Πρόσβαση σε Διαπιστευτήρια

Τα διαπιστευτήρια μπορούν να **οριστούν σε παγκόσμιους παρόχους** (`/credentials/`) που μπορούν να προσπελαστούν από οποιοδήποτε διαμορφωμένο έργο, ή μπορούν να οριστούν σε **συγκεκριμένα έργα** (`/job/<project-name>/configure`) και επομένως να είναι προσβάσιμα μόνο από το συγκεκριμένο έργο.

Σύμφωνα με τα [**docs**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): Τα διαπιστευτήρια που είναι εντός πεδίου είναι διαθέσιμα στον pipeline χωρίς περιορισμούς. Για να **αποτραπεί η τυχαία έκθεση στο build log**, τα διαπιστευτήρια **καλύπτονται** από την κανονική έξοδο, έτσι ώστε μια κλήση του `env` (Linux) ή `set` (Windows), ή προγράμματα που εκτυπώνουν το περιβάλλον ή τις παραμέτρους τους **να μην τα αποκαλύπτουν στο build log** σε χρήστες που δεν θα είχαν διαφορετικά πρόσβαση στα διαπιστευτήρια.

**Γι' αυτό, για να εξάγει τα διαπιστευτήρια, ένας επιτιθέμενος πρέπει, για παράδειγμα, να τα κωδικοποιήσει σε base64.**

## Αναφορές

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστηρίξτε το HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο github.

</details>
{% endhint %}
