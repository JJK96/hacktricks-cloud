# Informaci칩n B치sica de Jenkins

{% hint style="success" %}
Aprende y practica AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Acceso

### Nombre de Usuario + Contrase침a

La forma m치s com칰n de iniciar sesi칩n en Jenkins es con un nombre de usuario o una contrase침a.

### Cookie

Si una **cookie autorizada es robada**, puede ser utilizada para acceder a la sesi칩n del usuario. La cookie usualmente se llama `JSESSIONID.*`. (Un usuario puede terminar todas sus sesiones, pero primero tendr칤a que darse cuenta de que una cookie fue robada).

### SSO/Plugins

Jenkins puede ser configurado usando plugins para ser **accesible v칤a SSO de terceros**.

### Tokens

**Los usuarios pueden generar tokens** para dar acceso a aplicaciones para que los suplanten v칤a CLI o REST API.

### Claves SSH

Este componente proporciona un servidor SSH integrado para Jenkins. Es una interfaz alternativa para el [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), y los comandos pueden ser invocados de esta manera usando cualquier cliente SSH. (De la [documentaci칩n](https://plugins.jenkins.io/sshd/))

## Autorizaci칩n

En `/configureSecurity` es posible **configurar el m칠todo de autorizaci칩n de Jenkins**. Hay varias opciones:

* **Cualquiera puede hacer cualquier cosa**: Incluso el acceso an칩nimo puede administrar el servidor.
* **Modo legado**: Igual que Jenkins <1.164. Si tienes el **rol de "admin"**, se te otorgar치 **control total** sobre el sistema, y **de lo contrario** (incluyendo **usuarios an칩nimos**) tendr치s acceso de **lectura**.
* **Usuarios registrados pueden hacer cualquier cosa**: En este modo, cada **usuario registrado obtiene control total** de Jenkins. El 칰nico usuario que no tendr치 control total es el **usuario an칩nimo**, que solo obtiene **acceso de lectura**.
* **Seguridad basada en matriz**: Puedes configurar **qui칠n puede hacer qu칠** en una tabla. Cada **columna** representa un **permiso**. Cada **fila** **representa** un **usuario o un grupo/rol**. Esto incluye un usuario especial '**an칩nimo**', que representa a **usuarios no autenticados**, as칤 como '**autenticado**', que representa a **todos los usuarios autenticados**.

![](<../../.gitbook/assets/image (149).png>)

* **Estrategia de Autorizaci칩n Basada en Matriz por Proyecto:** Este modo es una **extensi칩n** de la "**seguridad basada en matriz**" que permite definir una matriz ACL adicional para cada proyecto por separado.
* **Estrategia Basada en Roles:** Permite definir autorizaciones usando una **estrategia basada en roles**. Gestiona los roles en `/role-strategy`.

## **Realm de Seguridad**

En `/configureSecurity` es posible **configurar el realm de seguridad.** Por defecto, Jenkins incluye soporte para algunos Realms de Seguridad diferentes:

* **Delegar al contenedor de servlets**: Para **delegar la autenticaci칩n a un contenedor de servlets que ejecuta el controlador de Jenkins**, como [Jetty](https://www.eclipse.org/jetty/).
* **Base de datos de usuarios propia de Jenkins:** Usa **el almac칠n de datos de usuarios integrado de Jenkins** para la autenticaci칩n en lugar de delegar a un sistema externo. Esto est치 habilitado por defecto.
* **LDAP**: Delegar toda la autenticaci칩n a un servidor LDAP configurado, incluyendo tanto usuarios como grupos.
* **Base de datos de usuarios/grupos de Unix**: **Delegar la autenticaci칩n a la base de datos de usuarios a nivel de sistema operativo Unix** en el controlador de Jenkins. Este modo tambi칠n permitir치 reutilizar los grupos de Unix para la autorizaci칩n.

Los plugins pueden proporcionar realms de seguridad adicionales que pueden ser 칰tiles para incorporar Jenkins en sistemas de identidad existentes, tales como:

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub Authentication](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Nodos, Agentes y Ejecutores de Jenkins

Definiciones de la [documentaci칩n](https://www.jenkins.io/doc/book/managing/nodes/):

**Nodos** son las **m치quinas** en las que se ejecutan los **agentes de construcci칩n**. Jenkins monitorea cada nodo adjunto para espacio en disco, espacio temporal libre, espacio de intercambio libre, tiempo/sincronizaci칩n del reloj y tiempo de respuesta. Un nodo se desconecta si alguno de estos valores se sale del umbral configurado.

**Agentes** **gestionan** la **ejecuci칩n de tareas** en nombre del controlador de Jenkins **usando ejecutores**. Un agente puede usar cualquier sistema operativo que soporte Java. Las herramientas necesarias para las construcciones y pruebas se instalan en el nodo donde se ejecuta el agente; pueden **instalarse directamente o en un contenedor** (Docker o Kubernetes). Cada **agente es efectivamente un proceso con su propio PID** en la m치quina host.

Un **ejecutor** es un **espacio para la ejecuci칩n de tareas**; efectivamente, es **un hilo en el agente**. El **n칰mero de ejecutores** en un nodo define el n칰mero de **tareas concurrentes** que pueden ejecutarse en ese nodo al mismo tiempo. En otras palabras, esto determina el **n칰mero de `stages` de Pipeline concurrentes** que pueden ejecutarse en ese nodo al mismo tiempo.

## Secretos de Jenkins

### Encriptaci칩n de Secretos y Credenciales

Definici칩n de la [documentaci칩n](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials): Jenkins usa **AES para encriptar y proteger secretos**, credenciales y sus respectivas claves de encriptaci칩n. Estas claves de encriptaci칩n se almacenan en `$JENKINS_HOME/secrets/` junto con la clave maestra utilizada para proteger dichas claves. Este directorio debe configurarse para que solo el usuario del sistema operativo en el que se ejecuta el controlador de Jenkins tenga acceso de lectura y escritura a este directorio (es decir, un valor de `chmod` de `0700` o usando atributos de archivo apropiados). La **clave maestra** (a veces referida como "clave de encriptaci칩n de clave" en jerga criptogr치fica) se **almacena \_sin encriptar\_** en el sistema de archivos del controlador de Jenkins en **`$JENKINS_HOME/secrets/master.key`**, lo que no protege contra atacantes con acceso directo a ese archivo. La mayor칤a de los usuarios y desarrolladores usar치n estas claves de encriptaci칩n indirectamente a trav칠s de la API de [Secret](https://javadoc.jenkins.io/byShortName/Secret) para encriptar datos secretos gen칠ricos o a trav칠s de la API de credenciales. Para los curiosos de la criptograf칤a, Jenkins usa AES en modo de encadenamiento de bloques de cifrado (CBC) con padding PKCS#5 e IVs aleatorios para encriptar instancias de [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) que se almacenan en `$JENKINS_HOME/secrets/` con un nombre de archivo correspondiente a su id de `CryptoConfidentialKey`. Los ids de clave comunes incluyen:

* `hudson.util.Secret`: usado para secretos gen칠ricos;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`: usado para algunos tipos de credenciales;
* `jenkins.model.Jenkins.crumbSalt`: usado por el [mecanismo de protecci칩n CSRF](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery); y

### Acceso a Credenciales

Las credenciales pueden ser **delimitadas a proveedores globales** (`/credentials/`) que pueden ser accedidos por cualquier proyecto configurado, o pueden ser delimitadas a **proyectos espec칤ficos** (`/job/<project-name>/configure`) y por lo tanto solo accesibles desde el proyecto espec칤fico.

Seg칰n [**la documentaci칩n**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): Las credenciales que est치n en el 치mbito est치n disponibles para el pipeline sin limitaciones. Para **prevenir la exposici칩n accidental en el registro de construcci칩n**, las credenciales son **enmascaradas** de la salida regular, por lo que una invocaci칩n de `env` (Linux) o `set` (Windows), o programas que imprimen su entorno o par치metros **no las revelar치n en el registro de construcci칩n** a usuarios que de otro modo no tendr칤an acceso a las credenciales.

**Es por eso que para exfiltrar las credenciales un atacante necesita, por ejemplo, codificarlas en base64.**

## Referencias

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

{% hint style="success" %}
Aprende y practica AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
