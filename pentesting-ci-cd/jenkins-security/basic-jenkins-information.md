# Informations de base sur Jenkins

{% hint style="success" %}
Apprenez et pratiquez AWS Hacking :<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez GCP Hacking : <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux d√©p√¥ts GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Acc√®s

### Nom d'utilisateur + Mot de passe

La m√©thode la plus courante pour se connecter √† Jenkins est avec un nom d'utilisateur ou un mot de passe.

### Cookie

Si un **cookie autoris√© est vol√©**, il peut √™tre utilis√© pour acc√©der √† la session de l'utilisateur. Le cookie est g√©n√©ralement appel√© `JSESSIONID.*`. (Un utilisateur peut terminer toutes ses sessions, mais il doit d'abord d√©couvrir qu'un cookie a √©t√© vol√©).

### SSO/Plugins

Jenkins peut √™tre configur√© √† l'aide de plugins pour √™tre **accessible via un SSO tiers**.

### Tokens

**Les utilisateurs peuvent g√©n√©rer des tokens** pour donner acc√®s aux applications afin de les imiter via CLI ou REST API.

### Cl√©s SSH

Ce composant fournit un serveur SSH int√©gr√© pour Jenkins. C'est une interface alternative pour le [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), et les commandes peuvent √™tre invoqu√©es de cette mani√®re en utilisant n'importe quel client SSH. (D'apr√®s les [docs](https://plugins.jenkins.io/sshd/))

## Autorisation

Dans `/configureSecurity`, il est possible de **configurer la m√©thode d'autorisation de Jenkins**. Il existe plusieurs options :

* **N'importe qui peut tout faire** : M√™me l'acc√®s anonyme peut administrer le serveur.
* **Mode h√©rit√©** : Identique √† Jenkins <1.164. Si vous avez le **r√¥le "admin"**, vous aurez **le contr√¥le total** sur le syst√®me, et **sinon** (y compris les utilisateurs **anonymes**), vous aurez un acc√®s en **lecture**.
* **Les utilisateurs connect√©s peuvent tout faire** : Dans ce mode, chaque **utilisateur connect√© obtient le contr√¥le total** de Jenkins. Le seul utilisateur qui n'aura pas le contr√¥le total est **l'utilisateur anonyme**, qui n'aura qu'un acc√®s en **lecture**.
* **S√©curit√© bas√©e sur une matrice** : Vous pouvez configurer **qui peut faire quoi** dans un tableau. Chaque **colonne** repr√©sente une **permission**. Chaque **ligne** **repr√©sente** un **utilisateur ou un groupe/r√¥le**. Cela inclut un utilisateur sp√©cial '**anonyme**', qui repr√©sente les **utilisateurs non authentifi√©s**, ainsi que '**authentifi√©**', qui repr√©sente **tous les utilisateurs authentifi√©s**.

![](<../../.gitbook/assets/image (149).png>)

* **Strat√©gie d'autorisation bas√©e sur une matrice de projet** : Ce mode est une **extension** de la "**s√©curit√© bas√©e sur une matrice**" qui permet de d√©finir une matrice ACL suppl√©mentaire pour chaque projet s√©par√©ment.
* **Strat√©gie bas√©e sur les r√¥les** : Permet de d√©finir des autorisations en utilisant une **strat√©gie bas√©e sur les r√¥les**. G√©rez les r√¥les dans `/role-strategy`.

## **Domaine de s√©curit√©**

Dans `/configureSecurity`, il est possible de **configurer le domaine de s√©curit√©**. Par d√©faut, Jenkins inclut la prise en charge de quelques domaines de s√©curit√© diff√©rents :

* **D√©l√©guer au conteneur de servlets** : Pour **d√©l√©guer l'authentification √† un conteneur de servlets ex√©cutant le contr√¥leur Jenkins**, tel que [Jetty](https://www.eclipse.org/jetty/).
* **Base de donn√©es utilisateur propre √† Jenkins** : Utilisez **le magasin de donn√©es utilisateur int√©gr√© de Jenkins** pour l'authentification au lieu de d√©l√©guer √† un syst√®me externe. Ceci est activ√© par d√©faut.
* **LDAP** : D√©l√©guez toute l'authentification √† un serveur LDAP configur√©, y compris les utilisateurs et les groupes.
* **Base de donn√©es utilisateur/groupe Unix** : **D√©l√®gue l'authentification √† la base de donn√©es utilisateur au niveau du syst√®me d'exploitation Unix** sur le contr√¥leur Jenkins. Ce mode permettra √©galement la r√©utilisation des groupes Unix pour l'autorisation.

Les plugins peuvent fournir des domaines de s√©curit√© suppl√©mentaires qui peuvent √™tre utiles pour int√©grer Jenkins dans des syst√®mes d'identit√© existants, tels que :

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub Authentication](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## N≈ìuds Jenkins, Agents & Ex√©cuteurs

D√©finitions des [docs](https://www.jenkins.io/doc/book/managing/nodes/) :

**N≈ìuds** sont les **machines** sur lesquelles les **agents de build s'ex√©cutent**. Jenkins surveille chaque n≈ìud attach√© pour l'espace disque, l'espace temporaire libre, l'espace d'√©change libre, l'heure/synchronisation de l'horloge et le temps de r√©ponse. Un n≈ìud est mis hors ligne si l'une de ces valeurs d√©passe le seuil configur√©.

**Agents** **g√®rent** l'**ex√©cution des t√¢ches** au nom du contr√¥leur Jenkins en **utilisant des ex√©cuteurs**. Un agent peut utiliser n'importe quel syst√®me d'exploitation prenant en charge Java. Les outils n√©cessaires pour les builds et les tests sont install√©s sur le n≈ìud o√π l'agent s'ex√©cute ; ils peuvent **√™tre install√©s directement ou dans un conteneur** (Docker ou Kubernetes). Chaque **agent est effectivement un processus avec son propre PID** sur la machine h√¥te.

Un **ex√©cuteur** est un **emplacement pour l'ex√©cution des t√¢ches** ; en fait, c'est **un thread dans l'agent**. Le **nombre d'ex√©cuteurs** sur un n≈ìud d√©finit le nombre de **t√¢ches simultan√©es** qui peuvent √™tre ex√©cut√©es sur ce n≈ìud √† un moment donn√©. En d'autres termes, cela d√©termine le **nombre de `stages` de pipeline simultan√©s** qui peuvent s'ex√©cuter sur ce n≈ìud √† un moment donn√©.

## Secrets Jenkins

### Chiffrement des secrets et des identifiants

D√©finition des [docs](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials) : Jenkins utilise **AES pour chiffrer et prot√©ger les secrets**, les identifiants et leurs cl√©s de chiffrement respectives. Ces cl√©s de chiffrement sont stock√©es dans `$JENKINS_HOME/secrets/` avec la cl√© principale utilis√©e pour prot√©ger ces cl√©s. Ce r√©pertoire doit √™tre configur√© de mani√®re √† ce que seul l'utilisateur du syst√®me d'exploitation sur lequel le contr√¥leur Jenkins s'ex√©cute ait un acc√®s en lecture et en √©criture √† ce r√©pertoire (c'est-√†-dire une valeur `chmod` de `0700` ou en utilisant des attributs de fichier appropri√©s). La **cl√© principale** (parfois appel√©e "cl√© de chiffrement de cl√©" dans le jargon cryptographique) est **stock√©e \_non chiffr√©e**\_ sur le syst√®me de fichiers du contr√¥leur Jenkins dans **`$JENKINS_HOME/secrets/master.key`** ce qui ne prot√®ge pas contre les attaquants ayant un acc√®s direct √† ce fichier. La plupart des utilisateurs et des d√©veloppeurs utiliseront ces cl√©s de chiffrement indirectement via l'API [Secret](https://javadoc.jenkins.io/byShortName/Secret) pour chiffrer des donn√©es secr√®tes g√©n√©riques ou via l'API des identifiants. Pour les curieux de la cryptographie, Jenkins utilise AES en mode de cha√Ænage de blocs de chiffrement (CBC) avec un remplissage PKCS#5 et des IV al√©atoires pour chiffrer les instances de [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) qui sont stock√©es dans `$JENKINS_HOME/secrets/` avec un nom de fichier correspondant √† leur identifiant `CryptoConfidentialKey`. Les identifiants de cl√© courants incluent :

* `hudson.util.Secret` : utilis√© pour les secrets g√©n√©riques ;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY` : utilis√© pour certains types d'identifiants ;
* `jenkins.model.Jenkins.crumbSalt` : utilis√© par le [m√©canisme de protection CSRF](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery) ; et

### Acc√®s aux identifiants

Les identifiants peuvent √™tre **port√©s √† des fournisseurs globaux** (`/credentials/`) qui peuvent √™tre accessibles par tout projet configur√©, ou peuvent √™tre port√©s √† des **projets sp√©cifiques** (`/job/<project-name>/configure`) et donc accessibles uniquement √† partir du projet sp√©cifique.

Selon [**les docs**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/) : Les identifiants qui sont dans le p√©rim√®tre sont mis √† disposition du pipeline sans limitation. Pour **√©viter une exposition accidentelle dans le journal de build**, les identifiants sont **masqu√©s** de la sortie r√©guli√®re, de sorte qu'une invocation de `env` (Linux) ou `set` (Windows), ou des programmes imprimant leur environnement ou leurs param√®tres **ne les r√©v√©leraient pas dans le journal de build** aux utilisateurs qui n'auraient autrement pas acc√®s aux identifiants.

**C'est pourquoi, pour exfiltrer les identifiants, un attaquant doit, par exemple, les encoder en base64.**

## R√©f√©rences

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

{% hint style="success" %}
Apprenez et pratiquez AWS Hacking :<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez GCP Hacking : <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux d√©p√¥ts GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
