# Informazioni di Base su Jenkins

{% hint style="success" %}
Impara e pratica AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Impara e pratica GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repository github.

</details>
{% endhint %}

## Accesso

### Username + Password

Il modo pi√π comune per accedere a Jenkins √® con un username o una password.

### Cookie

Se un **cookie autorizzato viene rubato**, pu√≤ essere utilizzato per accedere alla sessione dell'utente. Il cookie √® solitamente chiamato `JSESSIONID.*`. (Un utente pu√≤ terminare tutte le sue sessioni, ma deve prima scoprire che un cookie √® stato rubato).

### SSO/Plugins

Jenkins pu√≤ essere configurato utilizzando plugin per essere **accessibile tramite SSO di terze parti**.

### Token

**Gli utenti possono generare token** per dare accesso alle applicazioni per impersonarli tramite CLI o REST API.

### Chiavi SSH

Questo componente fornisce un server SSH integrato per Jenkins. √à un'interfaccia alternativa per il [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), e i comandi possono essere invocati in questo modo utilizzando qualsiasi client SSH. (Dai [docs](https://plugins.jenkins.io/sshd/))

## Autorizzazione

In `/configureSecurity` √® possibile **configurare il metodo di autorizzazione di Jenkins**. Ci sono diverse opzioni:

* **Chiunque pu√≤ fare qualsiasi cosa**: Anche l'accesso anonimo pu√≤ amministrare il server.
* **Modalit√† legacy**: Come Jenkins <1.164. Se hai il **ruolo "admin"**, ti verr√† concesso **pieno controllo** sul sistema, e **altrimenti** (inclusi gli utenti **anonimi**) avrai accesso **in lettura**.
* **Gli utenti loggati possono fare qualsiasi cosa**: In questa modalit√†, ogni **utente loggato ha pieno controllo** di Jenkins. L'unico utente che non avr√† pieno controllo √® l'**utente anonimo**, che ha solo accesso **in lettura**.
* **Sicurezza basata su matrice**: Puoi configurare **chi pu√≤ fare cosa** in una tabella. Ogni **colonna** rappresenta un **permesso**. Ogni **riga** **rappresenta** un **utente o un gruppo/ruolo.** Questo include un utente speciale '**anonimo**', che rappresenta **gli utenti non autenticati**, cos√¨ come '**autenticato**', che rappresenta **tutti gli utenti autenticati**.

![](<../../.gitbook/assets/image (149).png>)

* **Strategia di Autorizzazione Basata su Matrice di Progetto:** Questa modalit√† √® un'**estensione** della "**sicurezza basata su matrice**" che consente di definire una matrice ACL aggiuntiva **per ogni progetto separatamente.**
* **Strategia Basata su Ruoli:** Consente di definire le autorizzazioni utilizzando una **strategia basata su ruoli**. Gestisci i ruoli in `/role-strategy`.

## **Security Realm**

In `/configureSecurity` √® possibile **configurare il security realm.** Di default Jenkins include il supporto per alcuni diversi Security Realms:

* **Delega al contenitore servlet**: Per **delegare l'autenticazione a un contenitore servlet che esegue il controller Jenkins**, come [Jetty](https://www.eclipse.org/jetty/).
* **Database utenti di Jenkins:** Utilizza **il database utenti integrato di Jenkins** per l'autenticazione invece di delegare a un sistema esterno. Questo √® abilitato di default.
* **LDAP**: Delega tutta l'autenticazione a un server LDAP configurato, inclusi sia gli utenti che i gruppi.
* **Database utenti/gruppi Unix**: **Delega l'autenticazione al database utenti a livello di sistema operativo Unix** sul controller Jenkins. Questa modalit√† consente anche il riutilizzo dei gruppi Unix per l'autorizzazione.

I plugin possono fornire ulteriori security realms che possono essere utili per incorporare Jenkins nei sistemi di identit√† esistenti, come:

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub Authentication](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Jenkins Nodes, Agents & Executors

Definizioni dai [docs](https://www.jenkins.io/doc/book/managing/nodes/):

**Nodes** sono le **macchine** su cui **girano gli agenti di build**. Jenkins monitora ogni nodo collegato per spazio su disco, spazio temporaneo libero, swap libero, tempo/sincronizzazione dell'orologio e tempo di risposta. Un nodo viene messo offline se uno di questi valori supera la soglia configurata.

**Agents** **gestiscono** l'**esecuzione dei compiti** per conto del controller Jenkins utilizzando **executors**. Un agente pu√≤ utilizzare qualsiasi sistema operativo che supporti Java. Gli strumenti necessari per le build e i test sono installati sul nodo dove l'agente gira; possono **essere installati direttamente o in un container** (Docker o Kubernetes). Ogni **agente √® effettivamente un processo con il proprio PID** sulla macchina host.

Un **executor** √® uno **slot per l'esecuzione dei compiti**; effettivamente, √® **un thread nell'agente**. Il **numero di executors** su un nodo definisce il numero di **compiti concorrenti** che possono essere eseguiti su quel nodo contemporaneamente. In altre parole, questo determina il **numero di `stages` di Pipeline concorrenti** che possono essere eseguiti su quel nodo contemporaneamente.

## Segreti di Jenkins

### Crittografia di Segreti e Credenziali

Definizione dai [docs](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials): Jenkins utilizza **AES per crittografare e proteggere i segreti**, le credenziali e le rispettive chiavi di crittografia. Queste chiavi di crittografia sono memorizzate in `$JENKINS_HOME/secrets/` insieme alla chiave master utilizzata per proteggere tali chiavi. Questa directory dovrebbe essere configurata in modo che solo l'utente del sistema operativo su cui gira il controller Jenkins abbia accesso in lettura e scrittura a questa directory (cio√®, un valore `chmod` di `0700` o utilizzando attributi di file appropriati). La **chiave master** (a volte chiamata "key encryption key" nel gergo crittografico) √® **memorizzata \_non crittografata\_** sul filesystem del controller Jenkins in **`$JENKINS_HOME/secrets/master.key`** che non protegge contro gli attaccanti con accesso diretto a quel file. La maggior parte degli utenti e degli sviluppatori utilizzer√† queste chiavi di crittografia indirettamente tramite l'API [Secret](https://javadoc.jenkins.io/byShortName/Secret) per crittografare dati segreti generici o tramite l'API delle credenziali. Per i curiosi della crittografia, Jenkins utilizza AES in modalit√† cipher block chaining (CBC) con padding PKCS#5 e IV casuali per crittografare istanze di [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) che sono memorizzate in `$JENKINS_HOME/secrets/` con un nome file corrispondente al loro id `CryptoConfidentialKey`. Gli id chiave comuni includono:

* `hudson.util.Secret`: utilizzato per segreti generici;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`: utilizzato per alcuni tipi di credenziali;
* `jenkins.model.Jenkins.crumbSalt`: utilizzato dal [meccanismo di protezione CSRF](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery); e

### Accesso alle Credenziali

Le credenziali possono essere **scopate a provider globali** (`/credentials/`) che possono essere accessibili da qualsiasi progetto configurato, o possono essere scopate a **progetti specifici** (`/job/<project-name>/configure`) e quindi accessibili solo dal progetto specifico.

Secondo i [**docs**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): Le credenziali che sono in scope sono rese disponibili alla pipeline senza limitazioni. Per **prevenire l'esposizione accidentale nel log di build**, le credenziali sono **mascherate** dall'output regolare, quindi un'invocazione di `env` (Linux) o `set` (Windows), o programmi che stampano il loro ambiente o parametri **non le riveleranno nel log di build** agli utenti che altrimenti non avrebbero accesso alle credenziali.

**Ecco perch√© per esfiltrare le credenziali un attaccante deve, per esempio, codificarle in base64.**

## Riferimenti

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

{% hint style="success" %}
Impara e pratica AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Impara e pratica GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repository github.

</details>
{% endhint %}
