# Informa√ß√µes B√°sicas do Jenkins

{% hint style="success" %}
Aprenda e pratique AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprenda e pratique GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo no Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo no telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios no github.

</details>
{% endhint %}

## Acesso

### Nome de Usu√°rio + Senha

A maneira mais comum de fazer login no Jenkins √© com um nome de usu√°rio ou uma senha.

### Cookie

Se um **cookie autorizado for roubado**, ele pode ser usado para acessar a sess√£o do usu√°rio. O cookie geralmente √© chamado de `JSESSIONID.*`. (Um usu√°rio pode encerrar todas as suas sess√µes, mas ele precisaria descobrir primeiro que um cookie foi roubado).

### SSO/Plugins

O Jenkins pode ser configurado usando plugins para ser **acess√≠vel via SSO de terceiros**.

### Tokens

**Usu√°rios podem gerar tokens** para dar acesso a aplicativos para se passarem por eles via CLI ou REST API.

### Chaves SSH

Este componente fornece um servidor SSH embutido para o Jenkins. √â uma interface alternativa para o [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), e comandos podem ser invocados dessa forma usando qualquer cliente SSH. (Dos [docs](https://plugins.jenkins.io/sshd/))

## Autoriza√ß√£o

Em `/configureSecurity` √© poss√≠vel **configurar o m√©todo de autoriza√ß√£o do Jenkins**. Existem v√°rias op√ß√µes:

* **Qualquer um pode fazer qualquer coisa**: At√© mesmo o acesso an√¥nimo pode administrar o servidor.
* **Modo legado**: Igual ao Jenkins <1.164. Se voc√™ tiver o **papel "admin"**, ter√° **controle total** sobre o sistema, e **caso contr√°rio** (incluindo usu√°rios **an√¥nimos**) ter√° acesso **de leitura**.
* **Usu√°rios logados podem fazer qualquer coisa**: Nesse modo, todo **usu√°rio logado tem controle total** do Jenkins. O √∫nico usu√°rio que n√£o ter√° controle total √© o **usu√°rio an√¥nimo**, que s√≥ ter√° acesso **de leitura**.
* **Seguran√ßa baseada em matriz**: Voc√™ pode configurar **quem pode fazer o qu√™** em uma tabela. Cada **coluna** representa uma **permiss√£o**. Cada **linha** **representa** um **usu√°rio ou um grupo/papel**. Isso inclui um usu√°rio especial '**an√¥nimo**', que representa **usu√°rios n√£o autenticados**, bem como '**autenticado**', que representa **todos os usu√°rios autenticados**.

![](<../../.gitbook/assets/image (149).png>)

* **Estrat√©gia de Autoriza√ß√£o de Matriz Baseada em Projeto:** Este modo √© uma **extens√£o** da "**Seguran√ßa baseada em matriz**" que permite que uma matriz ACL adicional seja **definida para cada projeto separadamente.**
* **Estrat√©gia Baseada em Pap√©is:** Permite definir autoriza√ß√µes usando uma **estrat√©gia baseada em pap√©is**. Gerencie os pap√©is em `/role-strategy`.

## **Realm de Seguran√ßa**

Em `/configureSecurity` √© poss√≠vel **configurar o realm de seguran√ßa.** Por padr√£o, o Jenkins inclui suporte para alguns Realms de Seguran√ßa diferentes:

* **Delegar para o cont√™iner de servlet**: Para **delegar a autentica√ß√£o a um cont√™iner de servlet executando o controlador Jenkins**, como [Jetty](https://www.eclipse.org/jetty/).
* **Banco de dados de usu√°rios do pr√≥prio Jenkins:** Use **o pr√≥prio banco de dados de usu√°rios embutido do Jenkins** para autentica√ß√£o em vez de delegar para um sistema externo. Isso √© habilitado por padr√£o.
* **LDAP**: Delegue toda a autentica√ß√£o para um servidor LDAP configurado, incluindo usu√°rios e grupos.
* **Banco de dados de usu√°rios/grupos Unix**: **Delega a autentica√ß√£o para o banco de dados de usu√°rios em n√≠vel de sistema operacional Unix** subjacente no controlador Jenkins. Este modo tamb√©m permitir√° o reuso de grupos Unix para autoriza√ß√£o.

Plugins podem fornecer realms de seguran√ßa adicionais que podem ser √∫teis para incorporar o Jenkins em sistemas de identidade existentes, como:

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub Authentication](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Jenkins Nodes, Agents & Executors

Defini√ß√µes dos [docs](https://www.jenkins.io/doc/book/managing/nodes/):

**Nodes** s√£o as **m√°quinas** nas quais os **agents de build s√£o executados**. O Jenkins monitora cada node anexado para espa√ßo em disco, espa√ßo tempor√°rio livre, swap livre, tempo/sincroniza√ß√£o do rel√≥gio e tempo de resposta. Um node √© colocado offline se algum desses valores ultrapassar o limite configurado.

**Agents** **gerenciam** a **execu√ß√£o de tarefas** em nome do controlador Jenkins **usando executors**. Um agent pode usar qualquer sistema operacional que suporte Java. Ferramentas necess√°rias para builds e testes s√£o instaladas no node onde o agent √© executado; elas podem **ser instaladas diretamente ou em um cont√™iner** (Docker ou Kubernetes). Cada **agent √© efetivamente um processo com seu pr√≥prio PID** na m√°quina host.

Um **executor** √© um **slot para execu√ß√£o de tarefas**; efetivamente, √© **um thread no agent**. O **n√∫mero de executors** em um node define o n√∫mero de **tarefas simult√¢neas** que podem ser executadas nesse node ao mesmo tempo. Em outras palavras, isso determina o **n√∫mero de `stages` de Pipeline simult√¢neos** que podem ser executados nesse node ao mesmo tempo.

## Segredos do Jenkins

### Criptografia de Segredos e Credenciais

Defini√ß√£o dos [docs](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials): O Jenkins usa **AES para criptografar e proteger segredos**, credenciais e suas respectivas chaves de criptografia. Essas chaves de criptografia s√£o armazenadas em `$JENKINS_HOME/secrets/` junto com a chave mestre usada para proteger essas chaves. Este diret√≥rio deve ser configurado para que apenas o usu√°rio do sistema operacional no qual o controlador Jenkins est√° sendo executado tenha acesso de leitura e grava√ß√£o a este diret√≥rio (ou seja, um valor `chmod` de `0700` ou usando atributos de arquivo apropriados). A **chave mestre** (√†s vezes referida como "chave de criptografia de chave" no jarg√£o criptogr√°fico) √© **armazenada \_sem criptografia**\_ no sistema de arquivos do controlador Jenkins em **`$JENKINS_HOME/secrets/master.key`** o que n√£o protege contra atacantes com acesso direto a esse arquivo. A maioria dos usu√°rios e desenvolvedores usar√° essas chaves de criptografia indiretamente via API [Secret](https://javadoc.jenkins.io/byShortName/Secret) para criptografar dados secretos gen√©ricos ou atrav√©s da API de credenciais. Para os curiosos em criptografia, o Jenkins usa AES no modo de encadeamento de blocos de cifra (CBC) com preenchimento PKCS#5 e IVs aleat√≥rios para criptografar inst√¢ncias de [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) que s√£o armazenadas em `$JENKINS_HOME/secrets/` com um nome de arquivo correspondente ao id do `CryptoConfidentialKey`. Ids de chave comuns incluem:

* `hudson.util.Secret`: usado para segredos gen√©ricos;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`: usado para alguns tipos de credenciais;
* `jenkins.model.Jenkins.crumbSalt`: usado pelo [mecanismo de prote√ß√£o CSRF](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery); e

### Acesso a Credenciais

As credenciais podem ser **escopadas para provedores globais** (`/credentials/`) que podem ser acessados por qualquer projeto configurado, ou podem ser escopadas para **projetos espec√≠ficos** (`/job/<project-name>/configure`) e, portanto, acess√≠veis apenas pelo projeto espec√≠fico.

De acordo com [**os docs**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): As credenciais que est√£o no escopo s√£o disponibilizadas para o pipeline sem limita√ß√£o. Para **evitar exposi√ß√£o acidental no log de build**, as credenciais s√£o **mascaradas** da sa√≠da regular, ent√£o uma invoca√ß√£o de `env` (Linux) ou `set` (Windows), ou programas que imprimem seu ambiente ou par√¢metros **n√£o as revelar√£o no log de build** para usu√°rios que n√£o teriam acesso √†s credenciais de outra forma.

**√â por isso que, para exfiltrar as credenciais, um atacante precisa, por exemplo, codific√°-las em base64.**

## Refer√™ncias

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

{% hint style="success" %}
Aprenda e pratique AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprenda e pratique GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo no Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo no telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios no github.

</details>
{% endhint %}
