# Grundlegende Jenkins-Informationen

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## Zugriff

### Benutzername + Passwort

Die h√§ufigste Methode, sich bei Jenkins anzumelden, ist mit einem Benutzernamen oder einem Passwort.

### Cookie

Wenn ein **autorisierter Cookie gestohlen wird**, kann er verwendet werden, um auf die Sitzung des Benutzers zuzugreifen. Der Cookie wird normalerweise `JSESSIONID.*` genannt. (Ein Benutzer kann alle seine Sitzungen beenden, aber er m√ºsste zuerst herausfinden, dass ein Cookie gestohlen wurde).

### SSO/Plugins

Jenkins kann so konfiguriert werden, dass es **√ºber Drittanbieter-SSO zug√§nglich** ist, indem Plugins verwendet werden.

### Tokens

**Benutzer k√∂nnen Tokens generieren**, um Anwendungen Zugriff zu gew√§hren, sie √ºber CLI oder REST API zu imitieren.

### SSH-Schl√ºssel

Diese Komponente bietet einen integrierten SSH-Server f√ºr Jenkins. Es ist eine alternative Schnittstelle f√ºr die [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), und Befehle k√∂nnen auf diese Weise mit jedem SSH-Client aufgerufen werden. (Aus den [Dokumentationen](https://plugins.jenkins.io/sshd/))

## Autorisierung

In `/configureSecurity` ist es m√∂glich, die **Autorisierungsmethode von Jenkins zu konfigurieren**. Es gibt mehrere Optionen:

* **Jeder kann alles tun**: Sogar anonymer Zugriff kann den Server administrieren.
* **Legacy-Modus**: Gleich wie Jenkins <1.164. Wenn du die **"admin"-Rolle** hast, erh√§ltst du **volle Kontrolle** √ºber das System, und **ansonsten** (einschlie√ülich **anonymer** Benutzer) hast du **Lesezugriff**.
* **Eingeloggte Benutzer k√∂nnen alles tun**: In diesem Modus erh√§lt jeder **eingeloggte Benutzer volle Kontrolle** √ºber Jenkins. Der einzige Benutzer, der keine volle Kontrolle hat, ist der **anonyme Benutzer**, der nur **Lesezugriff** erh√§lt.
* **Matrix-basierte Sicherheit**: Du kannst konfigurieren, **wer was tun kann** in einer Tabelle. Jede **Spalte** repr√§sentiert eine **Berechtigung**. Jede **Zeile** repr√§sentiert einen **Benutzer oder eine Gruppe/Rolle**. Dies schlie√üt einen speziellen Benutzer '**anonym**' ein, der **nicht authentifizierte Benutzer** repr√§sentiert, sowie '**authentifiziert**', der **alle authentifizierten Benutzer** repr√§sentiert.

![](<../../.gitbook/assets/image (149).png>)

* **Projektbasierte Matrix-Autorisierungsstrategie:** Dieser Modus ist eine **Erweiterung** der "**Matrix-basierten Sicherheit**", die es erm√∂glicht, zus√§tzliche ACL-Matrizen **f√ºr jedes Projekt separat zu definieren.**
* **Rollenbasierte Strategie:** Erm√∂glicht die Definition von Autorisierungen mithilfe einer **rollenbasierten Strategie**. Verwalte die Rollen in `/role-strategy`.

## **Sicherheitsbereich**

In `/configureSecurity` ist es m√∂glich, den **Sicherheitsbereich zu konfigurieren.** Standardm√§√üig unterst√ºtzt Jenkins einige verschiedene Sicherheitsbereiche:

* **Delegieren an Servlet-Container**: Zum **Delegieren der Authentifizierung an einen Servlet-Container, der den Jenkins-Controller ausf√ºhrt**, wie [Jetty](https://www.eclipse.org/jetty/).
* **Jenkins‚Äô eigene Benutzerdatenbank:** Verwende **Jenkins‚Äô eigenen integrierten Benutzerdatenspeicher** zur Authentifizierung anstelle der Delegation an ein externes System. Dies ist standardm√§√üig aktiviert.
* **LDAP**: Delegiere alle Authentifizierungen an einen konfigurierten LDAP-Server, einschlie√ülich sowohl Benutzer als auch Gruppen.
* **Unix-Benutzer-/Gruppendatenbank**: **Delegiert die Authentifizierung an die zugrunde liegende Unix** OS-Ebene Benutzerdatenbank auf dem Jenkins-Controller. Dieser Modus erm√∂glicht auch die Wiederverwendung von Unix-Gruppen f√ºr die Autorisierung.

Plugins k√∂nnen zus√§tzliche Sicherheitsbereiche bereitstellen, die n√ºtzlich sein k√∂nnen, um Jenkins in bestehende Identit√§tssysteme zu integrieren, wie:

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub Authentication](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Jenkins Nodes, Agents & Executors

Definitionen aus den [Dokumentationen](https://www.jenkins.io/doc/book/managing/nodes/):

**Nodes** sind die **Maschinen**, auf denen Build-**Agents laufen**. Jenkins √ºberwacht jeden angeschlossenen Node auf Festplattenspeicher, freien tempor√§ren Speicher, freien Swap, Uhrzeit/Synchronisation und Antwortzeit. Ein Node wird offline genommen, wenn einer dieser Werte au√üerhalb des konfigurierten Schwellenwerts liegt.

**Agents** **verwalten** die **Aufgabenausf√ºhrung** im Auftrag des Jenkins-Controllers durch **Verwendung von Executors**. Ein Agent kann jedes Betriebssystem verwenden, das Java unterst√ºtzt. Werkzeuge, die f√ºr Builds und Tests erforderlich sind, werden auf dem Node installiert, auf dem der Agent l√§uft; sie k√∂nnen **direkt oder in einem Container** (Docker oder Kubernetes) installiert werden. Jeder **Agent ist effektiv ein Prozess mit eigener PID** auf der Host-Maschine.

Ein **Executor** ist ein **Slot f√ºr die Ausf√ºhrung von Aufgaben**; effektiv ist es **ein Thread im Agent**. Die **Anzahl der Executors** auf einem Node definiert die Anzahl der **gleichzeitigen Aufgaben**, die auf diesem Node zu einem Zeitpunkt ausgef√ºhrt werden k√∂nnen. Mit anderen Worten, dies bestimmt die **Anzahl der gleichzeitigen Pipeline-`stages`**, die zu einem Zeitpunkt auf diesem Node ausgef√ºhrt werden k√∂nnen.

## Jenkins Secrets

### Verschl√ºsselung von Secrets und Anmeldeinformationen

Definition aus den [Dokumentationen](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials): Jenkins verwendet **AES zur Verschl√ºsselung und zum Schutz von Secrets**, Anmeldeinformationen und deren jeweiligen Verschl√ºsselungsschl√ºsseln. Diese Verschl√ºsselungsschl√ºssel werden in `$JENKINS_HOME/secrets/` zusammen mit dem Master-Schl√ºssel gespeichert, der verwendet wird, um diese Schl√ºssel zu sch√ºtzen. Dieses Verzeichnis sollte so konfiguriert werden, dass nur der Betriebssystembenutzer, unter dem der Jenkins-Controller l√§uft, Lese- und Schreibzugriff auf dieses Verzeichnis hat (d.h. ein `chmod`-Wert von `0700` oder die Verwendung geeigneter Dateiattribute). Der **Master-Schl√ºssel** (manchmal in der Kryptojargon als "Key Encryption Key" bezeichnet) wird **unverschl√ºsselt** auf dem Jenkins-Controller-Dateisystem in **`$JENKINS_HOME/secrets/master.key`** gespeichert, was keinen Schutz gegen Angreifer bietet, die direkten Zugriff auf diese Datei haben. Die meisten Benutzer und Entwickler verwenden diese Verschl√ºsselungsschl√ºssel indirekt √ºber entweder die [Secret](https://javadoc.jenkins.io/byShortName/Secret)-API zur Verschl√ºsselung generischer geheimer Daten oder √ºber die Anmeldeinformationen-API. F√ºr die Kryptoneugierigen verwendet Jenkins AES im Cipher Block Chaining (CBC)-Modus mit PKCS#5-Padding und zuf√§lligen IVs zur Verschl√ºsselung von Instanzen von [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey), die in `$JENKINS_HOME/secrets/` mit einem Dateinamen gespeichert werden, der ihrer `CryptoConfidentialKey`-ID entspricht. H√§ufige Schl√ºssel-IDs umfassen:

* `hudson.util.Secret`: verwendet f√ºr generische Secrets;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`: verwendet f√ºr einige Anmeldeinformationstypen;
* `jenkins.model.Jenkins.crumbSalt`: verwendet vom [CSRF-Schutzmechanismus](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery); und

### Zugriff auf Anmeldeinformationen

Anmeldeinformationen k√∂nnen **globalen Anbietern** (`/credentials/`) zugeordnet werden, die von jedem konfigurierten Projekt aus zug√§nglich sind, oder sie k√∂nnen **spezifischen Projekten** (`/job/<project-name>/configure`) zugeordnet werden und sind daher nur von dem spezifischen Projekt aus zug√§nglich.

Laut [**den Dokumentationen**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): Anmeldeinformationen, die im Geltungsbereich sind, werden der Pipeline ohne Einschr√§nkung zur Verf√ºgung gestellt. Um **eine versehentliche Offenlegung im Build-Log zu verhindern**, werden Anmeldeinformationen **maskiert** aus der regul√§ren Ausgabe, sodass ein Aufruf von `env` (Linux) oder `set` (Windows) oder Programme, die ihre Umgebung oder Parameter drucken, **sie nicht im Build-Log offenbaren** f√ºr Benutzer, die sonst keinen Zugriff auf die Anmeldeinformationen h√§tten.

**Deshalb muss ein Angreifer, um die Anmeldeinformationen zu exfiltrieren, sie beispielsweise base64-kodieren.**

## Referenzen

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
